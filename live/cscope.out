cscope 15 $HOME/programs/live555/live               0001621692
	@BasicUsageEnvironment/BasicHashTable.cpp

20 
	~"BasicHashTabË.hh
"

21 
	~"¡rDup.hh
"

23 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

25 
	~<¡ddef.h
>

27 
	~<¡ršg.h
>

28 
	~<¡dio.h
>

32 
	#REBUILD_MULTIPLIER
 3

	)

34 
	gBasicHashTabË
::
	$BasicHashTabË
(
keyTy³
)

35 : 
	`fBuck‘s
(
fSticBuck‘s
), 
	`fNumBuck‘s
(
SMALL_HASH_TABLE_SIZE
),

36 
	`fNumEÁr›s
(0), 
	`fRebudSize
(
SMALL_HASH_TABLE_SIZE
*
REBUILD_MULTIPLIER
),

37 
	`fDownShiá
(28), 
	`fMask
(0x3), 
	$fKeyTy³
(
keyTy³
) {

38 
i
 = 0; i < 
SMALL_HASH_TABLE_SIZE
; ++i) {

39 
fSticBuck‘s
[
i
] = 
NULL
;

41 
	}
}

43 
	gBasicHashTabË
::~
	$BasicHashTabË
() {

45 
i
 = 0; i < 
fNumBuck‘s
; ++i) {

46 
TabËEÁry
* 
’Œy
;

47 (
’Œy
 = 
fBuck‘s
[
i
]è!ğ
NULL
) {

48 
	`d–‘eEÁry
(
i
, 
’Œy
);

53 ià(
fBuck‘s
 !ğ
fSticBuck‘s
è
d–‘e
[] fBuckets;

54 
	}
}

56 * 
	gBasicHashTabË
::
	$Add
(cÚ¡* 
key
, * 
v®ue
) {

57 * 
ŞdV®ue
;

58 
šdex
;

59 
TabËEÁry
* 
’Œy
 = 
	`lookupKey
(
key
, 
šdex
);

60 ià(
’Œy
 !ğ
NULL
) {

62 
ŞdV®ue
 = 
’Œy
->
v®ue
;

65 
’Œy
 = 
	`š£¹NewEÁry
(
šdex
, 
key
);

66 
ŞdV®ue
 = 
NULL
;

68 
’Œy
->
v®ue
 = value;

71 ià(
fNumEÁr›s
 >ğ
fRebudSize
è
	`»bud
();

73  
ŞdV®ue
;

74 
	}
}

76 
BoŞ—n
 
	gBasicHashTabË
::
	$Remove
(cÚ¡* 
key
) {

77 
šdex
;

78 
TabËEÁry
* 
’Œy
 = 
	`lookupKey
(
key
, 
šdex
);

79 ià(
’Œy
 =ğ
NULL
è 
F®£
;

81 
	`d–‘eEÁry
(
šdex
, 
’Œy
);

83  
True
;

84 
	}
}

86 * 
	gBasicHashTabË
::
	$Lookup
(cÚ¡* 
key
) const {

87 
šdex
;

88 
TabËEÁry
* 
’Œy
 = 
	`lookupKey
(
key
, 
šdex
);

89 ià(
’Œy
 =ğ
NULL
)  NULL;

91  
’Œy
->
v®ue
;

92 
	}
}

94 
	gBasicHashTabË
::
	$numEÁr›s
() const {

95  
fNumEÁr›s
;

96 
	}
}

98 
	gBasicHashTabË
::
I‹¿tÜ
::
	$I‹¿tÜ
(
BasicHashTabË
 cÚ¡& 
bË
)

99 : 
	`fTabË
(
bË
), 
	`fNextIndex
(0), 
	$fNextEÁry
(
NULL
) {

100 
	}
}

102 * 
	gBasicHashTabË
::
I‹¿tÜ
::
	$Ãxt
(cÚ¡*& 
key
) {

103 
fNextEÁry
 =ğ
NULL
) {

104 ià(
fNextIndex
 >ğ
fTabË
.
fNumBuck‘s
è 
NULL
;

106 
fNextEÁry
 = 
fTabË
.
fBuck‘s
[
fNextIndex
++];

109 
BasicHashTabË
::
TabËEÁry
* 
’Œy
 = 
fNextEÁry
;

110 
fNextEÁry
 = 
’Œy
->
fNext
;

112 
key
 = 
’Œy
->key;

113  
’Œy
->
v®ue
;

114 
	}
}

118 
HashTabË
* 
	gHashTabË
::
	$ü—‹
(
keyTy³
) {

119  
Ãw
 
	`BasicHashTabË
(
keyTy³
);

120 
	}
}

122 
	gHashTabË
::
I‹¿tÜ
* 
HashTabË
::I‹¿tÜ::
	$ü—‹
(
HashTabË
 cÚ¡& 
hashTabË
) {

124  
Ãw
 
BasicHashTabË
::
	`I‹¿tÜ
((BasicHashTabË cÚ¡&)
hashTabË
);

125 
	}
}

129 
	gBasicHashTabË
::
TabËEÁry
* 
BasicHashTabË


130 ::
	$lookupKey
(cÚ¡* 
key
, & 
šdex
) const {

131 
TabËEÁry
* 
’Œy
;

132 
šdex
 = 
	`hashIndexFromKey
(
key
);

134 
’Œy
 = 
fBuck‘s
[
šdex
];ƒÁry !ğ
NULL
;ƒÁry =ƒÁry->
fNext
) {

135 ià(
	`keyM©ches
(
key
, 
’Œy
->key)) ;

138  
’Œy
;

139 
	}
}

141 
BoŞ—n
 
	gBasicHashTabË


142 ::
	$keyM©ches
(cÚ¡* 
key1
, cÚ¡* 
key2
) const {

144 ià(
fKeyTy³
 =ğ
STRING_HASH_KEYS
) {

145  (
	`¡rcmp
(
key1
, 
key2
) == 0);

146 } ià(
fKeyTy³
 =ğ
ONE_WORD_HASH_KEYS
) {

147  (
key1
 =ğ
key2
);

149 * 
k1
 = (*)
key1
;

150 * 
k2
 = (*)
key2
;

152 
i
 = 0; i < 
fKeyTy³
; ++i) {

153 ià(
k1
[
i
] !ğ
k2
[i]è 
F®£
;

155  
True
;

157 
	}
}

159 
	gBasicHashTabË
::
TabËEÁry
* 
BasicHashTabË


160 ::
	$š£¹NewEÁry
(
šdex
, cÚ¡* 
key
) {

161 
TabËEÁry
* 
’Œy
 = 
Ãw
 
	`TabËEÁry
();

162 
’Œy
->
fNext
 = 
fBuck‘s
[
šdex
];

163 
fBuck‘s
[
šdex
] = 
’Œy
;

165 ++
fNumEÁr›s
;

166 
	`assignKey
(
’Œy
, 
key
);

168  
’Œy
;

169 
	}
}

171 
	gBasicHashTabË
::
	$assignKey
(
TabËEÁry
* 
’Œy
, cÚ¡* 
key
) {

173 ià(
fKeyTy³
 =ğ
STRING_HASH_KEYS
) {

174 
’Œy
->
key
 = 
	`¡rDup
(key);

175 } ià(
fKeyTy³
 =ğ
ONE_WORD_HASH_KEYS
) {

176 
’Œy
->
key
 = key;

177 } ià(
fKeyTy³
 > 0) {

178 * 
keyFrom
 = (*)
key
;

179 * 
keyTo
 = 
Ãw
 [
fKeyTy³
];

180 
i
 = 0; i < 
fKeyTy³
; ++iè
keyTo
[i] = 
keyFrom
[i];

182 
’Œy
->
key
 = (cÚ¡*)
keyTo
;

184 
	}
}

186 
	gBasicHashTabË
::
	$d–‘eEÁry
(
šdex
, 
TabËEÁry
* 
’Œy
) {

187 
TabËEÁry
** 
•
 = &
fBuck‘s
[
šdex
];

189 
BoŞ—n
 
foundIt
 = 
F®£
;

190 *
•
 !ğ
NULL
) {

191 ià(*
•
 =ğ
’Œy
) {

192 
foundIt
 = 
True
;

193 *
•
 = 
’Œy
->
fNext
;

196 
•
 = &((*•)->
fNext
);

199 ià(!
foundIt
) {

200 #ifdeà
DEBUG


201 
	`årštf
(
¡d”r
, "BasicHashTabË[%p]::d–‘eEÁry(%d,%p): iÁ”ÇÈ”rÜ -‚Ù found (fœ¡ƒÁry %p", 
this
, 
šdex
, 
’Œy
, 
fBuck‘s
[index]);

202 ià(
fBuck‘s
[
šdex
] !ğ
NULL
è
	`årštf
(
¡d”r
, ",‚exˆ’Œy %p", fBuck‘s[šdex]->
fNext
);

203 
	`årštf
(
¡d”r
, ")\n");

207 --
fNumEÁr›s
;

208 
	`d–‘eKey
(
’Œy
);

209 
d–‘e
 
’Œy
;

210 
	}
}

212 
	gBasicHashTabË
::
	$d–‘eKey
(
TabËEÁry
* 
’Œy
) {

214 ià(
fKeyTy³
 =ğ
ONE_WORD_HASH_KEYS
) {

215 
’Œy
->
key
 = 
NULL
;

217 
d–‘e
[] (*)
’Œy
->
key
;

218 
’Œy
->
key
 = 
NULL
;

220 
	}
}

222 
	gBasicHashTabË
::
	$»bud
() {

224 
ŞdSize
 = 
fNumBuck‘s
;

225 
TabËEÁry
** 
ŞdBuck‘s
 = 
fBuck‘s
;

228 
fNumBuck‘s
 *= 4;

229 
fBuck‘s
 = 
Ãw
 
TabËEÁry
*[
fNumBuck‘s
];

230 
i
 = 0; i < 
fNumBuck‘s
; ++i) {

231 
fBuck‘s
[
i
] = 
NULL
;

233 
fRebudSize
 *= 4;

234 
fDownShiá
 -= 2;

235 
fMask
 = (fMask<<2)|0x3;

238 
TabËEÁry
** 
ŞdChašPŒ
 = 
ŞdBuck‘s
; 
ŞdSize
 > 0;

239 --
ŞdSize
, ++
ŞdChašPŒ
) {

240 
TabËEÁry
* 
hPŒ
 = *
ŞdChašPŒ
; hPŒ !ğ
NULL
;

241 
hPŒ
 = *
ŞdChašPŒ
) {

242 *
ŞdChašPŒ
 = 
hPŒ
->
fNext
;

244 
šdex
 = 
	`hashIndexFromKey
(
hPŒ
->
key
);

246 
hPŒ
->
fNext
 = 
fBuck‘s
[
šdex
];

247 
fBuck‘s
[
šdex
] = 
hPŒ
;

252 ià(
ŞdBuck‘s
 !ğ
fSticBuck‘s
è
d–‘e
[] oldBuckets;

253 
	}
}

255 
	gBasicHashTabË
::
	$hashIndexFromKey
(cÚ¡* 
key
) const {

256 
»suÉ
 = 0;

258 ià(
fKeyTy³
 =ğ
STRING_HASH_KEYS
) {

260 
c
 = *
key
++;

261 ià(
c
 == 0) ;

262 
»suÉ
 +ğÔesuÉ<<3è+ ()
c
;

264 
»suÉ
 &ğ
fMask
;

265 } ià(
fKeyTy³
 =ğ
ONE_WORD_HASH_KEYS
) {

266 
»suÉ
 = 
	`¿ndomIndex
((
ušŒ_t
)
key
);

268 * 
k
 = (*)
key
;

269 
ušŒ_t
 
sum
 = 0;

270 
i
 = 0; i < 
fKeyTy³
; ++i) {

271 
sum
 +ğ
k
[
i
];

273 
»suÉ
 = 
	`¿ndomIndex
(
sum
);

276  
»suÉ
;

277 
	}
}

	@BasicUsageEnvironment/BasicTaskScheduler.cpp

21 
	~"BasicU§geEnvœÚm’t.hh
"

22 
	~"HªdËrS‘.hh
"

23 
	~<¡dio.h
>

24 #ià
defšed
(
_QNX4
)

25 
	~<sys/£Ëù.h
>

26 
	~<unix.h
>

31 
BasicTaskScheduËr
* 
	gBasicTaskScheduËr
::
	$ü—‹New
(
maxScheduËrG¿nuÏr™y
) {

32  
Ãw
 
	`BasicTaskScheduËr
(
maxScheduËrG¿nuÏr™y
);

33 
	}
}

35 
	gBasicTaskScheduËr
::
	$BasicTaskScheduËr
(
maxScheduËrG¿nuÏr™y
)

36 : 
	`fMaxScheduËrG¿nuÏr™y
(
maxScheduËrG¿nuÏr™y
), 
	$fMaxNumSock‘s
(0)

37 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

38 , 
	`fDummySock‘Num
(-1)

41 
	`FD_ZERO
(&
fR—dS‘
);

42 
	`FD_ZERO
(&
fWr™eS‘
);

43 
	`FD_ZERO
(&
fExû±iÚS‘
);

45 ià(
maxScheduËrG¿nuÏr™y
 > 0è
	`scheduËrTickTask
();

46 
	}
}

48 
	gBasicTaskScheduËr
::~
	$BasicTaskScheduËr
() {

49 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

50 ià(
fDummySock‘Num
 >ğ0è
	`şo£Sock‘
(fDummySocketNum);

52 
	}
}

54 
	gBasicTaskScheduËr
::
	$scheduËrTickTask
(* 
ş›ÁD©a
) {

55 ((
BasicTaskScheduËr
*)
ş›ÁD©a
)->
	`scheduËrTickTask
();

56 
	}
}

58 
	gBasicTaskScheduËr
::
	$scheduËrTickTask
() {

59 
	`scheduËD–ayedTask
(
fMaxScheduËrG¿nuÏr™y
, 
scheduËrTickTask
, 
this
);

60 
	}
}

62 #iâdeà
MILLION


63 
	#MILLION
 1000000

	)

66 
	gBasicTaskScheduËr
::
	$SšgËS‹p
(
maxD–ayTime
) {

67 
fd_£t
 
»adS‘
 = 
fR—dS‘
;

68 
fd_£t
 
wr™eS‘
 = 
fWr™eS‘
;

69 
fd_£t
 
exû±iÚS‘
 = 
fExû±iÚS‘
;

71 
D–ayIÁ”v®
 cÚ¡& 
timeToD–ay
 = 
fD–ayQueue
.
	`timeToNextAÏrm
();

72 
timev®
 
tv_timeToD–ay
;

73 
tv_timeToD–ay
.
tv_£c
 = 
timeToD–ay
.
	`£cÚds
();

74 
tv_timeToD–ay
.
tv_u£c
 = 
timeToD–ay
.
	`u£cÚds
();

77 cÚ¡ 
MAX_TV_SEC
 = 
MILLION
;

78 ià(
tv_timeToD–ay
.
tv_£c
 > 
MAX_TV_SEC
) {

79 
tv_timeToD–ay
.
tv_£c
 = 
MAX_TV_SEC
;

82 ià(
maxD–ayTime
 > 0 &&

83 (
tv_timeToD–ay
.
tv_£c
 > ()
maxD–ayTime
/
MILLION
 ||

84 (
tv_timeToD–ay
.
tv_£c
 =ğ()
maxD–ayTime
/
MILLION
 &&

85 
tv_timeToD–ay
.
tv_u£c
 > ()
maxD–ayTime
%
MILLION
))) {

86 
tv_timeToD–ay
.
tv_£c
 = 
maxD–ayTime
/
MILLION
;

87 
tv_timeToD–ay
.
tv_u£c
 = 
maxD–ayTime
%
MILLION
;

90 
£ËùResuÉ
 = 
	`£Ëù
(
fMaxNumSock‘s
, &
»adS‘
, &
wr™eS‘
, &
exû±iÚS‘
, &
tv_timeToD–ay
);

91 ià(
£ËùResuÉ
 < 0) {

92 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

93 
”r
 = 
	`WSAG‘La¡E¼Ü
();

96 ià(
”r
 =ğ
WSAEINVAL
 && 
»adS‘
.
fd_couÁ
 == 0) {

97 
”r
 = 
EINTR
;

99 ià(
fDummySock‘Num
 >ğ0è
	`şo£Sock‘
(fDummySocketNum);

100 
fDummySock‘Num
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

101 
	`FD_SET
(()
fDummySock‘Num
, &
fR—dS‘
);

103 ià(
”r
 !ğ
EINTR
) {

105 ià(
”ºo
 !ğ
EINTR
 &&ƒ¼nØ!ğ
EAGAIN
) {

108 #ià!
	`defšed
(
_WIN32_WCE
)

109 
	`³¼Ü
("BasicTaskScheduler::SingleStep(): select() fails");

113 
	`årštf
(
¡d”r
, "socket‚umbers used inhe select() call:");

114 
i
 = 0; i < 10000; ++i) {

115 ià(
	`FD_ISSET
(
i
, &
fR—dS‘
è|| FD_ISSET(i, &
fWr™eS‘
è|| FD_ISSET(i, &
fExû±iÚS‘
)) {

116 
	`årštf
(
¡d”r
, " %d(", 
i
);

117 ià(
	`FD_ISSET
(
i
, &
fR—dS‘
)è
	`årštf
(
¡d”r
, "r");

118 ià(
	`FD_ISSET
(
i
, &
fWr™eS‘
)è
	`årštf
(
¡d”r
, "w");

119 ià(
	`FD_ISSET
(
i
, &
fExû±iÚS‘
)è
	`årštf
(
¡d”r
, "e");

120 
	`årštf
(
¡d”r
, ")");

123 
	`årštf
(
¡d”r
, "\n");

125 
	`š‹º®E¼Ü
();

130 
HªdËrI‹¿tÜ
 
	`™”
(*
fHªdËrs
);

131 
HªdËrDesütÜ
* 
hªdËr
;

134 ià(
fLa¡HªdËdSock‘Num
 >= 0) {

135 (
hªdËr
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

136 ià(
hªdËr
->
sock‘Num
 =ğ
fLa¡HªdËdSock‘Num
) ;

138 ià(
hªdËr
 =ğ
NULL
) {

139 
fLa¡HªdËdSock‘Num
 = -1;

140 
™”
.
	`»£t
();

143 (
hªdËr
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

144 
sock
 = 
hªdËr
->
sock‘Num
;

145 
»suÉCÚd™iÚS‘
 = 0;

146 ià(
	`FD_ISSET
(
sock
, &
»adS‘
è&& FD_ISSET(sock, &
fR—dS‘
èè
»suÉCÚd™iÚS‘
 |ğ
SOCKET_READABLE
;

147 ià(
	`FD_ISSET
(
sock
, &
wr™eS‘
è&& FD_ISSET(sock, &
fWr™eS‘
èè
»suÉCÚd™iÚS‘
 |ğ
SOCKET_WRITABLE
;

148 ià(
	`FD_ISSET
(
sock
, &
exû±iÚS‘
è&& FD_ISSET(sock, &
fExû±iÚS‘
èè
»suÉCÚd™iÚS‘
 |ğ
SOCKET_EXCEPTION
;

149 ià((
»suÉCÚd™iÚS‘
&
hªdËr
->
cÚd™iÚS‘
è!ğ0 && hªdËr->
hªdËrProc
 !ğ
NULL
) {

150 
fLa¡HªdËdSock‘Num
 = 
sock
;

153 (*
hªdËr
->
hªdËrProc
)(hªdËr->
ş›ÁD©a
, 
»suÉCÚd™iÚS‘
);

157 ià(
hªdËr
 =ğ
NULL
 && 
fLa¡HªdËdSock‘Num
 >= 0) {

160 
™”
.
	`»£t
();

161 (
hªdËr
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

162 
sock
 = 
hªdËr
->
sock‘Num
;

163 
»suÉCÚd™iÚS‘
 = 0;

164 ià(
	`FD_ISSET
(
sock
, &
»adS‘
è&& FD_ISSET(sock, &
fR—dS‘
èè
»suÉCÚd™iÚS‘
 |ğ
SOCKET_READABLE
;

165 ià(
	`FD_ISSET
(
sock
, &
wr™eS‘
è&& FD_ISSET(sock, &
fWr™eS‘
èè
»suÉCÚd™iÚS‘
 |ğ
SOCKET_WRITABLE
;

166 ià(
	`FD_ISSET
(
sock
, &
exû±iÚS‘
è&& FD_ISSET(sock, &
fExû±iÚS‘
èè
»suÉCÚd™iÚS‘
 |ğ
SOCKET_EXCEPTION
;

167 ià((
»suÉCÚd™iÚS‘
&
hªdËr
->
cÚd™iÚS‘
è!ğ0 && hªdËr->
hªdËrProc
 !ğ
NULL
) {

168 
fLa¡HªdËdSock‘Num
 = 
sock
;

171 (*
hªdËr
->
hªdËrProc
)(hªdËr->
ş›ÁD©a
, 
»suÉCÚd™iÚS‘
);

175 ià(
hªdËr
 =ğ
NULL
è
fLa¡HªdËdSock‘Num
 = -1;

180 ià(
fTrigg”sAwa™šgHªdlšg
 != 0) {

181 ià(
fTrigg”sAwa™šgHªdlšg
 =ğ
fLa¡U£dTrigg”Mask
) {

183 
fTrigg”sAwa™šgHªdlšg
 &=~ 
fLa¡U£dTrigg”Mask
;

184 ià(
fTrigg”edEv’tHªdËrs
[
fLa¡U£dTrigg”Num
] !ğ
NULL
) {

185 (*
fTrigg”edEv’tHªdËrs
[
fLa¡U£dTrigg”Num
])(
fTrigg”edEv’tCl›ÁD©as
[fLastUsedTriggerNum]);

189 
i
 = 
fLa¡U£dTrigg”Num
;

190 
Ev’tTrigg”Id
 
mask
 = 
fLa¡U£dTrigg”Mask
;

193 
i
 = (i+1)%
MAX_NUM_EVENT_TRIGGERS
;

194 
mask
 >>= 1;

195 ià(
mask
 == 0) mask = 0x80000000;

197 ià((
fTrigg”sAwa™šgHªdlšg
&
mask
) != 0) {

198 
fTrigg”sAwa™šgHªdlšg
 &=~ 
mask
;

199 ià(
fTrigg”edEv’tHªdËrs
[
i
] !ğ
NULL
) {

200 (*
fTrigg”edEv’tHªdËrs
[
i
])(
fTrigg”edEv’tCl›ÁD©as
[i]);

203 
fLa¡U£dTrigg”Mask
 = 
mask
;

204 
fLa¡U£dTrigg”Num
 = 
i
;

207 } 
i
 !ğ
fLa¡U£dTrigg”Num
);

212 
fD–ayQueue
.
	`hªdËAÏrm
();

213 
	}
}

215 
	gBasicTaskScheduËr


216 ::
	$£tBackgroundHªdlšg
(
sock‘Num
, 
cÚd™iÚS‘
, 
BackgroundHªdËrProc
* 
hªdËrProc
, * 
ş›ÁD©a
) {

217 ià(
sock‘Num
 < 0) ;

218 #ià!
	`defšed
(
__WIN32__
è&& !defšed(
_WIN32
è&& defšed(
FD_SETSIZE
)

219 ià(
sock‘Num
 >ğ()(
FD_SETSIZE
)) ;

221 
	`FD_CLR
(()
sock‘Num
, &
fR—dS‘
);

222 
	`FD_CLR
(()
sock‘Num
, &
fWr™eS‘
);

223 
	`FD_CLR
(()
sock‘Num
, &
fExû±iÚS‘
);

224 ià(
cÚd™iÚS‘
 == 0) {

225 
fHªdËrs
->
	`ş—rHªdËr
(
sock‘Num
);

226 ià(
sock‘Num
+1 =ğ
fMaxNumSock‘s
) {

227 --
fMaxNumSock‘s
;

230 
fHªdËrs
->
	`assignHªdËr
(
sock‘Num
, 
cÚd™iÚS‘
, 
hªdËrProc
, 
ş›ÁD©a
);

231 ià(
sock‘Num
+1 > 
fMaxNumSock‘s
) {

232 
fMaxNumSock‘s
 = 
sock‘Num
+1;

234 ià(
cÚd™iÚS‘
&
SOCKET_READABLE
è
	`FD_SET
(()
sock‘Num
, &
fR—dS‘
);

235 ià(
cÚd™iÚS‘
&
SOCKET_WRITABLE
è
	`FD_SET
(()
sock‘Num
, &
fWr™eS‘
);

236 ià(
cÚd™iÚS‘
&
SOCKET_EXCEPTION
è
	`FD_SET
(()
sock‘Num
, &
fExû±iÚS‘
);

238 
	}
}

240 
	gBasicTaskScheduËr
::
	$moveSock‘Hªdlšg
(
ŞdSock‘Num
, 
ÃwSock‘Num
) {

241 ià(
ŞdSock‘Num
 < 0 || 
ÃwSock‘Num
 < 0) ;

242 #ià!
	`defšed
(
__WIN32__
è&& !defšed(
_WIN32
è&& defšed(
FD_SETSIZE
)

243 ià(
ŞdSock‘Num
 >ğ()(
FD_SETSIZE
è|| 
ÃwSock‘Num
 >= ()(FD_SETSIZE)) ;

245 ià(
	`FD_ISSET
(
ŞdSock‘Num
, &
fR—dS‘
)è{
	`FD_CLR
(()ŞdSock‘Num, &fR—dS‘); 
	`FD_SET
(()
ÃwSock‘Num
, &fReadSet);}

246 ià(
	`FD_ISSET
(
ŞdSock‘Num
, &
fWr™eS‘
)è{
	`FD_CLR
(()ŞdSock‘Num, &fWr™eS‘); 
	`FD_SET
(()
ÃwSock‘Num
, &fWriteSet);}

247 ià(
	`FD_ISSET
(
ŞdSock‘Num
, &
fExû±iÚS‘
)è{
	`FD_CLR
(()ŞdSock‘Num, &fExû±iÚS‘); 
	`FD_SET
(()
ÃwSock‘Num
, &fExceptionSet);}

248 
fHªdËrs
->
	`moveHªdËr
(
ŞdSock‘Num
, 
ÃwSock‘Num
);

250 ià(
ŞdSock‘Num
+1 =ğ
fMaxNumSock‘s
) {

251 --
fMaxNumSock‘s
;

253 ià(
ÃwSock‘Num
+1 > 
fMaxNumSock‘s
) {

254 
fMaxNumSock‘s
 = 
ÃwSock‘Num
+1;

256 
	}
}

	@BasicUsageEnvironment/BasicTaskScheduler0.cpp

20 
	~"BasicU§geEnvœÚm’t0.hh
"

21 
	~"HªdËrS‘.hh
"

26 şas 
	cAÏrmHªdËr
: 
public
 
D–ayQueueEÁry
 {

27 
public
:

28 
	$AÏrmHªdËr
(
TaskFunc
* 
´oc
, * 
ş›ÁD©a
, 
D–ayIÁ”v®
 
timeToD–ay
)

29 : 
	`D–ayQueueEÁry
(
timeToD–ay
), 
	`fProc
(
´oc
), 
	$fCl›ÁD©a
(
ş›ÁD©a
) {

32 
´iv©e
:

33 
vœtu®
 
	$hªdËTimeout
() {

34 (*
fProc
)(
fCl›ÁD©a
);

35 
D–ayQueueEÁry
::
	`hªdËTimeout
();

36 
	}
}

38 
	g´iv©e
:

39 
TaskFunc
* 
fProc
;

40 * 
	gfCl›ÁD©a
;

46 
	gBasicTaskScheduËr0
::
	$BasicTaskScheduËr0
()

47 : 
	`fLa¡HªdËdSock‘Num
(-1), 
	`fTrigg”sAwa™šgHªdlšg
(0), 
	`fLa¡U£dTrigg”Mask
(1), 
	`fLa¡U£dTrigg”Num
(
MAX_NUM_EVENT_TRIGGERS
-1) {

48 
fHªdËrs
 = 
Ãw
 
HªdËrS‘
;

49 
i
 = 0; i < 
MAX_NUM_EVENT_TRIGGERS
; ++i) {

50 
fTrigg”edEv’tHªdËrs
[
i
] = 
NULL
;

51 
fTrigg”edEv’tCl›ÁD©as
[
i
] = 
NULL
;

53 
	}
}

55 
	gBasicTaskScheduËr0
::~
	$BasicTaskScheduËr0
() {

56 
d–‘e
 
fHªdËrs
;

57 
	}
}

59 
TaskTok’
 
	gBasicTaskScheduËr0
::
	$scheduËD–ayedTask
(
št64_t
 
miüo£cÚds
,

60 
TaskFunc
* 
´oc
,

61 * 
ş›ÁD©a
) {

62 ià(
miüo£cÚds
 < 0) microseconds = 0;

63 
D–ayIÁ”v®
 
	`timeToD–ay
(()(
miüo£cÚds
/1000000), ()(microseconds%1000000));

64 
AÏrmHªdËr
* 
®¬mHªdËr
 = 
Ãw
 
	`AÏrmHªdËr
(
´oc
, 
ş›ÁD©a
, 
timeToD–ay
);

65 
fD–ayQueue
.
	`addEÁry
(
®¬mHªdËr
);

67  (*)(
®¬mHªdËr
->
	`tok’
());

68 
	}
}

70 
	gBasicTaskScheduËr0
::
	$unscheduËD–ayedTask
(
TaskTok’
& 
´evTask
) {

71 
D–ayQueueEÁry
* 
®¬mHªdËr
 = 
fD–ayQueue
.
	`»moveEÁry
((
šŒ_t
)
´evTask
);

72 
´evTask
 = 
NULL
;

73 
d–‘e
 
®¬mHªdËr
;

74 
	}
}

76 
	gBasicTaskScheduËr0
::
	$doEv’tLoİ
(vŞ©e* 
w©chV¬ŸbË
) {

79 ià(
w©chV¬ŸbË
 !ğ
NULL
 && *watchVariable != 0) ;

80 
	`SšgËS‹p
();

82 
	}
}

84 
Ev’tTrigg”Id
 
	gBasicTaskScheduËr0
::
	$ü—‹Ev’tTrigg”
(
TaskFunc
* 
ev’tHªdËrProc
) {

85 
i
 = 
fLa¡U£dTrigg”Num
;

86 
Ev’tTrigg”Id
 
mask
 = 
fLa¡U£dTrigg”Mask
;

89 
i
 = (i+1)%
MAX_NUM_EVENT_TRIGGERS
;

90 
mask
 >>= 1;

91 ià(
mask
 == 0) mask = 0x80000000;

93 ià(
fTrigg”edEv’tHªdËrs
[
i
] =ğ
NULL
) {

95 
fTrigg”edEv’tHªdËrs
[
i
] = 
ev’tHªdËrProc
;

96 
fTrigg”edEv’tCl›ÁD©as
[
i
] = 
NULL
;

98 
fLa¡U£dTrigg”Mask
 = 
mask
;

99 
fLa¡U£dTrigg”Num
 = 
i
;

101  
mask
;

103 } 
i
 !ğ
fLa¡U£dTrigg”Num
);

107 
	}
}

109 
	gBasicTaskScheduËr0
::
	$d–‘eEv’tTrigg”
(
Ev’tTrigg”Id
 
ev’tTrigg”Id
) {

110 
fTrigg”sAwa™šgHªdlšg
 &=~ 
ev’tTrigg”Id
;

112 ià(
ev’tTrigg”Id
 =ğ
fLa¡U£dTrigg”Mask
) {

113 
fTrigg”edEv’tHªdËrs
[
fLa¡U£dTrigg”Num
] = 
NULL
;

114 
fTrigg”edEv’tCl›ÁD©as
[
fLa¡U£dTrigg”Num
] = 
NULL
;

118 
Ev’tTrigg”Id
 
mask
 = 0x80000000;

119 
i
 = 0; i < 
MAX_NUM_EVENT_TRIGGERS
; ++i) {

120 ià((
ev’tTrigg”Id
&
mask
) != 0) {

121 
fTrigg”edEv’tHªdËrs
[
i
] = 
NULL
;

122 
fTrigg”edEv’tCl›ÁD©as
[
i
] = 
NULL
;

124 
mask
 >>= 1;

127 
	}
}

129 
	gBasicTaskScheduËr0
::
	$Œigg”Ev’t
(
Ev’tTrigg”Id
 
ev’tTrigg”Id
, * 
ş›ÁD©a
) {

131 
Ev’tTrigg”Id
 
mask
 = 0x80000000;

132 
i
 = 0; i < 
MAX_NUM_EVENT_TRIGGERS
; ++i) {

133 ià((
ev’tTrigg”Id
&
mask
) != 0) {

134 
fTrigg”edEv’tCl›ÁD©as
[
i
] = 
ş›ÁD©a
;

136 
mask
 >>= 1;

142 
fTrigg”sAwa™šgHªdlšg
 |ğ
ev’tTrigg”Id
;

143 
	}
}

148 
	gHªdËrDesütÜ
::
	$HªdËrDesütÜ
(
HªdËrDesütÜ
* 
ÃxtHªdËr
)

149 : 
	`cÚd™iÚS‘
(0), 
	$hªdËrProc
(
NULL
) {

151 ià(
ÃxtHªdËr
 =ğ
this
) {

152 
fNextHªdËr
 = 
fP»vHªdËr
 = 
this
;

154 
fNextHªdËr
 = 
ÃxtHªdËr
;

155 
fP»vHªdËr
 = 
ÃxtHªdËr
->fPrevHandler;

156 
ÃxtHªdËr
->
fP»vHªdËr
 = 
this
;

157 
fP»vHªdËr
->
fNextHªdËr
 = 
this
;

159 
	}
}

161 
	gHªdËrDesütÜ
::~
	$HªdËrDesütÜ
() {

163 
fNextHªdËr
->
fP»vHªdËr
 = fPrevHandler;

164 
fP»vHªdËr
->
fNextHªdËr
 = fNextHandler;

165 
	}
}

167 
	gHªdËrS‘
::
	$HªdËrS‘
()

168 : 
	$fHªdËrs
(&
fHªdËrs
) {

169 
fHªdËrs
.
sock‘Num
 = -1;

170 
	}
}

172 
	gHªdËrS‘
::~
	$HªdËrS‘
() {

174 
fHªdËrs
.
fNextHªdËr
 != &fHandlers) {

175 
d–‘e
 
fHªdËrs
.
fNextHªdËr
;

177 
	}
}

179 
	gHªdËrS‘


180 ::
assignHªdËr
(
sock‘Num
, 
cÚd™iÚS‘
, 
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËrProc
, * 
ş›ÁD©a
) {

182 
HªdËrDesütÜ
* 
	ghªdËr
 = 
lookupHªdËr
(
sock‘Num
);

183 ià(
	ghªdËr
 =ğ
NULL
) {

184 
hªdËr
 = 
Ãw
 
HªdËrDesütÜ
(
fHªdËrs
.
fNextHªdËr
);

185 
	ghªdËr
->
	gsock‘Num
 = 
sock‘Num
;

188 
	ghªdËr
->
	gcÚd™iÚS‘
 = 
cÚd™iÚS‘
;

189 
	ghªdËr
->
	ghªdËrProc
 = 
hªdËrProc
;

190 
	ghªdËr
->
	gş›ÁD©a
 = 
ş›ÁD©a
;

193 
	gHªdËrS‘
::
	$ş—rHªdËr
(
sock‘Num
) {

194 
HªdËrDesütÜ
* 
hªdËr
 = 
	`lookupHªdËr
(
sock‘Num
);

195 
d–‘e
 
hªdËr
;

196 
	}
}

198 
	gHªdËrS‘
::
	$moveHªdËr
(
ŞdSock‘Num
, 
ÃwSock‘Num
) {

199 
HªdËrDesütÜ
* 
hªdËr
 = 
	`lookupHªdËr
(
ŞdSock‘Num
);

200 ià(
hªdËr
 !ğ
NULL
) {

201 
hªdËr
->
sock‘Num
 = 
ÃwSock‘Num
;

203 
	}
}

205 
HªdËrDesütÜ
* 
	gHªdËrS‘
::
	$lookupHªdËr
(
sock‘Num
) {

206 
HªdËrDesütÜ
* 
hªdËr
;

207 
HªdËrI‹¿tÜ
 
	`™”
(*
this
);

208 (
hªdËr
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

209 ià(
hªdËr
->
sock‘Num
 == socketNum) ;

211  
hªdËr
;

212 
	}
}

214 
	gHªdËrI‹¿tÜ
::
	$HªdËrI‹¿tÜ
(
HªdËrS‘
& 
hªdËrS‘
)

215 : 
	$fOurS‘
(
hªdËrS‘
) {

216 
	`»£t
();

217 
	}
}

219 
	gHªdËrI‹¿tÜ
::~
	$HªdËrI‹¿tÜ
() {

220 
	}
}

222 
HªdËrI‹¿tÜ
::
	$»£t
() {

223 
fNextPŒ
 = 
fOurS‘
.
fHªdËrs
.
fNextHªdËr
;

224 
	}
}

226 
HªdËrDesütÜ
* 
	gHªdËrI‹¿tÜ
::
	$Ãxt
() {

227 
HªdËrDesütÜ
* 
»suÉ
 = 
fNextPŒ
;

228 ià(
»suÉ
 =ğ&
fOurS‘
.
fHªdËrs
) {

229 
»suÉ
 = 
NULL
;

231 
fNextPŒ
 = fNextPŒ->
fNextHªdËr
;

234  
»suÉ
;

235 
	}
}

	@BasicUsageEnvironment/BasicUsageEnvironment.cpp

20 
	~"BasicU§geEnvœÚm’t.hh
"

21 
	~<¡dio.h
>

25 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

26 "C" 
š™ŸlizeWšsockIfNeûs§ry
();

29 
	gBasicU§geEnvœÚm’t
::
	$BasicU§geEnvœÚm’t
(
TaskScheduËr
& 
skScheduËr
)

30 : 
	$BasicU§geEnvœÚm’t0
(
skScheduËr
) {

31 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

32 ià(!
	`š™ŸlizeWšsockIfNeûs§ry
()) {

33 
	`£tResuÉE¼Msg
("Failedo initialize 'winsock': ");

34 
	`»pÜtBackgroundE¼Ü
();

35 
	`š‹º®E¼Ü
();

38 
	}
}

40 
	gBasicU§geEnvœÚm’t
::~
	$BasicU§geEnvœÚm’t
() {

41 
	}
}

43 
BasicU§geEnvœÚm’t
*

44 
BasicU§geEnvœÚm’t
::
	$ü—‹New
(
TaskScheduËr
& 
skScheduËr
) {

45  
Ãw
 
	`BasicU§geEnvœÚm’t
(
skScheduËr
);

46 
	}
}

48 
	gBasicU§geEnvœÚm’t
::
	$g‘E¼no
() const {

49 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_WIN32_WCE
)

50  
	`WSAG‘La¡E¼Ü
();

52  
”ºo
;

54 
	}
}

56 
	gU§geEnvœÚm’t
& 
	gBasicU§geEnvœÚm’t
::
İ”©Ü
<<(cÚ¡* 
¡r
) {

57 ià(
¡r
 =ğ
NULL
) str = "(NULL)";

58 
årštf
(
¡d”r
, "%s", 
¡r
);

59  *
	gthis
;

62 
	gU§geEnvœÚm’t
& 
	gBasicU§geEnvœÚm’t
::
İ”©Ü
<<(
i
) {

63 
årštf
(
¡d”r
, "%d", 
i
);

64  *
	gthis
;

67 
	gU§geEnvœÚm’t
& 
	gBasicU§geEnvœÚm’t
::
İ”©Ü
<<(
u
) {

68 
årštf
(
¡d”r
, "%u", 
u
);

69  *
	gthis
;

72 
	gU§geEnvœÚm’t
& 
	gBasicU§geEnvœÚm’t
::
İ”©Ü
<<(
d
) {

73 
årštf
(
¡d”r
, "%f", 
d
);

74  *
	gthis
;

77 
	gU§geEnvœÚm’t
& 
	gBasicU§geEnvœÚm’t
::
İ”©Ü
<<(* 
p
) {

78 
årštf
(
¡d”r
, "%p", 
p
);

79  *
	gthis
;

	@BasicUsageEnvironment/BasicUsageEnvironment0.cpp

20 
	~"BasicU§geEnvœÚm’t0.hh
"

21 
	~<¡dio.h
>

22 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_WIN32_WCE
)

23 
	#¢´štf
 
_¢´štf


	)

29 
	gBasicU§geEnvœÚm’t0
::
	$BasicU§geEnvœÚm’t0
(
TaskScheduËr
& 
skScheduËr
)

30 : 
	`U§geEnvœÚm’t
(
skScheduËr
),

31 
	$fBufãrMaxSize
(
RESULT_MSG_BUFFER_MAX
) {

32 
	`»£t
();

33 
	}
}

35 
	gBasicU§geEnvœÚm’t0
::~
	$BasicU§geEnvœÚm’t0
() {

36 
	}
}

38 
BasicU§geEnvœÚm’t0
::
	$»£t
() {

39 
fCurBufãrSize
 = 0;

40 
fResuÉMsgBufãr
[
fCurBufãrSize
] = '\0';

41 
	}
}

46 cÚ¡* 
	gBasicU§geEnvœÚm’t0
::
	$g‘ResuÉMsg
() const {

47  
fResuÉMsgBufãr
;

48 
	}
}

50 
	gBasicU§geEnvœÚm’t0
::
	$£tResuÉMsg
(
MsgSŒšg
 
msg
) {

51 
	`»£t
();

52 
	`­³ndToResuÉMsg
(
msg
);

53 
	}
}

55 
	gBasicU§geEnvœÚm’t0
::
	$£tResuÉMsg
(
MsgSŒšg
 
msg1
, MsgSŒšg 
msg2
) {

56 
	`£tResuÉMsg
(
msg1
);

57 
	`­³ndToResuÉMsg
(
msg2
);

58 
	}
}

60 
	gBasicU§geEnvœÚm’t0
::
	$£tResuÉMsg
(
MsgSŒšg
 
msg1
, MsgSŒšg 
msg2
,

61 
MsgSŒšg
 
msg3
) {

62 
	`£tResuÉMsg
(
msg1
, 
msg2
);

63 
	`­³ndToResuÉMsg
(
msg3
);

64 
	}
}

66 
	gBasicU§geEnvœÚm’t0
::
	$£tResuÉE¼Msg
(
MsgSŒšg
 
msg
, 
”r
) {

67 
	`£tResuÉMsg
(
msg
);

69 ià(
”r
 =ğ0è”¸ğ
	`g‘E¼no
();

70 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_WIN32_WCE
)

71 
”rMsg
[
RESULT_MSG_BUFFER_MAX
] = "\0";

72 ià(0 !ğ
	`FÜm©Mes§geA
(
FORMAT_MESSAGE_FROM_SYSTEM
, 
NULL
, 
”r
, 0, 
”rMsg
, (errMsg)/(errMsg[0]), NULL)) {

74 * 
p
 = 
”rMsg
 + 
	`¡¾’
(errMsg);… !=ƒrrMsg && (*p == '\r' || *p == '\n' || *p == '.' || *p == '\0'); --p) {

75 *
p
 = '\0';

78 
	`¢´štf
(
”rMsg
, Ó¼Msg)/Ó¼Msg[0]), "”rÜ %d", 
”r
);

79 
	`­³ndToResuÉMsg
(
”rMsg
);

81 
	`­³ndToResuÉMsg
(
	`¡»¼Ü
(
”r
));

83 
	}
}

88 
	gBasicU§geEnvœÚm’t0
::
	$­³ndToResuÉMsg
(
MsgSŒšg
 
msg
) {

89 * 
curPŒ
 = &
fResuÉMsgBufãr
[
fCurBufãrSize
];

90 
¥aûAvaabË
 = 
fBufãrMaxSize
 - 
fCurBufãrSize
;

91 
msgL’gth
 = 
	`¡¾’
(
msg
);

94 ià(
msgL’gth
 > 
¥aûAvaabË
-1) {

95 
msgL’gth
 = 
¥aûAvaabË
-1;

98 
	`memmove
(
curPŒ
, (*)
msg
, 
msgL’gth
);

99 
fCurBufãrSize
 +ğ
msgL’gth
;

100 
fResuÉMsgBufãr
[
fCurBufãrSize
] = '\0';

101 
	}
}

103 
	gBasicU§geEnvœÚm’t0
::
	$»pÜtBackgroundE¼Ü
() {

104 
	`åuts
(
	`g‘ResuÉMsg
(), 
¡d”r
);

105 
	}
}

	@BasicUsageEnvironment/DelayQueue.cpp

21 
	~"D–ayQueue.hh
"

22 
	~"GroupsockH–³r.hh
"

24 cÚ¡ 
	gMILLION
 = 1000000;

28 
	gTimev®
::
İ”©Ü
>=(cÚ¡ 
Timev®
& 
¬g2
) const {

29  
£cÚds
(è> 
¬g2
.seconds()

30 || (
£cÚds
(è=ğ
¬g2
.seconds()

31 && 
u£cÚds
(è>ğ
¬g2
.useconds());

34 
	gTimev®
::
İ”©Ü
+=(cÚ¡ 
D–ayIÁ”v®
& 
¬g2
) {

35 
£cs
(è+ğ
¬g2
.
£cÚds
(); 
u£cs
(è+ğ¬g2.
u£cÚds
();

36 ià(
u£cÚds
(è>ğ
MILLION
) {

37 
u£cs
(è-ğ
MILLION
;

38 ++
£cs
();

42 
	gTimev®
::
İ”©Ü
-=(cÚ¡ 
D–ayIÁ”v®
& 
¬g2
) {

43 
£cs
(è-ğ
¬g2
.
£cÚds
(); 
u£cs
(è-ğ¬g2.
u£cÚds
();

44 ià(()
u£cÚds
() < 0) {

45 
u£cs
(è+ğ
MILLION
;

46 --
£cs
();

48 ià(()
£cÚds
() < 0)

49 
£cs
(èğ
u£cs
() = 0;

53 
D–ayIÁ”v®
 
	gİ”©Ü
-(cÚ¡ 
	gTimev®
& 
	g¬g1
, cÚ¡ Timev®& 
	g¬g2
) {

54 
time_ba£_£cÚds
 
	g£cs
 = 
¬g1
.
£cÚds
(è- 
¬g2
.seconds();

55 
time_ba£_£cÚds
 
	gu£cs
 = 
¬g1
.
u£cÚds
(è- 
¬g2
.useconds();

57 ià(()
	gu£cs
 < 0) {

58 
	gu£cs
 +ğ
MILLION
;

59 --
	g£cs
;

61 ià(()
	g£cs
 < 0)

62  
	gDELAY_ZERO
;

64  
D–ayIÁ”v®
(
£cs
, 
u£cs
);

70 
D–ayIÁ”v®
 
	gİ”©Ü
*(
	g¬g1
, cÚ¡ 
	gD–ayIÁ”v®
& 
	g¬g2
) {

71 
time_ba£_£cÚds
 
	g»suÉ_£cÚds
 = 
¬g1
*
¬g2
.
£cÚds
();

72 
time_ba£_£cÚds
 
	g»suÉ_u£cÚds
 = 
¬g1
*
¬g2
.
u£cÚds
();

74 
time_ba£_£cÚds
 
	gÿ¼y
 = 
»suÉ_u£cÚds
/
MILLION
;

75 
	g»suÉ_u£cÚds
 -ğ
ÿ¼y
*
MILLION
;

76 
	g»suÉ_£cÚds
 +ğ
ÿ¼y
;

78  
D–ayIÁ”v®
(
»suÉ_£cÚds
, 
»suÉ_u£cÚds
);

81 #iâdeà
INT_MAX


82 
	#INT_MAX
 0x7FFFFFFF

	)

84 cÚ¡ 
D–ayIÁ”v®
 
DELAY_ZERO
(0, 0);

85 cÚ¡ 
D–ayIÁ”v®
 
DELAY_SECOND
(1, 0);

86 cÚ¡ 
D–ayIÁ”v®
 
	gDELAY_MINUTE
 = 60*
DELAY_SECOND
;

87 cÚ¡ 
D–ayIÁ”v®
 
	gDELAY_HOUR
 = 60*
DELAY_MINUTE
;

88 cÚ¡ 
D–ayIÁ”v®
 
	gDELAY_DAY
 = 24*
DELAY_HOUR
;

89 cÚ¡ 
D–ayIÁ”v®
 
ETERNITY
(
INT_MAX
, 
MILLION
-1);

95 
šŒ_t
 
	gD–ayQueueEÁry
::
tok’CouÁ”
 = 0;

97 
	gD–ayQueueEÁry
::
	$D–ayQueueEÁry
(
D–ayIÁ”v®
 
d–ay
)

98 : 
	$fD–TimeRemaššg
(
d–ay
) {

99 
fNext
 = 
fP»v
 = 
this
;

100 
fTok’
 = ++
tok’CouÁ”
;

101 
	}
}

103 
	gD–ayQueueEÁry
::~
	$D–ayQueueEÁry
() {

104 
	}
}

106 
D–ayQueueEÁry
::
	$hªdËTimeout
() {

107 
d–‘e
 
this
;

108 
	}
}

113 
	gD–ayQueue
::
	$D–ayQueue
()

114 : 
	$D–ayQueueEÁry
(
ETERNITY
) {

115 
fLa¡SyncTime
 = 
	`TimeNow
();

116 
	}
}

118 
	gD–ayQueue
::~
	$D–ayQueue
() {

119 
fNext
 !ğ
this
) {

120 
D–ayQueueEÁry
* 
’ŒyToRemove
 = 
fNext
;

121 
	`»moveEÁry
(
’ŒyToRemove
);

122 
d–‘e
 
’ŒyToRemove
;

124 
	}
}

126 
	gD–ayQueue
::
	$addEÁry
(
D–ayQueueEÁry
* 
ÃwEÁry
) {

127 
	`synchrÚize
();

129 
D–ayQueueEÁry
* 
cur
 = 
	`h—d
();

130 
ÃwEÁry
->
fD–TimeRemaššg
 >ğ
cur
->fDeltaTimeRemaining) {

131 
ÃwEÁry
->
fD–TimeRemaššg
 -ğ
cur
->fDeltaTimeRemaining;

132 
cur
 = cur->
fNext
;

135 
cur
->
fD–TimeRemaššg
 -ğ
ÃwEÁry
->fDeltaTimeRemaining;

138 
ÃwEÁry
->
fNext
 = 
cur
;

139 
ÃwEÁry
->
fP»v
 = 
cur
->fPrev;

140 
cur
->
fP»v
 = 
ÃwEÁry
->fP»v->
fNext
 =‚ewEntry;

141 
	}
}

143 
	gD–ayQueue
::
	$upd©eEÁry
(
D–ayQueueEÁry
* 
’Œy
, 
D–ayIÁ”v®
 
ÃwD–ay
) {

144 ià(
’Œy
 =ğ
NULL
) ;

146 
	`»moveEÁry
(
’Œy
);

147 
’Œy
->
fD–TimeRemaššg
 = 
ÃwD–ay
;

148 
	`addEÁry
(
’Œy
);

149 
	}
}

151 
	gD–ayQueue
::
	$upd©eEÁry
(
šŒ_t
 
tok’ToFšd
, 
D–ayIÁ”v®
 
ÃwD–ay
) {

152 
D–ayQueueEÁry
* 
’Œy
 = 
	`fšdEÁryByTok’
(
tok’ToFšd
);

153 
	`upd©eEÁry
(
’Œy
, 
ÃwD–ay
);

154 
	}
}

156 
	gD–ayQueue
::
	$»moveEÁry
(
D–ayQueueEÁry
* 
’Œy
) {

157 ià(
’Œy
 =ğ
NULL
 ||ƒÁry->
fNext
 == NULL) ;

159 
’Œy
->
fNext
->
fD–TimeRemaššg
 +=ƒntry->fDeltaTimeRemaining;

160 
’Œy
->
fP»v
->
fNext
 =ƒntry->fNext;

161 
’Œy
->
fNext
->
fP»v
 =ƒntry->fPrev;

162 
’Œy
->
fNext
 =ƒÁry->
fP»v
 = 
NULL
;

164 
	}
}

166 
D–ayQueueEÁry
* 
	gD–ayQueue
::
	$»moveEÁry
(
šŒ_t
 
tok’ToFšd
) {

167 
D–ayQueueEÁry
* 
’Œy
 = 
	`fšdEÁryByTok’
(
tok’ToFšd
);

168 
	`»moveEÁry
(
’Œy
);

169  
’Œy
;

170 
	}
}

172 
D–ayIÁ”v®
 cÚ¡& 
	gD–ayQueue
::
	$timeToNextAÏrm
() {

173 ià(
	`h—d
()->
fD–TimeRemaššg
 =ğ
DELAY_ZERO
)  DELAY_ZERO;

175 
	`synchrÚize
();

176  
	`h—d
()->
fD–TimeRemaššg
;

177 
	}
}

179 
	gD–ayQueue
::
	$hªdËAÏrm
() {

180 ià(
	`h—d
()->
fD–TimeRemaššg
 !ğ
DELAY_ZERO
è
	`synchrÚize
();

182 ià(
	`h—d
()->
fD–TimeRemaššg
 =ğ
DELAY_ZERO
) {

184 
D–ayQueueEÁry
* 
toRemove
 = 
	`h—d
();

185 
	`»moveEÁry
(
toRemove
);

187 
toRemove
->
	`hªdËTimeout
();

189 
	}
}

191 
D–ayQueueEÁry
* 
	gD–ayQueue
::
	$fšdEÁryByTok’
(
šŒ_t
 
tok’ToFšd
) {

192 
D–ayQueueEÁry
* 
cur
 = 
	`h—d
();

193 
cur
 !ğ
this
) {

194 ià(
cur
->
	`tok’
(è=ğ
tok’ToFšd
)  cur;

195 
cur
 = cur->
fNext
;

198  
NULL
;

199 
	}
}

201 
	gD–ayQueue
::
	$synchrÚize
() {

203 
_Ev’tTime
 
timeNow
 = 
	`TimeNow
();

204 ià(
timeNow
 < 
fLa¡SyncTime
) {

206 
fLa¡SyncTime
 = 
timeNow
;

209 
D–ayIÁ”v®
 
timeSšûLa¡Sync
 = 
timeNow
 - 
fLa¡SyncTime
;

210 
fLa¡SyncTime
 = 
timeNow
;

213 
D–ayQueueEÁry
* 
curEÁry
 = 
	`h—d
();

214 
timeSšûLa¡Sync
 >ğ
curEÁry
->
fD–TimeRemaššg
) {

215 
timeSšûLa¡Sync
 -ğ
curEÁry
->
fD–TimeRemaššg
;

216 
curEÁry
->
fD–TimeRemaššg
 = 
DELAY_ZERO
;

217 
curEÁry
 = curEÁry->
fNext
;

219 
curEÁry
->
fD–TimeRemaššg
 -ğ
timeSšûLa¡Sync
;

220 
	}
}

225 
_Ev’tTime
 
	$TimeNow
() {

226 
timev®
 
tvNow
;

228 
	`g‘timeofday
(&
tvNow
, 
NULL
);

230  
	`_Ev’tTime
(
tvNow
.
tv_£c
,vNow.
tv_u£c
);

231 
	}
}

233 cÚ¡ 
_Ev’tTime
 
THE_END_OF_TIME
(
INT_MAX
);

	@UsageEnvironment/HashTable.cpp

20 
	~"HashTabË.hh
"

22 
	gHashTabË
::
	$HashTabË
() {

23 
	}
}

25 
HashTabË
::~
	$HashTabË
() {

26 
	}
}

28 
HashTabË
::
I‹¿tÜ
::
	$I‹¿tÜ
() {

29 
	}
}

31 
HashTabË
::
I‹¿tÜ
::~
	$I‹¿tÜ
(è{
	}
}

33 * 
HashTabË
::
	$RemoveNext
() {

34 
I‹¿tÜ
* 
™”
 = I‹¿tÜ::
	`ü—‹
(*
this
);

35 cÚ¡* 
key
;

36 * 
»movedV®ue
 = 
™”
->
	`Ãxt
(
key
);

37 ià(
»movedV®ue
 !ğ0è
	`Remove
(
key
);

39 
d–‘e
 
™”
;

40  
»movedV®ue
;

41 
	}
}

43 * 
	gHashTabË
::
	$g‘Fœ¡
() {

44 
I‹¿tÜ
* 
™”
 = I‹¿tÜ::
	`ü—‹
(*
this
);

45 cÚ¡* 
key
;

46 * 
fœ¡V®ue
 = 
™”
->
	`Ãxt
(
key
);

48 
d–‘e
 
™”
;

49  
fœ¡V®ue
;

50 
	}
}

	@UsageEnvironment/UsageEnvironment.cpp

20 
	~"U§geEnvœÚm’t.hh
"

22 
BoŞ—n
 
	gU§geEnvœÚm’t
::
	$»şaim
() {

24 ià(
liveMedŸPriv
 =ğ
NULL
 && 
groupsockPriv
 == NULL) {

25 
d–‘e
 
this
;

26  
True
;

29  
F®£
;

30 
	}
}

32 
	gU§geEnvœÚm’t
::
	$U§geEnvœÚm’t
(
TaskScheduËr
& 
scheduËr
)

33 : 
	`liveMedŸPriv
(
NULL
), 
	`groupsockPriv
(NULL), 
	$fScheduËr
(
scheduËr
) {

34 
	}
}

36 
	gU§geEnvœÚm’t
::~
	$U§geEnvœÚm’t
() {

37 
	}
}

41 
U§geEnvœÚm’t
::
	$š‹º®E¼Ü
() {

42 
	`abÜt
();

43 
	}
}

46 
	gTaskScheduËr
::
	$TaskScheduËr
() {

47 
	}
}

49 
TaskScheduËr
::~
	$TaskScheduËr
() {

50 
	}
}

52 
TaskScheduËr
::
	$»scheduËD–ayedTask
(
TaskTok’
& 
sk
,

53 
št64_t
 
miüo£cÚds
, 
TaskFunc
* 
´oc
,

54 * 
ş›ÁD©a
) {

55 
	`unscheduËD–ayedTask
(
sk
);

56 
sk
 = 
	`scheduËD–ayedTask
(
miüo£cÚds
, 
´oc
, 
ş›ÁD©a
);

57 
	}
}

60 
	gTaskScheduËr
::
	$š‹º®E¼Ü
() {

61 
	`abÜt
();

62 
	}
}

	@UsageEnvironment/strDup.cpp

21 
	~"¡rDup.hh
"

23 * 
	$¡rDup
(cÚ¡* 
¡r
) {

24 ià(
¡r
 =ğ
NULL
)  NULL;

25 
size_t
 
Ën
 = 
	`¡¾’
(
¡r
) + 1;

26 * 
cİy
 = 
Ãw
 [
Ën
];

28 ià(
cİy
 !ğ
NULL
) {

29 
	`memıy
(
cİy
, 
¡r
, 
Ën
);

31  
cİy
;

32 
	}
}

34 * 
	$¡rDupSize
(cÚ¡* 
¡r
) {

35 
size_t
 
dummy
;

37  
	`¡rDupSize
(
¡r
, 
dummy
);

38 
	}
}

40 * 
	$¡rDupSize
(cÚ¡* 
¡r
, 
size_t
& 
»suÉBufSize
) {

41 ià(
¡r
 =ğ
NULL
) {

42 
»suÉBufSize
 = 0;

43  
NULL
;

46 
»suÉBufSize
 = 
	`¡¾’
(
¡r
) + 1;

47 * 
cİy
 = 
Ãw
 [
»suÉBufSize
];

49  
cİy
;

50 
	}
}

	@WindowsAudioInputDevice/WindowsAudioInputDevice_common.cpp

22 
	~"WšdowsAudioIÅutDeviû_commÚ.hh
"

23 
	~<GroupsockH–³r.hh
>

27 
	gWšdowsAudioIÅutDeviû_commÚ
::
_b™sP”Sam¶e
 = 16;

29 
	gWšdowsAudioIÅutDeviû_commÚ


30 ::
	$WšdowsAudioIÅutDeviû_commÚ
(
U§geEnvœÚm’t
& 
’v
, 
šputPÜtNumb”
,

31 
b™sP”Sam¶e
,

32 
numChªÃls
,

33 
§m¶šgF»qu’cy
,

34 
g¿nuÏr™yInMS
)

35 : 
	`AudioIÅutDeviû
(
’v
, 
b™sP”Sam¶e
, 
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
),

36 
	`fCurPÜtIndex
(-1), 
	$fHaveS¹ed
(
F®£
) {

37 
_b™sP”Sam¶e
 = 
b™sP”Sam¶e
;

38 
	}
}

40 
	gWšdowsAudioIÅutDeviû_commÚ
::~
	$WšdowsAudioIÅutDeviû_commÚ
() {

41 
	}
}

43 
BoŞ—n
 
WšdowsAudioIÅutDeviû_commÚ
::
	$š™ŸlS‘IÅutPÜt
(
pÜtIndex
) {

44 ià(!
	`£tIÅutPÜt
(
pÜtIndex
)) {

45 
”rMsgP»fix
[100];

46 
	`¥rštf
(
”rMsgP»fix
, "FaedØ£ˆaudiØšpuˆpÜˆnumb”Ø%d: ", 
pÜtIndex
);

47 * 
”rMsgSuffix
 = 
	`¡rDup
(
	`’vœ
().
	`g‘ResuÉMsg
());

48 
	`’vœ
().
	`£tResuÉMsg
(
”rMsgP»fix
, 
”rMsgSuffix
);

49 
d–‘e
[] 
”rMsgSuffix
;

50  
F®£
;

52  
True
;

54 
	}
}

56 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$doG‘NextF¿me
() {

57 ià(!
fHaveS¹ed
) {

59 
»adH—d
 !ğ
NULL
è
	`»Ëa£H—dBufãr
();

60 
fHaveS¹ed
 = 
True
;

62 
fTÙ®PŞlšgD–ay
 = 0;

63 
	`audioR—dyPŞËr1
();

64 
	}
}

66 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$doStİG‘tšgF¿mes
() {

68 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());‚extTask(èğ
NULL
;

69 
	}
}

71 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$g‘Av”ageLev–
() const {

74 ià(
»adH—d
 !ğ
NULL
) {

75 
Ëv–TÙ®
 = 0.0;

76 
tÙNumSam¶es
 = 0;

77 
WAVEHDR
* 
curHdr
 = 
»adH—d
;

79 * 
§m¶ePŒ
 = (*)(
curHdr
->
ÍD©a
);

80 
numSam¶es
 = 
blockSize
/2;

81 
tÙNumSam¶es
 +ğ
numSam¶es
;

83 
numSam¶es
-- > 0) {

84 
§m¶e
 = *
§m¶ePŒ
++;

85 ià(
§m¶e
 < 0) sample = -sample;

86 
Ëv–TÙ®
 +ğ()
§m¶e
;

89 ià(
curHdr
 =ğ
»adTa
) ;

90 
curHdr
 = curHdr->
ÍNext
;

92 
av”ageLev–
 = 
Ëv–TÙ®
/(
tÙNumSam¶es
*()0x8000);

94  
av”ageLev–
;

95 
	}
}

97 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$audioR—dyPŞËr
(* 
ş›ÁD©a
) {

98 
WšdowsAudioIÅutDeviû_commÚ
* 
šputDeviû
 = (WšdowsAudioIÅutDeviû_commÚ*)
ş›ÁD©a
;

99 
šputDeviû
->
	`audioR—dyPŞËr1
();

100 
	}
}

102 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$audioR—dyPŞËr1
() {

103 ià(
»adH—d
 !ğ
NULL
) {

104 
	`ÚûAudioIsR—dy
();

106 cÚ¡ 
maxPŞlšgD–ay
 = (100 + 
fG¿nuÏr™yInMS
)*1000;

107 ià(
fTÙ®PŞlšgD–ay
 > 
maxPŞlšgD–ay
) {

109 
	`hªdËClosu»
(
this
);

114 cÚ¡ 
uSecÚdsToD–ay
 = 
fG¿nuÏr™yInMS
*1000;

115 
fTÙ®PŞlšgD–ay
 +ğ
uSecÚdsToD–ay
;

116 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecÚdsToD–ay
,

117 (
TaskFunc
*)
audioR—dyPŞËr
, 
this
);

119 
	}
}

121 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$ÚûAudioIsR—dy
() {

122 
fF¿meSize
 = 
	`»adFromBufãrs
(
fTo
, 
fMaxSize
, 
fP»£Á©iÚTime
);

123 ià(
fF¿meSize
 == 0) {

125 
	`hªdËClosu»
(
this
);

128 
fDu¿tiÚInMiüo£cÚds
 = 1000000/
fSam¶šgF»qu’cy
;

133 
	`aá”G‘tšg
(
this
);

134 
	}
}

136 
CALLBACK
 
	$waveInC®lback
(
HWAVEIN
 , 
UINT
 
uMsg
,

137 
DWORD
 , DWORD 
dwP¬am1
, DWORD ) {

138 
uMsg
) {

139 
WIM_DATA
:

140 
WAVEHDR
* 
hdr
 = (WAVEHDR*)
dwP¬am1
;

141 
WšdowsAudioIÅutDeviû_commÚ
::
	`waveInProc
(
hdr
);

144 
	}
}

146 
BoŞ—n
 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$İ’WavInPÜt
(
šdex
, 
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
) {

147 
uSecsP”By‹
 = (8*1e6)/(
_b™sP”Sam¶e
*
numChªÃls
*
§m¶šgF»qu’cy
);

150 
WAVEFORMATEX
 
wfx
;

151 
wfx
.
wFÜm©Tag
 = 
WAVE_FORMAT_PCM
;

152 
wfx
.
nChªÃls
 = 
numChªÃls
;

153 
wfx
.
nSam¶esP”Sec
 = 
§m¶šgF»qu’cy
;

154 
wfx
.
wB™sP”Sam¶e
 = 
_b™sP”Sam¶e
;

155 
wfx
.
nBlockAlign
 = (
numChªÃls
*
_b™sP”Sam¶e
)/8;

156 
wfx
.
nAvgBy‹sP”Sec
 = 
§m¶šgF»qu’cy
*wfx.
nBlockAlign
;

157 
wfx
.
cbSize
 = 0;

159 
blockSize
 = (
wfx
.
nAvgBy‹sP”Sec
*
g¿nuÏr™yInMS
)/1000;

163 cÚ¡ 
bufãrSecÚds
 = 10;

164 
numBlocks
 = (
bufãrSecÚds
*1000)/
g¿nuÏr™yInMS
;

166 ià(!
	`waveIn_İ’
(
šdex
, 
wfx
)è 
F®£
;

170 
	`S‘PriÜ™yCÏss
(
	`G‘Cu¼’tProûss
(), 
HIGH_PRIORITY_CLASS
);

171  
True
;

172 
	}
}

174 
BoŞ—n
 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$waveIn_İ’
(
uid
, 
WAVEFORMATEX
& 
wfx
) {

175 ià(
shWaveIn
 !ğ
NULL
è 
True
;

178 
	`waveIn_»£t
();

179 ià(
	`waveInO³n
(&
shWaveIn
, 
uid
, &
wfx
,

180 (
DWORD
)
waveInC®lback
, 0, 
CALLBACK_FUNCTION
è!ğ
MMSYSERR_NOERROR
) ;

183 
»adD©a
 = 
Ãw
 [
numBlocks
*
blockSize
];

184 ià(
»adD©a
 =ğ
NULL
) ;

186 
»adHdrs
 = 
Ãw
 
WAVEHDR
[
numBlocks
];

187 ià(
»adHdrs
 =ğ
NULL
) ;

188 
»adH—d
 = 
»adTa
 = 
NULL
;

190 
»adTimes
 = 
Ãw
 
timev®
[
numBlocks
];

191 ià(
»adTimes
 =ğ
NULL
) ;

194 
i
 = 0; i < 
numBlocks
; ++i) {

195 
»adHdrs
[
i
].
ÍD©a
 = (*)&
»adD©a
[i*
blockSize
];

196 
»adHdrs
[
i
].
dwBufãrL’gth
 = 
blockSize
;

197 
»adHdrs
[
i
].
dwFÏgs
 = 0;

198 ià(
	`waveInP»·»H—d”
(
shWaveIn
, &
»adHdrs
[
i
],  (
WAVEHDR
)è!ğ
MMSYSERR_NOERROR
) ;

199 ià(
	`waveInAddBufãr
(
shWaveIn
, &
»adHdrs
[
i
],  (
WAVEHDR
)è!ğ
MMSYSERR_NOERROR
) ;

202 ià(
	`waveInS¹
(
shWaveIn
è!ğ
MMSYSERR_NOERROR
) ;

204 #ifdeà
UNICODE


205 
hAudioR—dy
 = 
	`C»©eEv’t
(
NULL
, 
TRUE
, 
FALSE
, 
L
"waveIn Audio Ready");

207 
hAudioR—dy
 = 
	`C»©eEv’t
(
NULL
, 
TRUE
, 
FALSE
, "waveIn Audio Ready");

209  
True
;

212 
	`waveIn_»£t
();

213  
F®£
;

214 
	}
}

216 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$waveIn_şo£
() {

217 ià(
shWaveIn
 =ğ
NULL
) ;

219 
	`waveInStİ
(
shWaveIn
);

220 
	`waveInRe£t
(
shWaveIn
);

222 
i
 = 0; i < 
numBlocks
; ++i) {

223 ià(
»adHdrs
[
i
].
dwFÏgs
 & 
WHDR_PREPARED
) {

224 
	`waveInUÅ»·»H—d”
(
shWaveIn
, &
»adHdrs
[
i
],  (
WAVEHDR
));

228 
	`waveInClo£
(
shWaveIn
);

229 
	`waveIn_»£t
();

230 
	}
}

232 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$waveIn_»£t
() {

233 
shWaveIn
 = 
NULL
;

235 
d–‘e
[] 
»adD©a
;„—dD©¨ğ
NULL
;

236 
by‹sU£dAtR—dH—d
 = 0;

238 
d–‘e
[] 
»adHdrs
;„—dHdr ğ
NULL
;

239 
»adH—d
 = 
»adTa
 = 
NULL
;

241 
d–‘e
[] 
»adTimes
;„—dTime ğ
NULL
;

243 
hAudioR—dy
 = 
NULL
;

244 
	}
}

246 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$»adFromBufãrs
(* 
to
, 
numBy‹sWª‹d
, 
timev®
& 
ü—tiÚTime
) {

248 ià(
»adH—d
 !ğ
NULL
) {

249 
hdrIndex
 = 
»adH—d
 - 
»adHdrs
;

250 
ü—tiÚTime
 = 
»adTimes
[
hdrIndex
];

253 ià(
by‹sU£dAtR—dH—d
 > 0) {

254 
ü—tiÚTime
.
tv_u£c
 +ğ()(
uSecsP”By‹
*
by‹sU£dAtR—dH—d
);

255 
ü—tiÚTime
.
tv_£c
 +ğü—tiÚTime.
tv_u£c
/1000000;

256 
ü—tiÚTime
.
tv_u£c
 %= 1000000;

261 
numBy‹sR—d
 = 0;

262 
»adH—d
 !ğ
NULL
 && 
numBy‹sR—d
 < 
numBy‹sWª‹d
) {

263 
thisR—d
 = 
	`mš
(
»adH—d
->
dwBy‹sRecÜded
 - 
by‹sU£dAtR—dH—d
, 
numBy‹sWª‹d
 - 
numBy‹sR—d
);

264 
	`memmove
(&
to
[
numBy‹sR—d
], &
»adH—d
->
ÍD©a
[
by‹sU£dAtR—dH—d
], 
thisR—d
);

265 
numBy‹sR—d
 +ğ
thisR—d
;

266 
by‹sU£dAtR—dH—d
 +ğ
thisR—d
;

267 ià(
by‹sU£dAtR—dH—d
 =ğ
»adH—d
->
dwBy‹sRecÜded
) {

269 
	`»Ëa£H—dBufãr
();

273  
numBy‹sR—d
;

274 
	}
}

276 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$»Ëa£H—dBufãr
() {

277 
WAVEHDR
* 
toR–—£
 = 
»adH—d
;

278 ià(
»adH—d
 =ğ
NULL
) ;

280 
»adH—d
 =„—dH—d->
ÍNext
;

281 ià(
»adH—d
 =ğ
NULL
è
»adTa
 = NULL;

283 
toR–—£
->
ÍNext
 = 
NULL
;

284 
toR–—£
->
dwBy‹sRecÜded
 = 0;

285 
toR–—£
->
dwFÏgs
 &ğ~
WHDR_DONE
;

286 
	`waveInAddBufãr
(
shWaveIn
, 
toR–—£
,  (
WAVEHDR
));

287 
by‹sU£dAtR—dH—d
 = 0;

288 
	}
}

290 
	gWšdowsAudioIÅutDeviû_commÚ
::
	$waveInProc
(
WAVEHDR
* 
hdr
) {

291 
hdrIndex
 = 
hdr
 - 
»adHdrs
;

294 
dÚtC¬e
;

295 
	`g‘timeofday
(&
»adTimes
[
hdrIndex
], &
dÚtC¬e
);

298 
hdr
->
ÍNext
 = 
NULL
;

299 ià(
»adTa
 !ğ
NULL
) {

300 
»adTa
->
ÍNext
 = 
hdr
;

301 
»adTa
 = 
hdr
;

303 
»adH—d
 = 
»adTa
 = 
hdr
;

305 
	`S‘Ev’t
(
hAudioR—dy
);

306 
	}
}

308 
HWAVEIN
 
	gWšdowsAudioIÅutDeviû_commÚ
::
shWaveIn
 = 
NULL
;

310 
	gWšdowsAudioIÅutDeviû_commÚ
::
blockSize
 = 0;

311 
	gWšdowsAudioIÅutDeviû_commÚ
::
numBlocks
 = 0;

313 * 
	gWšdowsAudioIÅutDeviû_commÚ
::
»adD©a
 = 
NULL
;

314 
DWORD
 
	gWšdowsAudioIÅutDeviû_commÚ
::
by‹sU£dAtR—dH—d
 = 0;

315 
	gWšdowsAudioIÅutDeviû_commÚ
::
uSecsP”By‹
 = 0.0;

316 
	gWšdowsAudioIÅutDeviû_commÚ
::
av”ageLev–
 = 0.0;

318 
WAVEHDR
* 
	gWšdowsAudioIÅutDeviû_commÚ
::
»adHdrs
 = 
NULL
;

319 
WAVEHDR
* 
	gWšdowsAudioIÅutDeviû_commÚ
::
»adH—d
 = 
NULL
;

320 
WAVEHDR
* 
	gWšdowsAudioIÅutDeviû_commÚ
::
»adTa
 = 
NULL
;

322 
timev®
* 
	gWšdowsAudioIÅutDeviû_commÚ
::
»adTimes
 = 
NULL
;

324 
HANDLE
 
	gWšdowsAudioIÅutDeviû_commÚ
::
hAudioR—dy
 = 
NULL
;

	@WindowsAudioInputDevice/WindowsAudioInputDevice_mixer.cpp

21 
	~<WšdowsAudioIÅutDeviû_mix”.hh
>

25 şas 
	cAudioIÅutPÜt
 {

26 
	mpublic
:

27 
g
;

28 
DWORD
 
	mdwCompÚ’tTy³
;

29 
	mÇme
[
MIXER_LONG_NAME_CHARS
];

32 şas 
	cMix”
 {

33 
	mpublic
:

34 
Mix”
();

35 
	mvœtu®
 ~
Mix”
();

37 
İ’
(
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
);

38 
İ’
();

39 
g‘PÜtsInfo
();

40 
BoŞ—n
 
’abËIÅutPÜt
(
pÜtIndex
, cÚ¡*& 
”rR—sÚ
, 
MMRESULT
& 
”rCode
);

41 
şo£
();

43 
	mšdex
;

44 
HMIXER
 
	mhMix”
;

45 
DWORD
 
	mdwRecLšeID
;

46 
	mnumPÜts
;

47 
AudioIÅutPÜt
* 
	mpÜts
;

48 
	mÇme
[
MAXPNAMELEN
];

54 
AudioIÅutDeviû
*

55 
	gAudioIÅutDeviû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
šputPÜtNumb”
,

56 
b™sP”Sam¶e
,

57 
numChªÃls
,

58 
§m¶šgF»qu’cy
,

59 
g¿nuÏr™yInMS
) {

60 
BoŞ—n
 
sucûss
;

61 
WšdowsAudioIÅutDeviû
* 
ÃwSourû


62 ğ
Ãw
 
	`WšdowsAudioIÅutDeviû
(
’v
, 
šputPÜtNumb”
,

63 
b™sP”Sam¶e
, 
numChªÃls
,

64 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
,

65 
sucûss
);

66 ià(!
sucûss
è{
d–‘e
 
ÃwSourû
;‚ewSourû = 
NULL
;}

68  
ÃwSourû
;

69 
	}
}

71 
AudioPÜtNames
* 
	gAudioIÅutDeviû
::
	$g‘PÜtNames
() {

72 
WšdowsAudioIÅutDeviû
::
	`š™ŸlizeIfNeûs§ry
();

74 
AudioPÜtNames
* 
pÜtNames
 = 
Ãw
 AudioPortNames;

75 
pÜtNames
->
numPÜts
 = 
WšdowsAudioIÅutDeviû
::
numIÅutPÜtsTÙ®
;

76 
pÜtNames
->
pÜtName
 = 
Ãw
 *[
WšdowsAudioIÅutDeviû
::
numIÅutPÜtsTÙ®
];

81 
pÜtNameBufãr
[2*
MAXPNAMELEN
+10 ];

82 
mix”NameBufãr
[
MAXPNAMELEN
];

83 cÚ¡* 
pÜtNameFmt
;

84 ià(
WšdowsAudioIÅutDeviû
::
numMix”s
 <= 1) {

85 
pÜtNameFmt
 = "%s";

87 
pÜtNameFmt
 = "%s (%s)";

90 
curPÜtNum
 = 0;

91 
i
 = 0; i < 
WšdowsAudioIÅutDeviû
::
numMix”s
; ++i) {

92 
Mix”
& 
mix”
 = 
WšdowsAudioIÅutDeviû
::
ourMix”s
[
i
];

94 ià(
WšdowsAudioIÅutDeviû
::
numMix”s
 <= 1) {

95 
mix”NameBufãr
[0] = '\0';

97 
	`¡ºıy
(
mix”NameBufãr
, 
mix”
.
Çme
,  mixerNameBuffer);

100 
k
 = 0; k <  
mix”NameBufãr
 && mixerNameBuffer[k] != '\0'; ++k) {

101 ià(
mix”NameBufãr
[
k
] == ' ') {

102 
mix”NameBufãr
[
k
] = '\0';

109 
j
 = 0; j < 
mix”
.
numPÜts
; ++j) {

110 
	`¥rštf
(
pÜtNameBufãr
, 
pÜtNameFmt
, 
mix”
.
pÜts
[
j
].
Çme
, 
mix”NameBufãr
);

111 
pÜtNames
->
pÜtName
[
curPÜtNum
++] = 
	`¡rDup
(
pÜtNameBufãr
);

115  
pÜtNames
;

116 
	}
}

121 
	gWšdowsAudioIÅutDeviû


122 ::
	$WšdowsAudioIÅutDeviû
(
U§geEnvœÚm’t
& 
’v
, 
šputPÜtNumb”
,

123 
b™sP”Sam¶e
,

124 
numChªÃls
,

125 
§m¶šgF»qu’cy
,

126 
g¿nuÏr™yInMS
,

127 
BoŞ—n
& 
sucûss
)

128 : 
	`WšdowsAudioIÅutDeviû_commÚ
(
’v
, 
šputPÜtNumb”
,

129 
b™sP”Sam¶e
, 
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
),

130 
	`fCurMix”Id
(-1) {

131 
sucûss
 = 
	`š™ŸlS‘IÅutPÜt
(
šputPÜtNumb”
);

132 
	}
}

134 
	gWšdowsAudioIÅutDeviû
::~
	$WšdowsAudioIÅutDeviû
() {

135 ià(
fCurMix”Id
 >ğ0è
ourMix”s
[fCurMix”Id].
	`şo£
();

137 
d–‘e
[] 
ourMix”s
; ourMix” ğ
NULL
;

138 
numMix”s
 = 
numIÅutPÜtsTÙ®
 = 0;

139 
	}
}

141 
	gWšdowsAudioIÅutDeviû
::
	$š™ŸlizeIfNeûs§ry
() {

142 ià(
ourMix”s
 !ğ
NULL
) ;

143 
numMix”s
 = 
	`mix”G‘NumDevs
();

144 
ourMix”s
 = 
Ãw
 
Mix”
[
numMix”s
];

147 
numIÅutPÜtsTÙ®
 = 0;

148 
i
 = 0; i < 
numMix”s
; ++i) {

149 
Mix”
& 
mix”
 = 
ourMix”s
[
i
];

150 
mix”
.
šdex
 = 
i
;

151 
mix”
.
	`İ’
();

152 ià(
mix”
.
hMix”
 !ğ
NULL
) {

154 
mix”
.
	`g‘PÜtsInfo
();

155 
mix”
.
	`şo£
();

157 ià(
mix”
.
numPÜts
 == 0) ;

159 
numIÅutPÜtsTÙ®
 +ğ
mix”
.
numPÜts
;

161 
mix”
.
pÜts
 = 
NULL
;

162 
mix”
.
numPÜts
 = 0;

165 
	}
}

167 
BoŞ—n
 
	gWšdowsAudioIÅutDeviû
::
	$£tIÅutPÜt
(
pÜtIndex
) {

168 
	`š™ŸlizeIfNeûs§ry
();

170 ià(
pÜtIndex
 < 0 ||…ÜtIndex >ğ()
numIÅutPÜtsTÙ®
) {

171 
	`’vœ
().
	`£tResuÉMsg
("Bad input…ort index\n");

172  
F®£
;

176 
ÃwMix”Id
, 
pÜtW™hšMix”
, 
pÜtIndexCouÁ
 = 0;

177 
ÃwMix”Id
 = 0;‚ewMix”Id < ()
numMix”s
; ++newMixerId) {

178 
´evPÜtIndexCouÁ
 = 
pÜtIndexCouÁ
;

179 
pÜtIndexCouÁ
 +ğ
ourMix”s
[
ÃwMix”Id
].
numPÜts
;

180 ià(
pÜtIndexCouÁ
 > 
pÜtIndex
) {

181 
pÜtW™hšMix”
 = 
pÜtIndex
 - 
´evPÜtIndexCouÁ
;

187 ià(
®lowedDeviûNames
 !ğ
NULL
) {

188 
i
;

189 
i
 = 0; 
®lowedDeviûNames
[i] !ğ
NULL
; ++i) {

190 ià(
	`¡ºcmp
(
ourMix”s
[
ÃwMix”Id
].
Çme
, 
®lowedDeviûNames
[
i
],

191 
	`¡¾’
(
®lowedDeviûNames
[
i
])) == 0) {

196 ià(
®lowedDeviûNames
[
i
] =ğ
NULL
) {

197 
	`’vœ
().
	`£tResuÉMsg
("Accessohis‡udio device is‚ot‡llowed\n");

198  
F®£
;

202 ià(
ÃwMix”Id
 !ğ
fCurMix”Id
) {

204 ià(
fCurMix”Id
 >ğ0è
ourMix”s
[fCurMix”Id].
	`şo£
();

205 
fCurMix”Id
 = 
ÃwMix”Id
;

206 
ourMix”s
[
fCurMix”Id
].
	`İ’
(
fNumChªÃls
, 
fSam¶šgF»qu’cy
, 
fG¿nuÏr™yInMS
);

208 ià(
pÜtIndex
 !ğ
fCurPÜtIndex
) {

210 
fCurPÜtIndex
 = 
pÜtIndex
;

211 cÚ¡* 
”rR—sÚ
;

212 
MMRESULT
 
”rCode
;

213 ià(!
ourMix”s
[
ÃwMix”Id
].
	`’abËIÅutPÜt
(
pÜtW™hšMix”
, 
”rR—sÚ
, 
”rCode
)) {

214 
»suÉMsg
[100];

215 
	`¥rštf
(
»suÉMsg
, "FaedØ’abË iÅuˆpÜt: % çed (0x%08x)\n", 
”rR—sÚ
, 
”rCode
);

216 
	`’vœ
().
	`£tResuÉMsg
(
»suÉMsg
);

217  
F®£
;

221  
True
;

222 
	}
}

224 
	gWšdowsAudioIÅutDeviû
::
numMix”s
 = 0;

226 
Mix”
* 
	gWšdowsAudioIÅutDeviû
::
ourMix”s
 = 
NULL
;

228 
	gWšdowsAudioIÅutDeviû
::
numIÅutPÜtsTÙ®
 = 0;

233 
	gMix”
::
	$Mix”
()

234 : 
	`hMix”
(
NULL
), 
	`dwRecLšeID
(0), 
	`numPÜts
(0), 
	$pÜts
(
NULL
) {

235 
	}
}

237 
	gMix”
::~
	$Mix”
() {

238 
d–‘e
[] 
pÜts
;

239 
	}
}

241 
	gMix”
::
	$İ’
(
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
) {

242 
HMIXER
 
ÃwHMix”
 = 
NULL
;

244 
MIXERCAPS
 
mc
;

245 ià(
	`mix”G‘DevC­s
(
šdex
, &
mc
,  mcè!ğ
MMSYSERR_NOERROR
) ;

247 #ifdeà
UNICODE


249 
	`wc¡ombs
(
Çme
, 
mc
.
szPÇme
, 
MAXPNAMELEN
);

251 
	`¡ºıy
(
Çme
, 
mc
.
szPÇme
, 
MAXPNAMELEN
);

255 
i
, 
uWavIn
;

256 
nWavIn
 = 
	`waveInG‘NumDevs
();

257 
i
 = 0; i < 
nWavIn
; ++i) {

258 
WAVEINCAPS
 
wic
;

259 ià(
	`waveInG‘DevC­s
(
i
, &
wic
,  wicè!ğ
MMSYSERR_NOERROR
) ;

261 
MIXERLINE
 
ml
;

262 
ml
.
cbSŒuù
 =  ml;

263 
ml
.
T¬g‘
.
dwTy³
 = 
MIXERLINE_TARGETTYPE_WAVEIN
;

265 #ifdeà
UNICODE


266 
	`wc¢ıy
(
ml
.
T¬g‘
.
szPÇme
, 
wic
.szPÇme, 
MAXPNAMELEN
);

268 
	`¡ºıy
(
ml
.
T¬g‘
.
szPÇme
, 
wic
.szPÇme, 
MAXPNAMELEN
);

271 
ml
.
T¬g‘
.
vDriv”V”siÚ
 = 
wic
.vDriverVersion;

272 
ml
.
T¬g‘
.
wMid
 = 
wic
.wMid;

273 
ml
.
T¬g‘
.
wPid
 = 
wic
.wPid;

275 ià(
	`mix”G‘LšeInfo
((
HMIXEROBJ
)
šdex
, &
ml
, 
MIXER_GETLINEINFOF_TARGETTYPE
 ) =ğ
MMSYSERR_NOERROR
) {

277 
uWavIn
 = 
i
;

278 
dwRecLšeID
 = 
ml
.
dwLšeID
;

282 ià(
i
 >ğ
nWavIn
) ;

284 ià(
	`mix”O³n
(&
ÃwHMix”
, 
šdex
, ()
NULL
, ()NULL, 
MIXER_OBJECTF_MIXER
è!ğ
MMSYSERR_NOERROR
) ;

285 ià(
ÃwHMix”
 =ğ
NULL
) ;

288 ià(
	`mix”G‘DevC­s
((
UINT
)
ÃwHMix”
, &
mc
,  mcè!ğ
MMSYSERR_NOERROR
) ;

289 ià(
mc
.
cDe¡š©iÚs
 < 1) ;

291 ià(!
WšdowsAudioIÅutDeviû_commÚ
::
	`İ’WavInPÜt
(
uWavIn
, 
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
)) ;

293 
hMix”
 = 
ÃwHMix”
;

298 
	`şo£
();

299 
	}
}

301 
	gMix”
::
	$İ’
() {

302 
	`İ’
(1, 8000, 20);

303 
	}
}

305 
	gMix”
::
	$g‘PÜtsInfo
() {

306 
MIXERCAPS
 
mc
;

307 
	`mix”G‘DevC­s
((
UINT
)
hMix”
, &
mc
,  mc);

309 
MIXERLINE
 
mÉ
;

310 
i
;

311 
i
 = 0; i < 
mc
.
cDe¡š©iÚs
; ++i) {

312 
	`mem£t
(&
mÉ
, 0,  mlt);

313 
mÉ
.
cbSŒuù
 =  mlt;

314 
mÉ
.
dwDe¡š©iÚ
 = 
i
;

315 ià(
	`mix”G‘LšeInfo
((
HMIXEROBJ
)
hMix”
, &
mÉ
, 
MIXER_GETLINEINFOF_DESTINATION
è!ğ
MMSYSERR_NOERROR
) ;

316 ià(
mÉ
.
dwLšeID
 =ğ
dwRecLšeID
) ;

318 
pÜts
 = 
Ãw
 
AudioIÅutPÜt
[
mÉ
.
cCÚÃùiÚs
];

320 
numPÜts
 = 
mÉ
.
cCÚÃùiÚs
;

321 
i
 = 0; i < 
numPÜts
; ++i) {

322 
MIXERLINE
 
mlc
;

323 
	`memıy
(&
mlc
, &
mÉ
,  mlc);

324 
mlc
.
dwSourû
 = 
i
;

325 
	`mix”G‘LšeInfo
((
HMIXEROBJ
)
hMix”
, &
mlc
, 
MIXER_GETLINEINFOF_SOURCE
 );

326 
pÜts
[
i
].
g
 = 
mlc
.
dwLšeID
;

327 
pÜts
[
i
].
dwCompÚ’tTy³
 = 
mlc
.dwComponentType;

328 #ifdeà
UNICODE


329 
	`wc¡ombs
(
pÜts
[
i
].
Çme
, 
mlc
.
szName
, 
MIXER_LONG_NAME_CHARS
);

331 
	`¡ºıy
(
pÜts
[
i
].
Çme
, 
mlc
.
szName
, 
MIXER_LONG_NAME_CHARS
);

336 
i
 = 1; i < 
numPÜts
; ++i) {

337 #ifdeà
OLD_MICROPHONE_TESTING_CODE


338 ià(
	`_¡ºicmp
("mic", 
pÜts
[
i
].
Çme
, 3) == 0 ||

339 
	`_¡ºicmp
("mik", 
pÜts
[
i
].
Çme
, 3) == 0) {

341 ià(
pÜts
[
i
].
dwCompÚ’tTy³
 =ğ
MIXERLINE_COMPONENTTYPE_SRC_MICROPHONE
) {

343 
AudioIÅutPÜt
 
tmp
 = 
pÜts
[0];

344 
pÜts
[0] =…Üts[
i
];

345 
pÜts
[
i
] = 
tmp
;

348 
	}
}

350 
BoŞ—n
 
	gMix”
::
	$’abËIÅutPÜt
(
pÜtIndex
, cÚ¡*& 
”rR—sÚ
, 
MMRESULT
& 
”rCode
) {

351 
”rR—sÚ
 = 
NULL
;

352 
AudioIÅutPÜt
& 
pÜt
 = 
pÜts
[
pÜtIndex
];

354 
MIXERCONTROL
 
mc
;

355 
mc
.
cMuÉËI‹ms
 = 1;

356 
MIXERLINECONTROLS
 
mlc
;

358 
mlc
.
cbSŒuù
 =  mlc;

359 
mlc
.
·mxù¾
 = &
mc
;

360 
mlc
.
cbmxù¾
 =  (
MIXERCONTROL
);

361 
mlc
.
dwLšeID
 = 
pÜt
.
g
;

362 
mlc
.
dwCÚŒŞTy³
 = 
MIXERCONTROL_CONTROLTYPE_VOLUME
;

363 ià((
”rCode
 = 
	`mix”G‘LšeCÚŒŞs
((
HMIXEROBJ
)
hMix”
, &
mlc
, 
MIXER_GETLINECONTROLSF_ONEBYTYPE
 )è!ğ
MMSYSERR_NOERROR
) {

364 
”rR—sÚ
 = "mixerGetLineControls()";

365  
F®£
;

369 
MIXERLINE
 
ml
;

370 
	`mem£t
(&
ml
, 0,  (
MIXERLINE
));

371 
ml
.
cbSŒuù
 =  (
MIXERLINE
);

372 
ml
.
dwLšeID
 = 
pÜt
.
g
;

373 ià((
”rCode
 = 
	`mix”G‘LšeInfo
((
HMIXEROBJ
)
hMix”
, &
ml
, 
MIXER_GETLINEINFOF_LINEID
)è!ğ
MMSYSERR_NOERROR
) {

374 
”rR—sÚ
 = "mixerGetLineInfo()1";

375  
F®£
;

380 #ifdeà
UNICODE


381 
wch¬_t
 
pÜŠame
[
MIXER_LONG_NAME_CHARS
+1];

382 
	`wc¢ıy
(
pÜŠame
, 
ml
.
szName
, 
MIXER_LONG_NAME_CHARS
);

384 
pÜŠame
[
MIXER_LONG_NAME_CHARS
+1];

385 
	`¡ºıy
(
pÜŠame
, 
ml
.
szName
, 
MIXER_LONG_NAME_CHARS
);

388 
	`mem£t
(&
ml
, 0,  (
MIXERLINE
));

389 
ml
.
cbSŒuù
 =  (
MIXERLINE
);

390 
ml
.
dwLšeID
 = 
dwRecLšeID
;

391 ià((
”rCode
 = 
	`mix”G‘LšeInfo
((
HMIXEROBJ
)
hMix”
, &
ml
, 
MIXER_GETLINEINFOF_LINEID
 )è!ğ
MMSYSERR_NOERROR
) {

392 
”rR—sÚ
 = "mixerGetLineInfo()2";

393  
F®£
;

397 
mlc
.
cbSŒuù
 =  mlc;

398 
mlc
.
dwLšeID
 = 
ml
.dwLineID;

399 
mlc
.
cCÚŒŞs
 = 1;

400 
mc
.
cbSŒuù
 =  mc;

401 
mc
.
dwCÚŒŞID
 = 0xDEADBEEF;

402 
mlc
.
·mxù¾
 = &
mc
;

403 
mlc
.
cbmxù¾
 =  
mc
;

404 
mlc
.
dwCÚŒŞTy³
 = 
MIXERCONTROL_CONTROLTYPE_MUX
;

405 ià((
”rCode
 = 
	`mix”G‘LšeCÚŒŞs
((
HMIXEROBJ
)
hMix”
, &
mlc
, 
MIXER_GETLINECONTROLSF_ONEBYTYPE
 )è!ğ
MMSYSERR_NOERROR
) {

406 
mlc
.
dwCÚŒŞTy³
 = 
MIXERCONTROL_CONTROLTYPE_MIXER
;

407 
	`mix”G‘LšeCÚŒŞs
((
HMIXEROBJ
)
hMix”
, &
mlc
, 
MIXER_GETLINECONTROLSF_ONEBYTYPE
 );

410 
m©chLše
 = 0;

411 ià(
mc
.
cMuÉËI‹ms
 > 1) {

414 
MIXERCONTROLDETAILS
 
mcd
;

415 
mcd
.
cbSŒuù
 =  mcd;

416 
mcd
.
cChªÃls
 = 
ml
.cChannels;

417 
mcd
.
cMuÉËI‹ms
 = 
mc
.cMultipleItems;

418 
MIXERCONTROLDETAILS_LISTTEXT
* 
mcdlText
 = 
Ãw
 MIXERCONTROLDETAILS_LISTTEXT[
mc
.
cMuÉËI‹ms
];

419 
mcd
.
cbD‘as
 =  (
MIXERCONTROLDETAILS_LISTTEXT
);

420 
mcd
.
·D‘as
 = 
mcdlText
;

422 ià(
mc
.
dwCÚŒŞID
 != 0xDEADBEEF) {

423 
mcd
.
dwCÚŒŞID
 = 
mc
.dwControlID;

424 ià((
”rCode
 = 
	`mix”G‘CÚŒŞD‘as
((
HMIXEROBJ
)
hMix”
, &
mcd
, 
MIXER_GETCONTROLDETAILSF_LISTTEXT
 )è!ğ
MMSYSERR_NOERROR
) {

425 
d–‘e
[] 
mcdlText
;

426 
”rR—sÚ
 = "mixerGetControlDetails()1";

427  
F®£
;

431 
mc
.
dwCÚŒŞID
 = 0; mc.dwControlID < 32; ++mc.dwControlID) {

432 
mcd
.
dwCÚŒŞID
 = 
mc
.dwControlID;

433 ià((
”rCode
 = 
	`mix”G‘CÚŒŞD‘as
((
HMIXEROBJ
)
hMix”
, &
mcd
, 
MIXER_GETCONTROLDETAILSF_LISTTEXT
 )è=ğ
MMSYSERR_NOERROR
) ;

435 ià(
mc
.
dwCÚŒŞID
 == 32) {

436 
d–‘e
[] 
mcdlText
;

437 
”rR—sÚ
 = "mixerGetControlDetails()2";

438  
F®£
;

442 #ifdeà
UNICODE


443 
i
 = 0; i < 
mcd
.
cMuÉËI‹ms
; ++i) {

444 ià(
	`wcscmp
(
mcdlText
[
i
].
szName
, 
pÜŠame
) == 0) {

445 
m©chLše
 = 
i
;

450 
i
 = 0; i < 
mcd
.
cMuÉËI‹ms
; ++i) {

451 ià(
	`¡rcmp
(
mcdlText
[
i
].
szName
, 
pÜŠame
) == 0) {

452 
m©chLše
 = 
i
;

458 
d–‘e
[] 
mcdlText
;

462 
MIXERCONTROLDETAILS
 
mcd
;

463 
mcd
.
cbSŒuù
 =  mcd;

464 
mcd
.
dwCÚŒŞID
 = 
mc
.dwControlID;

465 
mcd
.
cChªÃls
 = 
ml
.cChannels;

466 
mcd
.
cMuÉËI‹ms
 = 
mc
.cMultipleItems;

467 
MIXERCONTROLDETAILS_BOOLEAN
* 
mcdbS‹
 = 
Ãw
 MIXERCONTROLDETAILS_BOOLEAN[
mc
.
cMuÉËI‹ms
];

468 
mcd
.
·D‘as
 = 
mcdbS‹
;

469 
mcd
.
cbD‘as
 =  (
MIXERCONTROLDETAILS_BOOLEAN
);

471 ià((
”rCode
 = 
	`mix”G‘CÚŒŞD‘as
((
HMIXEROBJ
)
hMix”
, &
mcd
, 
MIXER_GETCONTROLDETAILSF_VALUE
 )è!ğ
MMSYSERR_NOERROR
) {

472 
d–‘e
[] 
mcdbS‹
;

473 
”rR—sÚ
 = "mixerGetControlDetails()3";

474  
F®£
;

477 
j
 = 0; j < 
mcd
.
cMuÉËI‹ms
; ++j) {

478 
mcdbS‹
[
j
].
fV®ue
 = (j =ğ
m©chLše
);

481 ià((
”rCode
 = 
	`mix”S‘CÚŒŞD‘as
((
HMIXEROBJ
)
hMix”
, &
mcd
, 
MIXER_OBJECTF_HMIXER
)è!ğ
MMSYSERR_NOERROR
) {

482 
d–‘e
[] 
mcdbS‹
;

483 
”rR—sÚ
 = "mixerSetControlDetails()";

484  
F®£
;

486 
d–‘e
[] 
mcdbS‹
;

488  
True
;

489 
	}
}

492 
	gMix”
::
	$şo£
() {

493 
WšdowsAudioIÅutDeviû_commÚ
::
	`waveIn_şo£
();

494 ià(
hMix”
 !ğ
NULL
è
	`mix”Clo£
(hMixer);

495 
hMix”
 = 
NULL
; 
dwRecLšeID
 = 0;

496 
	}
}

	@WindowsAudioInputDevice/WindowsAudioInputDevice_noMixer.cpp

21 
	~<WšdowsAudioIÅutDeviû_noMix”.hh
>

25 şas 
	cAudioIÅutPÜt
 {

26 
	mpublic
:

27 
İ’
(
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
);

28 
İ’
();

29 
şo£
();

31 
	mpublic
:

32 
šdex
;

33 
	mÇme
[
MAXPNAMELEN
];

39 
AudioIÅutDeviû
*

40 
	gAudioIÅutDeviû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
šputPÜtNumb”
,

41 
b™sP”Sam¶e
,

42 
numChªÃls
,

43 
§m¶šgF»qu’cy
,

44 
g¿nuÏr™yInMS
) {

45 
BoŞ—n
 
sucûss
;

46 
WšdowsAudioIÅutDeviû
* 
ÃwSourû


47 ğ
Ãw
 
	`WšdowsAudioIÅutDeviû
(
’v
, 
šputPÜtNumb”
,

48 
b™sP”Sam¶e
, 
numChªÃls
,

49 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
,

50 
sucûss
);

51 ià(!
sucûss
è{
d–‘e
 
ÃwSourû
;‚ewSourû = 
NULL
;}

53  
ÃwSourû
;

54 
	}
}

56 
AudioPÜtNames
* 
	gAudioIÅutDeviû
::
	$g‘PÜtNames
() {

57 
WšdowsAudioIÅutDeviû
::
	`š™ŸlizeIfNeûs§ry
();

59 
AudioPÜtNames
* 
pÜtNames
 = 
Ãw
 AudioPortNames;

60 
pÜtNames
->
numPÜts
 = 
WšdowsAudioIÅutDeviû
::
numAudioIÅutPÜts
;

61 
pÜtNames
->
pÜtName
 = 
Ãw
 *[
WšdowsAudioIÅutDeviû
::
numAudioIÅutPÜts
];

63 
i
 = 0; i < 
WšdowsAudioIÅutDeviû
::
numAudioIÅutPÜts
; ++i) {

64 
AudioIÅutPÜt
& 
audioIÅutPÜt
 = 
WšdowsAudioIÅutDeviû
::
ourAudioIÅutPÜts
[
i
];

66 
pÜtNames
->
pÜtName
[
i
] = 
	`¡rDup
(
audioIÅutPÜt
.
Çme
);

69  
pÜtNames
;

70 
	}
}

75 
	gWšdowsAudioIÅutDeviû


76 ::
	$WšdowsAudioIÅutDeviû
(
U§geEnvœÚm’t
& 
’v
, 
šputPÜtNumb”
,

77 
b™sP”Sam¶e
,

78 
numChªÃls
,

79 
§m¶šgF»qu’cy
,

80 
g¿nuÏr™yInMS
,

81 
BoŞ—n
& 
sucûss
)

82 : 
	$WšdowsAudioIÅutDeviû_commÚ
(
’v
, 
šputPÜtNumb”
,

83 
b™sP”Sam¶e
, 
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
) {

84 
sucûss
 = 
	`š™ŸlS‘IÅutPÜt
(
šputPÜtNumb”
);

85 
	}
}

87 
	gWšdowsAudioIÅutDeviû
::~
	$WšdowsAudioIÅutDeviû
() {

88 ià(
fCurPÜtIndex
 >ğ0è
ourAudioIÅutPÜts
[fCurPÜtIndex].
	`şo£
();

90 
d–‘e
[] 
ourAudioIÅutPÜts
; ourAudioIÅutPÜt ğ
NULL
;

91 
numAudioIÅutPÜts
 = 0;

92 
	}
}

94 
	gWšdowsAudioIÅutDeviû
::
	$š™ŸlizeIfNeûs§ry
() {

95 ià(
ourAudioIÅutPÜts
 !ğ
NULL
) ;

96 
numAudioIÅutPÜts
 = 
	`waveInG‘NumDevs
();

97 
ourAudioIÅutPÜts
 = 
Ãw
 
AudioIÅutPÜt
[
numAudioIÅutPÜts
];

100 
i
 = 0; i < 
numAudioIÅutPÜts
; ++i) {

101 
AudioIÅutPÜt
& 
pÜt
 = 
ourAudioIÅutPÜts
[
i
];

102 
pÜt
.
šdex
 = 
i
;

103 
pÜt
.
	`İ’
();

104 
pÜt
.
	`şo£
();

106 
	}
}

108 
BoŞ—n
 
	gWšdowsAudioIÅutDeviû
::
	$£tIÅutPÜt
(
pÜtIndex
) {

109 
	`š™ŸlizeIfNeûs§ry
();

111 ià(
pÜtIndex
 < 0 ||…ÜtIndex >ğ()
numAudioIÅutPÜts
) {

112 
	`’vœ
().
	`£tResuÉMsg
("Bad input…ort index\n");

113  
F®£
;

117 ià(
®lowedDeviûNames
 !ğ
NULL
) {

118 
i
;

119 
i
 = 0; 
®lowedDeviûNames
[i] !ğ
NULL
; ++i) {

120 ià(
	`¡ºcmp
(
ourAudioIÅutPÜts
[
pÜtIndex
].
Çme
, 
®lowedDeviûNames
[
i
],

121 
	`¡¾’
(
®lowedDeviûNames
[
i
])) == 0) {

126 ià(
®lowedDeviûNames
[
i
] =ğ
NULL
) {

127 
	`’vœ
().
	`£tResuÉMsg
("Accessohis‡udio device is‚ot‡llowed\n");

128  
F®£
;

132 ià(
pÜtIndex
 !ğ
fCurPÜtIndex
) {

134 ià(
fCurPÜtIndex
 >ğ0è
ourAudioIÅutPÜts
[fCurPÜtIndex].
	`şo£
();;

135 
fCurPÜtIndex
 = 
pÜtIndex
;

136 
ourAudioIÅutPÜts
[
fCurPÜtIndex
].
	`İ’
(
fNumChªÃls
, 
fSam¶šgF»qu’cy
, 
fG¿nuÏr™yInMS
);

138 
fCurPÜtIndex
 = 
pÜtIndex
;

139  
True
;

140 
	}
}

142 
	gWšdowsAudioIÅutDeviû
::
numAudioIÅutPÜts
 = 0;

144 
AudioIÅutPÜt
* 
	gWšdowsAudioIÅutDeviû
::
ourAudioIÅutPÜts
 = 
NULL
;

149 
	gAudioIÅutPÜt
::
	$İ’
(
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
) {

152 
WAVEINCAPS
 
wic
;

153 ià(
	`waveInG‘DevC­s
(
šdex
, &
wic
,  wicè!ğ
MMSYSERR_NOERROR
) {

154 
Çme
[0] = '\0';

158 #ifdeà
UNICODE


160 
	`wc¡ombs
(
Çme
, 
wic
.
szPÇme
, 
MAXPNAMELEN
);

162 
	`¡ºıy
(
Çme
, 
wic
.
szPÇme
, 
MAXPNAMELEN
);

165 ià(!
WšdowsAudioIÅutDeviû_commÚ
::
	`İ’WavInPÜt
(
šdex
, 
numChªÃls
, 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
)) ;

171 
	`şo£
();

172 
	}
}

174 
	gAudioIÅutPÜt
::
	$İ’
() {

175 
	`İ’
(1, 8000, 20);

176 
	}
}

178 
	gAudioIÅutPÜt
::
	$şo£
() {

179 
WšdowsAudioIÅutDeviû_commÚ
::
	`waveIn_şo£
();

180 
	}
}

	@WindowsAudioInputDevice/showAudioInputPorts.cpp

19 
	~"AudioIÅutDeviû.hh
"

20 
	~<¡dio.h
>

22 
	$maš
(
¬gc
, ** 
¬gv
) {

23 
AudioPÜtNames
* 
pÜtNames
 = 
AudioIÅutDeviû
::
	`g‘PÜtNames
();

24 ià(
pÜtNames
 =ğ
NULL
) {

25 
	`årštf
(
¡d”r
, "AudioInputDevice::getPortNames() failed!\n");

26 
	`ex™
(1);

29 
	`´štf
("%d‡vaabË‡udiØšpuˆpÜts:\n", 
pÜtNames
->
numPÜts
);

30 
i
 = 0; i < 
pÜtNames
->
numPÜts
; ++i) {

31 
	`´štf
("%d\t%s\n", 
i
, 
pÜtNames
->
pÜtName
[i]);

35 
	}
}

	@groupsock/GroupEId.cpp

20 
	~"GroupEId.hh
"

23 
	gGroupEId
::
	$GroupEId
(
š_addr
 cÚ¡& 
groupAddr
,

24 
pÜtNumB™s
 
pÜtNum
, 
u_št8_t
 
‰l
) {

25 
š_addr
 
sourûF‹rAddr
;

26 
sourûF‹rAddr
.
s_addr
 = ~0;

28 
	`š™
(
groupAddr
, 
sourûF‹rAddr
, 
pÜtNum
, 
‰l
);

29 
	}
}

31 
	gGroupEId
::
	$GroupEId
(
š_addr
 cÚ¡& 
groupAddr
,

32 
š_addr
 cÚ¡& 
sourûF‹rAddr
,

33 
pÜtNumB™s
 
pÜtNum
) {

34 
	`š™
(
groupAddr
, 
sourûF‹rAddr
, 
pÜtNum
, 255);

35 
	}
}

37 
BoŞ—n
 
	gGroupEId
::
	$isSSM
() const {

38  
fSourûF‹rAdd»ss
.
s_addr
 !ğ
	`ÃtAdd»ssB™s
(~0);

39 
	}
}

41 
	gGroupEId
::
	$š™
(
š_addr
 cÚ¡& 
groupAddr
,

42 
š_addr
 cÚ¡& 
sourûF‹rAddr
,

43 
pÜtNumB™s
 
pÜtNum
,

44 
u_št8_t
 
‰l
) {

45 
fGroupAdd»ss
 = 
groupAddr
;

46 
fSourûF‹rAdd»ss
 = 
sourûF‹rAddr
;

47 
fPÜtNum
 = 
pÜtNum
;

48 
fTTL
 = 
‰l
;

49 
	}
}

	@groupsock/Groupsock.cpp

20 
	~"Groupsock.hh
"

21 
	~"GroupsockH–³r.hh
"

23 
	~"TuÂ–Enÿps.hh
"

25 #iâdeà
NO_SSTREAM


26 
	~<s¡»am
>

28 
	~<¡dio.h
>

32 
	gOuutSock‘
::
	$OuutSock‘
(
U§geEnvœÚm’t
& 
’v
)

33 : 
	`Sock‘
(
’v
, 0 ),

34 
	`fSourûPÜt
(0), 
	$fLa¡S’tTTL
(256 ) {

35 
	}
}

37 
	gOuutSock‘
::
	$OuutSock‘
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
pÜt
)

38 : 
	`Sock‘
(
’v
, 
pÜt
),

39 
	`fSourûPÜt
(0), 
	$fLa¡S’tTTL
(256 ) {

40 
	}
}

42 
	gOuutSock‘
::~
	$OuutSock‘
() {

43 
	}
}

45 
BoŞ—n
 
OuutSock‘
::
	$wr™e
(
ÃtAdd»ssB™s
 
add»ss
, 
pÜtNumB™s
 
pÜtNum
, 
u_št8_t
 
‰l
,

46 * 
bufãr
, 
bufãrSize
) {

47 
š_addr
 
de¡Addr
; de¡Addr.
s_addr
 = 
add»ss
;

48 ià(()
‰l
 =ğ
fLa¡S’tTTL
) {

50 ià(!
	`wr™eSock‘
(
	`’v
(), 
	`sock‘Num
(), 
de¡Addr
, 
pÜtNum
, 
bufãr
, 
bufãrSize
)è 
F®£
;

52 ià(!
	`wr™eSock‘
(
	`’v
(), 
	`sock‘Num
(), 
de¡Addr
, 
pÜtNum
, 
‰l
, 
bufãr
, 
bufãrSize
)è 
F®£
;

53 
fLa¡S’tTTL
 = ()
‰l
;

56 ià(
	`sourûPÜtNum
() == 0) {

59 ià(!
	`g‘SourûPÜt
(
	`’v
(), 
	`sock‘Num
(), 
fSourûPÜt
)) {

60 ià(
DebugLev–
 >= 1)

61 
	`’v
(è<< *
this


63 << 
	`’v
().
	`g‘ResuÉMsg
() << "\n";

64  
F®£
;

68  
True
;

69 
	}
}

72 
BoŞ—n
 
	gOuutSock‘


73 ::
	$hªdËR—d
(* , ,

74 & , 
sockaddr_š
& ) {

75  
True
;

76 
	}
}

81 
	gde¡RecÜd


82 ::
	$de¡RecÜd
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 cÚ¡& 
pÜt
, 
u_št8_t
 
‰l
, 
£ssiÚId
,

83 
de¡RecÜd
* 
Ãxt
)

84 : 
	`fNext
(
Ãxt
), 
	`fGroupEId
(
addr
, 
pÜt
.
	`num
(), 
‰l
), 
	$fSessiÚId
(
£ssiÚId
) {

85 
	}
}

87 
	gde¡RecÜd
::~
	$de¡RecÜd
() {

88 
d–‘e
 
fNext
;

89 
	}
}

94 
N‘IÁ”çûT¿fficSts
 
	gGroupsock
::
¡©sIncomšg
;

95 
N‘IÁ”çûT¿fficSts
 
	gGroupsock
::
¡©sOutgošg
;

96 
N‘IÁ”çûT¿fficSts
 
	gGroupsock
::
¡©sR–ayedIncomšg
;

97 
N‘IÁ”çûT¿fficSts
 
	gGroupsock
::
¡©sR–ayedOutgošg
;

100 
	gGroupsock
::
	$Groupsock
(
U§geEnvœÚm’t
& 
’v
, 
š_addr
 cÚ¡& 
groupAddr
,

101 
PÜt
 
pÜt
, 
u_št8_t
 
‰l
)

102 : 
	`OuutSock‘
(
’v
, 
pÜt
),

103 
	`d–‘eIfNoMemb”s
(
F®£
), 
	`isSÏve
(False),

104 
	`fDe¡s
(
Ãw
 
	`de¡RecÜd
(
groupAddr
, 
pÜt
, 
‰l
, 0, 
NULL
)),

105 
	`fIncomšgGroupEId
(
groupAddr
, 
pÜt
.
	`num
(), 
‰l
) {

107 ià(!
	`sock‘JošGroup
(
’v
, 
	`sock‘Num
(), 
groupAddr
.
s_addr
)) {

108 ià(
DebugLev–
 >= 1) {

109 
’v
 << *
this
 << ": failedo join group: "

110 << 
’v
.
	`g‘ResuÉMsg
() << "\n";

115 ià(
	`ourIPAdd»ss
(
’v
) == 0) {

116 ià(
DebugLev–
 >= 0) {

117 
’v
 << "Unableo determine our source‡ddress: "

118 << 
’v
.
	`g‘ResuÉMsg
() << "\n";

122 ià(
DebugLev–
 >ğ2è
’v
 << *
this
 << ": created\n";

123 
	}
}

126 
	gGroupsock
::
	$Groupsock
(
U§geEnvœÚm’t
& 
’v
, 
š_addr
 cÚ¡& 
groupAddr
,

127 
š_addr
 cÚ¡& 
sourûF‹rAddr
,

128 
PÜt
 
pÜt
)

129 : 
	`OuutSock‘
(
’v
, 
pÜt
),

130 
	`d–‘eIfNoMemb”s
(
F®£
), 
	`isSÏve
(False),

131 
	`fDe¡s
(
Ãw
 
	`de¡RecÜd
(
groupAddr
, 
pÜt
, 255, 0, 
NULL
)),

132 
	`fIncomšgGroupEId
(
groupAddr
, 
sourûF‹rAddr
, 
pÜt
.
	$num
()) {

134 ià(!
	`sock‘JošGroupSSM
(
’v
, 
	`sock‘Num
(), 
groupAddr
.
s_addr
,

135 
sourûF‹rAddr
.
s_addr
)) {

136 ià(
DebugLev–
 >= 3) {

137 
’v
 << *
this
 << ": SSM join failed: "

138 << 
’v
.
	`g‘ResuÉMsg
();

139 
’v
 << " -rying„egular join instead\n";

141 ià(!
	`sock‘JošGroup
(
’v
, 
	`sock‘Num
(), 
groupAddr
.
s_addr
)) {

142 ià(
DebugLev–
 >= 1) {

143 
’v
 << *
this
 << ": failedo join group: "

144 << 
’v
.
	`g‘ResuÉMsg
() << "\n";

149 ià(
DebugLev–
 >ğ2è
’v
 << *
this
 << ": created\n";

150 
	}
}

152 
	gGroupsock
::~
	$Groupsock
() {

153 ià(
	`isSSM
()) {

154 ià(!
	`sock‘L—veGroupSSM
(
	`’v
(), 
	`sock‘Num
(), 
	`groupAdd»ss
().
s_addr
,

155 
	`sourûF‹rAdd»ss
().
s_addr
)) {

156 
	`sock‘L—veGroup
(
	`’v
(), 
	`sock‘Num
(), 
	`groupAdd»ss
().
s_addr
);

159 
	`sock‘L—veGroup
(
	`’v
(), 
	`sock‘Num
(), 
	`groupAdd»ss
().
s_addr
);

162 
d–‘e
 
fDe¡s
;

164 ià(
DebugLev–
 >ğ2è
	`’v
(è<< *
this
 << ": deleting\n";

165 
	}
}

167 
de¡RecÜd
* 
	gGroupsock


168 ::
	$ü—‹NewDe¡RecÜd
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 cÚ¡& 
pÜt
, 
u_št8_t
 
‰l
,

169 
£ssiÚId
, 
de¡RecÜd
* 
Ãxt
) {

171  
Ãw
 
	`de¡RecÜd
(
addr
, 
pÜt
, 
‰l
, 
£ssiÚId
, 
Ãxt
);

172 
	}
}

175 
	gGroupsock
::
	$chªgeDe¡š©iÚP¬am‘”s
(
š_addr
 cÚ¡& 
ÃwDe¡Addr
,

176 
PÜt
 
ÃwDe¡PÜt
, 
ÃwDe¡TTL
, 
£ssiÚId
) {

177 
de¡RecÜd
* 
de¡
 = 
fDe¡s
;

178 
de¡
 !ğ
NULL
 && de¡->
fSessiÚId
 !ğ
£ssiÚId
ède¡ = de¡->
fNext
;

179 ià(
de¡
 =ğ
NULL
) {

180 
fDe¡s
 = 
	`ü—‹NewDe¡RecÜd
(
ÃwDe¡Addr
, 
ÃwDe¡PÜt
, 
ÃwDe¡TTL
, 
£ssiÚId
, fDests);

184 
š_addr
 
de¡Addr
 = 
de¡
->
fGroupEId
.
	`groupAdd»ss
();

185 ià(
ÃwDe¡Addr
.
s_addr
 != 0) {

186 ià(
ÃwDe¡Addr
.
s_addr
 !ğ
de¡Addr
.s_addr

187 && 
	`IsMuÉiÿ¡Add»ss
(
ÃwDe¡Addr
.
s_addr
)) {

191 
	`sock‘L—veGroup
(
	`’v
(), 
	`sock‘Num
(), 
de¡Addr
.
s_addr
);

192 
	`sock‘JošGroup
(
	`’v
(), 
	`sock‘Num
(), 
ÃwDe¡Addr
.
s_addr
);

194 
de¡Addr
.
s_addr
 = 
ÃwDe¡Addr
.s_addr;

197 
pÜtNumB™s
 
de¡PÜtNum
 = 
de¡
->
fGroupEId
.
	`pÜtNum
();

198 ià(
ÃwDe¡PÜt
.
	`num
() != 0) {

199 ià(
ÃwDe¡PÜt
.
	`num
(è!ğ
de¡PÜtNum


200 && 
	`IsMuÉiÿ¡Add»ss
(
de¡Addr
.
s_addr
)) {

202 
	`chªgePÜt
(
ÃwDe¡PÜt
);

204 
	`sock‘JošGroup
(
	`’v
(), 
	`sock‘Num
(), 
de¡Addr
.
s_addr
);

206 
de¡PÜtNum
 = 
ÃwDe¡PÜt
.
	`num
();

209 
u_št8_t
 
de¡TTL
 = 
	`‰l
();

210 ià(
ÃwDe¡TTL
 !ğ~0è
de¡TTL
 = (
u_št8_t
)newDestTTL;

212 
de¡
->
fGroupEId
 = 
	`GroupEId
(
de¡Addr
, 
de¡PÜtNum
, 
de¡TTL
);

213 
	}
}

215 
	gGroupsock


216 ::
	$lookupSessiÚIdFromDe¡š©iÚ
(
sockaddr_š
 cÚ¡& 
de¡AddrAndPÜt
) const {

217 
de¡RecÜd
* 
de¡
 = 
	`lookupDe¡RecÜdFromDe¡š©iÚ
(
de¡AddrAndPÜt
);

218 ià(
de¡
 =ğ
NULL
)  0;

220  
de¡
->
fSessiÚId
;

221 
	}
}

223 
	gGroupsock
::
	$addDe¡š©iÚ
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 cÚ¡& 
pÜt
, 
£ssiÚId
) {

225 
	`chªgeDe¡š©iÚP¬am‘”s
(
addr
, 
pÜt
, 255, 
£ssiÚId
);

227 
	}
}

229 
	gGroupsock
::
	$»moveDe¡š©iÚ
(
£ssiÚId
) {

230 
de¡RecÜd
** 
de¡sPŒ
 = &
fDe¡s
; *de¡sPŒ !ğ
NULL
; de¡sPŒ = &((*de¡sPŒ)->
fNext
)) {

231 ià(
£ssiÚId
 =ğ(*
de¡sPŒ
)->
fSessiÚId
) {

233 
de¡RecÜd
* 
Ãxt
 = (*
de¡sPŒ
)->
fNext
;

234 (*
de¡sPŒ
)->
fNext
 = 
NULL
;

235 
	`d–‘e
 (*
de¡sPŒ
);

236 *
de¡sPŒ
 = 
Ãxt
;

240 
	}
}

242 
	gGroupsock
::
	$»moveAÎDe¡š©iÚs
() {

243 
d–‘e
 
fDe¡s
; fDe¡ ğ
NULL
;

244 
	}
}

246 
	gGroupsock
::
	$muÉiÿ¡S’dOÆy
() {

250 
	`sock‘L—veGroup
(
	`’v
(), 
	`sock‘Num
(), 
fIncomšgGroupEId
.
	`groupAdd»ss
().
s_addr
);

251 
de¡RecÜd
* 
de¡s
 = 
fDe¡s
; de¡ !ğ
NULL
; de¡ ğde¡s->
fNext
) {

252 
	`sock‘L—veGroup
(
	`’v
(), 
	`sock‘Num
(), 
de¡s
->
fGroupEId
.
	`groupAdd»ss
().
s_addr
);

255 
	}
}

257 
BoŞ—n
 
	gGroupsock
::
	$ouut
(
U§geEnvœÚm’t
& 
’v
, * 
bufãr
, 
bufãrSize
,

258 
DœeùedN‘IÁ”çû
* 
š‹rçûNÙToFwdBackTo
) {

261 
BoŞ—n
 
wr™eSucûss
 = 
True
;

262 
de¡RecÜd
* 
de¡s
 = 
fDe¡s
; de¡ !ğ
NULL
; de¡ ğde¡s->
fNext
) {

263 ià(!
	`wr™e
(
de¡s
->
fGroupEId
.
	`groupAdd»ss
().
s_addr
, de¡s->fGroupEId.
	`pÜtNum
(), de¡s->fGroupEId.
	`‰l
(),

264 
bufãr
, 
bufãrSize
)) {

265 
wr™eSucûss
 = 
F®£
;

269 ià(!
wr™eSucûss
) ;

270 
¡©sOutgošg
.
	`couÁPack‘
(
bufãrSize
);

271 
¡©sGroupOutgošg
.
	`couÁPack‘
(
bufãrSize
);

274 
numMemb”s
 = 0;

275 ià(!
	`memb”s
().
	`IsEm±y
()) {

276 
numMemb”s
 =

277 
	`ouutToAÎMemb”sExû±
(
š‹rçûNÙToFwdBackTo
,

278 
	`‰l
(), 
bufãr
, 
bufãrSize
,

279 
	`ourIPAdd»ss
(
’v
));

280 ià(
numMemb”s
 < 0) ;

283 ià(
DebugLev–
 >= 3) {

284 
’v
 << *
this
 << ": wrÙ" << 
bufãrSize
 << " by‹s, " << ()
	`‰l
();

285 ià(
numMemb”s
 > 0) {

286 
’v
 << ";„–ayedØ" << 
numMemb”s
 << " members";

288 
’v
 << "\n";

290  
True
;

293 ià(
DebugLev–
 >= 0) {

294 
U§geEnvœÚm’t
::
MsgSŒšg
 
msg
 = 
	`¡rDup
(
’v
.
	`g‘ResuÉMsg
());

295 
’v
.
	`£tResuÉMsg
("Groupsock wr™çed: ", 
msg
);

296 
d–‘e
[] (*)
msg
;

298  
F®£
;

299 
	}
}

301 
BoŞ—n
 
	gGroupsock
::
	$hªdËR—d
(* 
bufãr
, 
bufãrMaxSize
,

302 & 
by‹sR—d
,

303 
sockaddr_š
& 
äomAdd»ssAndPÜt
) {

307 
by‹sR—d
 = 0;

309 
maxBy‹sToR—d
 = 
bufãrMaxSize
 - 
TuÂ–EnÿpsuÏtiÚT¿”MaxSize
;

310 
numBy‹s
 = 
	`»adSock‘
(
	`’v
(), 
	`sock‘Num
(),

311 
bufãr
, 
maxBy‹sToR—d
, 
äomAdd»ssAndPÜt
);

312 ià(
numBy‹s
 < 0) {

313 ià(
DebugLev–
 >= 0) {

314 
U§geEnvœÚm’t
::
MsgSŒšg
 
msg
 = 
	`¡rDup
(
	`’v
().
	`g‘ResuÉMsg
());

315 
	`’v
().
	`£tResuÉMsg
("Groupsock„—d faed: ", 
msg
);

316 
d–‘e
[] (*)
msg
;

318  
F®£
;

322 ià(
	`isSSM
()

323 && 
äomAdd»ssAndPÜt
.
sš_addr
.
s_addr
 !ğ
	`sourûF‹rAdd»ss
().s_addr) {

324  
True
;

330 
by‹sR—d
 = 
numBy‹s
;

332 
numMemb”s
 = 0;

333 ià(!
	`wasLoİedBackFromUs
(
	`’v
(), 
äomAdd»ssAndPÜt
)) {

334 
¡©sIncomšg
.
	`couÁPack‘
(
numBy‹s
);

335 
¡©sGroupIncomšg
.
	`couÁPack‘
(
numBy‹s
);

336 
numMemb”s
 =

337 
	`ouutToAÎMemb”sExû±
(
NULL
, 
	`‰l
(),

338 
bufãr
, 
by‹sR—d
,

339 
äomAdd»ssAndPÜt
.
sš_addr
.
s_addr
);

340 ià(
numMemb”s
 > 0) {

341 
¡©sR–ayedIncomšg
.
	`couÁPack‘
(
numBy‹s
);

342 
¡©sGroupR–ayedIncomšg
.
	`couÁPack‘
(
numBy‹s
);

345 ià(
DebugLev–
 >= 3) {

346 
	`’v
(è<< *
this
 << ":„—d " << 
by‹sR—d
 << " by‹ äom " << 
	`Add»ssSŒšg
(
äomAdd»ssAndPÜt
).
	`v®
(è<< ",…Üˆ" << 
	`Áohs
(äomAdd»ssAndPÜt.
sš_pÜt
);

347 ià(
numMemb”s
 > 0) {

348 
	`’v
(è<< ";„–ayedØ" << 
numMemb”s
 << " members";

350 
	`’v
() << "\n";

353  
True
;

354 
	}
}

356 
BoŞ—n
 
	gGroupsock
::
	$wasLoİedBackFromUs
(
U§geEnvœÚm’t
& 
’v
,

357 
sockaddr_š
& 
äomAdd»ssAndPÜt
) {

358 ià(
äomAdd»ssAndPÜt
.
sš_addr
.
s_addr


359 =ğ
	`ourIPAdd»ss
(
’v
)) {

360 ià(
äomAdd»ssAndPÜt
.
sš_pÜt
 =ğ
	`sourûPÜtNum
()) {

361 #ifdeà
DEBUG_LOOPBACK_CHECKING


362 ià(
DebugLev–
 >= 3) {

363 
	`’v
(è<< *
this
 << ": got†ooped-back…acket\n";

366  
True
;

370  
F®£
;

371 
	}
}

373 
de¡RecÜd
* 
	gGroupsock


374 ::
	$lookupDe¡RecÜdFromDe¡š©iÚ
(
sockaddr_š
 cÚ¡& 
de¡AddrAndPÜt
) const {

375 
de¡RecÜd
* 
de¡
 = 
fDe¡s
; de¡ !ğ
NULL
; de¡ = de¡->
fNext
) {

376 ià(
de¡AddrAndPÜt
.
sš_addr
.
s_addr
 =ğ
de¡
->
fGroupEId
.
	`groupAdd»ss
().s_addr

377 && 
de¡AddrAndPÜt
.
sš_pÜt
 =ğ
de¡
->
fGroupEId
.
	`pÜtNum
()) {

378  
de¡
;

381  
NULL
;

382 
	}
}

384 
	gGroupsock
::
	$ouutToAÎMemb”sExû±
(
DœeùedN‘IÁ”çû
* 
exû±IÁ”çû
,

385 
u_št8_t
 
‰lToFwd
,

386 * 
d©a
, 
size
,

387 
ÃtAdd»ssB™s
 
sourûAddr
) {

389 ià(
‰lToFwd
 == 0)  0;

391 
DœeùedN‘IÁ”çûS‘
::
I‹¿tÜ
 
	`™”
(
	`memb”s
());

392 
numMemb”s
 = 0;

393 
DœeùedN‘IÁ”çû
* 
š‹rf
;

394 (
š‹rf
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

396 ià(
š‹rf
 =ğ
exû±IÁ”çû
)

401 
U§geEnvœÚm’t
& 
§veEnv
 = 
	`’v
();

403 ià(!
š‹rf
->
	`SourûAddrOKFÜR–ayšg
(
§veEnv
, 
sourûAddr
)) {

404 ià(
	`¡rcmp
(
§veEnv
.
	`g‘ResuÉMsg
(), "") != 0) {

412 ià(
numMemb”s
 == 0) {

416 
TuÂ–EnÿpsuÏtiÚT¿”
* 
Œa”InPack‘


417 ğ(
TuÂ–EnÿpsuÏtiÚT¿”
*)&
d©a
[
size
];

418 
TuÂ–EnÿpsuÏtiÚT¿”
* 
Œa”
;

420 
BoŞ—n
 
mi§ligÃd
 = ((
ušŒ_t
)
Œa”InPack‘
 & 3) != 0;

421 
Œa”Off£t
;

422 
u_št8_t
 
tuÂ–Cmd
;

423 ià(
	`isSSM
()) {

425 
Œa”Off£t
 = 
TuÂ–EnÿpsuÏtiÚT¿”AuxSize
;

426 
tuÂ–Cmd
 = 
TuÂ–D©aAuxCmd
;

428 
Œa”Off£t
 = 0;

429 
tuÂ–Cmd
 = 
TuÂ–D©aCmd
;

431 
Œa”Size
 = 
TuÂ–EnÿpsuÏtiÚT¿”Size
 + 
Œa”Off£t
;

432 
tmpTr
[
TuÂ–EnÿpsuÏtiÚT¿”MaxSize
];

433 ià(
mi§ligÃd
) {

434 
Œa”
 = (
TuÂ–EnÿpsuÏtiÚT¿”
*)&
tmpTr
;

436 
Œa”
 = 
Œa”InPack‘
;

438 
Œa”
 +ğ
Œa”Off£t
;

440 ià(
fDe¡s
 !ğ
NULL
) {

441 
Œa”
->
	`add»ss
(èğ
fDe¡s
->
fGroupEId
.
	`groupAdd»ss
().
s_addr
;

442 
PÜt
 
	`de¡PÜt
(
	`Áohs
(
fDe¡s
->
fGroupEId
.
	`pÜtNum
()));

443 
Œa”
->
	`pÜt
(èğ
de¡PÜt
;

445 
Œa”
->
	`‰l
(èğ
‰lToFwd
;

446 
Œa”
->
	`commªd
(èğ
tuÂ–Cmd
;

448 ià(
	`isSSM
()) {

449 
Œa”
->
	`auxAdd»ss
(èğ
	`sourûF‹rAdd»ss
().
s_addr
;

452 ià(
mi§ligÃd
) {

453 
	`memmove
(
Œa”InPack‘
, 
Œa”
-
Œa”Off£t
, 
Œa”Size
);

456 
size
 +ğ
Œa”Size
;

459 
š‹rf
->
	`wr™e
(
d©a
, 
size
);

460 ++
numMemb”s
;

463  
numMemb”s
;

464 
	}
}

466 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	gs
, cÚ¡ 
	gGroupsock
& 
	gg
) {

467 
	gU§geEnvœÚm’t
& 
	gs1
 = 
s
 << 
time¡ampSŒšg
() << " Groupsock("

468 << 
g
.
sock‘Num
() << ": "

469 << 
Add»ssSŒšg
(
g
.
groupAdd»ss
()).
v®
()

470 << ", " << 
g
.
pÜt
() << ", ";

471 ià(
	gg
.
isSSM
()) {

472  
	gs1
 << "SSM source: "

473 << 
Add»ssSŒšg
(
g
.
sourûF‹rAdd»ss
()).
v®
() << ")";

475  
	gs1
 << ()(
	gg
.
‰l
()) << ")";

485 
	gHashTabË
*& 
	$g‘Sock‘TabË
(
U§geEnvœÚm’t
& 
’v
) {

486 
_groupsockPriv
* 
´iv
 = 
	`groupsockPriv
(
’v
);

487 ià(
´iv
->
sock‘TabË
 =ğ
NULL
) {

488 
´iv
->
sock‘TabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

490  
´iv
->
sock‘TabË
;

491 
	}
}

493 
BoŞ—n
 
	$un£tGroupsockBySock‘
(
Groupsock
 cÚ¡* 
groupsock
) {

495 ià(
groupsock
 =ğ
NULL
) ;

497 
sock
 = 
groupsock
->
	`sock‘Num
();

499 ià(
sock
 < 0) ;

501 
HashTabË
*& 
sock‘s
 = 
	`g‘Sock‘TabË
(
groupsock
->
	`’v
());

503 
Groupsock
* 
gs
 = (Groupsock*)
sock‘s
->
	`Lookup
((*)()
sock
);

504 ià(
gs
 =ğ
NULL
 || g !ğ
groupsock
) ;

505 
sock‘s
->
	`Remove
((*)()
sock
);

507 ià(
sock‘s
->
	`IsEm±y
()) {

509 
d–‘e
 
sock‘s
; sock‘ ğ
NULL
;

510 
	`»şaimGroupsockPriv
(
gs
->
	`’v
());

513  
True
;

516  
F®£
;

517 
	}
}

519 
BoŞ—n
 
	$£tGroupsockBySock‘
(
U§geEnvœÚm’t
& 
’v
, 
sock
,

520 
Groupsock
* 
groupsock
) {

523 ià(
sock
 < 0) {

524 
buf
[100];

525 
	`¥rštf
(
buf
, "ŒyšgØu£ bad sock‘ (%d)", 
sock
);

526 
’v
.
	`£tResuÉMsg
(
buf
);

530 
HashTabË
* 
sock‘s
 = 
	`g‘Sock‘TabË
(
’v
);

533 
BoŞ—n
 
®»adyExi¡s


534 ğ(
sock‘s
->
	`Lookup
((*)()
sock
) != 0);

535 ià(
®»adyExi¡s
) {

536 
buf
[100];

537 
	`¥rštf
(
buf
, "A‰em±šgØ»¶aû‡Àexi¡šg sock‘ (%d)", 
sock
);

538 
’v
.
	`£tResuÉMsg
(
buf
);

542 
sock‘s
->
	`Add
((*)()
sock
, 
groupsock
);

543  
True
;

546  
F®£
;

547 
	}
}

549 
Groupsock
* 
	$g‘GroupsockBySock‘
(
U§geEnvœÚm’t
& 
’v
, 
sock
) {

552 ià(
sock
 < 0) ;

554 
HashTabË
* 
sock‘s
 = 
	`g‘Sock‘TabË
(
’v
);

555  (
Groupsock
*)
sock‘s
->
	`Lookup
((*)()
sock
);

558  
NULL
;

559 
	}
}

561 
Groupsock
*

562 
	gGroupsockLookupTabË
::
	$F‘ch
(
U§geEnvœÚm’t
& 
’v
,

563 
ÃtAdd»ssB™s
 
groupAdd»ss
,

564 
PÜt
 
pÜt
, 
u_št8_t
 
‰l
,

565 
BoŞ—n
& 
isNew
) {

566 
isNew
 = 
F®£
;

567 
Groupsock
* 
groupsock
;

569 
groupsock
 = (
Groupsock
*è
fTabË
.
	`Lookup
(
groupAdd»ss
, (~0), 
pÜt
);

570 ià(
groupsock
 =ğ
NULL
) {

571 
groupsock
 = 
	`AddNew
(
’v
, 
groupAdd»ss
, (~0), 
pÜt
, 
‰l
);

572 ià(
groupsock
 =ğ
NULL
) ;

573 
isNew
 = 
True
;

577  
groupsock
;

578 
	}
}

580 
Groupsock
*

581 
	gGroupsockLookupTabË
::
	$F‘ch
(
U§geEnvœÚm’t
& 
’v
,

582 
ÃtAdd»ssB™s
 
groupAdd»ss
,

583 
ÃtAdd»ssB™s
 
sourûF‹rAddr
, 
PÜt
 
pÜt
,

584 
BoŞ—n
& 
isNew
) {

585 
isNew
 = 
F®£
;

586 
Groupsock
* 
groupsock
;

588 
groupsock


589 ğ(
Groupsock
*è
fTabË
.
	`Lookup
(
groupAdd»ss
, 
sourûF‹rAddr
, 
pÜt
);

590 ià(
groupsock
 =ğ
NULL
) {

591 
groupsock
 = 
	`AddNew
(
’v
, 
groupAdd»ss
, 
sourûF‹rAddr
, 
pÜt
, 0);

592 ià(
groupsock
 =ğ
NULL
) ;

593 
isNew
 = 
True
;

597  
groupsock
;

598 
	}
}

600 
Groupsock
*

601 
	gGroupsockLookupTabË
::
	$Lookup
(
ÃtAdd»ssB™s
 
groupAdd»ss
, 
PÜt
 
pÜt
) {

602  (
Groupsock
*è
fTabË
.
	`Lookup
(
groupAdd»ss
, (~0), 
pÜt
);

603 
	}
}

605 
Groupsock
*

606 
	gGroupsockLookupTabË
::
	$Lookup
(
ÃtAdd»ssB™s
 
groupAdd»ss
,

607 
ÃtAdd»ssB™s
 
sourûF‹rAddr
, 
PÜt
 
pÜt
) {

608  (
Groupsock
*è
fTabË
.
	`Lookup
(
groupAdd»ss
, 
sourûF‹rAddr
, 
pÜt
);

609 
	}
}

611 
Groupsock
* 
	gGroupsockLookupTabË
::
	$Lookup
(
U§geEnvœÚm’t
& 
’v
, 
sock
) {

612  
	`g‘GroupsockBySock‘
(
’v
, 
sock
);

613 
	}
}

615 
BoŞ—n
 
	gGroupsockLookupTabË
::
	$Remove
(
Groupsock
 cÚ¡* 
groupsock
) {

616 
	`un£tGroupsockBySock‘
(
groupsock
);

617  
fTabË
.
	`Remove
(
groupsock
->
	`groupAdd»ss
().
s_addr
,

618 
groupsock
->
	`sourûF‹rAdd»ss
().
s_addr
,

619 
groupsock
->
	`pÜt
());

620 
	}
}

622 
Groupsock
* 
	gGroupsockLookupTabË
::
	$AddNew
(
U§geEnvœÚm’t
& 
’v
,

623 
ÃtAdd»ssB™s
 
groupAdd»ss
,

624 
ÃtAdd»ssB™s
 
sourûF‹rAdd»ss
,

625 
PÜt
 
pÜt
, 
u_št8_t
 
‰l
) {

626 
Groupsock
* 
groupsock
;

628 
š_addr
 
groupAddr
; groupAddr.
s_addr
 = 
groupAdd»ss
;

629 ià(
sourûF‹rAdd»ss
 =ğ
	`ÃtAdd»ssB™s
(~0)) {

631 
groupsock
 = 
Ãw
 
	`Groupsock
(
’v
, 
groupAddr
, 
pÜt
, 
‰l
);

634 
š_addr
 
sourûF‹rAddr
;

635 
sourûF‹rAddr
.
s_addr
 = 
sourûF‹rAdd»ss
;

636 
groupsock
 = 
Ãw
 
	`Groupsock
(
’v
, 
groupAddr
, 
sourûF‹rAddr
, 
pÜt
);

639 ià(
groupsock
 =ğ
NULL
 || groupsock->
	`sock‘Num
() < 0) ;

641 ià(!
	`£tGroupsockBySock‘
(
’v
, 
groupsock
->
	`sock‘Num
(), groupsock)) ;

643 
fTabË
.
	`Add
(
groupAdd»ss
, 
sourûF‹rAdd»ss
, 
pÜt
, (*)
groupsock
);

646  
groupsock
;

647 
	}
}

649 
	gGroupsockLookupTabË
::
I‹¿tÜ
::
	$I‹¿tÜ
(
GroupsockLookupTabË
& 
groupsocks
)

650 : 
	`fI‹r
(
Add»ssPÜtLookupTabË
::
	$I‹¿tÜ
(
groupsocks
.
fTabË
)) {

651 
	}
}

653 
Groupsock
* 
GroupsockLookupTabË
::
I‹¿tÜ
::
	$Ãxt
() {

654  (
Groupsock
*è
fI‹r
.
	`Ãxt
();

655 
	}
};

	@groupsock/GroupsockHelper.cpp

21 
	~"GroupsockH–³r.hh
"

23 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

24 
	~<time.h
>

25 "C" 
š™ŸlizeWšsockIfNeûs§ry
();

27 
	~<¡d¬g.h
>

28 
	~<time.h
>

29 
	~<fú.h
>

30 
	#š™ŸlizeWšsockIfNeûs§ry
(è1

	)

32 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_QNX4
)

34 
	~<sigÇl.h
>

35 
	#USE_SIGNALS
 1

	)

37 
	~<¡dio.h
>

40 
ÃtAdd»ssB™s
 
	gS’dšgIÁ”çûAddr
 = 
INADDR_ANY
;

41 
ÃtAdd»ssB™s
 
	gReûivšgIÁ”çûAddr
 = 
INADDR_ANY
;

43 
	$sock‘E¼
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
”rÜMsg
) {

44 
’v
.
	`£tResuÉE¼Msg
(
”rÜMsg
);

45 
	}
}

47 
	gNoReu£
::
	$NoReu£
(
U§geEnvœÚm’t
& 
’v
)

48 : 
	$fEnv
(
’v
) {

49 
	`groupsockPriv
(
fEnv
)->
»u£FÏg
 = 0;

50 
	}
}

52 
	gNoReu£
::~
	$NoReu£
() {

53 
	`groupsockPriv
(
fEnv
)->
»u£FÏg
 = 1;

54 
	`»şaimGroupsockPriv
(
fEnv
);

55 
	}
}

58 
_groupsockPriv
* 
	$groupsockPriv
(
U§geEnvœÚm’t
& 
’v
) {

59 ià(
’v
.
groupsockPriv
 =ğ
NULL
) {

60 
_groupsockPriv
* 
»suÉ
 = 
Ãw
 _groupsockPriv;

61 
»suÉ
->
sock‘TabË
 = 
NULL
;

62 
»suÉ
->
»u£FÏg
 = 1;

63 
’v
.
groupsockPriv
 = 
»suÉ
;

65  (
_groupsockPriv
*)(
’v
.
groupsockPriv
);

66 
	}
}

68 
	$»şaimGroupsockPriv
(
U§geEnvœÚm’t
& 
’v
) {

69 
_groupsockPriv
* 
´iv
 = (_groupsockPriv*)(
’v
.
groupsockPriv
);

70 ià(
´iv
->
sock‘TabË
 =ğ
NULL
 &&…riv->
»u£FÏg
 == 1 ) {

72 
d–‘e
 
´iv
;

73 
’v
.
groupsockPriv
 = 
NULL
;

75 
	}
}

77 
	$ü—‹Sock‘
(
ty³
) {

80 
sock
;

82 #ifdeà
SOCK_CLOEXEC


83 
sock
 = 
	`sock‘
(
AF_INET
, 
ty³
|
SOCK_CLOEXEC
, 0);

84 ià(
sock
 !ğ-1 || 
”ºo
 !ğ
EINVAL
)  sock;

88 
sock
 = 
	`sock‘
(
AF_INET
, 
ty³
, 0);

89 #ifdeà
FD_CLOEXEC


90 ià(
sock
 !ğ-1è
	`fú
(sock, 
F_SETFD
, 
FD_CLOEXEC
);

92  
sock
;

93 
	}
}

95 
	$£tupD©ag¿mSock‘
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
pÜt
) {

96 ià(!
	`š™ŸlizeWšsockIfNeûs§ry
()) {

97 
	`sock‘E¼
(
’v
, "Failedo initialize 'winsock': ");

101 
ÃwSock‘
 = 
	`ü—‹Sock‘
(
SOCK_DGRAM
);

102 ià(
ÃwSock‘
 < 0) {

103 
	`sock‘E¼
(
’v
, "unableo create datagram socket: ");

104  
ÃwSock‘
;

107 
»u£FÏg
 = 
	`groupsockPriv
(
’v
)->reuseFlag;

108 
	`»şaimGroupsockPriv
(
’v
);

109 ià(
	`£tsockİt
(
ÃwSock‘
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

110 (cÚ¡ *)&
»u£FÏg
, „euseFlag) < 0) {

111 
	`sock‘E¼
(
’v
, "setsockopt(SO_REUSEADDR)ƒrror: ");

112 
	`şo£Sock‘
(
ÃwSock‘
);

116 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

119 #ifdeà
SO_REUSEPORT


120 ià(
	`£tsockİt
(
ÃwSock‘
, 
SOL_SOCKET
, 
SO_REUSEPORT
,

121 (cÚ¡ *)&
»u£FÏg
, „euseFlag) < 0) {

122 
	`sock‘E¼
(
’v
, "setsockopt(SO_REUSEPORT)ƒrror: ");

123 
	`şo£Sock‘
(
ÃwSock‘
);

128 #ifdeà
IP_MULTICAST_LOOP


129 cÚ¡ 
u_št8_t
 
loİ
 = 1;

130 ià(
	`£tsockİt
(
ÃwSock‘
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
,

131 (cÚ¡ *)&
loİ
, †oop) < 0) {

132 
	`sock‘E¼
(
’v
, "setsockopt(IP_MULTICAST_LOOP)ƒrror: ");

133 
	`şo£Sock‘
(
ÃwSock‘
);

140 
ÃtAdd»ssB™s
 
addr
 = 
INADDR_ANY
;

141 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

143 ià(
pÜt
.
	`num
(è!ğ0 || 
ReûivšgIÁ”çûAddr
 !ğ
INADDR_ANY
) {

145 ià(
pÜt
.
	`num
(è=ğ0è
addr
 = 
ReûivšgIÁ”çûAddr
;

146 
	`MAKE_SOCKADDR_IN
(
Çme
, 
addr
, 
pÜt
.
	`num
());

147 ià(
	`bšd
(
ÃwSock‘
, (
sockaddr
*)&
Çme
, ‚ame) != 0) {

148 
tmpBufãr
[100];

149 
	`¥rštf
(
tmpBufãr
, "bind()ƒrror (port‚umber: %d): ",

150 
	`Áohs
(
pÜt
.
	`num
()));

151 
	`sock‘E¼
(
’v
, 
tmpBufãr
);

152 
	`şo£Sock‘
(
ÃwSock‘
);

155 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

161 ià(
S’dšgIÁ”çûAddr
 !ğ
INADDR_ANY
) {

162 
š_addr
 
addr
;

163 
addr
.
s_addr
 = 
S’dšgIÁ”çûAddr
;

165 ià(
	`£tsockİt
(
ÃwSock‘
, 
IPPROTO_IP
, 
IP_MULTICAST_IF
,

166 (cÚ¡ *)&
addr
, ‡ddr) < 0) {

167 
	`sock‘E¼
(
’v
, "error setting outgoing multicast interface: ");

168 
	`şo£Sock‘
(
ÃwSock‘
);

173  
ÃwSock‘
;

176 
BoŞ—n
 
	`makeSock‘NÚBlockšg
(
sock
) {

177 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

178 
¬g
 = 1;

179  
	`ioùlsock‘
(
sock
, 
FIONBIO
, &
¬g
) == 0;

180 #–ià
	`defšed
(
VXWORKS
)

181 
¬g
 = 1;

182  
	`ioùl
(
sock
, 
FIONBIO
, ()&
¬g
) == 0;

184 
curFÏgs
 = 
	`fú
(
sock
, 
F_GETFL
, 0);

185  
	`fú
(
sock
, 
F_SETFL
, 
curFÏgs
|
O_NONBLOCK
) >= 0;

189 
BoŞ—n
 
	`makeSock‘Blockšg
(
sock
, 
wr™eTimeoutInMli£cÚds
) {

190 
BoŞ—n
 
»suÉ
;

191 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

192 
¬g
 = 0;

193 
»suÉ
 = 
	`ioùlsock‘
(
sock
, 
FIONBIO
, &
¬g
) == 0;

194 #–ià
	`defšed
(
VXWORKS
)

195 
¬g
 = 0;

196 
»suÉ
 = 
	`ioùl
(
sock
, 
FIONBIO
, ()&
¬g
) == 0;

198 
curFÏgs
 = 
	`fú
(
sock
, 
F_GETFL
, 0);

199 
»suÉ
 = 
	`fú
(
sock
, 
F_SETFL
, 
curFÏgs
&(~
O_NONBLOCK
)) >= 0;

202 ià(
wr™eTimeoutInMli£cÚds
 > 0) {

203 #ifdeà
SO_SNDTIMEO


204 
timev®
 
tv
;

205 
tv
.
tv_£c
 = 
wr™eTimeoutInMli£cÚds
/1000;

206 
tv
.
tv_u£c
 = (
wr™eTimeoutInMli£cÚds
%1000)*1000;

207 
	`£tsockİt
(
sock
, 
SOL_SOCKET
, 
SO_SNDTIMEO
, (*)&
tv
, v);

211  
»suÉ
;

214 
	`£tupSŒ—mSock‘
(
U§geEnvœÚm’t
& 
’v
,

215 
PÜt
 
pÜt
, 
BoŞ—n
 
makeNÚBlockšg
) {

216 ià(!
	`š™ŸlizeWšsockIfNeûs§ry
()) {

217 
	`sock‘E¼
(
’v
, "Failedo initialize 'winsock': ");

221 
ÃwSock‘
 = 
	`ü—‹Sock‘
(
SOCK_STREAM
);

222 ià(
ÃwSock‘
 < 0) {

223 
	`sock‘E¼
(
’v
, "unableo create stream socket: ");

224  
ÃwSock‘
;

227 
»u£FÏg
 = 
	`groupsockPriv
(
’v
)->reuseFlag;

228 
	`»şaimGroupsockPriv
(
’v
);

229 ià(
	`£tsockİt
(
ÃwSock‘
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

230 (cÚ¡ *)&
»u£FÏg
, „euseFlag) < 0) {

231 
	`sock‘E¼
(
’v
, "setsockopt(SO_REUSEADDR)ƒrror: ");

232 
	`şo£Sock‘
(
ÃwSock‘
);

239 #ifdeà
REUSE_FOR_TCP


240 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

243 #ifdeà
SO_REUSEPORT


244 ià(
	`£tsockİt
(
ÃwSock‘
, 
SOL_SOCKET
, 
SO_REUSEPORT
,

245 (cÚ¡ *)&
»u£FÏg
, „euseFlag) < 0) {

246 
	`sock‘E¼
(
’v
, "setsockopt(SO_REUSEPORT)ƒrror: ");

247 
	`şo£Sock‘
(
ÃwSock‘
);

255 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

257 ià(
pÜt
.
	`num
(è!ğ0 || 
ReûivšgIÁ”çûAddr
 !ğ
INADDR_ANY
) {

259 
	`MAKE_SOCKADDR_IN
(
Çme
, 
ReûivšgIÁ”çûAddr
, 
pÜt
.
	`num
());

260 ià(
	`bšd
(
ÃwSock‘
, (
sockaddr
*)&
Çme
, ‚ame) != 0) {

261 
tmpBufãr
[100];

262 
	`¥rštf
(
tmpBufãr
, "bind()ƒrror (port‚umber: %d): ",

263 
	`Áohs
(
pÜt
.
	`num
()));

264 
	`sock‘E¼
(
’v
, 
tmpBufãr
);

265 
	`şo£Sock‘
(
ÃwSock‘
);

268 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

273 ià(
makeNÚBlockšg
) {

274 ià(!
	`makeSock‘NÚBlockšg
(
ÃwSock‘
)) {

275 
	`sock‘E¼
(
’v
, "failedo make‚on-blocking: ");

276 
	`şo£Sock‘
(
ÃwSock‘
);

281  
ÃwSock‘
;

284 
	`»adSock‘
(
U§geEnvœÚm’t
& 
’v
,

285 
sock‘
, * 
bufãr
, 
bufãrSize
,

286 
sockaddr_š
& 
äomAdd»ss
) {

287 
SOCKLEN_T
 
add»ssSize
 =  
äomAdd»ss
;

288 
by‹sR—d
 = 
	`»cväom
(
sock‘
, (*)
bufãr
, 
bufãrSize
, 0,

289 (
sockaddr
*)&
äomAdd»ss
,

290 &
add»ssSize
);

291 ià(
by‹sR—d
 < 0) {

293 
”r
 = 
’v
.
	`g‘E¼no
();

294 ià(
”r
 == 111

295 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

302 || 
”r
 =ğ0 ||ƒ¼ =ğ
EWOULDBLOCK


304 || 
”r
 =ğ
EAGAIN


306 || 
”r
 == 113 ) {

307 
äomAdd»ss
.
sš_addr
.
s_addr
 = 0;

311 
	`sock‘E¼
(
’v
, "recvfrom()ƒrror: ");

312 } ià(
by‹sR—d
 == 0) {

317  
by‹sR—d
;

320 
BoŞ—n
 
	`wr™eSock‘
(
U§geEnvœÚm’t
& 
’v
,

321 
sock‘
, 
š_addr
 
add»ss
, 
pÜtNumB™s
 
pÜtNum
,

322 
u_št8_t
 
‰lArg
,

323 * 
bufãr
, 
bufãrSize
) {

325 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

326 
	#TTL_TYPE
 

	)

328 
	#TTL_TYPE
 
u_št8_t


	)

330 
TTL_TYPE
 
‰l
 = (TTL_TYPE)
‰lArg
;

331 ià(
	`£tsockİt
(
sock‘
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
,

332 (cÚ¡ *)&
‰l
, tl) < 0) {

333 
	`sock‘E¼
(
’v
, "setsockopt(IP_MULTICAST_TTL)ƒrror: ");

334  
F®£
;

337  
	`wr™eSock‘
(
’v
, 
sock‘
, 
add»ss
, 
pÜtNum
, 
bufãr
, 
bufãrSize
);

340 
BoŞ—n
 
	`wr™eSock‘
(
U§geEnvœÚm’t
& 
’v
,

341 
sock‘
, 
š_addr
 
add»ss
, 
pÜtNumB™s
 
pÜtNum
,

342 * 
bufãr
, 
bufãrSize
) {

344 
	`MAKE_SOCKADDR_IN
(
de¡
, 
add»ss
.
s_addr
, 
pÜtNum
);

345 
by‹sS’t
 = 
	`£ndto
(
sock‘
, (*)
bufãr
, 
bufãrSize
, 0,

346 (
sockaddr
*)&
de¡
,  dest);

347 ià(
by‹sS’t
 !ğ()
bufãrSize
) {

348 
tmpBuf
[100];

349 
	`¥rštf
(
tmpBuf
, "wr™eSock‘(%d), s’dTo(è”rÜ: wrÙ%d by‹ š¡—d oà%u: ", 
sock‘
, 
by‹sS’t
, 
bufãrSize
);

350 
	`sock‘E¼
(
’v
, 
tmpBuf
);

354  
True
;

357  
F®£
;

360 
	`ignÜeSigPeOnSock‘
(
sock‘Num
) {

361 #ifdeà
USE_SIGNALS


362 #ifdeà
SO_NOSIGPIPE


363 
£t_İtiÚ
 = 1;

364 
	`£tsockİt
(
sock‘Num
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, &
£t_İtiÚ
,  set_option);

366 
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

371 
	`g‘BufãrSize
(
U§geEnvœÚm’t
& 
’v
, 
bufO±Name
,

372 
sock‘
) {

373 
curSize
;

374 
SOCKLEN_T
 
sizeSize
 =  
curSize
;

375 ià(
	`g‘sockİt
(
sock‘
, 
SOL_SOCKET
, 
bufO±Name
,

376 (*)&
curSize
, &
sizeSize
) < 0) {

377 
	`sock‘E¼
(
’v
, "getBufferSize()ƒrror: ");

381  
curSize
;

383 
	`g‘S’dBufãrSize
(
U§geEnvœÚm’t
& 
’v
, 
sock‘
) {

384  
	`g‘BufãrSize
(
’v
, 
SO_SNDBUF
, 
sock‘
);

386 
	`g‘ReûiveBufãrSize
(
U§geEnvœÚm’t
& 
’v
, 
sock‘
) {

387  
	`g‘BufãrSize
(
’v
, 
SO_RCVBUF
, 
sock‘
);

390 
	`£tBufãrTo
(
U§geEnvœÚm’t
& 
’v
, 
bufO±Name
,

391 
sock‘
, 
»que¡edSize
) {

392 
SOCKLEN_T
 
sizeSize
 =  
»que¡edSize
;

393 
	`£tsockİt
(
sock‘
, 
SOL_SOCKET
, 
bufO±Name
, (*)&
»que¡edSize
, 
sizeSize
);

396  
	`g‘BufãrSize
(
’v
, 
bufO±Name
, 
sock‘
);

398 
	`£tS’dBufãrTo
(
U§geEnvœÚm’t
& 
’v
,

399 
sock‘
, 
»que¡edSize
) {

400  
	`£tBufãrTo
(
’v
, 
SO_SNDBUF
, 
sock‘
, 
»que¡edSize
);

402 
	`£tReûiveBufãrTo
(
U§geEnvœÚm’t
& 
’v
,

403 
sock‘
, 
»que¡edSize
) {

404  
	`£tBufãrTo
(
’v
, 
SO_RCVBUF
, 
sock‘
, 
»que¡edSize
);

407 
	`šü—£BufãrTo
(
U§geEnvœÚm’t
& 
’v
, 
bufO±Name
,

408 
sock‘
, 
»que¡edSize
) {

411 
curSize
 = 
	`g‘BufãrSize
(
’v
, 
bufO±Name
, 
sock‘
);

415 
»que¡edSize
 > 
curSize
) {

416 
SOCKLEN_T
 
sizeSize
 =  
»que¡edSize
;

417 ià(
	`£tsockİt
(
sock‘
, 
SOL_SOCKET
, 
bufO±Name
,

418 (*)&
»que¡edSize
, 
sizeSize
) >= 0) {

420  
»que¡edSize
;

422 
»que¡edSize
 = (»que¡edSize+
curSize
)/2;

425  
	`g‘BufãrSize
(
’v
, 
bufO±Name
, 
sock‘
);

427 
	`šü—£S’dBufãrTo
(
U§geEnvœÚm’t
& 
’v
,

428 
sock‘
, 
»que¡edSize
) {

429  
	`šü—£BufãrTo
(
’v
, 
SO_SNDBUF
, 
sock‘
, 
»que¡edSize
);

431 
	`šü—£ReûiveBufãrTo
(
U§geEnvœÚm’t
& 
’v
,

432 
sock‘
, 
»que¡edSize
) {

433  
	`šü—£BufãrTo
(
’v
, 
SO_RCVBUF
, 
sock‘
, 
»que¡edSize
);

436 
	`ş—rMuÉiÿ¡AÎSock‘O±iÚ
(
sock‘
) {

437 #ifdeà
IP_MULTICAST_ALL


441 
muÉiÿ¡AÎ
 = 0;

442 ()
	`£tsockİt
(
sock‘
, 
IPPROTO_IP
, 
IP_MULTICAST_ALL
, (*)&
muÉiÿ¡AÎ
,  multicastAll);

447 
BoŞ—n
 
	`sock‘JošGroup
(
U§geEnvœÚm’t
& 
’v
, 
sock‘
,

448 
ÃtAdd»ssB™s
 
groupAdd»ss
){

449 ià(!
	`IsMuÉiÿ¡Add»ss
(
groupAdd»ss
)è 
True
;

451 
_m»q
 
imr
;

452 
imr
.
imr_muÉŸddr
.
s_addr
 = 
groupAdd»ss
;

453 
imr
.
imr_š‹rçû
.
s_addr
 = 
ReûivšgIÁ”çûAddr
;

454 ià(
	`£tsockİt
(
sock‘
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
,

455 (cÚ¡ *)&
imr
,  (
_m»q
)) < 0) {

456 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

457 ià(
’v
.
	`g‘E¼no
() != 0) {

461 
	`sock‘E¼
(
’v
, "setsockopt(IP_ADD_MEMBERSHIP)ƒrror: ");

462  
F®£
;

463 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

468 
	`ş—rMuÉiÿ¡AÎSock‘O±iÚ
(
sock‘
);

470  
True
;

473 
BoŞ—n
 
	`sock‘L—veGroup
(
U§geEnvœÚm’t
&, 
sock‘
,

474 
ÃtAdd»ssB™s
 
groupAdd»ss
) {

475 ià(!
	`IsMuÉiÿ¡Add»ss
(
groupAdd»ss
)è 
True
;

477 
_m»q
 
imr
;

478 
imr
.
imr_muÉŸddr
.
s_addr
 = 
groupAdd»ss
;

479 
imr
.
imr_š‹rçû
.
s_addr
 = 
ReûivšgIÁ”çûAddr
;

480 ià(
	`£tsockİt
(
sock‘
, 
IPPROTO_IP
, 
IP_DROP_MEMBERSHIP
,

481 (cÚ¡ *)&
imr
,  (
_m»q
)) < 0) {

482  
F®£
;

485  
True
;

491 #ià!
	`defšed
(
IP_ADD_SOURCE_MEMBERSHIP
)

492 
	s_m»q_sourû
 {

493 
š_addr
 
imr_muÉŸddr
;

494 
š_addr
 
imr_sourûaddr
;

495 
š_addr
 
imr_š‹rçû
;

499 #iâdeà
IP_ADD_SOURCE_MEMBERSHIP


501 #ifdeà
LINUX


502 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

503 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

505 
	#IP_ADD_SOURCE_MEMBERSHIP
 25

	)

506 
	#IP_DROP_SOURCE_MEMBERSHIP
 26

	)

511 
BoŞ—n
 
	`sock‘JošGroupSSM
(
U§geEnvœÚm’t
& 
’v
, 
sock‘
,

512 
ÃtAdd»ssB™s
 
groupAdd»ss
,

513 
ÃtAdd»ssB™s
 
sourûF‹rAddr
) {

514 ià(!
	`IsMuÉiÿ¡Add»ss
(
groupAdd»ss
)è 
True
;

516 
_m»q_sourû
 
imr
;

517 #ifdeà
__ANDROID__


518 
imr
.
imr_muÉŸddr
 = 
groupAdd»ss
;

519 
imr
.
imr_sourûaddr
 = 
sourûF‹rAddr
;

520 
imr
.
imr_š‹rçû
 = 
ReûivšgIÁ”çûAddr
;

522 
imr
.
imr_muÉŸddr
.
s_addr
 = 
groupAdd»ss
;

523 
imr
.
imr_sourûaddr
.
s_addr
 = 
sourûF‹rAddr
;

524 
imr
.
imr_š‹rçû
.
s_addr
 = 
ReûivšgIÁ”çûAddr
;

526 ià(
	`£tsockİt
(
sock‘
, 
IPPROTO_IP
, 
IP_ADD_SOURCE_MEMBERSHIP
,

527 (cÚ¡ *)&
imr
,  (
_m»q_sourû
)) < 0) {

528 
	`sock‘E¼
(
’v
, "setsockopt(IP_ADD_SOURCE_MEMBERSHIP)ƒrror: ");

529  
F®£
;

532 
	`ş—rMuÉiÿ¡AÎSock‘O±iÚ
(
sock‘
);

534  
True
;

537 
BoŞ—n
 
	`sock‘L—veGroupSSM
(
U§geEnvœÚm’t
& , 
sock‘
,

538 
ÃtAdd»ssB™s
 
groupAdd»ss
,

539 
ÃtAdd»ssB™s
 
sourûF‹rAddr
) {

540 ià(!
	`IsMuÉiÿ¡Add»ss
(
groupAdd»ss
)è 
True
;

542 
_m»q_sourû
 
imr
;

543 #ifdeà
__ANDROID__


544 
imr
.
imr_muÉŸddr
 = 
groupAdd»ss
;

545 
imr
.
imr_sourûaddr
 = 
sourûF‹rAddr
;

546 
imr
.
imr_š‹rçû
 = 
ReûivšgIÁ”çûAddr
;

548 
imr
.
imr_muÉŸddr
.
s_addr
 = 
groupAdd»ss
;

549 
imr
.
imr_sourûaddr
.
s_addr
 = 
sourûF‹rAddr
;

550 
imr
.
imr_š‹rçû
.
s_addr
 = 
ReûivšgIÁ”çûAddr
;

552 ià(
	`£tsockİt
(
sock‘
, 
IPPROTO_IP
, 
IP_DROP_SOURCE_MEMBERSHIP
,

553 (cÚ¡ *)&
imr
,  (
_m»q_sourû
)) < 0) {

554  
F®£
;

557  
True
;

560 
BoŞ—n
 
	`g‘SourûPÜt0
(
sock‘
, 
pÜtNumB™s
& 
»suÉPÜtNum
 ) {

561 
sockaddr_š
 
‹¡
;e¡.
sš_pÜt
 = 0;

562 
SOCKLEN_T
 
Ën
 =  
‹¡
;

563 ià(
	`g‘sockÇme
(
sock‘
, (
sockaddr
*)&
‹¡
, &
Ën
è< 0è 
F®£
;

565 
»suÉPÜtNum
 = 
	`Áohs
(
‹¡
.
sš_pÜt
);

566  
True
;

569 
BoŞ—n
 
	`g‘SourûPÜt
(
U§geEnvœÚm’t
& 
’v
, 
sock‘
, 
PÜt
& 
pÜt
) {

570 
pÜtNumB™s
 
pÜtNum
 = 0;

571 ià(!
	`g‘SourûPÜt0
(
sock‘
, 
pÜtNum
) ||…ortNum == 0) {

573 
	`MAKE_SOCKADDR_IN
(
Çme
, 
INADDR_ANY
, 0);

574 
	`bšd
(
sock‘
, (
sockaddr
*)&
Çme
, ‚ame);

576 ià(!
	`g‘SourûPÜt0
(
sock‘
, 
pÜtNum
) ||…ortNum == 0) {

577 
	`sock‘E¼
(
’v
, "getsockname()ƒrror: ");

578  
F®£
;

582 
pÜt
 = 
	`PÜt
(
pÜtNum
);

583  
True
;

586 
BoŞ—n
 
	`badAdd»ssFÜUs
(
ÃtAdd»ssB™s
 
addr
) {

588 
ÃtAdd»ssB™s
 
nAddr
 = 
	`htÚl
(
addr
);

589  (
nAddr
 == 0x7F000001

590 || 
nAddr
 == 0

591 || 
nAddr
 =ğ(
ÃtAdd»ssB™s
)(~0));

594 
BoŞ—n
 
loİbackWÜks
 = 1;

596 
ÃtAdd»ssB™s
 
	`ourIPAdd»ss
(
U§geEnvœÚm’t
& 
’v
) {

597 
ÃtAdd»ssB™s
 
ourAdd»ss
 = 0;

598 
sock
 = -1;

599 
š_addr
 
‹¡Addr
;

601 ià(
ReûivšgIÁ”çûAddr
 !ğ
INADDR_ANY
) {

604 
ourAdd»ss
 = 
ReûivšgIÁ”çûAddr
;

607 ià(
ourAdd»ss
 == 0) {

609 
sockaddr_š
 
äomAddr
;

610 
äomAddr
.
sš_addr
.
s_addr
 = 0;

617 
loİbackWÜks
 = 0;

619 
‹¡Addr
.
s_addr
 = 
	`our_š‘_addr
("228.67.43.91");

620 
PÜt
 
	`‹¡PÜt
(15947);

622 
sock
 = 
	`£tupD©ag¿mSock‘
(
’v
, 
‹¡PÜt
);

623 ià(
sock
 < 0) ;

625 ià(!
	`sock‘JošGroup
(
’v
, 
sock
, 
‹¡Addr
.
s_addr
)) ;

627 
‹¡SŒšg
[] = "hostIdTest";

628 
‹¡SŒšgL’gth
 =  
‹¡SŒšg
;

630 ià(!
	`wr™eSock‘
(
’v
, 
sock
, 
‹¡Addr
, 
‹¡PÜt
.
	`num
(), 0,

631 
‹¡SŒšg
, 
‹¡SŒšgL’gth
)) ;

634 
fd_£t
 
rd_£t
;

635 
	`FD_ZERO
(&
rd_£t
);

636 
	`FD_SET
(()
sock
, &
rd_£t
);

637 cÚ¡ 
numFds
 = 
sock
+1;

638 
timev®
 
timeout
;

639 
timeout
.
tv_£c
 = 5;

640 
timeout
.
tv_u£c
 = 0;

641 
»suÉ
 = 
	`£Ëù
(
numFds
, &
rd_£t
, 
NULL
, NULL, &
timeout
);

642 ià(
»suÉ
 <= 0) ;

644 
»adBufãr
[20];

645 
by‹sR—d
 = 
	`»adSock‘
(
’v
, 
sock
,

646 
»adBufãr
, „eadBuffer,

647 
äomAddr
);

648 ià(
by‹sR—d
 !ğ()
‹¡SŒšgL’gth


649 || 
	`¡ºcmp
((*)
»adBufãr
, (*)
‹¡SŒšg
, 
‹¡SŒšgL’gth
) != 0) {

654 
loİbackWÜks
 = !
	`badAdd»ssFÜUs
(
äomAddr
.
sš_addr
.
s_addr
);

657 ià(
sock
 >= 0) {

658 
	`sock‘L—veGroup
(
’v
, 
sock
, 
‹¡Addr
.
s_addr
);

659 
	`şo£Sock‘
(
sock
);

662 ià(!
loİbackWÜks
) do {

665 
ho¡Çme
[100];

666 
ho¡Çme
[0] = '\0';

667 
»suÉ
 = 
	`g‘ho¡Çme
(
ho¡Çme
,  hostname);

668 ià(
»suÉ
 !ğ0 || 
ho¡Çme
[0] == '\0') {

669 
’v
.
	`£tResuÉE¼Msg
("initial gethostname() failed");

674 
N‘Add»ssLi¡
 
	`add»s£s
(
ho¡Çme
);

675 
N‘Add»ssLi¡
::
I‹¿tÜ
 
	`™”
(
add»s£s
);

676 
N‘Add»ss
 cÚ¡* 
add»ss
;

679 
ÃtAdd»ssB™s
 
addr
 = 0;

680 (
add»ss
 = 
™”
.
	`ÃxtAdd»ss
()è!ğ
NULL
) {

681 
ÃtAdd»ssB™s
 
a
 = *Ò‘Add»ssB™s*)(
add»ss
->
	`d©a
());

682 ià(!
	`badAdd»ssFÜUs
(
a
)) {

683 
addr
 = 
a
;

689 
äomAddr
.
sš_addr
.
s_addr
 = 
addr
;

693 
ÃtAdd»ssB™s
 
äom
 = 
äomAddr
.
sš_addr
.
s_addr
;

694 ià(
	`badAdd»ssFÜUs
(
äom
)) {

695 
tmp
[100];

696 
	`¥rštf
(
tmp
, "Thi compu‹¸ha ª inv®id IP‡dd»ss: %s", 
	`Add»ssSŒšg
(
äom
).
	`v®
());

697 
’v
.
	`£tResuÉMsg
(
tmp
);

698 
äom
 = 0;

701 
ourAdd»ss
 = 
äom
;

705 
timev®
 
timeNow
;

706 
	`g‘timeofday
(&
timeNow
, 
NULL
);

707 
£ed
 = 
ourAdd»ss
^
timeNow
.
tv_£c
^timeNow.
tv_u£c
;

708 
	`our_¤ªdom
(
£ed
);

710  
ourAdd»ss
;

713 
ÃtAdd»ssB™s
 
	`choo£RªdomIPv4SSMAdd»ss
(
U§geEnvœÚm’t
& 
’v
) {

715 (è
	`ourIPAdd»ss
(
’v
);

719 
ÃtAdd»ssB™s
 cÚ¡ 
fœ¡
 = 0xE8000100, 
Ï¡Plus1
 = 0xE8FFFFFF;

720 
ÃtAdd»ssB™s
 cÚ¡ 
¿nge
 = 
Ï¡Plus1
 - 
fœ¡
;

722  
	`Áohl
(
fœ¡
 + ((
ÃtAdd»ssB™s
)
	`our_¿ndom
())%
¿nge
);

725 cÚ¡* 
	`time¡ampSŒšg
() {

726 
timev®
 
tvNow
;

727 
	`g‘timeofday
(&
tvNow
, 
NULL
);

729 #ià!
	`defšed
(
_WIN32_WCE
)

730 
timeSŒšg
[9];

732 
time_t
 
tvNow_t
 = 
tvNow
.
tv_£c
;

733 cÚ¡* 
ùimeResuÉ
 = 
	`ùime
(&
tvNow_t
);

734 ià(
ùimeResuÉ
 =ğ
NULL
) {

735 
	`¥rštf
(
timeSŒšg
, "??:??:??");

737 cÚ¡* 
äom
 = &
ùimeResuÉ
[11];

738 
i
;

739 
i
 = 0; i < 8; ++i) {

740 
timeSŒšg
[
i
] = 
äom
[i];

742 
timeSŒšg
[
i
] = '\0';

748 
timeSŒšg
[50];

749 
	`¥rštf
(
timeSŒšg
, "%lu.%06ld", 
tvNow
.
tv_£c
,vNow.
tv_u£c
);

752  (cÚ¡*)&
timeSŒšg
;

755 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

759 
LONG
 
š™ŸlizeLock_g‘timeofday
 = 0;

761 #ià!
	`defšed
(
_WIN32_WCE
)

762 
	~<sys/timeb.h
>

765 
	`g‘timeofday
(
timev®
* 

, * ) {

766 
LARGE_INTEGER
 
tickF»qu’cy
, 
•ochOff£t
;

768 
BoŞ—n
 
isIn™Ÿlized
 = 
F®£
;

770 
LARGE_INTEGER
 
tickNow
;

772 #ià!
	`defšed
(
_WIN32_WCE
)

773 
	`Qu”yP”fÜmªûCouÁ”
(&
tickNow
);

775 
tickNow
.
QuadP¬t
 = 
	`G‘TickCouÁ
();

778 ià(!
isIn™Ÿlized
) {

779 if(1 =ğ
	`IÁ”lockedInüem’t
(&
š™ŸlizeLock_g‘timeofday
)) {

780 #ià!
	`defšed
(
_WIN32_WCE
)

783 
timeb
 
tb
;

784 
	`áime
(&
tb
);

785 

->
tv_£c
 = 
tb
.
time
;

786 

->
tv_u£c
 = 1000*
tb
.
ml™m
;

789 
	`Qu”yP”fÜmªûF»qu’cy
(&
tickF»qu’cy
);

792 cÚ¡ 
LONGLONG
 
•och
 = 116444736000000000LL;

793 
FILETIME
 
feTime
;

794 
LARGE_INTEGER
 
time
;

795 
	`G‘Sy¡emTimeAsFeTime
(&
feTime
);

797 
time
.
HighP¬t
 = 
feTime
.
dwHighD©eTime
;

798 
time
.
LowP¬t
 = 
feTime
.
dwLowD©eTime
;

801 

->
tv_£c
 = ()((
time
.
QuadP¬t
 - 
•och
) / 10000000L);

809 

->
tv_u£c
 = 0;

812 
tickF»qu’cy
.
QuadP¬t
 = 1000;

815 
•ochOff£t
.
QuadP¬t


816 ğ

->
tv_£c
 * 
tickF»qu’cy
.
QuadP¬t
 + (->
tv_u£c
 *ickF»qu’cy.QuadP¬tè/ 1000000L - 
tickNow
.QuadPart;

819 
isIn™Ÿlized
 = 
True
;

822 
	`IÁ”lockedDeüem’t
(&
š™ŸlizeLock_g‘timeofday
);

824 !
isIn™Ÿlized
){

825 
	`SË•
(1);

831 
tickNow
.
QuadP¬t
 +ğ
•ochOff£t
.QuadPart;

833 

->
tv_£c
 = ()(
tickNow
.
QuadP¬t
 / 
tickF»qu’cy
.QuadPart);

834 

->
tv_u£c
 = ()(((
tickNow
.
QuadP¬t
 % 
tickF»qu’cy
.QuadPart) * 1000000L) /ickFrequency.QuadPart);

	@groupsock/IOHandlers.cpp

21 
	~"IOHªdËrs.hh
"

22 
	~"TuÂ–Enÿps.hh
"

26 cÚ¡ 
	gmaxPack‘L’gth
 = 50*1024;

33 cÚ¡ 
	gioBufãrSize


34 ğ
maxPack‘L’gth
 + 
TuÂ–EnÿpsuÏtiÚT¿”MaxSize
;

35 
	gioBufãr
[
ioBufãrSize
];

38 
	$sock‘R—dHªdËr
(
Sock‘
* 
sock
, ) {

39 
by‹sR—d
;

40 
sockaddr_š
 
äomAdd»ss
;

41 
U§geEnvœÚm’t
& 
§veEnv
 = 
sock
->
	`’v
();

43 ià(!
sock
->
	`hªdËR—d
(
ioBufãr
, 
ioBufãrSize
, 
by‹sR—d
, 
äomAdd»ss
)) {

44 
§veEnv
.
	`»pÜtBackgroundE¼Ü
();

46 
	}
}

	@groupsock/NetAddress.cpp

21 
	~"N‘Add»ss.hh
"

22 
	~"GroupsockH–³r.hh
"

24 
	~<¡ddef.h
>

25 
	~<¡dio.h
>

26 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

27 
	#USE_GETHOSTBYNAME
 1

	)

29 #iâdeà
INADDR_NONE


30 
	#INADDR_NONE
 0xFFFFFFFF

	)

36 
	gN‘Add»ss
::
	$N‘Add»ss
(
u_št8_t
 cÚ¡* 
d©a
, 
Ëngth
) {

37 
	`assign
(
d©a
, 
Ëngth
);

38 
	}
}

40 
	gN‘Add»ss
::
	$N‘Add»ss
(
Ëngth
) {

41 
fD©a
 = 
Ãw
 
u_št8_t
[
Ëngth
];

42 ià(
fD©a
 =ğ
NULL
) {

43 
fL’gth
 = 0;

47 
i
 = 0; i < 
Ëngth
; ++iè
fD©a
[i] = 0;

48 
fL’gth
 = 
Ëngth
;

49 
	}
}

51 
	gN‘Add»ss
::
	$N‘Add»ss
(
N‘Add»ss
 cÚ¡& 
Üig
) {

52 
	`assign
(
Üig
.
	`d©a
(), orig.
	`Ëngth
());

53 
	}
}

55 
	gN‘Add»ss
& N‘Add»ss::
İ”©Ü
=(
N‘Add»ss
 cÚ¡& 
rightSide
) {

56 ià(&
rightSide
 !ğ
this
) {

57 
ş—n
();

58 
assign
(
rightSide
.
d©a
(),„ightSide.
Ëngth
());

60  *
	gthis
;

63 
	gN‘Add»ss
::~
	$N‘Add»ss
() {

64 
	`ş—n
();

65 
	}
}

67 
	gN‘Add»ss
::
	$assign
(
u_št8_t
 cÚ¡* 
d©a
, 
Ëngth
) {

68 
fD©a
 = 
Ãw
 
u_št8_t
[
Ëngth
];

69 ià(
fD©a
 =ğ
NULL
) {

70 
fL’gth
 = 0;

74 
i
 = 0; i < 
Ëngth
; ++iè
fD©a
[i] = 
d©a
[i];

75 
fL’gth
 = 
Ëngth
;

76 
	}
}

78 
	gN‘Add»ss
::
	$ş—n
() {

79 
d–‘e
[] 
fD©a
; fD©¨ğ
NULL
;

80 
fL’gth
 = 0;

81 
	}
}

86 
	gN‘Add»ssLi¡
::
	$N‘Add»ssLi¡
(cÚ¡* 
ho¡Çme
)

87 : 
	`fNumAdd»s£s
(0), 
	$fAdd»ssA¼ay
(
NULL
) {

89 
ÃtAdd»ssB™s
 
addr
 = 
	`our_š‘_addr
((*)
ho¡Çme
);

90 ià(
addr
 !ğ
INADDR_NONE
) {

92 
fNumAdd»s£s
 = 1;

93 
fAdd»ssA¼ay
 = 
Ãw
 
N‘Add»ss
*[
fNumAdd»s£s
];

94 ià(
fAdd»ssA¼ay
 =ğ
NULL
) ;

96 
fAdd»ssA¼ay
[0] = 
Ãw
 
	`N‘Add»ss
((
u_št8_t
*)&
addr
,  (
ÃtAdd»ssB™s
));

101 #ià
	`defšed
(
USE_GETHOSTBYNAME
è|| defšed(
VXWORKS
)

102 
ho¡’t
* 
ho¡
;

103 #ià
	`defšed
(
VXWORKS
)

104 
ho¡’tBuf
[512];

106 
ho¡
 = (
ho¡’t
*)
	`»sŞvG‘Ho¡ByName
((*)
ho¡Çme
, (*)&
ho¡’tBuf
,  hostentBuf);

108 
ho¡
 = 
	`g‘ho¡byÇme
((*)
ho¡Çme
);

110 ià(
ho¡
 =ğ
NULL
 || ho¡->
h_Ëngth
 !ğ4 || ho¡->
h_addr_li¡
 == NULL) ;

112 
u_št8_t
 cÚ¡** cÚ¡ 
hAddrPŒ
 = (u_št8_ˆcÚ¡**)
ho¡
->
h_addr_li¡
;

114 
u_št8_t
 cÚ¡** 
hAddrPŒ1
 = 
hAddrPŒ
;

115 *
hAddrPŒ1
 !ğ
NULL
) {

116 ++
fNumAdd»s£s
;

117 ++
hAddrPŒ1
;

121 
fAdd»ssA¼ay
 = 
Ãw
 
N‘Add»ss
*[
fNumAdd»s£s
];

122 ià(
fAdd»ssA¼ay
 =ğ
NULL
) ;

124 
i
 = 0; i < 
fNumAdd»s£s
; ++i) {

125 
fAdd»ssA¼ay
[
i
] = 
Ãw
 
	`N‘Add»ss
(
hAddrPŒ
[i], 
ho¡
->
h_Ëngth
);

129 
addršfo
 
addršfoHšts
;

130 
	`mem£t
(&
addršfoHšts
, 0, ‡ddrinfoHints);

131 
addršfoHšts
.
ai_çmy
 = 
AF_INET
;

132 
addršfo
* 
addršfoResuÉPŒ
 = 
NULL
;

133 
»suÉ
 = 
	`g‘addršfo
(
ho¡Çme
, 
NULL
, &
addršfoHšts
, &
addršfoResuÉPŒ
);

134 ià(
»suÉ
 !ğ0 || 
addršfoResuÉPŒ
 =ğ
NULL
) ;

137 cÚ¡ 
addršfo
* 
p
 = 
addršfoResuÉPŒ
;

138 
p
 !ğ
NULL
) {

139 ià(
p
->
ai_add¾’
 < 4) ;

140 ++
fNumAdd»s£s
;

141 
p
 =…->
ai_Ãxt
;

145 
fAdd»ssA¼ay
 = 
Ãw
 
N‘Add»ss
*[
fNumAdd»s£s
];

146 ià(
fAdd»ssA¼ay
 =ğ
NULL
) ;

148 
i
 = 0;

149 
p
 = 
addršfoResuÉPŒ
;

150 
p
 !ğ
NULL
) {

151 ià(
p
->
ai_add¾’
 < 4) ;

152 
fAdd»ssA¼ay
[
i
++] = 
Ãw
 
	`N‘Add»ss
((
u_št8_t
 cÚ¡*)&(((
sockaddr_š
*)
p
->
ai_addr
)->
sš_addr
.
s_addr
), 4);

153 
p
 =…->
ai_Ãxt
;

157 
	`ä“addršfo
(
addršfoResuÉPŒ
);

159 
	}
}

161 
	gN‘Add»ssLi¡
::
	$N‘Add»ssLi¡
(
N‘Add»ssLi¡
 cÚ¡& 
Üig
) {

162 
	`assign
(
Üig
.
	`numAdd»s£s
(), orig.
fAdd»ssA¼ay
);

163 
	}
}

165 
	gN‘Add»ssLi¡
& N‘Add»ssLi¡::
İ”©Ü
=(
N‘Add»ssLi¡
 cÚ¡& 
rightSide
) {

166 ià(&
rightSide
 !ğ
this
) {

167 
ş—n
();

168 
assign
(
rightSide
.
numAdd»s£s
(),„ightSide.
fAdd»ssA¼ay
);

170  *
	gthis
;

173 
	gN‘Add»ssLi¡
::~
	$N‘Add»ssLi¡
() {

174 
	`ş—n
();

175 
	}
}

177 
	gN‘Add»ssLi¡
::
	$assign
(
numAdd»s£s
, 
N‘Add»ss
** 
add»ssA¼ay
) {

178 
fAdd»ssA¼ay
 = 
Ãw
 
N‘Add»ss
*[
numAdd»s£s
];

179 ià(
fAdd»ssA¼ay
 =ğ
NULL
) {

180 
fNumAdd»s£s
 = 0;

184 
i
 = 0; i < 
numAdd»s£s
; ++i) {

185 
fAdd»ssA¼ay
[
i
] = 
Ãw
 
	`N‘Add»ss
(*
add»ssA¼ay
[i]);

187 
fNumAdd»s£s
 = 
numAdd»s£s
;

188 
	}
}

190 
	gN‘Add»ssLi¡
::
	$ş—n
() {

191 
fNumAdd»s£s
-- > 0) {

192 
d–‘e
 
fAdd»ssA¼ay
[
fNumAdd»s£s
];

194 
d–‘e
[] 
fAdd»ssA¼ay
; fAdd»ssA¼ay = 
NULL
;

195 
	}
}

197 
N‘Add»ss
 cÚ¡* 
	gN‘Add»ssLi¡
::
	$fœ¡Add»ss
() const {

198 ià(
fNumAdd»s£s
 =ğ0è 
NULL
;

200  
fAdd»ssA¼ay
[0];

201 
	}
}

204 
	gN‘Add»ssLi¡
::
I‹¿tÜ
::
	$I‹¿tÜ
(
N‘Add»ssLi¡
 cÚ¡& 
add»ssLi¡
)

205 : 
	`fAdd»ssLi¡
(
add»ssLi¡
), 
	$fNextIndex
(0è{
	}
}

207 
N‘Add»ss
 cÚ¡* 
	gN‘Add»ssLi¡
::
I‹¿tÜ
::
	$ÃxtAdd»ss
() {

208 ià(
fNextIndex
 >ğ
fAdd»ssLi¡
.
	`numAdd»s£s
()è 
NULL
;

209  
fAdd»ssLi¡
.
fAdd»ssA¼ay
[
fNextIndex
++];

210 
	}
}

215 
	gPÜt
::
	$PÜt
(
pÜtNumB™s
 
num
 ) {

216 
fPÜtNum
 = 
	`htÚs
(
num
);

217 
	}
}

219 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	gs
, cÚ¡ 
	gPÜt
& 
	gp
) {

220  
	gs
 << 
Áohs
(
p
.
num
());

226 
	gAdd»ssPÜtLookupTabË
::
	$Add»ssPÜtLookupTabË
()

227 : 
	`fTabË
(
HashTabË
::
	$ü—‹
(3)) {

228 
	}
}

230 
Add»ssPÜtLookupTabË
::~
	$Add»ssPÜtLookupTabË
() {

231 
d–‘e
 
fTabË
;

232 
	}
}

234 * 
	gAdd»ssPÜtLookupTabË
::
	$Add
(
ÃtAdd»ssB™s
 
add»ss1
,

235 
ÃtAdd»ssB™s
 
add»ss2
,

236 
PÜt
 
pÜt
, * 
v®ue
) {

237 
key
[3];

238 
key
[0] = ()
add»ss1
;

239 
key
[1] = ()
add»ss2
;

240 
key
[2] = ()
pÜt
.
	`num
();

241  
fTabË
->
	`Add
((*)
key
, 
v®ue
);

242 
	}
}

244 * 
	gAdd»ssPÜtLookupTabË
::
	$Lookup
(
ÃtAdd»ssB™s
 
add»ss1
,

245 
ÃtAdd»ssB™s
 
add»ss2
,

246 
PÜt
 
pÜt
) {

247 
key
[3];

248 
key
[0] = ()
add»ss1
;

249 
key
[1] = ()
add»ss2
;

250 
key
[2] = ()
pÜt
.
	`num
();

251  
fTabË
->
	`Lookup
((*)
key
);

252 
	}
}

254 
BoŞ—n
 
	gAdd»ssPÜtLookupTabË
::
	$Remove
(
ÃtAdd»ssB™s
 
add»ss1
,

255 
ÃtAdd»ssB™s
 
add»ss2
,

256 
PÜt
 
pÜt
) {

257 
key
[3];

258 
key
[0] = ()
add»ss1
;

259 
key
[1] = ()
add»ss2
;

260 
key
[2] = ()
pÜt
.
	`num
();

261  
fTabË
->
	`Remove
((*)
key
);

262 
	}
}

264 
	gAdd»ssPÜtLookupTabË
::
I‹¿tÜ
::
	$I‹¿tÜ
(
Add»ssPÜtLookupTabË
& 
bË
)

265 : 
	`fI‹r
(
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*(
bË
.
fTabË
))) {

266 
	}
}

268 
Add»ssPÜtLookupTabË
::
I‹¿tÜ
::~
	$I‹¿tÜ
() {

269 
d–‘e
 
fI‹r
;

270 
	}
}

272 * 
	gAdd»ssPÜtLookupTabË
::
I‹¿tÜ
::
	$Ãxt
() {

273 cÚ¡* 
key
;

274  
fI‹r
->
	`Ãxt
(
key
);

275 
	}
}

280 
BoŞ—n
 
	$IsMuÉiÿ¡Add»ss
(
ÃtAdd»ssB™s
 
add»ss
) {

284 
ÃtAdd»ssB™s
 
add»ssInN‘wÜkOrd”
 = 
	`htÚl
(
add»ss
);

285  
add»ssInN‘wÜkOrd”
 > 0xE00000FF &&

286 
add»ssInN‘wÜkOrd”
 <= 0xEFFFFFFF;

287 
	}
}

292 
	gAdd»ssSŒšg
::
	$Add»ssSŒšg
(
sockaddr_š
 cÚ¡& 
addr
) {

293 
	`š™
(
addr
.
sš_addr
.
s_addr
);

294 
	}
}

296 
	gAdd»ssSŒšg
::
	$Add»ssSŒšg
(
š_addr
 cÚ¡& 
addr
) {

297 
	`š™
(
addr
.
s_addr
);

298 
	}
}

300 
	gAdd»ssSŒšg
::
	$Add»ssSŒšg
(
ÃtAdd»ssB™s
 
addr
) {

301 
	`š™
(
addr
);

302 
	}
}

304 
	gAdd»ssSŒšg
::
	$š™
(
ÃtAdd»ssB™s
 
addr
) {

305 
fV®
 = 
Ãw
 [16];

306 
ÃtAdd»ssB™s
 
addrNBO
 = 
	`htÚl
(
addr
);

307 
	`¥rštf
(
fV®
, "%u.%u.%u.%u", (
addrNBO
>>24)&0xFF, (addrNBO>>16)&0xFF, (addrNBO>>8)&0xFF,‡ddrNBO&0xFF);

308 
	}
}

310 
	gAdd»ssSŒšg
::~
	$Add»ssSŒšg
() {

311 
d–‘e
[] 
fV®
;

312 
	}
}

	@groupsock/NetInterface.cpp

21 
	~"N‘IÁ”çû.hh
"

22 
	~"GroupsockH–³r.hh
"

24 #iâdeà
NO_SSTREAM


25 
	~<s¡»am
>

27 
	~<¡dio.h
>

31 
U§geEnvœÚm’t
* 
	gN‘IÁ”çû
::
DeçuÉU§geEnvœÚm’t
 = 
NULL
;

33 
	gN‘IÁ”çû
::
	$N‘IÁ”çû
() {

34 
	}
}

36 
N‘IÁ”çû
::~
	$N‘IÁ”çû
() {

37 
	}
}

42 
DœeùedN‘IÁ”çû
::
	$DœeùedN‘IÁ”çû
() {

43 
	}
}

45 
DœeùedN‘IÁ”çû
::~
	$DœeùedN‘IÁ”çû
() {

46 
	}
}

51 
DœeùedN‘IÁ”çûS‘
::
	$DœeùedN‘IÁ”çûS‘
()

52 : 
	`fTabË
(
HashTabË
::
	$ü—‹
(
ONE_WORD_HASH_KEYS
)) {

53 
	}
}

55 
DœeùedN‘IÁ”çûS‘
::~
	$DœeùedN‘IÁ”çûS‘
() {

56 
d–‘e
 
fTabË
;

57 
	}
}

59 
DœeùedN‘IÁ”çû
*

60 
	gDœeùedN‘IÁ”çûS‘
::
	$Add
(
DœeùedN‘IÁ”çû
 cÚ¡* 
š‹rf
) {

61  (
DœeùedN‘IÁ”çû
*è
fTabË
->
	`Add
((*)
š‹rf
, (*)interf);

62 
	}
}

64 
BoŞ—n


65 
	gDœeùedN‘IÁ”çûS‘
::
	$Remove
(
DœeùedN‘IÁ”çû
 cÚ¡* 
š‹rf
) {

66  
fTabË
->
	`Remove
((*)
š‹rf
);

67 
	}
}

69 
	gDœeùedN‘IÁ”çûS‘
::
I‹¿tÜ
::

70 
	$I‹¿tÜ
(
DœeùedN‘IÁ”çûS‘
& 
š‹rçûs
)

71 : 
	`fI‹r
(
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*(
š‹rçûs
.
fTabË
))) {

72 
	}
}

74 
DœeùedN‘IÁ”çûS‘
::
I‹¿tÜ
::~
	$I‹¿tÜ
() {

75 
d–‘e
 
fI‹r
;

76 
	}
}

78 
DœeùedN‘IÁ”çû
* 
	gDœeùedN‘IÁ”çûS‘
::
I‹¿tÜ
::
	$Ãxt
() {

79 cÚ¡* 
key
;

80  (
DœeùedN‘IÁ”çû
*è
fI‹r
->
	`Ãxt
(
key
);

81 
	}
};

86 
	gSock‘
::
DebugLev–
 = 1;

88 
	gSock‘
::
	$Sock‘
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
pÜt
)

89 : 
	`fEnv
(
DeçuÉU§geEnvœÚm’t
 !ğ
NULL
 ? *DeçuÉU§geEnvœÚm’ˆ: 
’v
), 
	$fPÜt
(
pÜt
) {

90 
fSock‘Num
 = 
	`£tupD©ag¿mSock‘
(
fEnv
, 
pÜt
);

91 
	}
}

93 
	gSock‘
::
	$»£t
() {

94 
	`şo£Sock‘
(
fSock‘Num
);

95 
fSock‘Num
 = -1;

96 
	}
}

98 
	gSock‘
::~
	$Sock‘
() {

99 
	`»£t
();

100 
	}
}

102 
BoŞ—n
 
	gSock‘
::
	$chªgePÜt
(
PÜt
 
ÃwPÜt
) {

103 
ŞdSock‘Num
 = 
fSock‘Num
;

104 
ŞdReûiveBufãrSize
 = 
	`g‘ReûiveBufãrSize
(
fEnv
, 
fSock‘Num
);

105 
ŞdS’dBufãrSize
 = 
	`g‘S’dBufãrSize
(
fEnv
, 
fSock‘Num
);

106 
	`şo£Sock‘
(
fSock‘Num
);

108 
fSock‘Num
 = 
	`£tupD©ag¿mSock‘
(
fEnv
, 
ÃwPÜt
);

109 ià(
fSock‘Num
 < 0) {

110 
fEnv
.
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
ŞdSock‘Num
);

111  
F®£
;

114 
	`£tReûiveBufãrTo
(
fEnv
, 
fSock‘Num
, 
ŞdReûiveBufãrSize
);

115 
	`£tS’dBufãrTo
(
fEnv
, 
fSock‘Num
, 
ŞdS’dBufãrSize
);

116 ià(
fSock‘Num
 !ğ
ŞdSock‘Num
) {

117 
fEnv
.
	`skScheduËr
().
	`moveSock‘Hªdlšg
(
ŞdSock‘Num
, 
fSock‘Num
);

119  
True
;

120 
	}
}

122 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	gs
, cÚ¡ 
	gSock‘
& 
	gsock
) {

123  
	gs
 << 
time¡ampSŒšg
(è<< " Sock‘(" << 
	gsock
.
sock‘Num
() << ")";

128 
	gSock‘LookupTabË
::
	$Sock‘LookupTabË
()

129 : 
	`fTabË
(
HashTabË
::
	$ü—‹
(
ONE_WORD_HASH_KEYS
)) {

130 
	}
}

132 
Sock‘LookupTabË
::~
	$Sock‘LookupTabË
() {

133 
d–‘e
 
fTabË
;

134 
	}
}

136 
Sock‘
* 
	gSock‘LookupTabË
::
	$F‘ch
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
pÜt
,

137 
BoŞ—n
& 
isNew
) {

138 
isNew
 = 
F®£
;

139 
Sock‘
* 
sock
;

141 
sock
 = (
Sock‘
*è
fTabË
->
	`Lookup
((*)()(
pÜt
.
	`num
()));

142 ià(
sock
 =ğ
NULL
) {

143 
sock
 = 
	`C»©eNew
(
’v
, 
pÜt
);

144 ià(
sock
 =ğ
NULL
 || sock->
	`sock‘Num
() < 0) ;

146 
fTabË
->
	`Add
((*)()(
pÜt
.
	`num
()), (*)
sock
);

147 
isNew
 = 
True
;

150  
sock
;

153 
d–‘e
 
sock
;

154  
NULL
;

155 
	}
}

157 
BoŞ—n
 
	gSock‘LookupTabË
::
	$Remove
(
Sock‘
 cÚ¡* 
sock
) {

158  
fTabË
->
	`Remove
Ğ(*)()(
sock
->
	`pÜt
().
	`num
()) );

159 
	}
}

163 
	gN‘IÁ”çûT¿fficSts
::
	$N‘IÁ”çûT¿fficSts
() {

164 
fTÙNumPack‘s
 = 
fTÙNumBy‹s
 = 0.0;

165 
	}
}

167 
	gN‘IÁ”çûT¿fficSts
::
	$couÁPack‘
(
·ck‘Size
) {

168 
fTÙNumPack‘s
 += 1.0;

169 
fTÙNumBy‹s
 +ğ
·ck‘Size
;

170 
	}
}

172 
BoŞ—n
 
	gN‘IÁ”çûT¿fficSts
::
	$haveS“nT¿ffic
() const {

173  
fTÙNumPack‘s
 != 0.0;

174 
	}
}

	@groupsock/include/NetCommon.h

21 #iâdeà
_NET_COMMON_H


22 
	#_NET_COMMON_H


	)

24 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_WIN32_WCE
)

26 #ià
defšed
(
WINNT
è|| defšed(
_WINNT
è|| defšed(
__BORLANDC__
è|| defšed(
__MINGW32__
è|| defšed(
_WIN32_WCE
è|| defšed (
_MSC_VER
)

27 
	#_MSWSOCK_


	)

28 
	~<wšsock2.h
>

29 
	~<ws2tı.h
>

31 
	~<wšdows.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

35 
	#şo£Sock‘
 
şo£sock‘


	)

36 #ifdeà
EWOULDBLOCK


37 #undeà
EWOULDBLOCK


39 #ifdeà
EINPROGRESS


40 #undeà
EINPROGRESS


42 #ifdeà
EAGAIN


43 #undeà
EAGAIN


45 #ifdeà
EINTR


46 #undeà
EINTR


48 
	#EWOULDBLOCK
 
WSAEWOULDBLOCK


	)

49 
	#EINPROGRESS
 
WSAEWOULDBLOCK


	)

50 
	#EAGAIN
 
WSAEWOULDBLOCK


	)

51 
	#EINTR
 
WSAEINTR


	)

53 #ià
defšed
(
_WIN32_WCE
)

54 
	#NO_STRSTREAM
 1

	)

58 
__št64
 
	tšt64_t
;

59 
	t__št64
 
	tu_št64_t
;

61 
	tšt32_t
;

62 
	tu_št32_t
;

64 
	tšt16_t
;

65 
	tu_št16_t
;

67 
	tu_št8_t
;

71 #ià!
defšed
(
_MSC_STDINT_H_
è&& !defšed(
_UINTPTR_T_DEFINED
è&& !defšed(
_UINTPTR_T_DECLARED
è&& !defšed(
_UINTPTR_T
)

72 
	tušŒ_t
;

74 #ià!
defšed
(
_MSC_STDINT_H_
è&& !defšed(
_INTPTR_T_DEFINED
è&& !defšed(
_INTPTR_T_DECLARED
è&& !defšed(
_INTPTR_T
)

75 
	tšŒ_t
;

78 #–ià
defšed
(
VXWORKS
)

80 
	~<time.h
>

81 
	~<tim”s.h
>

82 
	~<sys/times.h
>

83 
	~<sockLib.h
>

84 
	~<ho¡Lib.h
>

85 
	~<»sŞvLib.h
>

86 
	~<ioLib.h
>

88 
	tu_št32_t
;

89 
	tu_št16_t
;

90 
	tu_št8_t
;

94 
	~<sys/ty³s.h
>

95 
	~<sys/sock‘.h
>

96 
	~<sys/time.h
>

97 
	~<Ãtš‘/š.h
>

98 
	~<¬·/š‘.h
>

99 
	~<Ãtdb.h
>

100 
	~<uni¡d.h
>

101 
	~<¡ršg.h
>

102 
	~<¡dlib.h
>

103 
	~<”ºo.h
>

104 
	~<¡ršgs.h
>

105 
	~<ùy³.h
>

106 
	~<¡dšt.h
>

107 #ià
defšed
(
_QNX4
)

108 
	~<sys/£Ëù.h
>

109 
	~<unix.h
>

112 
	#şo£Sock‘
 
şo£


	)

114 #ifdeà
SOLARIS


115 
	#u_št64_t
 
ušt64_t


	)

116 
	#u_št32_t
 
ušt32_t


	)

117 
	#u_št16_t
 
ušt16_t


	)

118 
	#u_št8_t
 
ušt8_t


	)

122 #iâdeà
SOCKLEN_T


123 
	#SOCKLEN_T
 

	)

	@groupsock/inet.c

1 #iâdeà
_NET_COMMON_H


2 
	~"N‘CommÚ.h
"

5 
	~<¡dio.h
>

7 #ifdeà
VXWORKS


8 
	~<š‘Lib.h
>

15 
	$our_š‘_addr
(
ı
)

16 cÚ¡* 
ı
;

18  
	`š‘_addr
(
ı
);

19 
	}
}

21 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

22 #iâdeà
IMN_PIM


23 
	#WS_VERSION_CHOICE1
 0x202

	)

24 
	#WS_VERSION_CHOICE2
 0x101

	)

25 
	$š™ŸlizeWšsockIfNeûs§ry
() {

29 
_haveIn™ŸlizedWšsock
 = 0;

30 
WSADATA
 
w§d©a
;

32 ià(!
_haveIn™ŸlizedWšsock
) {

33 ià((
	`WSAS¹up
(
WS_VERSION_CHOICE1
, &
w§d©a
) != 0)

34 && ((
	`WSAS¹up
(
WS_VERSION_CHOICE2
, &
w§d©a
)) != 0)) {

37 ià((
w§d©a
.
wV”siÚ
 !ğ
WS_VERSION_CHOICE1
)

38 && (
w§d©a
.
wV”siÚ
 !ğ
WS_VERSION_CHOICE2
)) {

39 
	`WSACËªup
();

42 
_haveIn™ŸlizedWšsock
 = 1;

46 
	}
}

48 
	$š™ŸlizeWšsockIfNeûs§ry
(è{  1; 
	}
}

51 
	#š™ŸlizeWšsockIfNeûs§ry
(è1

	)

54 #iâdeà
NULL


55 
	#NULL
 0

	)

58 #ifdeà
USE_SYSTEM_RANDOM


60 
	~<¡dlib.h
>

61 
	$our_¿ndom
() {

62 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

63  
	`¿nd
();

65  
	`¿ndom
();

67 
	}
}

68 
	$our_¤ªdom
(
x
) {

69 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

70 
	`¤ªd
(
x
);

72 
	`¤ªdom
(
x
);

74 
	}
}

126 
	#TYPE_0
 0

	)

127 
	#BREAK_0
 8

	)

128 
	#DEG_0
 0

	)

129 
	#SEP_0
 0

	)

131 
	#TYPE_1
 1

	)

132 
	#BREAK_1
 32

	)

133 
	#DEG_1
 7

	)

134 
	#SEP_1
 3

	)

136 
	#TYPE_2
 2

	)

137 
	#BREAK_2
 64

	)

138 
	#DEG_2
 15

	)

139 
	#SEP_2
 1

	)

141 
	#TYPE_3
 3

	)

142 
	#BREAK_3
 128

	)

143 
	#DEG_3
 31

	)

144 
	#SEP_3
 3

	)

146 
	#TYPE_4
 4

	)

147 
	#BREAK_4
 256

	)

148 
	#DEG_4
 63

	)

149 
	#SEP_4
 1

	)

155 
	#MAX_TYPES
 5

	)

157 cÚ¡ 
	gdeg»es
[
MAX_TYPES
] = { 
DEG_0
, 
DEG_1
, 
DEG_2
, 
DEG_3
, 
DEG_4
 };

158 cÚ¡ 
	g£ps
 [
MAX_TYPES
] = { 
SEP_0
, 
SEP_1
, 
SEP_2
, 
SEP_3
, 
SEP_4
 };

174 
	g¿ndtbl
[
DEG_3
 + 1] = {

175 
TYPE_3
,

198 * 
	gåŒ
 = &
¿ndtbl
[
SEP_3
 + 1];

199 * 
	g½Œ
 = &
¿ndtbl
[1];

211 *
	g¡©e
 = &
¿ndtbl
[1];

212 
	g¿nd_ty³
 = 
TYPE_3
;

213 
	g¿nd_deg
 = 
DEG_3
;

214 
	g¿nd_£p
 = 
SEP_3
;

215 * 
	g’d_±r
 = &
¿ndtbl
[
DEG_3
 + 1];

229 
our_¿ndom
();

231 
	$our_¤ªdom
(
x
)

233 
i
;

235 ià(
¿nd_ty³
 =ğ
TYPE_0
)

236 
¡©e
[0] = 
x
;

238 
¡©e
[0] = 
x
;

239 
i
 = 1; i < 
¿nd_deg
; i++)

240 
¡©e
[
i
] = 1103515245 * state[i - 1] + 12345;

241 
åŒ
 = &
¡©e
[
¿nd_£p
];

242 
½Œ
 = &
¡©e
[0];

243 
i
 = 0; i < 10 * 
¿nd_deg
; i++)

244 ()
	`our_¿ndom
();

246 
	}
}

268 
	$our_š™¡©e
(
£ed
, 
¬g_¡©e
, 
n
)

269 
£ed
;

270 *
¬g_¡©e
;

271 
n
;

273 *
o¡©e
 = (*)(&
¡©e
[-1]);

275 ià(
¿nd_ty³
 =ğ
TYPE_0
)

276 
¡©e
[-1] = 
¿nd_ty³
;

278 
¡©e
[-1] = 
MAX_TYPES
 * (
½Œ
 - s‹è+ 
¿nd_ty³
;

279 ià(
n
 < 
BREAK_0
) {

280 #ifdeà
DEBUG


281 ()
	`årštf
(
¡d”r
,

282 "¿ndom:‚Ùƒnough s‹ (%d by‹s); ignÜed.\n", 
n
);

286 ià(
n
 < 
BREAK_1
) {

287 
¿nd_ty³
 = 
TYPE_0
;

288 
¿nd_deg
 = 
DEG_0
;

289 
¿nd_£p
 = 
SEP_0
;

290 } ià(
n
 < 
BREAK_2
) {

291 
¿nd_ty³
 = 
TYPE_1
;

292 
¿nd_deg
 = 
DEG_1
;

293 
¿nd_£p
 = 
SEP_1
;

294 } ià(
n
 < 
BREAK_3
) {

295 
¿nd_ty³
 = 
TYPE_2
;

296 
¿nd_deg
 = 
DEG_2
;

297 
¿nd_£p
 = 
SEP_2
;

298 } ià(
n
 < 
BREAK_4
) {

299 
¿nd_ty³
 = 
TYPE_3
;

300 
¿nd_deg
 = 
DEG_3
;

301 
¿nd_£p
 = 
SEP_3
;

303 
¿nd_ty³
 = 
TYPE_4
;

304 
¿nd_deg
 = 
DEG_4
;

305 
¿nd_£p
 = 
SEP_4
;

307 
¡©e
 = &(((*)
¬g_¡©e
)[1]);

308 
’d_±r
 = &
¡©e
[
¿nd_deg
];

309 
	`our_¤ªdom
(
£ed
);

310 ià(
¿nd_ty³
 =ğ
TYPE_0
)

311 
¡©e
[-1] = 
¿nd_ty³
;

313 
¡©e
[-1] = 
MAX_TYPES
*(
½Œ
 - s‹è+ 
¿nd_ty³
;

314 (
o¡©e
);

315 
	}
}

333 
	$our_£t¡©e
(
¬g_¡©e
)

334 *
¬g_¡©e
;

336 *
Ãw_¡©e
 = (*)
¬g_¡©e
;

337 
ty³
 = 
Ãw_¡©e
[0] % 
MAX_TYPES
;

338 
»¬
 = 
Ãw_¡©e
[0] / 
MAX_TYPES
;

339 *
o¡©e
 = (*)(&
¡©e
[-1]);

341 ià(
¿nd_ty³
 =ğ
TYPE_0
)

342 
¡©e
[-1] = 
¿nd_ty³
;

344 
¡©e
[-1] = 
MAX_TYPES
 * (
½Œ
 - s‹è+ 
¿nd_ty³
;

345 
ty³
) {

346 
TYPE_0
:

347 
TYPE_1
:

348 
TYPE_2
:

349 
TYPE_3
:

350 
TYPE_4
:

351 
¿nd_ty³
 = 
ty³
;

352 
¿nd_deg
 = 
deg»es
[
ty³
];

353 
¿nd_£p
 = 
£ps
[
ty³
];

356 #ifdeà
DEBUG


357 ()
	`årštf
(
¡d”r
,

362 
¡©e
 = &
Ãw_¡©e
[1];

363 ià(
¿nd_ty³
 !ğ
TYPE_0
) {

364 
½Œ
 = &
¡©e
[
»¬
];

365 
åŒ
 = &
¡©e
[(
»¬
 + 
¿nd_£p
è% 
¿nd_deg
];

367 
’d_±r
 = &
¡©e
[
¿nd_deg
];

368 (
o¡©e
);

369 
	}
}

388 
	$our_¿ndom
() {

389 
i
;

391 ià(
¿nd_ty³
 =ğ
TYPE_0
) {

392 
i
 = 
¡©e
[0] = (state[0] * 1103515245 + 12345) & 0x7fffffff;

395 * 
½
 = 
½Œ
;

396 * 
å
 = 
åŒ
;

399 ià(!(
å
 =ğ
½
+
SEP_3
 || fp+
DEG_3
 ==„p+SEP_3)) {

402 ià(
½
 <ğ
å
è½ = fp-
SEP_3
; ½ = fp+
DEG_3
-SEP_3;

405 *
å
 +ğ*
½
;

406 
i
 = (*
å
 >> 1) & 0x7fffffff;

407 ià(++
å
 >ğ
’d_±r
) {

408 
å
 = 
¡©e
;

409 ++
½
;

410 } ià(++
½
 >ğ
’d_±r
) {

411 
½
 = 
¡©e
;

415 
½Œ
 = 
½
;

416 
åŒ
 = 
å
;

419  
i
;

420 
	}
}

423 
u_št32_t
 
	$our_¿ndom32
() {

429 
¿ndom_1
 = 
	`our_¿ndom
();

430 
u_št32_t
 
¿ndom16_1
 = (u_št32_t)(
¿ndom_1
&0x00FFFF00);

432 
¿ndom_2
 = 
	`our_¿ndom
();

433 
u_št32_t
 
¿ndom16_2
 = (u_št32_t)(
¿ndom_2
&0x00FFFF00);

435  (
¿ndom16_1
<<8è| (
¿ndom16_2
>>8);

436 
	}
}

438 #ifdeà
USE_OUR_BZERO


439 #iâdeà
__bz”o


441 
	$__bz”o
 (
to
, 
couÁ
)

442 *
to
;

443 
couÁ
;

445 
couÁ
-- > 0)

447 *
to
++ = 0;

449 
	}
}

	@liveMedia/AC3AudioFileServerMediaSubsession.cpp

22 
	~"AC3AudioFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"By‹SŒ—mFeSourû.hh
"

24 
	~"AC3AudioSŒ—mF¿m”.hh
"

25 
	~"AC3AudioRTPSšk.hh
"

27 
AC3AudioFeS”v”MedŸSub£ssiÚ
*

28 
	gAC3AudioFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

29 cÚ¡* 
feName
,

30 
BoŞ—n
 
»u£Fœ¡Sourû
) {

31  
Ãw
 
	`AC3AudioFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

32 
	}
}

34 
	gAC3AudioFeS”v”MedŸSub£ssiÚ


35 ::
	$AC3AudioFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

36 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

37 : 
	$FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
) {

38 
	}
}

40 
	gAC3AudioFeS”v”MedŸSub£ssiÚ
::~
	$AC3AudioFeS”v”MedŸSub£ssiÚ
() {

41 
	}
}

43 
F¿medSourû
* 
AC3AudioFeS”v”MedŸSub£ssiÚ


44 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

45 
e¡B™¿‹
 = 48;

47 
By‹SŒ—mFeSourû
* 
feSourû
 = By‹SŒ—mFeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

48 ià(
feSourû
 =ğ
NULL
)  NULL;

50  
AC3AudioSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
);

51 
	}
}

53 
RTPSšk
* 
	gAC3AudioFeS”v”MedŸSub£ssiÚ


54 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

55 
¹pPaylßdTy³IfDyÇmic
,

56 
F¿medSourû
* 
šputSourû
) {

57 
AC3AudioSŒ—mF¿m”
* 
audioSourû
 = (AC3AudioSŒ—mF¿m”*)
šputSourû
;

58  
AC3AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

59 
¹pPaylßdTy³IfDyÇmic
,

60 
audioSourû
->
	`§m¶šgR©e
());

61 
	}
}

	@liveMedia/AC3AudioRTPSink.cpp

21 
	~"AC3AudioRTPSšk.hh
"

23 
	gAC3AudioRTPSšk
::
	$AC3AudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

24 
u_št8_t
 
¹pPaylßdFÜm©
,

25 
u_št32_t
 
¹pTime¡ampF»qu’cy
)

26 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

27 
¹pTime¡ampF»qu’cy
, "AC3"),

28 
	$fTÙNumF¿gm’tsU£d
(0) {

29 
	}
}

31 
	gAC3AudioRTPSšk
::~
	$AC3AudioRTPSšk
() {

32 
	}
}

34 
AC3AudioRTPSšk
*

35 
AC3AudioRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

36 
u_št8_t
 
¹pPaylßdFÜm©
,

37 
u_št32_t
 
¹pTime¡ampF»qu’cy
) {

38  
Ãw
 
	`AC3AudioRTPSšk
(
’v
, 
RTPgs
,

39 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
);

40 
	}
}

42 
BoŞ—n
 
	gAC3AudioRTPSšk


43 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

46  
F®£
;

47 
	}
}

49 
	gAC3AudioRTPSšk


50 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

51 * 
äameS¹
,

52 
numBy‹sInF¿me
,

53 
timev®
 
äameP»£Á©iÚTime
,

54 
numRemaššgBy‹s
) {

56 
h—d”s
[2];

58 
BoŞ—n
 
isF¿gm’t
 = 
numRemaššgBy‹s
 > 0 || 
äagm’tiÚOff£t
 > 0;

59 ià(!
isF¿gm’t
) {

60 
h—d”s
[0] = 0;

61 
h—d”s
[1] = 1;

63 ià(
äagm’tiÚOff£t
 > 0) {

64 
h—d”s
[0] = 3;

67 cÚ¡ 
tÙ®F¿meSize
 = 
äagm’tiÚOff£t
 + 
numBy‹sInF¿me
 + 
numRemaššgBy‹s
;

68 cÚ¡ 
fiveEighthsPošt
 = 
tÙ®F¿meSize
/2 +otalFrameSize/8;

69 
h—d”s
[0] = 
numBy‹sInF¿me
 >ğ
fiveEighthsPošt
 ? 1 : 2;

73 
fTÙNumF¿gm’tsU£d
 = (
tÙ®F¿meSize
 + (
numBy‹sInF¿me
-1))/numBytesInFrame;

76 
h—d”s
[1] = 
fTÙNumF¿gm’tsU£d
;

79 
	`£tS³cŸlH—d”By‹s
(
h—d”s
,  headers);

81 ià(
numRemaššgBy‹s
 == 0) {

84 
	`£tM¬k”B™
();

89 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

90 
äameS¹
, 
numBy‹sInF¿me
,

91 
äameP»£Á©iÚTime
,

92 
numRemaššgBy‹s
);

93 
	}
}

95 
	gAC3AudioRTPSšk
::
	$¥ecŸlH—d”Size
() const {

97 
	}
}

	@liveMedia/AC3AudioRTPSource.cpp

21 
	~"AC3AudioRTPSourû.hh
"

23 
AC3AudioRTPSourû
*

24 
	gAC3AudioRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

25 
Groupsock
* 
RTPgs
,

26 
¹pPaylßdFÜm©
,

27 
¹pTime¡ampF»qu’cy
) {

28  
Ãw
 
	`AC3AudioRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

29 
¹pTime¡ampF»qu’cy
);

30 
	}
}

32 
	gAC3AudioRTPSourû
::
	$AC3AudioRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

33 
Groupsock
* 
¹pGS
,

34 
¹pPaylßdFÜm©
,

35 
¹pTime¡ampF»qu’cy
)

36 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
¹pGS
,

37 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

38 
	}
}

40 
	gAC3AudioRTPSourû
::~
	$AC3AudioRTPSourû
() {

41 
	}
}

43 
BoŞ—n
 
AC3AudioRTPSourû


44 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

45 & 
»suÉS³cŸlH—d”Size
) {

46 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

47 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

50 ià(
·ck‘Size
 < 2è 
F®£
;

51 
»suÉS³cŸlH—d”Size
 = 2;

53 
FT
 = 
h—d”S¹
[0]&0x03;

54 
fCu¼’tPack‘BegšsF¿me
 = 
FT
 != 3;

58 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
(è|| 
FT
 == 0;

60  
True
;

61 
	}
}

63 cÚ¡* 
	gAC3AudioRTPSourû
::
	$MIMEty³
() const {

65 
	}
}

	@liveMedia/AC3AudioStreamFramer.cpp

21 
	~"AC3AudioSŒ—mF¿m”.hh
"

22 
	~"SŒ—mP¬£r.hh
"

23 
	~<GroupsockH–³r.hh
>

27 şas 
	cAC3F¿meP¬ams
 {

28 
	mpublic
:

29 
	$AC3F¿meP¬ams
(è: 
	$§m¶šgF»q
(0) {}

32 
hdr0
, 
hdr1
;

35 
kbps
, 
§m¶šgF»q
, 
äameSize
;

37 
	`£tP¬amsFromH—d”
();

38 
	}
};

40 şas 
	cAC3AudioSŒ—mP¬£r
: 
public
 
SŒ—mP¬£r
 {

41 
public
:

42 
AC3AudioSŒ—mP¬£r
(
AC3AudioSŒ—mF¿m”
* 
usšgSourû
,

43 
F¿medSourû
* 
šputSourû
);

44 
	mvœtu®
 ~
AC3AudioSŒ—mP¬£r
();

46 
	mpublic
:

47 
‹¡SŒ—mCode
(
ourSŒ—mCode
,

48 * 
±r
, 
size
);

49 
·r£F¿me
(& 
numTrunÿ‹dBy‹s
);

52 
»gi¡”R—dIÁ”e¡
(* 
to
, 
maxSize
);

54 
AC3F¿meP¬ams
 cÚ¡& 
	$cu¼’tF¿me
(ècÚ¡ {  
fCu¼’tF¿me
; }

56 
BoŞ—n
 
	$haveP¬£dAF¿me
(ècÚ¡ {  
fHaveP¬£dAF¿me
; 
	}
}

57 
»adAndSaveAF¿me
();

59 
	g´iv©e
:

60 
aá”G‘tšgSavedF¿me
(* 
ş›ÁD©a
, 
äameSize
,

61 
numTrunÿ‹dBy‹s
,

62 
timev®
 
´e£Á©iÚTime
,

63 
du¿tiÚInMiüo£cÚds
);

64 
aá”G‘tšgSavedF¿me1
(
äameSize
);

65 
ÚSavedF¿meClosu»
(* 
ş›ÁD©a
);

66 
ÚSavedF¿meClosu»1
();

68 
	g´iv©e
:

69 
AC3AudioSŒ—mF¿m”
* 
fUsšgSourû
;

70 * 
	gfTo
;

71 
	gfMaxSize
;

73 
BoŞ—n
 
	gfHaveP¬£dAF¿me
;

74 * 
	gfSavedF¿me
;

75 
	gfSavedF¿meSize
;

76 
	gfSavedF¿meFÏg
;

79 
AC3F¿meP¬ams
 
	gfCu¼’tF¿me
;

85 
	gAC3AudioSŒ—mF¿m”
::
	$AC3AudioSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
,

86 
F¿medSourû
* 
šputSourû
,

87 
¡»amCode
)

88 : 
	`F¿medF‹r
(
’v
, 
šputSourû
), 
	$fOurSŒ—mCode
(
¡»amCode
) {

90 
	`g‘timeofday
(&
fNextF¿meP»£Á©iÚTime
, 
NULL
);

92 
fP¬£r
 = 
Ãw
 
	`AC3AudioSŒ—mP¬£r
(
this
, 
šputSourû
);

93 
	}
}

95 
	gAC3AudioSŒ—mF¿m”
::~
	$AC3AudioSŒ—mF¿m”
() {

96 
d–‘e
 
fP¬£r
;

97 
	}
}

99 
AC3AudioSŒ—mF¿m”
*

100 
	gAC3AudioSŒ—mF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

101 
F¿medSourû
* 
šputSourû
,

102 
¡»amCode
) {

104  
Ãw
 
	`AC3AudioSŒ—mF¿m”
(
’v
, 
šputSourû
, 
¡»amCode
);

105 
	}
}

107 
	gAC3AudioSŒ—mF¿m”
::
	$§m¶šgR©e
() {

108 ià(!
fP¬£r
->
	`haveP¬£dAF¿me
()) {

112 
fP¬£r
->
	`»adAndSaveAF¿me
();

115  
fP¬£r
->
	`cu¼’tF¿me
().
§m¶šgF»q
;

116 
	}
}

118 
	gAC3AudioSŒ—mF¿m”
::
	$æushIÅut
() {

119 
fP¬£r
->
	`æushIÅut
();

120 
	}
}

122 
	gAC3AudioSŒ—mF¿m”
::
	$doG‘NextF¿me
() {

123 
fP¬£r
->
	`»gi¡”R—dIÁ”e¡
(
fTo
, 
fMaxSize
);

124 
	`·r£NextF¿me
();

125 
	}
}

127 
	#MILLION
 1000000

	)

129 
timev®
 
	gAC3AudioSŒ—mF¿m”
::
	$cu¼’tF¿mePÏyTime
() const {

130 
AC3F¿meP¬ams
 cÚ¡& 
ä
 = 
fP¬£r
->
	`cu¼’tF¿me
();

131 cÚ¡ 
numSam¶es
 = 1536;

132 cÚ¡ 
äeq
 = 
ä
.
§m¶šgF»q
;

135 cÚ¡ 
uSecÚds
 = (
äeq
 == 0) ? 0

136 : ((
numSam¶es
*2*
MILLION
)/
äeq
 + 1)/2;

138 
timev®
 
»suÉ
;

139 
»suÉ
.
tv_£c
 = 
uSecÚds
/
MILLION
;

140 
»suÉ
.
tv_u£c
 = 
uSecÚds
%
MILLION
;

141  
»suÉ
;

142 
	}
}

144 
	gAC3AudioSŒ—mF¿m”


145 ::
	$hªdËNewD©a
(* 
ş›ÁD©a
, * 
±r
, 
size
,

146 
timev®
 ) {

147 
AC3AudioSŒ—mF¿m”
* 
äam”
 = (AC3AudioSŒ—mF¿m”*)
ş›ÁD©a
;

148 
äam”
->
	`hªdËNewD©a
(
±r
, 
size
);

149 
	}
}

151 
	gAC3AudioSŒ—mF¿m”


152 ::
	$hªdËNewD©a
(* 
±r
, 
size
) {

153 
fP¬£r
->
	`‹¡SŒ—mCode
(
fOurSŒ—mCode
, 
±r
, 
size
);

155 
	`·r£NextF¿me
();

156 
	}
}

158 
	gAC3AudioSŒ—mF¿m”
::
	$·r£NextF¿me
() {

159 
acquœedF¿meSize
 = 
fP¬£r
->
	`·r£F¿me
(
fNumTrunÿ‹dBy‹s
);

160 ià(
acquœedF¿meSize
 > 0) {

163 
fF¿meSize
 = 
acquœedF¿meSize
;

167 
fP»£Á©iÚTime
 = 
fNextF¿meP»£Á©iÚTime
;

169 
timev®
 
äamePÏyTime
 = 
	`cu¼’tF¿mePÏyTime
();

170 
fDu¿tiÚInMiüo£cÚds
 = 
äamePÏyTime
.
tv_£c
*
MILLION
 + f¿mePÏyTime.
tv_u£c
;

171 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 +ğ
äamePÏyTime
.tv_usec;

172 
fNextF¿meP»£Á©iÚTime
.
tv_£c


173 +ğ
äamePÏyTime
.
tv_£c
 + 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
/
MILLION
;

174 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 %ğ
MILLION
;

178 
	`aá”G‘tšg
(
this
);

184 
	}
}

189 cÚ¡ 
	gkbpsTabË
[] = {32, 40, 48, 56, 64, 80, 96, 112,

193 
	gAC3F¿meP¬ams
::
	$£tP¬amsFromH—d”
() {

194 
by‹4
 = 
hdr1
 >> 24;

196 
kbpsIndex
 = (
by‹4
&0x3E) >> 1;

197 ià(
kbpsIndex
 > 18) kbpsIndex = 18;

198 
kbps
 = 
kbpsTabË
[
kbpsIndex
];

200 
§m¶šgF»qIndex
 = (
by‹4
&0xC0) >> 6;

201 
§m¶šgF»qIndex
) {

203 
§m¶šgF»q
 = 48000;

204 
äameSize
 = 4*
kbps
;

207 
§m¶šgF»q
 = 44100;

208 
äameSize
 = 2*(320*
kbps
/147 + (
by‹4
&1));

212 
§m¶šgF»q
 = 32000;

213 
äameSize
 = 6*
kbps
;

215 
	}
}

217 
	gAC3AudioSŒ—mP¬£r


218 ::
	$AC3AudioSŒ—mP¬£r
(
AC3AudioSŒ—mF¿m”
* 
usšgSourû
,

219 
F¿medSourû
* 
šputSourû
)

220 : 
	`SŒ—mP¬£r
(
šputSourû
, 
F¿medSourû
::
hªdËClosu»
, 
usšgSourû
,

221 &
AC3AudioSŒ—mF¿m”
::
hªdËNewD©a
, 
usšgSourû
),

222 
	`fUsšgSourû
(
usšgSourû
), 
	`fHaveP¬£dAF¿me
(
F®£
),

223 
	`fSavedF¿me
(
NULL
), 
	$fSavedF¿meSize
(0) {

224 
	}
}

226 
	gAC3AudioSŒ—mP¬£r
::~
	$AC3AudioSŒ—mP¬£r
() {

227 
	}
}

229 
AC3AudioSŒ—mP¬£r
::
	$»gi¡”R—dIÁ”e¡
(* 
to
,

230 
maxSize
) {

231 
fTo
 = 
to
;

232 
fMaxSize
 = 
maxSize
;

233 
	}
}

235 
	gAC3AudioSŒ—mP¬£r


236 ::
	$‹¡SŒ—mCode
(
ourSŒ—mCode
,

237 * 
±r
, 
size
) {

238 ià(
ourSŒ—mCode
 == 0) ;

240 ià(
size
 < 4) ;

241 
¡»amCode
 = *
±r
;

243 ià(
¡»amCode
 =ğ
ourSŒ—mCode
) {

245 
	`memmove
(
±r
,…Œ + 4, 
size
 - 4);

246 
	`tÙNumV®idBy‹s
() =otNumValidBytes() - 4;

249 
	`tÙNumV®idBy‹s
(èğtÙNumV®idBy‹s(è- 
size
;

251 
	}
}

253 
	gAC3AudioSŒ—mP¬£r
::
	$·r£F¿me
(& 
numTrunÿ‹dBy‹s
) {

254 ià(
fSavedF¿meSize
 > 0) {

256 
	`memmove
(
fTo
, 
fSavedF¿me
, 
fSavedF¿meSize
);

257 
d–‘e
[] 
fSavedF¿me
; fSavedF¿mğ
NULL
;

258 
äameSize
 = 
fSavedF¿meSize
;

259 
fSavedF¿meSize
 = 0;

260  
äameSize
;

263 
Œy
 {

264 
	`§veP¬£rS‹
();

268 
Ãxt4By‹s
 = 
	`‹¡4By‹s
();

269 ià(
Ãxt4By‹s
>>16 == 0x0B77) ;

270 
	`skBy‹s
(1);

271 
	`§veP¬£rS‹
();

273 
fCu¼’tF¿me
.
hdr0
 = 
	`g‘4By‹s
();

274 
fCu¼’tF¿me
.
hdr1
 = 
	`‹¡4By‹s
();

276 
fCu¼’tF¿me
.
	`£tP¬amsFromH—d”
();

277 
fHaveP¬£dAF¿me
 = 
True
;

280 
äameSize
 = 
fCu¼’tF¿me
.frameSize;

281 ià(
äameSize
 > 
fMaxSize
) {

282 
numTrunÿ‹dBy‹s
 = 
äameSize
 - 
fMaxSize
;

283 
äameSize
 = 
fMaxSize
;

285 
numTrunÿ‹dBy‹s
 = 0;

288 
fTo
[0] = 
fCu¼’tF¿me
.
hdr0
 >> 24;

289 
fTo
[1] = 
fCu¼’tF¿me
.
hdr0
 >> 16;

290 
fTo
[2] = 
fCu¼’tF¿me
.
hdr0
 >> 8;

291 
fTo
[3] = 
fCu¼’tF¿me
.
hdr0
;

292 
	`g‘By‹s
(&
fTo
[4], 
äameSize
-4);

293 
	`skBy‹s
(
numTrunÿ‹dBy‹s
);

295  
äameSize
;

296 } 
	`ÿtch
 () {

297 #ifdeà
DEBUG


298 
fUsšgSourû
->
	`’vœ
() << "AC3AudioStreamParser::parseFrame() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n";

302 
	}
}

304 
	gAC3AudioSŒ—mP¬£r
::
	$»adAndSaveAF¿me
() {

305 cÚ¡ 
maxAC3F¿meSize
 = 4000;

306 
fSavedF¿me
 = 
Ãw
 [
maxAC3F¿meSize
];

307 
fSavedF¿meSize
 = 0;

309 
fSavedF¿meFÏg
 = 0;

310 
fUsšgSourû
->
	`g‘NextF¿me
(
fSavedF¿me
, 
maxAC3F¿meSize
,

311 
aá”G‘tšgSavedF¿me
, 
this
,

312 
ÚSavedF¿meClosu»
, 
this
);

313 
fUsšgSourû
->
	`’vœ
().
	`skScheduËr
().
	`doEv’tLoİ
(&
fSavedF¿meFÏg
);

314 
	}
}

316 
	gAC3AudioSŒ—mP¬£r


317 ::
	$aá”G‘tšgSavedF¿me
(* 
ş›ÁD©a
, 
äameSize
,

319 
timev®
 ,

321 
AC3AudioSŒ—mP¬£r
* 
·r£r
 = (AC3AudioSŒ—mP¬£r*)
ş›ÁD©a
;

322 
·r£r
->
	`aá”G‘tšgSavedF¿me1
(
äameSize
);

323 
	}
}

325 
	gAC3AudioSŒ—mP¬£r


326 ::
	$aá”G‘tšgSavedF¿me1
(
äameSize
) {

327 
fSavedF¿meSize
 = 
äameSize
;

328 
fSavedF¿meFÏg
 = ~0;

329 
	}
}

331 
	gAC3AudioSŒ—mP¬£r
::
	$ÚSavedF¿meClosu»
(* 
ş›ÁD©a
) {

332 
AC3AudioSŒ—mP¬£r
* 
·r£r
 = (AC3AudioSŒ—mP¬£r*)
ş›ÁD©a
;

333 
·r£r
->
	`ÚSavedF¿meClosu»1
();

334 
	}
}

336 
	gAC3AudioSŒ—mP¬£r
::
	$ÚSavedF¿meClosu»1
() {

337 
d–‘e
[] 
fSavedF¿me
; fSavedF¿mğ
NULL
;

338 
fSavedF¿meSize
 = 0;

339 
fSavedF¿meFÏg
 = ~0;

340 
	}
}

	@liveMedia/ADTSAudioFileServerMediaSubsession.cpp

22 
	~"ADTSAudioFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"ADTSAudioFeSourû.hh
"

24 
	~"MPEG4G’”icRTPSšk.hh
"

26 
ADTSAudioFeS”v”MedŸSub£ssiÚ
*

27 
	gADTSAudioFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

28 cÚ¡* 
feName
,

29 
BoŞ—n
 
»u£Fœ¡Sourû
) {

30  
Ãw
 
	`ADTSAudioFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

31 
	}
}

33 
	gADTSAudioFeS”v”MedŸSub£ssiÚ


34 ::
	$ADTSAudioFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

35 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

36 : 
	$FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
) {

37 
	}
}

39 
	gADTSAudioFeS”v”MedŸSub£ssiÚ


40 ::~
	$ADTSAudioFeS”v”MedŸSub£ssiÚ
() {

41 
	}
}

43 
F¿medSourû
* 
ADTSAudioFeS”v”MedŸSub£ssiÚ


44 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

45 
e¡B™¿‹
 = 96;

47  
ADTSAudioFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

48 
	}
}

50 
RTPSšk
* 
	gADTSAudioFeS”v”MedŸSub£ssiÚ


51 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

52 
¹pPaylßdTy³IfDyÇmic
,

53 
F¿medSourû
* 
šputSourû
) {

54 
ADTSAudioFeSourû
* 
adtsSourû
 = (ADTSAudioFeSourû*)
šputSourû
;

55  
MPEG4G’”icRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

56 
¹pPaylßdTy³IfDyÇmic
,

57 
adtsSourû
->
	`§m¶šgF»qu’cy
(),

58 "audio", "AAC-hbr", 
adtsSourû
->
	`cÚfigSŒ
(),

59 
adtsSourû
->
	`numChªÃls
());

60 
	}
}

	@liveMedia/ADTSAudioFileSource.cpp

21 
	~"ADTSAudioFeSourû.hh
"

22 
	~"IÅutFe.hh
"

23 
	~<GroupsockH–³r.hh
>

27 cÚ¡ 
	g§m¶šgF»qu’cyTabË
[16] = {

34 
ADTSAudioFeSourû
*

35 
	gADTSAudioFeSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
) {

36 
FILE
* 
fid
 = 
NULL
;

38 
fid
 = 
	`O³nIÅutFe
(
’v
, 
feName
);

39 ià(
fid
 =ğ
NULL
) ;

43 
fixedH—d”
[4];

44 ià(
	`ä—d
(
fixedH—d”
, 1,  fixedH—d”, 
fid
) <  fixedHeader) ;

47 ià(!(
fixedH—d”
[0] == 0xFF && (fixedHeader[1]&0xF0) == 0xF0)) {

48 
’v
.
	`£tResuÉMsg
("Bad 'syncword'‡t start of ADTS file");

53 
u_št8_t
 
´ofe
 = (
fixedH—d”
[2]&0xC0)>>6;

54 ià(
´ofe
 == 3) {

55 
’v
.
	`£tResuÉMsg
("Bad (reserved) 'profile': 3 in first frame of ADTS file");

60 
u_št8_t
 
§m¶šg_äequ’cy_šdex
 = (
fixedH—d”
[2]&0x3C)>>2;

61 ià(
§m¶šgF»qu’cyTabË
[
§m¶šg_äequ’cy_šdex
] == 0) {

62 
’v
.
	`£tResuÉMsg
("Bad 'sampling_frequency_index' in first frame of ADTS file");

67 
u_št8_t
 
chªÃl_cÚfigu¿tiÚ


68 ğ((
fixedH—d”
[2]&0x01)<<2)|((fixedHeader[3]&0xC0)>>6);

72 #iâdeà
_WIN32_WCE


73 
	`»wšd
(
fid
);

75 
	`S“kFe64
(
fid
, 
SEEK_SET
,0);

77 #ifdeà
DEBUG


78 
	`årštf
(
¡d”r
, "Read first frame:…rofile %d, "

81 
´ofe
,

82 
§m¶šg_äequ’cy_šdex
, 
§m¶šgF»qu’cyTabË
[sampling_frequency_index],

83 
chªÃl_cÚfigu¿tiÚ
);

85  
Ãw
 
	`ADTSAudioFeSourû
(
’v
, 
fid
, 
´ofe
,

86 
§m¶šg_äequ’cy_šdex
, 
chªÃl_cÚfigu¿tiÚ
);

90 
	`Clo£IÅutFe
(
fid
);

91  
NULL
;

92 
	}
}

94 
	gADTSAudioFeSourû


95 ::
	$ADTSAudioFeSourû
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
, 
u_št8_t
 
´ofe
,

96 
u_št8_t
 
§m¶šgF»qu’cyIndex
, u_št8_ˆ
chªÃlCÚfigu¿tiÚ
)

97 : 
	$F¿medFeSourû
(
’v
, 
fid
) {

98 
fSam¶šgF»qu’cy
 = 
§m¶šgF»qu’cyTabË
[
§m¶šgF»qu’cyIndex
];

99 
fNumChªÃls
 = 
chªÃlCÚfigu¿tiÚ
 == 0 ? 2 : channelConfiguration;

100 
fuSecsP”F¿me


101 ğ(1024 *1000000è/ 
fSam¶šgF»qu’cy
 ;

104 
audioS³cificCÚfig
[2];

105 
u_št8_t
 cÚ¡ 
audioObjeùTy³
 = 
´ofe
 + 1;

106 
audioS³cificCÚfig
[0] = (
audioObjeùTy³
<<3è| (
§m¶šgF»qu’cyIndex
>>1);

107 
audioS³cificCÚfig
[1] = (
§m¶šgF»qu’cyIndex
<<7è| (
chªÃlCÚfigu¿tiÚ
<<3);

108 
	`¥rštf
(
fCÚfigSŒ
, "%02X%02x", 
audioS³cificCÚfig
[0],‡udioSpecificConfig[1]);

109 
	}
}

111 
	gADTSAudioFeSourû
::~
	$ADTSAudioFeSourû
() {

112 
	`Clo£IÅutFe
(
fFid
);

113 
	}
}

117 
	gADTSAudioFeSourû
::
	$doG‘NextF¿me
() {

119 
h—d”s
[7];

120 ià(
	`ä—d
(
h—d”s
, 1,  h—d”s, 
fFid
) <  headers

121 || 
	`ãof
(
fFid
è|| 
	`ã¼Ü
(fFid)) {

123 
	`hªdËClosu»
();

128 
BoŞ—n
 
´ÙeùiÚ_ab£Á
 = 
h—d”s
[1]&0x01;

129 
u_št16_t
 
äame_Ëngth


130 ğ((
h—d”s
[3]&0x03)<<11) | (headers[4]<<3) | ((headers[5]&0xE0)>>5);

131 #ifdeà
DEBUG


132 
u_št16_t
 
syncwÜd
 = (
h—d”s
[0]<<4) | (headers[1]>>4);

133 
	`årštf
(
¡d”r
, "R—d f¿me: syncwÜd 0x%x,…rÙeùiÚ_ab£Á %d, f¿me_Ëngth %d\n", 
syncwÜd
, 
´ÙeùiÚ_ab£Á
, 
äame_Ëngth
);

134 ià(
syncwÜd
 !ğ0xFFFè
	`årštf
(
¡d”r
, "WARNING: Bad syncword!\n");

136 
numBy‹sToR—d


137 ğ
äame_Ëngth
 >  
h—d”s
 ? frame_length -  headers : 0;

140 ià(!
´ÙeùiÚ_ab£Á
) {

141 
	`S“kFe64
(
fFid
, 2, 
SEEK_CUR
);

142 
numBy‹sToR—d
 =‚umBytesToRead > 2 ?‚umBytesToRead - 2 : 0;

146 ià(
numBy‹sToR—d
 > 
fMaxSize
) {

147 
fNumTrunÿ‹dBy‹s
 = 
numBy‹sToR—d
 - 
fMaxSize
;

148 
numBy‹sToR—d
 = 
fMaxSize
;

150 
numBy‹sR—d
 = 
	`ä—d
(
fTo
, 1, 
numBy‹sToR—d
, 
fFid
);

151 ià(
numBy‹sR—d
 < 0)‚umBytesRead = 0;

152 
fF¿meSize
 = 
numBy‹sR—d
;

153 
fNumTrunÿ‹dBy‹s
 +ğ
numBy‹sToR—d
 - 
numBy‹sR—d
;

156 ià(
fP»£Á©iÚTime
.
tv_£c
 =ğ0 && fP»£Á©iÚTime.
tv_u£c
 == 0) {

158 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

161 
uSecÚds
 = 
fP»£Á©iÚTime
.
tv_u£c
 + 
fuSecsP”F¿me
;

162 
fP»£Á©iÚTime
.
tv_£c
 +ğ
uSecÚds
/1000000;

163 
fP»£Á©iÚTime
.
tv_u£c
 = 
uSecÚds
%1000000;

166 
fDu¿tiÚInMiüo£cÚds
 = 
fuSecsP”F¿me
;

169 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0,

170 (
TaskFunc
*)
F¿medSourû
::
aá”G‘tšg
, 
this
);

171 
	}
}

	@liveMedia/AMRAudioFileServerMediaSubsession.cpp

22 
	~"AMRAudioFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"AMRAudioRTPSšk.hh
"

24 
	~"AMRAudioFeSourû.hh
"

26 
AMRAudioFeS”v”MedŸSub£ssiÚ
*

27 
	gAMRAudioFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

28 cÚ¡* 
feName
,

29 
BoŞ—n
 
»u£Fœ¡Sourû
) {

30  
Ãw
 
	`AMRAudioFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

31 
	}
}

33 
	gAMRAudioFeS”v”MedŸSub£ssiÚ


34 ::
	$AMRAudioFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

35 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

36 : 
	$FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
) {

37 
	}
}

39 
	gAMRAudioFeS”v”MedŸSub£ssiÚ


40 ::~
	$AMRAudioFeS”v”MedŸSub£ssiÚ
() {

41 
	}
}

43 
F¿medSourû
* 
AMRAudioFeS”v”MedŸSub£ssiÚ


44 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

45 
e¡B™¿‹
 = 10;

47  
AMRAudioFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

48 
	}
}

50 
RTPSšk
* 
	gAMRAudioFeS”v”MedŸSub£ssiÚ


51 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

52 
¹pPaylßdTy³IfDyÇmic
,

53 
F¿medSourû
* 
šputSourû
) {

54 
AMRAudioFeSourû
* 
amrSourû
 = (AMRAudioFeSourû*)
šputSourû
;

55  
AMRAudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

56 
¹pPaylßdTy³IfDyÇmic
,

57 
amrSourû
->
	`isWidebªd
(),

58 
amrSourû
->
	`numChªÃls
());

59 
	}
}

	@liveMedia/AMRAudioFileSink.cpp

21 
	~"AMRAudioFeSšk.hh
"

22 
	~"AMRAudioSourû.hh
"

23 
	~"OuutFe.hh
"

27 
	gAMRAudioFeSšk


28 ::
	$AMRAudioFeSšk
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
, 
bufãrSize
,

29 cÚ¡* 
³rF¿meFeNameP»fix
)

30 : 
	`FeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
),

31 
	$fHaveWr™‹nH—d”
(
F®£
) {

32 
	}
}

34 
	gAMRAudioFeSšk
::~
	$AMRAudioFeSšk
() {

35 
	}
}

37 
AMRAudioFeSšk
*

38 
AMRAudioFeSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

39 
bufãrSize
, 
BoŞ—n
 
ÚeFeP”F¿me
) {

41 
FILE
* 
fid
;

42 cÚ¡* 
³rF¿meFeNameP»fix
;

43 ià(
ÚeFeP”F¿me
) {

45 
fid
 = 
NULL
;

46 
³rF¿meFeNameP»fix
 = 
feName
;

49 
fid
 = 
	`O³nOuutFe
(
’v
, 
feName
);

50 ià(
fid
 =ğ
NULL
) ;

51 
³rF¿meFeNameP»fix
 = 
NULL
;

54  
Ãw
 
	`AMRAudioFeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
);

57  
NULL
;

58 
	}
}

60 
BoŞ—n
 
	gAMRAudioFeSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

62  
sourû
.
	`isAMRAudioSourû
();

63 
	}
}

65 
	gAMRAudioFeSšk
::
	$aá”G‘tšgF¿me
(
äameSize
,

66 
numTrunÿ‹dBy‹s
,

67 
timev®
 
´e£Á©iÚTime
) {

68 
AMRAudioSourû
* 
sourû
 = (AMRAudioSourû*)
fSourû
;

69 ià(
sourû
 =ğ
NULL
) ;

71 ià(!
fHaveWr™‹nH—d”
 && 
fP”F¿meFeNameBufãr
 =ğ
NULL
) {

75 
h—d”Bufãr
[100];

76 
	`¥rštf
(
h—d”Bufãr
, "#!AMR%s%s\n",

77 
sourû
->
	`isWidebªd
() ? "-WB" : "",

78 
sourû
->
	`numChªÃls
() > 1 ? "_MC1.0" : "");

79 
h—d”L’gth
 = 
	`¡¾’
(
h—d”Bufãr
);

80 ià(
sourû
->
	`numChªÃls
() > 1) {

82 
h—d”Bufãr
[
h—d”L’gth
++] = 0;

83 
h—d”Bufãr
[
h—d”L’gth
++] = 0;

84 
h—d”Bufãr
[
h—d”L’gth
++] = 0;

85 
h—d”Bufãr
[
h—d”L’gth
++] = 
sourû
->
	`numChªÃls
();

88 
	`addD©a
((*)
h—d”Bufãr
, 
h—d”L’gth
, 
´e£Á©iÚTime
);

90 
fHaveWr™‹nH—d”
 = 
True
;

94 ià(
fP”F¿meFeNameBufãr
 =ğ
NULL
) {

95 
u_št8_t
 
äameH—d”
 = 
sourû
->
	`Ï¡F¿meH—d”
();

96 
	`addD©a
(&
äameH—d”
, 1, 
´e£Á©iÚTime
);

100 
FeSšk
::
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
);

101 
	}
}

	@liveMedia/AMRAudioFileSource.cpp

21 
	~"AMRAudioFeSourû.hh
"

22 
	~"IÅutFe.hh
"

23 
	~"GroupsockH–³r.hh
"

27 
AMRAudioFeSourû
*

28 
	gAMRAudioFeSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
) {

29 
FILE
* 
fid
 = 
NULL
;

30 
BoŞ—n
 
magicNumb”OK
 = 
True
;

33 
fid
 = 
	`O³nIÅutFe
(
’v
, 
feName
);

34 ià(
fid
 =ğ
NULL
) ;

38 
magicNumb”OK
 = 
F®£
;

39 
BoŞ—n
 
isWidebªd
 = 
F®£
;

40 
numChªÃls
 = 1;

41 
buf
[100];

43 ià(
	`ä—d
(
buf
, 1, 6, 
fid
) < 6) ;

44 ià(
	`¡ºcmp
(
buf
, "#!AMR", 5) != 0) ;

45 
by‹sR—d
 = 6;

48 ià(
buf
[5] == '-') {

50 ià(
	`ä—d
(&
buf
[
by‹sR—d
], 1, 3, 
fid
) < 3) ;

51 ià(
	`¡ºcmp
(&
buf
[
by‹sR—d
], "WB", 2) != 0) ;

52 
isWidebªd
 = 
True
;

53 
by‹sR—d
 += 3;

55 ià(
buf
[
by‹sR—d
-1] == '_') {

57 ià(
	`ä—d
(&
buf
[
by‹sR—d
], 1, 6, 
fid
) < 6) ;

58 ià(
	`¡ºcmp
(&
buf
[
by‹sR—d
], "MC1.0\n", 6) != 0) ;

59 
by‹sR—d
 += 6;

62 
chªÃlDesc
[4];

63 ià(
	`ä—d
(
chªÃlDesc
, 1, 4, 
fid
) < 4) ;

64 
numChªÃls
 = 
chªÃlDesc
[3]&0xF;

65 } ià(
buf
[
by‹sR—d
-1] != '\n') {

70 
magicNumb”OK
 = 
True
;

72 #ifdeà
DEBUG


73 
	`årštf
(
¡d”r
, "isWideband: %d,‚umChannels: %d\n",

74 
isWidebªd
, 
numChªÃls
);

76  
Ãw
 
	`AMRAudioFeSourû
(
’v
, 
fid
, 
isWidebªd
, 
numChªÃls
);

80 
	`Clo£IÅutFe
(
fid
);

81 ià(!
magicNumb”OK
) {

82 
’v
.
	`£tResuÉMsg
("Bad (or‚onexistent) AMR file header");

84  
NULL
;

85 
	}
}

87 
	gAMRAudioFeSourû


88 ::
	$AMRAudioFeSourû
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

89 
BoŞ—n
 
isWidebªd
, 
numChªÃls
)

90 : 
	`AMRAudioSourû
(
’v
, 
isWidebªd
, 
numChªÃls
),

91 
	$fFid
(
fid
) {

92 
	}
}

94 
	gAMRAudioFeSourû
::~
	$AMRAudioFeSourû
() {

95 
	`Clo£IÅutFe
(
fFid
);

96 
	}
}

100 
	#FT_INVALID
 65535

	)

101 cÚ¡ 
	gäameSize
[16] = {

104 5, 
FT_INVALID
, FT_INVALID, FT_INVALID,

105 
FT_INVALID
, FT_INVALID, FT_INVALID, 0

107 cÚ¡ 
	gäameSizeWidebªd
[16] = {

110 60, 5, 
FT_INVALID
, FT_INVALID,

111 
FT_INVALID
, FT_INVALID, 0, 0

116 
	gAMRAudioFeSourû
::
	$doG‘NextF¿me
() {

117 ià(
	`ãof
(
fFid
è|| 
	`ã¼Ü
(fFid)) {

118 
	`hªdËClosu»
();

124 ià(
	`ä—d
(&
fLa¡F¿meH—d”
, 1, 1, 
fFid
) < 1) {

125 
	`hªdËClosu»
();

128 ià((
fLa¡F¿meH—d”
&0x83) != 0) {

129 #ifdeà
DEBUG


130 
	`årštf
(
¡d”r
, "Inv®id f¿mh—d” 0x%02x (·ddšg b™ (0x83è¬nÙ z”o)\n", 
fLa¡F¿meH—d”
);

133 
á
 = (
fLa¡F¿meH—d”
&0x78)>>3;

134 
fF¿meSize
 = 
fIsWidebªd
 ? 
äameSizeWidebªd
[
á
] : 
äameSize
[ft];

135 ià(
fF¿meSize
 =ğ
FT_INVALID
) {

136 #ifdeà
DEBUG


137 
	`årštf
(
¡d”r
, "Invalid FT field %d (from frame header 0x%02x)\n",

138 
á
, 
fLa¡F¿meH—d”
);

142 #ifdeà
DEBUG


143 
	`årštf
(
¡d”r
, "V®id f¿mh—d” 0x%02x -> fˆ%d -> f¿msiz%d\n", 
fLa¡F¿meH—d”
, 
á
, 
fF¿meSize
);

151 
fF¿meSize
 *ğ
fNumChªÃls
;

152 ià(
fF¿meSize
 > 
fMaxSize
) {

153 
fNumTrunÿ‹dBy‹s
 = 
fF¿meSize
 - 
fMaxSize
;

154 
fF¿meSize
 = 
fMaxSize
;

156 
fF¿meSize
 = 
	`ä—d
(
fTo
, 1, fF¿meSize, 
fFid
);

159 ià(
fP»£Á©iÚTime
.
tv_£c
 =ğ0 && fP»£Á©iÚTime.
tv_u£c
 == 0) {

161 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

164 
uSecÚds
 = 
fP»£Á©iÚTime
.
tv_u£c
 + 20000;

165 
fP»£Á©iÚTime
.
tv_£c
 +ğ
uSecÚds
/1000000;

166 
fP»£Á©iÚTime
.
tv_u£c
 = 
uSecÚds
%1000000;

169 
fDu¿tiÚInMiüo£cÚds
 = 20000;

172 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0,

173 (
TaskFunc
*)
F¿medSourû
::
aá”G‘tšg
, 
this
);

174 
	}
}

	@liveMedia/AMRAudioRTPSink.cpp

24 
	~"AMRAudioRTPSšk.hh
"

25 
	~"AMRAudioSourû.hh
"

27 
AMRAudioRTPSšk
*

28 
	gAMRAudioRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

29 
¹pPaylßdFÜm©
,

30 
BoŞ—n
 
sourûIsWidebªd
,

31 
numChªÃlsInSourû
) {

32  
Ãw
 
	`AMRAudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

33 
sourûIsWidebªd
, 
numChªÃlsInSourû
);

34 
	}
}

36 
	gAMRAudioRTPSšk


37 ::
	$AMRAudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

38 
¹pPaylßdFÜm©
,

39 
BoŞ—n
 
sourûIsWidebªd
, 
numChªÃlsInSourû
)

40 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

41 
sourûIsWidebªd
 ? 16000 : 8000,

42 
sourûIsWidebªd
 ? "AMR-WB": "AMR",

43 
numChªÃlsInSourû
),

44 
	`fSourûIsWidebªd
(
sourûIsWidebªd
), 
	$fFmSDPLše
(
NULL
) {

45 
	}
}

47 
	gAMRAudioRTPSšk
::~
	$AMRAudioRTPSšk
() {

48 
d–‘e
[] 
fFmSDPLše
;

49 
	}
}

51 
BoŞ—n
 
	gAMRAudioRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

53 ià(!
sourû
.
	`isAMRAudioSourû
()è 
F®£
;

56 
AMRAudioSourû
& 
amrSourû
 = (AMRAudioSourû&)
sourû
;

57 ià((
amrSourû
.
	`isWidebªd
()^
fSourûIsWidebªd
è!ğ0è 
F®£
;

62 ià(
amrSourû
.
	`numChªÃls
(è!ğnumChªÃls()è 
F®£
;

68 ià(
amrSourû
.
	`numChªÃls
() > 1) {

69 
	`’vœ
(è<< "AMRAudioRTPSšk: W¬nšg: IÅuˆsourû ha " << 
amrSourû
.
	`numChªÃls
()

73  
True
;

74 
	}
}

76 
	gAMRAudioRTPSšk
::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

77 * 
äameS¹
,

78 
numBy‹sInF¿me
,

79 
timev®
 
äameP»£Á©iÚTime
,

80 
numRemaššgBy‹s
) {

83 ià(
	`isFœ¡Pack‘
(è&& 
	`isFœ¡F¿meInPack‘
()) {

84 
	`£tM¬k”B™
();

89 ià(
	`isFœ¡F¿meInPack‘
()) {

90 
u_št8_t
 
·ylßdH—d”
 = 0xF0;

91 
	`£tS³cŸlH—d”By‹s
(&
·ylßdH—d”
, 1, 0);

96 
AMRAudioSourû
* 
amrSourû
 = (AMRAudioSourû*)
fSourû
;

97 ià(
amrSourû
 =ğ
NULL
) ;

99 
u_št8_t
 
toc
 = 
amrSourû
->
	`Ï¡F¿meH—d”
();

101 
toc
 &=~ 0x80;

102 
	`£tS³cŸlH—d”By‹s
(&
toc
, 1, 1+
	`numF¿mesU£dSoF¬
());

106 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

107 
äameS¹
, 
numBy‹sInF¿me
,

108 
äameP»£Á©iÚTime
,

109 
numRemaššgBy‹s
);

110 
	}
}

112 
BoŞ—n
 
	gAMRAudioRTPSšk


113 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

116  
F®£
;

117 
	}
}

119 
	gAMRAudioRTPSšk
::
	$¥ecŸlH—d”Size
() const {

123 
	}
}

125 cÚ¡* 
	gAMRAudioRTPSšk
::
	$auxSDPLše
() {

126 ià(
fFmSDPLše
 =ğ
NULL
) {

129 
buf
[100];

130 
	`¥rštf
(
buf
, "a=fm:%d où‘-®ign=1\r\n", 
	`¹pPaylßdTy³
());

131 
d–‘e
[] 
fFmSDPLše
; fFmSDPLšğ
	`¡rDup
(
buf
);

133  
fFmSDPLše
;

134 
	}
}

	@liveMedia/AMRAudioRTPSource.cpp

21 
	~"AMRAudioRTPSourû.hh
"

22 
	~"MuÉiF¿medRTPSourû.hh
"

23 
	~"B™VeùÜ.hh
"

24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

32 şas 
	cRawAMRRTPSourû
: 
public
 
MuÉiF¿medRTPSourû
 {

33 
public
:

34 
RawAMRRTPSourû
*

35 
ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

36 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

37 
BoŞ—n
 
isWidebªd
, BoŞ—À
isOù‘AligÃd
,

38 
BoŞ—n
 
isIÁ”Ëaved
, BoŞ—À
CRCsA»P»£Á
);

40 
BoŞ—n
 
	$isWidebªd
(ècÚ¡ {  
fIsWidebªd
; }

41 
	$ILL
(ècÚ¡ {  
fILL
; 
	}
}

42 
	$ILP
(ècÚ¡ {  
fILP
; 
	}
}

43 
	$TOCSize
(ècÚ¡ {  
fTOCSize
; 
	}
}

44 * 
	$TOC
(ècÚ¡ {  
fTOC
; 
	}
}

45 & 
	$äameIndex
(è{  
fF¿meIndex
; 
	}
}

46 
	gBoŞ—n
& 
	$isSynchrÚized
(è{  
fIsSynchrÚized
; 
	}
}

48 
	g´iv©e
:

49 
RawAMRRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

50 
¹pPaylßdFÜm©
,

51 
BoŞ—n
 
isWidebªd
, BoŞ—À
isOù‘AligÃd
,

52 
BoŞ—n
 
isIÁ”Ëaved
, BoŞ—À
CRCsA»P»£Á
);

55 
	gvœtu®
 ~
RawAMRRTPSourû
();

57 
	g´iv©e
:

59 
vœtu®
 
BoŞ—n
 
hasB“nSynchrÚizedUsšgRTCP
();

61 
vœtu®
 
BoŞ—n
 
´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

62 & 
»suÉS³cŸlH—d”Size
);

63 
vœtu®
 cÚ¡* 
	$MIMEty³
() const;

65 
´iv©e
:

66 
BoŞ—n
 
fIsWidebªd
, 
fIsOù‘AligÃd
, 
fIsIÁ”Ëaved
, 
fCRCsA»P»£Á
;

67 
fILL
, 
fILP
;

68 
fTOCSize
;

69 * 
fTOC
;

70 
fF¿meIndex
;

71 
BoŞ—n
 
fIsSynchrÚized
;

72 
	}
};

74 şas 
	cAMRDeš‹¾—v”
: 
public
 
AMRAudioSourû
 {

75 
public
:

76 
AMRDeš‹¾—v”
*

77 
ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

78 
BoŞ—n
 
isWidebªd
, 
numChªÃls
, 
maxIÁ”ËaveGroupSize
,

79 
RawAMRRTPSourû
* 
šputSourû
);

81 
	m´iv©e
:

82 
AMRDeš‹¾—v”
(
U§geEnvœÚm’t
& 
’v
,

83 
BoŞ—n
 
isWidebªd
, 
numChªÃls
,

84 
maxIÁ”ËaveGroupSize
, 
RawAMRRTPSourû
* 
šputSourû
);

87 
	mvœtu®
 ~
AMRDeš‹¾—v”
();

89 
aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

90 
numTrunÿ‹dBy‹s
,

91 
timev®
 
´e£Á©iÚTime
,

92 
du¿tiÚInMiüo£cÚds
);

93 
aá”G‘tšgF¿me1
(
äameSize
, 
timev®
 
´e£Á©iÚTime
);

95 
	m´iv©e
:

97 
doG‘NextF¿me
();

98 
vœtu®
 
doStİG‘tšgF¿mes
();

100 
	m´iv©e
:

101 
RawAMRRTPSourû
* 
fIÅutSourû
;

102 
şass
 
AMRDeš‹¾—všgBufãr
* 
	mfDeš‹¾—všgBufãr
;

103 
BoŞ—n
 
	mfN“dAF¿me
;

109 
	#MAX_NUM_CHANNELS
 20

110 
	#MAX_INTERLEAVING_GROUP_SIZE
 1000

111 

	)

112 
AMRAudioSourû
*

113 
	gAMRAudioRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

114 
Groupsock
* 
RTPgs
,

115 
RTPSourû
*& 
»suÉRTPSourû
,

116 
¹pPaylßdFÜm©
,

117 
BoŞ—n
 
isWidebªd
,

118 
numChªÃls
,

119 
BoŞ—n
 
isOù‘AligÃd
,

120 
š‹¾—všg
,

121 
BoŞ—n
 
robu¡SÜtšgOrd”
,

122 
BoŞ—n
 
CRCsA»P»£Á
) {

124 ià(
robu¡SÜtšgOrd”
) {

125 
’v
 << "AMRAudioRTPSource::createNew(): 'Robust sorting order' was specified, but we don't yet supporthis!\n";

126  
NULL
;

127 } ià(
numChªÃls
 > 
MAX_NUM_CHANNELS
) {

128 
’v
 << "AMRAudioRTPSource::createNew(): The \"number of channels\"…arameter ("

129 << 
numChªÃls
 << ") is muchoo†arge!\n";

130  
NULL
;

131 } ià(
š‹¾—všg
 > 
MAX_INTERLEAVING_GROUP_SIZE
) {

132 
’v
 << "AMRAudioRTPSource::createNew(): The \"interleaving\"…arameter ("

133 << 
š‹¾—všg
 << ") is muchoo†arge!\n";

134  
NULL
;

138 ià(!
isOù‘AligÃd
) {

139 ià(
š‹¾—všg
 > 0 || 
robu¡SÜtšgOrd”
 || 
CRCsA»P»£Á
) {

140 
’v
 << "AMRAudioRTPSource::createNew(): 'Bandwidth-efficient mode' was specified,‡long with interleaving, 'robust sorting order',‡nd/or CRCs, so we‡ssume 'octet-aligned mode' instead.\n";

141 
isOù‘AligÃd
 = 
True
;

145 
BoŞ—n
 
isIÁ”Ëaved
;

146 
maxIÁ”ËaveGroupSize
;

147 ià(
š‹¾—všg
 > 0) {

148 
isIÁ”Ëaved
 = 
True
;

149 
maxIÁ”ËaveGroupSize
 = 
š‹¾—všg
*
numChªÃls
;

151 
isIÁ”Ëaved
 = 
F®£
;

152 
maxIÁ”ËaveGroupSize
 = 
numChªÃls
;

155 
RawAMRRTPSourû
* 
¿wRTPSourû
;

156 
»suÉRTPSourû
 = 
¿wRTPSourû


157 ğ
RawAMRRTPSourû
::
	`ü—‹New
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

158 
isWidebªd
, 
isOù‘AligÃd
,

159 
isIÁ”Ëaved
, 
CRCsA»P»£Á
);

160 ià(
»suÉRTPSourû
 =ğ
NULL
)  NULL;

162 
AMRDeš‹¾—v”
* 
deš‹¾—v”


163 ğ
AMRDeš‹¾—v”
::
	`ü—‹New
(
’v
, 
isWidebªd
, 
numChªÃls
,

164 
maxIÁ”ËaveGroupSize
, 
¿wRTPSourû
);

165 ià(
deš‹¾—v”
 =ğ
NULL
) {

166 
Medium
::
	`şo£
(
»suÉRTPSourû
);

167 
»suÉRTPSourû
 = 
NULL
;

170  
deš‹¾—v”
;

171 
	}
}

178 şas 
	cAMRBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

179 
public
:

180 
AMRBufã»dPack‘
(
RawAMRRTPSourû
& 
ourSourû
);

181 
	mvœtu®
 ~
AMRBufã»dPack‘
();

183 
	m´iv©e
:

184 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

185 
d©aSize
);

186 
	m´iv©e
:

187 
RawAMRRTPSourû
& 
fOurSourû
;

190 şas 
	cAMRBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

191 
´iv©e
:

192 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

198 
RawAMRRTPSourû
*

199 
	gRawAMRRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

200 
¹pPaylßdFÜm©
,

201 
BoŞ—n
 
isWidebªd
, BoŞ—À
isOù‘AligÃd
,

202 
BoŞ—n
 
isIÁ”Ëaved
, BoŞ—À
CRCsA»P»£Á
) {

203  
Ãw
 
	`RawAMRRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

204 
isWidebªd
, 
isOù‘AligÃd
,

205 
isIÁ”Ëaved
, 
CRCsA»P»£Á
);

206 
	}
}

208 
	gRawAMRRTPSourû


209 ::
	$RawAMRRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

210 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

211 
BoŞ—n
 
isWidebªd
, BoŞ—À
isOù‘AligÃd
,

212 
BoŞ—n
 
isIÁ”Ëaved
, BoŞ—À
CRCsA»P»£Á
)

213 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

214 
isWidebªd
 ? 16000 : 8000,

215 
Ãw
 
AMRBufã»dPack‘FaùÜy
),

216 
	`fIsWidebªd
(
isWidebªd
), 
	`fIsOù‘AligÃd
(
isOù‘AligÃd
),

217 
	`fIsIÁ”Ëaved
(
isIÁ”Ëaved
), 
	`fCRCsA»P»£Á
(
CRCsA»P»£Á
),

218 
	`fILL
(0), 
	`fILP
(0), 
	`fTOCSize
(0), 
	`fTOC
(
NULL
), 
	`fF¿meIndex
(0), 
	$fIsSynchrÚized
(
F®£
) {

219 
	}
}

221 
	gRawAMRRTPSourû
::~
	$RawAMRRTPSourû
() {

222 
d–‘e
[] 
fTOC
;

223 
	}
}

225 
	#FT_SPEECH_LOST
 14

	)

226 
	#FT_NO_DATA
 15

	)

228 
uÅackBªdwidthEffic›ÁD©a
(
Bufã»dPack‘
* 
·ck‘
,

229 
BoŞ—n
 
isWidebªd
);

231 
BoŞ—n
 
	gRawAMRRTPSourû


232 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

233 & 
»suÉS³cŸlH—d”Size
) {

236 ià(!
fIsOù‘AligÃd
è
	`uÅackBªdwidthEffic›ÁD©a
(
·ck‘
, 
fIsWidebªd
);

238 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

239 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

242 ià(
·ck‘Size
 < 1è 
F®£
;

243 
»suÉS³cŸlH—d”Size
 = 1;

245 ià(
fIsIÁ”Ëaved
) {

247 ià(
·ck‘Size
 < 2è 
F®£
;

250 cÚ¡ 
£cÚdBy‹
 = 
h—d”S¹
[1];

251 
fILL
 = (
£cÚdBy‹
&0xF0)>>4;

252 
fILP
 = 
£cÚdBy‹
&0x0F;

253 ià(
fILP
 > 
fILL
è 
F®£
;

254 ++
»suÉS³cŸlH—d”Size
;

256 #ifdeà
DEBUG


257 
	`årštf
(
¡d”r
, "·ck‘Size: %d, ILL: %d, ILP: %d\n", 
·ck‘Size
, 
fILL
, 
fILP
);

259 
fF¿meIndex
 = 0;

262 
numF¿mesP»£Á
 = 0, 
numNÚEm±yF¿mesP»£Á
 = 0;

263 
tocS¹Index
 = 
»suÉS³cŸlH—d”Size
;

264 
BoŞ—n
 
F
;

266 ià(
»suÉS³cŸlH—d”Size
 >ğ
·ck‘Size
è 
F®£
;

267 cÚ¡ 
tocBy‹
 = 
h—d”S¹
[
»suÉS³cŸlH—d”Size
++];

268 
F
 = (
tocBy‹
&0x80) != 0;

269 cÚ¡ 
FT
 = (
tocBy‹
&0x78) >> 3;

270 #ifdeà
DEBUG


271 
Q
 = (
tocBy‹
&0x04)>>2;

272 
	`årštf
(
¡d”r
, "\tTOCƒÁry: F %d, FT %d, Q %d\n", 
F
, 
FT
, 
Q
);

274 ++
numF¿mesP»£Á
;

275 ià(
FT
 !ğ
FT_SPEECH_LOST
 && FT !ğ
FT_NO_DATA
è++
numNÚEm±yF¿mesP»£Á
;

276 } 
F
);

277 #ifdeà
DEBUG


278 
	`årštf
(
¡d”r
, "TOC cÚš %dƒÁr› (%d‚Ú-em±y)\n", 
numF¿mesP»£Á
, 
numNÚEm±yF¿mesP»£Á
);

282 ià(
numF¿mesP»£Á
 > 
fTOCSize
) {

283 
d–‘e
[] 
fTOC
;

284 
fTOC
 = 
Ãw
 [
numF¿mesP»£Á
];

286 
fTOCSize
 = 
numF¿mesP»£Á
;

287 
i
 = 0; i < 
fTOCSize
; ++i) {

288 cÚ¡ 
tocBy‹
 = 
h—d”S¹
[
tocS¹Index
 + 
i
];

289 
fTOC
[
i
] = 
tocBy‹
&0x7C;

292 ià(
fCRCsA»P»£Á
) {

295 
»suÉS³cŸlH—d”Size
 +ğ
numNÚEm±yF¿mesP»£Á
;

296 #ifdeà
DEBUG


297 
	`årštf
(
¡d”r
, "IgnÜšg %d fŞlowšg CRC by‹s\n", 
numNÚEm±yF¿mesP»£Á
);

299 ià(
»suÉS³cŸlH—d”Size
 > 
·ck‘Size
è 
F®£
;

301 #ifdeà
DEBUG


302 
	`årštf
(
¡d”r
, "TÙ® s³cŸÈh—d” size: %d\n", 
»suÉS³cŸlH—d”Size
);

305  
True
;

306 
	}
}

308 cÚ¡* 
	gRawAMRRTPSourû
::
	$MIMEty³
() const {

309  
fIsWidebªd
 ? "audio/AMR-WB" : "audio/AMR";

310 
	}
}

312 
BoŞ—n
 
	gRawAMRRTPSourû
::
	$hasB“nSynchrÚizedUsšgRTCP
() {

313  
fIsSynchrÚized
;

314 
	}
}

319 
	gAMRBufã»dPack‘
::
	$AMRBufã»dPack‘
(
RawAMRRTPSourû
& 
ourSourû
)

320 : 
	$fOurSourû
(
ourSourû
) {

321 
	}
}

323 
AMRBufã»dPack‘
::~
	$AMRBufã»dPack‘
() {

324 
	}
}

328 
	#FT_INVALID
 65535

	)

329 cÚ¡ 
äameBy‹sFromFT
[16] = {

332 5, 
FT_INVALID
, FT_INVALID, FT_INVALID,

333 
FT_INVALID
, FT_INVALID, FT_INVALID, 0

335 cÚ¡ 
	gäameBy‹sFromFTWidebªd
[16] = {

338 60, 5, 
FT_INVALID
, FT_INVALID,

339 
FT_INVALID
, FT_INVALID, 0, 0

342 
	gAMRBufã»dPack‘
::

343 
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

344 ià(
d©aSize
 == 0)  0;

348 cÚ¡ 
tocIndex
 = 
fOurSourû
.
	`äameIndex
();

349 ià(
tocIndex
 >ğ
fOurSourû
.
	`TOCSize
())  0;

351 cÚ¡ 
tocBy‹
 = 
fOurSourû
.
	`TOC
()[
tocIndex
];

352 cÚ¡ 
FT
 = (
tocBy‹
&0x78) >> 3;

354 
äameSize


355 ğ
fOurSourû
.
	`isWidebªd
(è? 
äameBy‹sFromFTWidebªd
[
FT
] : 
äameBy‹sFromFT
[FT];

356 ià(
äameSize
 =ğ
FT_INVALID
) {

358 
fOurSourû
.
	`’vœ
(è<< "AMRBufã»dPack‘::ÃxtEnşo£dF¿meSize(): inv®id FT: " << 
FT
 << "\n";

359 
äameSize
 = 0;

361 #ifdeà
DEBUG


362 
	`årštf
(
¡d”r
, "AMRBufã»dPack‘::ÃxtEnşo£dF¿meSize(): f¿m#: %d, FT: %d, isWidebªd: %d => f¿meSize: %d (d©aSize: %d)\n", 
tocIndex
, 
FT
, 
fOurSourû
.
	`isWidebªd
(), 
äameSize
, 
d©aSize
);

364 ++
fOurSourû
.
	`äameIndex
();

366 ià(
d©aSize
 < 
äameSize
)  0;

367  
äameSize
;

368 
	}
}

370 
Bufã»dPack‘
* 
	gAMRBufã»dPack‘FaùÜy


371 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

372  
Ãw
 
	`AMRBufã»dPack‘
((
RawAMRRTPSourû
&)(*
ourSourû
));

373 
	}
}

378 
	#AMR_MAX_FRAME_SIZE
 60

	)

380 şas 
	cAMRDeš‹¾—všgBufãr
 {

381 
	mpublic
:

382 
AMRDeš‹¾—všgBufãr
(
numChªÃls
, 
maxIÁ”ËaveGroupSize
);

383 
	mvœtu®
 ~
AMRDeš‹¾—všgBufãr
();

385 
d–iv”IncomšgF¿me
(
äameSize
, 
RawAMRRTPSourû
* 
sourû
,

386 
timev®
 
´e£Á©iÚTime
);

387 
BoŞ—n
 
»Œ›veF¿me
(* 
to
, 
maxSize
,

388 & 
»suÉF¿meSize
, & 
»suÉNumTrunÿ‹dBy‹s
,

389 
u_št8_t
& 
»suÉF¿meH—d”
,

390 
timev®
& 
»suÉP»£Á©iÚTime
,

391 
BoŞ—n
& 
»suÉIsSynchrÚized
);

393 * 
	$šputBufãr
(è{  
fIÅutBufãr
; }

394 
	$šputBufãrSize
(ècÚ¡ {  
AMR_MAX_FRAME_SIZE
; 
	}
}

396 
	g´iv©e
:

397 * 
ü—‹NewBufãr
();

399 şas 
	cF¿meDesütÜ
 {

400 
	gpublic
:

401 
F¿meDesütÜ
();

402 
	gvœtu®
 ~
F¿meDesütÜ
();

404 
	gäameSize
;

405 * 
	gäameD©a
;

406 
u_št8_t
 
	gäameH—d”
;

407 
timev®
 
	g´e£Á©iÚTime
;

408 
BoŞ—n
 
	gfIsSynchrÚized
;

411 
	gfNumChªÃls
, 
	gfMaxIÁ”ËaveGroupSize
;

412 
F¿meDesütÜ
* 
	gfF¿mes
[2];

413 
	gfIncomšgBªkId
;

414 
	gfIncomšgBšMax
;

415 
	gfOutgošgBšMax
;

416 
	gfNextOutgošgBš
;

417 
BoŞ—n
 
	gfHaveS“nPack‘s
;

418 
u_št16_t
 
	gfLa¡Pack‘SeqNumFÜGroup
;

419 * 
	gfIÅutBufãr
;

420 
timev®
 
	gfLa¡R‘r›vedP»£Á©iÚTime
;

421 
	gfNumSucûssiveSynûdF¿mes
;

422 
	gfILL
;

428 
AMRDeš‹¾—v”
* 
	gAMRDeš‹¾—v”


429 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

430 
BoŞ—n
 
isWidebªd
, 
numChªÃls
, 
maxIÁ”ËaveGroupSize
,

431 
RawAMRRTPSourû
* 
šputSourû
) {

432  
Ãw
 
	`AMRDeš‹¾—v”
(
’v
, 
isWidebªd
, 
numChªÃls
, 
maxIÁ”ËaveGroupSize
, 
šputSourû
);

433 
	}
}

435 
	gAMRDeš‹¾—v”
::
	$AMRDeš‹¾—v”
(
U§geEnvœÚm’t
& 
’v
,

436 
BoŞ—n
 
isWidebªd
, 
numChªÃls
,

437 
maxIÁ”ËaveGroupSize
,

438 
RawAMRRTPSourû
* 
šputSourû
)

439 : 
	`AMRAudioSourû
(
’v
, 
isWidebªd
, 
numChªÃls
),

440 
	`fIÅutSourû
(
šputSourû
), 
	$fN“dAF¿me
(
F®£
) {

441 
fDeš‹¾—všgBufãr


442 ğ
Ãw
 
	`AMRDeš‹¾—všgBufãr
(
numChªÃls
, 
maxIÁ”ËaveGroupSize
);

443 
	}
}

445 
	gAMRDeš‹¾—v”
::~
	$AMRDeš‹¾—v”
() {

446 
d–‘e
 
fDeš‹¾—všgBufãr
;

447 
Medium
::
	`şo£
(
fIÅutSourû
);

448 
	}
}

450 cÚ¡ 
	guSecsP”F¿me
 = 20000;

452 
	gAMRDeš‹¾—v”
::
	$doG‘NextF¿me
() {

454 ià(
fDeš‹¾—všgBufãr
->
	`»Œ›veF¿me
(
fTo
, 
fMaxSize
,

455 
fF¿meSize
, 
fNumTrunÿ‹dBy‹s
,

456 
fLa¡F¿meH—d”
, 
fP»£Á©iÚTime
,

457 
fIÅutSourû
->
	`isSynchrÚized
())) {

460 
fN“dAF¿me
 = 
F®£
;

462 
fDu¿tiÚInMiüo£cÚds
 = 
uSecsP”F¿me
;

467 
	`aá”G‘tšg
(
this
);

472 
fN“dAF¿me
 = 
True
;

473 ià(!
fIÅutSourû
->
	`isCu¼’yAwa™šgD©a
()) {

474 
fIÅutSourû
->
	`g‘NextF¿me
(
fDeš‹¾—všgBufãr
->
	`šputBufãr
(),

475 
fDeš‹¾—všgBufãr
->
	`šputBufãrSize
(),

476 
aá”G‘tšgF¿me
, 
this
,

477 
F¿medSourû
::
hªdËClosu»
, 
this
);

479 
	}
}

481 
	gAMRDeš‹¾—v”
::
	$doStİG‘tšgF¿mes
() {

482 
fN“dAF¿me
 = 
F®£
;

483 
fIÅutSourû
->
	`¡İG‘tšgF¿mes
();

484 
	}
}

486 
	gAMRDeš‹¾—v”


487 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

489 
timev®
 
´e£Á©iÚTime
,

491 
AMRDeš‹¾—v”
* 
deš‹¾—v”
 = (AMRDeš‹¾—v”*)
ş›ÁD©a
;

492 
deš‹¾—v”
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
´e£Á©iÚTime
);

493 
	}
}

495 
	gAMRDeš‹¾—v”


496 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
timev®
 
´e£Á©iÚTime
) {

497 
RawAMRRTPSourû
* 
sourû
 = (RawAMRRTPSourû*)
fIÅutSourû
;

500 
fDeš‹¾—všgBufãr
->
	`d–iv”IncomšgF¿me
(
äameSize
, 
sourû
, 
´e£Á©iÚTime
);

503 ià(
fN“dAF¿me
è
	`doG‘NextF¿me
();

504 
	}
}

509 
	gAMRDeš‹¾—všgBufãr


510 ::
	$AMRDeš‹¾—všgBufãr
(
numChªÃls
, 
maxIÁ”ËaveGroupSize
)

511 : 
	`fNumChªÃls
(
numChªÃls
), 
	`fMaxIÁ”ËaveGroupSize
(
maxIÁ”ËaveGroupSize
),

512 
	`fIncomšgBªkId
(0), 
	`fIncomšgBšMax
(0),

513 
	`fOutgošgBšMax
(0), 
	`fNextOutgošgBš
(0),

514 
	`fHaveS“nPack‘s
(
F®£
), 
	`fNumSucûssiveSynûdF¿mes
(0), 
	$fILL
(0) {

516 
fF¿mes
[0] = 
Ãw
 
F¿meDesütÜ
[
fMaxIÁ”ËaveGroupSize
];

517 
fF¿mes
[1] = 
Ãw
 
F¿meDesütÜ
[
fMaxIÁ”ËaveGroupSize
];

518 
fIÅutBufãr
 = 
	`ü—‹NewBufãr
();

519 
	}
}

521 
	gAMRDeš‹¾—všgBufãr
::~
	$AMRDeš‹¾—všgBufãr
() {

522 
d–‘e
[] 
fIÅutBufãr
;

523 
d–‘e
[] 
fF¿mes
[0]; delete[] fFrames[1];

524 
	}
}

526 
	gAMRDeš‹¾—všgBufãr


527 ::
	$d–iv”IncomšgF¿me
(
äameSize
, 
RawAMRRTPSourû
* 
sourû
,

528 
timev®
 
´e£Á©iÚTime
) {

529 
fILL
 = 
sourû
->
	`ILL
();

530 cÚ¡ 
ILP
 = 
sourû
->
	`ILP
();

531 
äameIndex
 = 
sourû
->
	`äameIndex
();

532 
·ck‘SeqNum
 = 
sourû
->
	`curPack‘RTPSeqNum
();

536 ià(
ILP
 > 
fILL
 || 
äameIndex
 == 0) {

537 #ifdeà
DEBUG


538 
	`årštf
(
¡d”r
, "AMRDeš‹¾—všgBufãr::d–iv”IncomšgF¿me(è·¿m sª™y check faed (%d,%d,%d,%d)\n", 
äameSize
, 
fILL
, 
ILP
, 
äameIndex
);

540 
sourû
->
	`’vœ
().
	`š‹º®E¼Ü
();

543 --
äameIndex
;

544 
u_št8_t
 
äameH—d”
;

545 ià(
äameIndex
 >ğ
sourû
->
	`TOCSize
()) {

546 
äameH—d”
 = 
FT_NO_DATA
<<3;

548 
äameH—d”
 = 
sourû
->
	`TOC
()[
äameIndex
];

551 
äameBlockIndex
 = 
äameIndex
/
fNumChªÃls
;

552 
äameW™hšF¿meBlock
 = 
äameIndex
%
fNumChªÃls
;

556 
uSecInüem’t
 = 
äameBlockIndex
*(
fILL
+1)*
uSecsP”F¿me
;

557 
´e£Á©iÚTime
.
tv_u£c
 +ğ
uSecInüem’t
;

558 
´e£Á©iÚTime
.
tv_£c
 +ğ´e£Á©iÚTime.
tv_u£c
/1000000;

559 
´e£Á©iÚTime
.
tv_u£c
 =…resentationTime.tv_usec%1000000;

562 ià(!
fHaveS“nPack‘s


563 || 
	`£qNumLT
(
fLa¡Pack‘SeqNumFÜGroup
, 
·ck‘SeqNum
 + 
äameBlockIndex
)) {

565 #ifdeà
DEBUG


566 
	`årštf
(
¡d”r
, "AMRDeinterleavingBuffer::deliverIncomingFrame():‚ew interleave group\n");

568 
fHaveS“nPack‘s
 = 
True
;

569 
fLa¡Pack‘SeqNumFÜGroup
 = 
·ck‘SeqNum
 + 
fILL
 - 
ILP
;

572 
fIncomšgBªkId
 ^= 1;

573 
tmp
 = 
fIncomšgBšMax
;

574 
fIncomšgBšMax
 = 
fOutgošgBšMax
;

575 
fOutgošgBšMax
 = 
tmp
;

576 
fNextOutgošgBš
 = 0;

580 cÚ¡ 
bšNumb”


581 ğ((
ILP
 + 
äameBlockIndex
*(
fILL
+1))*
fNumChªÃls
 + 
äameW™hšF¿meBlock
)

582 % 
fMaxIÁ”ËaveGroupSize
;

583 #ifdeà
DEBUG


584 
	`årštf
(
¡d”r
, "AMRDeš‹¾—všgBufãr::d–iv”IncomšgF¿me(): f¿meIndex %d (%d,%dèpuˆš bªk %d, bš %d (%d): siz%d, h—d” 0x%02x,…»£Á©iÚTim%lu.%06ld\n", 
äameIndex
, 
äameBlockIndex
, 
äameW™hšF¿meBlock
, 
fIncomšgBªkId
, 
bšNumb”
, 
fMaxIÁ”ËaveGroupSize
, 
äameSize
, 
äameH—d”
, 
´e£Á©iÚTime
.
tv_£c
,…»£Á©iÚTime.
tv_u£c
);

586 
F¿meDesütÜ
& 
šBš
 = 
fF¿mes
[
fIncomšgBªkId
][
bšNumb”
];

587 * 
curBufãr
 = 
šBš
.
äameD©a
;

588 
šBš
.
äameD©a
 = 
fIÅutBufãr
;

589 
šBš
.
äameSize
 = frameSize;

590 
šBš
.
äameH—d”
 = frameHeader;

591 
šBš
.
´e£Á©iÚTime
 =…resentationTime;

592 
šBš
.
fIsSynchrÚized
 = ((
RTPSourû
*)
sourû
)->RTPSourû::
	`hasB“nSynchrÚizedUsšgRTCP
();

594 ià(
curBufãr
 =ğ
NULL
ècurBufã¸ğ
	`ü—‹NewBufãr
();

595 
fIÅutBufãr
 = 
curBufãr
;

597 ià(
bšNumb”
 >ğ
fIncomšgBšMax
) {

598 
fIncomšgBšMax
 = 
bšNumb”
 + 1;

600 
	}
}

602 
BoŞ—n
 
	gAMRDeš‹¾—všgBufãr


603 ::
	$»Œ›veF¿me
(* 
to
, 
maxSize
,

604 & 
»suÉF¿meSize
, & 
»suÉNumTrunÿ‹dBy‹s
,

605 
u_št8_t
& 
»suÉF¿meH—d”
,

606 
timev®
& 
»suÉP»£Á©iÚTime
,

607 
BoŞ—n
& 
»suÉIsSynchrÚized
) {

609 ià(
fNextOutgošgBš
 >ğ
fOutgošgBšMax
è 
F®£
;

611 
F¿meDesütÜ
& 
outBš
 = 
fF¿mes
[
fIncomšgBªkId
^1][
fNextOutgošgBš
];

612 * 
äomPŒ
 = 
outBš
.
äameD©a
;

613 
äomSize
 = 
outBš
.
äameSize
;

614 
outBš
.
äameSize
 = 0;

615 
»suÉIsSynchrÚized
 = 
F®£
;

616 ià(
outBš
.
fIsSynchrÚized
) {

619 ià(++
fNumSucûssiveSynûdF¿mes
 > 
fILL
) {

620 
»suÉIsSynchrÚized
 = 
True
;

621 
fNumSucûssiveSynûdF¿mes
 = 
fILL
+1;

624 
fNumSucûssiveSynûdF¿mes
 = 0;

628 ià(
äomSize
 == 0) {

629 
»suÉF¿meH—d”
 = 
FT_NO_DATA
<<3;

632 
»suÉP»£Á©iÚTime
 = 
fLa¡R‘r›vedP»£Á©iÚTime
;

633 
»suÉP»£Á©iÚTime
.
tv_u£c
 +ğ
uSecsP”F¿me
;

634 ià(
»suÉP»£Á©iÚTime
.
tv_u£c
 >= 1000000) {

635 ++
»suÉP»£Á©iÚTime
.
tv_£c
;

636 
»suÉP»£Á©iÚTime
.
tv_u£c
 -= 1000000;

640 
»suÉF¿meH—d”
 = 
outBš
.
äameH—d”
;

641 
»suÉP»£Á©iÚTime
 = 
outBš
.
´e£Á©iÚTime
;

644 
fLa¡R‘r›vedP»£Á©iÚTime
 = 
»suÉP»£Á©iÚTime
;

646 ià(
äomSize
 > 
maxSize
) {

647 
»suÉNumTrunÿ‹dBy‹s
 = 
äomSize
 - 
maxSize
;

648 
»suÉF¿meSize
 = 
maxSize
;

650 
»suÉNumTrunÿ‹dBy‹s
 = 0;

651 
»suÉF¿meSize
 = 
äomSize
;

653 
	`memmove
(
to
, 
äomPŒ
, 
»suÉF¿meSize
);

654 #ifdeà
DEBUG


655 
	`årštf
(
¡d”r
, "AMRDeš‹¾—všgBufãr::»Œ›veF¿me(): from bªk %d, bš %d: siz%d, h—d” 0x%02x,…»£Á©iÚTim%lu.%06ld\n", 
fIncomšgBªkId
^1, 
fNextOutgošgBš
, 
»suÉF¿meSize
, 
»suÉF¿meH—d”
, 
»suÉP»£Á©iÚTime
.
tv_£c
,„esuÉP»£Á©iÚTime.
tv_u£c
);

658 ++
fNextOutgošgBš
;

659  
True
;

660 
	}
}

662 * 
	gAMRDeš‹¾—všgBufãr
::
	$ü—‹NewBufãr
() {

663  
Ãw
 [
	`šputBufãrSize
()];

664 
	}
}

666 
	gAMRDeš‹¾—všgBufãr
::
F¿meDesütÜ
::
	$F¿meDesütÜ
()

667 : 
	`äameSize
(0), 
	$äameD©a
(
NULL
) {

668 
	}
}

670 
	gAMRDeš‹¾—všgBufãr
::
F¿meDesütÜ
::~
	$F¿meDesütÜ
() {

671 
d–‘e
[] 
äameD©a
;

672 
	}
}

675 cÚ¡ 
	gäameB™sFromFT
[16] = {

681 cÚ¡ 
	gäameB™sFromFTWidebªd
[16] = {

688 
	$uÅackBªdwidthEffic›ÁD©a
(
Bufã»dPack‘
* 
·ck‘
,

689 
BoŞ—n
 
isWidebªd
) {

690 #ifdeà
DEBUG


691 
	`årštf
(
¡d”r
, "UÅackšg 'bªdwidth-effic›Á'…aylßd (%d by‹s):\n", 
·ck‘
->
	`d©aSize
());

692 
j
 = 0; j < 
·ck‘
->
	`d©aSize
(); ++j) {

693 
	`årštf
(
¡d”r
, "%02x:", (
·ck‘
->
	`d©a
())[
j
]);

695 
	`årštf
(
¡d”r
, "\n");

697 
B™VeùÜ
 
	`äomBV
(
·ck‘
->
	`d©a
(), 0, 8*·ck‘->
	`d©aSize
());

699 cÚ¡ 
toBufãrSize
 = 2*
·ck‘
->
	`d©aSize
();

700 * 
toBufãr
 = 
Ãw
 [
toBufãrSize
];

701 
toCouÁ
 = 0;

704 
CMR
 = 
äomBV
.
	`g‘B™s
(4);

705 
toBufãr
[
toCouÁ
++] = 
CMR
 << 4;

709 
toc
 = 
äomBV
.
	`g‘B™s
(6);

710 
toBufãr
[
toCouÁ
++] = 
toc
 << 2;

712 ià((
toc
&0x20) == 0) ;

716 cÚ¡ 
tocSize
 = 
toCouÁ
 - 1;

717 
i
 = 1; i <ğ
tocSize
; ++i) {

718 
tocBy‹
 = 
toBufãr
[
i
];

719 cÚ¡ 
FT
 = (
tocBy‹
&0x78) >> 3;

720 
äameSizeB™s


721 ğ
isWidebªd
 ? 
äameB™sFromFTWidebªd
[
FT
] : 
äameB™sFromFT
[FT];

722 
äameSizeBy‹s
 = (
äameSizeB™s
+7)/8;

724 
	`shiáB™s
(&
toBufãr
[
toCouÁ
], 0,

725 
·ck‘
->
	`d©a
(), 
äomBV
.
	`curB™Index
(),

726 
äameSizeB™s


728 #ifdeà
DEBUG


729 ià(
äameSizeB™s
 > 
äomBV
.
	`numB™sRemaššg
()) {

730 
	`årštf
(
¡d”r
, "\tW¬nšg: UÅackšg f¿m%d oà%d: wªˆ%d b™s, buˆÚly %d‡»‡vaabË!\n", 
i
, 
tocSize
, 
äameSizeB™s
, 
äomBV
.
	`numB™sRemaššg
());

733 
äomBV
.
	`skB™s
(
äameSizeB™s
);

734 
toCouÁ
 +ğ
äameSizeBy‹s
;

737 #ifdeà
DEBUG


738 ià(
äomBV
.
	`numB™sRemaššg
() > 7) {

739 
	`årštf
(
¡d”r
, "\tW¬nšg: %d b™ »maš unu£d!\n", 
äomBV
.
	`numB™sRemaššg
());

744 
·ck‘
->
	`»movePaddšg
Õack‘->
	`d©aSize
());

745 
·ck‘
->
	`­³ndD©a
(
toBufãr
, 
toCouÁ
);

746 
d–‘e
[] 
toBufãr
;

747 
	}
}

	@liveMedia/AMRAudioSource.cpp

21 
	~"AMRAudioSourû.hh
"

23 
	gAMRAudioSourû
::
	$AMRAudioSourû
(
U§geEnvœÚm’t
& 
’v
,

24 
BoŞ—n
 
isWidebªd
, 
numChªÃls
)

25 : 
	`F¿medSourû
(
’v
),

26 
	`fIsWidebªd
(
isWidebªd
), 
	`fNumChªÃls
(
numChªÃls
), 
	$fLa¡F¿meH—d”
(0) {

27 
	}
}

29 
	gAMRAudioSourû
::~
	$AMRAudioSourû
() {

30 
	}
}

32 cÚ¡* 
AMRAudioSourû
::
	$MIMEty³
() const {

34 
	}
}

36 
BoŞ—n
 
	gAMRAudioSourû
::
	$isAMRAudioSourû
() const {

37  
True
;

38 
	}
}

	@liveMedia/AVIFileSink.cpp

21 
	~"AVIFeSšk.hh
"

22 
	~"IÅutFe.hh
"

23 
	~"OuutFe.hh
"

24 
	~"GroupsockH–³r.hh
"

26 
	#fourCh¬
(
x
,
y
,
z
,
w
èĞ((w)<<24)|((z)<<16)|((y)<<8)|(xè)

	)

31 şas 
	cSub£ssiÚBufãr
 {

32 
	mpublic
:

33 
	$Sub£ssiÚBufãr
(
bufãrSize
)

34 : 
	$fBufãrSize
(
bufãrSize
) {

35 
	`»£t
();

36 
fD©a
 = 
Ãw
 [
bufãrSize
];

38 
vœtu®
 ~
	$Sub£ssiÚBufãr
(è{ 
d–‘e
[] 
fD©a
; 
	}
}

39 
	$»£t
(è{ 
fBy‹sInU£
 = 0; 
	}
}

40 
	$addBy‹s
(
numBy‹s
è{ 
fBy‹sInU£
 +ğnumBy‹s; 
	}
}

42 * 
	$d©aS¹
(è{  &
fD©a
[0]; 
	}
}

43 * 
	$d©aEnd
(è{  &
fD©a
[
fBy‹sInU£
]; 
	}
}

44 
	$by‹sInU£
(ècÚ¡ {  
fBy‹sInU£
; 
	}
}

45 
	$by‹sAvaabË
(ècÚ¡ {  
fBufãrSize
 - 
fBy‹sInU£
; 
	}
}

47 
	$£tP»£Á©iÚTime
(
timev®
 cÚ¡& 
´e£Á©iÚTime
) {

48 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

49 
	}
}

50 
timev®
 cÚ¡& 
	$´e£Á©iÚTime
(ècÚ¡ { 
fP»£Á©iÚTime
;
	}
}

52 
	g´iv©e
:

53 
fBufãrSize
;

54 
timev®
 
	gfP»£Á©iÚTime
;

55 * 
	gfD©a
;

56 
	gfBy‹sInU£
;

59 şas 
	cAVISub£ssiÚIOS‹
 {

60 
	mpublic
:

61 
AVISub£ssiÚIOS‹
(
AVIFeSšk
& 
sšk
, 
MedŸSub£ssiÚ
& 
sub£ssiÚ
);

62 
	mvœtu®
 ~
AVISub£ssiÚIOS‹
();

64 
£tAVI¡©e
(
sub£ssiÚIndex
);

65 
£tFš®AVI¡©e
();

67 
aá”G‘tšgF¿me
(
·ck‘D©aSize
,

68 
timev®
 
´e£Á©iÚTime
);

69 
ÚSourûClosu»
();

71 
	mU§geEnvœÚm’t
& 
	$’vœ
(ècÚ¡ {  
fOurSšk
.
	`’vœ
(); }

73 
public
:

74 
Sub£ssiÚBufãr
 *
fBufãr
, *
fP»vBufãr
;

75 
AVIFeSšk
& 
fOurSšk
;

76 
MedŸSub£ssiÚ
& 
fOurSub£ssiÚ
;

78 
fLa¡Pack‘RTPSeqNum
;

79 
BoŞ—n
 
fOurSourûIsAùive
;

80 
timev®
 
fP»vP»£Á©iÚTime
;

81 
fMaxBy‹sP”SecÚd
;

82 
BoŞ—n
 
fIsVideo
, 
fIsAudio
, 
fIsBy‹Sw­³dAudio
;

83 
fAVISub£ssiÚTag
;

84 
fAVICodecHªdËrTy³
;

85 
fAVISam¶šgF»qu’cy
;

86 
u_št16_t
 
fWAVCodecTag
;

87 
fAVISÿË
;

88 
fAVIR©e
;

89 
fAVISize
;

90 
fNumF¿mes
;

91 
fSTRHF¿meCouÁPos™iÚ
;

93 
´iv©e
:

94 
	`u£F¿me
(
Sub£ssiÚBufãr
& 
bufãr
);

95 
	}
};

100 şas 
	cAVIIndexRecÜd
 {

101 
	mpublic
:

102 
	$AVIIndexRecÜd
(
chunkId
, 
æags
, 
off£t
, 
size
)

103 : 
	`fNext
(
NULL
), 
	`fChunkId
(
chunkId
), 
	`fFÏgs
(
æags
), 
	`fOff£t
(
off£t
), 
	$fSize
(
size
) {

106 
AVIIndexRecÜd
*& 
	$Ãxt
(è{  
fNext
; 
	}
}

107 
	$chunkId
(ècÚ¡ {  
fChunkId
; 
	}
}

108 
	$æags
(ècÚ¡ {  
fFÏgs
; 
	}
}

109 
	$off£t
(ècÚ¡ {  
fOff£t
; 
	}
}

110 
	$size
(ècÚ¡ {  
fSize
; 
	}
}

112 
	g´iv©e
:

113 
AVIIndexRecÜd
* 
fNext
;

114 
	gfChunkId
;

115 
	gfFÏgs
;

116 
	gfOff£t
;

117 
	gfSize
;

123 
	gAVIFeSšk
::
	$AVIFeSšk
(
U§geEnvœÚm’t
& 
’v
,

124 
MedŸSessiÚ
& 
šputSessiÚ
,

125 cÚ¡* 
ouutFeName
,

126 
bufãrSize
,

127 
mov›Width
, 
mov›Height
,

128 
mov›FPS
, 
BoŞ—n
 
·ck‘LossCom³n§‹
)

129 : 
	`Medium
(
’v
), 
	`fIÅutSessiÚ
(
šputSessiÚ
),

130 
	`fIndexRecÜdsH—d
(
NULL
), 
	`fIndexRecÜdsTa
(NULL), 
	`fNumIndexRecÜds
(0),

131 
	`fBufãrSize
(
bufãrSize
), 
	`fPack‘LossCom³n§‹
(
·ck‘LossCom³n§‹
),

132 
	`fA»Cu¼’yBešgPÏyed
(
F®£
), 
	`fNumSub£ssiÚs
(0), 
	`fNumBy‹sWr™‹n
(0),

133 
	`fHaveCom¶‘edOuutFe
(
F®£
),

134 
	`fMov›Width
(
mov›Width
), 
	`fMov›Height
(
mov›Height
), 
	$fMov›FPS
(
mov›FPS
) {

135 
fOutFid
 = 
	`O³nOuutFe
(
’v
, 
ouutFeName
);

136 ià(
fOutFid
 =ğ
NULL
) ;

139 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

140 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

141 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

143 
F¿medSourû
* 
sub£ssiÚSourû
 = 
sub£ssiÚ
->
	`»adSourû
();

144 ià(
sub£ssiÚSourû
 =ğ
NULL
) ;

148 ià(
sub£ssiÚ
->
	`videoWidth
() != 0) {

149 
fMov›Width
 = 
sub£ssiÚ
->
	`videoWidth
();

151 ià(
sub£ssiÚ
->
	`videoHeight
() != 0) {

152 
fMov›Height
 = 
sub£ssiÚ
->
	`videoHeight
();

154 ià(
sub£ssiÚ
->
	`videoFPS
() != 0) {

155 
fMov›FPS
 = 
sub£ssiÚ
->
	`videoFPS
();

158 
AVISub£ssiÚIOS‹
* 
ioS‹


159 ğ
Ãw
 
	`AVISub£ssiÚIOS‹
(*
this
, *
sub£ssiÚ
);

160 
sub£ssiÚ
->
miscPŒ
 = (*)
ioS‹
;

163 ià(
sub£ssiÚ
->
	`¹ıIn¡ªû
(è!ğ
NULL
) {

164 
sub£ssiÚ
->
	`¹ıIn¡ªû
()->
	`£tByeHªdËr
(
ÚRTCPBye
, 
ioS‹
);

167 ++
fNumSub£ssiÚs
;

171 
	`addFeH—d”_AVI
();

172 
	}
}

174 
	gAVIFeSšk
::~
	$AVIFeSšk
() {

175 
	`com¶‘eOuutFe
();

178 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

179 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

180 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

181 ià(
sub£ssiÚ
->
	`»adSourû
(è!ğ
NULL
èsub£ssiÚ->»adSourû()->
	`¡İG‘tšgF¿mes
();

183 
AVISub£ssiÚIOS‹
* 
ioS‹


184 ğ(
AVISub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

185 ià(
ioS‹
 =ğ
NULL
) ;

187 
d–‘e
 
ioS‹
;

191 
AVIIndexRecÜd
* 
cur
 = 
fIndexRecÜdsH—d
;

192 
cur
 !ğ
NULL
) {

193 
AVIIndexRecÜd
* 
Ãxt
 = 
cur
->
	`Ãxt
();

194 
d–‘e
 
cur
;

195 
cur
 = 
Ãxt
;

199 
	`Clo£OuutFe
(
fOutFid
);

200 
	}
}

202 
AVIFeSšk
* 
	gAVIFeSšk


203 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
MedŸSessiÚ
& 
šputSessiÚ
,

204 cÚ¡* 
ouutFeName
,

205 
bufãrSize
,

206 
mov›Width
, 
mov›Height
,

207 
mov›FPS
, 
BoŞ—n
 
·ck‘LossCom³n§‹
) {

208 
AVIFeSšk
* 
ÃwSšk
 =

209 
Ãw
 
	`AVIFeSšk
(
’v
, 
šputSessiÚ
, 
ouutFeName
, 
bufãrSize
,

210 
mov›Width
, 
mov›Height
, 
mov›FPS
, 
·ck‘LossCom³n§‹
);

211 ià(
ÃwSšk
 =ğ
NULL
 ||‚ewSšk->
fOutFid
 == NULL) {

212 
Medium
::
	`şo£
(
ÃwSšk
);

213  
NULL
;

216  
ÃwSšk
;

217 
	}
}

219 
BoŞ—n
 
	gAVIFeSšk
::
	$¡¬tPÏyšg
(
aá”PÏyšgFunc
* 
aá”Func
,

220 * 
aá”Cl›ÁD©a
) {

222 ià(
fA»Cu¼’yBešgPÏyed
) {

223 
	`’vœ
().
	`£tResuÉMsg
("This sink has‡lready been…layed");

224  
F®£
;

227 
fA»Cu¼’yBešgPÏyed
 = 
True
;

228 
fAá”Func
 = 
aá”Func
;

229 
fAá”Cl›ÁD©a
 = 
aá”Cl›ÁD©a
;

231  
	`cÚtšuePÏyšg
();

232 
	}
}

234 
BoŞ—n
 
	gAVIFeSšk
::
	$cÚtšuePÏyšg
() {

237 
BoŞ—n
 
haveAùiveSub£ssiÚs
 = 
F®£
;

238 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

239 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

240 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

241 
F¿medSourû
* 
sub£ssiÚSourû
 = 
sub£ssiÚ
->
	`»adSourû
();

242 ià(
sub£ssiÚSourû
 =ğ
NULL
) ;

244 ià(
sub£ssiÚSourû
->
	`isCu¼’yAwa™šgD©a
()) ;

246 
AVISub£ssiÚIOS‹
* 
ioS‹


247 ğ(
AVISub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

248 ià(
ioS‹
 =ğ
NULL
) ;

250 
haveAùiveSub£ssiÚs
 = 
True
;

251 * 
toPŒ
 = 
ioS‹
->
fBufãr
->
	`d©aEnd
();

252 
toSize
 = 
ioS‹
->
fBufãr
->
	`by‹sAvaabË
();

253 
sub£ssiÚSourû
->
	`g‘NextF¿me
(
toPŒ
, 
toSize
,

254 
aá”G‘tšgF¿me
, 
ioS‹
,

255 
ÚSourûClosu»
, 
ioS‹
);

257 ià(!
haveAùiveSub£ssiÚs
) {

258 
	`’vœ
().
	`£tResuÉMsg
("No subsessions‡re currently‡ctive");

259  
F®£
;

262  
True
;

263 
	}
}

265 
	gAVIFeSšk


266 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
·ck‘D©aSize
,

267 
numTrunÿ‹dBy‹s
,

268 
timev®
 
´e£Á©iÚTime
,

270 
AVISub£ssiÚIOS‹
* 
ioS‹
 = (AVISub£ssiÚIOS‹*)
ş›ÁD©a
;

271 ià(
numTrunÿ‹dBy‹s
 > 0) {

272 
ioS‹
->
	`’vœ
() << "AVIFileSink::afterGettingFrame(): The input frame data wasoo†arge for our buffer. "

273 << 
numTrunÿ‹dBy‹s


276 
ioS‹
->
	`aá”G‘tšgF¿me
(
·ck‘D©aSize
, 
´e£Á©iÚTime
);

277 
	}
}

279 
	gAVIFeSšk
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

280 
AVISub£ssiÚIOS‹
* 
ioS‹
 = (AVISub£ssiÚIOS‹*)
ş›ÁD©a
;

281 
ioS‹
->
	`ÚSourûClosu»
();

282 
	}
}

284 
	gAVIFeSšk
::
	$ÚSourûClosu»1
() {

287 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

288 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

289 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

290 
AVISub£ssiÚIOS‹
* 
ioS‹


291 ğ(
AVISub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

292 ià(
ioS‹
 =ğ
NULL
) ;

294 ià(
ioS‹
->
fOurSourûIsAùive
) ;

297 
	`com¶‘eOuutFe
();

300 ià(
fAá”Func
 !ğ
NULL
) {

301 (*
fAá”Func
)(
fAá”Cl›ÁD©a
);

303 
	}
}

305 
	gAVIFeSšk
::
	$ÚRTCPBye
(* 
ş›ÁD©a
) {

306 
AVISub£ssiÚIOS‹
* 
ioS‹
 = (AVISub£ssiÚIOS‹*)
ş›ÁD©a
;

308 
timev®
 
timeNow
;

309 
	`g‘timeofday
(&
timeNow
, 
NULL
);

310 
£csDiff


311 ğ
timeNow
.
tv_£c
 - 
ioS‹
->
fOurSšk
.
fS¹Time
.tv_sec;

313 
MedŸSub£ssiÚ
& 
sub£ssiÚ
 = 
ioS‹
->
fOurSub£ssiÚ
;

314 
ioS‹
->
	`’vœ
() << "Received RTCP \"BYE\" on \""

315 << 
sub£ssiÚ
.
	`mediumName
()

316 << "/" << 
sub£ssiÚ
.
	`codecName
()

318 << 
£csDiff
 << " seconds)\n";

321 
ioS‹
->
	`ÚSourûClosu»
();

322 
	}
}

324 
	gAVIFeSšk
::
	$addIndexRecÜd
(
AVIIndexRecÜd
* 
ÃwIndexRecÜd
) {

325 ià(
fIndexRecÜdsH—d
 =ğ
NULL
) {

326 
fIndexRecÜdsH—d
 = 
ÃwIndexRecÜd
;

328 
fIndexRecÜdsTa
->
	`Ãxt
(èğ
ÃwIndexRecÜd
;

330 
fIndexRecÜdsTa
 = 
ÃwIndexRecÜd
;

331 ++
fNumIndexRecÜds
;

332 
	}
}

334 
	gAVIFeSšk
::
	$com¶‘eOuutFe
() {

335 ià(
fHaveCom¶‘edOuutFe
 || 
fOutFid
 =ğ
NULL
) ;

339 
maxBy‹sP”SecÚd
 = 0;

340 
numVideoF¿mes
 = 0;

341 
numAudioF¿mes
 = 0;

344 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

345 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

346 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

347 
AVISub£ssiÚIOS‹
* 
ioS‹


348 ğ(
AVISub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

349 ià(
ioS‹
 =ğ
NULL
) ;

351 
maxBy‹sP”SecÚd
 +ğ
ioS‹
->
fMaxBy‹sP”SecÚd
;

353 
	`£tWÜd
(
ioS‹
->
fSTRHF¿meCouÁPos™iÚ
, ioS‹->
fNumF¿mes
);

354 ià(
ioS‹
->
fIsVideo
è
numVideoF¿mes
 = ioS‹->
fNumF¿mes
;

355 ià(
ioS‹
->
fIsAudio
è
numAudioF¿mes
 = ioS‹->
fNumF¿mes
;

359 
	`add4By‹SŒšg
("idx1");

360 
	`addWÜd
(
fNumIndexRecÜds
*4*4);

361 
AVIIndexRecÜd
* 
šdexRecÜd
 = 
fIndexRecÜdsH—d
; indexRecÜd !ğ
NULL
; indexRecÜd = indexRecÜd->
	`Ãxt
()) {

362 
	`addWÜd
(
šdexRecÜd
->
	`chunkId
());

363 
	`addWÜd
(
šdexRecÜd
->
	`æags
());

364 
	`addWÜd
(
šdexRecÜd
->
	`off£t
());

365 
	`addWÜd
(
šdexRecÜd
->
	`size
());

368 
fRIFFSizeV®ue
 +ğ
fNumBy‹sWr™‹n
;

369 
	`£tWÜd
(
fRIFFSizePos™iÚ
, 
fRIFFSizeV®ue
);

371 
	`£tWÜd
(
fAVIHMaxBy‹sP”SecÚdPos™iÚ
, 
maxBy‹sP”SecÚd
);

372 
	`£tWÜd
(
fAVIHF¿meCouÁPos™iÚ
,

373 
numVideoF¿mes
 > 0 ?‚umVideoF¿me : 
numAudioF¿mes
);

375 
fMoviSizeV®ue
 +ğ
fNumBy‹sWr™‹n
;

376 
	`£tWÜd
(
fMoviSizePos™iÚ
, 
fMoviSizeV®ue
);

379 
fHaveCom¶‘edOuutFe
 = 
True
;

380 
	}
}

385 
	gAVISub£ssiÚIOS‹
::
	$AVISub£ssiÚIOS‹
(
AVIFeSšk
& 
sšk
,

386 
MedŸSub£ssiÚ
& 
sub£ssiÚ
)

387 : 
	`fOurSšk
(
sšk
), 
	`fOurSub£ssiÚ
(
sub£ssiÚ
),

388 
	`fMaxBy‹sP”SecÚd
(0), 
	`fIsVideo
(
F®£
), 
	`fIsAudio
(F®£), 
	`fIsBy‹Sw­³dAudio
(F®£), 
	$fNumF¿mes
(0) {

389 
fBufãr
 = 
Ãw
 
	`Sub£ssiÚBufãr
(
fOurSšk
.
fBufãrSize
);

390 
fP»vBufãr
 = 
sšk
.
fPack‘LossCom³n§‹


391 ? 
Ãw
 
	`Sub£ssiÚBufãr
(
fOurSšk
.
fBufãrSize
è: 
NULL
;

393 
F¿medSourû
* 
sub£ssiÚSourû
 = 
sub£ssiÚ
.
	`»adSourû
();

394 
fOurSourûIsAùive
 = 
sub£ssiÚSourû
 !ğ
NULL
;

396 
fP»vP»£Á©iÚTime
.
tv_£c
 = 0;

397 
fP»vP»£Á©iÚTime
.
tv_u£c
 = 0;

398 
	}
}

400 
	gAVISub£ssiÚIOS‹
::~
	$AVISub£ssiÚIOS‹
() {

401 
d–‘e
 
fBufãr
; d–‘
fP»vBufãr
;

402 
	}
}

404 
	gAVISub£ssiÚIOS‹
::
	$£tAVI¡©e
(
sub£ssiÚIndex
) {

405 
fIsVideo
 = 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`mediumName
(), "video") == 0;

406 
fIsAudio
 = 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`mediumName
(), "audio") == 0;

408 ià(
fIsVideo
) {

409 
fAVISub£ssiÚTag


410 ğ
	`fourCh¬
('0'+
sub£ssiÚIndex
/10,'0'+subsessionIndex%10,'d','c');

411 ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "JPEG") == 0) {

412 
fAVICodecHªdËrTy³
 = 
	`fourCh¬
('m','j','p','g');

413 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MP4V-ES") == 0) {

414 
fAVICodecHªdËrTy³
 = 
	`fourCh¬
('D','I','V','X');

415 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MPV") == 0) {

416 
fAVICodecHªdËrTy³
 = 
	`fourCh¬
('m','p','g','1');

417 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H263-1998") == 0 ||

418 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H263-2000") == 0) {

419 
fAVICodecHªdËrTy³
 = 
	`fourCh¬
('H','2','6','3');

420 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H264") == 0) {

421 
fAVICodecHªdËrTy³
 = 
	`fourCh¬
('H','2','6','4');

423 
fAVICodecHªdËrTy³
 = 
	`fourCh¬
('?','?','?','?');

425 
fAVISÿË
 = 1;

426 
fAVIR©e
 = 
fOurSšk
.
fMov›FPS
;

427 
fAVISize
 = 
fOurSšk
.
fMov›Width
*fOurSšk.
fMov›Height
*3;

428 } ià(
fIsAudio
) {

429 
fIsBy‹Sw­³dAudio
 = 
F®£
;

430 
fAVISub£ssiÚTag


431 ğ
	`fourCh¬
('0'+
sub£ssiÚIndex
/10,'0'+subsessionIndex%10,'w','b');

432 
fAVICodecHªdËrTy³
 = 1;

433 
numChªÃls
 = 
fOurSub£ssiÚ
.
	`numChªÃls
();

434 
fAVISam¶šgF»qu’cy
 = 
fOurSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
();

435 ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "L16") == 0) {

436 
fIsBy‹Sw­³dAudio
 = 
True
;

437 
fWAVCodecTag
 = 0x0001;

438 
fAVISÿË
 = 
fAVISize
 = 2*
numChªÃls
;

439 
fAVIR©e
 = 
fAVISize
*
fAVISam¶šgF»qu’cy
;

440 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "L8") == 0) {

441 
fWAVCodecTag
 = 0x0001;

442 
fAVISÿË
 = 
fAVISize
 = 
numChªÃls
;

443 
fAVIR©e
 = 
fAVISize
*
fAVISam¶šgF»qu’cy
;

444 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "PCMA") == 0) {

445 
fWAVCodecTag
 = 0x0006;

446 
fAVISÿË
 = 
fAVISize
 = 
numChªÃls
;

447 
fAVIR©e
 = 
fAVISize
*
fAVISam¶šgF»qu’cy
;

448 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "PCMU") == 0) {

449 
fWAVCodecTag
 = 0x0007;

450 
fAVISÿË
 = 
fAVISize
 = 
numChªÃls
;

451 
fAVIR©e
 = 
fAVISize
*
fAVISam¶šgF»qu’cy
;

452 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MPA") == 0) {

453 
fWAVCodecTag
 = 0x0050;

454 
fAVISÿË
 = 
fAVISize
 = 1;

455 
fAVIR©e
 = 0;

457 
fWAVCodecTag
 = 0x0001;

458 
fAVISÿË
 = 
fAVISize
 = 1;

459 
fAVIR©e
 = 0;

462 
fAVISub£ssiÚTag


463 ğ
	`fourCh¬
('0'+
sub£ssiÚIndex
/10,'0'+subsessionIndex%10,'?','?');

464 
fAVICodecHªdËrTy³
 = 0;

465 
fAVISÿË
 = 
fAVISize
 = 1;

466 
fAVIR©e
 = 0;

468 
	}
}

470 
	gAVISub£ssiÚIOS‹
::
	$aá”G‘tšgF¿me
(
·ck‘D©aSize
,

471 
timev®
 
´e£Á©iÚTime
) {

474 
¹pSeqNum


475 ğ
fOurSub£ssiÚ
.
	`¹pSourû
()->
	`curPack‘RTPSeqNum
();

476 ià(
fOurSšk
.
fPack‘LossCom³n§‹
 && 
fP»vBufãr
->
	`by‹sInU£
() > 0) {

477 
£qNumG­
 = 
¹pSeqNum
 - 
fLa¡Pack‘RTPSeqNum
;

478 
i
 = 1; i < 
£qNumG­
; ++i) {

480 
	`u£F¿me
(*
fP»vBufãr
);

483 
fLa¡Pack‘RTPSeqNum
 = 
¹pSeqNum
;

486 ià(
fBufãr
->
	`by‹sInU£
() == 0) {

487 
fBufãr
->
	`£tP»£Á©iÚTime
(
´e£Á©iÚTime
);

489 
fBufãr
->
	`addBy‹s
(
·ck‘D©aSize
);

491 
	`u£F¿me
(*
fBufãr
);

492 ià(
fOurSšk
.
fPack‘LossCom³n§‹
) {

494 
Sub£ssiÚBufãr
* 
tmp
 = 
fP»vBufãr
;

495 
fP»vBufãr
 = 
fBufãr
;

496 
fBufãr
 = 
tmp
;

498 
fBufãr
->
	`»£t
();

501 
fOurSšk
.
	`cÚtšuePÏyšg
();

502 
	}
}

504 
	gAVISub£ssiÚIOS‹
::
	$u£F¿me
(
Sub£ssiÚBufãr
& 
bufãr
) {

505 * cÚ¡ 
äameSourû
 = 
bufãr
.
	`d©aS¹
();

506 cÚ¡ 
äameSize
 = 
bufãr
.
	`by‹sInU£
();

507 
timev®
 cÚ¡& 
´e£Á©iÚTime
 = 
bufãr
.
	`´e£Á©iÚTime
();

508 ià(
fP»vP»£Á©iÚTime
.
tv_u£c
 !ğ0||fP»vP»£Á©iÚTime.
tv_£c
 != 0) {

509 
uSecÚdsDiff


510 ğ(
´e£Á©iÚTime
.
tv_£c
 - 
fP»vP»£Á©iÚTime
.tv_sec)*1000000

511 + (
´e£Á©iÚTime
.
tv_u£c
 - 
fP»vP»£Á©iÚTime
.tv_usec);

512 ià(
uSecÚdsDiff
 > 0) {

513 
by‹sP”SecÚd
 = ()((
äameSize
*1000000.0)/
uSecÚdsDiff
);

514 ià(
by‹sP”SecÚd
 > 
fMaxBy‹sP”SecÚd
) {

515 
fMaxBy‹sP”SecÚd
 = 
by‹sP”SecÚd
;

519 
fP»vP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

521 ià(
fIsBy‹Sw­³dAudio
) {

524 
i
 = 0; i < 
äameSize
; i += 2) {

525 
tmp
 = 
äameSourû
[
i
];

526 
äameSourû
[
i
] = frameSource[i+1];

527 
äameSourû
[
i
+1] = 
tmp
;

532 
AVIIndexRecÜd
* 
ÃwIndexRecÜd


533 ğ
Ãw
 
	`AVIIndexRecÜd
(
fAVISub£ssiÚTag
,

534 
äameSourû
[0] == 0x67 ? 0x10 : 0,

535 
fOurSšk
.
fMoviSizePos™iÚ
 + 8 + fOurSšk.
fNumBy‹sWr™‹n
,

536 
äameSize
 + 4);

537 
fOurSšk
.
	`addIndexRecÜd
(
ÃwIndexRecÜd
);

540 
fOurSšk
.
fNumBy‹sWr™‹n
 +ğfOurSšk.
	`addWÜd
(
fAVISub£ssiÚTag
);

541 ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H264") == 0) {

543 
fOurSšk
.
fNumBy‹sWr™‹n
 +ğfOurSšk.
	`addWÜd
(4+
äameSize
);

544 
fOurSšk
.
fNumBy‹sWr™‹n
 +ğfOurSšk.
	`addWÜd
(
	`fourCh¬
(0x00, 0x00, 0x00, 0x01));

546 
fOurSšk
.
fNumBy‹sWr™‹n
 +ğfOurSšk.
	`addWÜd
(
äameSize
);

548 
	`fwr™e
(
äameSourû
, 1, 
äameSize
, 
fOurSšk
.
fOutFid
);

549 
fOurSšk
.
fNumBy‹sWr™‹n
 +ğ
äameSize
;

551 ià(
äameSize
%2 !ğ0è
fOurSšk
.
fNumBy‹sWr™‹n
 +ğfOurSšk.
	`addBy‹
(0);

553 ++
fNumF¿mes
;

554 
	}
}

556 
	gAVISub£ssiÚIOS‹
::
	$ÚSourûClosu»
() {

557 
fOurSourûIsAùive
 = 
F®£
;

558 
fOurSšk
.
	`ÚSourûClosu»1
();

559 
	}
}

564 
	gAVIFeSšk
::
	$addWÜd
(
wÜd
) {

566 
	`addBy‹
(
wÜd
);‡ddByte(word>>8);

567 
	`addBy‹
(
wÜd
>>16);‡ddByte(word>>24);

570 
	}
}

572 
	gAVIFeSšk
::
	$addH®fWÜd
(
h®fWÜd
) {

574 
	`addBy‹
(()
h®fWÜd
);‡ddByte(()(halfWord>>8));

577 
	}
}

579 
	gAVIFeSšk
::
	$addZ”oWÜds
(
numWÜds
) {

580 
i
 = 0; i < 
numWÜds
; ++i) {

581 
	`addWÜd
(0);

584  
numWÜds
*4;

585 
	}
}

587 
	gAVIFeSšk
::
	$add4By‹SŒšg
(cÚ¡* 
¡r
) {

588 
	`addBy‹
(
¡r
[0]);‡ddByte(str[1]);‡ddByte(str[2]);

589 
	`addBy‹
(
¡r
[3] == '\0' ? ' ' : str[3]);

592 
	}
}

594 
	gAVIFeSšk
::
	$£tWÜd
(
fePo¢
, 
size
) {

596 ià(
	`S“kFe64
(
fOutFid
, 
fePo¢
, 
SEEK_SET
) < 0) ;

597 
	`addWÜd
(
size
);

598 ià(
	`S“kFe64
(
fOutFid
, 0, 
SEEK_END
) < 0) ;

604 
	`’vœ
() << "AVIFileSink::setWord(): SeekFile64 failed (err "

605 << 
	`’vœ
().
	`g‘E¼no
() << ")\n";

606 
	}
}

610 
	#addFeH—d”
(
g
,
Çme
) \

611 
AVIFeSšk
::
addFeH—d”_
##
	`Çme
() { \

612 
	`add4By‹SŒšg
("" #tag ""); \

613 
h—d”SizePo¢
 = ()
	`T–lFe64
(
fOutFid
); 
	`addWÜd
(0); \

614 
	`add4By‹SŒšg
("" #name ""); \

615 
ignÜedSize
 = 8; \

616 
size
 = 12

	)

618 
	#addFeH—d”1
(
Çme
) \

619 
AVIFeSšk
::
addFeH—d”_
##
	`Çme
() { \

620 
	`add4By‹SŒšg
("" #name ""); \

621 
h—d”SizePo¢
 = ()
	`T–lFe64
(
fOutFid
); 
	`addWÜd
(0); \

622 
ignÜedSize
 = 8; \

623 
size
 = 8

	)

625 
	#addFeH—d”End
 \

626 
	`£tWÜd
(
h—d”SizePo¢
, 
size
-
ignÜedSize
); \

627  
size
; \

628 }

	)

630 
addFeH—d”
(
RIFF
,
AVI
);

631 
	gsize
 +ğ
addFeH—d”_hd¾
();

632 
	gsize
 +ğ
addFeH—d”_movi
();

633 
	gfRIFFSizePos™iÚ
 = 
h—d”SizePo¢
;

634 
	gfRIFFSizeV®ue
 = 
size
-
ignÜedSize
;

635 
	gaddFeH—d”End
;

637 
addFeH—d”
(
LIST
,
hd¾
);

638 
	gsize
 +ğ
addFeH—d”_avih
();

642 
	gsub£ssiÚCouÁ
 = 0;

643 
MedŸSub£ssiÚI‹¿tÜ
 
™”
(
fIÅutSessiÚ
);

644 
MedŸSub£ssiÚ
* 
	gsub£ssiÚ
;

645 (
	gsub£ssiÚ
 = 
™”
.
Ãxt
()è!ğ
NULL
) {

646 
fCu¼’tIOS‹
 = (
AVISub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

647 ià(
	gfCu¼’tIOS‹
 =ğ
NULL
) ;

648 ià(
¡rcmp
(
sub£ssiÚ
->
mediumName
(), "video") != 0) ;

650 
	gfCu¼’tIOS‹
->
£tAVI¡©e
(
sub£ssiÚCouÁ
++);

651 
	gsize
 +ğ
addFeH—d”_¡¾
();

653 
	g™”
.
»£t
();

654 (
	gsub£ssiÚ
 = 
™”
.
Ãxt
()è!ğ
NULL
) {

655 
fCu¼’tIOS‹
 = (
AVISub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

656 ià(
	gfCu¼’tIOS‹
 =ğ
NULL
) ;

657 ià(
¡rcmp
(
sub£ssiÚ
->
mediumName
(), "video") == 0) ;

659 
	gfCu¼’tIOS‹
->
£tAVI¡©e
(
sub£ssiÚCouÁ
++);

660 
	gsize
 +ğ
addFeH—d”_¡¾
();

664 ++
	gfJunkNumb”
;

665 
	gsize
 +ğ
addFeH—d”_JUNK
();

666 
	gaddFeH—d”End
;

668 
	#AVIF_HASINDEX
 0x00000010

669 
	#AVIF_MUSTUSEINDEX
 0x00000020

	)

670 
	#AVIF_ISINTERLEAVED
 0x00000100

	)

671 
	#AVIF_TRUSTCKTYPE
 0x00000800

672 
	#AVIF_WASCAPTUREFILE
 0x00010000

	)

673 
	#AVIF_COPYRIGHTED
 0x00020000

	)

675 
addFeH—d”1
(
avih
);

676 
	gu£cP”F¿me
 = 
fMov›FPS
 == 0 ? 0 : 1000000/fMovieFPS;

677 
	gsize
 +ğ
addWÜd
(
u£cP”F¿me
);

678 
	gfAVIHMaxBy‹sP”SecÚdPos™iÚ
 = ()
T–lFe64
(
fOutFid
);

679 
	gsize
 +ğ
addWÜd
(0);

680 
	gsize
 +ğ
addWÜd
(0);

681 
	gsize
 +ğ
addWÜd
(
AVIF_TRUSTCKTYPE
|
AVIF_HASINDEX
|
AVIF_ISINTERLEAVED
);

682 
	gfAVIHF¿meCouÁPos™iÚ
 = ()
T–lFe64
(
fOutFid
);

683 
	gsize
 +ğ
addWÜd
(0);

684 
	gsize
 +ğ
addWÜd
(0);

685 
	gsize
 +ğ
addWÜd
(
fNumSub£ssiÚs
);

686 
	gsize
 +ğ
addWÜd
(
fBufãrSize
);

687 
	gsize
 +ğ
addWÜd
(
fMov›Width
);

688 
	gsize
 +ğ
addWÜd
(
fMov›Height
);

689 
	gsize
 +ğ
addZ”oWÜds
(4);

690 
	gaddFeH—d”End
;

692 
addFeH—d”
(
LIST
,
¡¾
);

693 
	gsize
 +ğ
addFeH—d”_¡rh
();

694 
	gsize
 +ğ
addFeH—d”_¡rf
();

695 
	gfJunkNumb”
 = 0;

696 
	gsize
 +ğ
addFeH—d”_JUNK
();

697 
	gaddFeH—d”End
;

699 
addFeH—d”1
(
¡rh
);

700 
	gsize
 +ğ
add4By‹SŒšg
(
fCu¼’tIOS‹
->
fIsVideo
 ? "vids" :

701 
fCu¼’tIOS‹
->
fIsAudio
 ? "auds" :

703 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVICodecHªdËrTy³
);

704 
	gsize
 +ğ
addWÜd
(0);

705 
	gsize
 +ğ
addWÜd
(0);

706 
	gsize
 +ğ
addWÜd
(0);

707 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVISÿË
);

708 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVIR©e
);

709 
	gsize
 +ğ
addWÜd
(0);

710 
	gfCu¼’tIOS‹
->
	gfSTRHF¿meCouÁPos™iÚ
 = ()
T–lFe64
(
fOutFid
);

711 
	gsize
 +ğ
addWÜd
(0);

712 
	gsize
 +ğ
addWÜd
(
fBufãrSize
);

713 
	gsize
 +ğ
addWÜd
(()-1);

714 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVISize
);

715 
	gsize
 +ğ
addWÜd
(0);

716 ià(
	gfCu¼’tIOS‹
->
	gfIsVideo
) {

717 
	gsize
 +ğ
addH®fWÜd
(
fMov›Width
);

718 
	gsize
 +ğ
addH®fWÜd
(
fMov›Height
);

720 
	gsize
 +ğ
addWÜd
(0);

722 
	gaddFeH—d”End
;

724 
addFeH—d”1
(
¡rf
);

725 ià(
	gfCu¼’tIOS‹
->
	gfIsVideo
) {

727 
	gexŒaD©aSize
 = 0;

728 
	gsize
 +ğ
addWÜd
(10*4 + 
exŒaD©aSize
);

729 
	gsize
 +ğ
addWÜd
(
fMov›Width
);

730 
	gsize
 +ğ
addWÜd
(
fMov›Height
);

731 
	gsize
 +ğ
addH®fWÜd
(1);

732 
	gsize
 +ğ
addH®fWÜd
(24);

733 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVICodecHªdËrTy³
);

734 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVISize
);

735 
	gsize
 +ğ
addZ”oWÜds
(4);

737 } ià(
	gfCu¼’tIOS‹
->
	gfIsAudio
) {

739 
	gsize
 +ğ
addH®fWÜd
(
fCu¼’tIOS‹
->
fWAVCodecTag
);

740 
	gnumChªÃls
 = 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
numChªÃls
();

741 
	gsize
 +ğ
addH®fWÜd
(
numChªÃls
);

742 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVISam¶šgF»qu’cy
);

743 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVIR©e
);

744 
	gsize
 +ğ
addH®fWÜd
(
fCu¼’tIOS‹
->
fAVISize
);

745 
	gb™sP”Sam¶e
 = (
fCu¼’tIOS‹
->
fAVISize
*8)/
numChªÃls
;

746 
	gsize
 +ğ
addH®fWÜd
(
b™sP”Sam¶e
);

747 ià(
¡rcmp
(
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
codecName
(), "MPA") == 0) {

749 
size
 +ğ
addH®fWÜd
(22);

750 
	gsize
 +ğ
addH®fWÜd
(2);

751 
	gsize
 +ğ
addWÜd
(8*
fCu¼’tIOS‹
->
fAVIR©e
);

752 
	gsize
 +ğ
addH®fWÜd
(
numChªÃls
 == 2 ? 1: 8);

753 
	gsize
 +ğ
addH®fWÜd
(0);

754 
	gsize
 +ğ
addH®fWÜd
(1);

755 
	gsize
 +ğ
addH®fWÜd
(16);

756 
	gsize
 +ğ
addWÜd
(0);

757 
	gsize
 +ğ
addWÜd
(0);

760 
	gaddFeH—d”End
;

762 
	#AVI_MASTER_INDEX_SIZE
 256

	)

764 
addFeH—d”1
(
JUNK
);

765 ià(
	gfJunkNumb”
 == 0) {

766 
size
 +ğ
addH®fWÜd
(4);

767 
	gsize
 +ğ
addH®fWÜd
(0);

768 
	gsize
 +ğ
addWÜd
(0);

769 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fAVISub£ssiÚTag
);

770 
	gsize
 +ğ
addZ”oWÜds
(2);

771 
	gsize
 +ğ
addZ”oWÜds
(
AVI_MASTER_INDEX_SIZE
*4);

773 
	gsize
 +ğ
add4By‹SŒšg
("odml");

774 
	gsize
 +ğ
add4By‹SŒšg
("dmlh");

775 
	gwtfCouÁ
 = 248;

776 
	gsize
 +ğ
addWÜd
(
wtfCouÁ
);

777 
	gsize
 +ğ
addZ”oWÜds
(
wtfCouÁ
/4);

779 
	gaddFeH—d”End
;

781 
addFeH—d”
(
LIST
,
movi
);

782 
	gfMoviSizePos™iÚ
 = 
h—d”SizePo¢
;

783 
	gfMoviSizeV®ue
 = 
size
-
ignÜedSize
;

784 
	gaddFeH—d”End
;

	@liveMedia/AudioInputDevice.cpp

20 
	~<AudioIÅutDeviû.hh
>

22 
	gAudioIÅutDeviû


23 ::
	$AudioIÅutDeviû
(
U§geEnvœÚm’t
& 
’v
, 
b™sP”Sam¶e
,

24 
numChªÃls
,

25 
§m¶šgF»qu’cy
, 
g¿nuÏr™yInMS
)

26 : 
	`F¿medSourû
(
’v
), 
	`fB™sP”Sam¶e
(
b™sP”Sam¶e
),

27 
	`fNumChªÃls
(
numChªÃls
), 
	`fSam¶šgF»qu’cy
(
§m¶šgF»qu’cy
),

28 
	$fG¿nuÏr™yInMS
(
g¿nuÏr™yInMS
) {

29 
	}
}

31 
	gAudioIÅutDeviû
::~
	$AudioIÅutDeviû
() {

32 
	}
}

34 ** 
AudioIÅutDeviû
::
®lowedDeviûNames
 = 
NULL
;

38 
	gAudioPÜtNames
::
	$AudioPÜtNames
()

39 : 
	`numPÜts
(0), 
	$pÜtName
(
NULL
) {

40 
	}
}

42 
	gAudioPÜtNames
::~
	$AudioPÜtNames
() {

43 
i
 = 0; i < 
numPÜts
; ++iè
d–‘e
 
pÜtName
[i];

44 
d–‘e
 
pÜtName
;

45 
	}
}

	@liveMedia/AudioRTPSink.cpp

21 
	~"AudioRTPSšk.hh
"

23 
	gAudioRTPSšk
::
	$AudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
,

24 
Groupsock
* 
¹pgs
, 
¹pPaylßdTy³
,

25 
¹pTime¡ampF»qu’cy
,

26 cÚ¡* 
¹pPaylßdFÜm©Name
,

27 
numChªÃls
)

28 : 
	$MuÉiF¿medRTPSšk
(
’v
, 
¹pgs
, 
¹pPaylßdTy³
, 
¹pTime¡ampF»qu’cy
,

29 
¹pPaylßdFÜm©Name
, 
numChªÃls
) {

30 
	}
}

32 
	gAudioRTPSšk
::~
	$AudioRTPSšk
() {

33 
	}
}

35 cÚ¡* 
AudioRTPSšk
::
	$sdpMedŸTy³
() const {

37 
	}
}

	@liveMedia/Base64.cpp

21 
	~"Ba£64.hh
"

22 
	~<¡rDup.hh
>

23 
	~<¡ršg.h
>

25 
	gba£64DecodeTabË
[256];

27 
	$š™Ba£64DecodeTabË
() {

28 
i
;

29 
i
 = 0; i < 256; ++iè
ba£64DecodeTabË
[i] = ()0x80;

32 
i
 = 'A'; i <ğ'Z'; ++iè
ba£64DecodeTabË
[i] = 0 + (i - 'A');

33 
i
 = 'a'; i <ğ'z'; ++iè
ba£64DecodeTabË
[i] = 26 + (i - 'a');

34 
i
 = '0'; i <ğ'9'; ++iè
ba£64DecodeTabË
[i] = 52 + (i - '0');

35 
ba£64DecodeTabË
[()'+'] = 62;

36 
ba£64DecodeTabË
[()'/'] = 63;

37 
ba£64DecodeTabË
[()'='] = 0;

38 
	}
}

40 * 
	$ba£64Decode
(cÚ¡* 
š
, & 
»suÉSize
,

41 
BoŞ—n
 
ŒimT¿šgZ”os
) {

42 ià(
š
 =ğ
NULL
)  NULL;

43  
	`ba£64Decode
(
š
, 
	`¡¾’
(š), 
»suÉSize
, 
ŒimT¿šgZ”os
);

44 
	}
}

46 * 
	$ba£64Decode
(cÚ¡* 
š
, 
šSize
,

47 & 
»suÉSize
,

48 
BoŞ—n
 
ŒimT¿šgZ”os
) {

49 
BoŞ—n
 
haveIn™ŸlizedBa£64DecodeTabË
 = 
F®£
;

50 ià(!
haveIn™ŸlizedBa£64DecodeTabË
) {

51 
	`š™Ba£64DecodeTabË
();

52 
haveIn™ŸlizedBa£64DecodeTabË
 = 
True
;

55 * 
out
 = (*)
	`¡rDupSize
(
š
);

56 
k
 = 0;

57 
·ddšgCouÁ
 = 0;

58 cÚ¡ 
jMax
 = 
šSize
 - 3;

60 
j
 = 0; j < 
jMax
; j += 4) {

61 
šTmp
[4], 
outTmp
[4];

62 
i
 = 0; i < 4; ++i) {

63 
šTmp
[
i
] = 
š
[i+
j
];

64 ià(
šTmp
[
i
] =ğ'='è++
·ddšgCouÁ
;

65 
outTmp
[
i
] = 
ba£64DecodeTabË
[()
šTmp
[i]];

66 ià((
outTmp
[
i
]&0x80) != 0) outTmp[i] = 0;

69 
out
[
k
++] = (
outTmp
[0]<<2) | (outTmp[1]>>4);

70 
out
[
k
++] = (
outTmp
[1]<<4) | (outTmp[2]>>2);

71 
out
[
k
++] = (
outTmp
[2]<<6) | outTmp[3];

74 ià(
ŒimT¿šgZ”os
) {

75 
·ddšgCouÁ
 > 0 && 
k
 > 0 && 
out
[k-1] == '\0') { --k; --paddingCount; }

77 
»suÉSize
 = 
k
;

78 * 
»suÉ
 = 
Ãw
 [
»suÉSize
];

79 
	`memmove
(
»suÉ
, 
out
, 
»suÉSize
);

80 
d–‘e
[] 
out
;

82  
»suÉ
;

83 
	}
}

85 cÚ¡ 
	gba£64Ch¬
[] =

88 * 
	$ba£64Encode
(cÚ¡* 
ÜigSigÃd
, 
ÜigL’gth
) {

89 cÚ¡* 
Üig
 = (cÚ¡*)
ÜigSigÃd
;

90 ià(
Üig
 =ğ
NULL
)  NULL;

92 cÚ¡ 
numOrig24B™V®ues
 = 
ÜigL’gth
/3;

93 
BoŞ—n
 
havePaddšg
 = 
ÜigL’gth
 > 
numOrig24B™V®ues
*3;

94 
BoŞ—n
 
havePaddšg2
 = 
ÜigL’gth
 =ğ
numOrig24B™V®ues
*3 + 2;

95 cÚ¡ 
numResuÉBy‹s
 = 4*(
numOrig24B™V®ues
 + 
havePaddšg
);

96 * 
»suÉ
 = 
Ãw
 [
numResuÉBy‹s
+1];

99 
i
;

100 
i
 = 0; i < 
numOrig24B™V®ues
; ++i) {

101 
»suÉ
[4*
i
+0] = 
ba£64Ch¬
[(
Üig
[3*i]>>2)&0x3F];

102 
»suÉ
[4*
i
+1] = 
ba£64Ch¬
[(((
Üig
[3*i]&0x3)<<4) | (orig[3*i+1]>>4))&0x3F];

103 
»suÉ
[4*
i
+2] = 
ba£64Ch¬
[((
Üig
[3*i+1]<<2) | (orig[3*i+2]>>6))&0x3F];

104 
»suÉ
[4*
i
+3] = 
ba£64Ch¬
[
Üig
[3*i+2]&0x3F];

108 ià(
havePaddšg
) {

109 
»suÉ
[4*
i
+0] = 
ba£64Ch¬
[(
Üig
[3*i]>>2)&0x3F];

110 ià(
havePaddšg2
) {

111 
»suÉ
[4*
i
+1] = 
ba£64Ch¬
[(((
Üig
[3*i]&0x3)<<4) | (orig[3*i+1]>>4))&0x3F];

112 
»suÉ
[4*
i
+2] = 
ba£64Ch¬
[(
Üig
[3*i+1]<<2)&0x3F];

114 
»suÉ
[4*
i
+1] = 
ba£64Ch¬
[((
Üig
[3*i]&0x3)<<4)&0x3F];

115 
»suÉ
[4*
i
+2] = '=';

117 
»suÉ
[4*
i
+3] = '=';

120 
»suÉ
[
numResuÉBy‹s
] = '\0';

121  
»suÉ
;

122 
	}
}

	@liveMedia/BasicUDPSink.cpp

21 
	~"BasicUDPSšk.hh
"

22 
	~<GroupsockH–³r.hh
>

24 
BasicUDPSšk
* 
	gBasicUDPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
gs
,

25 
maxPaylßdSize
) {

26  
Ãw
 
	`BasicUDPSšk
(
’v
, 
gs
, 
maxPaylßdSize
);

27 
	}
}

29 
	gBasicUDPSšk
::
	$BasicUDPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
gs
,

30 
maxPaylßdSize
)

31 : 
	`MedŸSšk
(
’v
),

32 
	`fGS
(
gs
), 
	$fMaxPaylßdSize
(
maxPaylßdSize
) {

33 
fOuutBufãr
 = 
Ãw
 [
fMaxPaylßdSize
];

34 
	}
}

36 
	gBasicUDPSšk
::~
	$BasicUDPSšk
() {

37 
d–‘e
[] 
fOuutBufãr
;

38 
	}
}

40 
BoŞ—n
 
	gBasicUDPSšk
::
	$cÚtšuePÏyšg
() {

42 
	`g‘timeofday
(&
fNextS’dTime
, 
NULL
);

46 
	`cÚtšuePÏyšg1
();

47  
True
;

48 
	}
}

50 
	gBasicUDPSšk
::
	$cÚtšuePÏyšg1
() {

51 ià(
fSourû
 !ğ
NULL
) {

52 
fSourû
->
	`g‘NextF¿me
(
fOuutBufãr
, 
fMaxPaylßdSize
,

53 
aá”G‘tšgF¿me
, 
this
,

54 
ÚSourûClosu»
, 
this
);

56 
	}
}

58 
	gBasicUDPSšk
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

59 
numTrunÿ‹dBy‹s
,

60 
timev®
 ,

61 
du¿tiÚInMiüo£cÚds
) {

62 
BasicUDPSšk
* 
sšk
 = (BasicUDPSšk*)
ş›ÁD©a
;

63 
sšk
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
du¿tiÚInMiüo£cÚds
);

64 
	}
}

66 
	gBasicUDPSšk
::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

67 
du¿tiÚInMiüo£cÚds
) {

68 ià(
numTrunÿ‹dBy‹s
 > 0) {

69 
	`’vœ
() << "BasicUDPSink::afterGettingFrame1(): The input frame data wasoo†arge for our spcified maximum…ayload size ("

70 << 
fMaxPaylßdSize
 << "). "

71 << 
numTrunÿ‹dBy‹s
 << " bytes ofrailing data was dropped!\n";

75 
fGS
->
	`ouut
(
	`’vœ
(), 
fOuutBufãr
, 
äameSize
);

79 
fNextS’dTime
.
tv_u£c
 +ğ
du¿tiÚInMiüo£cÚds
;

80 
fNextS’dTime
.
tv_£c
 +ğfNextS’dTime.
tv_u£c
/1000000;

81 
fNextS’dTime
.
tv_u£c
 %= 1000000;

83 
timev®
 
timeNow
;

84 
	`g‘timeofday
(&
timeNow
, 
NULL
);

85 
£csDiff
 = 
fNextS’dTime
.
tv_£c
 - 
timeNow
.tv_sec;

86 
št64_t
 
uSecÚdsToGo
 = 
£csDiff
*1000000 + (
fNextS’dTime
.
tv_u£c
 - 
timeNow
.tv_usec);

87 ià(
uSecÚdsToGo
 < 0 || 
£csDiff
 < 0) {

88 
uSecÚdsToGo
 = 0;

92 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecÚdsToGo
,

93 (
TaskFunc
*)
£ndNext
, 
this
);

94 
	}
}

97 
	gBasicUDPSšk
::
	$£ndNext
(* 
fœ¡Arg
) {

98 
BasicUDPSšk
* 
sšk
 = (BasicUDPSšk*)
fœ¡Arg
;

99 
sšk
->
	`cÚtšuePÏyšg1
();

100 
	}
}

	@liveMedia/BasicUDPSource.cpp

21 
	~"BasicUDPSourû.hh
"

22 
	~<GroupsockH–³r.hh
>

24 
BasicUDPSourû
* 
	gBasicUDPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

25 
Groupsock
* 
šputGS
) {

26  
Ãw
 
	`BasicUDPSourû
(
’v
, 
šputGS
);

27 
	}
}

29 
	gBasicUDPSourû
::
	$BasicUDPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
šputGS
)

30 : 
	`F¿medSourû
(
’v
), 
	`fIÅutGS
(
šputGS
), 
	$fHaveS¹edR—dšg
(
F®£
) {

32 
	`šü—£ReûiveBufãrTo
(
’v
, 
šputGS
->
	`sock‘Num
(), 50*1024);

38 
	`makeSock‘NÚBlockšg
(
fIÅutGS
->
	`sock‘Num
());

39 
	}
}

41 
	gBasicUDPSourû
::~
	$BasicUDPSourû
(){

42 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fIÅutGS
->
	`sock‘Num
());

43 
	}
}

45 
	gBasicUDPSourû
::
	$doG‘NextF¿me
() {

46 ià(!
fHaveS¹edR—dšg
) {

48 
	`’vœ
().
	`skScheduËr
().
	`tuºOnBackgroundR—dHªdlšg
(
fIÅutGS
->
	`sock‘Num
(),

49 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgPack‘HªdËr
, 
this
);

50 
fHaveS¹edR—dšg
 = 
True
;

52 
	}
}

54 
	gBasicUDPSourû
::
	$doStİG‘tšgF¿mes
() {

55 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fIÅutGS
->
	`sock‘Num
());

56 
fHaveS¹edR—dšg
 = 
F®£
;

57 
	}
}

60 
	gBasicUDPSourû
::
	$šcomšgPack‘HªdËr
(
BasicUDPSourû
* 
sourû
, ){

61 
sourû
->
	`šcomšgPack‘HªdËr1
();

62 
	}
}

64 
	gBasicUDPSourû
::
	$šcomšgPack‘HªdËr1
() {

65 ià(!
	`isCu¼’yAwa™šgD©a
()) ;

68 
sockaddr_š
 
äomAdd»ss
;

69 ià(!
fIÅutGS
->
	`hªdËR—d
(
fTo
, 
fMaxSize
, 
fF¿meSize
, 
äomAdd»ss
)) ;

72 
	`aá”G‘tšg
(
this
);

73 
	}
}

	@liveMedia/BitVector.cpp

21 
	~"B™VeùÜ.hh
"

23 
	gB™VeùÜ
::
	$B™VeùÜ
(* 
ba£By‹PŒ
,

24 
ba£B™Off£t
,

25 
tÙNumB™s
) {

26 
	`£tup
(
ba£By‹PŒ
, 
ba£B™Off£t
, 
tÙNumB™s
);

27 
	}
}

29 
	gB™VeùÜ
::
	$£tup
(* 
ba£By‹PŒ
,

30 
ba£B™Off£t
,

31 
tÙNumB™s
) {

32 
fBa£By‹PŒ
 = 
ba£By‹PŒ
;

33 
fBa£B™Off£t
 = 
ba£B™Off£t
;

34 
fTÙNumB™s
 = 
tÙNumB™s
;

35 
fCurB™Index
 = 0;

36 
	}
}

38 cÚ¡ 
	gsšgËB™Mask
[8]

41 
	#MAX_LENGTH
 32

	)

43 
	gB™VeùÜ
::
	$putB™s
(
äom
, 
numB™s
) {

44 ià(
numB™s
 == 0) ;

46 
tmpBuf
[4];

47 
ov”æowšgB™s
 = 0;

49 ià(
numB™s
 > 
MAX_LENGTH
) {

50 
numB™s
 = 
MAX_LENGTH
;

53 ià(
numB™s
 > 
fTÙNumB™s
 - 
fCurB™Index
) {

54 
ov”æowšgB™s
 = 
numB™s
 - (
fTÙNumB™s
 - 
fCurB™Index
);

57 
tmpBuf
[0] = ()(
äom
>>24);

58 
tmpBuf
[1] = ()(
äom
>>16);

59 
tmpBuf
[2] = ()(
äom
>>8);

60 
tmpBuf
[3] = ()
äom
;

62 
	`shiáB™s
(
fBa£By‹PŒ
, 
fBa£B™Off£t
 + 
fCurB™Index
,

63 
tmpBuf
, 
MAX_LENGTH
 - 
numB™s
,

64 
numB™s
 - 
ov”æowšgB™s
 );

65 
fCurB™Index
 +ğ
numB™s
 - 
ov”æowšgB™s
;

66 
	}
}

68 
	gB™VeùÜ
::
	$put1B™
(
b™
) {

70 ià(
fCurB™Index
 >ğ
fTÙNumB™s
) {

73 
tÙB™Off£t
 = 
fBa£B™Off£t
 + 
fCurB™Index
++;

74 
mask
 = 
sšgËB™Mask
[
tÙB™Off£t
%8];

75 ià(
b™
) {

76 
fBa£By‹PŒ
[
tÙB™Off£t
/8] |ğ
mask
;

78 
fBa£By‹PŒ
[
tÙB™Off£t
/8] &=~ 
mask
;

81 
	}
}

83 
	gB™VeùÜ
::
	$g‘B™s
(
numB™s
) {

84 ià(
numB™s
 == 0)  0;

86 
tmpBuf
[4];

87 
ov”æowšgB™s
 = 0;

89 ià(
numB™s
 > 
MAX_LENGTH
) {

90 
numB™s
 = 
MAX_LENGTH
;

93 ià(
numB™s
 > 
fTÙNumB™s
 - 
fCurB™Index
) {

94 
ov”æowšgB™s
 = 
numB™s
 - (
fTÙNumB™s
 - 
fCurB™Index
);

97 
	`shiáB™s
(
tmpBuf
, 0,

98 
fBa£By‹PŒ
, 
fBa£B™Off£t
 + 
fCurB™Index
,

99 
numB™s
 - 
ov”æowšgB™s
 );

100 
fCurB™Index
 +ğ
numB™s
 - 
ov”æowšgB™s
;

102 
»suÉ


103 ğ(
tmpBuf
[0]<<24) | (tmpBuf[1]<<16) | (tmpBuf[2]<<8) |mpBuf[3];

104 
»suÉ
 >>ğ(
MAX_LENGTH
 - 
numB™s
);

105 
»suÉ
 &ğ(0xFFFFFFFF << 
ov”æowšgB™s
);

106  
»suÉ
;

107 
	}
}

109 
	gB™VeùÜ
::
	$g‘1B™
() {

112 ià(
fCurB™Index
 >ğ
fTÙNumB™s
) {

115 
tÙB™Off£t
 = 
fBa£B™Off£t
 + 
fCurB™Index
++;

116 
curFromBy‹
 = 
fBa£By‹PŒ
[
tÙB™Off£t
/8];

117 
»suÉ
 = (
curFromBy‹
 >> (7-(
tÙB™Off£t
%8))) & 0x01;

118  
»suÉ
;

120 
	}
}

122 
	gB™VeùÜ
::
	$skB™s
(
numB™s
) {

123 ià(
numB™s
 > 
fTÙNumB™s
 - 
fCurB™Index
) {

124 
fCurB™Index
 = 
fTÙNumB™s
;

126 
fCurB™Index
 +ğ
numB™s
;

128 
	}
}

130 
	gB™VeùÜ
::
	$g‘_expGŞomb
() {

131 
numL—dšgZ”oB™s
 = 0;

132 
codeS¹
 = 1;

134 
	`g‘1B™
(è=ğ0 && 
fCurB™Index
 < 
fTÙNumB™s
) {

135 ++
numL—dšgZ”oB™s
;

136 
codeS¹
 *= 2;

139  
codeS¹
 - 1 + 
	`g‘B™s
(
numL—dšgZ”oB™s
);

140 
	}
}

143 
	$shiáB™s
(* 
toBa£PŒ
, 
toB™Off£t
,

144 cÚ¡* 
äomBa£PŒ
, 
äomB™Off£t
,

145 
numB™s
) {

146 ià(
numB™s
 == 0) ;

149 cÚ¡* 
äomBy‹PŒ
 = 
äomBa£PŒ
 + 
äomB™Off£t
/8;

150 
äomB™Rem
 = 
äomB™Off£t
%8;

151 * 
toBy‹PŒ
 = 
toBa£PŒ
 + 
toB™Off£t
/8;

152 
toB™Rem
 = 
toB™Off£t
%8;

154 
numB™s
-- > 0) {

155 
äomB™Mask
 = 
sšgËB™Mask
[
äomB™Rem
];

156 
äomB™
 = (*
äomBy‹PŒ
)&
äomB™Mask
;

157 
toB™Mask
 = 
sšgËB™Mask
[
toB™Rem
];

159 ià(
äomB™
 != 0) {

160 *
toBy‹PŒ
 |ğ
toB™Mask
;

162 *
toBy‹PŒ
 &=~ 
toB™Mask
;

165 ià(++
äomB™Rem
 == 8) {

166 ++
äomBy‹PŒ
;

167 
äomB™Rem
 = 0;

169 ià(++
toB™Rem
 == 8) {

170 ++
toBy‹PŒ
;

171 
toB™Rem
 = 0;

174 
	}
}

	@liveMedia/ByteStreamFileSource.cpp

21 
	~"By‹SŒ—mFeSourû.hh
"

22 
	~"IÅutFe.hh
"

23 
	~"GroupsockH–³r.hh
"

27 
By‹SŒ—mFeSourû
*

28 
	gBy‹SŒ—mFeSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

29 
´eã¼edF¿meSize
,

30 
¶ayTimeP”F¿me
) {

31 
FILE
* 
fid
 = 
	`O³nIÅutFe
(
’v
, 
feName
);

32 ià(
fid
 =ğ
NULL
)  NULL;

34 
By‹SŒ—mFeSourû
* 
ÃwSourû


35 ğ
Ãw
 
	`By‹SŒ—mFeSourû
(
’v
, 
fid
, 
´eã¼edF¿meSize
, 
¶ayTimeP”F¿me
);

36 
ÃwSourû
->
fFeSize
 = 
	`G‘FeSize
(
feName
, 
fid
);

38  
ÃwSourû
;

39 
	}
}

41 
By‹SŒ—mFeSourû
*

42 
	gBy‹SŒ—mFeSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

43 
´eã¼edF¿meSize
,

44 
¶ayTimeP”F¿me
) {

45 ià(
fid
 =ğ
NULL
)  NULL;

47 
By‹SŒ—mFeSourû
* 
ÃwSourû
 = 
Ãw
 
	`By‹SŒ—mFeSourû
(
’v
, 
fid
, 
´eã¼edF¿meSize
, 
¶ayTimeP”F¿me
);

48 
ÃwSourû
->
fFeSize
 = 
	`G‘FeSize
(
NULL
, 
fid
);

50  
ÃwSourû
;

51 
	}
}

53 
	gBy‹SŒ—mFeSourû
::
	$£ekToBy‹AbsŞu‹
(
u_št64_t
 
by‹Numb”
, u_št64_ˆ
numBy‹sToSŒ—m
) {

54 
	`S“kFe64
(
fFid
, (
št64_t
)
by‹Numb”
, 
SEEK_SET
);

56 
fNumBy‹sToSŒ—m
 = 
numBy‹sToSŒ—m
;

57 
fLim™NumBy‹sToSŒ—m
 = 
fNumBy‹sToSŒ—m
 > 0;

58 
	}
}

60 
	gBy‹SŒ—mFeSourû
::
	$£ekToBy‹R–©ive
(
št64_t
 
off£t
, 
u_št64_t
 
numBy‹sToSŒ—m
) {

61 
	`S“kFe64
(
fFid
, 
off£t
, 
SEEK_CUR
);

63 
fNumBy‹sToSŒ—m
 = 
numBy‹sToSŒ—m
;

64 
fLim™NumBy‹sToSŒ—m
 = 
fNumBy‹sToSŒ—m
 > 0;

65 
	}
}

67 
	gBy‹SŒ—mFeSourû
::
	$£ekToEnd
() {

68 
	`S“kFe64
(
fFid
, 0, 
SEEK_END
);

69 
	}
}

71 
	gBy‹SŒ—mFeSourû
::
	$By‹SŒ—mFeSourû
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

72 
´eã¼edF¿meSize
,

73 
¶ayTimeP”F¿me
)

74 : 
	`F¿medFeSourû
(
’v
, 
fid
), 
	`fFeSize
(0), 
	`fP»ã¼edF¿meSize
(
´eã¼edF¿meSize
),

75 
	`fPÏyTimeP”F¿me
(
¶ayTimeP”F¿me
), 
	`fLa¡PÏyTime
(0),

76 
	`fHaveS¹edR—dšg
(
F®£
), 
	`fLim™NumBy‹sToSŒ—m
(F®£), 
	$fNumBy‹sToSŒ—m
(0) {

77 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


78 
	`makeSock‘NÚBlockšg
(
	`f’o
(
fFid
));

82 
fFidIsS“kabË
 = 
	`FeIsS“kabË
(
fFid
);

83 
	}
}

85 
	gBy‹SŒ—mFeSourû
::~
	$By‹SŒ—mFeSourû
() {

86 ià(
fFid
 =ğ
NULL
) ;

88 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


89 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
	`f’o
(
fFid
));

92 
	`Clo£IÅutFe
(
fFid
);

93 
	}
}

95 
	gBy‹SŒ—mFeSourû
::
	$doG‘NextF¿me
() {

96 ià(
	`ãof
(
fFid
è|| 
	`ã¼Ü
(fFidè|| (
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 == 0)) {

97 
	`hªdËClosu»
();

101 #ifdeà
READ_FROM_FILES_SYNCHRONOUSLY


102 
	`doR—dFromFe
();

104 ià(!
fHaveS¹edR—dšg
) {

106 
	`’vœ
().
	`skScheduËr
().
	`tuºOnBackgroundR—dHªdlšg
(
	`f’o
(
fFid
),

107 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
feR—dabËHªdËr
, 
this
);

108 
fHaveS¹edR—dšg
 = 
True
;

111 
	}
}

113 
	gBy‹SŒ—mFeSourû
::
	$doStİG‘tšgF¿mes
() {

114 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

115 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


116 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
	`f’o
(
fFid
));

117 
fHaveS¹edR—dšg
 = 
F®£
;

119 
	}
}

121 
	gBy‹SŒ—mFeSourû
::
	$feR—dabËHªdËr
(
By‹SŒ—mFeSourû
* 
sourû
, ) {

122 ià(!
sourû
->
	`isCu¼’yAwa™šgD©a
()) {

123 
sourû
->
	`doStİG‘tšgF¿mes
();

126 
sourû
->
	`doR—dFromFe
();

127 
	}
}

129 
	gBy‹SŒ—mFeSourû
::
	$doR—dFromFe
() {

131 ià(
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 < (
u_št64_t
)
fMaxSize
) {

132 
fMaxSize
 = ()
fNumBy‹sToSŒ—m
;

134 ià(
fP»ã¼edF¿meSize
 > 0 && fP»ã¼edF¿meSiz< 
fMaxSize
) {

135 
fMaxSize
 = 
fP»ã¼edF¿meSize
;

137 #ifdeà
READ_FROM_FILES_SYNCHRONOUSLY


138 
fF¿meSize
 = 
	`ä—d
(
fTo
, 1, 
fMaxSize
, 
fFid
);

140 ià(
fFidIsS“kabË
) {

141 
fF¿meSize
 = 
	`ä—d
(
fTo
, 1, 
fMaxSize
, 
fFid
);

144 
fF¿meSize
 = 
	`»ad
(
	`f’o
(
fFid
), 
fTo
, 
fMaxSize
);

147 ià(
fF¿meSize
 == 0) {

148 
	`hªdËClosu»
();

151 
fNumBy‹sToSŒ—m
 -ğ
fF¿meSize
;

154 ià(
fPÏyTimeP”F¿me
 > 0 && 
fP»ã¼edF¿meSize
 > 0) {

155 ià(
fP»£Á©iÚTime
.
tv_£c
 =ğ0 && fP»£Á©iÚTime.
tv_u£c
 == 0) {

157 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

160 
uSecÚds
 = 
fP»£Á©iÚTime
.
tv_u£c
 + 
fLa¡PÏyTime
;

161 
fP»£Á©iÚTime
.
tv_£c
 +ğ
uSecÚds
/1000000;

162 
fP»£Á©iÚTime
.
tv_u£c
 = 
uSecÚds
%1000000;

166 
fLa¡PÏyTime
 = (
fPÏyTimeP”F¿me
*
fF¿meSize
)/
fP»ã¼edF¿meSize
;

167 
fDu¿tiÚInMiüo£cÚds
 = 
fLa¡PÏyTime
;

171 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

175 #ifdeà
READ_FROM_FILES_SYNCHRONOUSLY


177 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0,

178 (
TaskFunc
*)
F¿medSourû
::
aá”G‘tšg
, 
this
);

182 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

184 
	}
}

	@liveMedia/ByteStreamMemoryBufferSource.cpp

21 
	~"By‹SŒ—mMemÜyBufãrSourû.hh
"

22 
	~"GroupsockH–³r.hh
"

26 
By‹SŒ—mMemÜyBufãrSourû
*

27 
	gBy‹SŒ—mMemÜyBufãrSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

28 
u_št8_t
* 
bufãr
, 
u_št64_t
 
bufãrSize
,

29 
BoŞ—n
 
d–‘eBufãrOnClo£
,

30 
´eã¼edF¿meSize
,

31 
¶ayTimeP”F¿me
) {

32 ià(
bufãr
 =ğ
NULL
)  NULL;

34  
Ãw
 
	`By‹SŒ—mMemÜyBufãrSourû
(
’v
, 
bufãr
, 
bufãrSize
, 
d–‘eBufãrOnClo£
, 
´eã¼edF¿meSize
, 
¶ayTimeP”F¿me
);

35 
	}
}

37 
	gBy‹SŒ—mMemÜyBufãrSourû
::
	$By‹SŒ—mMemÜyBufãrSourû
(
U§geEnvœÚm’t
& 
’v
,

38 
u_št8_t
* 
bufãr
, 
u_št64_t
 
bufãrSize
,

39 
BoŞ—n
 
d–‘eBufãrOnClo£
,

40 
´eã¼edF¿meSize
,

41 
¶ayTimeP”F¿me
)

42 : 
	`F¿medSourû
(
’v
), 
	`fBufãr
(
bufãr
), 
	`fBufãrSize
(
bufãrSize
), 
	`fCurIndex
(0), 
	`fD–‘eBufãrOnClo£
(
d–‘eBufãrOnClo£
),

43 
	`fP»ã¼edF¿meSize
(
´eã¼edF¿meSize
), 
	`fPÏyTimeP”F¿me
(
¶ayTimeP”F¿me
), 
	`fLa¡PÏyTime
(0),

44 
	`fLim™NumBy‹sToSŒ—m
(
F®£
), 
	$fNumBy‹sToSŒ—m
(0) {

45 
	}
}

47 
	gBy‹SŒ—mMemÜyBufãrSourû
::~
	$By‹SŒ—mMemÜyBufãrSourû
() {

48 ià(
fD–‘eBufãrOnClo£
è
d–‘e
[] 
fBufãr
;

49 
	}
}

51 
	gBy‹SŒ—mMemÜyBufãrSourû
::
	$£ekToBy‹AbsŞu‹
(
u_št64_t
 
by‹Numb”
, u_št64_ˆ
numBy‹sToSŒ—m
) {

52 
fCurIndex
 = 
by‹Numb”
;

53 ià(
fCurIndex
 > 
fBufãrSize
) fCurIndex = fBufferSize;

55 
fNumBy‹sToSŒ—m
 = 
numBy‹sToSŒ—m
;

56 
fLim™NumBy‹sToSŒ—m
 = 
fNumBy‹sToSŒ—m
 > 0;

57 
	}
}

59 
	gBy‹SŒ—mMemÜyBufãrSourû
::
	$£ekToBy‹R–©ive
(
št64_t
 
off£t
, 
u_št64_t
 
numBy‹sToSŒ—m
) {

60 
št64_t
 
ÃwIndex
 = 
fCurIndex
 + 
off£t
;

61 ià(
ÃwIndex
 < 0) {

62 
fCurIndex
 = 0;

64 
fCurIndex
 = (
u_št64_t
)
off£t
;

65 ià(
fCurIndex
 > 
fBufãrSize
) fCurIndex = fBufferSize;

68 
fNumBy‹sToSŒ—m
 = 
numBy‹sToSŒ—m
;

69 
fLim™NumBy‹sToSŒ—m
 = 
fNumBy‹sToSŒ—m
 > 0;

70 
	}
}

72 
	gBy‹SŒ—mMemÜyBufãrSourû
::
	$doG‘NextF¿me
() {

73 ià(
fCurIndex
 >ğ
fBufãrSize
 || (
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 == 0)) {

74 
	`hªdËClosu»
();

79 
fF¿meSize
 = 
fMaxSize
;

80 ià(
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 < (
u_št64_t
)
fF¿meSize
) {

81 
fF¿meSize
 = ()
fNumBy‹sToSŒ—m
;

83 ià(
fP»ã¼edF¿meSize
 > 0 && fP»ã¼edF¿meSiz< 
fF¿meSize
) {

84 
fF¿meSize
 = 
fP»ã¼edF¿meSize
;

87 ià(
fCurIndex
 + 
fF¿meSize
 > 
fBufãrSize
) {

88 
fF¿meSize
 = ()(
fBufãrSize
 - 
fCurIndex
);

91 
	`memmove
(
fTo
, &
fBufãr
[
fCurIndex
], 
fF¿meSize
);

92 
fCurIndex
 +ğ
fF¿meSize
;

93 
fNumBy‹sToSŒ—m
 -ğ
fF¿meSize
;

96 ià(
fPÏyTimeP”F¿me
 > 0 && 
fP»ã¼edF¿meSize
 > 0) {

97 ià(
fP»£Á©iÚTime
.
tv_£c
 =ğ0 && fP»£Á©iÚTime.
tv_u£c
 == 0) {

99 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

102 
uSecÚds
 = 
fP»£Á©iÚTime
.
tv_u£c
 + 
fLa¡PÏyTime
;

103 
fP»£Á©iÚTime
.
tv_£c
 +ğ
uSecÚds
/1000000;

104 
fP»£Á©iÚTime
.
tv_u£c
 = 
uSecÚds
%1000000;

108 
fLa¡PÏyTime
 = (
fPÏyTimeP”F¿me
*
fF¿meSize
)/
fP»ã¼edF¿meSize
;

109 
fDu¿tiÚInMiüo£cÚds
 = 
fLa¡PÏyTime
;

113 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

117 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

118 
	}
}

	@liveMedia/ByteStreamMultiFileSource.cpp

21 
	~"By‹SŒ—mMuÉiFeSourû.hh
"

23 
	gBy‹SŒ—mMuÉiFeSourû


24 ::
	$By‹SŒ—mMuÉiFeSourû
(
U§geEnvœÚm’t
& 
’v
, cÚ¡** 
feNameA¼ay
,

25 
´eã¼edF¿meSize
, 
¶ayTimeP”F¿me
)

26 : 
	`F¿medSourû
(
’v
),

27 
	`fP»ã¼edF¿meSize
(
´eã¼edF¿meSize
), 
	`fPÏyTimeP”F¿me
(
¶ayTimeP”F¿me
),

28 
	`fCu¼’yR—dSourûNumb”
(0), 
	$fHaveS¹edNewFe
(
F®£
) {

30 
fNumSourûs
 = 0; ; ++fNumSources) {

31 ià(
feNameA¼ay
[
fNumSourûs
] =ğ
NULL
) ;

35 
fFeNameA¼ay
 = 
Ãw
 cÚ¡*[
fNumSourûs
];

36 ià(
fFeNameA¼ay
 =ğ
NULL
) ;

37 
i
;

38 
i
 = 0; i < 
fNumSourûs
; ++i) {

39 
fFeNameA¼ay
[
i
] = 
	`¡rDup
(
feNameA¼ay
[i]);

44 
fSourûA¼ay
 = 
Ãw
 
By‹SŒ—mFeSourû
*[
fNumSourûs
];

45 ià(
fSourûA¼ay
 =ğ
NULL
) ;

46 
i
 = 0; i < 
fNumSourûs
; ++i) {

47 
fSourûA¼ay
[
i
] = 
NULL
;

49 
	}
}

51 
	gBy‹SŒ—mMuÉiFeSourû
::~
	$By‹SŒ—mMuÉiFeSourû
() {

52 
i
;

53 
i
 = 0; i < 
fNumSourûs
; ++i) {

54 
Medium
::
	`şo£
(
fSourûA¼ay
[
i
]);

56 
d–‘e
[] 
fSourûA¼ay
;

58 
i
 = 0; i < 
fNumSourûs
; ++i) {

59 
d–‘e
[] (*)(
fFeNameA¼ay
[
i
]);

61 
d–‘e
[] 
fFeNameA¼ay
;

62 
	}
}

64 
By‹SŒ—mMuÉiFeSourû
* 
	gBy‹SŒ—mMuÉiFeSourû


65 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡** 
feNameA¼ay
,

66 
´eã¼edF¿meSize
, 
¶ayTimeP”F¿me
) {

67 
By‹SŒ—mMuÉiFeSourû
* 
ÃwSourû


68 ğ
Ãw
 
	`By‹SŒ—mMuÉiFeSourû
(
’v
, 
feNameA¼ay
,

69 
´eã¼edF¿meSize
, 
¶ayTimeP”F¿me
);

71  
ÃwSourû
;

72 
	}
}

74 
	gBy‹SŒ—mMuÉiFeSourû
::
	$doG‘NextF¿me
() {

77 ià(
fCu¼’yR—dSourûNumb”
 >ğ
fNumSourûs
) ;

79 
fHaveS¹edNewFe
 = 
F®£
;

80 
By‹SŒ—mFeSourû
*& 
sourû


81 ğ
fSourûA¼ay
[
fCu¼’yR—dSourûNumb”
];

82 ià(
sourû
 =ğ
NULL
) {

84 
sourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(),

85 
fFeNameA¼ay
[
fCu¼’yR—dSourûNumb”
],

86 
fP»ã¼edF¿meSize
, 
fPÏyTimeP”F¿me
);

87 ià(
sourû
 =ğ
NULL
) ;

88 
fHaveS¹edNewFe
 = 
True
;

92 
sourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

93 
aá”G‘tšgF¿me
, 
this
,

94 
ÚSourûClosu»
, 
this
);

99 
	`hªdËClosu»
();

100 
	}
}

102 
	gBy‹SŒ—mMuÉiFeSourû


103 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
,

104 
äameSize
, 
numTrunÿ‹dBy‹s
,

105 
timev®
 
´e£Á©iÚTime
,

106 
du¿tiÚInMiüo£cÚds
) {

107 
By‹SŒ—mMuÉiFeSourû
* 
sourû


108 ğ(
By‹SŒ—mMuÉiFeSourû
*)
ş›ÁD©a
;

109 
sourû
->
fF¿meSize
 = 
äameSize
;

110 
sourû
->
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

111 
sourû
->
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

112 
sourû
->
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

113 
F¿medSourû
::
	`aá”G‘tšg
(
sourû
);

114 
	}
}

116 
	gBy‹SŒ—mMuÉiFeSourû
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

117 
By‹SŒ—mMuÉiFeSourû
* 
sourû


118 ğ(
By‹SŒ—mMuÉiFeSourû
*)
ş›ÁD©a
;

119 
sourû
->
	`ÚSourûClosu»1
();

120 
	}
}

122 
	gBy‹SŒ—mMuÉiFeSourû
::
	$ÚSourûClosu»1
() {

126 
By‹SŒ—mFeSourû
*& 
sourû


127 ğ
fSourûA¼ay
[
fCu¼’yR—dSourûNumb”
++];

128 
Medium
::
	`şo£
(
sourû
);

129 
sourû
 = 
NULL
;

132 
	`doG‘NextF¿me
();

133 
	}
}

	@liveMedia/DVVideoFileServerMediaSubsession.cpp

22 
	~"DVVideoFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"DVVideoRTPSšk.hh
"

24 
	~"By‹SŒ—mFeSourû.hh
"

25 
	~"DVVideoSŒ—mF¿m”.hh
"

27 
DVVideoFeS”v”MedŸSub£ssiÚ
*

28 
	gDVVideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
) {

29  
Ãw
 
	`DVVideoFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

30 
	}
}

32 
	gDVVideoFeS”v”MedŸSub£ssiÚ


33 ::
	$DVVideoFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

34 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

35 
	$fFeDu¿tiÚ
(0.0) {

36 
	}
}

38 
	gDVVideoFeS”v”MedŸSub£ssiÚ
::~
	$DVVideoFeS”v”MedŸSub£ssiÚ
() {

39 
	}
}

41 
F¿medSourû
* 
DVVideoFeS”v”MedŸSub£ssiÚ


42 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

44 
By‹SŒ—mFeSourû
* 
feSourû
 = By‹SŒ—mFeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

45 ià(
feSourû
 =ğ
NULL
)  NULL;

46 
fFeSize
 = 
feSourû
->
	`feSize
();

49 
DVVideoSŒ—mF¿m”
* 
äam”
 = DVVideoSŒ—mF¿m”::
	`ü—‹New
(
	`’vœ
(), 
feSourû
, 
True
 );

52 
äameSize
;

53 
äameDu¿tiÚ
;

54 ià(
äam”
->
	`g‘F¿meP¬am‘”s
(
äameSize
, 
äameDu¿tiÚ
)) {

55 
fFeDu¿tiÚ
 = ()(((
št64_t
)
fFeSize
*
äameDu¿tiÚ
)/(
äameSize
*1000000.0));

56 
e¡B™¿‹
 = ()((8000.0*
äameSize
)/
äameDu¿tiÚ
);

58 
e¡B™¿‹
 = 50000;

61  
äam”
;

62 
	}
}

64 
RTPSšk
* 
	gDVVideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

65 
¹pPaylßdTy³IfDyÇmic
,

66 
F¿medSourû
* ) {

67  
DVVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

68 
	}
}

70 cÚ¡* 
	gDVVideoFeS”v”MedŸSub£ssiÚ
::
	$g‘AuxSDPLše
(
RTPSšk
* 
¹pSšk
, 
F¿medSourû
* 
šputSourû
) {

71  ((
DVVideoRTPSšk
*)
¹pSšk
)->
	`auxSDPLšeFromF¿m”
((
DVVideoSŒ—mF¿m”
*)
šputSourû
);

72 
	}
}

74 
	gDVVideoFeS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
() const {

75  
fFeDu¿tiÚ
;

76 
	}
}

78 
	gDVVideoFeS”v”MedŸSub£ssiÚ


79 ::
	$£ekSŒ—mSourû
(
F¿medSourû
* 
šputSourû
, & 
£ekNPT
, 
¡»amDu¿tiÚ
, 
u_št64_t
& 
numBy‹s
) {

81 
DVVideoSŒ—mF¿m”
* 
äam”
 = (DVVideoSŒ—mF¿m”*)
šputSourû
;

82 
By‹SŒ—mFeSourû
* 
feSourû
 = (By‹SŒ—mFeSourû*)(
äam”
->
	`šputSourû
());

85 ià(
fFeDu¿tiÚ
 > 0.0) {

86 
u_št64_t
 
£ekBy‹Numb”
 = (u_št64_t)(((
št64_t
)
fFeSize
*
£ekNPT
)/
fFeDu¿tiÚ
);

87 
numBy‹s
 = (
u_št64_t
)(((
št64_t
)
fFeSize
*
¡»amDu¿tiÚ
)/
fFeDu¿tiÚ
);

88 
feSourû
->
	`£ekToBy‹AbsŞu‹
(
£ekBy‹Numb”
, 
numBy‹s
);

90 
	}
}

92 
	gDVVideoFeS”v”MedŸSub£ssiÚ


93 ::
	$£tSŒ—mSourûDu¿tiÚ
(
F¿medSourû
* 
šputSourû
, 
¡»amDu¿tiÚ
, 
u_št64_t
& 
numBy‹s
) {

95 
DVVideoSŒ—mF¿m”
* 
äam”
 = (DVVideoSŒ—mF¿m”*)
šputSourû
;

96 
By‹SŒ—mFeSourû
* 
feSourû
 = (By‹SŒ—mFeSourû*)(
äam”
->
	`šputSourû
());

99 ià(
fFeDu¿tiÚ
 > 0.0) {

100 
numBy‹s
 = (
u_št64_t
)(((
št64_t
)
fFeSize
*
¡»amDu¿tiÚ
)/
fFeDu¿tiÚ
);

101 
feSourû
->
	`£ekToBy‹R–©ive
(0, 
numBy‹s
);

103 
	}
}

	@liveMedia/DVVideoRTPSink.cpp

22 
	~"DVVideoRTPSšk.hh
"

26 
	gDVVideoRTPSšk


27 ::
	$DVVideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
)

28 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 90000, "DV"),

29 
	$fFmSDPLše
(
NULL
) {

30 
	}
}

32 
	gDVVideoRTPSšk
::~
	$DVVideoRTPSšk
() {

33 
d–‘e
[] 
fFmSDPLše
;

34 
	}
}

36 
DVVideoRTPSšk
*

37 
	gDVVideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
) {

38  
Ãw
 
	`DVVideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

39 
	}
}

41 
BoŞ—n
 
	gDVVideoRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

43  
sourû
.
	`isDVVideoSŒ—mF¿m”
();

44 
	}
}

46 
	gDVVideoRTPSšk
::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

49 
timev®
 
äameP»£Á©iÚTime
,

50 
numRemaššgBy‹s
) {

51 ià(
numRemaššgBy‹s
 == 0) {

54 
	`£tM¬k”B™
();

58 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

59 
	}
}

61 
	gDVVideoRTPSšk
::
	$compu‹Ov”æowFÜNewF¿me
(
ÃwF¿meSize
) const {

62 
š™ŸlOv”æow
 = 
MuÉiF¿medRTPSšk
::
	`compu‹Ov”æowFÜNewF¿me
(
ÃwF¿meSize
);

66 
numF¿meBy‹sU£d
 = 
ÃwF¿meSize
 - 
š™ŸlOv”æow
;

67 
š™ŸlOv”æow
 +ğ
numF¿meBy‹sU£d
%
DV_DIF_BLOCK_SIZE
;

69  
š™ŸlOv”æow
;

70 
	}
}

72 cÚ¡* 
	gDVVideoRTPSšk
::
	$auxSDPLše
() {

76 
DVVideoSŒ—mF¿m”
* 
äam”Sourû
 = (DVVideoSŒ—mF¿m”*)
fSourû
;

77 ià(
äam”Sourû
 =ğ
NULL
)  NULL;

79  
	`auxSDPLšeFromF¿m”
(
äam”Sourû
);

80 
	}
}

82 cÚ¡* 
	gDVVideoRTPSšk
::
	$auxSDPLšeFromF¿m”
(
DVVideoSŒ—mF¿m”
* 
äam”Sourû
) {

83 cÚ¡* cÚ¡ 
´ofeName
 = 
äam”Sourû
->
	`´ofeName
();

84 ià(
´ofeName
 =ğ
NULL
)  NULL;

86 cÚ¡* cÚ¡ 
fmSDPFmt
 = "a=fmtp:%dƒncode=%s;audio=bundled\r\n";

87 
fmSDPFmtSize
 = 
	`¡¾’
(
fmSDPFmt
)

89 + 
	`¡¾’
(
´ofeName
);

90 
d–‘e
[] 
fFmSDPLše
;

91 
fFmSDPLše
 = 
Ãw
 [
fmSDPFmtSize
];

92 
	`¥rštf
(
fFmSDPLše
, 
fmSDPFmt
, 
	`¹pPaylßdTy³
(), 
´ofeName
);

94  
fFmSDPLše
;

95 
	}
}

	@liveMedia/DVVideoRTPSource.cpp

21 
	~"DVVideoRTPSourû.hh
"

23 
DVVideoRTPSourû
*

24 
	gDVVideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

25 
Groupsock
* 
RTPgs
,

26 
¹pPaylßdFÜm©
,

27 
¹pTime¡ampF»qu’cy
) {

28  
Ãw
 
	`DVVideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
);

29 
	}
}

31 
	gDVVideoRTPSourû
::
	$DVVideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

32 
Groupsock
* 
¹pGS
,

33 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
)

35 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
¹pGS
,

36 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

37 
	}
}

39 
	gDVVideoRTPSourû
::~
	$DVVideoRTPSourû
() {

40 
	}
}

42 
	#DV_DIF_BLOCK_SIZE
 80

	)

43 
	#DV_SECTION_HEADER
 0x1F

	)

45 
BoŞ—n
 
DVVideoRTPSourû


46 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

47 & 
»suÉS³cŸlH—d”Size
) {

48 cÚ¡ 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

49 ià(
·ck‘Size
 < 
DV_DIF_BLOCK_SIZE
è 
F®£
;

51 
u_št8_t
 cÚ¡* 
d©a
 = 
·ck‘
->
	`d©a
();

52 
fCu¼’tPack‘BegšsF¿me
 = 
d©a
[0] =ğ
DV_SECTION_HEADER
 && (data[1]&0xf8) == 0 && data[2] == 0;

55 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

58 
»suÉS³cŸlH—d”Size
 = 0;

59  
True
;

60 
	}
}

62 cÚ¡* 
	gDVVideoRTPSourû
::
	$MIMEty³
() const {

64 
	}
}

	@liveMedia/DVVideoStreamFramer.cpp

22 
	~"DVVideoSŒ—mF¿m”.hh
"

23 
	~"GroupsockH–³r.hh
"

27 
	gDVVideoSŒ—mF¿m”
::
	$DVVideoSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

28 
BoŞ—n
 
sourûIsS“kabË
, BoŞ—À
ËaveP»£Á©iÚTimesUnmodif›d
)

29 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

30 
	`fL—veP»£Á©iÚTimesUnmodif›d
(
ËaveP»£Á©iÚTimesUnmodif›d
),

31 
	`fOurProfe
(
NULL
), 
	`fIn™ŸlBlocksP»£Á
(
F®£
), 
	$fSourûIsS“kabË
(
sourûIsS“kabË
) {

32 
fTo
 = 
NULL
;

34 
	`g‘timeofday
(&
fNextF¿meP»£Á©iÚTime
, 
NULL
);

35 
	}
}

37 
	gDVVideoSŒ—mF¿m”
::~
	$DVVideoSŒ—mF¿m”
() {

38 
	}
}

40 
DVVideoSŒ—mF¿m”
*

41 
DVVideoSŒ—mF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

42 
BoŞ—n
 
sourûIsS“kabË
, BoŞ—À
ËaveP»£Á©iÚTimesUnmodif›d
) {

43  
Ãw
 
	`DVVideoSŒ—mF¿m”
(
’v
, 
šputSourû
, 
sourûIsS“kabË
, 
ËaveP»£Á©iÚTimesUnmodif›d
);

44 
	}
}

47 
	sDVVideoProfe
 {

48 cÚ¡* 
	mÇme
;

49 
	m­t
;

50 
	msTy³
;

51 
	m£qu’ûCouÁ
;

52 
	mchªÃlCouÁ
;

53 
	mdvF¿meSize
;

54 
	mäameDu¿tiÚ
;

57 
DVVideoProfe
 cÚ¡ 
	g´ofes
[] = {

68 { 
NULL
, 0, 0, 0, 0, 0, 0.0 }

72 cÚ¡* 
	gDVVideoSŒ—mF¿m”
::
	$´ofeName
() {

73 ià(
fOurProfe
 =ğ
NULL
è
	`g‘Profe
();

75  
fOurProfe
 !ğ
NULL
 ? ((
DVVideoProfe
 cÚ¡*)fOurProfe)->
Çme
 : NULL;

76 
	}
}

78 
BoŞ—n
 
	gDVVideoSŒ—mF¿m”
::
	$g‘F¿meP¬am‘”s
(& 
äameSize
, & 
äameDu¿tiÚ
) {

79 ià(
fOurProfe
 =ğ
NULL
è
	`g‘Profe
();

80 ià(
fOurProfe
 =ğ
NULL
è 
F®£
;

82 
äameSize
 = ((
DVVideoProfe
 cÚ¡*)
fOurProfe
)->
dvF¿meSize
;

83 
äameDu¿tiÚ
 = ((
DVVideoProfe
 cÚ¡*)
fOurProfe
)->frameDuration;

84  
True
;

85 
	}
}

87 
	gDVVideoSŒ—mF¿m”
::
	$g‘Profe
() {

89 
fIÅutSourû
->
	`g‘NextF¿me
(
fSavedIn™ŸlBlocks
, 
DV_SAVED_INITIAL_BLOCKS_SIZE
,

90 
aá”G‘tšgF¿me
, 
this
, 
F¿medSourû
::
hªdËClosu»
,his);

93 
	`’vœ
().
	`skScheduËr
().
	`doEv’tLoİ
(&
fIn™ŸlBlocksP»£Á
);

94 
	}
}

96 
BoŞ—n
 
	gDVVideoSŒ—mF¿m”
::
	$isDVVideoSŒ—mF¿m”
() const {

97  
True
;

98 
	}
}

100 
	gDVVideoSŒ—mF¿m”
::
	$doG‘NextF¿me
() {

101 
fF¿meSize
 = 0;

104 ià(
fIn™ŸlBlocksP»£Á
 && !
fSourûIsS“kabË
) {

106 ià(
fMaxSize
 < 
DV_SAVED_INITIAL_BLOCKS_SIZE
) {

107 
fNumTrunÿ‹dBy‹s
 = 
fMaxSize
;

108 
	`aá”G‘tšg
(
this
);

112 
	`memmove
(
fTo
, 
fSavedIn™ŸlBlocks
, 
DV_SAVED_INITIAL_BLOCKS_SIZE
);

113 
fF¿meSize
 = 
DV_SAVED_INITIAL_BLOCKS_SIZE
;

114 
fTo
 +ğ
DV_SAVED_INITIAL_BLOCKS_SIZE
;

115 
fIn™ŸlBlocksP»£Á
 = 
F®£
;

120 
fMaxSize
 -ğfMaxSize%
DV_DIF_BLOCK_SIZE
;

121 
	`g‘AndD–iv”D©a
();

122 
	}
}

124 
	#DV_SMALLEST_POSSIBLE_FRAME_SIZE
 120000

	)

126 
	gDVVideoSŒ—mF¿m”
::
	$g‘AndD–iv”D©a
() {

127 cÚ¡ 
tÙF¿meSize


128 ğ
fOurProfe
 !ğ
NULL
 ? ((
DVVideoProfe
 cÚ¡*)fOurProfe)->
dvF¿meSize
 : 
DV_SMALLEST_POSSIBLE_FRAME_SIZE
;

129 
tÙBy‹sToD–iv”
 = 
tÙF¿meSize
 < 
fMaxSize
 ?otFrameSize : fMaxSize;

130 
numBy‹sToR—d
 = 
tÙBy‹sToD–iv”
 - 
fF¿meSize
;

132 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
numBy‹sToR—d
, 
aá”G‘tšgF¿me
, 
this
, 
F¿medSourû
::
hªdËClosu»
,his);

133 
	}
}

135 
	gDVVideoSŒ—mF¿m”
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

136 
numTrunÿ‹dBy‹s
,

137 
timev®
 
´e£Á©iÚTime
, ) {

138 
DVVideoSŒ—mF¿m”
* 
sourû
 = (DVVideoSŒ—mF¿m”*)
ş›ÁD©a
;

139 
sourû
->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
);

140 
	}
}

142 
	#DVSeùiÚId
(
n
è
±r
[Ò)*
DV_DIF_BLOCK_SIZE
 + 0]

	)

143 
	#DVD©a
(
n
,
i
è
±r
[Ò)*
DV_DIF_BLOCK_SIZE
 + 3+(i)]

	)

145 
	#DV_SECTION_HEADER
 0x1F

	)

146 
	#DV_PACK_HEADER_10
 0x3F

	)

147 
	#DV_PACK_HEADER_12
 0xBF

	)

148 
	#DV_SECTION_VAUX_MIN
 0x50

	)

149 
	#DV_SECTION_VAUX_MAX
 0x5F

	)

150 
	#DV_PACK_VIDEO_SOURCE
 60

	)

151 #iâdeà
MILLION


152 
	#MILLION
 1000000

	)

155 
	gDVVideoSŒ—mF¿m”
::
	$aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
timev®
 
´e£Á©iÚTime
) {

156 ià(
fOurProfe
 =ğ
NULL
 && 
äameSize
 >ğ
DV_SAVED_INITIAL_BLOCKS_SIZE
) {

160 
u_št8_t
 cÚ¡* 
d©a
 = (
fTo
 =ğ
NULL
è? 
fSavedIn™ŸlBlocks
 : fTo;

161 
u_št8_t
 cÚ¡* 
±r
 = 
d©a
;…Œ + 6*
DV_DIF_BLOCK_SIZE
 <ğ&d©a[
DV_SAVED_INITIAL_BLOCKS_SIZE
];…tr += DV_DIF_BLOCK_SIZE) {

163 
u_št8_t
 cÚ¡ 
£ùiÚH—d”
 = 
	`DVSeùiÚId
(0);

164 
u_št8_t
 cÚ¡ 
£ùiÚVAUX
 = 
	`DVSeùiÚId
(5);

165 
u_št8_t
 cÚ¡ 
·ckH—d”Num
 = 
	`DVD©a
(0,0);

167 ià(
£ùiÚH—d”
 =ğ
DV_SECTION_HEADER


168 && (
·ckH—d”Num
 =ğ
DV_PACK_HEADER_10
 ||…ackH—d”Num =ğ
DV_PACK_HEADER_12
)

169 && (
£ùiÚVAUX
 >ğ
DV_SECTION_VAUX_MIN
 && seùiÚVAUX <ğ
DV_SECTION_VAUX_MAX
)) {

171 
u_št8_t
 cÚ¡ 
­t
 = 
	`DVD©a
(0,1)&0x07;

172 
u_št8_t
 cÚ¡ 
sTy³
 = 
	`DVD©a
(5,48)&0x1F;

173 
u_št8_t
 cÚ¡ 
£qu’ûCouÁ
 = (
·ckH—d”Num
 =ğ
DV_PACK_HEADER_10
) ? 10 : 12;

176 
DVVideoProfe
 cÚ¡* 
´ofe
 = 
´ofes
;…rofe->
Çme
 !ğ
NULL
; ++profile) {

177 ià(
´ofe
->
­t
 =ğ­ˆ&&…rofe->
sTy³
 =ğsTy³ &&…rofe->
£qu’ûCouÁ
 == sequenceCount) {

178 
fOurProfe
 = 
´ofe
;

187 ià(
fTo
 !ğ
NULL
) {

188 cÚ¡ 
tÙF¿meSize


189 ğ
fOurProfe
 !ğ
NULL
 ? ((
DVVideoProfe
 cÚ¡*)fOurProfe)->
dvF¿meSize
 : 
DV_SMALLEST_POSSIBLE_FRAME_SIZE
;

190 
fF¿meSize
 +ğ
äameSize
;

191 
fTo
 +ğ
äameSize
;

192 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

194 ià(
fF¿meSize
 < 
tÙF¿meSize
 && fF¿meSiz< 
fMaxSize
 && 
numTrunÿ‹dBy‹s
 == 0) {

196 
	`g‘AndD–iv”D©a
();

199 
fNumTrunÿ‹dBy‹s
 = 
tÙF¿meSize
 - 
fF¿meSize
;

201 ià(
fOurProfe
 !ğ
NULL
) {

204 ià(!
fL—veP»£Á©iÚTimesUnmodif›d
è
fP»£Á©iÚTime
 = 
fNextF¿meP»£Á©iÚTime
;

206 
DVVideoProfe
 cÚ¡* 
ourProfe
 =(DVVideoProfcÚ¡*)
fOurProfe
;

207 
du¿tiÚInMiüo£cÚds
 = (
fF¿meSize
*
ourProfe
->
äameDu¿tiÚ
)/ourProfe->
dvF¿meSize
;

208 
fDu¿tiÚInMiüo£cÚds
 = ()
du¿tiÚInMiüo£cÚds
;

209 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 +ğ
fDu¿tiÚInMiüo£cÚds
;

210 
fNextF¿meP»£Á©iÚTime
.
tv_£c
 +ğfNextF¿meP»£Á©iÚTime.
tv_u£c
/
MILLION
;

211 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 %ğ
MILLION
;

214 
	`aá”G‘tšg
(
this
);

218 
fIn™ŸlBlocksP»£Á
 = 
True
;

220 
	}
}

	@liveMedia/DeviceSource.cpp

24 
	~"DeviûSourû.hh
"

25 
	~<GroupsockH–³r.hh
>

27 
DeviûSourû
*

28 
	gDeviûSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

29 
DeviûP¬am‘”s
 
·¿ms
) {

30  
Ãw
 
	`DeviûSourû
(
’v
, 
·¿ms
);

31 
	}
}

33 
Ev’tTrigg”Id
 
	gDeviûSourû
::
ev’tTrigg”Id
 = 0;

35 
	gDeviûSourû
::
»ã»nûCouÁ
 = 0;

37 
	gDeviûSourû
::
	$DeviûSourû
(
U§geEnvœÚm’t
& 
’v
,

38 
DeviûP¬am‘”s
 
·¿ms
)

39 : 
	`F¿medSourû
(
’v
), 
	$fP¬ams
(
·¿ms
) {

40 ià(
»ã»nûCouÁ
 == 0) {

44 ++
»ã»nûCouÁ
;

58 ià(
ev’tTrigg”Id
 == 0) {

59 
ev’tTrigg”Id
 = 
	`’vœ
().
	`skScheduËr
().
	`ü—‹Ev’tTrigg”
(
d–iv”F¿me0
);

61 
	}
}

63 
	gDeviûSourû
::~
	$DeviûSourû
() {

67 --
»ã»nûCouÁ
;

68 ià(
»ã»nûCouÁ
 == 0) {

73 
	`’vœ
().
	`skScheduËr
().
	`d–‘eEv’tTrigg”
(
ev’tTrigg”Id
);

74 
ev’tTrigg”Id
 = 0;

76 
	}
}

78 
	gDeviûSourû
::
	$doG‘NextF¿me
() {

83 
	`hªdËClosu»
();

89 
	`d–iv”F¿me
();

94 
	}
}

96 
	gDeviûSourû
::
	$d–iv”F¿me0
(* 
ş›ÁD©a
) {

97 ((
DeviûSourû
*)
ş›ÁD©a
)->
	`d–iv”F¿me
();

98 
	}
}

100 
	gDeviûSourû
::
	$d–iv”F¿me
() {

123 ià(!
	`isCu¼’yAwa™šgD©a
()) ;

125 
u_št8_t
* 
ÃwF¿meD©aS¹
 = (u_int8_t*)0xDEADBEEF;

126 
ÃwF¿meSize
 = 0;

129 ià(
ÃwF¿meSize
 > 
fMaxSize
) {

130 
fF¿meSize
 = 
fMaxSize
;

131 
fNumTrunÿ‹dBy‹s
 = 
ÃwF¿meSize
 - 
fMaxSize
;

133 
fF¿meSize
 = 
ÃwF¿meSize
;

135 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

137 
	`memmove
(
fTo
, 
ÃwF¿meD©aS¹
, 
fF¿meSize
);

140 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

141 
	}
}

149 
	$sigÇlNewF¿meD©a
() {

150 
TaskScheduËr
* 
ourScheduËr
 = 
NULL
;

151 
DeviûSourû
* 
ourDeviû
 = 
NULL
;

153 ià(
ourScheduËr
 !ğ
NULL
) {

154 
ourScheduËr
->
	`Œigg”Ev’t
(
DeviûSourû
::
ev’tTrigg”Id
, 
ourDeviû
);

156 
	}
}

	@liveMedia/DigestAuthentication.cpp

21 
	~"Dige¡Auth’tiÿtiÚ.hh
"

22 
	~"ourMD5.hh
"

23 
	~<¡rDup.hh
>

24 
	~<GroupsockH–³r.hh
>

25 
	~<¡dio.h
>

26 
	~<¡dlib.h
>

27 
	~<¡ršg.h
>

29 
	gAuth’tiÿtÜ
::
	$Auth’tiÿtÜ
() {

30 
	`assign
(
NULL
, NULL, NULL, NULL, 
F®£
);

31 
	}
}

33 
	gAuth’tiÿtÜ
::
	$Auth’tiÿtÜ
(cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
, 
BoŞ—n
 
·sswÜdIsMD5
) {

34 
	`assign
(
NULL
, NULL, 
u£ºame
, 
·sswÜd
, 
·sswÜdIsMD5
);

35 
	}
}

37 
	gAuth’tiÿtÜ
::
	$Auth’tiÿtÜ
(cÚ¡ 
Auth’tiÿtÜ
& 
Üig
) {

38 
	`assign
(
Üig
.
	`»®m
(), orig.
	`nÚû
(), orig.
	`u£ºame
(), orig.
	`·sswÜd
(), orig.
fPasswÜdIsMD5
);

39 
	}
}

41 
	gAuth’tiÿtÜ
& Auth’tiÿtÜ::
İ”©Ü
=(cÚ¡ 
Auth’tiÿtÜ
& 
rightSide
) {

42 ià(&
rightSide
 !ğ
this
) {

43 
»£t
();

44 
assign
(
rightSide
.
»®m
(),„ightSide.
nÚû
(),

45 
rightSide
.
u£ºame
(),„ightSide.
·sswÜd
(),„ightSide.
fPasswÜdIsMD5
);

48  *
	gthis
;

51 
BoŞ—n
 
	gAuth’tiÿtÜ
::
İ”©Ü
<(cÚ¡ 
Auth’tiÿtÜ
* 
rightSide
) {

53 ià(
rightSide
 !ğ
NULL
 &&„ightSid!ğ
this
 &&

54 (
rightSide
->
»®m
(è!ğ
NULL
 ||„ightSide->
nÚû
() != NULL ||

55 
u£ºame
(è=ğ
NULL
 || 
·sswÜd
() == NULL ||

56 
¡rcmp
(
rightSide
->
u£ºame
(), username()) != 0 ||

57 
¡rcmp
(
rightSide
->
·sswÜd
(),…assword()) != 0)) {

58  
True
;

61  
	gF®£
;

64 
	gAuth’tiÿtÜ
::~
	$Auth’tiÿtÜ
() {

65 
	`»£t
();

66 
	}
}

68 
	gAuth’tiÿtÜ
::
	$»£t
() {

69 
	`»£tR—lmAndNÚû
();

70 
	`»£tU£ºameAndPasswÜd
();

71 
	}
}

73 
	gAuth’tiÿtÜ
::
	$£tR—lmAndNÚû
(cÚ¡* 
»®m
, cÚ¡* 
nÚû
) {

74 
	`»£tR—lmAndNÚû
();

75 
	`assignR—lmAndNÚû
(
»®m
, 
nÚû
);

76 
	}
}

78 
	gAuth’tiÿtÜ
::
	$£tR—lmAndRªdomNÚû
(cÚ¡* 
»®m
) {

79 
	`»£tR—lmAndNÚû
();

83 
timev®
 
time¡amp
;

84 
couÁ”
;

85 } 
£edD©a
;

86 
	`g‘timeofday
(&
£edD©a
.
time¡amp
, 
NULL
);

87 
couÁ”
 = 0;

88 
£edD©a
.
couÁ”
 = ++counter;

91 
nÚûBuf
[33];

92 
	`our_MD5D©a
((*)(&
£edD©a
),  s“dD©a, 
nÚûBuf
);

94 
	`assignR—lmAndNÚû
(
»®m
, 
nÚûBuf
);

95 
	}
}

97 
	gAuth’tiÿtÜ
::
	$£tU£ºameAndPasswÜd
(cÚ¡* 
u£ºame
,

98 cÚ¡* 
·sswÜd
,

99 
BoŞ—n
 
·sswÜdIsMD5
) {

100 
	`»£tU£ºameAndPasswÜd
();

101 
	`assignU£ºameAndPasswÜd
(
u£ºame
, 
·sswÜd
, 
·sswÜdIsMD5
);

102 
	}
}

104 cÚ¡* 
	gAuth’tiÿtÜ
::
	$compu‹Dige¡Re¥Ú£
(cÚ¡* 
cmd
,

105 cÚ¡* 
u¾
) const {

110 
ha1Buf
[33];

111 ià(
fPasswÜdIsMD5
) {

112 
	`¡ºıy
(
ha1Buf
, 
	`·sswÜd
(), 32);

113 
ha1Buf
[32] = '\0';

115 cÚ¡ 
ha1D©aL’
 = 
	`¡¾’
(
	`u£ºame
()) + 1

116 + 
	`¡¾’
(
	`»®m
()è+ 1 + sŒËn(
	`·sswÜd
());

117 * 
ha1D©a
 = 
Ãw
 [
ha1D©aL’
+1];

118 
	`¥rštf
((*)
ha1D©a
, "%s:%s:%s", 
	`u£ºame
(), 
	`»®m
(), 
	`·sswÜd
());

119 
	`our_MD5D©a
(
ha1D©a
, 
ha1D©aL’
, 
ha1Buf
);

120 
d–‘e
[] 
ha1D©a
;

123 cÚ¡ 
ha2D©aL’
 = 
	`¡¾’
(
cmd
è+ 1 + sŒËn(
u¾
);

124 * 
ha2D©a
 = 
Ãw
 [
ha2D©aL’
+1];

125 
	`¥rštf
((*)
ha2D©a
, "%s:%s", 
cmd
, 
u¾
);

126 
ha2Buf
[33];

127 
	`our_MD5D©a
(
ha2D©a
, 
ha2D©aL’
, 
ha2Buf
);

128 
d–‘e
[] 
ha2D©a
;

130 cÚ¡ 
dige¡D©aL’


131 ğ32 + 1 + 
	`¡¾’
(
	`nÚû
()) + 1 + 32;

132 * 
dige¡D©a
 = 
Ãw
 [
dige¡D©aL’
+1];

133 
	`¥rštf
((*)
dige¡D©a
, "%s:%s:%s",

134 
ha1Buf
, 
	`nÚû
(), 
ha2Buf
);

135 cÚ¡* 
»suÉ
 = 
	`our_MD5D©a
(
dige¡D©a
, 
dige¡D©aL’
, 
NULL
);

136 
d–‘e
[] 
dige¡D©a
;

137  
»suÉ
;

138 
	}
}

140 
	gAuth’tiÿtÜ
::
	$»şaimDige¡Re¥Ú£
(cÚ¡* 
»¥Ú£SŒ
) const {

141 
d–‘e
[](*)
»¥Ú£SŒ
;

142 
	}
}

144 
	gAuth’tiÿtÜ
::
	$»£tR—lmAndNÚû
() {

145 
d–‘e
[] 
fR—lm
; fR—lm = 
NULL
;

146 
d–‘e
[] 
fNÚû
; fNÚû = 
NULL
;

147 
	}
}

149 
	gAuth’tiÿtÜ
::
	$»£tU£ºameAndPasswÜd
() {

150 
d–‘e
[] 
fU£ºame
; fU£ºamğ
NULL
;

151 
d–‘e
[] 
fPasswÜd
; fPasswÜd = 
NULL
;

152 
fPasswÜdIsMD5
 = 
F®£
;

153 
	}
}

155 
	gAuth’tiÿtÜ
::
	$assignR—lmAndNÚû
(cÚ¡* 
»®m
, cÚ¡* 
nÚû
) {

156 
fR—lm
 = 
	`¡rDup
(
»®m
);

157 
fNÚû
 = 
	`¡rDup
(
nÚû
);

158 
	}
}

160 
	gAuth’tiÿtÜ
::
	$assignU£ºameAndPasswÜd
(cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
, 
BoŞ—n
 
·sswÜdIsMD5
) {

161 ià(
u£ºame
 =ğ
NULL
) username = "";

162 ià(
·sswÜd
 =ğ
NULL
)…assword = "";

164 
fU£ºame
 = 
	`¡rDup
(
u£ºame
);

165 
fPasswÜd
 = 
	`¡rDup
(
·sswÜd
);

166 
fPasswÜdIsMD5
 = 
·sswÜdIsMD5
;

167 
	}
}

169 
	gAuth’tiÿtÜ
::
	$assign
(cÚ¡* 
»®m
, cÚ¡* 
nÚû
,

170 cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
, 
BoŞ—n
 
·sswÜdIsMD5
) {

171 
	`assignR—lmAndNÚû
(
»®m
, 
nÚû
);

172 
	`assignU£ºameAndPasswÜd
(
u£ºame
, 
·sswÜd
, 
·sswÜdIsMD5
);

173 
	}
}

	@liveMedia/EBMLNumber.cpp

21 
	~"EBMLNumb”.hh
"

23 
	gEBMLNumb”
::
	$EBMLNumb”
(
BoŞ—n
 
¡rL—dšg1
)

24 : 
	`¡rL—dšg1
(
¡rL—dšg1
), 
	$Ën
(0) {

25 
	}
}

27 
	gEBMLNumb”
::~
	$EBMLNumb”
() {

28 
	}
}

30 * 
EBMLNumb”
::
	$hexSŒšg
() const {

31 
´štBuf
[2*
EBML_NUMBER_MAX_LEN
 + 1];

33 * 
to
 = 
´štBuf
;

34 
i
 = 0; i < 
Ën
; ++i) {

35 
	`¥rštf
(
to
, "%02X", 
d©a
[
i
]);

36 
to
 += 2;

39  
´štBuf
;

40 
	}
}

42 
u_št64_t
 
	gEBMLNumb”
::
	$v®
() const {

43 
u_št64_t
 
»suÉ
 = 0;

45 
i
 = 0; i < 
Ën
; ++i) {

46 
»suÉ
 =„esuÉ*256 + 
d©a
[
i
];

49  
»suÉ
;

50 
	}
}

52 
	gEBMLId
::
	$EBMLId
()

53 : 
	$EBMLNumb”
(
F®£
) {

54 
	}
}

56 
EBMLId
::~
	$EBMLId
() {

57 
	}
}

59 cÚ¡* 
EBMLId
::
	$¡ršgName
() const {

60 
	`v®
()) {

61 
MATROSKA_ID_EBML
: {  "EBML"; }

62 
MATROSKA_ID_VOID
: {  "Void"; }

63 
MATROSKA_ID_CRC_32
: {  "CRC-32"; }

64 
MATROSKA_ID_SEGMENT
: {  "Segment"; }

65 
MATROSKA_ID_SEEK_HEAD
: {  "Seek Head"; }

66 
MATROSKA_ID_SEEK
: {  "Seek"; }

67 
MATROSKA_ID_SEEK_ID
: {  "Seek ID"; }

68 
MATROSKA_ID_SEEK_POSITION
: {  "Seek Position"; }

69 
MATROSKA_ID_INFO
: {  "Segment Info"; }

70 
MATROSKA_ID_SEGMENT_UID
: {  "Segment UID"; }

71 
MATROSKA_ID_DURATION
: {  "Segment Duration"; }

72 
MATROSKA_ID_TIMECODE_SCALE
: {  "Timecode Scale"; }

73 
MATROSKA_ID_DATE_UTC
: {  "Date (UTC)"; }

74 
MATROSKA_ID_TITLE
: {  "Title"; }

75 
MATROSKA_ID_MUXING_APP
: {  "Muxing App"; }

76 
MATROSKA_ID_WRITING_APP
: {  "Writing App"; }

77 
MATROSKA_ID_CLUSTER
: {  "Cluster"; }

78 
MATROSKA_ID_TIMECODE
: {  "TimeCode"; }

79 
MATROSKA_ID_POSITION
: {  "Position"; }

80 
MATROSKA_ID_PREV_SIZE
: {  "Prev. Size"; }

81 
MATROSKA_ID_SIMPLEBLOCK
: {  "SimpleBlock"; }

82 
MATROSKA_ID_BLOCK_GROUP
: {  "Block Group"; }

83 
MATROSKA_ID_BLOCK
: {  "Block"; }

84 
MATROSKA_ID_BLOCK_DURATION
: {  "Block Duration"; }

85 
MATROSKA_ID_REFERENCE_BLOCK
: {  "Reference Block"; }

86 
MATROSKA_ID_TRACKS
: {  "Tracks"; }

87 
MATROSKA_ID_TRACK_ENTRY
: {  "Track Entry"; }

88 
MATROSKA_ID_TRACK_NUMBER
: {  "Track Number"; }

89 
MATROSKA_ID_TRACK_UID
: {  "Track UID"; }

90 
MATROSKA_ID_TRACK_TYPE
: {  "Track Type"; }

91 
MATROSKA_ID_FLAG_ENABLED
: {  "Flag Enabled"; }

92 
MATROSKA_ID_FLAG_DEFAULT
: {  "Flag Default"; }

93 
MATROSKA_ID_FLAG_FORCED
: {  "Flag Forced"; }

94 
MATROSKA_ID_FLAG_LACING
: {  "Flag Lacing"; }

95 
MATROSKA_ID_MIN_CACHE
: {  "Min Cache"; }

96 
MATROSKA_ID_DEFAULT_DURATION
: {  "Default Duration"; }

97 
MATROSKA_ID_TRACK_TIMECODE_SCALE
: {  "Track Timecode Scale"; }

98 
MATROSKA_ID_MAX_BLOCK_ADDITION_ID
: {  "Max Block Addition ID"; }

99 
MATROSKA_ID_NAME
: {  "Name"; }

100 
MATROSKA_ID_LANGUAGE
: {  "Language"; }

101 
MATROSKA_ID_CODEC
: {  "Codec ID"; }

102 
MATROSKA_ID_CODEC_PRIVATE
: {  "Codec Private"; }

103 
MATROSKA_ID_CODEC_NAME
: {  "Codec Name"; }

104 
MATROSKA_ID_CODEC_DECODE_ALL
: {  "Codec Decode All"; }

105 
MATROSKA_ID_VIDEO
: {  "Video Settings"; }

106 
MATROSKA_ID_FLAG_INTERLACED
: {  "Flag Interlaced"; }

107 
MATROSKA_ID_PIXEL_WIDTH
: {  "Pixel Width"; }

108 
MATROSKA_ID_PIXEL_HEIGHT
: {  "Pixel Height"; }

109 
MATROSKA_ID_DISPLAY_WIDTH
: {  "Display Width"; }

110 
MATROSKA_ID_DISPLAY_HEIGHT
: {  "Display Height"; }

111 
MATROSKA_ID_DISPLAY_UNIT
: {  "Display Unit"; }

112 
MATROSKA_ID_AUDIO
: {  "Audio Settings"; }

113 
MATROSKA_ID_SAMPLING_FREQUENCY
: {  "Sampling Frequency"; }

114 
MATROSKA_ID_OUTPUT_SAMPLING_FREQUENCY
: {  "Output Sampling Frequency"; }

115 
MATROSKA_ID_CHANNELS
: {  "Channels"; }

116 
MATROSKA_ID_BIT_DEPTH
: {  "Bit Depth"; }

117 
MATROSKA_ID_CONTENT_ENCODINGS
: {  "Content Encodings"; }

118 
MATROSKA_ID_CONTENT_ENCODING
: {  "Content Encoding"; }

119 
MATROSKA_ID_CONTENT_COMPRESSION
: {  "Content Compression"; }

120 
MATROSKA_ID_CONTENT_COMP_ALGO
: {  "Content Compression Algorithm"; }

121 
MATROSKA_ID_CONTENT_COMP_SETTINGS
: {  "Content Compression Settings"; }

122 
MATROSKA_ID_CONTENT_ENCRYPTION
: {  "Content Encryption"; }

123 
MATROSKA_ID_ATTACHMENTS
: {  "Attachments"; }

124 
MATROSKA_ID_ATTACHED_FILE
: {  "Attached File"; }

125 
MATROSKA_ID_FILE_DESCRIPTION
: {  "File Description"; }

126 
MATROSKA_ID_FILE_NAME
: {  "File Name"; }

127 
MATROSKA_ID_FILE_MIME_TYPE
: {  "File MIME Type"; }

128 
MATROSKA_ID_FILE_DATA
: {  "File Data"; }

129 
MATROSKA_ID_FILE_UID
: {  "File UID"; }

130 
MATROSKA_ID_CUES
: {  "Cues"; }

131 
MATROSKA_ID_CUE_POINT
: {  "Cue Point"; }

132 
MATROSKA_ID_CUE_TIME
: {  "Cue Time"; }

133 
MATROSKA_ID_CUE_TRACK_POSITIONS
: {  "Cue Track Positions"; }

134 
MATROSKA_ID_CUE_TRACK
: {  "Cue Track"; }

135 
MATROSKA_ID_CUE_CLUSTER_POSITION
: {  "Cue Cluster Position"; }

136 
MATROSKA_ID_CUE_BLOCK_NUMBER
: {  "Cue Block Number"; }

137 
MATROSKA_ID_TAGS
: {  "Tags"; }

138 
MATROSKA_ID_SEEK_PRE_ROLL
: {  "SeekPreRoll"; }

139 
MATROSKA_ID_CODEC_DELAY
: {  "CodecDelay"; }

140 
MATROSKA_ID_DISCARD_PADDING
: {  "DiscardPadding"; }

143 
	}
}

145 
	gEBMLD©aSize
::
	$EBMLD©aSize
()

146 : 
	$EBMLNumb”
(
True
) {

147 
	}
}

149 
EBMLD©aSize
::~
	$EBMLD©aSize
() {

150 
	}
}

	@liveMedia/FileServerMediaSubsession.cpp

22 
	~"FeS”v”MedŸSub£ssiÚ.hh
"

24 
	gFeS”v”MedŸSub£ssiÚ


25 ::
	$FeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

26 
BoŞ—n
 
»u£Fœ¡Sourû
)

27 : 
	`OnDemªdS”v”MedŸSub£ssiÚ
(
’v
, 
»u£Fœ¡Sourû
),

28 
	$fFeSize
(0) {

29 
fFeName
 = 
	`¡rDup
(
feName
);

30 
	}
}

32 
	gFeS”v”MedŸSub£ssiÚ
::~
	$FeS”v”MedŸSub£ssiÚ
() {

33 
d–‘e
[] (*)
fFeName
;

34 
	}
}

	@liveMedia/FileSink.cpp

21 #ià(
defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

22 
	~<io.h
>

23 
	~<fú.h
>

25 
	~"FeSšk.hh
"

26 
	~"GroupsockH–³r.hh
"

27 
	~"OuutFe.hh
"

31 
	gFeSšk
::
	$FeSšk
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
, 
bufãrSize
,

32 cÚ¡* 
³rF¿meFeNameP»fix
)

33 : 
	`MedŸSšk
(
’v
), 
	`fOutFid
(
fid
), 
	`fBufãrSize
(
bufãrSize
), 
	$fSameP»£Á©iÚTimeCouÁ”
(0) {

34 
fBufãr
 = 
Ãw
 [
bufãrSize
];

35 ià(
³rF¿meFeNameP»fix
 !ğ
NULL
) {

36 
fP”F¿meFeNameP»fix
 = 
	`¡rDup
(
³rF¿meFeNameP»fix
);

37 
fP”F¿meFeNameBufãr
 = 
Ãw
 [
	`¡¾’
(
³rF¿meFeNameP»fix
) + 100];

39 
fP”F¿meFeNameP»fix
 = 
NULL
;

40 
fP”F¿meFeNameBufãr
 = 
NULL
;

42 
fP»vP»£Á©iÚTime
.
tv_£c
 = ~0; fP»vP»£Á©iÚTime.
tv_u£c
 = 0;

43 
	}
}

45 
	gFeSšk
::~
	$FeSšk
() {

46 
d–‘e
[] 
fP”F¿meFeNameBufãr
;

47 
d–‘e
[] 
fP”F¿meFeNameP»fix
;

48 
d–‘e
[] 
fBufãr
;

49 ià(
fOutFid
 !ğ
NULL
è
	`fşo£
(fOutFid);

50 
	}
}

52 
FeSšk
* 
	gFeSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

53 
bufãrSize
, 
BoŞ—n
 
ÚeFeP”F¿me
) {

55 
FILE
* 
fid
;

56 cÚ¡* 
³rF¿meFeNameP»fix
;

57 ià(
ÚeFeP”F¿me
) {

59 
fid
 = 
NULL
;

60 
³rF¿meFeNameP»fix
 = 
feName
;

63 
fid
 = 
	`O³nOuutFe
(
’v
, 
feName
);

64 ià(
fid
 =ğ
NULL
) ;

65 
³rF¿meFeNameP»fix
 = 
NULL
;

68  
Ãw
 
	`FeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
);

71  
NULL
;

72 
	}
}

74 
BoŞ—n
 
	gFeSšk
::
	$cÚtšuePÏyšg
() {

75 ià(
fSourû
 =ğ
NULL
è 
F®£
;

77 
fSourû
->
	`g‘NextF¿me
(
fBufãr
, 
fBufãrSize
,

78 
aá”G‘tšgF¿me
, 
this
,

79 
ÚSourûClosu»
, 
this
);

81  
True
;

82 
	}
}

84 
	gFeSšk
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

85 
numTrunÿ‹dBy‹s
,

86 
timev®
 
´e£Á©iÚTime
,

88 
FeSšk
* 
sšk
 = (FeSšk*)
ş›ÁD©a
;

89 
sšk
->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
);

90 
	}
}

92 
	gFeSšk
::
	$addD©a
(cÚ¡* 
d©a
, 
d©aSize
,

93 
timev®
 
´e£Á©iÚTime
) {

94 ià(
fP”F¿meFeNameBufãr
 !ğ
NULL
 && 
fOutFid
 == NULL) {

96 ià(
´e£Á©iÚTime
.
tv_u£c
 =ğ
fP»vP»£Á©iÚTime
.tv_usec &&

97 
´e£Á©iÚTime
.
tv_£c
 =ğ
fP»vP»£Á©iÚTime
.tv_sec) {

100 
	`¥rštf
(
fP”F¿meFeNameBufãr
, "%s-%lu.%06lu-%u", 
fP”F¿meFeNameP»fix
,

101 
´e£Á©iÚTime
.
tv_£c
,…»£Á©iÚTime.
tv_u£c
, ++
fSameP»£Á©iÚTimeCouÁ”
);

103 
	`¥rštf
(
fP”F¿meFeNameBufãr
, "%s-%lu.%06lu", 
fP”F¿meFeNameP»fix
,

104 
´e£Á©iÚTime
.
tv_£c
,…»£Á©iÚTime.
tv_u£c
);

105 
fP»vP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

106 
fSameP»£Á©iÚTimeCouÁ”
 = 0;

108 
fOutFid
 = 
	`O³nOuutFe
(
	`’vœ
(), 
fP”F¿meFeNameBufãr
);

112 #ifdeà
TEST_LOSS


113 cÚ¡ 
äamesP”Pack‘
 = 10;

114 cÚ¡ 
äameCouÁ
 = 0;

115 
BoŞ—n
 cÚ¡ 
·ck‘IsLo¡
;

116 ià((
äameCouÁ
++)%
äamesP”Pack‘
 == 0) {

117 
·ck‘IsLo¡
 = (
	`our_¿ndom
()%10 == 0);

120 ià(!
·ck‘IsLo¡
)

122 ià(
fOutFid
 !ğ
NULL
 && 
d©a
 != NULL) {

123 
	`fwr™e
(
d©a
, 1, 
d©aSize
, 
fOutFid
);

125 
	}
}

127 
	gFeSšk
::
	$aá”G‘tšgF¿me
(
äameSize
,

128 
numTrunÿ‹dBy‹s
,

129 
timev®
 
´e£Á©iÚTime
) {

130 ià(
numTrunÿ‹dBy‹s
 > 0) {

131 
	`’vœ
() << "FileSink::afterGettingFrame(): The input frame data wasoo†arge for our buffer size ("

132 << 
fBufãrSize
 << "). "

133 << 
numTrunÿ‹dBy‹s
 << " bytes ofrailing data was dropped! Correcthis by increasinghe \"bufferSize\"…arameter inhe \"createNew()\" callo‡t†east "

134 << 
fBufãrSize
 + 
numTrunÿ‹dBy‹s
 << "\n";

136 
	`addD©a
(
fBufãr
, 
äameSize
, 
´e£Á©iÚTime
);

138 ià(
fOutFid
 =ğ
NULL
 || 
	`fæush
(fOutFidè=ğ
EOF
) {

140 ià(
fSourû
 !ğ
NULL
èfSourû->
	`¡İG‘tšgF¿mes
();

141 
	`ÚSourûClosu»
();

145 ià(
fP”F¿meFeNameBufãr
 !ğ
NULL
) {

146 ià(
fOutFid
 !ğ
NULL
è{ 
	`fşo£
(fOutFid); fOutFid = NULL; }

150 
	`cÚtšuePÏyšg
();

151 
	}
}

	@liveMedia/FramedFileSource.cpp

21 
	~"F¿medFeSourû.hh
"

25 
	gF¿medFeSourû
::
	$F¿medFeSourû
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
)

26 : 
	`F¿medSourû
(
’v
), 
	$fFid
(
fid
) {

27 
	}
}

29 
	gF¿medFeSourû
::~
	$F¿medFeSourû
() {

30 
	}
}

	@liveMedia/FramedFilter.cpp

21 
	~"F¿medF‹r.hh
"

24 
	~<¡ršg.h
>

26 
	gF¿medF‹r
::
	$d‘achIÅutSourû
() {

27 ià(
fIÅutSourû
 !ğ
NULL
) {

28 
fIÅutSourû
->
	`¡İG‘tšgF¿mes
();

29 
	`»assignIÅutSourû
(
NULL
);

31 
	}
}

33 
	gF¿medF‹r
::
	$F¿medF‹r
(
U§geEnvœÚm’t
& 
’v
,

34 
F¿medSourû
* 
šputSourû
)

35 : 
	`F¿medSourû
(
’v
),

36 
	$fIÅutSourû
(
šputSourû
) {

37 
	}
}

39 
	gF¿medF‹r
::~
	$F¿medF‹r
() {

40 
Medium
::
	`şo£
(
fIÅutSourû
);

41 
	}
}

46 cÚ¡* 
	gF¿medF‹r
::
	$MIMEty³
() const {

47 ià(
fIÅutSourû
 =ğ
NULL
)  "";

49  
fIÅutSourû
->
	`MIMEty³
();

50 
	}
}

52 
	gF¿medF‹r
::
	$g‘A‰ribu‹s
() const {

53 ià(
fIÅutSourû
 !ğ
NULL
èfIÅutSourû->
	`g‘A‰ribu‹s
();

54 
	}
}

56 
	gF¿medF‹r
::
	$doStİG‘tšgF¿mes
() {

57 
F¿medSourû
::
	`doStİG‘tšgF¿mes
();

58 ià(
fIÅutSourû
 !ğ
NULL
èfIÅutSourû->
	`¡İG‘tšgF¿mes
();

59 
	}
}

	@liveMedia/FramedSource.cpp

21 
	~"F¿medSourû.hh
"

22 
	~<¡dlib.h
>

26 
	gF¿medSourû
::
	$F¿medSourû
(
U§geEnvœÚm’t
& 
’v
)

27 : 
	`MedŸSourû
(
’v
),

28 
	`fAá”G‘tšgFunc
(
NULL
), 
	`fAá”G‘tšgCl›ÁD©a
(NULL),

29 
	`fOnClo£Func
(
NULL
), 
	`fOnClo£Cl›ÁD©a
(NULL),

30 
	$fIsCu¼’yAwa™šgD©a
(
F®£
) {

31 
fP»£Á©iÚTime
.
tv_£c
 = fP»£Á©iÚTime.
tv_u£c
 = 0;

32 
	}
}

34 
	gF¿medSourû
::~
	$F¿medSourû
() {

35 
	}
}

37 
BoŞ—n
 
F¿medSourû
::
	$isF¿medSourû
() const {

38  
True
;

39 
	}
}

41 
BoŞ—n
 
	gF¿medSourû
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
sourûName
,

42 
F¿medSourû
*& 
»suÉSourû
) {

43 
»suÉSourû
 = 
NULL
;

45 
MedŸSourû
* 
sourû
;

46 ià(!
MedŸSourû
::
	`lookupByName
(
’v
, 
sourûName
, 
sourû
)è 
F®£
;

48 ià(!
sourû
->
	`isF¿medSourû
()) {

49 
’v
.
	`£tResuÉMsg
(
sourûName
, " is‚ot‡ framed source");

50  
F®£
;

53 
»suÉSourû
 = (
F¿medSourû
*)
sourû
;

54  
True
;

55 
	}
}

57 
	gF¿medSourû
::
	$g‘NextF¿me
(* 
to
, 
maxSize
,

58 
aá”G‘tšgFunc
*‡fterGettingFunc,

59 * 
aá”G‘tšgCl›ÁD©a
,

60 
ÚClo£Func
* onCloseFunc,

61 * 
ÚClo£Cl›ÁD©a
) {

63 ià(
fIsCu¼’yAwa™šgD©a
) {

64 
	`’vœ
(è<< "F¿medSourû[" << 
this
 << "]::getNextFrame():‡ttemptingo„ead morehan once‡the sameime!\n";

65 
	`’vœ
().
	`š‹º®E¼Ü
();

68 
fTo
 = 
to
;

69 
fMaxSize
 = 
maxSize
;

70 
fNumTrunÿ‹dBy‹s
 = 0;

71 
fDu¿tiÚInMiüo£cÚds
 = 0;

72 
fAá”G‘tšgFunc
 = 
aá”G‘tšgFunc
;

73 
fAá”G‘tšgCl›ÁD©a
 = 
aá”G‘tšgCl›ÁD©a
;

74 
fOnClo£Func
 = 
ÚClo£Func
;

75 
fOnClo£Cl›ÁD©a
 = 
ÚClo£Cl›ÁD©a
;

76 
fIsCu¼’yAwa™šgD©a
 = 
True
;

78 
	`doG‘NextF¿me
();

79 
	}
}

81 
	gF¿medSourû
::
	$aá”G‘tšg
(
F¿medSourû
* 
sourû
) {

82 
sourû
->
fIsCu¼’yAwa™šgD©a
 = 
F®£
;

87 ià(
sourû
->
fAá”G‘tšgFunc
 !ğ
NULL
) {

88 (*(
sourû
->
fAá”G‘tšgFunc
))(sourû->
fAá”G‘tšgCl›ÁD©a
,

89 
sourû
->
fF¿meSize
, sourû->
fNumTrunÿ‹dBy‹s
,

90 
sourû
->
fP»£Á©iÚTime
,

91 
sourû
->
fDu¿tiÚInMiüo£cÚds
);

93 
	}
}

95 
	gF¿medSourû
::
	$hªdËClosu»
(* 
ş›ÁD©a
) {

96 
F¿medSourû
* 
sourû
 = (F¿medSourû*)
ş›ÁD©a
;

97 
sourû
->
	`hªdËClosu»
();

98 
	}
}

100 
	gF¿medSourû
::
	$hªdËClosu»
() {

101 
fIsCu¼’yAwa™šgD©a
 = 
F®£
;

102 ià(
fOnClo£Func
 !ğ
NULL
) {

103 (*
fOnClo£Func
)(
fOnClo£Cl›ÁD©a
);

105 
	}
}

107 
	gF¿medSourû
::
	$¡İG‘tšgF¿mes
() {

108 
fIsCu¼’yAwa™šgD©a
 = 
F®£
;

109 
fAá”G‘tšgFunc
 = 
NULL
;

110 
fOnClo£Func
 = 
NULL
;

113 
	`doStİG‘tšgF¿mes
();

114 
	}
}

116 
	gF¿medSourû
::
	$doStİG‘tšgF¿mes
() {

118 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

120 
	}
}

122 
	gF¿medSourû
::
	$maxF¿meSize
() const {

125 
	}
}

	@liveMedia/GSMAudioRTPSink.cpp

21 
	~"GSMAudioRTPSšk.hh
"

23 
	gGSMAudioRTPSšk
::
	$GSMAudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
)

24 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 3, 8000, "GSM") {

25 
	}
}

27 
	gGSMAudioRTPSšk
::~
	$GSMAudioRTPSšk
() {

28 
	}
}

30 
GSMAudioRTPSšk
*

31 
GSMAudioRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
) {

32  
Ãw
 
	`GSMAudioRTPSšk
(
’v
, 
RTPgs
);

33 
	}
}

35 
BoŞ—n
 
	gGSMAudioRTPSšk


36 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

39  
	`numF¿mesU£dSoF¬
() < 5;

40 
	}
}

	@liveMedia/GenericMediaServer.cpp

22 
	~"G’”icMedŸS”v”.hh
"

23 
	~<GroupsockH–³r.hh
>

27 
	gG’”icMedŸS”v”
::
	$addS”v”MedŸSessiÚ
(
S”v”MedŸSessiÚ
* 
£rv”MedŸSessiÚ
) {

28 ià(
£rv”MedŸSessiÚ
 =ğ
NULL
) ;

30 cÚ¡* 
£ssiÚName
 = 
£rv”MedŸSessiÚ
->
	`¡»amName
();

31 ià(
£ssiÚName
 =ğ
NULL
) sessionName = "";

32 
	`»moveS”v”MedŸSessiÚ
(
£ssiÚName
);

34 
fS”v”MedŸSessiÚs
->
	`Add
(
£ssiÚName
, (*)
£rv”MedŸSessiÚ
);

35 
	}
}

37 
S”v”MedŸSessiÚ
* 
	gG’”icMedŸS”v”


38 ::
	$lookupS”v”MedŸSessiÚ
(cÚ¡* 
¡»amName
, 
BoŞ—n
 ) {

40  (
S”v”MedŸSessiÚ
*)(
fS”v”MedŸSessiÚs
->
	`Lookup
(
¡»amName
));

41 
	}
}

43 
	gG’”icMedŸS”v”
::
	$»moveS”v”MedŸSessiÚ
(
S”v”MedŸSessiÚ
* 
£rv”MedŸSessiÚ
) {

44 ià(
£rv”MedŸSessiÚ
 =ğ
NULL
) ;

46 
fS”v”MedŸSessiÚs
->
	`Remove
(
£rv”MedŸSessiÚ
->
	`¡»amName
());

47 ià(
£rv”MedŸSessiÚ
->
	`»ã»nûCouÁ
() == 0) {

48 
Medium
::
	`şo£
(
£rv”MedŸSessiÚ
);

50 
£rv”MedŸSessiÚ
->
	`d–‘eWh’UÄeã»nûd
(èğ
True
;

52 
	}
}

54 
	gG’”icMedŸS”v”
::
	$»moveS”v”MedŸSessiÚ
(cÚ¡* 
¡»amName
) {

55 
	`»moveS”v”MedŸSessiÚ
((
S”v”MedŸSessiÚ
*)(
fS”v”MedŸSessiÚs
->
	`Lookup
(
¡»amName
)));

56 
	}
}

58 
	gG’”icMedŸS”v”
::
	$şo£AÎCl›ÁSessiÚsFÜS”v”MedŸSessiÚ
(
S”v”MedŸSessiÚ
* 
£rv”MedŸSessiÚ
) {

59 ià(
£rv”MedŸSessiÚ
 =ğ
NULL
) ;

61 
HashTabË
::
I‹¿tÜ
* 
™”
 = HashTabË::I‹¿tÜ::
	`ü—‹
(*
fCl›ÁSessiÚs
);

62 
G’”icMedŸS”v”
::
Cl›ÁSessiÚ
* 
ş›ÁSessiÚ
;

63 cÚ¡* 
key
;

64 (
ş›ÁSessiÚ
 = (
G’”icMedŸS”v”
::
Cl›ÁSessiÚ
*)(
™”
->
	`Ãxt
(
key
))è!ğ
NULL
) {

65 ià(
ş›ÁSessiÚ
->
fOurS”v”MedŸSessiÚ
 =ğ
£rv”MedŸSessiÚ
) {

66 
d–‘e
 
ş›ÁSessiÚ
;

69 
d–‘e
 
™”
;

70 
	}
}

72 
	gG’”icMedŸS”v”
::
	$şo£AÎCl›ÁSessiÚsFÜS”v”MedŸSessiÚ
(cÚ¡* 
¡»amName
) {

73 
	`şo£AÎCl›ÁSessiÚsFÜS”v”MedŸSessiÚ
((
S”v”MedŸSessiÚ
*)(
fS”v”MedŸSessiÚs
->
	`Lookup
(
¡»amName
)));

74 
	}
}

76 
	gG’”icMedŸS”v”
::
	$d–‘eS”v”MedŸSessiÚ
(
S”v”MedŸSessiÚ
* 
£rv”MedŸSessiÚ
) {

77 ià(
£rv”MedŸSessiÚ
 =ğ
NULL
) ;

79 
	`şo£AÎCl›ÁSessiÚsFÜS”v”MedŸSessiÚ
(
£rv”MedŸSessiÚ
);

80 
	`»moveS”v”MedŸSessiÚ
(
£rv”MedŸSessiÚ
);

81 
	}
}

83 
	gG’”icMedŸS”v”
::
	$d–‘eS”v”MedŸSessiÚ
(cÚ¡* 
¡»amName
) {

84 
	`d–‘eS”v”MedŸSessiÚ
((
S”v”MedŸSessiÚ
*)(
fS”v”MedŸSessiÚs
->
	`Lookup
(
¡»amName
)));

85 
	}
}

87 
	gG’”icMedŸS”v”


88 ::
	$G’”icMedŸS”v”
(
U§geEnvœÚm’t
& 
’v
, 
ourSock‘
, 
PÜt
 
ourPÜt
,

89 
»şam©iÚSecÚds
)

90 : 
	`Medium
(
’v
),

91 
	`fS”v”Sock‘
(
ourSock‘
), 
	`fS”v”PÜt
(
ourPÜt
), 
	`fReşam©iÚSecÚds
(
»şam©iÚSecÚds
),

92 
	`fS”v”MedŸSessiÚs
(
HashTabË
::
	`ü—‹
(
STRING_HASH_KEYS
)),

93 
	`fCl›ÁCÚÃùiÚs
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)),

94 
	`fCl›ÁSessiÚs
(
HashTabË
::
	$ü—‹
(
STRING_HASH_KEYS
)) {

95 
	`ignÜeSigPeOnSock‘
(
fS”v”Sock‘
);

98 
’v
.
	`skScheduËr
().
	`tuºOnBackgroundR—dHªdlšg
(
fS”v”Sock‘
, 
šcomšgCÚÃùiÚHªdËr
, 
this
);

99 
	}
}

101 
	gG’”icMedŸS”v”
::~
	$G’”icMedŸS”v”
() {

103 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fS”v”Sock‘
);

104 ::
	`şo£Sock‘
(
fS”v”Sock‘
);

105 
	}
}

107 
	gG’”icMedŸS”v”
::
	$ş—nup
() {

115 
G’”icMedŸS”v”
::
Cl›ÁSessiÚ
* 
ş›ÁSessiÚ
;

116 (
ş›ÁSessiÚ
 = (
G’”icMedŸS”v”
::
Cl›ÁSessiÚ
*)
fCl›ÁSessiÚs
->
	`g‘Fœ¡
()è!ğ
NULL
) {

117 
d–‘e
 
ş›ÁSessiÚ
;

119 
d–‘e
 
fCl›ÁSessiÚs
;

122 
G’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
* 
cÚÃùiÚ
;

123 (
cÚÃùiÚ
 = (
G’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
*)
fCl›ÁCÚÃùiÚs
->
	`g‘Fœ¡
()è!ğ
NULL
) {

124 
d–‘e
 
cÚÃùiÚ
;

126 
d–‘e
 
fCl›ÁCÚÃùiÚs
;

129 
S”v”MedŸSessiÚ
* 
£rv”MedŸSessiÚ
;

130 (
£rv”MedŸSessiÚ
 = (
S”v”MedŸSessiÚ
*)
fS”v”MedŸSessiÚs
->
	`g‘Fœ¡
()è!ğ
NULL
) {

131 
	`»moveS”v”MedŸSessiÚ
(
£rv”MedŸSessiÚ
);

133 
d–‘e
 
fS”v”MedŸSessiÚs
;

134 
	}
}

136 
	#LISTEN_BACKLOG_SIZE
 20

	)

138 
	gG’”icMedŸS”v”
::
	$£tUpOurSock‘
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
& 
ourPÜt
) {

139 
ourSock‘
 = -1;

144 #ià!
	`defšed
(
ALLOW_SERVER_PORT_REUSE
è&& !defšed(
ALLOW_RTSP_SERVER_PORT_REUSE
)

146 
NoReu£
 
	`dummy
(
’v
);

149 
ourSock‘
 = 
	`£tupSŒ—mSock‘
(
’v
, 
ourPÜt
);

150 ià(
ourSock‘
 < 0) ;

153 ià(!
	`šü—£S’dBufãrTo
(
’v
, 
ourSock‘
, 50*1024)) ;

156 ià(
	`li¡’
(
ourSock‘
, 
LISTEN_BACKLOG_SIZE
) < 0) {

157 
’v
.
	`£tResuÉE¼Msg
("listen() failed: ");

161 ià(
ourPÜt
.
	`num
() == 0) {

163 ià(!
	`g‘SourûPÜt
(
’v
, 
ourSock‘
, 
ourPÜt
)) ;

166  
ourSock‘
;

169 ià(
ourSock‘
 !ğ-1è::
	`şo£Sock‘
(ourSocket);

171 
	}
}

173 
	gG’”icMedŸS”v”
::
	$šcomšgCÚÃùiÚHªdËr
(* 
š¡ªû
, ) {

174 
G’”icMedŸS”v”
* 
£rv”
 = (G’”icMedŸS”v”*)
š¡ªû
;

175 
£rv”
->
	`šcomšgCÚÃùiÚHªdËr
();

176 
	}
}

177 
	gG’”icMedŸS”v”
::
	$šcomšgCÚÃùiÚHªdËr
() {

178 
	`šcomšgCÚÃùiÚHªdËrOnSock‘
(
fS”v”Sock‘
);

179 
	}
}

181 
	gG’”icMedŸS”v”
::
	$šcomšgCÚÃùiÚHªdËrOnSock‘
(
£rv”Sock‘
) {

182 
sockaddr_š
 
ş›ÁAddr
;

183 
SOCKLEN_T
 
ş›ÁAddrL’
 =  
ş›ÁAddr
;

184 
ş›ÁSock‘
 = 
	`acû±
(
£rv”Sock‘
, (
sockaddr
*)&
ş›ÁAddr
, &
ş›ÁAddrL’
);

185 ià(
ş›ÁSock‘
 < 0) {

186 
”r
 = 
	`’vœ
().
	`g‘E¼no
();

187 ià(
”r
 !ğ
EWOULDBLOCK
) {

188 
	`’vœ
().
	`£tResuÉE¼Msg
("accept() failed: ");

192 
	`ignÜeSigPeOnSock‘
(
ş›ÁSock‘
);

193 
	`makeSock‘NÚBlockšg
(
ş›ÁSock‘
);

194 
	`šü—£S’dBufãrTo
(
	`’vœ
(), 
ş›ÁSock‘
, 50*1024);

196 #ifdeà
DEBUG


197 
	`’vœ
(è<< "acû±(ëd cÚÃùiÚ from " << 
	`Add»ssSŒšg
(
ş›ÁAddr
).
	`v®
() << "\n";

201 ()
	`ü—‹NewCl›ÁCÚÃùiÚ
(
ş›ÁSock‘
, 
ş›ÁAddr
);

202 
	}
}

207 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ


208 ::
	$Cl›ÁCÚÃùiÚ
(
G’”icMedŸS”v”
& 
ourS”v”
, 
ş›ÁSock‘
, 
sockaddr_š
 
ş›ÁAddr
)

209 : 
	`fOurS”v”
(
ourS”v”
), 
	`fOurSock‘
(
ş›ÁSock‘
), 
	$fCl›ÁAddr
(
ş›ÁAddr
) {

211 
fOurS”v”
.
fCl›ÁCÚÃùiÚs
->
	`Add
((cÚ¡*)
this
,his);

214 
	`»£tReque¡Bufãr
();

215 
	`’vœ
().
	`skScheduËr
()

216 .
	`£tBackgroundHªdlšg
(
fOurSock‘
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
, 
šcomšgReque¡HªdËr
, 
this
);

217 
	}
}

219 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
::~
	$Cl›ÁCÚÃùiÚ
() {

221 
fOurS”v”
.
fCl›ÁCÚÃùiÚs
->
	`Remove
((cÚ¡*)
this
);

223 
	`şo£Sock‘s
();

224 
	}
}

226 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
::
	$şo£Sock‘s
() {

228 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fOurSock‘
);

229 ::
	`şo£Sock‘
(
fOurSock‘
);

231 
fOurSock‘
 = -1;

232 
	}
}

234 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
::
	$šcomšgReque¡HªdËr
(* 
š¡ªû
, ) {

235 
Cl›ÁCÚÃùiÚ
* 
cÚÃùiÚ
 = (Cl›ÁCÚÃùiÚ*)
š¡ªû
;

236 
cÚÃùiÚ
->
	`šcomšgReque¡HªdËr
();

237 
	}
}

239 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
::
	$šcomšgReque¡HªdËr
() {

240 
sockaddr_š
 
dummy
;

242 
by‹sR—d
 = 
	`»adSock‘
(
	`’vœ
(), 
fOurSock‘
, &
fReque¡Bufãr
[
fReque¡By‹sAÌ—dyS“n
], 
fReque¡BufãrBy‹sLeá
, 
dummy
);

243 
	`hªdËReque¡By‹s
(
by‹sR—d
);

244 
	}
}

246 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
::
	$»£tReque¡Bufãr
() {

247 
fReque¡By‹sAÌ—dyS“n
 = 0;

248 
fReque¡BufãrBy‹sLeá
 =  
fReque¡Bufãr
;

249 
	}
}

254 
	gG’”icMedŸS”v”
::
Cl›ÁSessiÚ


255 ::
	$Cl›ÁSessiÚ
(
G’”icMedŸS”v”
& 
ourS”v”
, 
u_št32_t
 
£ssiÚId
)

256 : 
	`fOurS”v”
(
ourS”v”
), 
	`fOurSessiÚId
(
£ssiÚId
), 
	`fOurS”v”MedŸSessiÚ
(
NULL
),

257 
	$fLiv’essCheckTask
(
NULL
) {

258 
	`nÙeLiv’ess
();

259 
	}
}

261 
	gG’”icMedŸS”v”
::
Cl›ÁSessiÚ
::~
	$Cl›ÁSessiÚ
() {

263 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fLiv’essCheckTask
);

266 
£ssiÚIdSŒ
[9];

267 
	`¥rštf
(
£ssiÚIdSŒ
, "%08X", 
fOurSessiÚId
);

268 
fOurS”v”
.
fCl›ÁSessiÚs
->
	`Remove
(
£ssiÚIdSŒ
);

270 ià(
fOurS”v”MedŸSessiÚ
 !ğ
NULL
) {

271 
fOurS”v”MedŸSessiÚ
->
	`deüem’tReã»nûCouÁ
();

272 ià(
fOurS”v”MedŸSessiÚ
->
	`»ã»nûCouÁ
() == 0

273 && 
fOurS”v”MedŸSessiÚ
->
	`d–‘eWh’UÄeã»nûd
()) {

274 
fOurS”v”
.
	`»moveS”v”MedŸSessiÚ
(
fOurS”v”MedŸSessiÚ
);

275 
fOurS”v”MedŸSessiÚ
 = 
NULL
;

278 
	}
}

280 
	gG’”icMedŸS”v”
::
Cl›ÁSessiÚ
::
	$nÙeLiv’ess
() {

281 #ifdeà
DEBUG


282 cÚ¡* 
¡»amName


283 ğ(
fOurS”v”MedŸSessiÚ
 =ğ
NULL
è? "???" : fOurS”v”MedŸSessiÚ->
	`¡»amName
();

284 
	`årštf
(
¡d”r
, "Client session (id \"%08X\", stream‚ame \"%s\"): Liveness indication\n",

285 
fOurSessiÚId
, 
¡»amName
);

287 ià(
fOurS”v”
.
fReşam©iÚSecÚds
 > 0) {

288 
	`’vœ
().
	`skScheduËr
().
	`»scheduËD–ayedTask
(
fLiv’essCheckTask
,

289 
fOurS”v”
.
fReşam©iÚSecÚds
*1000000,

290 (
TaskFunc
*)
liv’essTimeoutTask
, 
this
);

292 
	}
}

294 
	gG’”icMedŸS”v”
::
Cl›ÁSessiÚ
::
	$nÙeCl›ÁLiv’ess
(
Cl›ÁSessiÚ
* 
ş›ÁSessiÚ
) {

295 
ş›ÁSessiÚ
->
	`nÙeLiv’ess
();

296 
	}
}

298 
	gG’”icMedŸS”v”
::
Cl›ÁSessiÚ
::
	$liv’essTimeoutTask
(
Cl›ÁSessiÚ
* 
ş›ÁSessiÚ
) {

300 #ifdeà
DEBUG


301 cÚ¡* 
¡»amName


302 ğ(
ş›ÁSessiÚ
->
fOurS”v”MedŸSessiÚ
 =ğ
NULL
è? "???" : cl›ÁSessiÚ->fOurS”v”MedŸSessiÚ->
	`¡»amName
();

303 
	`årštf
(
¡d”r
, "Client session (id \"%08X\", stream‚ame \"%s\") hasimed out (dueo inactivity)\n",

304 
ş›ÁSessiÚ
->
fOurSessiÚId
, 
¡»amName
);

306 
d–‘e
 
ş›ÁSessiÚ
;

307 
	}
}

	@liveMedia/H261VideoRTPSource.cpp

21 
	~"H261VideoRTPSourû.hh
"

23 
H261VideoRTPSourû
*

24 
	gH261VideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
¹pTime¡ampF»qu’cy
) {

27  
Ãw
 
	`H261VideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

28 
¹pTime¡ampF»qu’cy
);

29 
	}
}

31 
	gH261VideoRTPSourû


32 ::
	$H261VideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

33 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
)

35 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

36 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
),

37 
	$fLa¡S³cŸlH—d”
(0) {

38 
	}
}

40 
	gH261VideoRTPSourû
::~
	$H261VideoRTPSourû
() {

41 
	}
}

43 
BoŞ—n
 
H261VideoRTPSourû


44 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

45 & 
»suÉS³cŸlH—d”Size
) {

47 ià(
·ck‘
->
	`d©aSize
(è< 4è 
F®£
;

49 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

50 
fLa¡S³cŸlH—d”


51 ğ(
h—d”S¹
[0]<<24)|(headerStart[1]<<16)|(headerStart[2]<<8)|headerStart[3];

53 #ifdeà
DELIVER_COMPLETE_FRAMES


54 
fCu¼’tPack‘BegšsF¿me
 = 
fCu¼’tPack‘Com¶‘esF¿me
;

58 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

61 
»suÉS³cŸlH—d”Size
 = 4;

62  
True
;

63 
	}
}

65 cÚ¡* 
	gH261VideoRTPSourû
::
	$MIMEty³
() const {

67 
	}
}

	@liveMedia/H263plusVideoFileServerMediaSubsession.cpp

25 
	~"H263¶usVideoFeS”v”MedŸSub£ssiÚ.hh
"

26 
	~"H263¶usVideoRTPSšk.hh
"

27 
	~"By‹SŒ—mFeSourû.hh
"

28 
	~"H263¶usVideoSŒ—mF¿m”.hh
"

30 
H263¶usVideoFeS”v”MedŸSub£ssiÚ
*

31 
	gH263¶usVideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

32 cÚ¡* 
feName
,

33 
BoŞ—n
 
»u£Fœ¡Sourû
) {

34  
Ãw
 
	`H263¶usVideoFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

35 
	}
}

37 
	gH263¶usVideoFeS”v”MedŸSub£ssiÚ


38 ::
	$H263¶usVideoFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

39 cÚ¡* 
feName
,

40 
BoŞ—n
 
»u£Fœ¡Sourû
)

41 : 
	$FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
) {

42 
	}
}

44 
	gH263¶usVideoFeS”v”MedŸSub£ssiÚ
::~
	$H263¶usVideoFeS”v”MedŸSub£ssiÚ
() {

45 
	}
}

47 
F¿medSourû
* 
H263¶usVideoFeS”v”MedŸSub£ssiÚ


48 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

49 
e¡B™¿‹
 = 500;

52 
By‹SŒ—mFeSourû
* 
feSourû
 = By‹SŒ—mFeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

53 ià(
feSourû
 =ğ
NULL
)  NULL;

54 
fFeSize
 = 
feSourû
->
	`feSize
();

57  
H263¶usVideoSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
);

58 
	}
}

60 
RTPSšk
* 
	gH263¶usVideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

61 
¹pPaylßdTy³IfDyÇmic
,

62 
F¿medSourû
* ) {

63  
H263¶usVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

64 
	}
}

	@liveMedia/H263plusVideoRTPSink.cpp

21 
	~"H263¶usVideoRTPSšk.hh
"

23 
	gH263¶usVideoRTPSšk


24 ::
	$H263¶usVideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
u_št32_t
 
¹pTime¡ampF»qu’cy
)

27 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
, "H263-1998") {

28 
	}
}

30 
	gH263¶usVideoRTPSšk
::~
	$H263¶usVideoRTPSšk
() {

31 
	}
}

33 
H263¶usVideoRTPSšk
*

34 
H263¶usVideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

35 
¹pPaylßdFÜm©
,

36 
u_št32_t
 
¹pTime¡ampF»qu’cy
) {

37  
Ãw
 
	`H263¶usVideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
);

38 
	}
}

40 
BoŞ—n
 
	gH263¶usVideoRTPSšk


41 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

44  
F®£
;

45 
	}
}

47 
	gH263¶usVideoRTPSšk


48 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

49 * 
äameS¹
,

50 
numBy‹sInF¿me
,

51 
timev®
 
äameP»£Á©iÚTime
,

52 
numRemaššgBy‹s
) {

53 ià(
äagm’tiÚOff£t
 == 0) {

56 
¥ecŸlH—d”
 = 0x0400;

60 ià(
numBy‹sInF¿me
 < 2) {

61 
	`’vœ
() << "H263plusVideoRTPSink::doSpecialFrameHandling(): bad frame size "

62 << 
numBy‹sInF¿me
 << "\n";

65 ià(
äameS¹
[0] != 0 || frameStart[1] != 0) {

66 
	`’vœ
() << "H263plusVideoRTPSink::doSpecialFrameHandling(): unexpected‚on-zero firstwo bytes!\n";

68 
äameS¹
[0] = 
¥ecŸlH—d”
>>8;

69 
äameS¹
[1] = ()
¥ecŸlH—d”
;

71 
¥ecŸlH—d”
 = 0;

72 
	`£tS³cŸlH—d”By‹s
((*)&
¥ecŸlH—d”
, 2);

75 ià(
numRemaššgBy‹s
 == 0) {

78 
	`£tM¬k”B™
();

82 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

83 
	}
}

86 
	gH263¶usVideoRTPSšk
::
	$¥ecŸlH—d”Size
() const {

90  (
	`curF¿gm’tiÚOff£t
() == 0) ? 0 : 2;

91 
	}
}

	@liveMedia/H263plusVideoRTPSource.cpp

21 
	~"H263¶usVideoRTPSourû.hh
"

23 
H263¶usVideoRTPSourû
*

24 
	gH263¶usVideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
¹pTime¡ampF»qu’cy
) {

27  
Ãw
 
	`H263¶usVideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

28 
¹pTime¡ampF»qu’cy
);

29 
	}
}

31 
	gH263¶usVideoRTPSourû


32 ::
	$H263¶usVideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

33 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
)

35 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

36 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
),

37 
	`fNumS³cŸlH—d”s
(0), 
	$fS³cŸlH—d”By‹sL’gth
(0) {

38 
	}
}

40 
	gH263¶usVideoRTPSourû
::~
	$H263¶usVideoRTPSourû
() {

41 
	}
}

43 
BoŞ—n
 
H263¶usVideoRTPSourû


44 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

45 & 
»suÉS³cŸlH—d”Size
) {

46 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

47 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

51 
ex³ùedH—d”Size
 = 2;

52 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

55 
BoŞ—n
 
P
 = (
h—d”S¹
[0]&0x4) != 0;

56 
BoŞ—n
 
V
 = (
h—d”S¹
[0]&0x2) != 0;

57 
PLEN
 = ((
h—d”S¹
[0]&0x1)<<5)|(headerStart[1]>>3);

60 ià(
V
) {

62 ++
ex³ùedH—d”Size
;

63 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

66 ià(
PLEN
 > 0) {

68 
ex³ùedH—d”Size
 +ğ
PLEN
;

69 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

72 
fCu¼’tPack‘BegšsF¿me
 = 
P
;

73 ià(
fCu¼’tPack‘BegšsF¿me
) {

74 
fNumS³cŸlH—d”s
 = 
fS³cŸlH—d”By‹sL’gth
 = 0;

79 
by‹sAvaabË


80 ğ
SPECIAL_HEADER_BUFFER_SIZE
 - 
fS³cŸlH—d”By‹sL’gth
 - 1;

81 ià(
ex³ùedH—d”Size
 <ğ
by‹sAvaabË
) {

82 
fS³cŸlH—d”By‹s
[
fS³cŸlH—d”By‹sL’gth
++] = 
ex³ùedH—d”Size
;

83 
i
 = 0; i < 
ex³ùedH—d”Size
; ++i) {

84 
fS³cŸlH—d”By‹s
[
fS³cŸlH—d”By‹sL’gth
++] = 
h—d”S¹
[
i
];

86 
fPack‘Sizes
[
fNumS³cŸlH—d”s
++] = 
·ck‘Size
;

89 ià(
P
) {

92 
ex³ùedH—d”Size
 -= 2;

93 
h—d”S¹
[
ex³ùedH—d”Size
] = 0;

94 
h—d”S¹
[
ex³ùedH—d”Size
+1] = 0;

98 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

100 
»suÉS³cŸlH—d”Size
 = 
ex³ùedH—d”Size
;

101  
True
;

102 
	}
}

104 cÚ¡* 
	gH263¶usVideoRTPSourû
::
	$MIMEty³
() const {

106 
	}
}

	@liveMedia/H263plusVideoStreamFramer.cpp

22 
	~"H263¶usVideoSŒ—mF¿m”.hh
"

23 
	~"H263¶usVideoSŒ—mP¬£r.hh
"

25 
	~<¡ršg.h
>

26 
	~<GroupsockH–³r.hh
>

32 
H263¶usVideoSŒ—mF¿m”
* 
	gH263¶usVideoSŒ—mF¿m”
::
	$ü—‹New
(

33 
U§geEnvœÚm’t
& 
’v
,

34 
F¿medSourû
* 
šputSourû
)

37 
H263¶usVideoSŒ—mF¿m”
* 
ä
;

38 
ä
 = 
Ãw
 
	`H263¶usVideoSŒ—mF¿m”
(
’v
, 
šputSourû
);

39  
ä
;

40 
	}
}

44 
	gH263¶usVideoSŒ—mF¿m”
::
	$H263¶usVideoSŒ—mF¿m”
(

45 
U§geEnvœÚm’t
& 
’v
,

46 
F¿medSourû
* 
šputSourû
,

47 
BoŞ—n
 
ü—‹P¬£r
)

48 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

49 
	`fF¿meR©e
(0.0),

50 
	$fPiùu»EndM¬k”
(
F®£
)

53 
	`g‘timeofday
(&
fP»£Á©iÚTimeBa£
, 
NULL
);

54 
fP¬£r
 = 
ü—‹P¬£r
 ? 
Ãw
 
	`H263¶usVideoSŒ—mP¬£r
(
this
, 
šputSourû
è: 
NULL
;

55 
	}
}

58 
	gH263¶usVideoSŒ—mF¿m”
::~
	$H263¶usVideoSŒ—mF¿m”
()

60 
d–‘e
 
fP¬£r
;

61 
	}
}

65 
	gH263¶usVideoSŒ—mF¿m”
::
	$doG‘NextF¿me
()

67 
fP¬£r
->
	`»gi¡”R—dIÁ”e¡
(
fTo
, 
fMaxSize
);

68 
	`cÚtšueR—dProûssšg
();

69 
	}
}

73 
BoŞ—n
 
	gH263¶usVideoSŒ—mF¿m”
::
	$isH263¶usVideoSŒ—mF¿m”
() const

75  
True
;

76 
	}
}

79 
	gH263¶usVideoSŒ—mF¿m”
::
	$cÚtšueR—dProûssšg
(

80 * 
ş›ÁD©a
,

82 
timev®
 )

84 
H263¶usVideoSŒ—mF¿m”
* 
äam”
 = (H263¶usVideoSŒ—mF¿m”*)
ş›ÁD©a
;

85 
äam”
->
	`cÚtšueR—dProûssšg
();

86 
	}
}

89 
	gH263¶usVideoSŒ—mF¿m”
::
	$cÚtšueR—dProûssšg
()

91 
acquœedF¿meSize
;

93 
u_št64_t
 
äameDu¿tiÚ
;

95 
acquœedF¿meSize
 = 
fP¬£r
->
	`·r£
(
äameDu¿tiÚ
);

99 ià(
acquœedF¿meSize
 > 0) {

102 
fF¿meSize
 = 
acquœedF¿meSize
;

105 
fF¿meR©e
 = 
äameDu¿tiÚ
 == 0 ? 0.0 : 1000./()frameDuration;

108 ià(
acquœedF¿meSize
 == 5)

109 
fP»£Á©iÚTime
 = 
fP»£Á©iÚTimeBa£
;

111 
fP»£Á©iÚTime
.
tv_u£c
 +ğ(è
äameDu¿tiÚ
*1000;

113 
fP»£Á©iÚTime
.
tv_u£c
 >= 1000000) {

114 
fP»£Á©iÚTime
.
tv_u£c
 -= 1000000;

115 ++
fP»£Á©iÚTime
.
tv_£c
;

119 
fDu¿tiÚInMiüo£cÚds
 = (è
äameDu¿tiÚ
*1000;;

123 
	`aá”G‘tšg
(
this
);

129 
	}
}

	@liveMedia/H263plusVideoStreamParser.cpp

22 
	~"H263¶usVideoSŒ—mP¬£r.hh
"

23 
	~"H263¶usVideoSŒ—mF¿m”.hh
"

28 
	gH263¶usVideoSŒ—mP¬£r
::
	$H263¶usVideoSŒ—mP¬£r
(

29 
H263¶usVideoSŒ—mF¿m”
* 
usšgSourû
,

30 
F¿medSourû
* 
šputSourû
)

31 : 
	`SŒ—mP¬£r
(
šputSourû
,

32 
F¿medSourû
::
hªdËClosu»
,

33 
usšgSourû
,

34 &
H263¶usVideoSŒ—mF¿m”
::
cÚtšueR—dProûssšg
,

35 
usšgSourû
),

36 
	`fUsšgSourû
(
usšgSourû
),

37 
	`âextTR
(0),

38 
	$fcu¼’tPT
(0)

40 
	`mem£t
(
fS‹s
, 0, (fStates));

41 
	`mem£t
(&
fNextInfo
, 0, (fNextInfo));

42 
	`mem£t
(&
fCu¼’tInfo
, 0, (fCurrentInfo));

43 
	`mem£t
(&
fMaxB™¿‹Ctx
, 0, (fMaxBitrateCtx));

44 
	`mem£t
(
fNextH—d”
,0, 
H263_REQUIRE_HEADER_SIZE_BYTES
);

45 
	}
}

48 
	gH263¶usVideoSŒ—mP¬£r
::~
	$H263¶usVideoSŒ—mP¬£r
()

50 
	}
}

53 
H263¶usVideoSŒ—mP¬£r
::
	$»¡ÜeSavedP¬£rS‹
()

55 
SŒ—mP¬£r
::
	`»¡ÜeSavedP¬£rS‹
();

56 
fTo
 = 
fSavedTo
;

57 
fNumTrunÿ‹dBy‹s
 = 
fSavedNumTrunÿ‹dBy‹s
;

58 
	}
}

61 
	gH263¶usVideoSŒ—mP¬£r
::
	$£tP¬£S‹
()

63 
fSavedTo
 = 
fTo
;

64 
fSavedNumTrunÿ‹dBy‹s
 = 
fNumTrunÿ‹dBy‹s
;

65 
	`§veP¬£rS‹
();

66 
	}
}

70 
	gH263¶usVideoSŒ—mP¬£r
::
	$»gi¡”R—dIÁ”e¡
(

71 * 
to
,

72 
maxSize
)

74 
fS¹OfF¿me
 = 
fTo
 = 
fSavedTo
 = 
to
;

75 
fLim™
 = 
to
 + 
maxSize
;

76 
fMaxSize
 = 
maxSize
;

77 
fNumTrunÿ‹dBy‹s
 = 
fSavedNumTrunÿ‹dBy‹s
 = 0;

78 
	}
}

82 
	gH263¶usVideoSŒ—mP¬£r
::
	$·r£
(
u_št64_t
 & 
cu¼’tDu¿tiÚ
)

88 
u_št32_t
 
äameSize
;

92 
u_št8_t
 
ŒDifã»nû
;

100 
Œy


102 
fCu¼’tInfo
 = 
fNextInfo
;

107 
äameSize
 = 
	`·r£H263F¿me
();

109 
cu¼’tDu¿tiÚ
 = 0;

110 ià((
äameSize
 > 0)){

114 ià(!
	`P¬£ShÜtH—d”
(
fTo
, &
fNextInfo
)) {

115 #ifdeà
DEBUG


116 
	`årštf
(
¡d”r
,"H263plusVideoStreamParser: Fatalƒrror\n");

120 
ŒDifã»nû
 = 
	`G‘TRDifã»nû
(
fNextInfo
.
Œ
, 
fCu¼’tInfo
.tr);

123 
cu¼’tDu¿tiÚ
 = 
	`C®cuÏ‹Du¿tiÚ
(
ŒDifã»nû
);

133 
	`£tP¬£S‹
();

135 } 
	`ÿtch
 () {

136 #ifdeà
DEBUG


137 
	`årštf
(
¡d”r
, "H263plusVideoStreamParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

139 
äameSize
=0;

142  
äameSize
;

143 
	}
}

166 
	gH263¶usVideoSŒ—mP¬£r
::
	$·r£H263F¿me
( )

168 
row
 = 0;

169 
u_št8_t
 * 
bufãrIndex
 = 
fTo
;

172 
u_št8_t
 * 
bufãrEnd
 = 
fTo
 + 
fMaxSize
 - 
ADDITIONAL_BYTES_NEEDED
 - 1;

174 
	`memıy
(
fTo
, 
fNextH—d”
, 
H263_REQUIRE_HEADER_SIZE_BYTES
);

175 
bufãrIndex
 +ğ
H263_REQUIRE_HEADER_SIZE_BYTES
;

183 ià(!
fS‹s
[0][0]) {

185 
fS‹s
[0][0] = 1;

187 
fS‹s
[1][0] = fStates[2][0] = 2;

189 
fS‹s
[2][128] = fStates[2][129] = fStates[2][130] = fStates[2][131] = -1;

195 *
bufãrIndex
 = 
	`g‘1By‹
();

196 } (
bufãrIndex
 < 
bufãrEnd
) &&

197 ((
row
 = 
fS‹s
[(ìow][*(
bufãrIndex
++)]) != -1));

199 ià(
row
 != -1) {

200 
	`årštf
(
¡d”r
, "%s: Bufferoo small (%u)\n",

201 "h263»ad”:", 
bufãrEnd
 - 
fTo
 + 
ADDITIONAL_BYTES_NEEDED
);

207 
	`g‘By‹s
(
bufãrIndex
, 
ADDITIONAL_BYTES_NEEDED
);

208 
	`memıy
(
fNextH—d”
, 
bufãrIndex
 - 
H263_STARTCODE_SIZE_BYTES
, 
H263_REQUIRE_HEADER_SIZE_BYTES
);

210 
sz
 = 
bufãrIndex
 - 
fTo
 - 
H263_STARTCODE_SIZE_BYTES
;

212 ià(
sz
 == 5)

213 
	`memıy
(
fTo
, fTo+
H263_REQUIRE_HEADER_SIZE_BYTES
, H263_REQUIRE_HEADER_SIZE_BYTES);

215  
sz
;

216 
	}
}

247 
boŞ
 
	gH263¶usVideoSŒ—mP¬£r
::
	$P¬£ShÜtH—d”
(

248 
u_št8_t
 *
h—d”Bufãr
,

249 
H263INFO
 *
ouutInfoSŒuù
)

251 
u_št8_t
 
fmt
 = 0;

253 
ouutInfoSŒuù
->
Œ
 = (
h—d”Bufãr
[2] << 6) & 0xC0;

254 
ouutInfoSŒuù
->
Œ
 |ğ(
h—d”Bufãr
[3] >> 2) & 0x3F;

256 
fmt
 = (
h—d”Bufãr
[4] >> 2) & 0x07;

259 ià(
fmt
 == 0x07) {

260  
çl£
;

264 ià(!
	`G‘WidthAndHeight
(
fmt
, &(
ouutInfoSŒuù
->
width
),

265 &(
ouutInfoSŒuù
->
height
))) {

266  
çl£
;

269 
ouutInfoSŒuù
->
isSyncF¿me
 = !(
h—d”Bufãr
[4] & 0x02);

271  
Œue
;

272 
	}
}

289 
	gH263¶usVideoSŒ—mP¬£r
::
	$G‘MaxB™¿‹
Ğ
MaxB™¿‹_CTX
 *
ùx
,

290 
u_št32_t
 
äameSize
,

291 
u_št8_t
 
äameTRDiff
)

293 ià(
äameTRDiff
 == 0)

298 
u_št32_t
 
äameB™¿‹
 = 
äameSize
 * 8 / 
äameTRDiff
 + 1;

301 
äameTRDiff
--) {

303 
ùx
->
wšdowB™¿‹
 -ğùx->
b™¿‹TabË
[ùx->
bËIndex
];

305 
ùx
->
b™¿‹TabË
[ùx->
bËIndex
] = 
äameB™¿‹
;

307 
ùx
->
wšdowB™¿‹
 +ğ
äameB™¿‹
;

309 ià(
ùx
->
wšdowB™¿‹
 > ctx->
maxB™¿‹
) {

310 
ùx
->
maxB™¿‹
 = ctx->
wšdowB™¿‹
;

314 
ùx
->
bËIndex
 = (ctx->tableIndex + 1) %

315 Ğ(
ùx
->
b™¿‹TabË
) / (ctx->bitrateTable[0]) );

317 
	}
}

329 
u_št64_t
 
	gH263¶usVideoSŒ—mP¬£r
::
	$C®cuÏ‹Du¿tiÚ
(
u_št8_t
 
ŒDiff
)

331 
u_št64_t
 
ÃxtPT
;

332 
u_št64_t
 
du¿tiÚ
;

334 
âextTR
 +ğ
ŒDiff
;

336 
ÃxtPT
 = (
âextTR
 * 1001è/ 
H263_BASIC_FRAME_RATE
;

339 
du¿tiÚ
 = 
ÃxtPT
 - 
fcu¼’tPT
;

341 
fcu¼’tPT
 = 
ÃxtPT
;

343  
du¿tiÚ
;

344 
	}
}

347 
boŞ
 
	gH263¶usVideoSŒ—mP¬£r
::
	$G‘WidthAndHeight
Ğ
u_št8_t
 
fmt
,

348 
u_št16_t
 *
width
,

349 
u_št16_t
 *
height
)

353 
u_št16_t
 
width
;

354 
u_št16_t
 
height
;

355 } cÚ¡ 
dim’siÚsTabË
[8] = {

366 ià(
fmt
 > 7)

367  
çl£
;

369 *
width
 = 
dim’siÚsTabË
[
fmt
].width;

370 *
height
 = 
dim’siÚsTabË
[
fmt
].height;

372 ià(*
width
 == 0)

373  
çl£
;

375  
Œue
;

376 
	}
}

379 
u_št8_t
 
	gH263¶usVideoSŒ—mP¬£r
::
	$G‘TRDifã»nû
(

380 
u_št8_t
 
ÃxtTR
,

381 
u_št8_t
 
cu¼’tTR
)

383 ià(
cu¼’tTR
 > 
ÃxtTR
) {

385  
ÃxtTR
 + (256 - 
cu¼’tTR
);

387  
ÃxtTR
 - 
cu¼’tTR
;

389 
	}
}

	@liveMedia/H264VideoFileServerMediaSubsession.cpp

22 
	~"H264VideoFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"H264VideoRTPSšk.hh
"

24 
	~"By‹SŒ—mFeSourû.hh
"

25 
	~"H264VideoSŒ—mF¿m”.hh
"

27 
H264VideoFeS”v”MedŸSub£ssiÚ
*

28 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

29 cÚ¡* 
feName
,

30 
BoŞ—n
 
»u£Fœ¡Sourû
) {

31  
Ãw
 
	`H264VideoFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

32 
	}
}

34 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::
	$H264VideoFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

35 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

36 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

37 
	`fAuxSDPLše
(
NULL
), 
	`fDÚeFÏg
(0), 
	$fDummyRTPSšk
(
NULL
) {

38 
	}
}

40 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::~
	$H264VideoFeS”v”MedŸSub£ssiÚ
() {

41 
d–‘e
[] 
fAuxSDPLše
;

42 
	}
}

44 
	$aá”PÏyšgDummy
(* 
ş›ÁD©a
) {

45 
H264VideoFeS”v”MedŸSub£ssiÚ
* 
sub£ss
 = (H264VideoFeS”v”MedŸSub£ssiÚ*)
ş›ÁD©a
;

46 
sub£ss
->
	`aá”PÏyšgDummy1
();

47 
	}
}

49 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::
	$aá”PÏyšgDummy1
() {

51 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

53 
	`£tDÚeFÏg
();

54 
	}
}

56 
	$checkFÜAuxSDPLše
(* 
ş›ÁD©a
) {

57 
H264VideoFeS”v”MedŸSub£ssiÚ
* 
sub£ss
 = (H264VideoFeS”v”MedŸSub£ssiÚ*)
ş›ÁD©a
;

58 
sub£ss
->
	`checkFÜAuxSDPLše1
();

59 
	}
}

61 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::
	$checkFÜAuxSDPLše1
() {

62 cÚ¡* 
da¦
;

64 ià(
fAuxSDPLše
 !ğ
NULL
) {

66 
	`£tDÚeFÏg
();

67 } ià(
fDummyRTPSšk
 !ğ
NULL
 && (
da¦
 = fDummyRTPSšk->
	`auxSDPLše
()) != NULL) {

68 
fAuxSDPLše
 = 
	`¡rDup
(
da¦
);

69 
fDummyRTPSšk
 = 
NULL
;

72 
	`£tDÚeFÏg
();

73 } ià(!
fDÚeFÏg
) {

75 
uSecsToD–ay
 = 100000;

76 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecsToD–ay
,

77 (
TaskFunc
*)
checkFÜAuxSDPLše
, 
this
);

79 
	}
}

81 cÚ¡* 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::
	$g‘AuxSDPLše
(
RTPSšk
* 
¹pSšk
, 
F¿medSourû
* 
šputSourû
) {

82 ià(
fAuxSDPLše
 !ğ
NULL
)  fAuxSDPLine;

84 ià(
fDummyRTPSšk
 =ğ
NULL
) {

88 
fDummyRTPSšk
 = 
¹pSšk
;

91 
fDummyRTPSšk
->
	`¡¬tPÏyšg
(*
šputSourû
, 
aá”PÏyšgDummy
, 
this
);

94 
	`checkFÜAuxSDPLše
(
this
);

97 
	`’vœ
().
	`skScheduËr
().
	`doEv’tLoİ
(&
fDÚeFÏg
);

99  
fAuxSDPLše
;

100 
	}
}

102 
F¿medSourû
* 
	gH264VideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

103 
e¡B™¿‹
 = 500;

106 
By‹SŒ—mFeSourû
* 
feSourû
 = By‹SŒ—mFeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

107 ià(
feSourû
 =ğ
NULL
)  NULL;

108 
fFeSize
 = 
feSourû
->
	`feSize
();

111  
H264VideoSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
);

112 
	}
}

114 
RTPSšk
* 
	gH264VideoFeS”v”MedŸSub£ssiÚ


115 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

116 
¹pPaylßdTy³IfDyÇmic
,

117 
F¿medSourû
* ) {

118  
H264VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

119 
	}
}

	@liveMedia/H264VideoFileSink.cpp

21 
	~"H264VideoFeSšk.hh
"

22 
	~"OuutFe.hh
"

26 
	gH264VideoFeSšk


27 ::
	$H264VideoFeSšk
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

28 cÚ¡* 
sPrİP¬am‘”S‘sSŒ
,

29 
bufãrSize
, cÚ¡* 
³rF¿meFeNameP»fix
)

30 : 
	$H264Ü5VideoFeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
,

31 
sPrİP¬am‘”S‘sSŒ
, 
NULL
, NULL) {

32 
	}
}

34 
	gH264VideoFeSšk
::~
	$H264VideoFeSšk
() {

35 
	}
}

37 
H264VideoFeSšk
*

38 
H264VideoFeSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

39 cÚ¡* 
sPrİP¬am‘”S‘sSŒ
,

40 
bufãrSize
, 
BoŞ—n
 
ÚeFeP”F¿me
) {

42 
FILE
* 
fid
;

43 cÚ¡* 
³rF¿meFeNameP»fix
;

44 ià(
ÚeFeP”F¿me
) {

46 
fid
 = 
NULL
;

47 
³rF¿meFeNameP»fix
 = 
feName
;

50 
fid
 = 
	`O³nOuutFe
(
’v
, 
feName
);

51 ià(
fid
 =ğ
NULL
) ;

52 
³rF¿meFeNameP»fix
 = 
NULL
;

55  
Ãw
 
	`H264VideoFeSšk
(
’v
, 
fid
, 
sPrİP¬am‘”S‘sSŒ
, 
bufãrSize
, 
³rF¿meFeNameP»fix
);

58  
NULL
;

59 
	}
}

	@liveMedia/H264VideoRTPSink.cpp

21 
	~"H264VideoRTPSšk.hh
"

22 
	~"H264VideoSŒ—mF¿m”.hh
"

23 
	~"Ba£64.hh
"

24 
	~"H264VideoRTPSourû.hh
"

28 
	gH264VideoRTPSšk


29 ::
	$H264VideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

30 
u_št8_t
 cÚ¡* 
¥s
, 
¥sSize
, u_št8_ˆcÚ¡* 
µs
, 
µsSize
)

31 : 
	$H264Ü5VideoRTPSšk
(264, 
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

32 
NULL
, 0, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
) {

33 
	}
}

35 
	gH264VideoRTPSšk
::~
	$H264VideoRTPSšk
() {

36 
	}
}

38 
H264VideoRTPSšk
* H264VideoRTPSink

39 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
) {

40  
Ãw
 
	`H264VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

41 
	}
}

43 
H264VideoRTPSšk
* 
	gH264VideoRTPSšk


44 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

45 
u_št8_t
 cÚ¡* 
¥s
, 
¥sSize
, u_št8_ˆcÚ¡* 
µs
, 
µsSize
) {

46  
Ãw
 
	`H264VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
);

47 
	}
}

49 
H264VideoRTPSšk
* 
	gH264VideoRTPSšk


50 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

51 cÚ¡* 
sPrİP¬am‘”S‘sSŒ
) {

52 
u_št8_t
* 
¥s
 = 
NULL
; 
¥sSize
 = 0;

53 
u_št8_t
* 
µs
 = 
NULL
; 
µsSize
 = 0;

55 
numSPrİRecÜds
;

56 
SPrİRecÜd
* 
sPrİRecÜds
 = 
	`·r£SPrİP¬am‘”S‘s
(
sPrİP¬am‘”S‘sSŒ
, 
numSPrİRecÜds
);

57 
i
 = 0; i < 
numSPrİRecÜds
; ++i) {

58 ià(
sPrİRecÜds
[
i
].
sPrİL’gth
 == 0) ;

59 
u_št8_t
 
Çl_un™_ty³
 = (
sPrİRecÜds
[
i
].
sPrİBy‹s
[0])&0x1F;

60 ià(
Çl_un™_ty³
 == 7 ) {

61 
¥s
 = 
sPrİRecÜds
[
i
].
sPrİBy‹s
;

62 
¥sSize
 = 
sPrİRecÜds
[
i
].
sPrİL’gth
;

63 } ià(
Çl_un™_ty³
 == 8 ) {

64 
µs
 = 
sPrİRecÜds
[
i
].
sPrİBy‹s
;

65 
µsSize
 = 
sPrİRecÜds
[
i
].
sPrİL’gth
;

69 
H264VideoRTPSšk
* 
»suÉ


70 ğ
Ãw
 
	`H264VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
);

71 
d–‘e
[] 
sPrİRecÜds
;

73  
»suÉ
;

74 
	}
}

76 
BoŞ—n
 
	gH264VideoRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

78  
sourû
.
	`isH264VideoSŒ—mF¿m”
();

79 
	}
}

81 cÚ¡* 
	gH264VideoRTPSšk
::
	$auxSDPLše
() {

85 
H264Ü5VideoSŒ—mF¿m”
* 
äam”Sourû
 = 
NULL
;

86 
u_št8_t
* 
vpsDummy
 = 
NULL
; 
vpsDummySize
 = 0;

87 
u_št8_t
* 
¥s
 = 
fSPS
; 
¥sSize
 = 
fSPSSize
;

88 
u_št8_t
* 
µs
 = 
fPPS
; 
µsSize
 = 
fPPSSize
;

89 ià(
¥s
 =ğ
NULL
 || 
µs
 == NULL) {

91 ià(
fOurF¿gm’‹r
 =ğ
NULL
)  NULL;

92 
äam”Sourû
 = (
H264Ü5VideoSŒ—mF¿m”
*)(
fOurF¿gm’‹r
->
	`šputSourû
());

93 ià(
äam”Sourû
 =ğ
NULL
)  NULL;

95 
äam”Sourû
->
	`g‘VPSªdSPSªdPPS
(
vpsDummy
, 
vpsDummySize
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
);

96 ià(
¥s
 =ğ
NULL
 || 
µs
 == NULL)  NULL;

100 
u_št8_t
* 
¥sWEB
 = 
Ãw
 u_št8_t[
¥sSize
];

101 
¥sWEBSize
 = 
	`»moveH264Ü5EmuÏtiÚBy‹s
(
¥sWEB
, 
¥sSize
, 
¥s
, spsSize);

102 ià(
¥sWEBSize
 < 4) {

103 
d–‘e
[] 
¥sWEB
;

104  
NULL
;

106 
u_št32_t
 
´ofeLev–Id
 = (
¥sWEB
[1]<<16) | (spsWEB[2]<<8) | spsWEB[3];

107 
d–‘e
[] 
¥sWEB
;

109 * 
¥s_ba£64
 = 
	`ba£64Encode
((*)
¥s
, 
¥sSize
);

110 * 
µs_ba£64
 = 
	`ba£64Encode
((*)
µs
, 
µsSize
);

112 cÚ¡* 
fmFmt
 =

116 
fmFmtSize
 = 
	`¡¾’
(
fmFmt
)

119 + 
	`¡¾’
(
¥s_ba£64
è+ sŒËn(
µs_ba£64
);

120 * 
fm
 = 
Ãw
 [
fmFmtSize
];

121 
	`¥rštf
(
fm
, 
fmFmt
,

122 
	`¹pPaylßdTy³
(),

123 
´ofeLev–Id
,

124 
¥s_ba£64
, 
µs_ba£64
);

126 
d–‘e
[] 
¥s_ba£64
;

127 
d–‘e
[] 
µs_ba£64
;

129 
d–‘e
[] 
fFmSDPLše
; fFmSDPLšğ
fm
;

130  
fFmSDPLše
;

131 
	}
}

	@liveMedia/H264VideoRTPSource.cpp

21 
	~"H264VideoRTPSourû.hh
"

22 
	~"Ba£64.hh
"

26 şas 
	cH264Bufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

27 
public
:

28 
H264Bufã»dPack‘
(
H264VideoRTPSourû
& 
ourSourû
);

29 
	mvœtu®
 ~
H264Bufã»dPack‘
();

31 
	m´iv©e
:

32 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

33 
d©aSize
);

34 
	m´iv©e
:

35 
H264VideoRTPSourû
& 
fOurSourû
;

38 şas 
	cH264Bufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

39 
´iv©e
:

40 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

46 
H264VideoRTPSourû
*

47 
	gH264VideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

48 
¹pPaylßdFÜm©
,

49 
¹pTime¡ampF»qu’cy
) {

50  
Ãw
 
	`H264VideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

51 
¹pTime¡ampF»qu’cy
);

52 
	}
}

54 
	gH264VideoRTPSourû


55 ::
	$H264VideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

56 
¹pPaylßdFÜm©
,

57 
¹pTime¡ampF»qu’cy
)

58 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

59 
Ãw
 
H264Bufã»dPack‘FaùÜy
) {

60 
	}
}

62 
	gH264VideoRTPSourû
::~
	$H264VideoRTPSourû
() {

63 
	}
}

65 
BoŞ—n
 
H264VideoRTPSourû


66 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

67 & 
»suÉS³cŸlH—d”Size
) {

68 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

69 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

70 
numBy‹sToSk
;

73 ià(
·ck‘Size
 < 1è 
F®£
;

74 
fCurPack‘NALUn™Ty³
 = (
h—d”S¹
[0]&0x1F);

75 
fCurPack‘NALUn™Ty³
) {

77 
numBy‹sToSk
 = 1;

81 
numBy‹sToSk
 = 3;

87 ià(
·ck‘Size
 < 2è 
F®£
;

88 
¡¬tB™
 = 
h—d”S¹
[1]&0x80;

89 
’dB™
 = 
h—d”S¹
[1]&0x40;

90 ià(
¡¬tB™
) {

91 
fCu¼’tPack‘BegšsF¿me
 = 
True
;

93 
h—d”S¹
[1] = (headerStart[0]&0xE0)|(headerStart[1]&0x1F);

94 
numBy‹sToSk
 = 1;

97 
fCu¼’tPack‘BegšsF¿me
 = 
F®£
;

98 
numBy‹sToSk
 = 2;

100 
fCu¼’tPack‘Com¶‘esF¿me
 = (
’dB™
 != 0);

105 
fCu¼’tPack‘BegšsF¿me
 = 
fCu¼’tPack‘Com¶‘esF¿me
 = 
True
;

106 
numBy‹sToSk
 = 0;

111 
»suÉS³cŸlH—d”Size
 = 
numBy‹sToSk
;

112  
True
;

113 
	}
}

115 cÚ¡* 
	gH264VideoRTPSourû
::
	$MIMEty³
() const {

117 
	}
}

119 
SPrİRecÜd
* 
	$·r£SPrİP¬am‘”S‘s
(cÚ¡* 
sPrİP¬am‘”S‘sSŒ
,

121 & 
numSPrİRecÜds
) {

123 * 
šSŒ
 = 
	`¡rDup
(
sPrİP¬am‘”S‘sSŒ
);

124 ià(
šSŒ
 =ğ
NULL
) {

125 
numSPrİRecÜds
 = 0;

126  
NULL
;

130 
numSPrİRecÜds
 = 1;

131 * 
s
;

132 
s
 = 
šSŒ
; *s != '\0'; ++s) {

133 ià(*
s
 == ',') {

134 ++
numSPrİRecÜds
;

135 *
s
 = '\0';

140 
SPrİRecÜd
* 
»suÉA¼ay
 = 
Ãw
 SPrİRecÜd[
numSPrİRecÜds
];

141 
s
 = 
šSŒ
;

142 
i
 = 0; i < 
numSPrİRecÜds
; ++i) {

143 
»suÉA¼ay
[
i
].
sPrİBy‹s
 = 
	`ba£64Decode
(
s
,„esuÉA¼ay[i].
sPrİL’gth
);

144 
s
 +ğ
	`¡¾’
(s) + 1;

147 
d–‘e
[] 
šSŒ
;

148  
»suÉA¼ay
;

149 
	}
}

154 
	gH264Bufã»dPack‘
::
	$H264Bufã»dPack‘
(
H264VideoRTPSourû
& 
ourSourû
)

155 : 
	$fOurSourû
(
ourSourû
) {

156 
	}
}

158 
H264Bufã»dPack‘
::~
	$H264Bufã»dPack‘
() {

159 
	}
}

161 
H264Bufã»dPack‘


162 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

163 
»suÉNALUSize
 = 0;

165 
fOurSourû
.
fCurPack‘NALUn™Ty³
) {

168 ià(
d©aSize
 < 2) ;

169 
»suÉNALUSize
 = (
äamePŒ
[0]<<8)|framePtr[1];

170 
äamePŒ
 += 2;

175 ià(
d©aSize
 < 5) ;

176 
»suÉNALUSize
 = (
äamePŒ
[0]<<8)|framePtr[1];

177 
äamePŒ
 += 5;

182 ià(
d©aSize
 < 6) ;

183 
»suÉNALUSize
 = (
äamePŒ
[0]<<8)|framePtr[1];

184 
äamePŒ
 += 6;

189  
d©aSize
;

193  (
»suÉNALUSize
 <ğ
d©aSize
) ?„esultNALUSize : dataSize;

194 
	}
}

196 
Bufã»dPack‘
* 
	gH264Bufã»dPack‘FaùÜy


197 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

198  
Ãw
 
	`H264Bufã»dPack‘
((
H264VideoRTPSourû
&)(*
ourSourû
));

199 
	}
}

	@liveMedia/H264VideoStreamDiscreteFramer.cpp

24 
	~"H264VideoSŒ—mDisü‘eF¿m”.hh
"

26 
H264VideoSŒ—mDisü‘eF¿m”
*

27 
	gH264VideoSŒ—mDisü‘eF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

28  
Ãw
 
	`H264VideoSŒ—mDisü‘eF¿m”
(
’v
, 
šputSourû
);

29 
	}
}

31 
	gH264VideoSŒ—mDisü‘eF¿m”


32 ::
	$H264VideoSŒ—mDisü‘eF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
)

33 : 
	$H264Ü5VideoSŒ—mDisü‘eF¿m”
(264, 
’v
, 
šputSourû
) {

34 
	}
}

36 
	gH264VideoSŒ—mDisü‘eF¿m”
::~
	$H264VideoSŒ—mDisü‘eF¿m”
() {

37 
	}
}

39 
BoŞ—n
 
H264VideoSŒ—mDisü‘eF¿m”
::
	$isH264VideoSŒ—mF¿m”
() const {

40  
True
;

41 
	}
}

	@liveMedia/H264VideoStreamFramer.cpp

21 
	~"H264VideoSŒ—mF¿m”.hh
"

23 
H264VideoSŒ—mF¿m”
* 
	gH264VideoSŒ—mF¿m”


24 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
šşudeS¹CodeInOuut
) {

25  
Ãw
 
	`H264VideoSŒ—mF¿m”
(
’v
, 
šputSourû
, 
True
, 
šşudeS¹CodeInOuut
);

26 
	}
}

28 
	gH264VideoSŒ—mF¿m”


29 ::
	$H264VideoSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
ü—‹P¬£r
, BoŞ—À
šşudeS¹CodeInOuut
)

30 : 
	$H264Ü5VideoSŒ—mF¿m”
(264, 
’v
, 
šputSourû
, 
ü—‹P¬£r
, 
šşudeS¹CodeInOuut
) {

31 
	}
}

33 
	gH264VideoSŒ—mF¿m”
::~
	$H264VideoSŒ—mF¿m”
() {

34 
	}
}

36 
BoŞ—n
 
H264VideoSŒ—mF¿m”
::
	$isH264VideoSŒ—mF¿m”
() const {

37  
True
;

38 
	}
}

	@liveMedia/H264or5VideoFileSink.cpp

21 
	~"H264Ü5VideoFeSšk.hh
"

22 
	~"H264VideoRTPSourû.hh
"

26 
	gH264Ü5VideoFeSšk


27 ::
	$H264Ü5VideoFeSšk
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

28 
bufãrSize
, cÚ¡* 
³rF¿meFeNameP»fix
,

29 cÚ¡* 
sPrİP¬am‘”S‘sSŒ1
,

30 cÚ¡* 
sPrİP¬am‘”S‘sSŒ2
,

31 cÚ¡* 
sPrİP¬am‘”S‘sSŒ3
)

32 : 
	`FeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
),

33 
	$fHaveWr™‹nFœ¡F¿me
(
F®£
) {

34 
fSPrİP¬am‘”S‘sSŒ
[0] = 
sPrİP¬am‘”S‘sSŒ1
;

35 
fSPrİP¬am‘”S‘sSŒ
[1] = 
sPrİP¬am‘”S‘sSŒ2
;

36 
fSPrİP¬am‘”S‘sSŒ
[2] = 
sPrİP¬am‘”S‘sSŒ3
;

37 
	}
}

39 
	gH264Ü5VideoFeSšk
::~
	$H264Ü5VideoFeSšk
() {

40 
	}
}

42 
H264Ü5VideoFeSšk
::
	$aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
timev®
 
´e£Á©iÚTime
) {

43 cÚ¡ 
¡¬t_code
[4] = {0x00, 0x00, 0x00, 0x01};

45 ià(!
fHaveWr™‹nFœ¡F¿me
) {

47 
j
 = 0; j < 3; ++j) {

48 
numSPrİRecÜds
;

49 
SPrİRecÜd
* 
sPrİRecÜds


50 ğ
	`·r£SPrİP¬am‘”S‘s
(
fSPrİP¬am‘”S‘sSŒ
[
j
], 
numSPrİRecÜds
);

51 
i
 = 0; i < 
numSPrİRecÜds
; ++i) {

52 
	`addD©a
(
¡¬t_code
, 4, 
´e£Á©iÚTime
);

53 
	`addD©a
(
sPrİRecÜds
[
i
].
sPrİBy‹s
, sPrİRecÜds[i].
sPrİL’gth
, 
´e£Á©iÚTime
);

55 
d–‘e
[] 
sPrİRecÜds
;

57 
fHaveWr™‹nFœ¡F¿me
 = 
True
;

61 
	`addD©a
(
¡¬t_code
, 4, 
´e£Á©iÚTime
);

64 
FeSšk
::
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
);

65 
	}
}

	@liveMedia/H264or5VideoRTPSink.cpp

21 
	~"H264Ü5VideoRTPSšk.hh
"

22 
	~"H264Ü5VideoSŒ—mF¿m”.hh
"

33 şas 
	cH264Ü5F¿gm’‹r
: 
public
 
F¿medF‹r
 {

34 
public
:

35 
H264Ü5F¿gm’‹r
(
hNumb”
, 
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

36 
šputBufãrMax
, 
maxOuutPack‘Size
);

37 
	mvœtu®
 ~
H264Ü5F¿gm’‹r
();

39 
BoŞ—n
 
	$Ï¡F¿gm’tCom¶‘edNALUn™
(ècÚ¡ {  
fLa¡F¿gm’tCom¶‘edNALUn™
; }

41 
´iv©e
:

42 
vœtu®
 
	`doG‘NextF¿me
();

43 
vœtu®
 
	`doStİG‘tšgF¿mes
();

45 
´iv©e
:

46 
	`aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

47 
numTrunÿ‹dBy‹s
,

48 
timev®
 
´e£Á©iÚTime
,

49 
du¿tiÚInMiüo£cÚds
);

50 
	`aá”G‘tšgF¿me1
(
äameSize
,

51 
numTrunÿ‹dBy‹s
,

52 
timev®
 
´e£Á©iÚTime
,

53 
du¿tiÚInMiüo£cÚds
);

54 
	`»£t
();

56 
´iv©e
:

57 
fHNumb”
;

58 
fIÅutBufãrSize
;

59 
fMaxOuutPack‘Size
;

60 * 
fIÅutBufãr
;

61 
fNumV®idD©aBy‹s
;

62 
fCurD©aOff£t
;

63 
fSaveNumTrunÿ‹dBy‹s
;

64 
BoŞ—n
 
fLa¡F¿gm’tCom¶‘edNALUn™
;

65 
	}
};

70 
	gH264Ü5VideoRTPSšk


71 ::
	$H264Ü5VideoRTPSšk
(
hNumb”
,

72 
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

73 
u_št8_t
 cÚ¡* 
vps
, 
vpsSize
,

74 
u_št8_t
 cÚ¡* 
¥s
, 
¥sSize
,

75 
u_št8_t
 cÚ¡* 
µs
, 
µsSize
)

76 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 90000, 
hNumb”
 == 264 ? "H264" : "H265"),

77 
	`fHNumb”
(
hNumb”
), 
	`fOurF¿gm’‹r
(
NULL
), 
	$fFmSDPLše
(
NULL
) {

78 ià(
vps
 !ğ
NULL
) {

79 
fVPSSize
 = 
vpsSize
;

80 
fVPS
 = 
Ãw
 
u_št8_t
[
fVPSSize
];

81 
	`memmove
(
fVPS
, 
vps
, 
fVPSSize
);

83 
fVPSSize
 = 0;

84 
fVPS
 = 
NULL
;

86 ià(
¥s
 !ğ
NULL
) {

87 
fSPSSize
 = 
¥sSize
;

88 
fSPS
 = 
Ãw
 
u_št8_t
[
fSPSSize
];

89 
	`memmove
(
fSPS
, 
¥s
, 
fSPSSize
);

91 
fSPSSize
 = 0;

92 
fSPS
 = 
NULL
;

94 ià(
µs
 !ğ
NULL
) {

95 
fPPSSize
 = 
µsSize
;

96 
fPPS
 = 
Ãw
 
u_št8_t
[
fPPSSize
];

97 
	`memmove
(
fPPS
, 
µs
, 
fPPSSize
);

99 
fPPSSize
 = 0;

100 
fPPS
 = 
NULL
;

102 
	}
}

104 
	gH264Ü5VideoRTPSšk
::~
	$H264Ü5VideoRTPSšk
() {

105 
fSourû
 = 
fOurF¿gm’‹r
;

106 
d–‘e
[] 
fFmSDPLše
;

107 
d–‘e
[] 
fVPS
; d–‘e[] 
fSPS
; d–‘e[] 
fPPS
;

108 
	`¡İPÏyšg
();

111 
Medium
::
	`şo£
(
fOurF¿gm’‹r
);

112 
fSourû
 = 
NULL
;

113 
	}
}

115 
BoŞ—n
 
	gH264Ü5VideoRTPSšk
::
	$cÚtšuePÏyšg
() {

118 ià(
fOurF¿gm’‹r
 =ğ
NULL
) {

119 
fOurF¿gm’‹r
 = 
Ãw
 
	`H264Ü5F¿gm’‹r
(
fHNumb”
, 
	`’vœ
(), 
fSourû
, 
OutPack‘Bufãr
::
maxSize
,

120 
	`ourMaxPack‘Size
() - 12 );

122 
fOurF¿gm’‹r
->
	`»assignIÅutSourû
(
fSourû
);

124 
fSourû
 = 
fOurF¿gm’‹r
;

127  
MuÉiF¿medRTPSšk
::
	`cÚtšuePÏyšg
();

128 
	}
}

130 
	gH264Ü5VideoRTPSšk
::
	$doS³cŸlF¿meHªdlšg
(,

133 
timev®
 
äameP»£Á©iÚTime
,

138 ià(
fOurF¿gm’‹r
 !ğ
NULL
) {

139 
H264Ü5VideoSŒ—mF¿m”
* 
äam”Sourû


140 ğ(
H264Ü5VideoSŒ—mF¿m”
*)(
fOurF¿gm’‹r
->
	`šputSourû
());

142 ià(((
H264Ü5F¿gm’‹r
*)
fOurF¿gm’‹r
)->
	`Ï¡F¿gm’tCom¶‘edNALUn™
()

143 && 
äam”Sourû
 !ğ
NULL
 && f¿m”Sourû->
	`piùu»EndM¬k”
()) {

144 
	`£tM¬k”B™
();

145 
äam”Sourû
->
	`piùu»EndM¬k”
(èğ
F®£
;

149 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

150 
	}
}

152 
BoŞ—n
 
	gH264Ü5VideoRTPSšk


153 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

155  
F®£
;

156 
	}
}

161 
	gH264Ü5F¿gm’‹r
::
	$H264Ü5F¿gm’‹r
(
hNumb”
,

162 
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

163 
šputBufãrMax
, 
maxOuutPack‘Size
)

164 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

165 
	`fHNumb”
(
hNumb”
),

166 
	`fIÅutBufãrSize
(
šputBufãrMax
+1), 
	$fMaxOuutPack‘Size
(
maxOuutPack‘Size
) {

167 
fIÅutBufãr
 = 
Ãw
 [
fIÅutBufãrSize
];

168 
	`»£t
();

169 
	}
}

171 
	gH264Ü5F¿gm’‹r
::~
	$H264Ü5F¿gm’‹r
() {

172 
d–‘e
[] 
fIÅutBufãr
;

173 
	`d‘achIÅutSourû
();

174 
	}
}

176 
	gH264Ü5F¿gm’‹r
::
	$doG‘NextF¿me
() {

177 ià(
fNumV®idD©aBy‹s
 == 1) {

179 
fIÅutSourû
->
	`g‘NextF¿me
(&
fIÅutBufãr
[1], 
fIÅutBufãrSize
 - 1,

180 
aá”G‘tšgF¿me
, 
this
,

181 
F¿medSourû
::
hªdËClosu»
, 
this
);

194 ià(
fMaxSize
 < 
fMaxOuutPack‘Size
) {

195 
	`’vœ
() << "H264or5Fragmenter::doGetNextFrame(): fMaxSize ("

196 << 
fMaxSize
 << ") is smallerhanƒxpected\n";

198 
fMaxSize
 = 
fMaxOuutPack‘Size
;

201 
fLa¡F¿gm’tCom¶‘edNALUn™
 = 
True
;

202 ià(
fCurD©aOff£t
 == 1) {

203 ià(
fNumV®idD©aBy‹s
 - 1 <ğ
fMaxSize
) {

204 
	`memmove
(
fTo
, &
fIÅutBufãr
[1], 
fNumV®idD©aBy‹s
 - 1);

205 
fF¿meSize
 = 
fNumV®idD©aBy‹s
 - 1;

206 
fCurD©aOff£t
 = 
fNumV®idD©aBy‹s
;

211 ià(
fHNumb”
 == 264) {

212 
fIÅutBufãr
[0] = (fInputBuffer[1] & 0xE0) | 28;

213 
fIÅutBufãr
[1] = 0x80 | (fInputBuffer[1] & 0x1F);

215 
u_št8_t
 
Çl_un™_ty³
 = (
fIÅutBufãr
[1]&0x7E)>>1;

216 
fIÅutBufãr
[0] = (fInputBuffer[1] & 0x81) | (49<<1);

217 
fIÅutBufãr
[1] = fInputBuffer[2];

218 
fIÅutBufãr
[2] = 0x80 | 
Çl_un™_ty³
;

220 
	`memmove
(
fTo
, 
fIÅutBufãr
, 
fMaxSize
);

221 
fF¿meSize
 = 
fMaxSize
;

222 
fCurD©aOff£t
 +ğ
fMaxSize
 - 1;

223 
fLa¡F¿gm’tCom¶‘edNALUn™
 = 
F®£
;

231 
numExŒaH—d”By‹s
;

232 ià(
fHNumb”
 == 264) {

233 
fIÅutBufãr
[
fCurD©aOff£t
-2] = fInputBuffer[0];

234 
fIÅutBufãr
[
fCurD©aOff£t
-1] = fInputBuffer[1]&~0x80;

235 
numExŒaH—d”By‹s
 = 2;

237 
fIÅutBufãr
[
fCurD©aOff£t
-3] = fInputBuffer[0];

238 
fIÅutBufãr
[
fCurD©aOff£t
-2] = fInputBuffer[1];

239 
fIÅutBufãr
[
fCurD©aOff£t
-1] = fInputBuffer[2]&~0x80;

240 
numExŒaH—d”By‹s
 = 3;

242 
numBy‹sToS’d
 = 
numExŒaH—d”By‹s
 + (
fNumV®idD©aBy‹s
 - 
fCurD©aOff£t
);

243 ià(
numBy‹sToS’d
 > 
fMaxSize
) {

245 
numBy‹sToS’d
 = 
fMaxSize
;

246 
fLa¡F¿gm’tCom¶‘edNALUn™
 = 
F®£
;

249 
fIÅutBufãr
[
fCurD©aOff£t
-1] |= 0x40;

250 
fNumTrunÿ‹dBy‹s
 = 
fSaveNumTrunÿ‹dBy‹s
;

252 
	`memmove
(
fTo
, &
fIÅutBufãr
[
fCurD©aOff£t
-
numExŒaH—d”By‹s
], 
numBy‹sToS’d
);

253 
fF¿meSize
 = 
numBy‹sToS’d
;

254 
fCurD©aOff£t
 +ğ
numBy‹sToS’d
 - 
numExŒaH—d”By‹s
;

257 ià(
fCurD©aOff£t
 >ğ
fNumV®idD©aBy‹s
) {

259 
fNumV®idD©aBy‹s
 = 
fCurD©aOff£t
 = 1;

263 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

265 
	}
}

267 
	gH264Ü5F¿gm’‹r
::
	$doStİG‘tšgF¿mes
() {

269 
	`»£t
();

270 
F¿medF‹r
::
	`doStİG‘tšgF¿mes
();

271 
	}
}

273 
	gH264Ü5F¿gm’‹r
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

274 
numTrunÿ‹dBy‹s
,

275 
timev®
 
´e£Á©iÚTime
,

276 
du¿tiÚInMiüo£cÚds
) {

277 
H264Ü5F¿gm’‹r
* 
äagm’‹r
 = (H264Ü5F¿gm’‹r*)
ş›ÁD©a
;

278 
äagm’‹r
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
,

279 
du¿tiÚInMiüo£cÚds
);

280 
	}
}

282 
	gH264Ü5F¿gm’‹r
::
	$aá”G‘tšgF¿me1
(
äameSize
,

283 
numTrunÿ‹dBy‹s
,

284 
timev®
 
´e£Á©iÚTime
,

285 
du¿tiÚInMiüo£cÚds
) {

286 
fNumV®idD©aBy‹s
 +ğ
äameSize
;

287 
fSaveNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

288 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

289 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

292 
	`doG‘NextF¿me
();

293 
	}
}

295 
	gH264Ü5F¿gm’‹r
::
	$»£t
() {

296 
fNumV®idD©aBy‹s
 = 
fCurD©aOff£t
 = 1;

297 
fSaveNumTrunÿ‹dBy‹s
 = 0;

298 
fLa¡F¿gm’tCom¶‘edNALUn™
 = 
True
;

299 
	}
}

	@liveMedia/H264or5VideoStreamDiscreteFramer.cpp

24 
	~"H264Ü5VideoSŒ—mDisü‘eF¿m”.hh
"

26 
	gH264Ü5VideoSŒ—mDisü‘eF¿m”


27 ::
	$H264Ü5VideoSŒ—mDisü‘eF¿m”
(
hNumb”
, 
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
)

28 : 
	$H264Ü5VideoSŒ—mF¿m”
(
hNumb”
, 
’v
, 
šputSourû
, 
F®£
 , False) {

29 
	}
}

31 
	gH264Ü5VideoSŒ—mDisü‘eF¿m”
::~
	$H264Ü5VideoSŒ—mDisü‘eF¿m”
() {

32 
	}
}

34 
H264Ü5VideoSŒ—mDisü‘eF¿m”
::
	$doG‘NextF¿me
() {

38 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

39 
aá”G‘tšgF¿me
, 
this
,

40 
F¿medSourû
::
hªdËClosu»
, 
this
);

41 
	}
}

43 
	gH264Ü5VideoSŒ—mDisü‘eF¿m”


44 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

45 
numTrunÿ‹dBy‹s
,

46 
timev®
 
´e£Á©iÚTime
,

47 
du¿tiÚInMiüo£cÚds
) {

48 
H264Ü5VideoSŒ—mDisü‘eF¿m”
* 
sourû
 = (H264Ü5VideoSŒ—mDisü‘eF¿m”*)
ş›ÁD©a
;

49 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

50 
	}
}

52 
	gH264Ü5VideoSŒ—mDisü‘eF¿m”


53 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

54 
timev®
 
´e£Á©iÚTime
,

55 
du¿tiÚInMiüo£cÚds
) {

57 
u_št8_t
 
Çl_un™_ty³
;

58 ià(
fHNumb”
 =ğ264 && 
äameSize
 >= 1) {

59 
Çl_un™_ty³
 = 
fTo
[0]&0x1F;

60 } ià(
fHNumb”
 =ğ265 && 
äameSize
 >= 2) {

61 
Çl_un™_ty³
 = (
fTo
[0]&0x7E)>>1;

64 
Çl_un™_ty³
 = 0xFF;

72 ià(
äameSize
 >ğ4 && 
fTo
[0] == 0 && fTo[1] == 0 && ((fTo[2] == 0 && fTo[3] == 1) || fTo[2] == 1)) {

73 
	`’vœ
() << "H264or5VideoStreamDiscreteFramerƒrror: MPEG 'start code' seen inhe input\n";

74 } ià(
	`isVPS
(
Çl_un™_ty³
)) {

75 
	`§veCİyOfVPS
(
fTo
, 
äameSize
);

76 } ià(
	`isSPS
(
Çl_un™_ty³
)) {

77 
	`§veCİyOfSPS
(
fTo
, 
äameSize
);

78 } ià(
	`isPPS
(
Çl_un™_ty³
)) {

79 
	`§veCİyOfPPS
(
fTo
, 
äameSize
);

82 
fPiùu»EndM¬k”
 = 
	`ÇlUn™EndsAcûssUn™
(
Çl_un™_ty³
);

85 
fF¿meSize
 = 
äameSize
;

86 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

87 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

88 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

89 
	`aá”G‘tšg
(
this
);

90 
	}
}

92 
BoŞ—n
 
	gH264Ü5VideoSŒ—mDisü‘eF¿m”
::
	$ÇlUn™EndsAcûssUn™
(
u_št8_t
 
Çl_un™_ty³
) {

101  
	`isVCL
(
Çl_un™_ty³
);

102 
	}
}

	@liveMedia/H264or5VideoStreamFramer.cpp

21 
	~"H264Ü5VideoSŒ—mF¿m”.hh
"

22 
	~"MPEGVideoSŒ—mP¬£r.hh
"

23 
	~"B™VeùÜ.hh
"

27 şas 
	cH264Ü5VideoSŒ—mP¬£r
: 
public
 
MPEGVideoSŒ—mP¬£r
 {

28 
public
:

29 
H264Ü5VideoSŒ—mP¬£r
(
hNumb”
, 
H264Ü5VideoSŒ—mF¿m”
* 
usšgSourû
,

30 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
šşudeS¹CodeInOuut
);

31 
	mvœtu®
 ~
H264Ü5VideoSŒ—mP¬£r
();

33 
	m´iv©e
:

34 
vœtu®
 
æushIÅut
();

35 
vœtu®
 
·r£
();

37 
	m´iv©e
:

38 
H264Ü5VideoSŒ—mF¿m”
* 
	$usšgSourû
() {

39  (
H264Ü5VideoSŒ—mF¿m”
*)
fUsšgSourû
;

42 
BoŞ—n
 
	$isVPS
(
u_št8_t
 
Çl_un™_ty³
è{  
	`usšgSourû
()->
	`isVPS
Ò®_un™_ty³); 
	}
}

43 
BoŞ—n
 
	$isSPS
(
u_št8_t
 
Çl_un™_ty³
è{  
	`usšgSourû
()->
	`isSPS
Ò®_un™_ty³); 
	}
}

44 
BoŞ—n
 
	$isPPS
(
u_št8_t
 
Çl_un™_ty³
è{  
	`usšgSourû
()->
	`isPPS
Ò®_un™_ty³); 
	}
}

45 
BoŞ—n
 
	$isVCL
(
u_št8_t
 
Çl_un™_ty³
è{  
	`usšgSourû
()->
	`isVCL
Ò®_un™_ty³); 
	}
}

46 
BoŞ—n
 
isSEI
(
u_št8_t
 
Çl_un™_ty³
);

47 
BoŞ—n
 
isEOF
(
u_št8_t
 
Çl_un™_ty³
);

48 
BoŞ—n
 
usu®lyBegšsAcûssUn™
(
u_št8_t
 
Çl_un™_ty³
);

50 
»moveEmuÏtiÚBy‹s
(
u_št8_t
* 
ÇlUn™Cİy
, 
maxSize
, & 
ÇlUn™CİySize
);

52 
ª®yze_video_·¿m‘”_£t_d©a
(& 
num_un™s_š_tick
, & 
time_sÿË
);

53 
ª®yze_£q_·¿m‘”_£t_d©a
(& 
num_un™s_š_tick
, & 
time_sÿË
);

54 
´ofe_t›r_Ëv–
(
B™VeùÜ
& 
bv
, 
max_sub_Ïy”s_mšus1
);

55 
ª®yze_vui_·¿m‘”s
(
B™VeùÜ
& 
bv
, & 
num_un™s_š_tick
, & 
time_sÿË
);

56 
ª®yze_hrd_·¿m‘”s
(
B™VeùÜ
& 
bv
);

57 
ª®yze_£i_d©a
(
u_št8_t
 
Çl_un™_ty³
);

58 
ª®yze_£i_·ylßd
(
·ylßdTy³
, 
·ylßdSize
, 
u_št8_t
* 
·ylßd
);

60 
	g´iv©e
:

61 
fHNumb”
;

62 
	gfOuutS¹CodeSize
;

63 
BoŞ—n
 
	gfHaveS“nFœ¡S¹Code
, 
	gfHaveS“nFœ¡By‹OfNALUn™
;

64 
u_št8_t
 
	gfFœ¡By‹OfNALUn™
;

65 
	gfP¬£dF¿meR©e
;

67 
	gıb_»mov®_d–ay_Ëngth_mšus1
, 
	gdpb_ouut_d–ay_Ëngth_mšus1
;

68 
BoŞ—n
 
	gCpbDpbD–aysP»£ÁFÏg
, 
	gpic_¡ruù_´e£Á_æag
;

69 
	gD–TfiDivisÜ
;

75 
	gH264Ü5VideoSŒ—mF¿m”


76 ::
	$H264Ü5VideoSŒ—mF¿m”
(
hNumb”
, 
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

77 
BoŞ—n
 
ü—‹P¬£r
, BoŞ—À
šşudeS¹CodeInOuut
)

78 : 
	`MPEGVideoSŒ—mF¿m”
(
’v
, 
šputSourû
),

79 
	`fHNumb”
(
hNumb”
),

80 
	`fLa¡S“nVPS
(
NULL
), 
	`fLa¡S“nVPSSize
(0),

81 
	`fLa¡S“nSPS
(
NULL
), 
	`fLa¡S“nSPSSize
(0),

82 
	`fLa¡S“nPPS
(
NULL
), 
	$fLa¡S“nPPSSize
(0) {

83 
fP¬£r
 = 
ü—‹P¬£r


84 ? 
Ãw
 
	`H264Ü5VideoSŒ—mP¬£r
(
hNumb”
, 
this
, 
šputSourû
, 
šşudeS¹CodeInOuut
)

85 : 
NULL
;

86 
fNextP»£Á©iÚTime
 = 
fP»£Á©iÚTimeBa£
;

87 
fF¿meR©e
 = 25.0;

88 
	}
}

90 
	gH264Ü5VideoSŒ—mF¿m”
::~
	$H264Ü5VideoSŒ—mF¿m”
() {

91 
d–‘e
[] 
fLa¡S“nPPS
;

92 
d–‘e
[] 
fLa¡S“nSPS
;

93 
d–‘e
[] 
fLa¡S“nVPS
;

94 
	}
}

96 
	#VPS_MAX_SIZE
 1000

97 

	)

98 
	gH264Ü5VideoSŒ—mF¿m”
::
	$§veCİyOfVPS
(
u_št8_t
* 
äom
, 
size
) {

99 ià(
äom
 =ğ
NULL
) ;

100 
d–‘e
[] 
fLa¡S“nVPS
;

101 
fLa¡S“nVPS
 = 
Ãw
 
u_št8_t
[
size
];

102 
	`memmove
(
fLa¡S“nVPS
, 
äom
, 
size
);

104 
fLa¡S“nVPSSize
 = 
size
;

105 
	}
}

107 
	#SPS_MAX_SIZE
 1000

108 

	)

109 
	gH264Ü5VideoSŒ—mF¿m”
::
	$§veCİyOfSPS
(
u_št8_t
* 
äom
, 
size
) {

110 ià(
äom
 =ğ
NULL
) ;

111 
d–‘e
[] 
fLa¡S“nSPS
;

112 
fLa¡S“nSPS
 = 
Ãw
 
u_št8_t
[
size
];

113 
	`memmove
(
fLa¡S“nSPS
, 
äom
, 
size
);

115 
fLa¡S“nSPSSize
 = 
size
;

116 
	}
}

118 
	gH264Ü5VideoSŒ—mF¿m”
::
	$§veCİyOfPPS
(
u_št8_t
* 
äom
, 
size
) {

119 ià(
äom
 =ğ
NULL
) ;

120 
d–‘e
[] 
fLa¡S“nPPS
;

121 
fLa¡S“nPPS
 = 
Ãw
 
u_št8_t
[
size
];

122 
	`memmove
(
fLa¡S“nPPS
, 
äom
, 
size
);

124 
fLa¡S“nPPSSize
 = 
size
;

125 
	}
}

127 
BoŞ—n
 
	gH264Ü5VideoSŒ—mF¿m”
::
	$isVPS
(
u_št8_t
 
Çl_un™_ty³
) {

129  
fHNumb”
 =ğ265 && 
Çl_un™_ty³
 == 32;

130 
	}
}

132 
BoŞ—n
 
	gH264Ü5VideoSŒ—mF¿m”
::
	$isSPS
(
u_št8_t
 
Çl_un™_ty³
) {

133  
fHNumb”
 =ğ264 ? 
Çl_un™_ty³
 == 7 :‚al_unit_type == 33;

134 
	}
}

136 
BoŞ—n
 
	gH264Ü5VideoSŒ—mF¿m”
::
	$isPPS
(
u_št8_t
 
Çl_un™_ty³
) {

137  
fHNumb”
 =ğ264 ? 
Çl_un™_ty³
 == 8 :‚al_unit_type == 34;

138 
	}
}

140 
BoŞ—n
 
	gH264Ü5VideoSŒ—mF¿m”
::
	$isVCL
(
u_št8_t
 
Çl_un™_ty³
) {

141  
fHNumb”
 == 264

142 ? (
Çl_un™_ty³
 <= 5 &&‚al_unit_type > 0)

143 : (
Çl_un™_ty³
 <= 31);

144 
	}
}

149 
	gH264Ü5VideoSŒ—mP¬£r


150 ::
	$H264Ü5VideoSŒ—mP¬£r
(
hNumb”
, 
H264Ü5VideoSŒ—mF¿m”
* 
usšgSourû
,

151 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
šşudeS¹CodeInOuut
)

152 : 
	`MPEGVideoSŒ—mP¬£r
(
usšgSourû
, 
šputSourû
),

153 
	`fHNumb”
(
hNumb”
), 
	`fOuutS¹CodeSize
(
šşudeS¹CodeInOuut
 ? 4 : 0), 
	`fHaveS“nFœ¡S¹Code
(
F®£
), 
	`fHaveS“nFœ¡By‹OfNALUn™
(F®£), 
	`fP¬£dF¿meR©e
(0.0),

154 
	`ıb_»mov®_d–ay_Ëngth_mšus1
(23), 
	`dpb_ouut_d–ay_Ëngth_mšus1
(23),

155 
	`CpbDpbD–aysP»£ÁFÏg
(0), 
	`pic_¡ruù_´e£Á_æag
(0),

156 
	$D–TfiDivisÜ
(2.0) {

157 
	}
}

159 
	gH264Ü5VideoSŒ—mP¬£r
::~
	$H264Ü5VideoSŒ—mP¬£r
() {

160 
	}
}

162 
	#PREFIX_SEI_NUT
 39

163 
	#SUFFIX_SEI_NUT
 40

164 
BoŞ—n
 
H264Ü5VideoSŒ—mP¬£r
::
	`isSEI
(
u_št8_t
 
Çl_un™_ty³
è{

	)

165  
fHNumb”
 == 264

166 ? 
Çl_un™_ty³
 == 6

167 : (
Çl_un™_ty³
 =ğ
PREFIX_SEI_NUT
 ||‚®_un™_ty³ =ğ
SUFFIX_SEI_NUT
);

170 
BoŞ—n
 
	gH264Ü5VideoSŒ—mP¬£r
::
	$isEOF
(
u_št8_t
 
Çl_un™_ty³
) {

172  
fHNumb”
 == 264

173 ? (
Çl_un™_ty³
 == 10 ||‚al_unit_type == 11)

174 : (
Çl_un™_ty³
 == 36 ||‚al_unit_type == 37);

175 
	}
}

177 
BoŞ—n
 
	gH264Ü5VideoSŒ—mP¬£r
::
	$usu®lyBegšsAcûssUn™
(
u_št8_t
 
Çl_un™_ty³
) {

178  
fHNumb”
 == 264

179 ? (
Çl_un™_ty³
 >= 6 &&‚al_unit_type <= 9) || (nal_unit_type >= 14 &&‚al_unit_type <= 18)

180 : (
Çl_un™_ty³
 >= 32 &&‚al_unit_type <= 35) || (nal_unit_type == 39)

181 || (
Çl_un™_ty³
 >= 41 &&‚al_unit_type <= 44)

182 || (
Çl_un™_ty³
 >= 48 &&‚al_unit_type <= 55);

183 
	}
}

185 
	gH264Ü5VideoSŒ—mP¬£r


186 ::
	$»moveEmuÏtiÚBy‹s
(
u_št8_t
* 
ÇlUn™Cİy
, 
maxSize
, & 
ÇlUn™CİySize
) {

187 
u_št8_t
* 
ÇlUn™Orig
 = 
fS¹OfF¿me
 + 
fOuutS¹CodeSize
;

188 cÚ¡ 
numBy‹sInNALun™
 = 
fTo
 - 
ÇlUn™Orig
;

189 
ÇlUn™CİySize


190 ğ
	`»moveH264Ü5EmuÏtiÚBy‹s
(
ÇlUn™Cİy
, 
maxSize
, 
ÇlUn™Orig
, 
numBy‹sInNALun™
);

191 
	}
}

193 #ifdeà
DEBUG


194 cÚ¡* 
	gÇl_un™_ty³_desütiÚ_h264
[32] = {

228 cÚ¡* 
	gÇl_un™_ty³_desütiÚ_h265
[64] = {

296 #ifdeà
DEBUG


297 
	gnumDebugTabs
 = 1;

298 
	#DEBUG_PRINT_TABS
 
_i
 = 0; _˜< 
numDebugTabs
; ++_iè
	`årštf
(
¡d”r
, "\t")

	)

299 
	#DEBUG_PRINT
(
x
èdØ{ 
DEBUG_PRINT_TABS
; 
	`årštf
(
¡d”r
, "%s: %d\n", #x, x); } 0)

	)

300 
	#DEBUG_STR
(
x
èdØ{ 
DEBUG_PRINT_TABS
; 
	`årštf
(
¡d”r
, "%s\n", x); } 0)

	)

301 şas 
	cDebugTab
 {

302 
	mpublic
:

303 
	$DebugTab
(è{++
numDebugTabs
;}

304 ~
	$DebugTab
(è{--
numDebugTabs
;
	}
}

306 
	#DEBUG_TAB
 
DebugTab
 
dummy


	)

308 
	#DEBUG_PRINT
(
x
èdØ{x = x;} 0)

	)

310 
	#DEBUG_STR
(
x
èdØ{} 0)

	)

311 
	#DEBUG_TAB
 dØ{} 0)

	)

314 
	gH264Ü5VideoSŒ—mP¬£r
::
	$´ofe_t›r_Ëv–
(
B™VeùÜ
& 
bv
, 
max_sub_Ïy”s_mšus1
) {

315 
bv
.
	`skB™s
(96);

317 
i
;

318 
BoŞ—n
 
sub_Ïy”_´ofe_´e£Á_æag
[7], 
sub_Ïy”_Ëv–_´e£Á_æag
[7];

319 
i
 = 0; i < 
max_sub_Ïy”s_mšus1
; ++i) {

320 
sub_Ïy”_´ofe_´e£Á_æag
[
i
] = 
bv
.
	`g‘1B™BoŞ—n
();

321 
sub_Ïy”_Ëv–_´e£Á_æag
[
i
] = 
bv
.
	`g‘1B™BoŞ—n
();

323 ià(
max_sub_Ïy”s_mšus1
 > 0) {

324 
bv
.
	`skB™s
(2*(8-
max_sub_Ïy”s_mšus1
));

326 
i
 = 0; i < 
max_sub_Ïy”s_mšus1
; ++i) {

327 ià(
sub_Ïy”_´ofe_´e£Á_æag
[
i
]) {

328 
bv
.
	`skB™s
(88);

330 ià(
sub_Ïy”_Ëv–_´e£Á_æag
[
i
]) {

331 
bv
.
	`skB™s
(8);

334 
	}
}

336 
	gH264Ü5VideoSŒ—mP¬£r


337 ::
	$ª®yze_vui_·¿m‘”s
(
B™VeùÜ
& 
bv
,

338 & 
num_un™s_š_tick
, & 
time_sÿË
) {

339 
BoŞ—n
 
a¥eù_¿tio_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

340 
	`DEBUG_PRINT
(
a¥eù_¿tio_šfo_´e£Á_æag
);

341 ià(
a¥eù_¿tio_šfo_´e£Á_æag
) {

342 
DEBUG_TAB
;

343 
a¥eù_¿tio_idc
 = 
bv
.
	`g‘B™s
(8);

344 
	`DEBUG_PRINT
(
a¥eù_¿tio_idc
);

345 ià(
a¥eù_¿tio_idc
 == 255 ) {

346 
bv
.
	`skB™s
(32);

349 
BoŞ—n
 
ov”sÿn_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

350 
	`DEBUG_PRINT
(
ov”sÿn_šfo_´e£Á_æag
);

351 ià(
ov”sÿn_šfo_´e£Á_æag
) {

352 
bv
.
	`skB™s
(1);

354 
BoŞ—n
 
video_sigÇl_ty³_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

355 
	`DEBUG_PRINT
(
video_sigÇl_ty³_´e£Á_æag
);

356 ià(
video_sigÇl_ty³_´e£Á_æag
) {

357 
DEBUG_TAB
;

358 
bv
.
	`skB™s
(4);

359 
BoŞ—n
 
cŞour_desütiÚ_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

360 
	`DEBUG_PRINT
(
cŞour_desütiÚ_´e£Á_æag
);

361 ià(
cŞour_desütiÚ_´e£Á_æag
) {

362 
bv
.
	`skB™s
(24);

365 
BoŞ—n
 
chroma_loc_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

366 
	`DEBUG_PRINT
(
chroma_loc_šfo_´e£Á_æag
);

367 ià(
chroma_loc_šfo_´e£Á_æag
) {

368 ()
bv
.
	`g‘_expGŞomb
();

369 ()
bv
.
	`g‘_expGŞomb
();

371 ià(
fHNumb”
 == 265) {

372 
bv
.
	`skB™s
(2);

373 
BoŞ—n
 
äame_f›ld_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

374 
	`DEBUG_PRINT
(
äame_f›ld_šfo_´e£Á_æag
);

375 
pic_¡ruù_´e£Á_æag
 = 
äame_f›ld_šfo_´e£Á_æag
;

376 
BoŞ—n
 
deçuÉ_di¥Ïy_wšdow_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

377 
	`DEBUG_PRINT
(
deçuÉ_di¥Ïy_wšdow_æag
);

378 ià(
deçuÉ_di¥Ïy_wšdow_æag
) {

379 ()
bv
.
	`g‘_expGŞomb
();

380 ()
bv
.
	`g‘_expGŞomb
();

381 ()
bv
.
	`g‘_expGŞomb
();

382 ()
bv
.
	`g‘_expGŞomb
();

385 
BoŞ—n
 
timšg_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

386 
	`DEBUG_PRINT
(
timšg_šfo_´e£Á_æag
);

387 ià(
timšg_šfo_´e£Á_æag
) {

388 
DEBUG_TAB
;

389 
num_un™s_š_tick
 = 
bv
.
	`g‘B™s
(32);

390 
	`DEBUG_PRINT
(
num_un™s_š_tick
);

391 
time_sÿË
 = 
bv
.
	`g‘B™s
(32);

392 
	`DEBUG_PRINT
(
time_sÿË
);

393 ià(
fHNumb”
 == 264) {

394 
BoŞ—n
 
fixed_äame_¿‹_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

395 
	`DEBUG_PRINT
(
fixed_äame_¿‹_æag
);

397 
BoŞ—n
 
vui_poc_´İÜtiÚ®_to_timšg_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

398 
	`DEBUG_PRINT
(
vui_poc_´İÜtiÚ®_to_timšg_æag
);

399 ià(
vui_poc_´İÜtiÚ®_to_timšg_æag
) {

400 
vui_num_ticks_poc_diff_Úe_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

401 
	`DEBUG_PRINT
(
vui_num_ticks_poc_diff_Úe_mšus1
);

407 
BoŞ—n
 
Çl_hrd_·¿m‘”s_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

408 
	`DEBUG_PRINT
(
Çl_hrd_·¿m‘”s_´e£Á_æag
);

409 ià(
Çl_hrd_·¿m‘”s_´e£Á_æag
è
	`ª®yze_hrd_·¿m‘”s
(
bv
);

410 
BoŞ—n
 
vş_hrd_·¿m‘”s_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

411 
	`DEBUG_PRINT
(
vş_hrd_·¿m‘”s_´e£Á_æag
);

412 ià(
vş_hrd_·¿m‘”s_´e£Á_æag
è
	`ª®yze_hrd_·¿m‘”s
(
bv
);

413 
CpbDpbD–aysP»£ÁFÏg
 = 
Çl_hrd_·¿m‘”s_´e£Á_æag
 || 
vş_hrd_·¿m‘”s_´e£Á_æag
;

414 ià(
CpbDpbD–aysP»£ÁFÏg
) {

415 
bv
.
	`skB™s
(1);

417 
pic_¡ruù_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

418 
	`DEBUG_PRINT
(
pic_¡ruù_´e£Á_æag
);

419 
	}
}

421 
	gH264Ü5VideoSŒ—mP¬£r
::
	$ª®yze_hrd_·¿m‘”s
(
B™VeùÜ
& 
bv
) {

422 
DEBUG_TAB
;

423 
ıb_út_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

424 
	`DEBUG_PRINT
(
ıb_út_mšus1
);

425 
b™_¿‹_sÿË
 = 
bv
.
	`g‘B™s
(4);

426 
	`DEBUG_PRINT
(
b™_¿‹_sÿË
);

427 
ıb_size_sÿË
 = 
bv
.
	`g‘B™s
(4);

428 
	`DEBUG_PRINT
(
ıb_size_sÿË
);

429 
SchedS–Idx
 = 0; SchedS–Idx <ğ
ıb_út_mšus1
; ++SchedSelIdx) {

430 
DEBUG_TAB
;

431 
	`DEBUG_PRINT
(
SchedS–Idx
);

432 
b™_¿‹_v®ue_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

433 
	`DEBUG_PRINT
(
b™_¿‹_v®ue_mšus1
);

434 
ıb_size_v®ue_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

435 
	`DEBUG_PRINT
(
ıb_size_v®ue_mšus1
);

436 
BoŞ—n
 
cbr_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

437 
	`DEBUG_PRINT
(
cbr_æag
);

439 
š™Ÿl_ıb_»mov®_d–ay_Ëngth_mšus1
 = 
bv
.
	`g‘B™s
(5);

440 
	`DEBUG_PRINT
(
š™Ÿl_ıb_»mov®_d–ay_Ëngth_mšus1
);

441 
ıb_»mov®_d–ay_Ëngth_mšus1
 = 
bv
.
	`g‘B™s
(5);

442 
	`DEBUG_PRINT
(
ıb_»mov®_d–ay_Ëngth_mšus1
);

443 
dpb_ouut_d–ay_Ëngth_mšus1
 = 
bv
.
	`g‘B™s
(5);

444 
	`DEBUG_PRINT
(
dpb_ouut_d–ay_Ëngth_mšus1
);

445 
time_off£t_Ëngth
 = 
bv
.
	`g‘B™s
(5);

446 
	`DEBUG_PRINT
(
time_off£t_Ëngth
);

447 
	}
}

449 
	gH264Ü5VideoSŒ—mP¬£r


450 ::
	$ª®yze_video_·¿m‘”_£t_d©a
(& 
num_un™s_š_tick
, & 
time_sÿË
) {

451 
num_un™s_š_tick
 = 
time_sÿË
 = 0;

454 
u_št8_t
 
vps
[
VPS_MAX_SIZE
];

455 
vpsSize
;

456 
	`»moveEmuÏtiÚBy‹s
(
vps
,  vps, 
vpsSize
);

458 
B™VeùÜ
 
	`bv
(
vps
, 0, 8*
vpsSize
);

461 
i
;

463 
bv
.
	`skB™s
(28);

464 
vps_max_sub_Ïy”s_mšus1
 = 
bv
.
	`g‘B™s
(3);

465 
	`DEBUG_PRINT
(
vps_max_sub_Ïy”s_mšus1
);

466 
bv
.
	`skB™s
(17);

467 
	`´ofe_t›r_Ëv–
(
bv
, 
vps_max_sub_Ïy”s_mšus1
);

468 
BoŞ—n
 
vps_sub_Ïy”_Üd”šg_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

469 
	`DEBUG_PRINT
(
vps_sub_Ïy”_Üd”šg_šfo_´e£Á_æag
);

470 
i
 = 
vps_sub_Ïy”_Üd”šg_šfo_´e£Á_æag
 ? 0 : 
vps_max_sub_Ïy”s_mšus1
;

471 
i
 <ğ
vps_max_sub_Ïy”s_mšus1
; ++i) {

472 ()
bv
.
	`g‘_expGŞomb
();

473 ()
bv
.
	`g‘_expGŞomb
();

474 ()
bv
.
	`g‘_expGŞomb
();

476 
vps_max_Ïy”_id
 = 
bv
.
	`g‘B™s
(6);

477 
	`DEBUG_PRINT
(
vps_max_Ïy”_id
);

478 
vps_num_Ïy”_£ts_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

479 
	`DEBUG_PRINT
(
vps_num_Ïy”_£ts_mšus1
);

480 
i
 = 1; i <ğ
vps_num_Ïy”_£ts_mšus1
; ++i) {

481 
bv
.
	`skB™s
(
vps_max_Ïy”_id
+1);

483 
BoŞ—n
 
vps_timšg_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

484 
	`DEBUG_PRINT
(
vps_timšg_šfo_´e£Á_æag
);

485 ià(
vps_timšg_šfo_´e£Á_æag
) {

486 
DEBUG_TAB
;

487 
num_un™s_š_tick
 = 
bv
.
	`g‘B™s
(32);

488 
	`DEBUG_PRINT
(
num_un™s_š_tick
);

489 
time_sÿË
 = 
bv
.
	`g‘B™s
(32);

490 
	`DEBUG_PRINT
(
time_sÿË
);

491 
BoŞ—n
 
vps_poc_´İÜtiÚ®_to_timšg_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

492 
	`DEBUG_PRINT
(
vps_poc_´İÜtiÚ®_to_timšg_æag
);

493 ià(
vps_poc_´İÜtiÚ®_to_timšg_æag
) {

494 
vps_num_ticks_poc_diff_Úe_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

495 
	`DEBUG_PRINT
(
vps_num_ticks_poc_diff_Úe_mšus1
);

498 
BoŞ—n
 
vps_ex‹nsiÚ_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

499 
	`DEBUG_PRINT
(
vps_ex‹nsiÚ_æag
);

500 
	}
}

502 
	gH264Ü5VideoSŒ—mP¬£r


503 ::
	$ª®yze_£q_·¿m‘”_£t_d©a
(& 
num_un™s_š_tick
, & 
time_sÿË
) {

504 
num_un™s_š_tick
 = 
time_sÿË
 = 0;

507 
u_št8_t
 
¥s
[
SPS_MAX_SIZE
];

508 
¥sSize
;

509 
	`»moveEmuÏtiÚBy‹s
(
¥s
,  sps, 
¥sSize
);

511 
B™VeùÜ
 
	`bv
(
¥s
, 0, 8*
¥sSize
);

513 ià(
fHNumb”
 == 264) {

514 
bv
.
	`skB™s
(8);

515 
´ofe_idc
 = 
bv
.
	`g‘B™s
(8);

516 
	`DEBUG_PRINT
(
´ofe_idc
);

517 
cÚ¡¿št_£tN_æag
 = 
bv
.
	`g‘B™s
(8);

518 
	`DEBUG_PRINT
(
cÚ¡¿št_£tN_æag
);

519 
Ëv–_idc
 = 
bv
.
	`g‘B™s
(8);

520 
	`DEBUG_PRINT
(
Ëv–_idc
);

521 
£q_·¿m‘”_£t_id
 = 
bv
.
	`g‘_expGŞomb
();

522 
	`DEBUG_PRINT
(
£q_·¿m‘”_£t_id
);

523 ià(
´ofe_idc
 == 100 ||…rofile_idc == 110 ||…rofile_idc == 122 ||…rofile_idc == 244 ||…rofile_idc == 44 ||…rofile_idc == 83 ||…rofile_idc == 86 ||…rofile_idc == 118 ||…rofile_idc == 128 ) {

524 
DEBUG_TAB
;

525 
chroma_fÜm©_idc
 = 
bv
.
	`g‘_expGŞomb
();

526 
	`DEBUG_PRINT
(
chroma_fÜm©_idc
);

527 ià(
chroma_fÜm©_idc
 == 3) {

528 
DEBUG_TAB
;

529 
BoŞ—n
 
£·¿‹_cŞour_¶ªe_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

530 
	`DEBUG_PRINT
(
£·¿‹_cŞour_¶ªe_æag
);

532 ()
bv
.
	`g‘_expGŞomb
();

533 ()
bv
.
	`g‘_expGŞomb
();

534 
bv
.
	`skB™s
(1);

535 
BoŞ—n
 
£q_sÿlšg_m©rix_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

536 
	`DEBUG_PRINT
(
£q_sÿlšg_m©rix_´e£Á_æag
);

537 ià(
£q_sÿlšg_m©rix_´e£Á_æag
) {

538 
i
 = 0; i < ((
chroma_fÜm©_idc
 != 3) ? 8 : 12); ++i) {

539 
DEBUG_TAB
;

540 
	`DEBUG_PRINT
(
i
);

541 
BoŞ—n
 
£q_sÿlšg_li¡_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

542 
	`DEBUG_PRINT
(
£q_sÿlšg_li¡_´e£Á_æag
);

543 ià(
£q_sÿlšg_li¡_´e£Á_æag
) {

544 
DEBUG_TAB
;

545 
sizeOfSÿlšgLi¡
 = 
i
 < 6 ? 16 : 64;

546 
Ï¡SÿË
 = 8;

547 
ÃxtSÿË
 = 8;

548 
j
 = 0; j < 
sizeOfSÿlšgLi¡
; ++j) {

549 
DEBUG_TAB
;

550 
	`DEBUG_PRINT
(
j
);

551 
	`DEBUG_PRINT
(
ÃxtSÿË
);

552 ià(
ÃxtSÿË
 != 0) {

553 
DEBUG_TAB
;

554 
d–_sÿË
 = 
bv
.
	`g‘_expGŞomb
();

555 
	`DEBUG_PRINT
(
d–_sÿË
);

556 
ÃxtSÿË
 = (
Ï¡SÿË
 + 
d–_sÿË
 + 256) % 256;

558 
Ï¡SÿË
 = (
ÃxtSÿË
 == 0) ?†astScale :‚extScale;

559 
	`DEBUG_PRINT
(
Ï¡SÿË
);

565 
log2_max_äame_num_mšus4
 = 
bv
.
	`g‘_expGŞomb
();

566 
	`DEBUG_PRINT
(
log2_max_äame_num_mšus4
);

567 
pic_Üd”_út_ty³
 = 
bv
.
	`g‘_expGŞomb
();

568 
	`DEBUG_PRINT
(
pic_Üd”_út_ty³
);

569 ià(
pic_Üd”_út_ty³
 == 0) {

570 
DEBUG_TAB
;

571 
log2_max_pic_Üd”_út_lsb_mšus4
 = 
bv
.
	`g‘_expGŞomb
();

572 
	`DEBUG_PRINT
(
log2_max_pic_Üd”_út_lsb_mšus4
);

573 } ià(
pic_Üd”_út_ty³
 == 1) {

574 
DEBUG_TAB
;

575 
bv
.
	`skB™s
(1);

576 ()
bv
.
	`g‘_expGŞomb
();

577 ()
bv
.
	`g‘_expGŞomb
();

578 
num_»f_äames_š_pic_Üd”_út_cyşe
 = 
bv
.
	`g‘_expGŞomb
();

579 
	`DEBUG_PRINT
(
num_»f_äames_š_pic_Üd”_út_cyşe
);

580 
i
 = 0; i < 
num_»f_äames_š_pic_Üd”_út_cyşe
; ++i) {

581 ()
bv
.
	`g‘_expGŞomb
();

584 
max_num_»f_äames
 = 
bv
.
	`g‘_expGŞomb
();

585 
	`DEBUG_PRINT
(
max_num_»f_äames
);

586 
BoŞ—n
 
g­s_š_äame_num_v®ue_®lowed_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

587 
	`DEBUG_PRINT
(
g­s_š_äame_num_v®ue_®lowed_æag
);

588 
pic_width_š_mbs_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

589 
	`DEBUG_PRINT
(
pic_width_š_mbs_mšus1
);

590 
pic_height_š_m­_un™s_mšus1
 = 
bv
.
	`g‘_expGŞomb
();

591 
	`DEBUG_PRINT
(
pic_height_š_m­_un™s_mšus1
);

592 
BoŞ—n
 
äame_mbs_Úly_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

593 
	`DEBUG_PRINT
(
äame_mbs_Úly_æag
);

594 ià(!
äame_mbs_Úly_æag
) {

595 
bv
.
	`skB™s
(1);

597 
bv
.
	`skB™s
(1);

598 
BoŞ—n
 
äame_üİpšg_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

599 
	`DEBUG_PRINT
(
äame_üİpšg_æag
);

600 ià(
äame_üİpšg_æag
) {

601 ()
bv
.
	`g‘_expGŞomb
();

602 ()
bv
.
	`g‘_expGŞomb
();

603 ()
bv
.
	`g‘_expGŞomb
();

604 ()
bv
.
	`g‘_expGŞomb
();

606 
BoŞ—n
 
vui_·¿m‘”s_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

607 
	`DEBUG_PRINT
(
vui_·¿m‘”s_´e£Á_æag
);

608 ià(
vui_·¿m‘”s_´e£Á_æag
) {

609 
DEBUG_TAB
;

610 
	`ª®yze_vui_·¿m‘”s
(
bv
, 
num_un™s_š_tick
, 
time_sÿË
);

613 
i
;

615 
bv
.
	`skB™s
(16);

616 
bv
.
	`skB™s
(4);

617 
¥s_max_sub_Ïy”s_mšus1
 = 
bv
.
	`g‘B™s
(3);

618 
	`DEBUG_PRINT
(
¥s_max_sub_Ïy”s_mšus1
);

619 
bv
.
	`skB™s
(1);

620 
	`´ofe_t›r_Ëv–
(
bv
, 
¥s_max_sub_Ïy”s_mšus1
);

621 ()
bv
.
	`g‘_expGŞomb
();

622 
chroma_fÜm©_idc
 = 
bv
.
	`g‘_expGŞomb
();

623 
	`DEBUG_PRINT
(
chroma_fÜm©_idc
);

624 ià(
chroma_fÜm©_idc
 =ğ3è
bv
.
	`skB™s
(1);

625 
pic_width_š_luma_§m¶es
 = 
bv
.
	`g‘_expGŞomb
();

626 
	`DEBUG_PRINT
(
pic_width_š_luma_§m¶es
);

627 
pic_height_š_luma_§m¶es
 = 
bv
.
	`g‘_expGŞomb
();

628 
	`DEBUG_PRINT
(
pic_height_š_luma_§m¶es
);

629 
BoŞ—n
 
cÚfÜmªû_wšdow_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

630 
	`DEBUG_PRINT
(
cÚfÜmªû_wšdow_æag
);

631 ià(
cÚfÜmªû_wšdow_æag
) {

632 
DEBUG_TAB
;

633 
cÚf_wš_Ëá_off£t
 = 
bv
.
	`g‘_expGŞomb
();

634 
	`DEBUG_PRINT
(
cÚf_wš_Ëá_off£t
);

635 
cÚf_wš_right_off£t
 = 
bv
.
	`g‘_expGŞomb
();

636 
	`DEBUG_PRINT
(
cÚf_wš_right_off£t
);

637 
cÚf_wš_tİ_off£t
 = 
bv
.
	`g‘_expGŞomb
();

638 
	`DEBUG_PRINT
(
cÚf_wš_tİ_off£t
);

639 
cÚf_wš_bÙtom_off£t
 = 
bv
.
	`g‘_expGŞomb
();

640 
	`DEBUG_PRINT
(
cÚf_wš_bÙtom_off£t
);

642 ()
bv
.
	`g‘_expGŞomb
();

643 ()
bv
.
	`g‘_expGŞomb
();

644 
log2_max_pic_Üd”_út_lsb_mšus4
 = 
bv
.
	`g‘_expGŞomb
();

645 
BoŞ—n
 
¥s_sub_Ïy”_Üd”šg_šfo_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

646 
	`DEBUG_PRINT
(
¥s_sub_Ïy”_Üd”šg_šfo_´e£Á_æag
);

647 
i
 = (
¥s_sub_Ïy”_Üd”šg_šfo_´e£Á_æag
 ? 0 : 
¥s_max_sub_Ïy”s_mšus1
);

648 
i
 <ğ
¥s_max_sub_Ïy”s_mšus1
; ++i) {

649 ()
bv
.
	`g‘_expGŞomb
();

650 ()
bv
.
	`g‘_expGŞomb
();

651 ()
bv
.
	`g‘_expGŞomb
();

653 ()
bv
.
	`g‘_expGŞomb
();

654 ()
bv
.
	`g‘_expGŞomb
();

655 ()
bv
.
	`g‘_expGŞomb
();

656 ()
bv
.
	`g‘_expGŞomb
();

657 ()
bv
.
	`g‘_expGŞomb
();

658 ()
bv
.
	`g‘_expGŞomb
();

659 
BoŞ—n
 
sÿlšg_li¡_’abËd_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

660 
	`DEBUG_PRINT
(
sÿlšg_li¡_’abËd_æag
);

661 ià(
sÿlšg_li¡_’abËd_æag
) {

662 
DEBUG_TAB
;

663 
BoŞ—n
 
¥s_sÿlšg_li¡_d©a_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

664 
	`DEBUG_PRINT
(
¥s_sÿlšg_li¡_d©a_´e£Á_æag
);

665 ià(
¥s_sÿlšg_li¡_d©a_´e£Á_æag
) {

667 
DEBUG_TAB
;

668 
sizeId
 = 0; sizeId < 4; ++sizeId) {

669 
	`DEBUG_PRINT
(
sizeId
);

670 
m©rixId
 = 0; m©rixId < (
sizeId
 == 3 ? 2 : 6); ++matrixId) {

671 
DEBUG_TAB
;

672 
	`DEBUG_PRINT
(
m©rixId
);

673 
BoŞ—n
 
sÿlšg_li¡_´ed_mode_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

674 
	`DEBUG_PRINT
(
sÿlšg_li¡_´ed_mode_æag
);

675 ià(!
sÿlšg_li¡_´ed_mode_æag
) {

676 ()
bv
.
	`g‘_expGŞomb
();

678 cÚ¡ 
c
 = 1 << (4+(
sizeId
<<1));

679 
cÛfNum
 = 
c
 < 64 ? c : 64;

680 ià(
sizeId
 > 1) {

681 ()
bv
.
	`g‘_expGŞomb
();

683 
i
 = 0; i < 
cÛfNum
; ++i) {

684 ()
bv
.
	`g‘_expGŞomb
();

691 
bv
.
	`skB™s
(2);

692 
BoŞ—n
 
pcm_’abËd_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

693 
	`DEBUG_PRINT
(
pcm_’abËd_æag
);

694 ià(
pcm_’abËd_æag
) {

695 
bv
.
	`skB™s
(8);

696 ()
bv
.
	`g‘_expGŞomb
();

697 ()
bv
.
	`g‘_expGŞomb
();

698 
bv
.
	`skB™s
(1);

700 
num_shÜt_‹rm_»f_pic_£ts
 = 
bv
.
	`g‘_expGŞomb
();

701 
	`DEBUG_PRINT
(
num_shÜt_‹rm_»f_pic_£ts
);

702 
num_Ãg©ive_pics
 = 0, 
´ev_num_Ãg©ive_pics
 = 0;

703 
num_pos™ive_pics
 = 0, 
´ev_num_pos™ive_pics
 = 0;

704 
i
 = 0; i < 
num_shÜt_‹rm_»f_pic_£ts
; ++i) {

706 
DEBUG_TAB
;

707 
	`DEBUG_PRINT
(
i
);

708 
BoŞ—n
 
š‹r_»f_pic_£t_´ediùiÚ_æag
 = 
F®£
;

709 ià(
i
 != 0) {

710 
š‹r_»f_pic_£t_´ediùiÚ_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

712 
	`DEBUG_PRINT
(
š‹r_»f_pic_£t_´ediùiÚ_æag
);

713 ià(
š‹r_»f_pic_£t_´ediùiÚ_æag
) {

714 
DEBUG_TAB
;

715 ià(
i
 =ğ
num_shÜt_‹rm_»f_pic_£ts
) {

717 ()
bv
.
	`g‘_expGŞomb
();

719 
bv
.
	`skB™s
(1);

720 ()
bv
.
	`g‘_expGŞomb
();

721 
NumD–Pocs
 = 
´ev_num_Ãg©ive_pics
 + 
´ev_num_pos™ive_pics
;

722 
j
 = 0; j < 
NumD–Pocs
; ++j) {

723 
	`DEBUG_PRINT
(
j
);

724 
BoŞ—n
 
u£d_by_cu¼_pic_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

725 
	`DEBUG_PRINT
(
u£d_by_cu¼_pic_æag
);

726 ià(!
u£d_by_cu¼_pic_æag
è
bv
.
	`skB™s
(1);

729 
´ev_num_Ãg©ive_pics
 = 
num_Ãg©ive_pics
;

730 
num_Ãg©ive_pics
 = 
bv
.
	`g‘_expGŞomb
();

731 
	`DEBUG_PRINT
(
num_Ãg©ive_pics
);

732 
´ev_num_pos™ive_pics
 = 
num_pos™ive_pics
;

733 
num_pos™ive_pics
 = 
bv
.
	`g‘_expGŞomb
();

734 
	`DEBUG_PRINT
(
num_pos™ive_pics
);

735 
k
;

736 
k
 = 0; k < 
num_Ãg©ive_pics
; ++k) {

737 ()
bv
.
	`g‘_expGŞomb
();

738 
bv
.
	`skB™s
(1);

740 
k
 = 0; k < 
num_pos™ive_pics
; ++k) {

741 ()
bv
.
	`g‘_expGŞomb
();

742 
bv
.
	`skB™s
(1);

746 
BoŞ—n
 
lÚg_‹rm_»f_pics_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

747 
	`DEBUG_PRINT
(
lÚg_‹rm_»f_pics_´e£Á_æag
);

748 ià(
lÚg_‹rm_»f_pics_´e£Á_æag
) {

749 
DEBUG_TAB
;

750 
num_lÚg_‹rm_»f_pics_¥s
 = 
bv
.
	`g‘_expGŞomb
();

751 
	`DEBUG_PRINT
(
num_lÚg_‹rm_»f_pics_¥s
);

752 
i
 = 0; i < 
num_lÚg_‹rm_»f_pics_¥s
; ++i) {

753 
bv
.
	`skB™s
(
log2_max_pic_Üd”_út_lsb_mšus4
);

754 
bv
.
	`skB™s
(1);

757 
bv
.
	`skB™s
(2);

758 
BoŞ—n
 
vui_·¿m‘”s_´e£Á_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

759 
	`DEBUG_PRINT
(
vui_·¿m‘”s_´e£Á_æag
);

760 ià(
vui_·¿m‘”s_´e£Á_æag
) {

761 
DEBUG_TAB
;

762 
	`ª®yze_vui_·¿m‘”s
(
bv
, 
num_un™s_š_tick
, 
time_sÿË
);

764 
BoŞ—n
 
¥s_ex‹nsiÚ_æag
 = 
bv
.
	`g‘1B™BoŞ—n
();

765 
	`DEBUG_PRINT
(
¥s_ex‹nsiÚ_æag
);

767 
	}
}

769 
	#SEI_MAX_SIZE
 5000

770 

	)

771 #ifdeà
DEBUG


772 
	#MAX_SEI_PAYLOAD_TYPE_DESCRIPTION_H264
 46

	)

773 cÚ¡* 
	g£i_·ylßdTy³_desütiÚ_h264
[
MAX_SEI_PAYLOAD_TYPE_DESCRIPTION_H264
+1] = {

824 
	gH264Ü5VideoSŒ—mP¬£r
::
	$ª®yze_£i_d©a
(
u_št8_t
 
Çl_un™_ty³
) {

826 
u_št8_t
 
£i
[
SEI_MAX_SIZE
];

827 
£iSize
;

828 
	`»moveEmuÏtiÚBy‹s
(
£i
,  sei, 
£iSize
);

830 
j
 = 1;

831 
j
 < 
£iSize
) {

832 
·ylßdTy³
 = 0;

834 
·ylßdTy³
 +ğ
£i
[
j
];

835 } 
£i
[
j
++] =ğ255 && j < 
£iSize
);

836 ià(
j
 >ğ
£iSize
) ;

838 
·ylßdSize
 = 0;

840 
·ylßdSize
 +ğ
£i
[
j
];

841 } 
£i
[
j
++] =ğ255 && j < 
£iSize
);

842 ià(
j
 >ğ
£iSize
) ;

844 #ifdeà
DEBUG


845 cÚ¡* 
desütiÚ
;

846 ià(
fHNumb”
 == 264) {

847 
desütiÚNum
 = 
·ylßdTy³
 <ğ
MAX_SEI_PAYLOAD_TYPE_DESCRIPTION_H264


848 ? 
·ylßdTy³
 : 
MAX_SEI_PAYLOAD_TYPE_DESCRIPTION_H264
;

849 
desütiÚ
 = 
£i_·ylßdTy³_desütiÚ_h264
[
desütiÚNum
];

851 
desütiÚ
 =

852 
·ylßdTy³
 == 3 ? "filler_payload" :

853 
·ylßdTy³
 == 4 ? "user_data_registered_itu_t_t35" :

854 
·ylßdTy³
 == 5 ? "user_data_unregistered" :

855 
·ylßdTy³
 == 17 ? "progressive_refinement_segment_end" :

856 
·ylßdTy³
 == 22 ? "post_filter_hint" :

857 (
·ylßdTy³
 =ğ132 && 
Çl_un™_ty³
 =ğ
SUFFIX_SEI_NUT
) ? "decoded_picture_hash" :

858 
Çl_un™_ty³
 =ğ
SUFFIX_SEI_NUT
 ? "reserved_sei_message" :

859 
·ylßdTy³
 == 0 ? "buffering_period" :

860 
·ylßdTy³
 == 1 ? "pic_timing" :

861 
·ylßdTy³
 == 2 ? "pan_scan_rect" :

862 
·ylßdTy³
 == 6 ? "recovery_point" :

863 
·ylßdTy³
 == 9 ? "scene_info" :

864 
·ylßdTy³
 == 15 ? "picture_snapshot" :

865 
·ylßdTy³
 == 16 ? "progressive_refinement_segment_start" :

866 
·ylßdTy³
 == 19 ? "film_grain_characteristics" :

867 
·ylßdTy³
 == 23 ? "tone_mapping_info" :

868 
·ylßdTy³
 == 45 ? "frame_packing_arrangement" :

869 
·ylßdTy³
 == 47 ? "display_orientation" :

870 
·ylßdTy³
 == 128 ? "structure_of_pictures_info" :

871 
·ylßdTy³
 == 129 ? "active_parameter_sets" :

872 
·ylßdTy³
 == 130 ? "decoding_unit_info" :

873 
·ylßdTy³
 == 131 ? "temporal_sub_layer_zero_index" :

874 
·ylßdTy³
 == 133 ? "scalable_nesting" :

875 
·ylßdTy³
 == 134 ? "region_refresh_info" : "reserved_sei_message";

877 
	`årštf
(
¡d”r
, "\aylßdTy³ %d (\"%s\");…aylßdSiz%d\n", 
·ylßdTy³
, 
desütiÚ
, 
·ylßdSize
);

880 
	`ª®yze_£i_·ylßd
(
·ylßdTy³
, 
·ylßdSize
, &
£i
[
j
]);

881 
j
 +ğ
·ylßdSize
;

883 
	}
}

885 
	gH264Ü5VideoSŒ—mP¬£r


886 ::
	$ª®yze_£i_·ylßd
(
·ylßdTy³
, 
·ylßdSize
, 
u_št8_t
* 
·ylßd
) {

887 ià(
·ylßdTy³
 == 1 ) {

888 
B™VeùÜ
 
	`bv
(
·ylßd
, 0, 8*
·ylßdSize
);

890 
DEBUG_TAB
;

891 ià(
CpbDpbD–aysP»£ÁFÏg
) {

892 
ıb_»mov®_d–ay
 = 
bv
.
	`g‘B™s
(
ıb_»mov®_d–ay_Ëngth_mšus1
 + 1);

893 
	`DEBUG_PRINT
(
ıb_»mov®_d–ay
);

894 
dpb_ouut_d–ay
 = 
bv
.
	`g‘B™s
(
dpb_ouut_d–ay_Ëngth_mšus1
 + 1);

895 
	`DEBUG_PRINT
(
dpb_ouut_d–ay
);

897 ià(
pic_¡ruù_´e£Á_æag
) {

898 
pic_¡ruù
 = 
bv
.
	`g‘B™s
(4);

899 
	`DEBUG_PRINT
(
pic_¡ruù
);

901 
´evD–TfiDivisÜ
 = 
D–TfiDivisÜ
;

902 ià(
fHNumb”
 == 264) {

903 
D–TfiDivisÜ
 =

904 
pic_¡ruù
 == 0 ? 2.0 :

905 
pic_¡ruù
 <= 2 ? 1.0 :

906 
pic_¡ruù
 <= 4 ? 2.0 :

907 
pic_¡ruù
 <= 6 ? 3.0 :

908 
pic_¡ruù
 == 7 ? 4.0 :

909 
pic_¡ruù
 == 8 ? 6.0 :

912 
D–TfiDivisÜ
 =

913 
pic_¡ruù
 == 0 ? 2.0 :

914 
pic_¡ruù
 <= 2 ? 1.0 :

915 
pic_¡ruù
 <= 4 ? 2.0 :

916 
pic_¡ruù
 <= 6 ? 3.0 :

917 
pic_¡ruù
 == 7 ? 2.0 :

918 
pic_¡ruù
 == 8 ? 3.0 :

919 
pic_¡ruù
 <= 12 ? 1.0 :

924 ià(
D–TfiDivisÜ
 !ğ
´evD–TfiDivisÜ
 && 
fP¬£dF¿meR©e
 != 0.0) {

925 
	`usšgSourû
()->
fF¿meR©e
 = 
fP¬£dF¿meR©e


926 ğ
fP¬£dF¿meR©e
*(
´evD–TfiDivisÜ
/
D–TfiDivisÜ
);

927 #ifdeà
DEBUG


928 
	`årštf
(
¡d”r
, "Chªged f¿m¿‹Ø%àås\n", 
	`usšgSourû
()->
fF¿meR©e
);

934 
	}
}

936 
	gH264Ü5VideoSŒ—mP¬£r
::
	$æushIÅut
() {

937 
fHaveS“nFœ¡S¹Code
 = 
F®£
;

938 
fHaveS“nFœ¡By‹OfNALUn™
 = 
F®£
;

940 
SŒ—mP¬£r
::
	`æushIÅut
();

941 
	}
}

943 
	#NUM_NEXT_SLICE_HEADER_BYTES_TO_ANALYZE
 12

	)

945 
	gH264Ü5VideoSŒ—mP¬£r
::
	$·r£
() {

946 
Œy
 {

948 ià(!
fHaveS“nFœ¡S¹Code
) {

950 
u_št32_t
 
fœ¡4By‹s
;

951 (
fœ¡4By‹s
 = 
	`‹¡4By‹s
()) != 0x00000001) {

952 
	`g‘1By‹
(); 
	`£tP¬£S‹
();

954 
	`skBy‹s
(4);

956 
	`£tP¬£S‹
();

957 
fHaveS“nFœ¡S¹Code
 = 
True
;

960 ià(
fOuutS¹CodeSize
 > 0 && 
	`curF¿meSize
(è=ğ0 && !
	`haveS“nEOF
()) {

962 
	`§ve4By‹s
(0x00000001);

967 ià(
	`haveS“nEOF
()) {

970 
»maššgD©aSize
 = 
	`tÙNumV®idBy‹s
(è- 
	`curOff£t
();

971 #ifdeà
DEBUG


972 cÚ¡ 
ŒašgNALUn™Size
 = 
»maššgD©aSize
;

974 
»maššgD©aSize
 > 0) {

975 
u_št8_t
 
ÃxtBy‹
 = 
	`g‘1By‹
();

976 ià(!
fHaveS“nFœ¡By‹OfNALUn™
) {

977 
fFœ¡By‹OfNALUn™
 = 
ÃxtBy‹
;

978 
fHaveS“nFœ¡By‹OfNALUn™
 = 
True
;

980 
	`§veBy‹
(
ÃxtBy‹
);

981 --
»maššgD©aSize
;

984 #ifdeà
DEBUG


985 ià(
fHNumb”
 == 264) {

986 
u_št8_t
 
Çl_»f_idc
 = (
fFœ¡By‹OfNALUn™
&0x60)>>5;

987 
u_št8_t
 
Çl_un™_ty³
 = 
fFœ¡By‹OfNALUn™
&0x1F;

988 
	`årštf
(
¡d”r
, "Parsedrailing %d-byte NAL-unit (nal_ref_idc: %d,‚al_unit_type: %d (\"%s\"))\n",

989 
ŒašgNALUn™Size
, 
Çl_»f_idc
, 
Çl_un™_ty³
, 
Çl_un™_ty³_desütiÚ_h264
[nal_unit_type]);

991 
u_št8_t
 
Çl_un™_ty³
 = (
fFœ¡By‹OfNALUn™
&0x7E)>>1;

992 
	`årštf
(
¡d”r
, "Parsedrailing %d-byte NAL-unit (nal_unit_type: %d (\"%s\"))\n",

993 
ŒašgNALUn™Size
, 
Çl_un™_ty³
, 
Çl_un™_ty³_desütiÚ_h265
[nal_unit_type]);

997 ()
	`g‘1By‹
();

1000 
u_št32_t
 
Ãxt4By‹s
 = 
	`‹¡4By‹s
();

1001 ià(!
fHaveS“nFœ¡By‹OfNALUn™
) {

1002 
fFœ¡By‹OfNALUn™
 = 
Ãxt4By‹s
>>24;

1003 
fHaveS“nFœ¡By‹OfNALUn™
 = 
True
;

1005 
Ãxt4By‹s
 != 0x00000001 && (next4Bytes&0xFFFFFF00) != 0x00000100) {

1007 ià(()(
Ãxt4By‹s
&0xFF) > 1) {

1009 
	`§ve4By‹s
(
Ãxt4By‹s
);

1010 
	`skBy‹s
(4);

1013 
	`§veBy‹
(
Ãxt4By‹s
>>24);

1014 
	`skBy‹s
(1);

1016 
	`£tP¬£S‹
();

1017 
Ãxt4By‹s
 = 
	`‹¡4By‹s
();

1021 ià(
Ãxt4By‹s
 == 0x00000001) {

1022 
	`skBy‹s
(4);

1024 
	`skBy‹s
(3);

1028 
fHaveS“nFœ¡By‹OfNALUn™
 = 
F®£
;

1029 
u_št8_t
 
Çl_un™_ty³
;

1030 ià(
fHNumb”
 == 264) {

1031 
Çl_un™_ty³
 = 
fFœ¡By‹OfNALUn™
&0x1F;

1032 #ifdeà
DEBUG


1033 
u_št8_t
 
Çl_»f_idc
 = (
fFœ¡By‹OfNALUn™
&0x60)>>5;

1034 
	`årštf
(
¡d”r
, "Parsed %d-byte NAL-unit (nal_ref_idc: %d,‚al_unit_type: %d (\"%s\"))\n",

1035 
	`curF¿meSize
()-
fOuutS¹CodeSize
, 
Çl_»f_idc
, 
Çl_un™_ty³
, 
Çl_un™_ty³_desütiÚ_h264
[nal_unit_type]);

1038 
Çl_un™_ty³
 = (
fFœ¡By‹OfNALUn™
&0x7E)>>1;

1039 #ifdeà
DEBUG


1040 
	`årštf
(
¡d”r
, "Parsed %d-byte NAL-unit (nal_unit_type: %d (\"%s\"))\n",

1041 
	`curF¿meSize
()-
fOuutS¹CodeSize
, 
Çl_un™_ty³
, 
Çl_un™_ty³_desütiÚ_h265
[nal_unit_type]);

1046 ià(
	`isVPS
(
Çl_un™_ty³
)) {

1048 
	`usšgSourû
()->
	`§veCİyOfVPS
(
fS¹OfF¿me
 + 
fOuutS¹CodeSize
, 
	`curF¿meSize
() - fOutputStartCodeSize);

1050 ià(
fP¬£dF¿meR©e
 == 0.0) {

1053 
num_un™s_š_tick
, 
time_sÿË
;

1054 
	`ª®yze_video_·¿m‘”_£t_d©a
(
num_un™s_š_tick
, 
time_sÿË
);

1055 ià(
time_sÿË
 > 0 && 
num_un™s_š_tick
 > 0) {

1056 
	`usšgSourû
()->
fF¿meR©e
 = 
fP¬£dF¿meR©e


1057 ğ
time_sÿË
/(
D–TfiDivisÜ
*
num_un™s_š_tick
);

1058 #ifdeà
DEBUG


1059 
	`årštf
(
¡d”r
, "S‘ f¿m¿‹Ø%àås\n", 
	`usšgSourû
()->
fF¿meR©e
);

1062 #ifdeà
DEBUG


1063 
	`årštf
(
¡d”r
, "\tThi \"VideØP¬am‘” S‘\" NAL un™ cÚšed‚Øäam¿‹ infÜm©iÚ, sØwu£‡ deçuÉ f¿m¿‹ oà%àås\n", 
	`usšgSourû
()->
fF¿meR©e
);

1067 } ià(
	`isSPS
(
Çl_un™_ty³
)) {

1069 
	`usšgSourû
()->
	`§veCİyOfSPS
(
fS¹OfF¿me
 + 
fOuutS¹CodeSize
, 
	`curF¿meSize
() - fOutputStartCodeSize);

1071 ià(
fP¬£dF¿meR©e
 == 0.0) {

1074 
num_un™s_š_tick
, 
time_sÿË
;

1075 
	`ª®yze_£q_·¿m‘”_£t_d©a
(
num_un™s_š_tick
, 
time_sÿË
);

1076 ià(
time_sÿË
 > 0 && 
num_un™s_š_tick
 > 0) {

1077 
	`usšgSourû
()->
fF¿meR©e
 = 
fP¬£dF¿meR©e


1078 ğ
time_sÿË
/(
D–TfiDivisÜ
*
num_un™s_š_tick
);

1079 #ifdeà
DEBUG


1080 
	`årštf
(
¡d”r
, "S‘ f¿m¿‹Ø%àås\n", 
	`usšgSourû
()->
fF¿meR©e
);

1083 #ifdeà
DEBUG


1084 
	`årštf
(
¡d”r
, "\tThi \"Sequ’û P¬am‘” S‘\" NAL un™ cÚšed‚Øäam¿‹ infÜm©iÚ, sØwu£‡ deçuÉ f¿m¿‹ oà%àås\n", 
	`usšgSourû
()->
fF¿meR©e
);

1088 } ià(
	`isPPS
(
Çl_un™_ty³
)) {

1090 
	`usšgSourû
()->
	`§veCİyOfPPS
(
fS¹OfF¿me
 + 
fOuutS¹CodeSize
, 
	`curF¿meSize
() - fOutputStartCodeSize);

1091 } ià(
	`isSEI
(
Çl_un™_ty³
)) {

1092 
	`ª®yze_£i_d©a
(
Çl_un™_ty³
);

1096 
	`usšgSourû
()->
	`£tP»£Á©iÚTime
();

1097 #ifdeà
DEBUG


1098 
£cs
 = ()
	`usšgSourû
()->
fP»£Á©iÚTime
.
tv_£c
;

1099 
uSecs
 = ()
	`usšgSourû
()->
fP»£Á©iÚTime
.
tv_u£c
;

1100 
	`årštf
(
¡d”r
, "\tP»£Á©iÚime: %lu.%06u\n", 
£cs
, 
uSecs
);

1105 
BoŞ—n
 
thisNALUn™EndsAcûssUn™
;

1106 ià(
	`haveS“nEOF
(è|| 
	`isEOF
(
Çl_un™_ty³
)) {

1108 
thisNALUn™EndsAcûssUn™
 = 
True
;

1109 } ià(
	`usu®lyBegšsAcûssUn™
(
Çl_un™_ty³
)) {

1111 
thisNALUn™EndsAcûssUn™
 = 
F®£
;

1115 
u_št8_t
 
fœ¡By‹sOfNextNALUn™
[3];

1116 
	`‹¡By‹s
(
fœ¡By‹sOfNextNALUn™
, 3);

1118 
u_št8_t
 cÚ¡& 
Ãxt_Çl_un™_ty³
 = 
fHNumb”
 == 264

1119 ? (
fœ¡By‹sOfNextNALUn™
[0]&0x1F) : ((firstBytesOfNextNALUnit[0]&0x7E)>>1);

1120 ià(
	`isVCL
(
Ãxt_Çl_un™_ty³
)) {

1123 
u_št8_t
 cÚ¡ 
by‹Aá”_Çl_un™_h—d”


1124 ğ
fHNumb”
 =ğ264 ? 
fœ¡By‹sOfNextNALUn™
[1] : firstBytesOfNextNALUnit[2];

1125 
thisNALUn™EndsAcûssUn™
 = (
by‹Aá”_Çl_un™_h—d”
&0x80) != 0;

1126 } ià(
	`usu®lyBegšsAcûssUn™
(
Ãxt_Çl_un™_ty³
)) {

1129 
thisNALUn™EndsAcûssUn™
 = 
True
;

1133 
thisNALUn™EndsAcûssUn™
 = 
F®£
;

1137 ià(
thisNALUn™EndsAcûssUn™
) {

1138 #ifdeà
DEBUG


1139 
	`årštf
(
¡d”r
, "*****This NAL unitƒndshe current‡ccess unit*****\n");

1141 
	`usšgSourû
()->
fPiùu»EndM¬k”
 = 
True
;

1142 ++
	`usšgSourû
()->
fPiùu»CouÁ
;

1145 
timev®
& 
ÃxtPT
 = 
	`usšgSourû
()->
fNextP»£Á©iÚTime
;

1146 
ÃxtPT
 = 
	`usšgSourû
()->
fP»£Á©iÚTime
;

1147 
ÃxtF¿ùiÚ
 = 
ÃxtPT
.
tv_u£c
/1000000.0 + 1/
	`usšgSourû
()->
fF¿meR©e
;

1148 
ÃxtSecsInüem’t
 = ()
ÃxtF¿ùiÚ
;

1149 
ÃxtPT
.
tv_£c
 +ğ()
ÃxtSecsInüem’t
;

1150 
ÃxtPT
.
tv_u£c
 = ()((
ÃxtF¿ùiÚ
 - 
ÃxtSecsInüem’t
)*1000000);

1152 
	`£tP¬£S‹
();

1154  
	`curF¿meSize
();

1155 } 
	`ÿtch
 () {

1156 #ifdeà
DEBUG


1157 
	`årštf
(
¡d”r
, "H264or5VideoStreamParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

1161 
	}
}

1163 
	$»moveH264Ü5EmuÏtiÚBy‹s
(
u_št8_t
* 
to
, 
toMaxSize
,

1164 
u_št8_t
* 
äom
, 
äomSize
) {

1165 
toSize
 = 0;

1166 
i
 = 0;

1167 
i
 < 
äomSize
 && 
toSize
+1 < 
toMaxSize
) {

1168 ià(
i
+2 < 
äomSize
 && 
äom
[i] == 0 && from[i+1] == 0 && from[i+2] == 3) {

1169 
to
[
toSize
] =o[toSize+1] = 0;

1170 
toSize
 += 2;

1171 
i
 += 3;

1173 
to
[
toSize
] = 
äom
[
i
];

1174 
toSize
 += 1;

1175 
i
 += 1;

1179  
toSize
;

1180 
	}
}

	@liveMedia/H265VideoFileServerMediaSubsession.cpp

22 
	~"H265VideoFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"H265VideoRTPSšk.hh
"

24 
	~"By‹SŒ—mFeSourû.hh
"

25 
	~"H265VideoSŒ—mF¿m”.hh
"

27 
H265VideoFeS”v”MedŸSub£ssiÚ
*

28 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

29 cÚ¡* 
feName
,

30 
BoŞ—n
 
»u£Fœ¡Sourû
) {

31  
Ãw
 
	`H265VideoFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

32 
	}
}

34 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::
	$H265VideoFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

35 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

36 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

37 
	`fAuxSDPLše
(
NULL
), 
	`fDÚeFÏg
(0), 
	$fDummyRTPSšk
(
NULL
) {

38 
	}
}

40 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::~
	$H265VideoFeS”v”MedŸSub£ssiÚ
() {

41 
d–‘e
[] 
fAuxSDPLše
;

42 
	}
}

44 
	$aá”PÏyšgDummy
(* 
ş›ÁD©a
) {

45 
H265VideoFeS”v”MedŸSub£ssiÚ
* 
sub£ss
 = (H265VideoFeS”v”MedŸSub£ssiÚ*)
ş›ÁD©a
;

46 
sub£ss
->
	`aá”PÏyšgDummy1
();

47 
	}
}

49 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::
	$aá”PÏyšgDummy1
() {

51 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

53 
	`£tDÚeFÏg
();

54 
	}
}

56 
	$checkFÜAuxSDPLše
(* 
ş›ÁD©a
) {

57 
H265VideoFeS”v”MedŸSub£ssiÚ
* 
sub£ss
 = (H265VideoFeS”v”MedŸSub£ssiÚ*)
ş›ÁD©a
;

58 
sub£ss
->
	`checkFÜAuxSDPLše1
();

59 
	}
}

61 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::
	$checkFÜAuxSDPLše1
() {

62 cÚ¡* 
da¦
;

64 ià(
fAuxSDPLše
 !ğ
NULL
) {

66 
	`£tDÚeFÏg
();

67 } ià(
fDummyRTPSšk
 !ğ
NULL
 && (
da¦
 = fDummyRTPSšk->
	`auxSDPLše
()) != NULL) {

68 
fAuxSDPLše
 = 
	`¡rDup
(
da¦
);

69 
fDummyRTPSšk
 = 
NULL
;

72 
	`£tDÚeFÏg
();

73 } ià(!
fDÚeFÏg
) {

75 
uSecsToD–ay
 = 100000;

76 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecsToD–ay
,

77 (
TaskFunc
*)
checkFÜAuxSDPLše
, 
this
);

79 
	}
}

81 cÚ¡* 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::
	$g‘AuxSDPLše
(
RTPSšk
* 
¹pSšk
, 
F¿medSourû
* 
šputSourû
) {

82 ià(
fAuxSDPLše
 !ğ
NULL
)  fAuxSDPLine;

84 ià(
fDummyRTPSšk
 =ğ
NULL
) {

89 
fDummyRTPSšk
 = 
¹pSšk
;

92 
fDummyRTPSšk
->
	`¡¬tPÏyšg
(*
šputSourû
, 
aá”PÏyšgDummy
, 
this
);

95 
	`checkFÜAuxSDPLše
(
this
);

98 
	`’vœ
().
	`skScheduËr
().
	`doEv’tLoİ
(&
fDÚeFÏg
);

100  
fAuxSDPLše
;

101 
	}
}

103 
F¿medSourû
* 
	gH265VideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

104 
e¡B™¿‹
 = 500;

107 
By‹SŒ—mFeSourû
* 
feSourû
 = By‹SŒ—mFeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

108 ià(
feSourû
 =ğ
NULL
)  NULL;

109 
fFeSize
 = 
feSourû
->
	`feSize
();

112  
H265VideoSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
);

113 
	}
}

115 
RTPSšk
* 
	gH265VideoFeS”v”MedŸSub£ssiÚ


116 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

117 
¹pPaylßdTy³IfDyÇmic
,

118 
F¿medSourû
* ) {

119  
H265VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

120 
	}
}

	@liveMedia/H265VideoFileSink.cpp

21 
	~"H265VideoFeSšk.hh
"

22 
	~"OuutFe.hh
"

26 
	gH265VideoFeSšk


27 ::
	$H265VideoFeSšk
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

28 cÚ¡* 
sPrİVPSSŒ
,

29 cÚ¡* 
sPrİSPSSŒ
,

30 cÚ¡* 
sPrİPPSSŒ
,

31 
bufãrSize
, cÚ¡* 
³rF¿meFeNameP»fix
)

32 : 
	$H264Ü5VideoFeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
,

33 
sPrİVPSSŒ
, 
sPrİSPSSŒ
, 
sPrİPPSSŒ
) {

34 
	}
}

36 
	gH265VideoFeSšk
::~
	$H265VideoFeSšk
() {

37 
	}
}

39 
H265VideoFeSšk
*

40 
H265VideoFeSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

41 cÚ¡* 
sPrİVPSSŒ
,

42 cÚ¡* 
sPrİSPSSŒ
,

43 cÚ¡* 
sPrİPPSSŒ
,

44 
bufãrSize
, 
BoŞ—n
 
ÚeFeP”F¿me
) {

46 
FILE
* 
fid
;

47 cÚ¡* 
³rF¿meFeNameP»fix
;

48 ià(
ÚeFeP”F¿me
) {

50 
fid
 = 
NULL
;

51 
³rF¿meFeNameP»fix
 = 
feName
;

54 
fid
 = 
	`O³nOuutFe
(
’v
, 
feName
);

55 ià(
fid
 =ğ
NULL
) ;

56 
³rF¿meFeNameP»fix
 = 
NULL
;

59  
Ãw
 
	`H265VideoFeSšk
(
’v
, 
fid
, 
sPrİVPSSŒ
, 
sPrİSPSSŒ
, 
sPrİPPSSŒ
, 
bufãrSize
, 
³rF¿meFeNameP»fix
);

62  
NULL
;

63 
	}
}

	@liveMedia/H265VideoRTPSink.cpp

21 
	~"H265VideoRTPSšk.hh
"

22 
	~"H265VideoSŒ—mF¿m”.hh
"

23 
	~"Ba£64.hh
"

24 
	~"B™VeùÜ.hh
"

25 
	~"H264VideoRTPSourû.hh
"

29 
	gH265VideoRTPSšk


30 ::
	$H265VideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

31 
u_št8_t
 cÚ¡* 
vps
, 
vpsSize
,

32 
u_št8_t
 cÚ¡* 
¥s
, 
¥sSize
,

33 
u_št8_t
 cÚ¡* 
µs
, 
µsSize
)

34 : 
	$H264Ü5VideoRTPSšk
(265, 
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

35 
vps
, 
vpsSize
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
) {

36 
	}
}

38 
	gH265VideoRTPSšk
::~
	$H265VideoRTPSšk
() {

39 
	}
}

41 
H265VideoRTPSšk
* H265VideoRTPSink

42 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
) {

43  
Ãw
 
	`H265VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

44 
	}
}

46 
H265VideoRTPSšk
* 
	gH265VideoRTPSšk


47 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

48 
u_št8_t
 cÚ¡* 
vps
, 
vpsSize
,

49 
u_št8_t
 cÚ¡* 
¥s
, 
¥sSize
,

50 
u_št8_t
 cÚ¡* 
µs
, 
µsSize
) {

51  
Ãw
 
	`H265VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

52 
vps
, 
vpsSize
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
);

53 
	}
}

55 
H265VideoRTPSšk
* 
	gH265VideoRTPSšk


56 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

57 cÚ¡* 
sPrİVPSSŒ
, cÚ¡* 
sPrİSPSSŒ
, cÚ¡* 
sPrİPPSSŒ
) {

58 
u_št8_t
* 
vps
 = 
NULL
; 
vpsSize
 = 0;

59 
u_št8_t
* 
¥s
 = 
NULL
; 
¥sSize
 = 0;

60 
u_št8_t
* 
µs
 = 
NULL
; 
µsSize
 = 0;

65 
SPrİRecÜd
* 
sPrİRecÜds
[3];

66 
numSPrİRecÜds
[3];

67 
sPrİRecÜds
[0] = 
	`·r£SPrİP¬am‘”S‘s
(
sPrİVPSSŒ
, 
numSPrİRecÜds
[0]);

68 
sPrİRecÜds
[1] = 
	`·r£SPrİP¬am‘”S‘s
(
sPrİSPSSŒ
, 
numSPrİRecÜds
[1]);

69 
sPrİRecÜds
[2] = 
	`·r£SPrİP¬am‘”S‘s
(
sPrİPPSSŒ
, 
numSPrİRecÜds
[2]);

71 
j
 = 0; j < 3; ++j) {

72 
SPrİRecÜd
* 
»cÜds
 = 
sPrİRecÜds
[
j
];

73 
numRecÜds
 = 
numSPrİRecÜds
[
j
];

75 
i
 = 0; i < 
numRecÜds
; ++i) {

76 ià(
»cÜds
[
i
].
sPrİL’gth
 == 0) ;

77 
u_št8_t
 
Çl_un™_ty³
 = ((
»cÜds
[
i
].
sPrİBy‹s
[0])&0x7E)>>1;

78 ià(
Çl_un™_ty³
 == 32 ) {

79 
vps
 = 
»cÜds
[
i
].
sPrİBy‹s
;

80 
vpsSize
 = 
»cÜds
[
i
].
sPrİL’gth
;

81 } ià(
Çl_un™_ty³
 == 33 ) {

82 
¥s
 = 
»cÜds
[
i
].
sPrİBy‹s
;

83 
¥sSize
 = 
»cÜds
[
i
].
sPrİL’gth
;

84 } ià(
Çl_un™_ty³
 == 34 ) {

85 
µs
 = 
»cÜds
[
i
].
sPrİBy‹s
;

86 
µsSize
 = 
»cÜds
[
i
].
sPrİL’gth
;

91 
H265VideoRTPSšk
* 
»suÉ
 = 
Ãw
 
	`H265VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

92 
vps
, 
vpsSize
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
);

93 
d–‘e
[] 
sPrİRecÜds
[0]; delete[] sPropRecords[1]; delete[] sPropRecords[2];

95  
»suÉ
;

96 
	}
}

98 
BoŞ—n
 
	gH265VideoRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

100  
sourû
.
	`isH265VideoSŒ—mF¿m”
();

101 
	}
}

103 cÚ¡* 
	gH265VideoRTPSšk
::
	$auxSDPLše
() {

107 
H264Ü5VideoSŒ—mF¿m”
* 
äam”Sourû
 = 
NULL
;

108 
u_št8_t
* 
vps
 = 
fVPS
; 
vpsSize
 = 
fVPSSize
;

109 
u_št8_t
* 
¥s
 = 
fSPS
; 
¥sSize
 = 
fSPSSize
;

110 
u_št8_t
* 
µs
 = 
fPPS
; 
µsSize
 = 
fPPSSize
;

111 ià(
vps
 =ğ
NULL
 || 
¥s
 =ğNULL || 
µs
 == NULL) {

113 ià(
fOurF¿gm’‹r
 =ğ
NULL
)  NULL;

114 
äam”Sourû
 = (
H264Ü5VideoSŒ—mF¿m”
*)(
fOurF¿gm’‹r
->
	`šputSourû
());

115 ià(
äam”Sourû
 =ğ
NULL
)  NULL;

117 
äam”Sourû
->
	`g‘VPSªdSPSªdPPS
(
vps
, 
vpsSize
, 
¥s
, 
¥sSize
, 
µs
, 
µsSize
);

118 ià(
vps
 =ğ
NULL
 || 
¥s
 =ğNULL || 
µs
 == NULL) {

119  
NULL
;

124 
u_št8_t
* 
vpsWEB
 = 
Ãw
 u_št8_t[
vpsSize
];

125 
vpsWEBSize
 = 
	`»moveH264Ü5EmuÏtiÚBy‹s
(
vpsWEB
, 
vpsSize
, 
vps
, vpsSize);

126 ià(
vpsWEBSize
 < 6 + 12 ) {

128 
d–‘e
[] 
vpsWEB
;

129  
NULL
;

131 
u_št8_t
 cÚ¡* 
´ofeT›rLev–H—d”By‹s
 = &
vpsWEB
[6];

132 
´ofeS·û
 = 
´ofeT›rLev–H—d”By‹s
[0]>>6;

133 
´ofeId
 = 
´ofeT›rLev–H—d”By‹s
[0]&0x1F;

134 
t›rFÏg
 = (
´ofeT›rLev–H—d”By‹s
[0]>>5)&0x1;

135 
Ëv–Id
 = 
´ofeT›rLev–H—d”By‹s
[11];

136 
u_št8_t
 cÚ¡* 
š‹rİ_cÚ¡¿šts
 = &
´ofeT›rLev–H—d”By‹s
[5];

137 
š‹rİCÚ¡¿štsSŒ
[100];

138 
	`¥rštf
(
š‹rİCÚ¡¿štsSŒ
, "%02X%02X%02X%02X%02X%02X",

139 
š‹rİ_cÚ¡¿šts
[0], interop_constraints[1], interop_constraints[2],

140 
š‹rİ_cÚ¡¿šts
[3], interop_constraints[4], interop_constraints[5]);

141 
d–‘e
[] 
vpsWEB
;

143 * 
¥rİ_vps
 = 
	`ba£64Encode
((*)
vps
, 
vpsSize
);

144 * 
¥rİ_¥s
 = 
	`ba£64Encode
((*)
¥s
, 
¥sSize
);

145 * 
¥rİ_µs
 = 
	`ba£64Encode
((*)
µs
, 
µsSize
);

147 cÚ¡* 
fmFmt
 =

156 
fmFmtSize
 = 
	`¡¾’
(
fmFmt
)

161 + 
	`¡¾’
(
š‹rİCÚ¡¿štsSŒ
)

162 + 
	`¡¾’
(
¥rİ_vps
)

163 + 
	`¡¾’
(
¥rİ_¥s
)

164 + 
	`¡¾’
(
¥rİ_µs
);

165 * 
fm
 = 
Ãw
 [
fmFmtSize
];

166 
	`¥rštf
(
fm
, 
fmFmt
,

167 
	`¹pPaylßdTy³
(), 
´ofeS·û
,

168 
´ofeId
,

169 
t›rFÏg
,

170 
Ëv–Id
,

171 
š‹rİCÚ¡¿štsSŒ
,

172 
¥rİ_vps
,

173 
¥rİ_¥s
,

174 
¥rİ_µs
);

176 
d–‘e
[] 
¥rİ_vps
;

177 
d–‘e
[] 
¥rİ_¥s
;

178 
d–‘e
[] 
¥rİ_µs
;

180 
d–‘e
[] 
fFmSDPLše
; fFmSDPLšğ
fm
;

181  
fFmSDPLše
;

182 
	}
}

	@liveMedia/H265VideoRTPSource.cpp

21 
	~"H265VideoRTPSourû.hh
"

25 şas 
	cH265Bufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

26 
public
:

27 
H265Bufã»dPack‘
(
H265VideoRTPSourû
& 
ourSourû
);

28 
	mvœtu®
 ~
H265Bufã»dPack‘
();

30 
	m´iv©e
:

31 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

32 
d©aSize
);

33 
	m´iv©e
:

34 
H265VideoRTPSourû
& 
fOurSourû
;

37 şas 
	cH265Bufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

38 
´iv©e
:

39 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

45 
H265VideoRTPSourû
*

46 
	gH265VideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

47 
¹pPaylßdFÜm©
,

48 
BoŞ—n
 
ex³ùDONF›lds
,

49 
¹pTime¡ampF»qu’cy
) {

50  
Ãw
 
	`H265VideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

51 
ex³ùDONF›lds
, 
¹pTime¡ampF»qu’cy
);

52 
	}
}

54 
	gH265VideoRTPSourû


55 ::
	$H265VideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

56 
¹pPaylßdFÜm©
,

57 
BoŞ—n
 
ex³ùDONF›lds
,

58 
¹pTime¡ampF»qu’cy
)

59 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

60 
Ãw
 
H265Bufã»dPack‘FaùÜy
),

61 
	`fEx³ùDONF›lds
(
ex³ùDONF›lds
),

62 
	`fP»viousNALUn™DON
(0), 
	`fCu¼’tNALUn™AbsDÚ
((
u_št64_t
)(~0)) {

63 
	}
}

65 
	gH265VideoRTPSourû
::~
	$H265VideoRTPSourû
() {

66 
	}
}

68 
BoŞ—n
 
H265VideoRTPSourû


69 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

70 & 
»suÉS³cŸlH—d”Size
) {

71 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

72 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

73 
u_št16_t
 
DONL
 = 0;

74 
numBy‹sToSk
;

77 ià(
·ck‘Size
 < 2è 
F®£
;

78 
fCurPack‘NALUn™Ty³
 = (
h—d”S¹
[0]&0x7E)>>1;

79 
fCurPack‘NALUn™Ty³
) {

82 ià(
fEx³ùDONF›lds
) {

83 ià(
·ck‘Size
 < 4è 
F®£
;

84 
DONL
 = (
h—d”S¹
[2]<<8)|headerStart[3];

85 
numBy‹sToSk
 = 4;

87 
numBy‹sToSk
 = 2;

96 ià(
·ck‘Size
 < 3è 
F®£
;

97 
u_št8_t
 
¡¬tB™
 = 
h—d”S¹
[2]&0x80;

98 
u_št8_t
 
’dB™
 = 
h—d”S¹
[2]&0x40;

99 ià(
¡¬tB™
) {

100 
fCu¼’tPack‘BegšsF¿me
 = 
True
;

102 
u_št8_t
 
Çl_un™_ty³
 = 
h—d”S¹
[2]&0x3F;

103 
u_št8_t
 
ÃwNALH—d”
[2];

104 
ÃwNALH—d”
[0] = (
h—d”S¹
[0]&0x81)|(
Çl_un™_ty³
<<1);

105 
ÃwNALH—d”
[1] = 
h—d”S¹
[1];

107 ià(
fEx³ùDONF›lds
) {

108 ià(
·ck‘Size
 < 5è 
F®£
;

109 
DONL
 = (
h—d”S¹
[3]<<8)|headerStart[4];

110 
h—d”S¹
[3] = 
ÃwNALH—d”
[0];

111 
h—d”S¹
[4] = 
ÃwNALH—d”
[1];

112 
numBy‹sToSk
 = 3;

114 
h—d”S¹
[1] = 
ÃwNALH—d”
[0];

115 
h—d”S¹
[2] = 
ÃwNALH—d”
[1];

116 
numBy‹sToSk
 = 1;

120 
fCu¼’tPack‘BegšsF¿me
 = 
F®£
;

121 ià(
fEx³ùDONF›lds
) {

122 ià(
·ck‘Size
 < 5è 
F®£
;

123 
DONL
 = (
h—d”S¹
[3]<<8)|headerStart[4];

124 
numBy‹sToSk
 = 5;

126 
numBy‹sToSk
 = 3;

129 
fCu¼’tPack‘Com¶‘esF¿me
 = (
’dB™
 != 0);

134 
fCu¼’tPack‘BegšsF¿me
 = 
fCu¼’tPack‘Com¶‘esF¿me
 = 
True
;

135 
numBy‹sToSk
 = 0;

140 
	`compu‹AbsDÚFromDON
(
DONL
);

141 
»suÉS³cŸlH—d”Size
 = 
numBy‹sToSk
;

142  
True
;

143 
	}
}

145 cÚ¡* 
	gH265VideoRTPSourû
::
	$MIMEty³
() const {

147 
	}
}

149 
	gH265VideoRTPSourû
::
	$compu‹AbsDÚFromDON
(
u_št16_t
 
DON
) {

150 ià(!
fEx³ùDONF›lds
) {

152 ++
fCu¼’tNALUn™AbsDÚ
;

154 ià(
fCu¼’tNALUn™AbsDÚ
 =ğ(
u_št64_t
)(~0)) {

156 
fCu¼’tNALUn™AbsDÚ
 = (
u_št64_t
)
DON
;

160 
sigÃdDiff16
 = ()(
DON
 - 
fP»viousNALUn™DON
);

161 
št64_t
 
sigÃdDiff64
 = (št64_t)
sigÃdDiff16
;

162 
fCu¼’tNALUn™AbsDÚ
 +ğ
sigÃdDiff64
;

165 
fP»viousNALUn™DON
 = 
DON
;

167 
	}
}

172 
	gH265Bufã»dPack‘
::
	$H265Bufã»dPack‘
(
H265VideoRTPSourû
& 
ourSourû
)

173 : 
	$fOurSourû
(
ourSourû
) {

174 
	}
}

176 
H265Bufã»dPack‘
::~
	$H265Bufã»dPack‘
() {

177 
	}
}

179 
H265Bufã»dPack‘


180 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

181 
»suÉNALUSize
 = 0;

183 
fOurSourû
.
fCurPack‘NALUn™Ty³
) {

185 ià(
	`u£CouÁ
() > 0) {

188 
u_št16_t
 
DONL
 = 0;

189 ià(
fOurSourû
.
fEx³ùDONF›lds
) {

191 ià(
d©aSize
 < 1) ;

192 
u_št8_t
 
DOND
 = 
äamePŒ
[0];

193 
DONL
 = 
fOurSourû
.
fP»viousNALUn™DON
 + (
u_št16_t
)(
DOND
 + 1);

194 ++
äamePŒ
;

195 --
d©aSize
;

197 
fOurSourû
.
	`compu‹AbsDÚFromDON
(
DONL
);

201 ià(
d©aSize
 < 2) ;

202 
»suÉNALUSize
 = (
äamePŒ
[0]<<8)|framePtr[1];

203 
äamePŒ
 += 2;

208  
d©aSize
;

212  (
»suÉNALUSize
 <ğ
d©aSize
) ?„esultNALUSize : dataSize;

213 
	}
}

215 
Bufã»dPack‘
* 
	gH265Bufã»dPack‘FaùÜy


216 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

217  
Ãw
 
	`H265Bufã»dPack‘
((
H265VideoRTPSourû
&)(*
ourSourû
));

218 
	}
}

	@liveMedia/H265VideoStreamDiscreteFramer.cpp

24 
	~"H265VideoSŒ—mDisü‘eF¿m”.hh
"

26 
H265VideoSŒ—mDisü‘eF¿m”
*

27 
	gH265VideoSŒ—mDisü‘eF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

28  
Ãw
 
	`H265VideoSŒ—mDisü‘eF¿m”
(
’v
, 
šputSourû
);

29 
	}
}

31 
	gH265VideoSŒ—mDisü‘eF¿m”


32 ::
	$H265VideoSŒ—mDisü‘eF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
)

33 : 
	$H264Ü5VideoSŒ—mDisü‘eF¿m”
(265, 
’v
, 
šputSourû
) {

34 
	}
}

36 
	gH265VideoSŒ—mDisü‘eF¿m”
::~
	$H265VideoSŒ—mDisü‘eF¿m”
() {

37 
	}
}

39 
BoŞ—n
 
H265VideoSŒ—mDisü‘eF¿m”
::
	$isH265VideoSŒ—mF¿m”
() const {

40  
True
;

41 
	}
}

	@liveMedia/H265VideoStreamFramer.cpp

21 
	~"H265VideoSŒ—mF¿m”.hh
"

23 
H265VideoSŒ—mF¿m”
* 
	gH265VideoSŒ—mF¿m”


24 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
šşudeS¹CodeInOuut
) {

25  
Ãw
 
	`H265VideoSŒ—mF¿m”
(
’v
, 
šputSourû
, 
True
, 
šşudeS¹CodeInOuut
);

26 
	}
}

28 
	gH265VideoSŒ—mF¿m”


29 ::
	$H265VideoSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
ü—‹P¬£r
, BoŞ—À
šşudeS¹CodeInOuut
)

30 : 
	$H264Ü5VideoSŒ—mF¿m”
(265, 
’v
, 
šputSourû
, 
ü—‹P¬£r
, 
šşudeS¹CodeInOuut
) {

31 
	}
}

33 
	gH265VideoSŒ—mF¿m”
::~
	$H265VideoSŒ—mF¿m”
() {

34 
	}
}

36 
BoŞ—n
 
H265VideoSŒ—mF¿m”
::
	$isH265VideoSŒ—mF¿m”
() const {

37  
True
;

38 
	}
}

	@liveMedia/InputFile.cpp

21 
	~"IÅutFe.hh
"

22 
	~<¡ršg.h
>

24 
FILE
* 
	$O³nIÅutFe
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
) {

25 
FILE
* 
fid
;

28 ià(
	`¡rcmp
(
feName
, "stdin") == 0) {

29 
fid
 = 
¡dš
;

30 #ià(
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

31 
	`_£tmode
(
	`_f’o
(
¡dš
), 
_O_BINARY
);

34 
fid
 = 
	`fİ’
(
feName
, "rb");

35 ià(
fid
 =ğ
NULL
) {

36 
’v
.
	`£tResuÉMsg
("uÇbËØİ’ f\"",
feName
, "\"");

40  
fid
;

41 
	}
}

43 
	$Clo£IÅutFe
(
FILE
* 
fid
) {

45 ià(
fid
 !ğ
NULL
 && fid !ğ
¡dš
è
	`fşo£
(fid);

46 
	}
}

48 
u_št64_t
 
	$G‘FeSize
(cÚ¡* 
feName
, 
FILE
* 
fid
) {

49 
u_št64_t
 
feSize
 = 0;

51 ià(
fid
 !ğ
¡dš
) {

52 #ià!
	`defšed
(
_WIN32_WCE
)

53 ià(
feName
 =ğ
NULL
) {

55 ià(
fid
 !ğ
NULL
 && 
	`S“kFe64
(fid, 0, 
SEEK_END
) >= 0) {

56 
feSize
 = (
u_št64_t
)
	`T–lFe64
(
fid
);

57 ià(
feSize
 =ğ(
u_št64_t
)-1) fileSize = 0;

58 
	`S“kFe64
(
fid
, 0, 
SEEK_SET
);

60 #ià!
	`defšed
(
_WIN32_WCE
)

62 
¡©
 
sb
;

63 ià(
	`¡©
(
feName
, &
sb
) == 0) {

64 
feSize
 = 
sb
.
¡_size
;

70  
feSize
;

71 
	}
}

73 
št64_t
 
	$S“kFe64
(
FILE
 *
fid
, 
št64_t
 
off£t
, 
wh’û
) {

74 ià(
fid
 =ğ
NULL
)  -1;

76 
	`ş—»¼
(
fid
);

77 
	`fæush
(
fid
);

78 #ià(
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

79  
	`_l£eki64
(
	`_f’o
(
fid
), 
off£t
, 
wh’û
è=ğ(
št64_t
)-1 ? -1 : 0;

81 #ià
	`defšed
(
_WIN32_WCE
)

82  
	`f£ek
(
fid
, ()(
off£t
), 
wh’û
);

84  
	`f£eko
(
fid
, (
off_t
)(
off£t
), 
wh’û
);

87 
	}
}

89 
št64_t
 
	$T–lFe64
(
FILE
 *
fid
) {

90 ià(
fid
 =ğ
NULL
)  -1;

92 
	`ş—»¼
(
fid
);

93 
	`fæush
(
fid
);

94 #ià(
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

95  
	`_‹Îi64
(
	`_f’o
(
fid
));

97 #ià
	`defšed
(
_WIN32_WCE
)

98  
	`á–l
(
fid
);

100  
	`á–lo
(
fid
);

103 
	}
}

105 
BoŞ—n
 
	$FeIsS“kabË
(
FILE
 *
fid
) {

106 ià(
	`S“kFe64
(
fid
, 1, 
SEEK_CUR
) < 0) {

107  
F®£
;

110 
	`S“kFe64
(
fid
, -1, 
SEEK_CUR
);

111  
True
;

112 
	}
}

	@liveMedia/JPEGVideoRTPSink.cpp

21 
	~"JPEGVideoRTPSšk.hh
"

22 
	~"JPEGVideoSourû.hh
"

24 
	gJPEGVideoRTPSšk


25 ::
	$JPEGVideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
)

26 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 26, 90000, "JPEG") {

27 
	}
}

29 
	gJPEGVideoRTPSšk
::~
	$JPEGVideoRTPSšk
() {

30 
	}
}

32 
JPEGVideoRTPSšk
*

33 
JPEGVideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
) {

34  
Ãw
 
	`JPEGVideoRTPSšk
(
’v
, 
RTPgs
);

35 
	}
}

37 
BoŞ—n
 
	gJPEGVideoRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

38  
sourû
.
	`isJPEGVideoSourû
();

39 
	}
}

41 
BoŞ—n
 
	gJPEGVideoRTPSšk


42 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

45  
F®£
;

46 
	}
}

48 
	gJPEGVideoRTPSšk


49 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

52 
timev®
 
äameP»£Á©iÚTime
,

53 
numRemaššgBy‹s
) {

55 
JPEGVideoSourû
* 
sourû
 = (JPEGVideoSourû*)
fSourû
;

56 ià(
sourû
 =ğ
NULL
) ;

58 
u_št8_t
 
mašJPEGH—d”
[8];

59 
u_št8_t
 cÚ¡ 
ty³
 = 
sourû
->
	`ty³
();

61 
mašJPEGH—d”
[0] = 0;

62 
mašJPEGH—d”
[1] = 
äagm’tiÚOff£t
 >> 16;

63 
mašJPEGH—d”
[2] = 
äagm’tiÚOff£t
 >> 8;

64 
mašJPEGH—d”
[3] = 
äagm’tiÚOff£t
;

65 
mašJPEGH—d”
[4] = 
ty³
;

66 
mašJPEGH—d”
[5] = 
sourû
->
	`qFaùÜ
();

67 
mašJPEGH—d”
[6] = 
sourû
->
	`width
();

68 
mašJPEGH—d”
[7] = 
sourû
->
	`height
();

69 
	`£tS³cŸlH—d”By‹s
(
mašJPEGH—d”
,  mainJPEGHeader);

71 
»¡¬tM¬k”H—d”Size
 = 0;

72 ià(
ty³
 >= 64 &&ype <= 127) {

74 
»¡¬tM¬k”H—d”Size
 = 4;

75 
u_št16_t
 cÚ¡ 
»¡¬tIÁ”v®
 = 
sourû
->
	`»¡¬tIÁ”v®
();

77 
u_št8_t
 
»¡¬tM¬k”H—d”
[4];

78 
»¡¬tM¬k”H—d”
[0] = 
»¡¬tIÁ”v®
>>8;

79 
»¡¬tM¬k”H—d”
[1] = 
»¡¬tIÁ”v®
&0xFF;

80 
»¡¬tM¬k”H—d”
[2] =„estartMarkerHeader[3] = 0xFF;

82 
	`£tS³cŸlH—d”By‹s
(
»¡¬tM¬k”H—d”
, 
»¡¬tM¬k”H—d”Size
,

83  
mašJPEGH—d”
 );

86 ià(
äagm’tiÚOff£t
 =ğ0 && 
sourû
->
	`qFaùÜ
() >= 128) {

88 
u_št8_t
 
´ecisiÚ
;

89 
u_št16_t
 
Ëngth
;

90 
u_št8_t
 cÚ¡* 
quªtiz©iÚTabËs


91 ğ
sourû
->
	`quªtiz©iÚTabËs
(
´ecisiÚ
, 
Ëngth
);

93 cÚ¡ 
quªtiz©iÚH—d”Size
 = 4 + 
Ëngth
;

94 
u_št8_t
* 
quªtiz©iÚH—d”
 = 
Ãw
 u_št8_t[
quªtiz©iÚH—d”Size
];

96 
quªtiz©iÚH—d”
[0] = 0;

97 
quªtiz©iÚH—d”
[1] = 
´ecisiÚ
;

98 
quªtiz©iÚH—d”
[2] = 
Ëngth
 >> 8;

99 
quªtiz©iÚH—d”
[3] = 
Ëngth
&0xFF;

100 ià(
quªtiz©iÚTabËs
 !ğ
NULL
) {

101 
u_št16_t
 
i
 = 0; i < 
Ëngth
; ++i) {

102 
quªtiz©iÚH—d”
[4+
i
] = 
quªtiz©iÚTabËs
[i];

106 
	`£tS³cŸlH—d”By‹s
(
quªtiz©iÚH—d”
, 
quªtiz©iÚH—d”Size
,

107  
mašJPEGH—d”
 + 
»¡¬tM¬k”H—d”Size
 );

108 
d–‘e
[] 
quªtiz©iÚH—d”
;

111 ià(
numRemaššgBy‹s
 == 0) {

114 
	`£tM¬k”B™
();

118 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

119 
	}
}

122 
	gJPEGVideoRTPSšk
::
	$¥ecŸlH—d”Size
() const {

124 
JPEGVideoSourû
* 
sourû
 = (JPEGVideoSourû*)
fSourû
;

125 ià(
sourû
 =ğ
NULL
)  0;

127 
h—d”Size
 = 8;

129 
u_št8_t
 cÚ¡ 
ty³
 = 
sourû
->
	`ty³
();

130 ià(
ty³
 >= 64 &&ype <= 127) {

132 
h—d”Size
 += 4;

135 ià(
	`curF¿gm’tiÚOff£t
(è=ğ0 && 
sourû
->
	`qFaùÜ
() >= 128) {

137 
u_št8_t
 
dummy
;

138 
u_št16_t
 
quªtiz©iÚTabËsSize
;

139 ()(
sourû
->
	`quªtiz©iÚTabËs
(
dummy
, 
quªtiz©iÚTabËsSize
));

141 
h—d”Size
 +ğ4 + 
quªtiz©iÚTabËsSize
;

144  
h—d”Size
;

145 
	}
}

	@liveMedia/JPEGVideoRTPSource.cpp

21 
	~"JPEGVideoRTPSourû.hh
"

25 şas 
	cJPEGBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

26 
public
:

27 
BoŞ—n
 
com¶‘esF¿me
;

29 
	m´iv©e
:

31 
vœtu®
 
»£t
();

32 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

33 
d©aSize
);

36 şas 
	cJPEGBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

37 
´iv©e
:

38 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

44 
	#BYTE
 

	)

45 
	#WORD
 

	)

46 
	#DWORD
 

	)

48 
JPEGVideoRTPSourû
*

49 
	gJPEGVideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

50 
¹pPaylßdFÜm©
,

51 
¹pTime¡ampF»qu’cy
,

52 
deçuÉWidth
, 
deçuÉHeight
) {

53  
Ãw
 
	`JPEGVideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

54 
¹pTime¡ampF»qu’cy
, 
deçuÉWidth
, 
deçuÉHeight
);

55 
	}
}

57 
	gJPEGVideoRTPSourû
::
	$JPEGVideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

58 
Groupsock
* 
RTPgs
,

59 
¹pPaylßdFÜm©
,

60 
¹pTime¡ampF»qu’cy
,

61 
deçuÉWidth
, 
deçuÉHeight
)

62 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

63 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

64 
Ãw
 
JPEGBufã»dPack‘FaùÜy
),

65 
	`fDeçuÉWidth
(
deçuÉWidth
), 
	$fDeçuÉHeight
(
deçuÉHeight
) {

66 
	}
}

68 
	gJPEGVideoRTPSourû
::~
	$JPEGVideoRTPSourû
() {

69 
	}
}

72 
MARKER_SOF0
 = 0xc0,

73 
	mMARKER_SOI
 = 0xd8,

74 
	mMARKER_EOI
 = 0xd9,

75 
	mMARKER_SOS
 = 0xda,

76 
	mMARKER_DRI
 = 0xdd,

77 
	mMARKER_DQT
 = 0xdb,

78 
	mMARKER_DHT
 = 0xc4,

79 
	mMARKER_APP_FIRST
 = 0xe0,

80 
	mMARKER_APP_LAST
 = 0xef,

81 
	mMARKER_COMMENT
 = 0xfe,

84 cÚ¡ 
	glum_dc_cod–’s
[] = {

88 cÚ¡ 
	glum_dc_symbŞs
[] = {

92 cÚ¡ 
	glum_ac_cod–’s
[] = {

96 cÚ¡ 
	glum_ac_symbŞs
[] = {

120 cÚ¡ 
	gchm_dc_cod–’s
[] = {

124 cÚ¡ 
	gchm_dc_symbŞs
[] = {

128 cÚ¡ 
	gchm_ac_cod–’s
[] = {

132 cÚ¡ 
	gchm_ac_symbŞs
[] = {

156 
	$ü—‹HuffmªH—d”
(*& 
p
,

157 cÚ¡* 
cod–’s
,

158 
ncodes
,

159 cÚ¡* 
symbŞs
,

160 
nsymbŞs
,

161 
bËNo
, 
bËCÏss
) {

162 *
p
++ = 0xff; *p++ = 
MARKER_DHT
;

163 *
p
++ = 0;

164 *
p
++ = 3 + 
ncodes
 + 
nsymbŞs
;

165 *
p
++ = (
bËCÏss
 << 4è| 
bËNo
;

166 
	`memıy
(
p
, 
cod–’s
, 
ncodes
);

167 
p
 +ğ
ncodes
;

168 
	`memıy
(
p
, 
symbŞs
, 
nsymbŞs
);

169 
p
 +ğ
nsymbŞs
;

170 
	}
}

172 
	$compu‹JPEGH—d”Size
(
q’
, 
dri
) {

173 
q’_h®f
 = 
q’
/2;

174 
q’
 = 
q’_h®f
*2;

176 
numQbËs
 = 
q’
 > 64 ? 2 : 1;

177  485 + 
numQbËs
*5 + 
q’
 + (
dri
 > 0 ? 6 : 0);

178 
	}
}

180 
	$ü—‹JPEGH—d”
(* 
buf
, 
ty³
,

181 
w
, 
h
,

182 cÚ¡* 
qbËs
, 
q’
,

183 
dri
) {

184 *
±r
 = 
buf
;

185 
numQbËs
 = 
q’
 > 64 ? 2 : 1;

188 *
±r
++ = 0xFF; *±r++ = 
MARKER_SOI
;

191 *
±r
++ = 0xFF; *±r++ = 
MARKER_APP_FIRST
;

192 *
±r
++ = 0x00; *ptr++ = 0x10;

193 *
±r
++ = 'J'; *ptr++ = 'F'; *ptr++ = 'I'; *ptr++ = 'F'; *ptr++ = 0x00;

194 *
±r
++ = 0x01; *ptr++ = 0x01;

195 *
±r
++ = 0x00;

196 *
±r
++ = 0x00; *ptr++ = 0x01;

197 *
±r
++ = 0x00; *ptr++ = 0x01;

198 *
±r
++ = 0x00; *ptr++ = 0x00;

201 ià(
dri
 > 0) {

202 *
±r
++ = 0xFF; *±r++ = 
MARKER_DRI
;

203 *
±r
++ = 0x00; *ptr++ = 0x04;

204 *
±r
++ = (
BYTE
)(
dri
 >> 8); *ptr++ = (BYTE)(dri);

208 
bËSize
 = 
numQbËs
 =ğ1 ? 
q’
 : qtlen/2;

209 *
±r
++ = 0xFF; *±r++ = 
MARKER_DQT
;

210 *
±r
++ = 0x00; *±r++ = 
bËSize
 + 3;

211 *
±r
++ = 0x00;

212 
	`memıy
(
±r
, 
qbËs
, 
bËSize
);

213 
qbËs
 +ğ
bËSize
;

214 
±r
 +ğ
bËSize
;

216 ià(
numQbËs
 > 1) {

217 
bËSize
 = 
q’
 - qtlen/2;

219 *
±r
++ = 0xFF; *±r++ = 
MARKER_DQT
;

220 *
±r
++ = 0x00; *±r++ = 
bËSize
 + 3;

221 *
±r
++ = 0x01;

222 
	`memıy
(
±r
, 
qbËs
, 
bËSize
);

223 
qbËs
 +ğ
bËSize
;

224 
±r
 +ğ
bËSize
;

228 *
±r
++ = 0xFF; *±r++ = 
MARKER_SOF0
;

229 *
±r
++ = 0x00; *ptr++ = 0x11;

230 *
±r
++ = 0x08;

231 *
±r
++ = (
BYTE
)(
h
 >> 8);

232 *
±r
++ = (
BYTE
)(
h
);

233 *
±r
++ = (
BYTE
)(
w
 >> 8);

234 *
±r
++ = (
BYTE
)(
w
);

235 *
±r
++ = 0x03;

236 *
±r
++ = 0x01;

237 *
±r
++ = 
ty³
 ? 0x22 : 0x21;

238 *
±r
++ = 0x00;

239 *
±r
++ = 0x02;

240 *
±r
++ = 0x11;

241 *
±r
++ = 
numQbËs
 == 1 ? 0x00 : 0x01;

242 *
±r
++ = 0x03;

243 *
±r
++ = 0x11;

244 *
±r
++ = 
numQbËs
 == 1 ? 0x00 : 0x01;

246 
	`ü—‹HuffmªH—d”
(
±r
, 
lum_dc_cod–’s
, †um_dc_codelens,

247 
lum_dc_symbŞs
, †um_dc_symbols, 0, 0);

248 
	`ü—‹HuffmªH—d”
(
±r
, 
lum_ac_cod–’s
, †um_ac_codelens,

249 
lum_ac_symbŞs
, †um_ac_symbols, 0, 1);

250 
	`ü—‹HuffmªH—d”
(
±r
, 
chm_dc_cod–’s
,  chm_dc_codelens,

251 
chm_dc_symbŞs
,  chm_dc_symbols, 1, 0);

252 
	`ü—‹HuffmªH—d”
(
±r
, 
chm_ac_cod–’s
,  chm_ac_codelens,

253 
chm_ac_symbŞs
,  chm_ac_symbols, 1, 1);

256 *
±r
++ = 0xFF; *±r++ = 
MARKER_SOS
;

257 *
±r
++ = 0x00; *ptr++ = 0x0C;

258 *
±r
++ = 0x03;

259 *
±r
++ = 0x01;

260 *
±r
++ = 0x00;

261 *
±r
++ = 0x02;

262 *
±r
++ = 0x11;

263 *
±r
++ = 0x03;

264 *
±r
++ = 0x11;

265 *
±r
++ = 0x00;

266 *
±r
++ = 0x3F;

267 *
±r
++ = 0x00;

268 
	}
}

271 cÚ¡ 
	gdeçuÉQuªtiz”s
[128] = {

292 
	$makeDeçuÉQbËs
(* 
»suÉTabËs
, 
Q
) {

293 
çùÜ
 = 
Q
;

294 
q
;

296 ià(
Q
 < 1è
çùÜ
 = 1;

297 ià(
Q
 > 99è
çùÜ
 = 99;

299 ià(
Q
 < 50) {

300 
q
 = 5000 / 
çùÜ
;

302 
q
 = 200 - 
çùÜ
*2;

305 
i
 = 0; i < 128; ++i) {

306 
ÃwV®
 = (
deçuÉQuªtiz”s
[
i
]*
q
 + 50)/100;

307 ià(
ÃwV®
 < 1)‚ewVal = 1;

308 ià(
ÃwV®
 > 255)‚ewVal = 255;

309 
»suÉTabËs
[
i
] = 
ÃwV®
;

311 
	}
}

313 
BoŞ—n
 
	gJPEGVideoRTPSourû


314 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

315 & 
»suÉS³cŸlH—d”Size
) {

316 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

317 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

319 * 
qbËs
 = 
NULL
;

320 
q’
 = 0;

321 
dri
 = 0;

333 ià(
·ck‘Size
 < 8è 
F®£
;

335 
»suÉS³cŸlH—d”Size
 = 8;

337 
Off£t
 = ()((
DWORD
)
h—d”S¹
[1] << 16 | (DWORD)headerStart[2] << 8 | (DWORD)headerStart[3]);

338 
Ty³
 = ()
h—d”S¹
[4];

339 
ty³
 = 
Ty³
 & 1;

340 
Q
 = ()
h—d”S¹
[5];

341 
width
 = ()
h—d”S¹
[6] * 8;

342 
height
 = ()
h—d”S¹
[7] * 8;

343 ià((
width
 =ğ0 || 
height
 =ğ0è&& 
fDeçuÉWidth
 !ğ0 && 
fDeçuÉHeight
 != 0) {

345 
width
 = 
fDeçuÉWidth
;

346 
height
 = 
fDeçuÉHeight
;

348 ià(
width
 == 0) width = 256*8;

349 ià(
height
 == 0) height = 256*8;

351 ià(
Ty³
 > 63) {

360 ià(
·ck‘Size
 < 
»suÉS³cŸlH—d”Size
 + 4è 
F®£
;

362 
Re¡¬tIÁ”v®
 = ()((
WORD
)
h—d”S¹
[
»suÉS³cŸlH—d”Size
] << 8 | (WORD)headerStart[resultSpecialHeaderSize + 1]);

363 
dri
 = 
Re¡¬tIÁ”v®
;

364 
»suÉS³cŸlH—d”Size
 += 4;

367 ià(
Off£t
 == 0) {

368 ià(
Q
 > 127) {

380 ià(
·ck‘Size
 < 
»suÉS³cŸlH—d”Size
 + 4è 
F®£
;

382 
MBZ
 = ()
h—d”S¹
[
»suÉS³cŸlH—d”Size
];

383 ià(
MBZ
 == 0) {

385 
L’gth
 = ()((
WORD
)
h—d”S¹
[
»suÉS³cŸlH—d”Size
 + 2] << 8 | (WORD)headerStart[resultSpecialHeaderSize + 3]);

389 
»suÉS³cŸlH—d”Size
 += 4;

391 ià(
·ck‘Size
 < 
»suÉS³cŸlH—d”Size
 + 
L’gth
è 
F®£
;

393 
q’
 = 
L’gth
;

394 
qbËs
 = &
h—d”S¹
[
»suÉS³cŸlH—d”Size
];

396 
»suÉS³cŸlH—d”Size
 +ğ
L’gth
;

409 ià(
Off£t
 == 0) {

410 
ÃwQbËs
[128];

411 ià(
q’
 == 0) {

414 
	`makeDeçuÉQbËs
(
ÃwQbËs
, 
Q
);

415 
qbËs
 = 
ÃwQbËs
;

416 
q’
 =  
ÃwQbËs
;

419 
hd¾’
 = 
	`compu‹JPEGH—d”Size
(
q’
, 
dri
);

420 
»suÉS³cŸlH—d”Size
 -ğ
hd¾’
;

421 
h—d”S¹
 +ğ()
»suÉS³cŸlH—d”Size
;

422 
	`ü—‹JPEGH—d”
(
h—d”S¹
, 
ty³
, 
width
, 
height
, 
qbËs
, 
q’
, 
dri
);

425 
fCu¼’tPack‘BegšsF¿me
 = (
Off£t
 == 0);

428 ((
JPEGBufã»dPack‘
*)
·ck‘
)->
com¶‘esF¿me


429 ğ
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

431  
True
;

432 
	}
}

434 cÚ¡* 
	gJPEGVideoRTPSourû
::
	$MIMEty³
() const {

436 
	}
}

440 
	gJPEGBufã»dPack‘
::
	$»£t
() {

441 
Bufã»dPack‘
::
	`»£t
();

445 
off£t
 = 
MAX_JPEG_HEADER_SIZE
;

446 ià(
off£t
 > 
fPack‘Size
) offset = fPacketSize;

447 
fH—d
 = 
fTa
 = 
off£t
;

448 
	}
}

450 
	gJPEGBufã»dPack‘


451 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

454 ià(
com¶‘esF¿me
 && 
d©aSize
 >= 2 &&

455 !(
äamePŒ
[
d©aSize
-2] =ğ0xFF && f¿mePŒ[d©aSize-1] =ğ
MARKER_EOI
)) {

456 
äamePŒ
[
d©aSize
++] = 0xFF;

457 
äamePŒ
[
d©aSize
++] = 
MARKER_EOI
;

459  
d©aSize
;

460 
	}
}

462 
Bufã»dPack‘
* 
	gJPEGBufã»dPack‘FaùÜy


463 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* ) {

464  
Ãw
 
JPEGBufã»dPack‘
;

465 
	}
}

	@liveMedia/JPEGVideoSource.cpp

21 
	~"JPEGVideoSourû.hh
"

23 
	gJPEGVideoSourû
::
	$JPEGVideoSourû
(
U§geEnvœÚm’t
& 
’v
)

24 : 
	$F¿medSourû
(
’v
) {

25 
	}
}

27 
JPEGVideoSourû
::~
	$JPEGVideoSourû
() {

28 
	}
}

30 
u_št8_t
 cÚ¡* 
JPEGVideoSourû
::
	$quªtiz©iÚTabËs
(
u_št8_t
& 
´ecisiÚ
,

31 
u_št16_t
& 
Ëngth
) {

33 
´ecisiÚ
 = 0;

34 
Ëngth
 = 0;

35  
NULL
;

36 
	}
}

38 
u_št16_t
 
	gJPEGVideoSourû
::
	$»¡¬tIÁ”v®
() {

41 
	}
}

43 
BoŞ—n
 
	gJPEGVideoSourû
::
	$isJPEGVideoSourû
() const {

44  
True
;

45 
	}
}

	@liveMedia/Locale.cpp

22 
	~"LoÿË.hh
"

23 
	~<¡rDup.hh
>

25 
	gLoÿË
::
	$LoÿË
(cÚ¡* 
ÃwLoÿË
, 
LoÿËC©egÜy
 
ÿ‹gÜy
) {

26 #iâdeà
LOCALE_NOT_USED


27 #iâdeà
XLOCALE_NOT_USED


28 
ÿ‹gÜyMask
;

29 
ÿ‹gÜy
) {

30 
AÎ
: { 
ÿ‹gÜyMask
 = 
LC_ALL_MASK
; ; }

31 
Num”ic
: { 
ÿ‹gÜyMask
 = 
LC_NUMERIC_MASK
; ; }

33 
fLoÿË
 = 
	`ÃwloÿË
(
ÿ‹gÜyMask
, 
ÃwLoÿË
, 
NULL
);

34 
fP»vLoÿË
 = 
	`u£loÿË
(
fLoÿË
);

36 
ÿ‹gÜy
) {

37 
AÎ
: { 
fC©egÜyNum
 = 
LC_ALL
; ; }

38 
Num”ic
: { 
fC©egÜyNum
 = 
LC_NUMERIC
; ; }

40 
fP»vLoÿË
 = 
	`¡rDup
(
	`£oÿË
(
fC©egÜyNum
, 
NULL
));

41 
	`£oÿË
(
fC©egÜyNum
, 
ÃwLoÿË
);

44 
	}
}

46 
	gLoÿË
::~
	$LoÿË
() {

47 #iâdeà
LOCALE_NOT_USED


48 #iâdeà
XLOCALE_NOT_USED


49 ià(
fLoÿË
 !ğ(
loÿË_t
)0) {

50 
	`u£loÿË
(
fP»vLoÿË
);

51 
	`ä“loÿË
(
fLoÿË
);

54 ià(
fP»vLoÿË
 !ğ
NULL
) {

55 
	`£oÿË
(
fC©egÜyNum
, 
fP»vLoÿË
);

56 
d–‘e
[] 
fP»vLoÿË
;

60 
	}
}

	@liveMedia/MP3ADU.cpp

21 
	~"MP3ADU.hh
"

22 
	~"MP3ADUdesütÜ.hh
"

23 
	~"MP3IÁ”Çls.hh
"

24 
	~<¡ršg.h
>

26 #ifdeà
TEST_LOSS


27 
	~"GroupsockH–³r.hh
"

32 
	#Segm’tBufSize
 2000

	)

34 şas 
	cSegm’t
 {

35 
	mpublic
:

36 
buf
[
Segm’tBufSize
];

37 * 
	$d©aS¹
(è{  &
buf
[
desütÜSize
]; }

38 
äameSize
;

39 
	`d©aH”e
();

41 
desütÜSize
;

42 cÚ¡ 
h—d”Size
;

43 
sideInfoSize
, 
aduSize
;

44 
backpoš‹r
;

46 
timev®
 
´e£Á©iÚTime
;

47 
du¿tiÚInMiüo£cÚds
;

48 
	}
};

50 cÚ¡ 
	gSegm’t
::
h—d”Size
 = 4;

52 
	#Segm’tQueueSize
 20

	)

54 şas 
	cSegm’tQueue
 {

55 
	mpublic
:

56 
	$Segm’tQueue
(
BoŞ—n
 
dœeùiÚIsToADU
, BoŞ—À
šşudeADUdesütÜs
)

57 : 
	`fDœeùiÚIsToADU
(
dœeùiÚIsToADU
),

58 
	$fInşudeADUdesütÜs
(
šşudeADUdesütÜs
) {

59 
	`»£t
();

62 
Segm’t
 
s
[
Segm’tQueueSize
];

64 
	$h—dIndex
(è{ 
fH—dIndex
;
	}
}

65 
	gSegm’t
& 
	$h—dSegm’t
(è{ 
s
[
fH—dIndex
];
	}
}

67 
	$ÃxtF»eIndex
(è{ 
fNextF»eIndex
;
	}
}

68 
	gSegm’t
& 
	$ÃxtF»eSegm’t
(è{ 
s
[
fNextF»eIndex
];
	}
}

69 
BoŞ—n
 
	$isEm±y
(è{ 
	`isEm±yOrFuÎ
(è&& 
	`tÙ®D©aSize
(è=ğ0;
	}
}

70 
BoŞ—n
 
	$isFuÎ
(è{ 
	`isEm±yOrFuÎ
(è&& 
	`tÙ®D©aSize
(è> 0;
	}
}

72 
	$ÃxtIndex
(
ix
è{ (ix+1)%
Segm’tQueueSize
;
	}
}

73 
	$´evIndex
(
ix
è{ (ix+
Segm’tQueueSize
-1)%Segm’tQueueSize;
	}
}

75 
	$tÙ®D©aSize
(è{ 
fTÙ®D©aSize
;
	}
}

77 
’queueNewSegm’t
(
F¿medSourû
* 
šputSourû
, F¿medSourû* 
usšgSourû
);

79 
BoŞ—n
 
dequeue
();

81 
BoŞ—n
 
š£¹DummyBefÜeTa
(
backpoš‹r
);

83 
	$»£t
(è{ 
fH—dIndex
 = 
fNextF»eIndex
 = 
fTÙ®D©aSize
 = 0; 
	}
}

85 
	g´iv©e
:

86 
sqAá”G‘tšgSegm’t
(* 
ş›ÁD©a
,

87 
numBy‹sR—d
,

88 
numTrunÿ‹dBy‹s
,

89 
timev®
 
´e£Á©iÚTime
,

90 
du¿tiÚInMiüo£cÚds
);

92 
BoŞ—n
 
sqAá”G‘tšgCommÚ
(
Segm’t
& 
£g
, 
numBy‹sR—d
);

93 
BoŞ—n
 
	$isEm±yOrFuÎ
(è{ 
	`h—dIndex
(è=ğ
	`ÃxtF»eIndex
();
	}
}

95 
	gfH—dIndex
, 
	gfNextF»eIndex
, 
	gfTÙ®D©aSize
;

98 
F¿medSourû
* 
	gfUsšgSourû
;

102 
BoŞ—n
 
	gfDœeùiÚIsToADU
;

106 
BoŞ—n
 
	gfInşudeADUdesütÜs
;

111 
	gADUFromMP3Sourû
::
	$ADUFromMP3Sourû
(
U§geEnvœÚm’t
& 
’v
,

112 
F¿medSourû
* 
šputSourû
,

113 
BoŞ—n
 
šşudeADUdesütÜs
)

114 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

115 
	`fA»EnqueuešgMP3F¿me
(
F®£
),

116 
	`fSegm’ts
(
Ãw
 
	`Segm’tQueue
(
True
 ,

117 
F®£
 )),

118 
	`fInşudeADUdesütÜs
(
šşudeADUdesütÜs
),

119 
	`fTÙ®D©aSizeBefÜeP»viousR—d
(0), 
	`fSÿË
(1), 
	$fF¿meCouÁ”
(0) {

120 
	}
}

122 
	gADUFromMP3Sourû
::~
	$ADUFromMP3Sourû
() {

123 
d–‘e
 
fSegm’ts
;

124 
	}
}

127 cÚ¡* 
	gADUFromMP3Sourû
::
	$MIMEty³
() const {

129 
	}
}

131 
ADUFromMP3Sourû
* 
	gADUFromMP3Sourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

132 
F¿medSourû
* 
šputSourû
,

133 
BoŞ—n
 
šşudeADUdesütÜs
) {

135 ià(
	`¡rcmp
(
šputSourû
->
	`MIMEty³
(), "audio/MPEG") != 0) {

136 
’v
.
	`£tResuÉMsg
(
šputSourû
->
	`Çme
(), " is‚ot‡n MPEG‡udio source");

137  
NULL
;

140  
Ãw
 
	`ADUFromMP3Sourû
(
’v
, 
šputSourû
, 
šşudeADUdesütÜs
);

141 
	}
}

143 
	gADUFromMP3Sourû
::
	$»£tIÅut
() {

144 
fSegm’ts
->
	`»£t
();

145 
	}
}

147 
BoŞ—n
 
	gADUFromMP3Sourû
::
	$£tSÿËFaùÜ
(
sÿË
) {

148 ià(
sÿË
 < 1è 
F®£
;

149 
fSÿË
 = 
sÿË
;

150  
True
;

151 
	}
}

153 
	gADUFromMP3Sourû
::
	$doG‘NextF¿me
() {

154 ià(!
fA»EnqueuešgMP3F¿me
) {

156 
fTÙ®D©aSizeBefÜeP»viousR—d
 = 
fSegm’ts
->
	`tÙ®D©aSize
();

157 
fA»EnqueuešgMP3F¿me
 = 
True
;

158 
fSegm’ts
->
	`’queueNewSegm’t
(
fIÅutSourû
, 
this
);

161 
fA»EnqueuešgMP3F¿me
 = 
F®£
;

163 ià(!
	`doG‘NextF¿me1
()) {

165 
	`hªdËClosu»
();

168 
	}
}

170 
BoŞ—n
 
	gADUFromMP3Sourû
::
	$doG‘NextF¿me1
() {

173 
Index
;

174 
Segm’t
* 
Seg
;

175 
BoŞ—n
 
ÃedMÜeD©a
;

177 ià(
fSegm’ts
->
	`isEm±y
()) {

178 
ÃedMÜeD©a
 = 
True
;

179 
Seg
 = 
NULL
; 
Index
 = 0;

181 
Index
 = 
Segm’tQueue
::
	`´evIndex
(
fSegm’ts
->
	`ÃxtF»eIndex
());

182 
Seg
 = &(
fSegm’ts
->
s
[
Index
]);

184 
ÃedMÜeD©a


185 ğ
fTÙ®D©aSizeBefÜeP»viousR—d
 < 
Seg
->
backpoš‹r


186 || 
Seg
->
backpoš‹r
 +aSeg->
	`d©aH”e
(è<aSeg->
aduSize
;

189 ià(
ÃedMÜeD©a
) {

192 
	`doG‘NextF¿me
();

193  
True
;

197 
fF¿meSize
 = 
Seg
->
h—d”Size
+Seg->
sideInfoSize
+Seg->
aduSize
;

198 
fP»£Á©iÚTime
 = 
Seg
->
´e£Á©iÚTime
;

199 
fDu¿tiÚInMiüo£cÚds
 = 
Seg
->
du¿tiÚInMiüo£cÚds
;

200 
desütÜSize


201 ğ
fInşudeADUdesütÜs
 ? 
ADUdesütÜ
::
	`compu‹Size
(
fF¿meSize
) : 0;

202 #ifdeà
DEBUG


203 
	`årštf
(
¡d”r
, "m->a:ouu‰šg ADU %d<-%d,‚br:%d, sis:%d, dh:%d, (desütÜ size: %d)\n", 
Seg
->
aduSize
,aSeg->
backpoš‹r
, 
fF¿meSize
,aSeg->
sideInfoSize
,aSeg->
	`d©aH”e
(), 
desütÜSize
);

205 ià(
desütÜSize
 + 
fF¿meSize
 > 
fMaxSize
) {

206 
	`’vœ
() << "ADUFromMP3Source::doGetNextFrame1():‚otƒnough„oom ("

207 << 
desütÜSize
 + 
fF¿meSize
 << ">"

208 << 
fMaxSize
 << ")\n";

209 
fF¿meSize
 = 0;

210  
F®£
;

213 * 
toPŒ
 = 
fTo
;

215 ià(
fInşudeADUdesütÜs
) {

216 
fF¿meSize
 +ğ
ADUdesütÜ
::
	`g’”©eDesütÜ
(
toPŒ
, fFrameSize);

220 
	`memmove
(
toPŒ
, 
Seg
->
	`d©aS¹
(),

221 
Seg
->
h—d”Size
 +aSeg->
sideInfoSize
);

222 
toPŒ
 +ğ
Seg
->
h—d”Size
 +aSeg->
sideInfoSize
;

225 
off£t
 = 0;

226 
i
 = 
Index
;

227 
´evBy‹s
 = 
Seg
->
backpoš‹r
;

228 
´evBy‹s
 > 0) {

229 
i
 = 
Segm’tQueue
::
	`´evIndex
(i);

230 
d©aH”e
 = 
fSegm’ts
->
s
[
i
].
	`d©aH”e
();

231 ià(
d©aH”e
 < 
´evBy‹s
) {

232 
´evBy‹s
 -ğ
d©aH”e
;

234 
off£t
 = 
d©aH”e
 - 
´evBy‹s
;

240 
fSegm’ts
->
	`h—dIndex
(è!ğ
i
) {

241 
fSegm’ts
->
	`dequeue
();

244 
by‹sToU£
 = 
Seg
->
aduSize
;

245 
by‹sToU£
 > 0) {

246 
Segm’t
& 
£g
 = 
fSegm’ts
->
s
[
i
];

247 * 
äomPŒ


248 ğ&
£g
.
	`d©aS¹
()[£g.
h—d”Size
 + seg.
sideInfoSize
 + 
off£t
];

249 
d©aH”e
 = 
£g
.
	`d©aH”e
(è- 
off£t
;

250 
by‹sU£dH”e
 = 
d©aH”e
 < 
by‹sToU£
 ? dataHere : bytesToUse;

251 
	`memmove
(
toPŒ
, 
äomPŒ
, 
by‹sU£dH”e
);

252 
by‹sToU£
 -ğ
by‹sU£dH”e
;

253 
toPŒ
 +ğ
by‹sU£dH”e
;

254 
off£t
 = 0;

255 
i
 = 
Segm’tQueue
::
	`ÃxtIndex
(i);

259 ià(
fF¿meCouÁ”
++%
fSÿË
 == 0) {

262 
	`aá”G‘tšg
(
this
);

265 
	`doG‘NextF¿me
();

268  
True
;

269 
	}
}

274 
	gMP3FromADUSourû
::
	$MP3FromADUSourû
(
U§geEnvœÚm’t
& 
’v
,

275 
F¿medSourû
* 
šputSourû
,

276 
BoŞ—n
 
šşudeADUdesütÜs
)

277 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

278 
	`fA»EnqueuešgADU
(
F®£
),

279 
	`fSegm’ts
(
Ãw
 
	$Segm’tQueue
(
F®£
 ,

280 
šşudeADUdesütÜs
)) {

281 
	}
}

283 
	gMP3FromADUSourû
::~
	$MP3FromADUSourû
() {

284 
d–‘e
 
fSegm’ts
;

285 
	}
}

287 cÚ¡* 
	gMP3FromADUSourû
::
	$MIMEty³
() const {

289 
	}
}

291 
MP3FromADUSourû
* 
	gMP3FromADUSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

292 
F¿medSourû
* 
šputSourû
,

293 
BoŞ—n
 
šşudeADUdesütÜs
) {

295 ià(
	`¡rcmp
(
šputSourû
->
	`MIMEty³
(), "audio/MPA-ROBUST") != 0) {

296 
’v
.
	`£tResuÉMsg
(
šputSourû
->
	`Çme
(), " is‚ot‡n MP3 ADU source");

297  
NULL
;

300  
Ãw
 
	`MP3FromADUSourû
(
’v
, 
šputSourû
, 
šşudeADUdesütÜs
);

301 
	}
}

304 
	gMP3FromADUSourû
::
	$doG‘NextF¿me
() {

305 ià(
fA»EnqueuešgADU
è
	`š£¹DummyADUsIfNeûs§ry
();

306 
fA»EnqueuešgADU
 = 
F®£
;

308 ià(
	`ÃedToG‘AnADU
()) {

310 #ifdeà
TEST_LOSS


311 
NOTE
: 
This
 
code
 
no
 
lÚg”
 
wÜks
, 
beÿu£
 
™
 
u£s
 
synchrÚous
 
»ads
,

312 
which
 
¬e
 
no
 
lÚg”
 
suµÜ‹d
.

313 cÚ¡ 
äamesP”Pack‘
 = 10;

314 cÚ¡ 
äameCouÁ
 = 0;

315 
BoŞ—n
 
·ck‘IsLo¡
;

317 ià((
äameCouÁ
++)%
äamesP”Pack‘
 == 0) {

318 
·ck‘IsLo¡
 = (
	`our_¿ndom
()%10 == 0);

321 ià(
·ck‘IsLo¡
) {

324 
Segm’t
 
dummySegm’t
;

325 
numBy‹sR—d
;

326 
timev®
 
´e£Á©iÚTime
;

328 
fIÅutSourû
->
	`syncG‘NextF¿me
(
dummySegm’t
.
buf
,

329  
dummySegm’t
.
buf
, 
numBy‹sR—d
,

330 
´e£Á©iÚTime
);

337 
fA»EnqueuešgADU
 = 
True
;

338 
fSegm’ts
->
	`’queueNewSegm’t
(
fIÅutSourû
, 
this
);

341 
	`g’”©eF¿meFromH—dADU
();

346 
	`aá”G‘tšg
(
this
);

348 
	}
}

350 
BoŞ—n
 
	gMP3FromADUSourû
::
	$ÃedToG‘AnADU
() {

353 
BoŞ—n
 
ÃedToEnqueue
 = 
True
;

355 ià(!
fSegm’ts
->
	`isEm±y
()) {

356 
šdex
 = 
fSegm’ts
->
	`h—dIndex
();

357 
Segm’t
* 
£g
 = &(
fSegm’ts
->
	`h—dSegm’t
());

358 cÚ¡ 
’dOfH—dF¿me
 = (è
£g
->
	`d©aH”e
();

359 
äameOff£t
 = 0;

362 
’dOfD©a
 = 
äameOff£t
 - 
£g
->
backpoš‹r
 + seg->
aduSize
;

363 ià(
’dOfD©a
 >ğ
’dOfH—dF¿me
) {

365 
ÃedToEnqueue
 = 
F®£
;

369 
äameOff£t
 +ğ
£g
->
	`d©aH”e
();

370 
šdex
 = 
Segm’tQueue
::
	`ÃxtIndex
(index);

371 ià(
šdex
 =ğ
fSegm’ts
->
	`ÃxtF»eIndex
()) ;

372 
£g
 = &(
fSegm’ts
->
s
[
šdex
]);

376  
ÃedToEnqueue
;

377 
	}
}

379 
	gMP3FromADUSourû
::
	$š£¹DummyADUsIfNeûs§ry
() {

380 ià(
fSegm’ts
->
	`isEm±y
()) ;

388 
Index


389 ğ
Segm’tQueue
::
	`´evIndex
(
fSegm’ts
->
	`ÃxtF»eIndex
());

390 
Segm’t
* 
Seg
 = &(
fSegm’ts
->
s
[
Index
]);

393 
´evADU’d
;

394 ià(
fSegm’ts
->
	`h—dIndex
(è!ğ
Index
) {

396 
´evIndex
 = 
Segm’tQueue
::
	`´evIndex
(
Index
);

397 
Segm’t
& 
´evSegm’t
 = 
fSegm’ts
->
s
[
´evIndex
];

398 
´evADU’d
 = 
´evSegm’t
.
	`d©aH”e
(è+…»vSegm’t.
backpoš‹r
;

399 ià(
´evSegm’t
.
aduSize
 > 
´evADU’d
) {

401 
´evADU’d
 = 0;

403 
´evADU’d
 -ğ
´evSegm’t
.
aduSize
;

406 
´evADU’d
 = 0;

409 ià(
Seg
->
backpoš‹r
 > 
´evADU’d
) {

411 #ifdeà
DEBUG


412 
	`årštf
(
¡d”r
, "a->m:ÃedØš£¹‡ dummy ADU (%d, %d, %dè[%d, %d]\n", 
Seg
->
backpoš‹r
, 
´evADU’d
,aSeg->
	`d©aH”e
(), 
fSegm’ts
->
	`h—dIndex
(), fSegm’ts->
	`ÃxtF»eIndex
());

414 
Index
 = 
fSegm’ts
->
	`ÃxtF»eIndex
();

415 ià(!
fSegm’ts
->
	`š£¹DummyBefÜeTa
(
´evADU’d
)) ;

416 
Seg
 = &(
fSegm’ts
->
s
[
Index
]);

421 
	}
}

423 
BoŞ—n
 
	gMP3FromADUSourû
::
	$g’”©eF¿meFromH—dADU
() {

425 ià(
fSegm’ts
->
	`isEm±y
()è 
F®£
;

426 
šdex
 = 
fSegm’ts
->
	`h—dIndex
();

427 
Segm’t
* 
£g
 = &(
fSegm’ts
->
	`h—dSegm’t
());

428 #ifdeà
DEBUG


429 
	`årštf
(
¡d”r
, "a->m:ouu‰šg f¿mfÜ %d<-%d (f %d, dh %d), (desütÜSize: %d)\n", 
£g
->
aduSize
, seg->
backpoš‹r
, seg->
äameSize
, seg->
	`d©aH”e
(), seg->
desütÜSize
);

431 * 
toPŒ
 = 
fTo
;

434 
fF¿meSize
 = 
£g
->
äameSize
;

435 
fP»£Á©iÚTime
 = 
£g
->
´e£Á©iÚTime
;

436 
fDu¿tiÚInMiüo£cÚds
 = 
£g
->
du¿tiÚInMiüo£cÚds
;

437 
	`memmove
(
toPŒ
, 
£g
->
	`d©aS¹
(), seg->
h—d”Size
 + seg->
sideInfoSize
);

438 
toPŒ
 +ğ
£g
->
h—d”Size
 + seg->
sideInfoSize
;

441 
by‹sToZ”o
 = 
£g
->
	`d©aH”e
();

442 
i
 = 0; i < 
by‹sToZ”o
; ++i) {

443 
toPŒ
[
i
] = '\0';

448 
äameOff£t
 = 0;

449 
toOff£t
 = 0;

450 cÚ¡ 
’dOfH—dF¿me
 = 
£g
->
	`d©aH”e
();

452 
toOff£t
 < 
’dOfH—dF¿me
) {

453 
¡¬tOfD©a
 = 
äameOff£t
 - 
£g
->
backpoš‹r
;

454 ià(
¡¬tOfD©a
 > ()
’dOfH—dF¿me
) ;

456 
’dOfD©a
 = 
¡¬tOfD©a
 + 
£g
->
aduSize
;

457 ià(
’dOfD©a
 > ()
’dOfH—dF¿me
) {

458 
’dOfD©a
 = 
’dOfH—dF¿me
;

461 
äomOff£t
;

462 ià(
¡¬tOfD©a
 <ğ()
toOff£t
) {

463 
äomOff£t
 = 
toOff£t
 - 
¡¬tOfD©a
;

464 
¡¬tOfD©a
 = 
toOff£t
;

465 ià(
’dOfD©a
 < 
¡¬tOfD©a
)ƒndOfData = startOfData;

467 
äomOff£t
 = 0;

470 
by‹sToZ”o
 = 
¡¬tOfD©a
 - 
toOff£t
;

471 #ifdeà
DEBUG


472 ià(
by‹sToZ”o
 > 0è
	`årštf
(
¡d”r
, "a->m:ouu‰šg %d z”Øby‹ (%d, %d, %d, %d)\n", by‹sToZ”o, 
¡¬tOfD©a
, 
toOff£t
, 
äameOff£t
, 
£g
->
backpoš‹r
);

474 
toOff£t
 +ğ
by‹sToZ”o
;

477 * 
äomPŒ


478 ğ&
£g
->
	`d©aS¹
()[£g->
h—d”Size
 + seg->
sideInfoSize
 + 
äomOff£t
];

479 
by‹sU£dH”e
 = 
’dOfD©a
 - 
¡¬tOfD©a
;

480 #ifdeà
DEBUG


481 ià(
by‹sU£dH”e
 > 0è
	`årštf
(
¡d”r
, "a->m:ouu‰šg %d by‹ äom %d<-%d\n", by‹sU£dH”e, 
£g
->
aduSize
, seg->
backpoš‹r
);

483 
	`memmove
(
toPŒ
 + 
toOff£t
, 
äomPŒ
, 
by‹sU£dH”e
);

484 
toOff£t
 +ğ
by‹sU£dH”e
;

486 
äameOff£t
 +ğ
£g
->
	`d©aH”e
();

487 
šdex
 = 
Segm’tQueue
::
	`ÃxtIndex
(index);

488 ià(
šdex
 =ğ
fSegm’ts
->
	`ÃxtF»eIndex
()) ;

489 
£g
 = &(
fSegm’ts
->
s
[
šdex
]);

492 
fSegm’ts
->
	`dequeue
();

494  
True
;

495 
	}
}

500 
	gSegm’t
::
	$d©aH”e
() {

501 
»suÉ
 = 
äameSize
 - (
h—d”Size
 + 
sideInfoSize
);

502 ià(
»suÉ
 < 0) {

506  ()
»suÉ
;

507 
	}
}

511 
	gSegm’tQueue
::
	$’queueNewSegm’t
(
F¿medSourû
* 
šputSourû
,

512 
F¿medSourû
* 
usšgSourû
) {

513 ià(
	`isFuÎ
()) {

514 
usšgSourû
->
	`’vœ
() << "SegmentQueue::enqueueNewSegment() overflow\n";

515 
usšgSourû
->
	`hªdËClosu»
();

519 
fUsšgSourû
 = 
usšgSourû
;

521 
Segm’t
& 
£g
 = 
	`ÃxtF»eSegm’t
();

522 
šputSourû
->
	`g‘NextF¿me
(
£g
.
buf
,  seg.buf,

523 
sqAá”G‘tšgSegm’t
, 
this
,

524 
F¿medSourû
::
hªdËClosu»
, 
usšgSourû
);

525 
	}
}

527 
	gSegm’tQueue
::
	$sqAá”G‘tšgSegm’t
(* 
ş›ÁD©a
,

528 
numBy‹sR—d
,

530 
timev®
 
´e£Á©iÚTime
,

531 
du¿tiÚInMiüo£cÚds
) {

532 
Segm’tQueue
* 
£gQueue
 = (Segm’tQueue*)
ş›ÁD©a
;

533 
Segm’t
& 
£g
 = 
£gQueue
->
	`ÃxtF»eSegm’t
();

535 
£g
.
´e£Á©iÚTime
 =…resentationTime;

536 
£g
.
du¿tiÚInMiüo£cÚds
 = durationInMicroseconds;

538 ià(
£gQueue
->
	`sqAá”G‘tšgCommÚ
(
£g
, 
numBy‹sR—d
)) {

539 #ifdeà
DEBUG


540 cÚ¡* 
dœeùiÚ
 = 
£gQueue
->
fDœeùiÚIsToADU
 ? "m->a" : "a->m";

541 
	`årštf
(
¡d”r
, "%s:»ad f¿m%d<-%d, fs:%d, sis:%d, dh:%d, (desütÜ size: %d)\n", 
dœeùiÚ
, 
£g
.
aduSize
, seg.
backpoš‹r
, seg.
äameSize
, seg.
sideInfoSize
, seg.
	`d©aH”e
(), seg.
desütÜSize
);

546 
£gQueue
->
fUsšgSourû
->
	`doG‘NextF¿me
();

547 
	}
}

550 
BoŞ—n
 
	gSegm’tQueue
::
	$sqAá”G‘tšgCommÚ
(
Segm’t
& 
£g
,

551 
numBy‹sR—d
) {

552 * 
äomPŒ
 = 
£g
.
buf
;

554 ià(
fInşudeADUdesütÜs
) {

557 ()
ADUdesütÜ
::
	`g‘RemaššgF¿meSize
(
äomPŒ
);

558 
£g
.
desütÜSize
 = ()(
äomPŒ
-£g.
buf
);

560 
£g
.
desütÜSize
 = 0;

564 
hdr
;

565 
MP3SideInfo
 
sideInfo
;

566 ià(!
	`G‘ADUInfoFromMP3F¿me
(
äomPŒ
, 
numBy‹sR—d
,

567 
hdr
, 
£g
.
äameSize
,

568 
sideInfo
, 
£g
.
sideInfoSize
,

569 
£g
.
backpoš‹r
, seg.
aduSize
)) {

570  
F®£
;

576 ià(!
fDœeùiÚIsToADU
) {

577 
ÃwADUSize


578 ğ
numBy‹sR—d
 - 
£g
.
desütÜSize
 - 4 - seg.
sideInfoSize
;

579 ià(
ÃwADUSize
 > 
£g
.
aduSize
) seg.aduSize =‚ewADUSize;

581 
fTÙ®D©aSize
 +ğ
£g
.
	`d©aH”e
();

582 
fNextF»eIndex
 = 
	`ÃxtIndex
(fNextFreeIndex);

584  
True
;

585 
	}
}

587 
BoŞ—n
 
	gSegm’tQueue
::
	$dequeue
() {

588 ià(
	`isEm±y
()) {

589 
fUsšgSourû
->
	`’vœ
() << "SegmentQueue::dequeue(): underflow!\n";

590  
F®£
;

593 
Segm’t
& 
£g
 = 
s
[
	`h—dIndex
()];

594 
fTÙ®D©aSize
 -ğ
£g
.
	`d©aH”e
();

595 
fH—dIndex
 = 
	`ÃxtIndex
(fHeadIndex);

596  
True
;

597 
	}
}

599 
BoŞ—n
 
	gSegm’tQueue
::
	$š£¹DummyBefÜeTa
(
backpoš‹r
) {

600 ià(
	`isEm±yOrFuÎ
()è 
F®£
;

605 
ÃwTaIndex
 = 
	`ÃxtF»eIndex
();

606 
Segm’t
& 
ÃwTaSeg
 = 
s
[
ÃwTaIndex
];

608 
ŞdTaIndex
 = 
	`´evIndex
(
ÃwTaIndex
);

609 
Segm’t
& 
ŞdTaSeg
 = 
s
[
ŞdTaIndex
];

611 
ÃwTaSeg
 = 
ŞdTaSeg
;

614 * 
±r
 = 
ŞdTaSeg
.
buf
;

615 ià(
fInşudeADUdesütÜs
) {

616 
»maššgF¿meSize


617 ğ
ŞdTaSeg
.
h—d”Size
 + oldTaSeg.
sideInfoSize
 + 0 ;

618 
cu¼’tDesütÜSize
 = 
ŞdTaSeg
.
desütÜSize
;

620 ià(
cu¼’tDesütÜSize
 == 2) {

621 
ADUdesütÜ
::
	`g’”©eTwoBy‹DesütÜ
(
±r
, 
»maššgF¿meSize
);

623 ()
ADUdesütÜ
::
	`g’”©eDesütÜ
(
±r
, 
»maššgF¿meSize
);

628 ià(!
	`Z”oOutMP3SideInfo
(
±r
, 
ŞdTaSeg
.
äameSize
,

629 
backpoš‹r
)è 
F®£
;

631 
dummyNumBy‹sR—d


632 ğ
ŞdTaSeg
.
desütÜSize
 + 4 + oldTaSeg.
sideInfoSize
;

633  
	`sqAá”G‘tšgCommÚ
(
ŞdTaSeg
, 
dummyNumBy‹sR—d
);

634 
	}
}

	@liveMedia/MP3ADURTPSink.cpp

21 
	~"MP3ADURTPSšk.hh
"

23 
	gMP3ADURTPSšk
::
	$MP3ADURTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

24 
RTPPaylßdTy³
)

25 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 
RTPPaylßdTy³
, 90000, "MPA-ROBUST") {

26 
	}
}

28 
	gMP3ADURTPSšk
::~
	$MP3ADURTPSšk
() {

29 
	}
}

31 
MP3ADURTPSšk
*

32 
MP3ADURTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

33 
RTPPaylßdTy³
) {

34  
Ãw
 
	`MP3ADURTPSšk
(
’v
, 
RTPgs
, 
RTPPaylßdTy³
);

35 
	}
}

37 
	$badD©aSize
(
U§geEnvœÚm’t
& 
’v
, 
numBy‹sInF¿me
) {

38 
’v
 << "MP3ADURTPSink::doSpecialFrameHandling(): invalid size ("

39 << 
numBy‹sInF¿me
 << ") of‚on-fragmented input ADU!\n";

40 
	}
}

42 
	gMP3ADURTPSšk
::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

43 * 
äameS¹
,

44 
numBy‹sInF¿me
,

45 
timev®
 
äameP»£Á©iÚTime
,

46 
numRemaššgBy‹s
) {

49 ià(
äagm’tiÚOff£t
 == 0) {

50 
aduDesütÜSize
;

52 ià(
numBy‹sInF¿me
 < 1) {

53 
	`badD©aSize
(
	`’vœ
(), 
numBy‹sInF¿me
);

56 ià(
äameS¹
[0]&0x40) {

58 
aduDesütÜSize
 = 2;

59 ià(
numBy‹sInF¿me
 < 2) {

60 
	`badD©aSize
(
	`’vœ
(), 
numBy‹sInF¿me
);

63 
fCurADUSize
 = ((
äameS¹
[0]&~0xC0)<<8) | frameStart[1];

66 
aduDesütÜSize
 = 1;

67 
fCurADUSize
 = 
äameS¹
[0]&~0x80;

70 ià(
äameS¹
[0]&0x80) {

71 
	`’vœ
() << "Unexpected \"C\" bit seen on‚on-fragment input ADU!\n";

77 
ex³ùedADUSize
 =

78 
äagm’tiÚOff£t
 + 
numBy‹sInF¿me
 + 
numRemaššgBy‹s


79 - 
aduDesütÜSize
;

80 ià(
fCurADUSize
 !ğ
ex³ùedADUSize
) {

81 
	`’vœ
() << "MP3ADURTPSink::doSpecialFrameHandling(): Warning: Input ADU size "

82 << 
ex³ùedADUSize
 << " (=" << 
äagm’tiÚOff£t


83 << "+" << 
numBy‹sInF¿me
 << "+" << 
numRemaššgBy‹s


84 << "-" << 
aduDesütÜSize


85 << "èdid‚Ù m©chhv®u(" << 
fCurADUSize


87 
fCurADUSize
 = 
ex³ùedADUSize
;

92 
aduDesütÜ
[2];

93 
aduDesütÜ
[0] = 0xC0|(
fCurADUSize
>>8);

94 
aduDesütÜ
[1] = 
fCurADUSize
&0xFF;

95 
	`£tS³cŸlH—d”By‹s
(
aduDesütÜ
, 2);

100 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

101 
äameS¹
, 
numBy‹sInF¿me
,

102 
äameP»£Á©iÚTime
,

103 
numRemaššgBy‹s
);

104 
	}
}

106 
	gMP3ADURTPSšk
::
	$¥ecŸlH—d”Size
() const {

109 
¥ecŸlH—d”Size
 = 0;

114 ià(
	`curF¿gm’tiÚOff£t
() > 0) {

115 
¥ecŸlH—d”Size
 = 2;

118  
¥ecŸlH—d”Size
;

119 
	}
}

	@liveMedia/MP3ADURTPSource.cpp

21 
	~"MP3ADURTPSourû.hh
"

22 
	~"MP3ADUdesütÜ.hh
"

26 şas 
	cADUBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

27 
´iv©e
:

28 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

29 
d©aSize
);

32 şas 
	cADUBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

33 
´iv©e
:

34 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

39 
MP3ADURTPSourû
*

40 
	gMP3ADURTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

41 
¹pPaylßdFÜm©
,

42 
¹pTime¡ampF»qu’cy
) {

43  
Ãw
 
	`MP3ADURTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

44 
¹pTime¡ampF»qu’cy
);

45 
	}
}

47 
	gMP3ADURTPSourû
::
	$MP3ADURTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

48 
¹pPaylßdFÜm©
,

49 
¹pTime¡ampF»qu’cy
)

50 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

51 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

52 
Ãw
 
ADUBufã»dPack‘FaùÜy
) {

53 
	}
}

55 
	gMP3ADURTPSourû
::~
	$MP3ADURTPSourû
() {

56 
	}
}

58 cÚ¡* 
MP3ADURTPSourû
::
	$MIMEty³
() const {

60 
	}
}

64 
	gADUBufã»dPack‘


65 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

68 * 
äameD©aPŒ
 = 
äamePŒ
;

69 
»maššgF¿meSize


70 ğ
ADUdesütÜ
::
	`g‘RemaššgF¿meSize
(
äameD©aPŒ
);

71 
desütÜSize
 = ()(
äameD©aPŒ
 - 
äamePŒ
);

72 
fuÎADUSize
 = 
desütÜSize
 + 
»maššgF¿meSize
;

74  (
fuÎADUSize
 <ğ
d©aSize
) ? fullADUSize : dataSize;

75 
	}
}

77 
Bufã»dPack‘
* 
	gADUBufã»dPack‘FaùÜy


78 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* ) {

79  
Ãw
 
ADUBufã»dPack‘
;

80 
	}
}

	@liveMedia/MP3ADUTranscoder.cpp

21 
	~"MP3ADUT¿nscod”.hh
"

22 
	~"MP3IÁ”Çls.hh
"

23 
	~<¡ršg.h
>

25 
	gMP3ADUT¿nscod”
::
	$MP3ADUT¿nscod”
(
U§geEnvœÚm’t
& 
’v
,

26 
outB™¿‹
 ,

27 
F¿medSourû
* 
šputSourû
)

28 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

29 
	`fOutB™¿‹
(
outB™¿‹
),

30 
	`fAvaabËBy‹sFÜBackpoš‹r
(0),

31 
	$fOrigADU
(
Ãw
 [
MAX_MP3_FRAME_SIZE
]) {

32 
	}
}

34 
	gMP3ADUT¿nscod”
::~
	$MP3ADUT¿nscod”
() {

35 
d–‘e
[] 
fOrigADU
;

36 
	}
}

38 
MP3ADUT¿nscod”
* 
	gMP3ADUT¿nscod”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

39 
outB™¿‹
 ,

40 
F¿medSourû
* 
šputSourû
) {

42 ià(
	`¡rcmp
(
šputSourû
->
	`MIMEty³
(), "audio/MPA-ROBUST") != 0) {

43 
’v
.
	`£tResuÉMsg
(
šputSourû
->
	`Çme
(), " is‚ot‡n MP3 ADU source");

44  
NULL
;

47  
Ãw
 
	`MP3ADUT¿nscod”
(
’v
, 
outB™¿‹
, 
šputSourû
);

48 
	}
}

50 
	gMP3ADUT¿nscod”
::
	$g‘A‰ribu‹s
() const {

52 
fIÅutSourû
->
	`g‘A‰ribu‹s
();

55 
bufãr
[30];

56 
	`¥rštf
(
bufãr
, " bªdwidth %d", 
	`outB™¿‹
());

57 
	`’vœ
().
	`­³ndToResuÉMsg
(
bufãr
);

58 
	}
}

60 
	gMP3ADUT¿nscod”
::
	$doG‘NextF¿me
() {

61 
fIÅutSourû
->
	`g‘NextF¿me
(
fOrigADU
, 
MAX_MP3_FRAME_SIZE
,

62 
aá”G‘tšgF¿me
, 
this
, 
hªdËClosu»
,his);

63 
	}
}

65 
	gMP3ADUT¿nscod”
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
,

66 
numBy‹sR—d
,

67 
numTrunÿ‹dBy‹s
,

68 
timev®
 
´e£Á©iÚTime
,

69 
du¿tiÚInMiüo£cÚds
) {

70 
MP3ADUT¿nscod”
* 
Œªscod”
 = (MP3ADUT¿nscod”*)
ş›ÁD©a
;

71 
Œªscod”
->
	`aá”G‘tšgF¿me1
(
numBy‹sR—d
, 
numTrunÿ‹dBy‹s
,

72 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

73 
	}
}

75 
	gMP3ADUT¿nscod”
::
	$aá”G‘tšgF¿me1
(
numBy‹sR—d
,

76 
numTrunÿ‹dBy‹s
,

77 
timev®
 
´e£Á©iÚTime
,

78 
du¿tiÚInMiüo£cÚds
) {

79 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

80 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

81 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

82 
fF¿meSize
 = 
	`T¿nscodeMP3ADU
(
fOrigADU
, 
numBy‹sR—d
, 
fOutB™¿‹
,

83 
fTo
, 
fMaxSize
, 
fAvaabËBy‹sFÜBackpoš‹r
);

84 ià(
fF¿meSize
 == 0) {

85 
	`hªdËClosu»
();

91 
	`aá”G‘tšg
(
this
);

92 
	}
}

	@liveMedia/MP3ADUdescriptor.cpp

21 
	~"MP3ADUdesütÜ.hh
"

27 
	#TWO_BYTE_DESCR_FLAG
 0x40

	)

29 
	gADUdesütÜ
::
	$g’”©eDesütÜ
(*& 
toPŒ
,

30 
»maššgF¿meSize
) {

31 
desütÜSize
 = 
ADUdesütÜ
::
	`compu‹Size
(
»maššgF¿meSize
);

32 
desütÜSize
) {

34 *
toPŒ
++ = ()
»maššgF¿meSize
;

38 
	`g’”©eTwoBy‹DesütÜ
(
toPŒ
, 
»maššgF¿meSize
);

43  
desütÜSize
;

44 
	}
}

46 
	gADUdesütÜ
::
	$g’”©eTwoBy‹DesütÜ
(*& 
toPŒ
,

47 
»maššgF¿meSize
) {

48 *
toPŒ
++ = (
TWO_BYTE_DESCR_FLAG
|()(
»maššgF¿meSize
>>8));

49 *
toPŒ
++ = ()(
»maššgF¿meSize
&0xFF);

50 
	}
}

52 
	gADUdesütÜ
::
	$g‘RemaššgF¿meSize
(*& 
äomPŒ
) {

53 
fœ¡By‹
 = *
äomPŒ
++;

55 ià(
fœ¡By‹
&
TWO_BYTE_DESCR_FLAG
) {

57 
£cÚdBy‹
 = *
äomPŒ
++;

59  ((
fœ¡By‹
&0x3F)<<8è| 
£cÚdBy‹
;

62  (
fœ¡By‹
&0x3F);

64 
	}
}

	@liveMedia/MP3ADUinterleaving.cpp

21 
	~"MP3ADUš‹¾—všg.hh
"

22 
	~"MP3ADUdesütÜ.hh
"

24 
	~<¡ršg.h
>

26 #ifdeà
TEST_LOSS


27 
	~"GroupsockH–³r.hh
"

32 
	gIÁ”Ëavšg
::
	$IÁ”Ëavšg
(
cyşeSize
,

33 cÚ¡* 
cyşeA¼ay
)

34 : 
	$fCyşeSize
(
cyşeSize
) {

35 
i
 = 0; i < 
fCyşeSize
; ++i) {

36 
fInv”£Cyşe
[
cyşeA¼ay
[
i
]] = i;

38 
	}
}

40 
	gIÁ”Ëavšg
::~
	$IÁ”Ëavšg
() {

41 
	}
}

45 
MP3ADUš‹¾—v”Ba£
::
	$MP3ADUš‹¾—v”Ba£
(
U§geEnvœÚm’t
& 
’v
,

46 
F¿medSourû
* 
šputSourû
)

47 : 
	$F¿medF‹r
(
’v
, 
šputSourû
) {

48 
	}
}

49 
	gMP3ADUš‹¾—v”Ba£
::~
	$MP3ADUš‹¾—v”Ba£
() {

50 
	}
}

52 
F¿medSourû
* 
MP3ADUš‹¾—v”Ba£
::
	$g‘IÅutSourû
(
U§geEnvœÚm’t
& 
’v
,

53 cÚ¡* 
šputSourûName
) {

54 
F¿medSourû
* 
šputSourû
;

55 ià(!
F¿medSourû
::
	`lookupByName
(
’v
, 
šputSourûName
, 
šputSourû
))

56  
NULL
;

58 ià(
	`¡rcmp
(
šputSourû
->
	`MIMEty³
(), "audio/MPA-ROBUST") != 0) {

59 
’v
.
	`£tResuÉMsg
(
šputSourûName
, " is‚ot‡n MP3 ADU source");

60  
NULL
;

63  
šputSourû
;

64 
	}
}

66 
	gMP3ADUš‹¾—v”Ba£
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
,

67 
numBy‹sR—d
,

69 
timev®
 
´e£Á©iÚTime
,

70 
du¿tiÚInMiüo£cÚds
) {

71 
MP3ADUš‹¾—v”Ba£
* 
š‹¾—v”Ba£
 = (MP3ADUš‹¾—v”Ba£*)
ş›ÁD©a
;

73 
š‹¾—v”Ba£
->
	`aá”G‘tšgF¿me
(
numBy‹sR—d
,

74 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

77 
š‹¾—v”Ba£
->
	`doG‘NextF¿me
();

78 
	}
}

83 şas 
	cIÁ”ËavšgF¿mes
 {

84 
	mpublic
:

85 
IÁ”ËavšgF¿mes
(
maxCyşeSize
);

86 
	mvœtu®
 ~
IÁ”ËavšgF¿mes
();

88 
BoŞ—n
 
haveR–—£abËF¿me
();

89 
g‘IncomšgF¿meP¬ams
(
šdex
,

90 *& 
d©aPŒ
,

91 & 
by‹sAvaabË
);

92 
g‘R–—sšgF¿meP¬ams
(
šdex
,

93 *& 
d©aPŒ
,

94 & 
by‹sInU£
,

95 
timev®
& 
´e£Á©iÚTime
,

96 & 
du¿tiÚInMiüo£cÚds
);

97 
£tF¿meP¬ams
(
šdex
,

98 
icc
, 
ii
,

99 
äameSize
, 
timev®
 
´e£Á©iÚTime
,

100 
du¿tiÚInMiüo£cÚds
);

101 
	$ÃxtIndexToR–—£
(è{ 
fNextIndexToR–—£
;}

102 
	`»Ëa£Next
();

104 
´iv©e
:

105 
fMaxCyşeSize
;

106 
fNextIndexToR–—£
;

107 
şass
 
IÁ”ËavšgF¿meDesütÜ
* 
fDesütÜs
;

108 
	}
};

113 
	gMP3ADUš‹¾—v”
::
	$MP3ADUš‹¾—v”
(
U§geEnvœÚm’t
& 
’v
,

114 
IÁ”Ëavšg
 cÚ¡& 
š‹¾—všg
,

115 
F¿medSourû
* 
šputSourû
)

116 : 
	`MP3ADUš‹¾—v”Ba£
(
’v
, 
šputSourû
),

117 
	`fIÁ”Ëavšg
(
š‹¾—všg
),

118 
	`fF¿mes
(
Ãw
 
	`IÁ”ËavšgF¿mes
(
š‹¾—všg
.
	`cyşeSize
())),

119 
	`fII
(0), 
	$fICC
(0) {

120 
	}
}

122 
	gMP3ADUš‹¾—v”
::~
	$MP3ADUš‹¾—v”
() {

123 
d–‘e
 
fF¿mes
;

124 
	}
}

126 
MP3ADUš‹¾—v”
* 
	gMP3ADUš‹¾—v”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

127 
IÁ”Ëavšg
 cÚ¡& 
š‹¾—všg
,

128 
F¿medSourû
* 
šputSourû
) {

129  
Ãw
 
	`MP3ADUš‹¾—v”
(
’v
, 
š‹¾—všg
, 
šputSourû
);

130 
	}
}

132 
	gMP3ADUš‹¾—v”
::
	$doG‘NextF¿me
() {

135 ià(
fF¿mes
->
	`haveR–—£abËF¿me
()) {

136 
	`»Ëa£OutgošgF¿me
();

140 
	`aá”G‘tšg
(
this
);

142 
fPos™iÚOfNextIncomšgF¿me
 = 
fIÁ”Ëavšg
.
	`lookupInv”£Cyşe
(
fII
);

143 * 
d©aPŒ
;

144 
by‹sAvaabË
;

145 
fF¿mes
->
	`g‘IncomšgF¿meP¬ams
(
fPos™iÚOfNextIncomšgF¿me
,

146 
d©aPŒ
, 
by‹sAvaabË
);

149 
fIÅutSourû
->
	`g‘NextF¿me
(
d©aPŒ
, 
by‹sAvaabË
,

150 &
MP3ADUš‹¾—v”Ba£
::
aá”G‘tšgF¿me
, 
this
,

151 
hªdËClosu»
, 
this
);

153 
	}
}

155 
	gMP3ADUš‹¾—v”
::
	$»Ëa£OutgošgF¿me
() {

156 * 
äomPŒ
;

157 
fF¿mes
->
	`g‘R–—sšgF¿meP¬ams
(fF¿mes->
	`ÃxtIndexToR–—£
(),

158 
äomPŒ
, 
fF¿meSize
,

159 
fP»£Á©iÚTime
, 
fDu¿tiÚInMiüo£cÚds
);

161 ià(
fF¿meSize
 > 
fMaxSize
) {

162 
fNumTrunÿ‹dBy‹s
 = 
fF¿meSize
 - 
fMaxSize
;

163 
fF¿meSize
 = 
fMaxSize
;

165 
	`memmove
(
fTo
, 
äomPŒ
, 
fF¿meSize
);

167 
fF¿mes
->
	`»Ëa£Next
();

168 
	}
}

170 
	gMP3ADUš‹¾—v”
::
	$aá”G‘tšgF¿me
(
numBy‹sR—d
,

171 
timev®
 
´e£Á©iÚTime
,

172 
du¿tiÚInMiüo£cÚds
) {

174 
fF¿mes
->
	`£tF¿meP¬ams
(
fPos™iÚOfNextIncomšgF¿me
,

175 
fICC
, 
fII
, 
numBy‹sR—d
,

176 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

179 ià(++
fII
 =ğ
fIÁ”Ëavšg
.
	`cyşeSize
()) {

180 
fII
 = 0;

181 
fICC
 = (fICC+1)%8;

183 
	}
}

187 şas 
	cDeš‹¾—všgF¿mes
 {

188 
	mpublic
:

189 
Deš‹¾—všgF¿mes
();

190 
	mvœtu®
 ~
Deš‹¾—všgF¿mes
();

192 
BoŞ—n
 
haveR–—£abËF¿me
();

193 
g‘IncomšgF¿meP¬ams
(*& 
d©aPŒ
,

194 & 
by‹sAvaabË
);

195 
g‘IncomšgF¿meP¬amsAá”
(
äameSize
,

196 
timev®
 
´e£Á©iÚTime
,

197 
du¿tiÚInMiüo£cÚds
,

198 & 
icc
, & 
ii
);

199 
g‘R–—sšgF¿meP¬ams
(*& 
d©aPŒ
,

200 & 
by‹sInU£
,

201 
timev®
& 
´e£Á©iÚTime
,

202 & 
du¿tiÚInMiüo£cÚds
);

203 
moveIncomšgF¿meIÁoPÏû
();

204 
»Ëa£Next
();

205 
¡¬tNewCyşe
();

207 
	m´iv©e
:

208 
fNextIndexToR–—£
;

209 
BoŞ—n
 
	mfHaveEndedCyşe
;

210 
	mfIIÏ¡S“n
;

211 
	mfMšIndexS“n
, 
	mfMaxIndexS“n
;

212 
şass
 
Deš‹¾—všgF¿meDesütÜ
* 
	mfDesütÜs
;

217 
	gMP3ADUdeš‹¾—v”
::
	$MP3ADUdeš‹¾—v”
(
U§geEnvœÚm’t
& 
’v
,

218 
F¿medSourû
* 
šputSourû
)

219 : 
	`MP3ADUš‹¾—v”Ba£
(
’v
, 
šputSourû
),

220 
	`fF¿mes
(
Ãw
 
Deš‹¾—všgF¿mes
),

221 
	`fIIÏ¡S“n
(~0), 
	`fICCÏ¡S“n
(~0) {

222 
	}
}

224 
	gMP3ADUdeš‹¾—v”
::~
	$MP3ADUdeš‹¾—v”
() {

225 
d–‘e
 
fF¿mes
;

226 
	}
}

228 
MP3ADUdeš‹¾—v”
* 
	gMP3ADUdeš‹¾—v”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

229 
F¿medSourû
* 
šputSourû
) {

230  
Ãw
 
	`MP3ADUdeš‹¾—v”
(
’v
, 
šputSourû
);

231 
	}
}

233 
	gMP3ADUdeš‹¾—v”
::
	$doG‘NextF¿me
() {

236 ià(
fF¿mes
->
	`haveR–—£abËF¿me
()) {

237 
	`»Ëa£OutgošgF¿me
();

241 
	`aá”G‘tšg
(
this
);

243 #ifdeà
TEST_LOSS


244 
NOTE
: 
This
 
code
 
no
 
lÚg”
 
wÜks
, 
beÿu£
 
™
 
u£s
 
synchrÚous
 
»ads
,

245 
which
 
¬e
 
no
 
lÚg”
 
suµÜ‹d
.

246 cÚ¡ 
äamesP”Pack‘
 = 3;

247 cÚ¡ 
äameCouÁ
 = 0;

248 
BoŞ—n
 
·ck‘IsLo¡
;

250 
·ck‘CouÁ
 = 
äameCouÁ
/
äamesP”Pack‘
;

251 ià((
äameCouÁ
++)%
äamesP”Pack‘
 == 0) {

252 
·ck‘IsLo¡
 = (
	`our_¿ndom
()%10 == 0);

255 ià(
·ck‘IsLo¡
) {

258 
dummyBuf
[2000];

259 
numBy‹sR—d
;

260 
timev®
 
´e£Á©iÚTime
;

262 
fIÅutSourû
->
	`syncG‘NextF¿me
(
dummyBuf
,  dummyBuf,

263 
numBy‹sR—d
, 
´e£Á©iÚTime
);

269 * 
d©aPŒ
;

270 
by‹sAvaabË
;

271 
fF¿mes
->
	`g‘IncomšgF¿meP¬ams
(
d©aPŒ
, 
by‹sAvaabË
);

274 
fIÅutSourû
->
	`g‘NextF¿me
(
d©aPŒ
, 
by‹sAvaabË
,

275 &
MP3ADUš‹¾—v”Ba£
::
aá”G‘tšgF¿me
, 
this
,

276 
hªdËClosu»
, 
this
);

278 
	}
}

280 
	gMP3ADUdeš‹¾—v”
::
	$aá”G‘tšgF¿me
(
numBy‹sR—d
,

281 
timev®
 
´e£Á©iÚTime
,

282 
du¿tiÚInMiüo£cÚds
) {

284 
icc
, 
ii
;

285 
fF¿mes
->
	`g‘IncomšgF¿meP¬amsAá”
(
numBy‹sR—d
,

286 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
,

287 
icc
, 
ii
);

290 ià(
icc
 !ğ
fICCÏ¡S“n
 || 
ii
 =ğ
fIIÏ¡S“n
) {

294 
fF¿mes
->
	`¡¬tNewCyşe
();

298 
fF¿mes
->
	`moveIncomšgF¿meIÁoPÏû
();

301 
fICCÏ¡S“n
 = 
icc
;

302 
fIIÏ¡S“n
 = 
ii
;

303 
	}
}

305 
	gMP3ADUdeš‹¾—v”
::
	$»Ëa£OutgošgF¿me
() {

306 * 
äomPŒ
;

307 
fF¿mes
->
	`g‘R–—sšgF¿meP¬ams
(
äomPŒ
, 
fF¿meSize
,

308 
fP»£Á©iÚTime
, 
fDu¿tiÚInMiüo£cÚds
);

310 ià(
fF¿meSize
 > 
fMaxSize
) {

311 
fNumTrunÿ‹dBy‹s
 = 
fF¿meSize
 - 
fMaxSize
;

312 
fF¿meSize
 = 
fMaxSize
;

314 
	`memmove
(
fTo
, 
äomPŒ
, 
fF¿meSize
);

316 
fF¿mes
->
	`»Ëa£Next
();

317 
	}
}

321 
	#MAX_FRAME_SIZE
 2000

	)

323 şas 
	cIÁ”ËavšgF¿meDesütÜ
 {

324 
	mpublic
:

325 
	$IÁ”ËavšgF¿meDesütÜ
(è{
äameD©aSize
 = 0;}

327 
äameD©aSize
;

328 
timev®
 
´e£Á©iÚTime
;

329 
du¿tiÚInMiüo£cÚds
;

330 
äameD©a
[
MAX_FRAME_SIZE
];

331 
	}
};

333 
	gIÁ”ËavšgF¿mes
::
	$IÁ”ËavšgF¿mes
(
maxCyşeSize
)

334 : 
	`fMaxCyşeSize
(
maxCyşeSize
), 
	`fNextIndexToR–—£
(0),

335 
	$fDesütÜs
(
Ãw
 
IÁ”ËavšgF¿meDesütÜ
[
maxCyşeSize
]) {

336 
	}
}

337 
	gIÁ”ËavšgF¿mes
::~
	$IÁ”ËavšgF¿mes
() {

338 
d–‘e
[] 
fDesütÜs
;

339 
	}
}

341 
BoŞ—n
 
	gIÁ”ËavšgF¿mes
::
	$haveR–—£abËF¿me
() {

342  
fDesütÜs
[
fNextIndexToR–—£
].
äameD©aSize
 > 0;

343 
	}
}

345 
	gIÁ”ËavšgF¿mes
::
	$g‘IncomšgF¿meP¬ams
(
šdex
,

346 *& 
d©aPŒ
,

347 & 
by‹sAvaabË
) {

348 
IÁ”ËavšgF¿meDesütÜ
& 
desc
 = 
fDesütÜs
[
šdex
];

349 
d©aPŒ
 = &
desc
.
äameD©a
[0];

350 
by‹sAvaabË
 = 
MAX_FRAME_SIZE
;

351 
	}
}

353 
	gIÁ”ËavšgF¿mes
::
	$g‘R–—sšgF¿meP¬ams
(
šdex
,

354 *& 
d©aPŒ
,

355 & 
by‹sInU£
,

356 
timev®
& 
´e£Á©iÚTime
,

357 & 
du¿tiÚInMiüo£cÚds
) {

358 
IÁ”ËavšgF¿meDesütÜ
& 
desc
 = 
fDesütÜs
[
šdex
];

359 
d©aPŒ
 = &
desc
.
äameD©a
[0];

360 
by‹sInU£
 = 
desc
.
äameD©aSize
;

361 
´e£Á©iÚTime
 = 
desc
.presentationTime;

362 
du¿tiÚInMiüo£cÚds
 = 
desc
.durationInMicroseconds;

363 
	}
}

365 
	gIÁ”ËavšgF¿mes
::
	$£tF¿meP¬ams
(
šdex
,

366 
icc
,

367 
ii
,

368 
äameSize
,

369 
timev®
 
´e£Á©iÚTime
,

370 
du¿tiÚInMiüo£cÚds
) {

371 
IÁ”ËavšgF¿meDesütÜ
& 
desc
 = 
fDesütÜs
[
šdex
];

372 
desc
.
äameD©aSize
 = 
äameSize
;

373 
desc
.
´e£Á©iÚTime
 =…resentationTime;

374 
desc
.
du¿tiÚInMiüo£cÚds
 = durationInMicroseconds;

377 * 
±r
 = &
desc
.
äameD©a
[0];

378 ()
ADUdesütÜ
::
	`g‘RemaššgF¿meSize
(
±r
);

381 *
±r
++ = 
ii
;

382 *
±r
 &=~ 0xE0;

383 *
±r
 |ğ(
icc
<<5);

384 
	}
}

386 
	gIÁ”ËavšgF¿mes
::
	$»Ëa£Next
() {

387 
fDesütÜs
[
fNextIndexToR–—£
].
äameD©aSize
 = 0;

388 
fNextIndexToR–—£
 = (fNextIndexToR–—£+1)%
fMaxCyşeSize
;

389 
	}
}

393 şas 
	cDeš‹¾—všgF¿meDesütÜ
 {

394 
	mpublic
:

395 
	$Deš‹¾—všgF¿meDesütÜ
(è{
äameD©aSize
 = 0; 
äameD©a
 = 
NULL
;}

396 
vœtu®
 ~
	$Deš‹¾—všgF¿meDesütÜ
(è{
d–‘e
[] 
äameD©a
;
	}
}

398 
	gäameD©aSize
;

399 
timev®
 
	g´e£Á©iÚTime
;

400 
	gdu¿tiÚInMiüo£cÚds
;

401 * 
	gäameD©a
;

404 
	gDeš‹¾—všgF¿mes
::
	$Deš‹¾—všgF¿mes
()

405 : 
	`fNextIndexToR–—£
(0), 
	`fHaveEndedCyşe
(
F®£
),

406 
	`fMšIndexS“n
(
MAX_CYCLE_SIZE
), 
	`fMaxIndexS“n
(0),

407 
	`fDesütÜs
(
Ãw
 
Deš‹¾—všgF¿meDesütÜ
[
MAX_CYCLE_SIZE
+1]) {

408 
	}
}

409 
	gDeš‹¾—všgF¿mes
::~
	$Deš‹¾—všgF¿mes
() {

410 
d–‘e
[] 
fDesütÜs
;

411 
	}
}

413 
BoŞ—n
 
	gDeš‹¾—všgF¿mes
::
	$haveR–—£abËF¿me
() {

414 ià(!
fHaveEndedCyşe
) {

416  
fDesütÜs
[
fNextIndexToR–—£
].
äameD©aSize
 > 0;

420 ià(
fNextIndexToR–—£
 < 
fMšIndexS“n
) {

421 
fNextIndexToR–—£
 = 
fMšIndexS“n
;

423 
fNextIndexToR–—£
 < 
fMaxIndexS“n


424 && 
fDesütÜs
[
fNextIndexToR–—£
].
äameD©aSize
 == 0) {

425 ++
fNextIndexToR–—£
;

427 ià(
fNextIndexToR–—£
 >ğ
fMaxIndexS“n
) {

431 
i
 = 
fMšIndexS“n
; i < 
fMaxIndexS“n
; ++i) {

432 
fDesütÜs
[
i
].
äameD©aSize
 = 0;

435 
fMšIndexS“n
 = 
MAX_CYCLE_SIZE
; 
fMaxIndexS“n
 = 0;

436 
	`moveIncomšgF¿meIÁoPÏû
();

438 
fHaveEndedCyşe
 = 
F®£
;

439 
fNextIndexToR–—£
 = 0;

440  
F®£
;

443  
True
;

445 
	}
}

447 
	gDeš‹¾—všgF¿mes
::
	$g‘IncomšgF¿meP¬ams
(*& 
d©aPŒ
,

448 & 
by‹sAvaabË
) {

451 
Deš‹¾—všgF¿meDesütÜ
& 
desc
 = 
fDesütÜs
[
MAX_CYCLE_SIZE
];

452 ià(
desc
.
äameD©a
 =ğ
NULL
) {

454 
desc
.
äameD©a
 = 
Ãw
 [
MAX_FRAME_SIZE
];

456 
d©aPŒ
 = 
desc
.
äameD©a
;

457 
by‹sAvaabË
 = 
MAX_FRAME_SIZE
;

458 
	}
}

460 
	gDeš‹¾—všgF¿mes


461 ::
	$g‘IncomšgF¿meP¬amsAá”
(
äameSize
,

462 
timev®
 
´e£Á©iÚTime
,

463 
du¿tiÚInMiüo£cÚds
,

464 & 
icc
, & 
ii
) {

465 
Deš‹¾—všgF¿meDesütÜ
& 
desc
 = 
fDesütÜs
[
MAX_CYCLE_SIZE
];

466 
desc
.
äameD©aSize
 = 
äameSize
;

467 
desc
.
´e£Á©iÚTime
 =…resentationTime;

468 
desc
.
du¿tiÚInMiüo£cÚds
 = durationInMicroseconds;

471 * 
±r
 = 
desc
.
äameD©a
;

472 ()
ADUdesütÜ
::
	`g‘RemaššgF¿meSize
(
±r
);

475 
fIIÏ¡S“n
 = 
ii
 = *
±r
; *ptr++ = 0xFF;

476 
icc
 = (*
±r
&0xE0)>>5; *ptr |= 0xE0;

477 
	}
}

479 
	gDeš‹¾—všgF¿mes
::
	$g‘R–—sšgF¿meP¬ams
(*& 
d©aPŒ
,

480 & 
by‹sInU£
,

481 
timev®
& 
´e£Á©iÚTime
,

482 & 
du¿tiÚInMiüo£cÚds
) {

483 
Deš‹¾—všgF¿meDesütÜ
& 
desc
 = 
fDesütÜs
[
fNextIndexToR–—£
];

484 
d©aPŒ
 = 
desc
.
äameD©a
;

485 
by‹sInU£
 = 
desc
.
äameD©aSize
;

486 
´e£Á©iÚTime
 = 
desc
.presentationTime;

487 
du¿tiÚInMiüo£cÚds
 = 
desc
.durationInMicroseconds;

488 
	}
}

490 
	gDeš‹¾—všgF¿mes
::
	$moveIncomšgF¿meIÁoPÏû
() {

491 
Deš‹¾—všgF¿meDesütÜ
& 
äomDesc
 = 
fDesütÜs
[
MAX_CYCLE_SIZE
];

492 
Deš‹¾—všgF¿meDesütÜ
& 
toDesc
 = 
fDesütÜs
[
fIIÏ¡S“n
];

494 
toDesc
.
äameD©aSize
 = 
äomDesc
.frameDataSize;

495 
toDesc
.
´e£Á©iÚTime
 = 
äomDesc
.presentationTime;

498 * 
tmp
 = 
toDesc
.
äameD©a
;

499 
toDesc
.
äameD©a
 = 
äomDesc
.frameData;

500 
äomDesc
.
äameD©a
 = 
tmp
;

502 ià(
fIIÏ¡S“n
 < 
fMšIndexS“n
) {

503 
fMšIndexS“n
 = 
fIIÏ¡S“n
;

505 ià(
fIIÏ¡S“n
 + 1 > 
fMaxIndexS“n
) {

506 
fMaxIndexS“n
 = 
fIIÏ¡S“n
 + 1;

508 
	}
}

510 
	gDeš‹¾—všgF¿mes
::
	$»Ëa£Next
() {

511 
fDesütÜs
[
fNextIndexToR–—£
].
äameD©aSize
 = 0;

512 
fNextIndexToR–—£
 = (fNextIndexToR–—£+1)%
MAX_CYCLE_SIZE
;

513 
	}
}

515 
	gDeš‹¾—všgF¿mes
::
	$¡¬tNewCyşe
() {

516 
fHaveEndedCyşe
 = 
True
;

517 
	}
}

	@liveMedia/MP3AudioFileServerMediaSubsession.cpp

23 
	~"MP3AudioFeS”v”MedŸSub£ssiÚ.hh
"

24 
	~"MPEG1Ü2AudioRTPSšk.hh
"

25 
	~"MP3ADURTPSšk.hh
"

26 
	~"MP3FeSourû.hh
"

27 
	~"MP3ADU.hh
"

29 
MP3AudioFeS”v”MedŸSub£ssiÚ
* 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


30 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
,

31 
BoŞ—n
 
g’”©eADUs
, 
IÁ”Ëavšg
* 
š‹¾—všg
) {

32  
Ãw
 
	`MP3AudioFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
,

33 
g’”©eADUs
, 
š‹¾—všg
);

34 
	}
}

36 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


37 ::
	$MP3AudioFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

38 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
,

39 
BoŞ—n
 
g’”©eADUs
,

40 
IÁ”Ëavšg
* 
š‹¾—všg
)

41 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

42 
	`fG’”©eADUs
(
g’”©eADUs
), 
	`fIÁ”Ëavšg
(
š‹¾—všg
), 
	$fFeDu¿tiÚ
(0.0) {

43 
	}
}

45 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


46 ::~
	$MP3AudioFeS”v”MedŸSub£ssiÚ
() {

47 
d–‘e
 
fIÁ”Ëavšg
;

48 
	}
}

50 
F¿medSourû
* 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


51 ::
	$ü—‹NewSŒ—mSourûCommÚ
(
F¿medSourû
* 
ba£MP3Sourû
, 
mp3NumBy‹s
, & 
e¡B™¿‹
) {

52 
F¿medSourû
* 
¡»amSourû
;

54 
¡»amSourû
 = 
ba£MP3Sourû
;

55 ià(
¡»amSourû
 =ğ
NULL
) ;

58 ià(
mp3NumBy‹s
 > 0 && 
fFeDu¿tiÚ
 > 0.0) {

59 
e¡B™¿‹
 = ()(
mp3NumBy‹s
/(125*
fFeDu¿tiÚ
) + 0.5);

61 
e¡B™¿‹
 = 128;

64 ià(
fG’”©eADUs
) {

66 
¡»amSourû
 = 
ADUFromMP3Sourû
::
	`ü—‹New
(
	`’vœ
(), streamSource);

67 ià(
¡»amSourû
 =ğ
NULL
) ;

69 ià(
fIÁ”Ëavšg
 !ğ
NULL
) {

71 
¡»amSourû
 = 
MP3ADUš‹¾—v”
::
	`ü—‹New
(
	`’vœ
(), *
fIÁ”Ëavšg
,

72 
¡»amSourû
);

73 ià(
¡»amSourû
 =ğ
NULL
) ;

75 } ià(
fFeDu¿tiÚ
 > 0.0) {

80 
¡»amSourû
 = 
ADUFromMP3Sourû
::
	`ü—‹New
(
	`’vœ
(), streamSource);

81 ià(
¡»amSourû
 =ğ
NULL
) ;

83 
¡»amSourû
 = 
MP3FromADUSourû
::
	`ü—‹New
(
	`’vœ
(), streamSource);

84 ià(
¡»amSourû
 =ğ
NULL
) ;

88  
¡»amSourû
;

89 
	}
}

91 
	gMP3AudioFeS”v”MedŸSub£ssiÚ
::
	$g‘Ba£SŒ—ms
(
F¿medSourû
* 
äÚtSŒ—m
,

92 
F¿medSourû
*& 
sourûMP3SŒ—m
, 
ADUFromMP3Sourû
*& 
aduSŒ—m
 ) {

93 ià(
fG’”©eADUs
) {

95 ià(
fIÁ”Ëavšg
 !ğ
NULL
) {

97 
aduSŒ—m
 = (
ADUFromMP3Sourû
*)(((
F¿medF‹r
*)
äÚtSŒ—m
)->
	`šputSourû
());

99 
aduSŒ—m
 = (
ADUFromMP3Sourû
*)
äÚtSŒ—m
;

103 
sourûMP3SŒ—m
 = (
MP3FeSourû
*)(
aduSŒ—m
->
	`šputSourû
());

104 } ià(
fFeDu¿tiÚ
 > 0.0) {

107 
aduSŒ—m
 = (
ADUFromMP3Sourû
*)(((
F¿medF‹r
*)
äÚtSŒ—m
)->
	`šputSourû
());

110 
sourûMP3SŒ—m
 = (
MP3FeSourû
*)(
aduSŒ—m
->
	`šputSourû
());

113 
aduSŒ—m
 = 
NULL
;

114 
sourûMP3SŒ—m
 = 
äÚtSŒ—m
;

116 
	}
}

119 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


120 ::
	$£ekSŒ—mSourû
(
F¿medSourû
* 
šputSourû
, & 
£ekNPT
, 
¡»amDu¿tiÚ
, 
u_št64_t
& ) {

121 
F¿medSourû
* 
sourûMP3SŒ—m
;

122 
ADUFromMP3Sourû
* 
aduSŒ—m
;

123 
	`g‘Ba£SŒ—ms
(
šputSourû
, 
sourûMP3SŒ—m
, 
aduSŒ—m
);

125 ià(
aduSŒ—m
 !ğ
NULL
èaduSŒ—m->
	`»£tIÅut
();

126 ((
MP3FeSourû
*)
sourûMP3SŒ—m
)->
	`£ekW™hšFe
(
£ekNPT
, 
¡»amDu¿tiÚ
);

127 
	}
}

129 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


130 ::
	$£tSŒ—mSourûSÿË
(
F¿medSourû
* 
šputSourû
, 
sÿË
) {

132 
F¿medSourû
* 
sourûMP3SŒ—m
;

133 
ADUFromMP3Sourû
* 
aduSŒ—m
;

134 
	`g‘Ba£SŒ—ms
(
šputSourû
, 
sourûMP3SŒ—m
, 
aduSŒ—m
);

136 ià(
aduSŒ—m
 =ğ
NULL
) ;

138 
iSÿË
 = ()
sÿË
;

139 
aduSŒ—m
->
	`£tSÿËFaùÜ
(
iSÿË
);

140 ((
MP3FeSourû
*)
sourûMP3SŒ—m
)->
	`£tP»£Á©iÚTimeSÿË
(
iSÿË
);

141 
	}
}

143 
F¿medSourû
* 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


144 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

145 
MP3FeSourû
* 
mp3Sourû
 = MP3FeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

146 ià(
mp3Sourû
 =ğ
NULL
)  NULL;

147 
fFeDu¿tiÚ
 = 
mp3Sourû
->
	`fePÏyTime
();

149  
	`ü—‹NewSŒ—mSourûCommÚ
(
mp3Sourû
, mp3Sourû->
	`feSize
(), 
e¡B™¿‹
);

150 
	}
}

152 
RTPSšk
* 
	gMP3AudioFeS”v”MedŸSub£ssiÚ


153 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

154 
¹pPaylßdTy³IfDyÇmic
,

155 
F¿medSourû
* ) {

156 ià(
fG’”©eADUs
) {

157  
MP3ADURTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

158 
¹pPaylßdTy³IfDyÇmic
);

160  
MPEG1Ü2AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

162 
	}
}

164 
	gMP3AudioFeS”v”MedŸSub£ssiÚ
::
	$‹¡SÿËFaùÜ
(& 
sÿË
) {

165 ià(
fFeDu¿tiÚ
 <= 0.0) {

168 
sÿË
 = 1;

171 
iSÿË
 = ()(
sÿË
 + 0.5);

172 ià(
iSÿË
 < 1) iScale = 1;

173 
sÿË
 = ()
iSÿË
;

175 
	}
}

177 
	gMP3AudioFeS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
() const {

178  
fFeDu¿tiÚ
;

179 
	}
}

	@liveMedia/MP3AudioMatroskaFileServerMediaSubsession.cpp

23 
	~"MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ.hh
"

24 
	~"M©roskaDemuxedT¿ck.hh
"

26 
MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ
* 
	gMP3AudioM©roskaFeS”v”MedŸSub£ssiÚ


27 ::
	$ü—‹New
(
M©roskaFeS”v”Demux
& 
demux
, 
M©roskaT¿ck
* 
Œack
,

28 
BoŞ—n
 
g’”©eADUs
, 
IÁ”Ëavšg
* 
š‹¾—všg
) {

29  
Ãw
 
	`MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ
(
demux
, 
Œack
, 
g’”©eADUs
, 
š‹¾—všg
);

30 
	}
}

32 
	gMP3AudioM©roskaFeS”v”MedŸSub£ssiÚ


33 ::
	$MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ
(
M©roskaFeS”v”Demux
& 
demux
, 
M©roskaT¿ck
* 
Œack
,

34 
BoŞ—n
 
g’”©eADUs
, 
IÁ”Ëavšg
* 
š‹¾—všg
)

35 : 
	`MP3AudioFeS”v”MedŸSub£ssiÚ
(
demux
.
	`’vœ
(), demux.
	`feName
(), 
F®£
, 
g’”©eADUs
, 
š‹¾—všg
),

36 
	`fOurDemux
(
demux
), 
	`fT¿ckNumb”
(
Œack
->
ŒackNumb”
) {

37 
fFeDu¿tiÚ
 = 
fOurDemux
.
	`feDu¿tiÚ
();

38 
	}
}

40 
	gMP3AudioM©roskaFeS”v”MedŸSub£ssiÚ
::~
	$MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ
() {

41 
	}
}

43 
MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ


44 ::
	$£ekSŒ—mSourû
(
F¿medSourû
* 
šputSourû
, & 
£ekNPT
, , 
u_št64_t
& ) {

45 
F¿medSourû
* 
sourûMP3SŒ—m
;

46 
ADUFromMP3Sourû
* 
aduSŒ—m
;

47 
	`g‘Ba£SŒ—ms
(
šputSourû
, 
sourûMP3SŒ—m
, 
aduSŒ—m
);

49 ià(
aduSŒ—m
 !ğ
NULL
èaduSŒ—m->
	`»£tIÅut
();

50 ((
M©roskaDemuxedT¿ck
*)
sourûMP3SŒ—m
)->
	`£ekToTime
(
£ekNPT
);

51 
	}
}

53 
F¿medSourû
* 
	gMP3AudioM©roskaFeS”v”MedŸSub£ssiÚ


54 ::
	$ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, & 
e¡B™¿‹
) {

55 
F¿medSourû
* 
ba£MP3Sourû
 = 
fOurDemux
.
	`ÃwDemuxedT¿ck
(
ş›ÁSessiÚId
, 
fT¿ckNumb”
);

56  
	`ü—‹NewSŒ—mSourûCommÚ
(
ba£MP3Sourû
, 0, 
e¡B™¿‹
);

57 
	}
}

	@liveMedia/MP3FileSource.cpp

21 
	~"MP3FeSourû.hh
"

22 
	~"MP3SŒ—mS‹.hh
"

23 
	~"IÅutFe.hh
"

27 
	gMP3FeSourû
::
	$MP3FeSourû
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
)

28 : 
	`F¿medFeSourû
(
’v
, 
fid
),

29 
	`fSŒ—mS‹
(
Ãw
 
	$MP3SŒ—mS‹
(
’v
)) {

30 
	}
}

32 
	gMP3FeSourû
::~
	$MP3FeSourû
() {

33 
d–‘e
 
fSŒ—mS‹
;

34 
	}
}

36 cÚ¡* 
	gMP3FeSourû
::
	$MIMEty³
() const {

38 
	}
}

40 
MP3FeSourû
* 
	gMP3FeSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
) {

41 
MP3FeSourû
* 
ÃwSourû
 = 
NULL
;

44 
FILE
* 
fid
;

46 
fid
 = 
	`O³nIÅutFe
(
’v
, 
feName
);

47 ià(
fid
 =ğ
NULL
) ;

49 
ÃwSourû
 = 
Ãw
 
	`MP3FeSourû
(
’v
, 
fid
);

50 ià(
ÃwSourû
 =ğ
NULL
) ;

52 
feSize
 = ()
	`G‘FeSize
(
feName
, 
fid
);

53 
ÃwSourû
->
	`assignSŒ—m
(
fid
, 
feSize
);

54 ià(!
ÃwSourû
->
	`š™ŸlizeSŒ—m
()) ;

56  
ÃwSourû
;

59 
Medium
::
	`şo£
(
ÃwSourû
);

60  
NULL
;

61 
	}
}

63 
	gMP3FeSourû
::
	$fePÏyTime
() const {

64  
fSŒ—mS‹
->
	`fePÏyTime
();

65 
	}
}

67 
	gMP3FeSourû
::
	$feSize
() const {

68  
fSŒ—mS‹
->
	`feSize
();

69 
	}
}

71 
	gMP3FeSourû
::
	$£tP»£Á©iÚTimeSÿË
(
sÿË
) {

72 
fSŒ—mS‹
->
	`£tP»£Á©iÚTimeSÿË
(
sÿË
);

73 
	}
}

75 
	gMP3FeSourû
::
	$£ekW™hšFe
(
£ekNPT
, 
¡»amDu¿tiÚ
) {

76 
feDu¿tiÚ
 = 
	`fePÏyTime
();

79 ià(
£ekNPT
 < 0.0) {

80 
£ekNPT
 = 0.0;

81 } ià(
£ekNPT
 > 
feDu¿tiÚ
) {

82 
£ekNPT
 = 
feDu¿tiÚ
;

84 ià(
¡»amDu¿tiÚ
 < 0.0) {

85 
¡»amDu¿tiÚ
 = 0.0;

86 } ià(
£ekNPT
 + 
¡»amDu¿tiÚ
 > 
feDu¿tiÚ
) {

87 
¡»amDu¿tiÚ
 = 
feDu¿tiÚ
 - 
£ekNPT
;

90 
£ekF¿ùiÚ
 = ()
£ekNPT
/
feDu¿tiÚ
;

91 
£ekBy‹Numb”
 = 
fSŒ—mS‹
->
	`g‘By‹Numb”FromPos™iÚF¿ùiÚ
(
£ekF¿ùiÚ
);

92 
fSŒ—mS‹
->
	`£ekW™hšFe
(
£ekBy‹Numb”
);

94 
fLim™NumBy‹sToSŒ—m
 = 
F®£
;

95 ià(
¡»amDu¿tiÚ
 > 0.0) {

96 
’dF¿ùiÚ
 = ()(
£ekNPT
 + 
¡»amDu¿tiÚ
)/
feDu¿tiÚ
;

97 
’dBy‹Numb”
 = 
fSŒ—mS‹
->
	`g‘By‹Numb”FromPos™iÚF¿ùiÚ
(
’dF¿ùiÚ
);

98 ià(
’dBy‹Numb”
 > 
£ekBy‹Numb”
) {

99 
fNumBy‹sToSŒ—m
 = 
’dBy‹Numb”
 - 
£ekBy‹Numb”
;

100 
fLim™NumBy‹sToSŒ—m
 = 
True
;

103 
	}
}

105 
	gMP3FeSourû
::
	$g‘A‰ribu‹s
() const {

106 
bufãr
[200];

107 
fSŒ—mS‹
->
	`g‘A‰ribu‹s
(
bufãr
,  buffer);

108 
	`’vœ
().
	`£tResuÉMsg
(
bufãr
);

109 
	}
}

111 
	gMP3FeSourû
::
	$doG‘NextF¿me
() {

112 ià(!
	`doG‘NextF¿me1
()) {

113 
	`hªdËClosu»
();

118 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)

125 
	`aá”G‘tšg
(
this
);

127 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0,

128 (
TaskFunc
*)
aá”G‘tšg
, 
this
);

130 
	}
}

132 
BoŞ—n
 
	gMP3FeSourû
::
	$doG‘NextF¿me1
() {

133 ià(
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 =ğ0è 
F®£
;

135 ià(!
fHaveJu¡In™Ÿlized
) {

136 ià(
fSŒ—mS‹
->
	`fšdNextH—d”
(
fP»£Á©iÚTime
è=ğ0è 
F®£
;

138 
fP»£Á©iÚTime
 = 
fFœ¡F¿meP»£Á©iÚTime
;

139 
fHaveJu¡In™Ÿlized
 = 
F®£
;

142 ià(!
fSŒ—mS‹
->
	`»adF¿me
(
fTo
, 
fMaxSize
, 
fF¿meSize
, 
fDu¿tiÚInMiüo£cÚds
)) {

143 
tmp
[200];

144 
	`¥rštf
(
tmp
,

146 
fMaxSize
, 
fF¿meSize
);

147 
	`’vœ
().
	`£tResuÉMsg
(
tmp
);

148 
fF¿meSize
 = 
fMaxSize
;

149  
F®£
;

151 ià(
fNumBy‹sToSŒ—m
 > 
fF¿meSize
) fNumBytesToStream -= fFrameSize; fNumBytesToStream = 0;

153  
True
;

154 
	}
}

156 
	gMP3FeSourû
::
	$assignSŒ—m
(
FILE
* 
fid
, 
feSize
) {

157 
fSŒ—mS‹
->
	`assignSŒ—m
(
fid
, 
feSize
);

158 
	}
}

161 
BoŞ—n
 
	gMP3FeSourû
::
	$š™ŸlizeSŒ—m
() {

163 ià(
fSŒ—mS‹
->
	`fšdNextH—d”
(
fFœ¡F¿meP»£Á©iÚTime
) == 0) {

164 
	`’vœ
().
	`£tResuÉMsg
("not‡n MPEG‡udio file");

165  
F®£
;

168 
fSŒ—mS‹
->
	`checkFÜXšgH—d”
();

170 
fHaveJu¡In™Ÿlized
 = 
True
;

171 
fLim™NumBy‹sToSŒ—m
 = 
F®£
;

172 
fNumBy‹sToSŒ—m
 = 0;

176 
	`’vœ
().
	`£tResuÉMsg
(
	`Çme
());

177  
True
;

178 
	}
}

	@liveMedia/MP3Internals.cpp

21 
	~"MP3IÁ”ÇlsHuffmª.hh
"

23 
	~<¡dlib.h
>

24 
	~<m©h.h
>

25 
	~<¡dio.h
>

26 
	~<¡ršg.h
>

30 cÚ¡ 
	glive_b£l
[2][3][16] = {

41 cÚ¡ 
	glive_äeqs
[]

44 
	sbªdInfoSŒuù
 {

45 
	mlÚgIdx
[23];

46 
	mlÚgDiff
[22];

47 
	mshÜtIdx
[14];

48 
	mshÜtDiff
[13];

51 
bªdInfoSŒuù
 cÚ¡ 
	gbªdInfo
[7] = {

91 
	gn_¦’2
[512];

92 
	gi_¦’2
[256];

94 
	#MPG_MD_MONO
 3

	)

99 
	gMP3F¿meP¬ams
::
	$MP3F¿meP¬ams
()

100 : 
	$bv
(
äameBy‹s
, 0,  frameBytes) {

101 
ŞdHdr
 = 
fœ¡Hdr
 = 0;

103 
BoŞ—n
 
dÚeIn™
 = 
F®£
;

104 ià(
dÚeIn™
) ;

106 
i
,
j
,
k
,
l
;

108 
i
=0;i<5;i++) {

109 
j
=0;j<6;j++) {

110 
k
=0;k<6;k++) {

111 
n
 = 
k
 + 
j
 * 6 + 
i
 * 36;

112 
i_¦’2
[
n
] = 
i
|(
j
<<3)|(
k
<<6)|(3<<12);

116 
i
=0;i<4;i++) {

117 
j
=0;j<4;j++) {

118 
k
=0;k<4;k++) {

119 
n
 = 
k
 + 
j
 * 4 + 
i
 * 16;

120 
i_¦’2
[
n
+180] = 
i
|(
j
<<3)|(
k
<<6)|(4<<12);

124 
i
=0;i<4;i++) {

125 
j
=0;j<3;j++) {

126 
n
 = 
j
 + 
i
 * 3;

127 
i_¦’2
[
n
+244] = 
i
|(
j
<<3) | (5<<12);

128 
n_¦’2
[
n
+500] = 
i
|(
j
<<3) | (2<<12) | (1<<15);

132 
i
=0;i<5;i++) {

133 
j
=0;j<5;j++) {

134 
k
=0;k<4;k++) {

135 
l
=0;l<4;l++) {

136 
n
 = 
l
 + 
k
 * 4 + 
j
 * 16 + 
i
 * 80;

137 
n_¦’2
[
n
] = 
i
|(
j
<<3)|(
k
<<6)|(
l
<<9)|(0<<12);

142 
i
=0;i<5;i++) {

143 
j
=0;j<5;j++) {

144 
k
=0;k<4;k++) {

145 
n
 = 
k
 + 
j
 * 4 + 
i
 * 20;

146 
n_¦’2
[
n
+400] = 
i
|(
j
<<3)|(
k
<<6)|(1<<12);

150 
dÚeIn™
 = 
True
;

151 
	}
}

153 
	gMP3F¿meP¬ams
::~
	$MP3F¿meP¬ams
() {

154 
	}
}

156 
MP3F¿meP¬ams
::
	$£tP¬amsFromH—d”
() {

157 ià(
hdr
 & (1<<20)) {

158 
isMPEG2
 = (
hdr
 & (1<<19)) ? 0x0 : 0x1;

159 
isMPEG2_5
 = 0;

162 
isMPEG2
 = 1;

163 
isMPEG2_5
 = 1;

166 
Ïy”
 = 4-((
hdr
>>17)&3);

167 ià(
Ïy”
 == 4)†ayer = 3;

168 
b™¿‹Index
 = ((
hdr
>>12)&0xf);

170 ià(
isMPEG2_5
) {

171 
§m¶šgF»qIndex
 = ((
hdr
>>10)&0x3) + 6;

173 
§m¶šgF»qIndex
 = ((
hdr
>>10)&0x3è+ (
isMPEG2
*3);

176 
hasCRC
 = (
hdr
 & 0x10000) == 0;

178 
·ddšg
 = ((
hdr
>>9)&0x1);

179 
ex‹nsiÚ
 = ((
hdr
>>8)&0x1);

180 
mode
 = ((
hdr
>>6)&0x3);

181 
mode_ext
 = ((
hdr
>>4)&0x3);

182 
cİyright
 = ((
hdr
>>3)&0x1);

183 
Üigš®
 = ((
hdr
>>2)&0x1);

184 
emphasis
 = 
hdr
 & 0x3;

186 
¡”eo
 = (
mode
 =ğ
MPG_MD_MONO
) ? 1 : 2;

188 ià(((
hdr
>>10)&0x3) == 0x3) {

189 #ifdeà
DEBUG_ERRORS


190 
	`årštf
(
¡d”r
,"SŒ—mƒ¼Ü - hdr: 0x%08x\n", 
hdr
);

194 
b™¿‹
 = 
live_b£l
[
isMPEG2
][
Ïy”
-1][
b™¿‹Index
];

195 
§m¶šgF»q
 = 
live_äeqs
[
§m¶šgF»qIndex
];

196 
isS‹»o
 = (
¡”eo
 > 1);

197 
isF»eFÜm©
 = (
b™¿‹Index
 == 0);

198 
äameSize


199 ğ
	`Compu‹F¿meSize
(
b™¿‹
, 
§m¶šgF»q
, 
·ddšg
, 
isMPEG2
, 
Ïy”
);

200 
sideInfoSize
 = 
	`compu‹SideInfoSize
();

201 
	}
}

203 
	gMP3F¿meP¬ams
::
	$compu‹SideInfoSize
() {

204 
size
;

206 ià(
isMPEG2
) {

207 
size
 = 
isS‹»o
 ? 17 : 9;

209 
size
 = 
isS‹»o
 ? 32 : 17;

212 ià(
hasCRC
) {

213 
size
 += 2;

216  
size
;

217 
	}
}

219 
	$Compu‹F¿meSize
(
b™¿‹
, 
§m¶šgF»q
,

220 
BoŞ—n
 
u£Paddšg
, BoŞ—À
isMPEG2
,

221 
Ïy”
) {

222 ià(
§m¶šgF»q
 == 0)  0;

223 cÚ¡ 
b™¿‹MuÉl›r
 = (
Ïy”
 == 1) ? 12000*4 : 144000;

224 
äamesize
;

226 
äamesize
 = 
b™¿‹
*
b™¿‹MuÉl›r
;

227 
äamesize
 /ğ
§m¶šgF»q
<<(
isMPEG2
 ? 1 : 0);

228 
äamesize
 = f¿mesiz+ 
u£Paddšg
 - 4;

230  
äamesize
;

231 
	}
}

233 
	#TRUNC_FAIRLY


	)

234 
	$upd©eSideInfoSizes
(
MP3SideInfo
& 
sideInfo
, 
BoŞ—n
 
isMPEG2
,

235 cÚ¡* 
mašD©aPŒ
,

236 
®lowedNumB™s
,

237 & 
·¹23L’gth0a
,

238 & 
·¹23L’gth0aTrunÿtiÚ
,

239 & 
·¹23L’gth0b
,

240 & 
·¹23L’gth0bTrunÿtiÚ
,

241 & 
·¹23L’gth1a
,

242 & 
·¹23L’gth1aTrunÿtiÚ
,

243 & 
·¹23L’gth1b
,

244 & 
·¹23L’gth1bTrunÿtiÚ
) {

245 
p23L0
, 
p23L1
 = 0, 
p23L0Trunc
 = 0, 
p23L1Trunc
 = 0;

247 
p23L0
 = 
sideInfo
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
;

248 
p23L1
 = 
isMPEG2
 ? 0 : 
sideInfo
.
ch
[0].
gr
[1].
·¹2_3_Ëngth
;

249 #ifdeà
TRUNC_ONLY0


250 ià(
p23L0
 < 
®lowedNumB™s
)

251 
®lowedNumB™s
 = 
p23L0
;

253 #ifdeà
TRUNC_ONLY1


254 ià(
p23L1
 < 
®lowedNumB™s
)

255 
®lowedNumB™s
 = 
p23L1
;

257 ià(
p23L0
 + 
p23L1
 > 
®lowedNumB™s
) {

259 
ŒunÿtiÚ
 = 
p23L0
 + 
p23L1
 - 
®lowedNumB™s
;

260 #ifdeà
TRUNC_FAIRLY


261 
p23L0Trunc
 = (
ŒunÿtiÚ
*
p23L0
)/Õ23L0 + 
p23L1
);

262 
p23L1Trunc
 = 
ŒunÿtiÚ
 - 
p23L0Trunc
;

264 #ià
	`defšed
(
TRUNC_FAVOR0
è|| defšed(
TRUNC_ONLY0
)

265 
p23L1Trunc
 = (
ŒunÿtiÚ
>
p23L1
) ?…23L1 :runcation;

266 
p23L0Trunc
 = 
ŒunÿtiÚ
 - 
p23L1Trunc
;

268 #ià
	`defšed
(
TRUNC_FAVOR1
è|| defšed(
TRUNC_ONLY1
)

269 
p23L0Trunc
 = (
ŒunÿtiÚ
>
p23L0
) ?…23L0 :runcation;

270 
p23L1Trunc
 = 
ŒunÿtiÚ
 - 
p23L0Trunc
;

275 
p23L0
 -ğ
p23L0Trunc
; 
p23L1
 -ğ
p23L1Trunc
;

276 #ifdeà
DEBUG


277 
	`årštf
(
¡d”r
, "upd©eSideInfoSize ×Îowed: %d): %d->%d, %d->%d\n", 
®lowedNumB™s
, 
p23L0
+
p23L0Trunc
,…23L0, 
p23L1
+
p23L1Trunc
,…23L1);

283 
	`upd©eSideInfoFÜHuffmª
(
sideInfo
, 
isMPEG2
, 
mašD©aPŒ
,

284 
p23L0
, 
p23L1
,

285 
·¹23L’gth0a
, 
·¹23L’gth0aTrunÿtiÚ
,

286 
·¹23L’gth0b
, 
·¹23L’gth0bTrunÿtiÚ
,

287 
·¹23L’gth1a
, 
·¹23L’gth1aTrunÿtiÚ
,

288 
·¹23L’gth1b
, 
·¹23L’gth1bTrunÿtiÚ
);

289 
p23L0
 = 
·¹23L’gth0a
 + 
·¹23L’gth0b
;

290 
p23L1
 = 
·¹23L’gth1a
 + 
·¹23L’gth1b
;

292 
sideInfo
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
 = 
p23L0
;

293 
sideInfo
.
ch
[0].
gr
[1].
·¹2_3_Ëngth
 = 
p23L1
;

294 
·¹23L’gth0bTrunÿtiÚ


295 +ğ
sideInfo
.
ch
[1].
gr
[0].
·¹2_3_Ëngth
;

296 
sideInfo
.
ch
[1].
gr
[0].
·¹2_3_Ëngth
 = 0;

297 
sideInfo
.
ch
[1].
gr
[1].
·¹2_3_Ëngth
 = 0;

299  
p23L0
 + 
p23L1
;

300 
	}
}

303 
BoŞ—n
 
	$G‘ADUInfoFromMP3F¿me
(cÚ¡* 
äamePŒ
,

304 
tÙF¿meSize
,

305 & 
hdr
, & 
äameSize
,

306 
MP3SideInfo
& 
sideInfo
, & 
sideInfoSize
,

307 & 
backpoš‹r
, & 
aduSize
) {

308 ià(
tÙF¿meSize
 < 4è 
F®£
;

310 
MP3F¿meP¬ams
 
ä
;

311 
ä
.
hdr
 = (()
äamePŒ
[0] << 24) | (()framePtr[1] << 16)

312 | (()
äamePŒ
[2] << 8) | ()framePtr[3];

313 
ä
.
	`£tP¬amsFromH—d”
();

314 
ä
.
	`£tBy‹Poš‹r
(
äamePŒ
 + 4, 
tÙF¿meSize
 - 4);

316 
äameSize
 = 4 + 
ä
.frameSize;

318 ià(
ä
.
Ïy”
 != 3) {

320 
backpoš‹r
 = 0;

321 
sideInfoSize
 = 0;

322 
aduSize
 = 
ä
.
äameSize
;

323  
True
;

326 
sideInfoSize
 = 
ä
.sideInfoSize;

327 ià(
tÙF¿meSize
 < 4 + 
sideInfoSize
è 
F®£
;

329 
ä
.
	`g‘SideInfo
(
sideInfo
);

331 
hdr
 = 
ä
.hdr;

332 
backpoš‹r
 = 
sideInfo
.
maš_d©a_begš
;

333 
numB™s
 = 
sideInfo
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
;

334 
numB™s
 +ğ
sideInfo
.
ch
[0].
gr
[1].
·¹2_3_Ëngth
;

335 
numB™s
 +ğ
sideInfo
.
ch
[1].
gr
[0].
·¹2_3_Ëngth
;

336 
numB™s
 +ğ
sideInfo
.
ch
[1].
gr
[1].
·¹2_3_Ëngth
;

337 
aduSize
 = (
numB™s
+7)/8;

338 #ifdeà
DEBUG


339 
	`årštf
(
¡d”r
, "mp3G‘ADUInfoFromF¿me: hdr: %08x, f¿meSize: %d,…¬t2_3_Ëngths: %d,%d,%d,%d,‡duSize: %d, backpoš‹r: %d\n", 
hdr
, 
äameSize
, 
sideInfo
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
, sideInfo.ch[0].gr[1].·¹2_3_Ëngth, sideInfo.ch[1].gr[0].·¹2_3_Ëngth, sideInfo.ch[1].gr[1].·¹2_3_Ëngth, 
aduSize
, 
backpoš‹r
);

342  
True
;

343 
	}
}

346 
	$g‘SideInfo1
(
MP3F¿meP¬ams
& 
ä
, 
MP3SideInfo
& 
si
,

347 
¡”eo
, 
ms_¡”eo
, 
säeq
,

349 
ch
, 
gr
;

351 
powdiff
 = (
sšgË
 == 3) ? 4 : 0;

355 
si
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
 = 0; si.ch[1].gr[0].part2_3_length = 0;

356 
si
.
ch
[0].
gr
[1].
·¹2_3_Ëngth
 = 0; si.ch[1].gr[1].part2_3_length = 0;

358 
si
.
maš_d©a_begš
 = 
ä
.
	`g‘B™s
(9);

359 ià(
¡”eo
 == 1)

360 
si
.
´iv©e_b™s
 = 
ä
.
	`g‘B™s
(5);

362 
si
.
´iv©e_b™s
 = 
ä
.
	`g‘B™s
(3);

364 
ch
=0; ch<
¡”eo
; ch++) {

365 
si
.
ch
[ch].
gr
[0].
scfsi
 = -1;

366 
si
.
ch
[ch].
gr
[1].
scfsi
 = 
ä
.
	`g‘B™s
(4);

369 
gr
=0; gr<2; gr++) {

370 
ch
=0; ch<
¡”eo
; ch++) {

371 
MP3SideInfo
::
gr_šfo_s_t
& 
gr_šfo
 = 
si
.
ch
[ch].
gr
[gr];

373 
gr_šfo
.
·¹2_3_Ëngth
 = 
ä
.
	`g‘B™s
(12);

374 
gr_šfo
.
big_v®ues
 = 
ä
.
	`g‘B™s
(9);

375 
gr_šfo
.
glob®_gaš
 = 
ä
.
	`g‘B™s
(8);

377 
gr_šfo
.
pow2gaš
 = 
gašpow2
+256 - gr_šfo.
glob®_gaš
 + 
powdiff
;

378 ià(
ms_¡”eo
è
gr_šfo
.
pow2gaš
 += 2;

380 
gr_šfo
.
sÿËçc_com´ess
 = 
ä
.
	`g‘B™s
(4);

382 
gr_šfo
.
wšdow_sw™chšg_æag
 = 
ä
.
	`g‘1B™
();

383 ià(
gr_šfo
.
wšdow_sw™chšg_æag
) {

384 
i
;

385 
gr_šfo
.
block_ty³
 = 
ä
.
	`g‘B™s
(2);

386 
gr_šfo
.
mixed_block_æag
 = 
ä
.
	`g‘1B™
();

387 
gr_šfo
.
bË_£Ëù
[0] = 
ä
.
	`g‘B™s
(5);

388 
gr_šfo
.
bË_£Ëù
[1] = 
ä
.
	`g‘B™s
(5);

393 
gr_šfo
.
bË_£Ëù
[2] = 0;

394 
i
=0;i<3;i++) {

395 
gr_šfo
.
subblock_gaš
[
i
] = 
ä
.
	`g‘B™s
(3);

396 
gr_šfo
.
fuÎ_gaš
[
i
]

397 ğ
gr_šfo
.
pow2gaš
 + ((gr_šfo.
subblock_gaš
[
i
])<<3);

400 #ifdeà
DEBUG_ERRORS


401 ià(
gr_šfo
.
block_ty³
 == 0) {

402 
	`årštf
(
¡d”r
,"Blocktype == 0‡nd window-switching == 1‚ot‡llowed.\n");

406 
gr_šfo
.
»giÚ1¡¬t
 = 36>>1;

407 
gr_šfo
.
»giÚ2¡¬t
 = 576>>1;

411 
i
,
r0c
,
r1c
;

412 
i
=0; i<3; i++) {

413 
gr_šfo
.
bË_£Ëù
[
i
] = 
ä
.
	`g‘B™s
(5);

415 
r0c
 = 
gr_šfo
.
»giÚ0_couÁ
 = 
ä
.
	`g‘B™s
(4);

416 
r1c
 = 
gr_šfo
.
»giÚ1_couÁ
 = 
ä
.
	`g‘B™s
(3);

417 
gr_šfo
.
»giÚ1¡¬t
 = 
bªdInfo
[
säeq
].
lÚgIdx
[
r0c
+1] >> 1 ;

418 
gr_šfo
.
»giÚ2¡¬t
 = 
bªdInfo
[
säeq
].
lÚgIdx
[
r0c
+1+
r1c
+1] >> 1;

419 
gr_šfo
.
block_ty³
 = 0;

420 
gr_šfo
.
mixed_block_æag
 = 0;

422 
gr_šfo
.
´eæag
 = 
ä
.
	`g‘1B™
();

423 
gr_šfo
.
sÿËçc_sÿË
 = 
ä
.
	`g‘1B™
();

424 
gr_šfo
.
couÁ1bË_£Ëù
 = 
ä
.
	`g‘1B™
();

427 
	}
}

429 
	$g‘SideInfo2
(
MP3F¿meP¬ams
& 
ä
, 
MP3SideInfo
& 
si
,

430 
¡”eo
, 
ms_¡”eo
, 
säeq
,

432 
ch
;

434 
powdiff
 = (
sšgË
 == 3) ? 4 : 0;

438 
si
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
 = 0; si.ch[1].gr[0].part2_3_length = 0;

439 
si
.
ch
[0].
gr
[1].
·¹2_3_Ëngth
 = 0; si.ch[1].gr[1].part2_3_length = 0;

441 
si
.
maš_d©a_begš
 = 
ä
.
	`g‘B™s
(8);

442 ià(
¡”eo
 == 1)

443 
si
.
´iv©e_b™s
 = 
ä
.
	`g‘1B™
();

445 
si
.
´iv©e_b™s
 = 
ä
.
	`g‘B™s
(2);

447 
ch
=0; ch<
¡”eo
; ch++) {

448 
MP3SideInfo
::
gr_šfo_s_t
& 
gr_šfo
 = 
si
.
ch
[ch].
gr
[0];

450 
gr_šfo
.
·¹2_3_Ëngth
 = 
ä
.
	`g‘B™s
(12);

451 
si
.
ch
[ch].
gr
[1].
·¹2_3_Ëngth
 = 0;

453 
gr_šfo
.
big_v®ues
 = 
ä
.
	`g‘B™s
(9);

454 
gr_šfo
.
glob®_gaš
 = 
ä
.
	`g‘B™s
(8);

456 
gr_šfo
.
pow2gaš
 = 
gašpow2
+256 - gr_šfo.
glob®_gaš
 + 
powdiff
;

457 ià(
ms_¡”eo
è
gr_šfo
.
pow2gaš
 += 2;

459 
gr_šfo
.
sÿËçc_com´ess
 = 
ä
.
	`g‘B™s
(9);

461 
gr_šfo
.
wšdow_sw™chšg_æag
 = 
ä
.
	`g‘1B™
();

462 ià(
gr_šfo
.
wšdow_sw™chšg_æag
) {

463 
i
;

464 
gr_šfo
.
block_ty³
 = 
ä
.
	`g‘B™s
(2);

465 
gr_šfo
.
mixed_block_æag
 = 
ä
.
	`g‘1B™
();

466 
gr_šfo
.
bË_£Ëù
[0] = 
ä
.
	`g‘B™s
(5);

467 
gr_šfo
.
bË_£Ëù
[1] = 
ä
.
	`g‘B™s
(5);

472 
gr_šfo
.
bË_£Ëù
[2] = 0;

473 
i
=0;i<3;i++) {

474 
gr_šfo
.
subblock_gaš
[
i
] = 
ä
.
	`g‘B™s
(3);

475 
gr_šfo
.
fuÎ_gaš
[
i
]

476 ğ
gr_šfo
.
pow2gaš
 + ((gr_šfo.
subblock_gaš
[
i
])<<3);

479 #ifdeà
DEBUG_ERRORS


480 ià(
gr_šfo
.
block_ty³
 == 0) {

481 
	`årštf
(
¡d”r
,"Blocktype == 0‡nd window-switching == 1‚ot‡llowed.\n");

486 ià(
gr_šfo
.
block_ty³
 == 2)

487 
gr_šfo
.
»giÚ1¡¬t
 = 36>>1;

489 
gr_šfo
.
»giÚ1¡¬t
 = 54>>1;

491 
gr_šfo
.
»giÚ2¡¬t
 = 576>>1;

495 
i
,
r0c
,
r1c
;

496 
i
=0; i<3; i++) {

497 
gr_šfo
.
bË_£Ëù
[
i
] = 
ä
.
	`g‘B™s
(5);

499 
r0c
 = 
gr_šfo
.
»giÚ0_couÁ
 = 
ä
.
	`g‘B™s
(4);

500 
r1c
 = 
gr_šfo
.
»giÚ1_couÁ
 = 
ä
.
	`g‘B™s
(3);

501 
gr_šfo
.
»giÚ1¡¬t
 = 
bªdInfo
[
säeq
].
lÚgIdx
[
r0c
+1] >> 1 ;

502 
gr_šfo
.
»giÚ2¡¬t
 = 
bªdInfo
[
säeq
].
lÚgIdx
[
r0c
+1+
r1c
+1] >> 1;

503 
gr_šfo
.
block_ty³
 = 0;

504 
gr_šfo
.
mixed_block_æag
 = 0;

506 
gr_šfo
.
sÿËçc_sÿË
 = 
ä
.
	`g‘1B™
();

507 
gr_šfo
.
couÁ1bË_£Ëù
 = 
ä
.
	`g‘1B™
();

509 
	}
}

512 
	#MPG_MD_JOINT_STEREO
 1

	)

514 
	gMP3F¿meP¬ams
::
	$g‘SideInfo
(
MP3SideInfo
& 
si
) {

516 ià(
hasCRC
è
	`g‘B™s
(16);

518 
sšgË
 = -1;

519 
ms_¡”eo
;

520 
säeq
 = 
§m¶šgF»qIndex
;

522 ià(
¡”eo
 == 1) {

523 
sšgË
 = 0;

526 
ms_¡”eo
 = (
mode
 =ğ
MPG_MD_JOINT_STEREO
è&& (
mode_ext
 & 0x2);

528 ià(
isMPEG2
) {

529 
	`g‘SideInfo2
(*
this
, 
si
, 
¡”eo
, 
ms_¡”eo
, 
säeq
, 
sšgË
);

531 
	`g‘SideInfo1
(*
this
, 
si
, 
¡”eo
, 
ms_¡”eo
, 
säeq
, 
sšgË
);

533 
	}
}

535 
	$putSideInfo1
(
B™VeùÜ
& 
bv
,

536 
MP3SideInfo
 cÚ¡& 
si
, 
BoŞ—n
 
isS‹»o
) {

537 
ch
, 
gr
, 
i
;

538 
¡”eo
 = 
isS‹»o
 ? 2 : 1;

540 
bv
.
	`putB™s
(
si
.
maš_d©a_begš
,9);

541 ià(
¡”eo
 == 1)

542 
bv
.
	`putB™s
(
si
.
´iv©e_b™s
, 5);

544 
bv
.
	`putB™s
(
si
.
´iv©e_b™s
, 3);

546 
ch
=0; ch<
¡”eo
; ch++) {

547 
bv
.
	`putB™s
(
si
.
ch
[ch].
gr
[1].
scfsi
, 4);

550 
gr
=0; gr<2; gr++) {

551 
ch
=0; ch<
¡”eo
; ch++) {

552 
MP3SideInfo
::
gr_šfo_s_t
 cÚ¡& 
gr_šfo
 = 
si
.
ch
[ch].
gr
[gr];

554 
bv
.
	`putB™s
(
gr_šfo
.
·¹2_3_Ëngth
, 12);

555 
bv
.
	`putB™s
(
gr_šfo
.
big_v®ues
, 9);

556 
bv
.
	`putB™s
(
gr_šfo
.
glob®_gaš
, 8);

557 
bv
.
	`putB™s
(
gr_šfo
.
sÿËçc_com´ess
, 4);

558 
bv
.
	`put1B™
(
gr_šfo
.
wšdow_sw™chšg_æag
);

559 ià(
gr_šfo
.
wšdow_sw™chšg_æag
) {

560 
bv
.
	`putB™s
(
gr_šfo
.
block_ty³
, 2);

561 
bv
.
	`put1B™
(
gr_šfo
.
mixed_block_æag
);

562 
i
=0; i<2; i++)

563 
bv
.
	`putB™s
(
gr_šfo
.
bË_£Ëù
[
i
], 5);

564 
i
=0; i<3; i++)

565 
bv
.
	`putB™s
(
gr_šfo
.
subblock_gaš
[
i
], 3);

568 
i
=0; i<3; i++)

569 
bv
.
	`putB™s
(
gr_šfo
.
bË_£Ëù
[
i
], 5);

570 
bv
.
	`putB™s
(
gr_šfo
.
»giÚ0_couÁ
, 4);

571 
bv
.
	`putB™s
(
gr_šfo
.
»giÚ1_couÁ
, 3);

574 
bv
.
	`put1B™
(
gr_šfo
.
´eæag
);

575 
bv
.
	`put1B™
(
gr_šfo
.
sÿËçc_sÿË
);

576 
bv
.
	`put1B™
(
gr_šfo
.
couÁ1bË_£Ëù
);

579 
	}
}

581 
	$putSideInfo2
(
B™VeùÜ
& 
bv
,

582 
MP3SideInfo
 cÚ¡& 
si
, 
BoŞ—n
 
isS‹»o
) {

583 
ch
, 
i
;

584 
¡”eo
 = 
isS‹»o
 ? 2 : 1;

586 
bv
.
	`putB™s
(
si
.
maš_d©a_begš
,8);

587 ià(
¡”eo
 == 1)

588 
bv
.
	`put1B™
(
si
.
´iv©e_b™s
);

590 
bv
.
	`putB™s
(
si
.
´iv©e_b™s
, 2);

592 
ch
=0; ch<
¡”eo
; ch++) {

593 
MP3SideInfo
::
gr_šfo_s_t
 cÚ¡& 
gr_šfo
 = 
si
.
ch
[ch].
gr
[0];

595 
bv
.
	`putB™s
(
gr_šfo
.
·¹2_3_Ëngth
, 12);

596 
bv
.
	`putB™s
(
gr_šfo
.
big_v®ues
, 9);

597 
bv
.
	`putB™s
(
gr_šfo
.
glob®_gaš
, 8);

598 
bv
.
	`putB™s
(
gr_šfo
.
sÿËçc_com´ess
, 9);

599 
bv
.
	`put1B™
(
gr_šfo
.
wšdow_sw™chšg_æag
);

600 ià(
gr_šfo
.
wšdow_sw™chšg_æag
) {

601 
bv
.
	`putB™s
(
gr_šfo
.
block_ty³
, 2);

602 
bv
.
	`put1B™
(
gr_šfo
.
mixed_block_æag
);

603 
i
=0; i<2; i++)

604 
bv
.
	`putB™s
(
gr_šfo
.
bË_£Ëù
[
i
], 5);

605 
i
=0; i<3; i++)

606 
bv
.
	`putB™s
(
gr_šfo
.
subblock_gaš
[
i
], 3);

609 
i
=0; i<3; i++)

610 
bv
.
	`putB™s
(
gr_šfo
.
bË_£Ëù
[
i
], 5);

611 
bv
.
	`putB™s
(
gr_šfo
.
»giÚ0_couÁ
, 4);

612 
bv
.
	`putB™s
(
gr_šfo
.
»giÚ1_couÁ
, 3);

615 
bv
.
	`put1B™
(
gr_šfo
.
sÿËçc_sÿË
);

616 
bv
.
	`put1B™
(
gr_šfo
.
couÁ1bË_£Ëù
);

618 
	}
}

620 
	$PutMP3SideInfoIÁoF¿me
(
MP3SideInfo
 cÚ¡& 
si
,

621 
MP3F¿meP¬ams
 cÚ¡& 
ä
,

622 * 
äamePŒ
) {

623 ià(
ä
.
hasCRC
è
äamePŒ
 += 2;

625 
B™VeùÜ
 
	`bv
(
äamePŒ
, 0, 8*
ä
.
sideInfoSize
);

627 ià(
ä
.
isMPEG2
) {

628 
	`putSideInfo2
(
bv
, 
si
, 
ä
.
isS‹»o
);

630 
	`putSideInfo1
(
bv
, 
si
, 
ä
.
isS‹»o
);

632 
	}
}

635 
BoŞ—n
 
	$Z”oOutMP3SideInfo
(* 
äamePŒ
, 
tÙF¿meSize
,

636 
ÃwBackpoš‹r
) {

637 ià(
tÙF¿meSize
 < 4è 
F®£
;

639 
MP3F¿meP¬ams
 
ä
;

640 
ä
.
hdr
 = (()
äamePŒ
[0] << 24) | (()framePtr[1] << 16)

641 | (()
äamePŒ
[2] << 8) | ()framePtr[3];

642 
ä
.
	`£tP¬amsFromH—d”
();

643 
ä
.
	`£tBy‹Poš‹r
(
äamePŒ
 + 4, 
tÙF¿meSize
 - 4);

645 ià(
tÙF¿meSize
 < 4 + 
ä
.
sideInfoSize
è 
F®£
;

647 
MP3SideInfo
 
si
;

648 
ä
.
	`g‘SideInfo
(
si
);

650 
si
.
maš_d©a_begš
 = 
ÃwBackpoš‹r
;

652 
si
.
ch
[0].
gr
[0].
·¹2_3_Ëngth
 = si.ch[0].gr[0].
big_v®ues
 = 0;

653 
si
.
ch
[1].
gr
[0].
·¹2_3_Ëngth
 = si.ch[1].gr[0].
big_v®ues
 = 0;

654 
si
.
ch
[0].
gr
[1].
·¹2_3_Ëngth
 = si.ch[0].gr[1].
big_v®ues
 = 0;

655 
si
.
ch
[1].
gr
[1].
·¹2_3_Ëngth
 = si.ch[1].gr[1].
big_v®ues
 = 0;

657 
	`PutMP3SideInfoIÁoF¿me
(
si
, 
ä
, 
äamePŒ
 + 4);

659  
True
;

660 
	}
}

663 
	$MP3B™¿‹ToB™¿‹Index
(
b™¿‹
 ,

664 
BoŞ—n
 
isMPEG2
) {

665 
i
 = 1; i < 15; ++i) {

666 ià(
live_b£l
[
isMPEG2
][2][
i
] >ğ
b™¿‹
)

667  
i
;

672 
	}
}

674 
	$ouutH—d”
(* 
toPŒ
, 
hdr
) {

675 
toPŒ
[0] = ()(
hdr
>>24);

676 
toPŒ
[1] = ()(
hdr
>>16);

677 
toPŒ
[2] = ()(
hdr
>>8);

678 
toPŒ
[3] = ()(
hdr
);

679 
	}
}

681 
	$assignADUBackpoš‹r
(
MP3F¿meP¬ams
 cÚ¡& 
ä
,

682 
aduSize
,

683 
MP3SideInfo
& 
sideInfo
,

684 & 
avaabËBy‹sFÜBackpoš‹r
) {

686 
maxBackpoš‹rSize
 = 
ä
.
isMPEG2
 ? 255 : 511;

688 
backpoš‹rSize
 = 
avaabËBy‹sFÜBackpoš‹r
;

689 ià(
backpoš‹rSize
 > 
maxBackpoš‹rSize
) {

690 
backpoš‹rSize
 = 
maxBackpoš‹rSize
;

694 
sideInfo
.
maš_d©a_begš
 = 
backpoš‹rSize
;

697 
avaabËBy‹sFÜBackpoš‹r


698 ğ
backpoš‹rSize
 + 
ä
.
äameSize
 - fr.
sideInfoSize
 ;

699 ià(
avaabËBy‹sFÜBackpoš‹r
 < 
aduSize
) {

700 
avaabËBy‹sFÜBackpoš‹r
 = 0;

702 
avaabËBy‹sFÜBackpoš‹r
 -ğ
aduSize
;

704 
	}
}

706 
	$T¿nscodeMP3ADU
(cÚ¡* 
äomPŒ
, 
äomSize
,

707 
toB™¿‹
,

708 * 
toPŒ
, 
toMaxSize
,

709 & 
avaabËBy‹sFÜBackpoš‹r
) {

711 
hdr
, 
šF¿meSize
, 
šSideInfoSize
, 
backpoš‹r
, 
šAduSize
;

712 
MP3SideInfo
 
sideInfo
;

713 ià(!
	`G‘ADUInfoFromMP3F¿me
(
äomPŒ
, 
äomSize
,

714 
hdr
, 
šF¿meSize
, 
sideInfo
, 
šSideInfoSize
,

715 
backpoš‹r
, 
šAduSize
)) {

718 
äomPŒ
 +ğ(4+
šSideInfoSize
);

722 
BoŞ—n
 
isMPEG2
 = ((
hdr
&0x00080000) == 0);

723 
toB™¿‹Index
 = 
	`MP3B™¿‹ToB™¿‹Index
(
toB™¿‹
, 
isMPEG2
);

724 
hdr
 &=~ 0xF000; hd¸|ğ(
toB™¿‹Index
<<12);

725 
hdr
 |= 0x10200;

726 
hdr
 &=~ 0xC0; hdr |= 0xC0;

729 
MP3F¿meP¬ams
 
outFr
;

730 
outFr
.
hdr
 = hdr;

731 
outFr
.
	`£tP¬amsFromH—d”
();

734 
šAveAduSize
 = 
šF¿meSize
 - 
šSideInfoSize
;

735 
outAveAduSize
 = 
outFr
.
äameSize
 - outFr.
sideInfoSize
;

736 
desœedOutAduSize


737 ğ(2*
šAduSize
*
outAveAduSize
 + 
šAveAduSize
)/(2*inAveAduSize);

740 ià(
toMaxSize
 < (4 + 
outFr
.
sideInfoSize
))  0;

741 
maxOutAduSize
 = 
toMaxSize
 - (4 + 
outFr
.
sideInfoSize
);

742 ià(
desœedOutAduSize
 > 
maxOutAduSize
) {

743 
desœedOutAduSize
 = 
maxOutAduSize
;

748 
·¹23L’gth0a
, 
·¹23L’gth0aTrunÿtiÚ
;

749 
·¹23L’gth0b
, 
·¹23L’gth0bTrunÿtiÚ
;

750 
·¹23L’gth1a
, 
·¹23L’gth1aTrunÿtiÚ
;

751 
·¹23L’gth1b
, 
·¹23L’gth1bTrunÿtiÚ
;

752 
numAduB™s


753 ğ
	`upd©eSideInfoSizes
(
sideInfo
, 
outFr
.
isMPEG2
,

754 
äomPŒ
, 8*
desœedOutAduSize
,

755 
·¹23L’gth0a
, 
·¹23L’gth0aTrunÿtiÚ
,

756 
·¹23L’gth0b
, 
·¹23L’gth0bTrunÿtiÚ
,

757 
·¹23L’gth1a
, 
·¹23L’gth1aTrunÿtiÚ
,

758 
·¹23L’gth1b
, 
·¹23L’gth1bTrunÿtiÚ
);

759 #ifdeà
DEBUG


760 
	`årštf
(
¡d”r
, "shrškag%d->%d [(%d,%d),(%d,%d)] (Œunc: [(%d,%d),(%d,%d)]è{%d}\n", 
šAduSize
, (
numAduB™s
+7)/8,

761 
·¹23L’gth0a
, 
·¹23L’gth0b
, 
·¹23L’gth1a
, 
·¹23L’gth1b
,

762 
·¹23L’gth0aTrunÿtiÚ
, 
·¹23L’gth0bTrunÿtiÚ
,

763 
·¹23L’gth1aTrunÿtiÚ
, 
·¹23L’gth1bTrunÿtiÚ
,

764 
maxOutAduSize
);

766 
aùu®OutAduSize
 = (
numAduB™s
+7)/8;

769 
	`assignADUBackpoš‹r
(
outFr
, 
aùu®OutAduSize
, 
sideInfo
, 
avaabËBy‹sFÜBackpoš‹r
);

774 
	`ouutH—d”
(
toPŒ
, 
hdr
);oPtr += 4;

777 
	`PutMP3SideInfoIÁoF¿me
(
sideInfo
, 
outFr
, 
toPŒ
);oPŒ +ğoutFr.
sideInfoSize
;

780 
toB™Off£t
 = 0;

781 
äomB™Off£t
 = 0;

784 
	`memmove
(
toPŒ
, 
äomPŒ
, (
·¹23L’gth0a
+7)/8);

785 
toB™Off£t
 +ğ
·¹23L’gth0a
;

786 
äomB™Off£t
 +ğ
·¹23L’gth0a
 + 
·¹23L’gth0aTrunÿtiÚ
;

789 
	`shiáB™s
(
toPŒ
, 
toB™Off£t
, 
äomPŒ
, 
äomB™Off£t
, 
·¹23L’gth0b
);

790 
toB™Off£t
 +ğ
·¹23L’gth0b
;

791 
äomB™Off£t
 +ğ
·¹23L’gth0b
 + 
·¹23L’gth0bTrunÿtiÚ
;

794 
	`shiáB™s
(
toPŒ
, 
toB™Off£t
, 
äomPŒ
, 
äomB™Off£t
, 
·¹23L’gth1a
);

795 
toB™Off£t
 +ğ
·¹23L’gth1a
;

796 
äomB™Off£t
 +ğ
·¹23L’gth1a
 + 
·¹23L’gth1aTrunÿtiÚ
;

799 
	`shiáB™s
(
toPŒ
, 
toB™Off£t
, 
äomPŒ
, 
äomB™Off£t
, 
·¹23L’gth1b
);

800 
toB™Off£t
 +ğ
·¹23L’gth1b
;

803 cÚ¡ 
z”o
 = '\0';

804 
	`shiáB™s
(
toPŒ
, 
toB™Off£t
, &
z”o
, 0,

805 
aùu®OutAduSize
*8 - 
numAduB™s
);

807  4 + 
outFr
.
sideInfoSize
 + 
aùu®OutAduSize
;

808 
	}
}

	@liveMedia/MP3InternalsHuffman.cpp

21 
	~"MP3IÁ”ÇlsHuffmª.hh
"

22 
	~<¡dio.h
>

23 
	~<¡ršg.h
>

24 
	~<¡dlib.h
>

26 
	gMP3HuffmªEncodšgInfo


27 ::
	$MP3HuffmªEncodšgInfo
(
BoŞ—n
 
šşudeDecodedV®ues
) {

28 ià(
šşudeDecodedV®ues
) {

29 
decodedV®ues
 = 
Ãw
 [(
SBLIMIT
*
SSLIMIT
 + 1)*4];

31 
decodedV®ues
 = 
NULL
;

33 
	}
}

35 
	gMP3HuffmªEncodšgInfo
::~
	$MP3HuffmªEncodšgInfo
() {

36 
d–‘e
[] 
decodedV®ues
;

37 
	}
}

41 
	gdebugCouÁ
 = 0;

43 
	#TRUNC_FAVORa


	)

45 
	$upd©eSideInfoFÜHuffmª
(
MP3SideInfo
& 
sideInfo
, 
BoŞ—n
 
isMPEG2
,

46 cÚ¡* 
mašD©aPŒ
,

47 
p23L0
, 
p23L1
,

48 & 
·¹23L’gth0a
,

49 & 
·¹23L’gth0aTrunÿtiÚ
,

50 & 
·¹23L’gth0b
,

51 & 
·¹23L’gth0bTrunÿtiÚ
,

52 & 
·¹23L’gth1a
,

53 & 
·¹23L’gth1aTrunÿtiÚ
,

54 & 
·¹23L’gth1b
,

55 & 
·¹23L’gth1bTrunÿtiÚ
) {

56 
i
, 
j
;

57 
sfL’gth
, 
ÜigTÙABsize
, 
adju¡m’t
;

58 
MP3SideInfo
::
gr_šfo_s_t
* 
gr
;

63 
MP3HuffmªEncodšgInfo
 
hei
;

65 ++
debugCouÁ
;

66 #ifdeà
DEBUG


67 
	`årštf
(
¡d”r
, "usifh-¡¬t:…23L0: %d,…23L1: %d\n", 
p23L0
, 
p23L1
);

72 
gr
 = &(
sideInfo
.
ch
[0].gr[0]);

73 
ÜigTÙABsize
 = 
gr
->
·¹2_3_Ëngth
;

75 
	`MP3HuffmªDecode
(
gr
, 
isMPEG2
, 
mašD©aPŒ
, 0, 
ÜigTÙABsize
, 
sfL’gth
, 
hei
);

78 #ifdeà
DEBUG


79 
	`årštf
(
¡d”r
, "usifh-0: %d, %d:%d, %d:%d, %d:%d, %d:%d, %d:%d\n",

80 
hei
.
numSam¶es
,

81 
sfL’gth
/8, sfLength%8,

82 
hei
.
»g1S¹
/8, hei.reg1Start%8,

83 
hei
.
»g2S¹
/8, hei.reg2Start%8,

84 
hei
.
bigv®S¹
/8, hei.bigvalStart%8,

85 
ÜigTÙABsize
/8, origTotABsize%8);

87 ià(
p23L0
 < 
sfL’gth
) {

89 
p23L1
 +ğ
p23L0
;

90 
p23L0
 = 0;

93 
·¹23L’gth0a
 = 
hei
.
bigv®S¹
;

94 
·¹23L’gth0b
 = 
ÜigTÙABsize
 - 
hei
.
bigv®S¹
;

95 
·¹23L’gth0aTrunÿtiÚ
 = 
·¹23L’gth0bTrunÿtiÚ
 = 0;

96 ià(
ÜigTÙABsize
 > 
p23L0
) {

98 
ŒunÿtiÚ
 = 
ÜigTÙABsize
 - 
p23L0
;

99 #ifdeà
TRUNC_FAIRLY


100 
·¹23L’gth0aTrunÿtiÚ
 = (
ŒunÿtiÚ
*(
·¹23L’gth0a
-
sfL’gth
))

101 /(
ÜigTÙABsize
-
sfL’gth
);

102 
·¹23L’gth0bTrunÿtiÚ
 = 
ŒunÿtiÚ
 - 
·¹23L’gth0aTrunÿtiÚ
;

104 #ifdeà
TRUNC_FAVORa


105 
·¹23L’gth0bTrunÿtiÚ


106 ğ(
ŒunÿtiÚ
 > 
·¹23L’gth0b
) ?…art23Length0b :runcation;

107 
·¹23L’gth0aTrunÿtiÚ
 = 
ŒunÿtiÚ
 - 
·¹23L’gth0bTrunÿtiÚ
;

109 #ifdeà
TRUNC_FAVORb


110 
·¹23L’gth0aTrunÿtiÚ
 = (
ŒunÿtiÚ
 > 
·¹23L’gth0a
-
sfL’gth
)

111 ? (
·¹23L’gth0a
-
sfL’gth
è: 
ŒunÿtiÚ
;

112 
·¹23L’gth0bTrunÿtiÚ
 = 
ŒunÿtiÚ
 - 
·¹23L’gth0aTrunÿtiÚ
;

116 
·¹23L’gth0a
 -ğ
·¹23L’gth0aTrunÿtiÚ
;

117 
·¹23L’gth0b
 -ğ
·¹23L’gth0bTrunÿtiÚ
;

118 #ifdeà
DEBUG


119 
	`årštf
(
¡d”r
, "usifh-0: interim sizes: %d (%d), %d (%d)\n",

120 
·¹23L’gth0a
, 
·¹23L’gth0aTrunÿtiÚ
,

121 
·¹23L’gth0b
, 
·¹23L’gth0bTrunÿtiÚ
);

125 
i
 = 0; i < ()
hei
.
numSam¶es
; ++i) {

126 ià(
hei
.
®lB™Off£ts
[
i
] =ğ
·¹23L’gth0a
) ;

127 ià(
hei
.
®lB™Off£ts
[
i
] > 
·¹23L’gth0a
) {--i; ;}

129 ià(
i
 < 0) {

130 
i
 = 0; 
adju¡m’t
 = 0;

132 
adju¡m’t
 = 
·¹23L’gth0a
 - 
hei
.
®lB™Off£ts
[
i
];

134 #ifdeà
DEBUG


135 
	`årštf
(
¡d”r
, "%d usifh-0:‡dju¡m’ˆ1: %d\n", 
debugCouÁ
, 
adju¡m’t
);

137 
·¹23L’gth0a
 -ğ
adju¡m’t
;

138 
·¹23L’gth0aTrunÿtiÚ
 +ğ
adju¡m’t
;

140 ià(
·¹23L’gth0bTrunÿtiÚ
 < 
adju¡m’t
) {

141 
p23L1
 +ğ(
adju¡m’t
 - 
·¹23L’gth0bTrunÿtiÚ
);

142 
adju¡m’t
 = 
·¹23L’gth0bTrunÿtiÚ
;

144 
·¹23L’gth0b
 +ğ
adju¡m’t
;

145 
·¹23L’gth0bTrunÿtiÚ
 -ğ
adju¡m’t
;

146 
j
 = 
i
; j < ()
hei
.
numSam¶es
; ++j) {

147 ià(
hei
.
®lB™Off£ts
[
j
]

148 =ğ
·¹23L’gth0a
 + 
·¹23L’gth0aTrunÿtiÚ
 + 
·¹23L’gth0b
)

150 ià(
hei
.
®lB™Off£ts
[
j
]

151 > 
·¹23L’gth0a
 + 
·¹23L’gth0aTrunÿtiÚ
 + 
·¹23L’gth0b
)

152 {--
j
; ;}

154 ià(
j
 < 0) {

155 
j
 = 0; 
adju¡m’t
 = 0;

157 
adju¡m’t
 = 
·¹23L’gth0a
+
·¹23L’gth0aTrunÿtiÚ
+
·¹23L’gth0b


158 - 
hei
.
®lB™Off£ts
[
j
];

160 #ifdeà
DEBUG


161 
	`årštf
(
¡d”r
, "%d usifh-0:‡dju¡m’ˆ2: %d\n", 
debugCouÁ
, 
adju¡m’t
);

163 ià(
adju¡m’t
 > 
·¹23L’gth0b
)‡djustment =…art23Length0b;

164 
·¹23L’gth0b
 -ğ
adju¡m’t
;

165 
·¹23L’gth0bTrunÿtiÚ
 +ğ
adju¡m’t
;

167 
p23L1
 +ğ
adju¡m’t
;

169 ià(
·¹23L’gth0aTrunÿtiÚ
 > 0) {

171 
gr
->
big_v®ues
 = 
i
;

177 ià(
isMPEG2
) {

178 
·¹23L’gth1a
 = 
·¹23L’gth1b
 = 0;

179 
·¹23L’gth1aTrunÿtiÚ
 = 
·¹23L’gth1bTrunÿtiÚ
 = 0;

181 
g¿nuË1Off£t


182 ğ
ÜigTÙABsize
 + 
sideInfo
.
ch
[1].
gr
[0].
·¹2_3_Ëngth
;

184 
gr
 = &(
sideInfo
.
ch
[0].gr[1]);

185 
ÜigTÙABsize
 = 
gr
->
·¹2_3_Ëngth
;

187 
	`MP3HuffmªDecode
(
gr
, 
isMPEG2
, 
mašD©aPŒ
, 
g¿nuË1Off£t
,

188 
ÜigTÙABsize
, 
sfL’gth
, 
hei
);

191 #ifdeà
DEBUG


192 
	`årštf
(
¡d”r
, "usifh-1: %d, %d:%d, %d:%d, %d:%d, %d:%d, %d:%d\n",

193 
hei
.
numSam¶es
,

194 
sfL’gth
/8, sfLength%8,

195 
hei
.
»g1S¹
/8, hei.reg1Start%8,

196 
hei
.
»g2S¹
/8, hei.reg2Start%8,

197 
hei
.
bigv®S¹
/8, hei.bigvalStart%8,

198 
ÜigTÙABsize
/8, origTotABsize%8);

200 ià(
p23L1
 < 
sfL’gth
) {

202 
p23L1
 = 0;

205 
·¹23L’gth1a
 = 
hei
.
bigv®S¹
;

206 
·¹23L’gth1b
 = 
ÜigTÙABsize
 - 
hei
.
bigv®S¹
;

207 
·¹23L’gth1aTrunÿtiÚ
 = 
·¹23L’gth1bTrunÿtiÚ
 = 0;

208 ià(
ÜigTÙABsize
 > 
p23L1
) {

210 
ŒunÿtiÚ
 = 
ÜigTÙABsize
 - 
p23L1
;

211 #ifdeà
TRUNC_FAIRLY


212 
·¹23L’gth1aTrunÿtiÚ
 = (
ŒunÿtiÚ
*(
·¹23L’gth1a
-
sfL’gth
))

213 /(
ÜigTÙABsize
-
sfL’gth
);

214 
·¹23L’gth1bTrunÿtiÚ
 = 
ŒunÿtiÚ
 - 
·¹23L’gth1aTrunÿtiÚ
;

216 #ifdeà
TRUNC_FAVORa


217 
·¹23L’gth1bTrunÿtiÚ


218 ğ(
ŒunÿtiÚ
 > 
·¹23L’gth1b
) ?…art23Length1b :runcation;

219 
·¹23L’gth1aTrunÿtiÚ
 = 
ŒunÿtiÚ
 - 
·¹23L’gth1bTrunÿtiÚ
;

221 #ifdeà
TRUNC_FAVORb


222 
·¹23L’gth1aTrunÿtiÚ
 = (
ŒunÿtiÚ
 > 
·¹23L’gth1a
-
sfL’gth
)

223 ? (
·¹23L’gth1a
-
sfL’gth
è: 
ŒunÿtiÚ
;

224 
·¹23L’gth1bTrunÿtiÚ
 = 
ŒunÿtiÚ
 - 
·¹23L’gth1aTrunÿtiÚ
;

228 
·¹23L’gth1a
 -ğ
·¹23L’gth1aTrunÿtiÚ
;

229 
·¹23L’gth1b
 -ğ
·¹23L’gth1bTrunÿtiÚ
;

230 #ifdeà
DEBUG


231 
	`årštf
(
¡d”r
, "usifh-1: interim sizes: %d (%d), %d (%d)\n",

232 
·¹23L’gth1a
, 
·¹23L’gth1aTrunÿtiÚ
,

233 
·¹23L’gth1b
, 
·¹23L’gth1bTrunÿtiÚ
);

237 
i
 = 0; i < ()
hei
.
numSam¶es
; ++i) {

238 ià(
hei
.
®lB™Off£ts
[
i
] =ğ
·¹23L’gth1a
) ;

239 ià(
hei
.
®lB™Off£ts
[
i
] > 
·¹23L’gth1a
) {--i; ;}

241 ià(
i
 < 0) {

242 
i
 = 0; 
adju¡m’t
 = 0;

244 
adju¡m’t
 = 
·¹23L’gth1a
 - 
hei
.
®lB™Off£ts
[
i
];

246 #ifdeà
DEBUG


247 
	`årštf
(
¡d”r
, "%d usifh-1:‡dju¡m’ˆ0: %d\n", 
debugCouÁ
, 
adju¡m’t
);

249 
·¹23L’gth1a
 -ğ
adju¡m’t
;

250 
·¹23L’gth1aTrunÿtiÚ
 +ğ
adju¡m’t
;

252 ià(
·¹23L’gth1bTrunÿtiÚ
 < 
adju¡m’t
) {

253 
adju¡m’t
 = 
·¹23L’gth1bTrunÿtiÚ
;

255 
·¹23L’gth1b
 +ğ
adju¡m’t
;

256 
·¹23L’gth1bTrunÿtiÚ
 -ğ
adju¡m’t
;

257 
j
 = 
i
; j < ()
hei
.
numSam¶es
; ++j) {

258 ià(
hei
.
®lB™Off£ts
[
j
]

259 =ğ
·¹23L’gth1a
 + 
·¹23L’gth1aTrunÿtiÚ
 + 
·¹23L’gth1b
)

261 ià(
hei
.
®lB™Off£ts
[
j
]

262 > 
·¹23L’gth1a
 + 
·¹23L’gth1aTrunÿtiÚ
 + 
·¹23L’gth1b
)

263 {--
j
; ;}

265 ià(
j
 < 0) {

266 
j
 = 0; 
adju¡m’t
 = 0;

268 
adju¡m’t
 = 
·¹23L’gth1a
+
·¹23L’gth1aTrunÿtiÚ
+
·¹23L’gth1b


269 - 
hei
.
®lB™Off£ts
[
j
];

271 #ifdeà
DEBUG


272 
	`årštf
(
¡d”r
, "%d usifh-1:‡dju¡m’ˆ1: %d\n", 
debugCouÁ
, 
adju¡m’t
);

274 ià(
adju¡m’t
 > 
·¹23L’gth1b
)‡djustment =…art23Length1b;

275 
·¹23L’gth1b
 -ğ
adju¡m’t
;

276 
·¹23L’gth1bTrunÿtiÚ
 +ğ
adju¡m’t
;

278 ià(
·¹23L’gth1aTrunÿtiÚ
 > 0) {

280 
gr
->
big_v®ues
 = 
i
;

283 #ifdeà
DEBUG


284 
	`årštf
(
¡d”r
, "usifh-end,‚ew vals: %d (%d), %d (%d), %d (%d), %d (%d)\n",

285 
·¹23L’gth0a
, 
·¹23L’gth0aTrunÿtiÚ
,

286 
·¹23L’gth0b
, 
·¹23L’gth0bTrunÿtiÚ
,

287 
·¹23L’gth1a
, 
·¹23L’gth1aTrunÿtiÚ
,

288 
·¹23L’gth1b
, 
·¹23L’gth1bTrunÿtiÚ
);

290 
	}
}

292 
	$rsf_g‘lše
(* 
lše
, 
max
, **
fi
) {

293 
i
;

294 
i
 = 0; i < 
max
; ++i) {

295 
lše
[
i
] = *(*
fi
)++;

296 ià(
lše
[
i
] == '\n') {

297 
lše
[
i
++] = '\0';

301 
lše
[
i
] = '\0';

302 
	}
}

304 
	$rsfsÿnf
(**
fi
, * 
v
) {

305 
	`ssÿnf
((*)*
fi
, "%x", 
v
) == 0) {

307 *(*
fi
)++ != '\0') {}

311 *(*
fi
) <= ' ') ++(*fi);

314 *(*
fi
) > ' ') ++(*fi);

315 
	}
}

317 
	#HUFFBITS
 

	)

318 
	#SIZEOF_HUFFBITS
 4

	)

319 
	#HTN
 34

	)

320 
	#MXOFF
 250

	)

322 
	shuffcod‘ab
 {

323 
	mbËÇme
[3];

324 
	mxËn
;

325 
	myËn
;

326 
	mlšb™s
;

327 
	mlšmax
;

328 
	m»f
;

329 
HUFFBITS
 *
	mbË
;

330 *
	mhËn
;

331 (*
	mv®
)[2];

332 
	mŒ“Ën
;

335 
huffcod‘ab
 
	grsf_ht
[
HTN
];

340 
	$»ad_decod”_bË
(* 
fi
) {

341 
n
,
i
,
Â
,
t
;

342 
v0
,
v1
;

343 
commªd
[100],
lše
[100];

344 
n
=0;n<
HTN
;n++) {

345 
rsf_ht
[
n
].
bË
 = 
NULL
;

346 
rsf_ht
[
n
].
hËn
 = 
NULL
;

350 
	`rsf_g‘lše
(
lše
,99,&
fi
);

351 } (
lše
[0] == '#') || (line[0] < ' '));

353 
	`ssÿnf
(
lše
,"% % %u %u %u %u",
commªd
,
rsf_ht
[
n
].
bËÇme
,

354 &
rsf_ht
[
n
].
Œ“Ën
, &rsf_ht[n].
xËn
, &rsf_ht[n].
yËn
, &rsf_ht[n].
lšb™s
);

355 ià(
	`¡rcmp
(
commªd
,".end")==0)

356  
n
;

357 ià(
	`¡rcmp
(
commªd
,".table")!=0) {

358 #ifdeà
DEBUG


359 
	`årštf
(
¡d”r
,"huffmªabË %u d©¨cÜru±ed\n",
n
);

363 
rsf_ht
[
n
].
lšmax
 = (1<<rsf_ht[n].
lšb™s
)-1;

365 
	`ssÿnf
(
rsf_ht
[
n
].
bËÇme
,"%u",&
Â
);

366 ià(
Â
 !ğ
n
) {

367 #ifdeà
DEBUG


368 
	`årštf
(
¡d”r
,"wrÚgabË‚umb” %u\n",
n
);

373 
	`rsf_g‘lše
(
lše
,99,&
fi
);

374 } (
lše
[0] == '#') || (line[0] < ' '));

376 
	`ssÿnf
(
lše
,"% %u",
commªd
,&
t
);

377 ià(
	`¡rcmp
(
commªd
,".reference")==0) {

378 
rsf_ht
[
n
].
»f
 = 
t
;

379 
rsf_ht
[
n
].
v®
 =„sf_ht[
t
].val;

380 
rsf_ht
[
n
].
Œ“Ën
 =„sf_ht[
t
].treelen;

381 iàĞ(
rsf_ht
[
n
].
xËn
 !ğrsf_ht[
t
].xlen) ||

382 (
rsf_ht
[
n
].
yËn
 !ğrsf_ht[
t
].ylen) ) {

383 #ifdeà
DEBUG


384 
	`årštf
(
¡d”r
,"wrÚgabË %u„eã»nû\n",
n
);

388 (
lše
[0] == '#') || (line[0] < ' ') ) {

389 
	`rsf_g‘lše
(
lše
,99,&
fi
);

392 ià(
	`¡rcmp
(
commªd
,".treedata")==0) {

393 
rsf_ht
[
n
].
»f
 = -1;

394 
rsf_ht
[
n
].
v®
 = ((*)[2])

395 
Ãw
 [2*(
rsf_ht
[
n
].
Œ“Ën
)];

396 ià((
rsf_ht
[
n
].
v®
 =ğ
NULL
è&& („sf_ht[n].
Œ“Ën
 != 0 )){

397 #ifdeà
DEBUG


398 
	`årštf
(
¡d”r
, "h—³¼Ü‡ˆbË %d\n",
n
);

402 
i
=0;()i<
rsf_ht
[
n
].
Œ“Ën
; i++) {

403 
	`rsfsÿnf
(&
fi
, &
v0
);

404 
	`rsfsÿnf
(&
fi
, &
v1
);

406 
rsf_ht
[
n
].
v®
[
i
][0]=()
v0
;

407 
rsf_ht
[
n
].
v®
[
i
][1]=()
v1
;

409 
	`rsf_g‘lše
(
lše
,99,&
fi
);

412 #ifdeà
DEBUG


413 
	`årštf
(
¡d”r
,"huffmª decod”bËƒ¼Ü‡ˆbË %d\n",
n
);

417  
n
;

418 
	}
}

420 
	$š™Ÿlize_huffmª
() {

421 
BoŞ—n
 
huffmª_š™Ÿlized
 = 
F®£
;

423 ià(
huffmª_š™Ÿlized
) ;

425 ià(
	`»ad_decod”_bË
(
huffdec
è!ğ
HTN
) {

426 #ifdeà
DEBUG


427 
	`årštf
(
¡d”r
,"decoderable„eadƒrror\n");

431 
huffmª_š™Ÿlized
 = 
True
;

432 
	}
}

434 cÚ¡ 
	g¦’
[2][16] = {

439 cÚ¡ 
	g¡ab
[3][6][4] = {

448 
rsf_g‘_sÿË_çùÜs_1
(
MP3SideInfo
::
gr_šfo_s_t
 *
gr_šfo
) {

449 
numb™s
;

450 
	gnum0
 = 
¦’
[0][
gr_šfo
->
sÿËçc_com´ess
];

451 
	gnum1
 = 
¦’
[1][
gr_šfo
->
sÿËçc_com´ess
];

453 ià(
	ggr_šfo
->
	gblock_ty³
 == 2)

455 
numb™s
 = (
num0
 + 
num1
) * 18;

457 ià(
	ggr_šfo
->
	gmixed_block_æag
) {

458 
	gnumb™s
 -ğ
num0
;

463 
	gscfsi
 = 
gr_šfo
->
scfsi
;

465 if(
	gscfsi
 < 0) {

466 
	gnumb™s
 = (
num0
 + 
num1
) * 10 +‚um0;

469 
	gnumb™s
 = 0;

470 if(!(
	gscfsi
 & 0x8)) {

471 
	gnumb™s
 +ğ
num0
 * 6;

476 if(!(
	gscfsi
 & 0x4)) {

477 
	gnumb™s
 +ğ
num0
 * 5;

482 if(!(
	gscfsi
 & 0x2)) {

483 
	gnumb™s
 +ğ
num1
 * 5;

488 if(!(
	gscfsi
 & 0x1)) {

489 
	gnumb™s
 +ğ
num1
 * 5;

496  
	gnumb™s
;

499 
n_¦’2
[];

500 
i_¦’2
[];

502 
rsf_g‘_sÿË_çùÜs_2
(
MP3SideInfo
::
gr_šfo_s_t
 *
gr_šfo
) {

503 cÚ¡* 
²t
;

504 
	gi
;

505 
	g¦’
;

506 
	gn
 = 0;

507 
	gnumb™s
 = 0;

509 
	g¦’
 = 
n_¦’2
[
gr_šfo
->
sÿËçc_com´ess
];

511 
	ggr_šfo
->
	g´eæag
 = (
¦’
>>15) & 0x1;

513 
	gn
 = 0;

514 ifĞ
	ggr_šfo
->
	gblock_ty³
 == 2 ) {

515 
n
++;

516 if(
	ggr_šfo
->
	gmixed_block_æag
)

517 
	gn
++;

520 
	g²t
 = 
¡ab
[
n
][(
¦’
>>12)&0x7];

522 
	gi
=0;i<4;i++) {

523 
	gnum
 = 
¦’
 & 0x7;

524 
	g¦’
 >>= 3;

525 
	gnumb™s
 +ğ
²t
[
i
] * 
num
;

528  
	gnumb™s
;

531 
g‘SÿËFaùÜsL’gth
(
MP3SideInfo
::
gr_šfo_s_t
* 
gr
,

532 
BoŞ—n
 
isMPEG2
) {

533  
	gisMPEG2
 ? 
rsf_g‘_sÿË_çùÜs_2
(
gr
)

534 : 
rsf_g‘_sÿË_çùÜs_1
(
gr
);

537 
rsf_huffmª_decod”
(
B™VeùÜ
& 
bv
,

538 
huffcod‘ab
 cÚ¡* 
h
,

539 * 
x
, * 
y
, * 
v
, * 
w
);

541 
MP3HuffmªDecode
(
MP3SideInfo
::
gr_šfo_s_t
* 
gr
, 
BoŞ—n
 
isMPEG2
,

542 cÚ¡* 
äomBa£PŒ
,

543 
äomB™Off£t
, 
äomL’gth
,

544 & 
sÿËFaùÜsL’gth
,

545 
MP3HuffmªEncodšgInfo
& 
hei
) {

546 
	gi
;

547 
	gx
, 
	gy
, 
	gv
, 
	gw
;

548 
huffcod‘ab
 *
	gh
;

549 
B™VeùÜ
 
bv
((*)
äomBa£PŒ
, 
äomB™Off£t
, 
äomL’gth
);

552 
	gsÿËFaùÜsL’gth
 = 
g‘SÿËFaùÜsL’gth
(
gr
, 
isMPEG2
);

553 
	gbv
.
skB™s
(
sÿËFaùÜsL’gth
);

555 
š™Ÿlize_huffmª
();

557 
	ghei
.
	g»g1S¹
 = 
hei
.
»g2S¹
 = hei.
numSam¶es
 = 0;

560 ià(
	ggr
->
	gbig_v®ues
 < gr->
	g»giÚ1¡¬t
 + gr->
	g»giÚ2¡¬t
) {

561 
	ggr
->
	gbig_v®ues
 = 
gr
->
»giÚ1¡¬t
 + gr->
»giÚ2¡¬t
;

563 
	gi
 = 0; i < 
	ggr
->
	gbig_v®ues
; ++i) {

564 ià(
	gi
 < 
	ggr
->
	g»giÚ1¡¬t
) {

566 
	gh
 = &
rsf_ht
[
gr
->
bË_£Ëù
[0]];

567 } ià(
	gi
 < 
	ggr
->
	g»giÚ2¡¬t
) {

569 
	gh
 = &
rsf_ht
[
gr
->
bË_£Ëù
[1]];

570 ià(
	ghei
.
	g»g1S¹
 == 0) {

571 
hei
.
»g1S¹
 = 
bv
.
curB™Index
();

575 
	gh
 = &
rsf_ht
[
gr
->
bË_£Ëù
[2]];

576 ià(
	ghei
.
	g»g2S¹
 == 0) {

577 
hei
.
»g2S¹
 = 
bv
.
curB™Index
();

581 
	ghei
.
	g®lB™Off£ts
[
i
] = 
bv
.
curB™Index
();

582 
rsf_huffmª_decod”
(
bv
, 
h
, &
x
, &
y
, &
v
, &
w
);

583 ià(
	ghei
.
	gdecodedV®ues
 !ğ
NULL
) {

585 * 
±r
 = &
hei
.
decodedV®ues
[4*
i
];

586 
	g±r
[0] = 
x
;…Œ[1] = 
y
;…Œ[2] = 
v
;…Œ[3] = 
w
;

589 
	ghei
.
	gbigv®S¹
 = 
bv
.
curB™Index
();

592 
	gh
 = &
rsf_ht
[
gr
->
couÁ1bË_£Ëù
+32];

593 
	gbv
.
curB™Index
(è< bv.
tÙNumB™s
(è&& 
	gi
 < 
SSLIMIT
*
	gSBLIMIT
) {

594 
	ghei
.
	g®lB™Off£ts
[
i
] = 
bv
.
curB™Index
();

595 
rsf_huffmª_decod”
(
bv
, 
h
, &
x
, &
y
, &
v
, &
w
);

596 ià(
	ghei
.
	gdecodedV®ues
 !ğ
NULL
) {

598 * 
±r
 = &
hei
.
decodedV®ues
[4*
i
];

599 
	g±r
[0] = 
x
;…Œ[1] = 
y
;…Œ[2] = 
v
;…Œ[3] = 
w
;

601 ++
	gi
;

604 
	ghei
.
	g®lB™Off£ts
[
i
] = 
bv
.
curB™Index
();

605 
	ghei
.
	gnumSam¶es
 = 
i
;

608 
HUFFBITS
 
	gdmask
 = 1 << (
SIZEOF_HUFFBITS
*8-1);

609 
	ghs
 = 
SIZEOF_HUFFBITS
*8;

612 
	$rsf_huffmª_decod”
(
B™VeùÜ
& 
bv
,

613 
huffcod‘ab
 cÚ¡* 
h
,

614  *
x
,

615  *
y
,

616 * 
v
, * 
w
) {

617 
HUFFBITS
 
Ëv–
;

618 
pošt
 = 0;

619 
”rÜ
 = 1;

620 
Ëv–
 = 
dmask
;

621 *
x
 = *
y
 = *
v
 = *
w
 = 0;

622 ià(
h
->
v®
 =ğ
NULL
)  2;

625 ià(
h
->
Œ“Ën
 == 0)  0;

630 ià(
h
->
v®
[
pošt
][0]==0) {

631 *
x
 = 
h
->
v®
[
pošt
][1] >> 4;

632 *
y
 = 
h
->
v®
[
pošt
][1] & 0xf;

634 
”rÜ
 = 0;

637 ià(
bv
.
	`g‘1B™
()) {

638 
h
->
v®
[
pošt
][1] >ğ
MXOFF
)…oint += h->val[point][1];

639 
pošt
 +ğ
h
->
v®
[point][1];

642 
h
->
v®
[
pošt
][0] >ğ
MXOFF
)…oint += h->val[point][0];

643 
pošt
 +ğ
h
->
v®
[point][0];

645 
Ëv–
 >>= 1;

646 } 
Ëv–
 || (
pošt
 < 
h
->
Œ“Ën
) );

651 ià(
”rÜ
) {

652 
	`´štf
("Illegal Huffman code in data.\n");

653 *
x
 = ((
h
->
xËn
-1) << 1);

654 *
y
 = ((
h
->
yËn
-1) << 1);

659 ià(
h
->
bËÇme
[0] == '3'

660 && (
h
->
bËÇme
[1] == '2' || h->tablename[1] == '3')) {

661 *
v
 = (*
y
>>3) & 1;

662 *
w
 = (*
y
>>2) & 1;

663 *
x
 = (*
y
>>1) & 1;

664 *
y
 = *y & 1;

666 ià(*
v
)

667 ià(
bv
.
	`g‘1B™
(è=ğ1è*
v
 = -*v;

668 ià(*
w
)

669 ià(
bv
.
	`g‘1B™
(è=ğ1è*
w
 = -*w;

670 ià(*
x
)

671 ià(
bv
.
	`g‘1B™
(è=ğ1è*
x
 = -*x;

672 ià(*
y
)

673 ià(
bv
.
	`g‘1B™
(è=ğ1è*
y
 = -*y;

679 ià(
h
->
lšb™s
)

680 ià((
h
->
xËn
-1è=ğ()*
x
)

681 *
x
 +ğ
bv
.
	`g‘B™s
(
h
->
lšb™s
);

682 ià(*
x
)

683 ià(
bv
.
	`g‘1B™
(è=ğ1è*
x
 = -*x;

684 ià(
h
->
lšb™s
)

685 ià((
h
->
yËn
-1è=ğ()*
y
)

686 *
y
 +ğ
bv
.
	`g‘B™s
(
h
->
lšb™s
);

687 ià(*
y
)

688 ià(
bv
.
	`g‘1B™
(è=ğ1è*
y
 = -*y;

691  
”rÜ
;

692 
	}
}

694 #ifdeà
DO_HUFFMAN_ENCODING


695 
šlše
 
	$g‘NextSam¶e
(cÚ¡*& 
äomPŒ
) {

696 
§m¶e


697 #ifdeà
FOUR_BYTE_SAMPLES


698 ğ(
äomPŒ
[0]<<24) | (fromPtr[1]<<16) | (fromPtr[2]<<8) | fromPtr[3];

700 #ifdeà
TWO_BYTE_SAMPLES


701 ğ(
äomPŒ
[0]<<8) | fromPtr[1];

704 ğ
äomPŒ
[0];

707 
äomPŒ
 +ğ
BYTES_PER_SAMPLE_VALUE
;

708  
§m¶e
;

709 
	}
}

711 
rsf_huffmª_’cod”
(
B™VeùÜ
& 
bv
,

712 
huffcod‘ab
* 
h
,

713 
x
, 
y
, 
v
, 
w
);

715 
MP3HuffmªEncode
(
MP3SideInfo
::
gr_šfo_s_t
 cÚ¡* 
gr
,

716 cÚ¡* 
äomPŒ
,

717 * 
toPŒ
, 
toB™Off£t
,

718 
numHuffB™s
) {

719 
	gi
;

720 
huffcod‘ab
 *
	gh
;

721 
	gx
, 
	gy
, 
	gv
, 
	gw
;

722 
B™VeùÜ
 
bv
(
toPŒ
, 
toB™Off£t
, 
numHuffB™s
);

724 
š™Ÿlize_huffmª
();

727 
	gbig_v®ues
 = 
gr
->
big_v®ues
;

728 ià(
	gbig_v®ues
 < 
	ggr
->
	g»giÚ1¡¬t
 + gr->
	g»giÚ2¡¬t
) {

729 
	gbig_v®ues
 = 
gr
->
»giÚ1¡¬t
 + gr->
»giÚ2¡¬t
;

731 
	gi
 = 0; i < 
	gbig_v®ues
; ++i) {

732 ià(
	gi
 < 
	ggr
->
	g»giÚ1¡¬t
) {

734 
	gh
 = &
rsf_ht
[
gr
->
bË_£Ëù
[0]];

735 } ià(
	gi
 < 
	ggr
->
	g»giÚ2¡¬t
) {

737 
	gh
 = &
rsf_ht
[
gr
->
bË_£Ëù
[1]];

740 
	gh
 = &
rsf_ht
[
gr
->
bË_£Ëù
[2]];

743 
	gx
 = 
g‘NextSam¶e
(
äomPŒ
);

744 
	gy
 = 
g‘NextSam¶e
(
äomPŒ
);

745 
	gv
 = 
g‘NextSam¶e
(
äomPŒ
);

746 
	gw
 = 
g‘NextSam¶e
(
äomPŒ
);

747 
rsf_huffmª_’cod”
(
bv
, 
h
, 
x
, 
y
, 
v
, 
w
);

751 
	gh
 = &
rsf_ht
[
gr
->
couÁ1bË_£Ëù
+32];

752 
	gbv
.
curB™Index
(è< bv.
tÙNumB™s
(è&& 
	gi
 < 
SSLIMIT
*
	gSBLIMIT
) {

753 
	gx
 = 
g‘NextSam¶e
(
äomPŒ
);

754 
	gy
 = 
g‘NextSam¶e
(
äomPŒ
);

755 
	gv
 = 
g‘NextSam¶e
(
äomPŒ
);

756 
	gw
 = 
g‘NextSam¶e
(
äomPŒ
);

757 
rsf_huffmª_’cod”
(
bv
, 
h
, 
x
, 
y
, 
v
, 
w
);

758 ++
	gi
;

761  
	gi
;

764 
BoŞ—n
 
	$lookupHuffmªTabËEÁry
(
huffcod‘ab
 cÚ¡* 
h
,

765 
HUFFBITS
 
b™s
, 
b™sL’gth
,

766 & 
xy
) {

767 
pošt
 = 0;

768 
mask
 = 1;

769 
numB™sTe¡edSoF¬
 = 0;

771 ià(
h
->
v®
[
pošt
][0]==0) {

772 
xy
 = 
h
->
v®
[
pošt
][1];

773 ià(
h
->
hËn
[
xy
] == 0) {

774 
h
->
bË
[
xy
] = 
b™s
;

775 
h
->
hËn
[
xy
] = 
b™sL’gth
;

776  
True
;

778  
F®£
;

782 ià(
numB™sTe¡edSoF¬
++ =ğ
b™sL’gth
) {

784  
F®£
;

786 ià(
b™s
&
mask
) {

787 
h
->
v®
[
pošt
][1] >ğ
MXOFF
)…oint += h->val[point][1];

788 
pošt
 +ğ
h
->
v®
[point][1];

790 
h
->
v®
[
pošt
][0] >ğ
MXOFF
)…oint += h->val[point][0];

791 
pošt
 +ğ
h
->
v®
[point][0];

793 
mask
 <<= 1;

794 } 
mask
 || (
pošt
 < 
h
->
Œ“Ën
));

796  
F®£
;

797 
	}
}

799 
	$budHuffmªEncodšgTabË
(
huffcod‘ab
* 
h
) {

800 
h
->
bË
 = 
Ãw
 [256];

801 
h
->
hËn
 = 
Ãw
 [256];

802 ià(
h
->
bË
 =ğ
NULL
 || h->
hËn
 == NULL) { h->table = NULL; ; }

803 
i
 = 0; i < 256; ++i) {

804 
h
->
bË
[
i
] = 0; h->
hËn
[i] = 0;

808 
maxNumEÁr›s
 = 
h
->
xËn
 * h->
yËn
;

809 
numEÁr›s
 = 0;

810 
pow”Of2
 = 1;

811 
b™sL’gth
 = 1;

812 
b™sL’gth
 <ğ8*
SIZEOF_HUFFBITS
; ++bitsLength) {

813 
pow”Of2
 *= 2;

814 
HUFFBITS
 
b™s
 = 0; b™ < 
pow”Of2
; ++bits) {

816 
xy
;

817 ià(
	`lookupHuffmªTabËEÁry
(
h
, 
b™s
, 
b™sL’gth
, 
xy
)) {

818 ++
numEÁr›s
;

819 ià(
numEÁr›s
 =ğ
maxNumEÁr›s
) ;

823 #ifdeà
DEBUG


824 
	`årštf
(
¡d”r
, "Didn't findƒnoughƒntries!\n");

826 
	}
}

828 
	$lookupXYªdPutB™s
(
B™VeùÜ
& 
bv
, 
huffcod‘ab
 cÚ¡* 
h
,

829 
xy
) {

830 
HUFFBITS
 
b™s
 = 
h
->
bË
[
xy
];

831 
b™sL’gth
 = 
h
->
hËn
[
xy
];

834 
b™sL’gth
-- > 0) {

835 
bv
.
	`put1B™
(
b™s
&0x00000001);

836 
b™s
 >>= 1;

838 
	}
}

840 
	$putLšb™s
(
B™VeùÜ
& 
bv
, 
huffcod‘ab
 cÚ¡* 
h
,

841 
HUFFBITS
 
b™s
) {

842 
bv
.
	`putB™s
(
b™s
, 
h
->
lšb™s
);

843 
	}
}

845 
	$rsf_huffmª_’cod”
(
B™VeùÜ
& 
bv
,

846 
huffcod‘ab
* 
h
,

847 
x
, 
y
, 
v
, 
w
) {

848 ià(
h
->
v®
 =ğ
NULL
) ;

851 ià(
h
->
Œ“Ën
 == 0) ;

853 ià(
h
->
bË
 =ğ
NULL
) {

855 
	`budHuffmªEncodšgTabË
(
h
);

856 ià(
h
->
bË
 =ğ
NULL
) ;

859 
BoŞ—n
 
xIsNeg
 = 
F®£
, 
yIsNeg
 = F®£, 
vIsNeg
 = F®£, 
wIsNeg
 = False;

860 
xy
;

862 #ifdeà
FOUR_BYTE_SAMPLES


864 #ifdeà
TWO_BYTE_SAMPLES


866 ià(
x
&0x8000) x |= 0xFFFF0000;

867 ià(
y
&0x8000) y |= 0xFFFF0000;

868 ià(
v
&0x8000) v |= 0xFFFF0000;

869 ià(
w
&0x8000) w |= 0xFFFF0000;

873 ià(
x
&0x80) x |= 0xFFFFFF00;

874 ià(
y
&0x80) y |= 0xFFFFFF00;

875 ià(
v
&0x80) v |= 0xFFFFFF00;

876 ià(
w
&0x80) w |= 0xFFFFFF00;

880 ià(
h
->
bËÇme
[0] == '3'

881 && (
h
->
bËÇme
[1] == '2' || h->tablename[1] == '3')) {

882 ià(
x
 < 0è{ 
xIsNeg
 = 
True
; x = -x; }

883 ià(
y
 < 0è{ 
yIsNeg
 = 
True
; y = -y; }

884 ià(
v
 < 0è{ 
vIsNeg
 = 
True
; v = -v; }

885 ià(
w
 < 0è{ 
wIsNeg
 = 
True
; w = -w; }

888 ià(
x
>1 || 
y
>1 || 
v
>1 || 
w
>1) {

889 #ifdeà
DEBUG


890 
	`årštf
(
¡d”r
, "rsf_huffmª_’cod” quad sª™y check fas: %x,%x,%x,%x\n", 
x
, 
y
, 
v
, 
w
);

894 
xy
 = (
v
<<3)|(
w
<<2)|(
x
<<1)|
y
;

895 
	`lookupXYªdPutB™s
(
bv
, 
h
, 
xy
);

897 ià(
v
è
bv
.
	`put1B™
(
vIsNeg
);

898 ià(
w
è
bv
.
	`put1B™
(
wIsNeg
);

899 ià(
x
è
bv
.
	`put1B™
(
xIsNeg
);

900 ià(
y
è
bv
.
	`put1B™
(
yIsNeg
);

903 ià(
v
 !ğ0 || 
w
 != 0) {

904 #ifdeà
DEBUG


905 
	`årštf
(
¡d”r
, "rsf_huffmª_’cod” du® sª™y check 1 fas: %x,%x,%x,%x\n", 
x
, 
y
, 
v
, 
w
);

909 ià(
x
 < 0è{ 
xIsNeg
 = 
True
; x = -x; }

910 ià(
y
 < 0è{ 
yIsNeg
 = 
True
; y = -y; }

913 ià(
x
 > 255 || 
y
 > 255) {

914 #ifdeà
DEBUG


915 
	`årštf
(
¡d”r
, "rsf_huffmª_’cod” du® sª™y check 2 fas: %x,%x,%x,%x\n", 
x
, 
y
, 
v
, 
w
);

919 
xl1
 = 
h
->
xËn
-1;

920 
yl1
 = 
h
->
yËn
-1;

921 
lšb™sX
 = 0; 
lšb™sY
 = 0;

923 ià(((
x
 < 
xl1
è|| (xl1 =ğ0)è&& (
y
 < 
yl1
)) {

925 
xy
 = (
x
<<4)|
y
;

926 
	`lookupXYªdPutB™s
(
bv
, 
h
, 
xy
);

927 ià(
x
è
bv
.
	`put1B™
(
xIsNeg
);

928 ià(
y
è
bv
.
	`put1B™
(
yIsNeg
);

929 } ià(
x
 >ğ
xl1
) {

930 
lšb™sX
 = ()(
x
 - 
xl1
);

931 ià(
lšb™sX
 > 
h
->
lšmax
) {

932 #ifdeà
DEBUG


933 
	`årštf
(
¡d”r
,"warning: Huffman Xable overflow\n");

935 
lšb™sX
 = 
h
->
lšmax
;

938 ià(
y
 >ğ
yl1
) {

939 
xy
 = (
xl1
<<4)|
yl1
;

940 
	`lookupXYªdPutB™s
(
bv
, 
h
, 
xy
);

941 
lšb™sY
 = ()(
y
 - 
yl1
);

942 ià(
lšb™sY
 > 
h
->
lšmax
) {

943 #ifdeà
DEBUG


944 
	`årštf
(
¡d”r
,"warning: Huffman Yable overflow\n");

946 
lšb™sY
 = 
h
->
lšmax
;

949 ià(
h
->
lšb™s
è
	`putLšb™s
(
bv
, h, 
lšb™sX
);

950 ià(
x
è
bv
.
	`put1B™
(
xIsNeg
);

951 ià(
h
->
lšb™s
è
	`putLšb™s
(
bv
, h, 
lšb™sY
);

952 ià(
y
è
bv
.
	`put1B™
(
yIsNeg
);

954 
xy
 = (
xl1
<<4)|
y
;

955 
	`lookupXYªdPutB™s
(
bv
, 
h
, 
xy
);

956 ià(
h
->
lšb™s
è
	`putLšb™s
(
bv
, h, 
lšb™sX
);

957 ià(
x
è
bv
.
	`put1B™
(
xIsNeg
);

958 ià(
y
è
bv
.
	`put1B™
(
yIsNeg
);

961 
xy
 = (
x
<<4)|
yl1
;

962 
	`lookupXYªdPutB™s
(
bv
, 
h
, 
xy
);

963 
lšb™sY
 = 
y
-
yl1
;

964 ià(
lšb™sY
 > 
h
->
lšmax
) {

965 #ifdeà
DEBUG


966 
	`årštf
(
¡d”r
,"warning: Huffman Yable overflow\n");

968 
lšb™sY
 = 
h
->
lšmax
;

970 ià(
x
è
bv
.
	`put1B™
(
xIsNeg
);

971 ià(
h
->
lšb™s
è
	`putLšb™s
(
bv
, h, 
lšb™sY
);

972 ià(
y
è
bv
.
	`put1B™
(
yIsNeg
);

975 
	}
}

	@liveMedia/MP3InternalsHuffmanTable.cpp

21 
	~"MP3IÁ”ÇlsHuffmª.hh
"

23 
	ghuffdec
[] = {

	@liveMedia/MP3StreamState.cpp

21 
	~"MP3SŒ—mS‹.hh
"

22 
	~"IÅutFe.hh
"

23 
	~"GroupsockH–³r.hh
"

25 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

26 
	#¢´štf
 
_¢´štf


	)

27 #ià
_MSC_VER
 >= 1400

28 
	#f’o
 
_f’o


	)

32 
	#MILLION
 1000000

	)

34 
	gMP3SŒ—mS‹
::
	$MP3SŒ—mS‹
(
U§geEnvœÚm’t
& 
’v
)

35 : 
	`fEnv
(
’v
), 
	`fFid
(
NULL
), 
	$fP»£Á©iÚTimeSÿË
(1) {

36 
	}
}

38 
	gMP3SŒ—mS‹
::~
	$MP3SŒ—mS‹
() {

40 ià(
fFid
 !ğ
NULL
 && fFid !ğ
¡dš
) {

41 ià(
fFidIsR—ÎyASock‘
) {

42 
šŒ_t
 
fid_lÚg
 = (šŒ_t)
fFid
;

43 
	`şo£Sock‘
(()
fid_lÚg
);

45 
	`Clo£IÅutFe
(
fFid
);

48 
	}
}

50 
	gMP3SŒ—mS‹
::
	$assignSŒ—m
(
FILE
* 
fid
, 
feSize
) {

51 
fFid
 = 
fid
;

53 ià(
feSize
 == ()(-1)) {

54 
fFidIsR—ÎyASock‘
 = 1;

55 
fFeSize
 = 0;

57 
fFidIsR—ÎyASock‘
 = 0;

58 
fFeSize
 = 
feSize
;

60 
fNumF¿mesInFe
 = 0;

61 
fIsVBR
 = 
fHasXšgTOC
 = 
F®£
;

64 
	`g‘timeofday
(&
fNextF¿meP»£Á©iÚTime
, 
NULL
);

65 
	}
}

67 
timev®
 
	gMP3SŒ—mS‹
::
	$cu¼’tF¿mePÏyTime
() const {

68 cÚ¡ 
numSam¶es
 = 1152;

69 cÚ¡ 
äeq
 = 
	`ä
().
§m¶šgF»q
*(1 + fr().
isMPEG2
);

72 cÚ¡ 
uSecÚds


73 ğ((
numSam¶es
*2*
MILLION
)/
äeq
 + 1)/2;

75 
timev®
 
»suÉ
;

76 
»suÉ
.
tv_£c
 = 
uSecÚds
/
MILLION
;

77 
»suÉ
.
tv_u£c
 = 
uSecÚds
%
MILLION
;

78  
»suÉ
;

79 
	}
}

81 
	gMP3SŒ—mS‹
::
	$fePÏyTime
() const {

82 
numF¿mesInFe
 = 
fNumF¿mesInFe
;

83 ià(
numF¿mesInFe
 == 0) {

86 
numF¿mesInFe
 = 
fFeSize
/(4 + 
fCu¼’tF¿me
.
äameSize
);

89 
timev®
 cÚ¡ 
±
 = 
	`cu¼’tF¿mePÏyTime
();

90  
numF¿mesInFe
*(
±
.
tv_£c
 +…t.
tv_u£c
/()
MILLION
);

91 
	}
}

93 
	gMP3SŒ—mS‹
::
	$g‘By‹Numb”FromPos™iÚF¿ùiÚ
(
äaùiÚ
) {

94 ià(
fHasXšgTOC
) {

96 
³rûÁ
 = 
äaùiÚ
*100.0f;

97 
a
 = ()
³rûÁ
;

98 ià(
a
 > 99)‡ = 99;

100 
ç
 = 
fXšgTOC
[
a
];

101 
fb
;

102 ià(
a
 < 99) {

103 
fb
 = 
fXšgTOC
[
a
+1];

105 
fb
 = 256;

107 
äaùiÚ
 = (
ç
 + (
fb
-ç)*(
³rûÁ
-
a
))/256.0f;

110  ()(
äaùiÚ
*
fFeSize
);

111 
	}
}

113 
	gMP3SŒ—mS‹
::
	$£ekW™hšFe
(
£ekBy‹Numb”
) {

114 ià(
fFidIsR—ÎyASock‘
) ;

116 
	`S“kFe64
(
fFid
, 
£ekBy‹Numb”
, 
SEEK_SET
);

117 
	}
}

119 
	gMP3SŒ—mS‹
::
	$fšdNextH—d”
(
timev®
& 
´e£Á©iÚTime
) {

120 
´e£Á©iÚTime
 = 
fNextF¿meP»£Á©iÚTime
;

122 ià(!
	`fšdNextF¿me
())  0;

125 
timev®
 
äamePÏyTime
 = 
	`cu¼’tF¿mePÏyTime
();

126 ià(
fP»£Á©iÚTimeSÿË
 > 1) {

128 
£cÚdsRem
 = 
äamePÏyTime
.
tv_£c
 % 
fP»£Á©iÚTimeSÿË
;

129 
äamePÏyTime
.
tv_£c
 -ğ
£cÚdsRem
;

130 
äamePÏyTime
.
tv_u£c
 +ğ
£cÚdsRem
*
MILLION
;

131 
äamePÏyTime
.
tv_£c
 /ğ
fP»£Á©iÚTimeSÿË
;

132 
äamePÏyTime
.
tv_u£c
 /ğ
fP»£Á©iÚTimeSÿË
;

134 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 +ğ
äamePÏyTime
.tv_usec;

135 
fNextF¿meP»£Á©iÚTime
.
tv_£c


136 +ğ
äamePÏyTime
.
tv_£c
 + 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
/
MILLION
;

137 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 %ğ
MILLION
;

139  
	`ä
().
hdr
;

140 
	}
}

142 
BoŞ—n
 
	gMP3SŒ—mS‹
::
	$»adF¿me
(* 
outBuf
, 
outBufSize
,

143 & 
»suÉF¿meSize
,

144 & 
»suÉDu¿tiÚInMiüo£cÚds
) {

147 
»suÉF¿meSize
 = 4 + 
	`ä
().
äameSize
;

149 ià(
outBufSize
 < 
»suÉF¿meSize
) {

150 #ifdeà
DEBUG_ERRORS


151 
	`årštf
(
¡d”r
, "Insufficient buffer size for„eading input frame (%d,‚eed %d)\n",

152 
outBufSize
, 
»suÉF¿meSize
);

154 ià(
outBufSize
 < 4) outBufSize = 0;

155 
»suÉF¿meSize
 = 
outBufSize
;

157  
F®£
;

160 ià(
»suÉF¿meSize
 >= 4) {

161 & 
hdr
 = 
	`ä
().hdr;

162 *
outBuf
++ = ()(
hdr
>>24);

163 *
outBuf
++ = ()(
hdr
>>16);

164 *
outBuf
++ = ()(
hdr
>>8);

165 *
outBuf
++ = ()(
hdr
);

167 
	`memmove
(
outBuf
, 
	`ä
().
äameBy‹s
, 
»suÉF¿meSize
-4);

170 
timev®
 cÚ¡ 
±
 = 
	`cu¼’tF¿mePÏyTime
();

171 
»suÉDu¿tiÚInMiüo£cÚds
 = 
±
.
tv_£c
*
MILLION
 +…t.
tv_u£c
;

173  
True
;

174 
	}
}

176 
	gMP3SŒ—mS‹
::
	$g‘A‰ribu‹s
(* 
bufãr
, 
bufãrSize
) const {

177 cÚ¡* 
fÜm©SŒ


179 
åt
 = ()(
	`fePÏyTime
() + 0.5);

180 #ià
	`defšed
(
IRIX
è|| defšed(
ALPHA
è|| defšed(
_QNX4
è|| defšed(
IMN_PIM
è|| defšed(
CRIS
)

182 
	`¥rštf
(
bufãr
, 
fÜm©SŒ
,

183 
	`ä
().
b™¿‹
, fr().
isMPEG2
 ? 2 : 1, fr().
Ïy”
, fr().
§m¶šgF»q
, fr().
isS‹»o
,

184 
åt
, 
fIsVBR
);

186 
	`¢´štf
(
bufãr
, 
bufãrSize
, 
fÜm©SŒ
,

187 
	`ä
().
b™¿‹
, fr().
isMPEG2
 ? 2 : 1, fr().
Ïy”
, fr().
§m¶šgF»q
, fr().
isS‹»o
,

188 
åt
, 
fIsVBR
);

190 
	}
}

193 
	#HDRCMPMASK
 0xfffffd00

	)

195 
BoŞ—n
 
	gMP3SŒ—mS‹
::
	$fšdNextF¿me
() {

196 
hbuf
[8];

197 
l
; 
i
;

198 
©‹m±
 = 0;

200 
»ad_agaš
:

201 ià(
	`»adFromSŒ—m
(
hbuf
, 4è!ğ4è 
F®£
;

203 
	`ä
().
hdr
 = ((è
hbuf
[0] << 24)

204 | ((è
hbuf
[1] << 16)

205 | ((è
hbuf
[2] << 8)

206 | (è
hbuf
[3];

208 #ifdeà
DEBUG_PARSE


209 
	`årštf
(
¡d”r
, "ä().hdr: 0x%08x\n", 
	`ä
().
hdr
);

211 ià(
	`ä
().
ŞdHdr
 !ğä().
hdr
 || !fr().oldHdr) {

212 
i
 = 0;

213 
š™_»sync
:

214 #ifdeà
DEBUG_PARSE


215 
	`årštf
(
¡d”r
, "š™_»sync: fr().hdr: 0x%08x\n", 
	`ä
().
hdr
);

217 iàĞ(
	`ä
().
hdr
 & 0xffe00000) != 0xffe00000

218 || (
	`ä
().
hdr
 & 0x00060000) == 0

219 || (
	`ä
().
hdr
 & 0x0000F000) == 0

220 || (
	`ä
().
hdr
 & 0x0000F000) == 0x0000F000

221 || (
	`ä
().
hdr
 & 0x00000C00) == 0x00000C00

222 || (
	`ä
().
hdr
 & 0x00000003) != 0x00000000

229 ià(
	`ä
().
hdr
 == ('R'<<24)+('I'<<16)+('F'<<8)+'F') {

230 
buf
[70 ];

231 #ifdeà
DEBUG_ERRORS


232 
	`årštf
(
¡d”r
,"Skipped RIFF header\n");

234 
	`»adFromSŒ—m
(
buf
, 66);

235 
»ad_agaš
;

238 ià((
	`ä
().
hdr
&0xFFFFFF00) == ('I'<<24)+('D'<<16)+('3'<<8)) {

239 
gSize
, 
by‹sToSk
;

240 
buf
[1000];

241 
	`»adFromSŒ—m
(
buf
, 6);

242 
gSize
 = ((
buf
[2]&0x7F)<<21) + ((buf[3]&0x7F)<<14) + ((buf[4]&0x7F)<<7) + (buf[5]&0x7F);

243 
by‹sToSk
 = 
gSize
;

244 
by‹sToSk
 > 0) {

245 
by‹sToR—d
 =  
buf
;

246 ià(
by‹sToR—d
 > 
by‹sToSk
) {

247 
by‹sToR—d
 = 
by‹sToSk
;

249 
	`»adFromSŒ—m
(
buf
, 
by‹sToR—d
);

250 
by‹sToSk
 -ğ
by‹sToR—d
;

252 #ifdeà
DEBUG_ERRORS


253 
	`årštf
(
¡d”r
,"Sk³d %d-by‹ ID3 h—d”\n", 
gSize
);

255 
»ad_agaš
;

258 ià(
i
++ < 20000 ) {

259 
	`memmove
 (&
hbuf
[0], &hbuf[1], 3);

260 ià(
	`»adFromSŒ—m
(
hbuf
+3,1) != 1) {

261  
F®£
;

263 
	`ä
().
hdr
 <<= 8;

264 
	`ä
().
hdr
 |ğ
hbuf
[3];

265 
	`ä
().
hdr
 &= 0xffffffff;

266 #ifdeà
DEBUG_PARSE


267 
	`årštf
(
¡d”r
, "ÿÎšg in™_»synø%d\n", 
i
);

269 
š™_»sync
;

271 #ifdeà
DEBUG_ERRORS


272 
	`årštf
(
¡d”r
,"Giving up searching valid MPEG header\n");

274  
F®£
;

276 #ifdeà
DEBUG_ERRORS


277 
	`årštf
(
¡d”r
,"Illegal Audio-MPEG-Header 0x%08lx‡t offset 0x%lx.\n",

278 
	`ä
().
hdr
,
	`‹Î_¡»am
(
¡r
)-4);

286 
©‹m±
++;

287 
	`memmove
 (&
hbuf
[0], &hbuf[1], 7);

288 ià(
	`»adFromSŒ—m
(&
hbuf
[3],1) != 1) {

289  
F®£
;

293 
	`ä
().
hdr
 = ((ä().hd¸<< 8è| 
hbuf
[3]) & 0xffffffff;

295 ià(!
	`ä
().
ŞdHdr
)

296 
š™_»sync
;

298 } (
	`ä
().
hdr
 & 
HDRCMPMASK
è!ğ(ä().
ŞdHdr
 & HDRCMPMASK)

299 && (
	`ä
().
hdr
 & 
HDRCMPMASK
è!ğ(ä().
fœ¡Hdr
 & HDRCMPMASK));

300 #ifdeà
DEBUG_ERRORS


301 
	`årštf
 (
¡d”r
, "Sk³d %d by‹ š iÅut.\n", 
©‹m±
);

304 ià(!
	`ä
().
fœ¡Hdr
) {

305 
	`ä
().
fœ¡Hdr
 = fr().
hdr
;

308 
	`ä
().
	`£tP¬amsFromH—d”
();

309 
	`ä
().
	`£tBy‹Poš‹r
(ä().
äameBy‹s
, fr().
äameSize
);

311 
	`ä
().
ŞdHdr
 = fr().
hdr
;

313 ià(
	`ä
().
isF»eFÜm©
) {

314 #ifdeà
DEBUG_ERRORS


315 
	`årštf
(
¡d”r
,"Free format‚ot supported.\n");

317  
F®£
;

320 #ifdeà
MP3_ONLY


321 ià(
	`ä
().
Ïy”
 != 3) {

322 #ifdeà
DEBUG_ERRORS


323 
	`årštf
(
¡d”r
, "MPEG†ay” %d i nÙ suµÜ‹d!\n", 
	`ä
().
Ïy”
);

325  
F®£
;

330 ià((
l
 = 
	`»adFromSŒ—m
(
	`ä
().
äameBy‹s
, fr().
äameSize
))

331 !ğ
	`ä
().
äameSize
) {

332 ià(
l
 =ğ0è 
F®£
;

333 
	`mem£t
(
	`ä
().
äameBy‹s
+1, 0, fr().
äameSize
-1);

336  
True
;

337 
	}
}

339 
BoŞ—n
 
	$sock‘IsR—dabË
(
sock‘
) {

340 cÚ¡ 
numFds
 = 
sock‘
+1;

341 
fd_£t
 
rd_£t
;

342 
	`FD_ZERO
(&
rd_£t
);

343 
	`FD_SET
(()
sock‘
, &
rd_£t
);

344 
timev®
 
timeout
;

345 
timeout
.
tv_£c
 =imeout.
tv_u£c
 = 0;

347 
»suÉ
 = 
	`£Ëù
(
numFds
, &
rd_£t
, 
NULL
, NULL, &
timeout
);

348  
»suÉ
 != 0;

349 
	}
}

351 
	gw©chV¬ŸbË
;

353 
	$checkFunc
(* ) {

354 
w©chV¬ŸbË
 = ~0;

355 
	}
}

357 
	$wa™UÁSock‘IsR—dabË
(
U§geEnvœÚm’t
& 
’v
, 
sock‘
) {

358 !
	`sock‘IsR—dabË
(
sock‘
)) {

360 
u£csToD–ay
 = 1000;

361 
’v
.
	`skScheduËr
().
	`scheduËD–ayedTask
(
u£csToD–ay
,

362 (
TaskFunc
*)
checkFunc
, (*)
NULL
);

363 
w©chV¬ŸbË
 = 0;

364 
’v
.
	`skScheduËr
().
	`doEv’tLoİ
(&
w©chV¬ŸbË
);

367 
	}
}

369 
	gMP3SŒ—mS‹
::
	$»adFromSŒ—m
(* 
buf
,

370 
numCh¬s
) {

372 ià(
fFidIsR—ÎyASock‘
) {

373 
šŒ_t
 
fid_lÚg
 = (šŒ_t)
fFid
;

374 
sock
 = ()
fid_lÚg
;

375 
tÙBy‹sR—d
 = 0;

377 
	`wa™UÁSock‘IsR—dabË
(
fEnv
, 
sock
);

378 
by‹sR—d


379 ğ
	`»cv
(
sock
, &((*)
buf
)[
tÙBy‹sR—d
], 
numCh¬s
-totBytesRead, 0);

380 ià(
by‹sR—d
 < 0)  0;

382 
tÙBy‹sR—d
 +ğ()
by‹sR—d
;

383 } 
tÙBy‹sR—d
 < 
numCh¬s
);

385  
tÙBy‹sR—d
;

387 #iâdeà
_WIN32_WCE


388 
	`wa™UÁSock‘IsR—dabË
(
fEnv
, ()
	`f’o
(
fFid
));

390  
	`ä—d
(
buf
, 1, 
numCh¬s
, 
fFid
);

392 
	}
}

394 
	#XING_FRAMES_FLAG
 0x0001

	)

395 
	#XING_BYTES_FLAG
 0x0002

	)

396 
	#XING_TOC_FLAG
 0x0004

	)

397 
	#XING_VBR_SCALE_FLAG
 0x0008

	)

399 
	gMP3SŒ—mS‹
::
	$checkFÜXšgH—d”
() {

401 ià(
	`ä
().
äameSize
 < fr().
sideInfoSize
) ;

402 
by‹sAvaabË
 = 
	`ä
().
äameSize
 - fr().
sideInfoSize
;

403 * 
p
 = &(
	`ä
().
äameBy‹s
[ä().
sideInfoSize
]);

405 ià(
by‹sAvaabË
 < 8) ;

406 ià(
p
[0] != 'X' ||…[1] != 'i' ||…[2] != 'n' ||…[3] != 'g') ;

409 
fIsVBR
 = 
True
;

411 
u_št32_t
 
æags
 = (
p
[4]<<24) | (p[5]<<16) | (p[6]<<8) |…[7];

412 
i
 = 8;

413 
by‹sAvaabË
 -= 8;

415 ià(
æags
&
XING_FRAMES_FLAG
) {

417 ià(
by‹sAvaabË
 < 4) ;

418 
fNumF¿mesInFe
 = (
p
[
i
]<<24)|(p[i+1]<<16)|(p[i+2]<<8)|(p[i+3]);

419 
i
 +ğ4; 
by‹sAvaabË
 -= 4;

422 ià(
æags
&
XING_BYTES_FLAG
) {

424 ià(
by‹sAvaabË
 < 4) ;

425 
fFeSize
 = (
p
[
i
]<<24)|(p[i+1]<<16)|(p[i+2]<<8)|(p[i+3]);

426 
i
 +ğ4; 
by‹sAvaabË
 -= 4;

429 ià(
æags
&
XING_TOC_FLAG
) {

431 ià(
by‹sAvaabË
 < 
XING_TOC_LENGTH
) ;

432 
fHasXšgTOC
 = 
True
;

433 
j
 = 0; j < 
XING_TOC_LENGTH
; ++j) {

434 
fXšgTOC
[
j
] = 
p
[
i
+j];

436 
i
 +ğ
XING_TOC_FLAG
; 
by‹sAvaabË
 -= XING_TOC_FLAG;

438 
	}
}

	@liveMedia/MP3Transcoder.cpp

21 
	~"MP3T¿nscod”.hh
"

23 
	gMP3T¿nscod”
::
	$MP3T¿nscod”
(
U§geEnvœÚm’t
& 
’v
,

24 
MP3ADUT¿nscod”
* 
aduT¿nscod”
)

25 : 
	$MP3FromADUSourû
(
’v
, 
aduT¿nscod”
, 
F®£
) {

26 
	}
}

28 
	gMP3T¿nscod”
::~
	$MP3T¿nscod”
() {

29 
	}
}

31 
MP3T¿nscod”
* MP3T¿nscod”::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

32 
outB™¿‹
 ,

33 
F¿medSourû
* 
šputSourû
) {

34 
MP3T¿nscod”
* 
ÃwSourû
 = 
NULL
;

38 
ADUFromMP3Sourû
* 
aduFromMP3


39 ğ
ADUFromMP3Sourû
::
	`ü—‹New
(
’v
, 
šputSourû
, 
F®£
);

41 ià(
aduFromMP3
 =ğ
NULL
) ;

43 
MP3ADUT¿nscod”
* 
aduT¿nscod”


44 ğ
MP3ADUT¿nscod”
::
	`ü—‹New
(
’v
, 
outB™¿‹
, 
aduFromMP3
);

45 ià(
aduT¿nscod”
 =ğ
NULL
) ;

48 
ÃwSourû
 = 
Ãw
 
	`MP3T¿nscod”
(
’v
, 
aduT¿nscod”
);

51  
ÃwSourû
;

52 
	}
}

	@liveMedia/MPEG1or2AudioRTPSink.cpp

21 
	~"MPEG1Ü2AudioRTPSšk.hh
"

23 
	gMPEG1Ü2AudioRTPSšk
::
	$MPEG1Ü2AudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
)

24 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 14, 90000, "MPA") {

25 
	}
}

27 
	gMPEG1Ü2AudioRTPSšk
::~
	$MPEG1Ü2AudioRTPSšk
() {

28 
	}
}

30 
MPEG1Ü2AudioRTPSšk
*

31 
MPEG1Ü2AudioRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
) {

32  
Ãw
 
	`MPEG1Ü2AudioRTPSšk
(
’v
, 
RTPgs
);

33 
	}
}

35 
	gMPEG1Ü2AudioRTPSšk
::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

36 * 
äameS¹
,

37 
numBy‹sInF¿me
,

38 
timev®
 
äameP»£Á©iÚTime
,

39 
numRemaššgBy‹s
) {

42 ià(
	`isFœ¡Pack‘
(è&& 
	`isFœ¡F¿meInPack‘
()) {

43 
	`£tM¬k”B™
();

48 ià(
	`isFœ¡F¿meInPack‘
()) {

49 
	`£tS³cŸlH—d”WÜd
(
äagm’tiÚOff£t
&0xFFFF);

54 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

55 
äameS¹
, 
numBy‹sInF¿me
,

56 
äameP»£Á©iÚTime
,

57 
numRemaššgBy‹s
);

58 
	}
}

60 
	gMPEG1Ü2AudioRTPSšk
::
	$¥ecŸlH—d”Size
() const {

63 
	}
}

	@liveMedia/MPEG1or2AudioRTPSource.cpp

21 
	~"MPEG1Ü2AudioRTPSourû.hh
"

23 
MPEG1Ü2AudioRTPSourû
*

24 
	gMPEG1Ü2AudioRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

25 
Groupsock
* 
RTPgs
,

26 
¹pPaylßdFÜm©
,

27 
¹pTime¡ampF»qu’cy
) {

28  
Ãw
 
	`MPEG1Ü2AudioRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

29 
¹pTime¡ampF»qu’cy
);

30 
	}
}

32 
	gMPEG1Ü2AudioRTPSourû
::
	$MPEG1Ü2AudioRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

33 
Groupsock
* 
¹pGS
,

34 
¹pPaylßdFÜm©
,

35 
¹pTime¡ampF»qu’cy
)

36 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
¹pGS
,

37 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

38 
	}
}

40 
	gMPEG1Ü2AudioRTPSourû
::~
	$MPEG1Ü2AudioRTPSourû
() {

41 
	}
}

43 
BoŞ—n
 
MPEG1Ü2AudioRTPSourû


44 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

45 & 
»suÉS³cŸlH—d”Size
) {

47 ià(
·ck‘
->
	`d©aSize
(è< 4è 
F®£
;

55 
»suÉS³cŸlH—d”Size
 = 4;

56  
True
;

57 
	}
}

59 cÚ¡* 
	gMPEG1Ü2AudioRTPSourû
::
	$MIMEty³
() const {

61 
	}
}

	@liveMedia/MPEG1or2AudioStreamFramer.cpp

21 
	~"MPEG1Ü2AudioSŒ—mF¿m”.hh
"

22 
	~"SŒ—mP¬£r.hh
"

23 
	~"MP3IÁ”Çls.hh
"

24 
	~<GroupsockH–³r.hh
>

28 şas 
	cMPEG1Ü2AudioSŒ—mP¬£r
: 
public
 
SŒ—mP¬£r
 {

29 
public
:

30 
MPEG1Ü2AudioSŒ—mP¬£r
(
MPEG1Ü2AudioSŒ—mF¿m”
* 
usšgSourû
,

31 
F¿medSourû
* 
šputSourû
);

32 
	mvœtu®
 ~
MPEG1Ü2AudioSŒ—mP¬£r
();

34 
	mpublic
:

35 
·r£
(& 
numTrunÿ‹dBy‹s
);

38 
»gi¡”R—dIÁ”e¡
(* 
to
, 
maxSize
);

40 
MP3F¿meP¬ams
 cÚ¡& 
	$cu¼’tF¿me
(ècÚ¡ {  
fCu¼’tF¿me
; }

42 
´iv©e
:

43 * 
fTo
;

44 
fMaxSize
;

47 
MP3F¿meP¬ams
 
fCu¼’tF¿me
;

48 
	}
};

53 
	gMPEG1Ü2AudioSŒ—mF¿m”


54 ::
	$MPEG1Ü2AudioSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

55 
BoŞ—n
 
syncW™hIÅutSourû
)

56 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

57 
	$fSyncW™hIÅutSourû
(
syncW™hIÅutSourû
) {

58 
	`»£t
();

60 
fP¬£r
 = 
Ãw
 
	`MPEG1Ü2AudioSŒ—mP¬£r
(
this
, 
šputSourû
);

61 
	}
}

63 
	gMPEG1Ü2AudioSŒ—mF¿m”
::~
	$MPEG1Ü2AudioSŒ—mF¿m”
() {

64 
d–‘e
 
fP¬£r
;

65 
	}
}

67 
MPEG1Ü2AudioSŒ—mF¿m”
*

68 
	gMPEG1Ü2AudioSŒ—mF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

69 
F¿medSourû
* 
šputSourû
,

70 
BoŞ—n
 
syncW™hIÅutSourû
) {

72  
Ãw
 
	`MPEG1Ü2AudioSŒ—mF¿m”
(
’v
, 
šputSourû
, 
syncW™hIÅutSourû
);

73 
	}
}

75 
	gMPEG1Ü2AudioSŒ—mF¿m”
::
	$æushIÅut
() {

76 
	`»£t
();

77 
fP¬£r
->
	`æushIÅut
();

78 
	}
}

80 
	gMPEG1Ü2AudioSŒ—mF¿m”
::
	$»£t
() {

82 
timev®
 
timeNow
;

83 
	`g‘timeofday
(&
timeNow
, 
NULL
);

84 
	`»£tP»£Á©iÚTime
(
timeNow
);

85 
	}
}

87 
	gMPEG1Ü2AudioSŒ—mF¿m”


88 ::
	$»£tP»£Á©iÚTime
(
timev®
 
ÃwP»£Á©iÚTime
) {

89 
fNextF¿meP»£Á©iÚTime
 = 
ÃwP»£Á©iÚTime
;

90 
	}
}

92 
	gMPEG1Ü2AudioSŒ—mF¿m”
::
	$doG‘NextF¿me
() {

93 
fP¬£r
->
	`»gi¡”R—dIÁ”e¡
(
fTo
, 
fMaxSize
);

94 
	`cÚtšueR—dProûssšg
();

95 
	}
}

97 
	#MILLION
 1000000

	)

99 cÚ¡ 
	gnumSam¶esByLay”
[4] = {0, 384, 1152, 1152};

101 
timev®
 
	gMPEG1Ü2AudioSŒ—mF¿m”
::
	$cu¼’tF¿mePÏyTime
() const {

102 
MP3F¿meP¬ams
 cÚ¡& 
ä
 = 
fP¬£r
->
	`cu¼’tF¿me
();

103 cÚ¡ 
numSam¶es
 = 
numSam¶esByLay”
[
ä
.
Ïy”
];

105 
timev®
 
»suÉ
;

106 cÚ¡ 
äeq
 = 
ä
.
§m¶šgF»q
*(1 + fr.
isMPEG2
);

107 ià(
äeq
 == 0) {

108 
»suÉ
.
tv_£c
 = 0;

109 
»suÉ
.
tv_u£c
 = 0;

110  
»suÉ
;

114 cÚ¡ 
uSecÚds


115 ğ((
numSam¶es
*2*
MILLION
)/
äeq
 + 1)/2;

117 
»suÉ
.
tv_£c
 = 
uSecÚds
/
MILLION
;

118 
»suÉ
.
tv_u£c
 = 
uSecÚds
%
MILLION
;

119  
»suÉ
;

120 
	}
}

122 
	gMPEG1Ü2AudioSŒ—mF¿m”


123 ::
	$cÚtšueR—dProûssšg
(* 
ş›ÁD©a
,

125 
timev®
 
´e£Á©iÚTime
) {

126 
MPEG1Ü2AudioSŒ—mF¿m”
* 
äam”
 = (MPEG1Ü2AudioSŒ—mF¿m”*)
ş›ÁD©a
;

127 ià(
äam”
->
fSyncW™hIÅutSourû
) {

128 
äam”
->
	`»£tP»£Á©iÚTime
(
´e£Á©iÚTime
);

130 
äam”
->
	`cÚtšueR—dProûssšg
();

131 
	}
}

133 
	gMPEG1Ü2AudioSŒ—mF¿m”
::
	$cÚtšueR—dProûssšg
() {

134 
acquœedF¿meSize
 = 
fP¬£r
->
	`·r£
(
fNumTrunÿ‹dBy‹s
);

135 ià(
acquœedF¿meSize
 > 0) {

138 
fF¿meSize
 = 
acquœedF¿meSize
;

142 
fP»£Á©iÚTime
 = 
fNextF¿meP»£Á©iÚTime
;

143 
timev®
 
äamePÏyTime
 = 
	`cu¼’tF¿mePÏyTime
();

144 
fDu¿tiÚInMiüo£cÚds
 = 
äamePÏyTime
.
tv_£c
*
MILLION
 + f¿mePÏyTime.
tv_u£c
;

145 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 +ğ
äamePÏyTime
.tv_usec;

146 
fNextF¿meP»£Á©iÚTime
.
tv_£c


147 +ğ
äamePÏyTime
.
tv_£c
 + 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
/
MILLION
;

148 
fNextF¿meP»£Á©iÚTime
.
tv_u£c
 %ğ
MILLION
;

152 
	`aá”G‘tšg
(
this
);

158 
	}
}

163 
	gMPEG1Ü2AudioSŒ—mP¬£r


164 ::
	$MPEG1Ü2AudioSŒ—mP¬£r
(
MPEG1Ü2AudioSŒ—mF¿m”
* 
usšgSourû
,

165 
F¿medSourû
* 
šputSourû
)

166 : 
	`SŒ—mP¬£r
(
šputSourû
, 
F¿medSourû
::
hªdËClosu»
, 
usšgSourû
,

167 &
MPEG1Ü2AudioSŒ—mF¿m”
::
cÚtšueR—dProûssšg
, 
usšgSourû
) {

168 
	}
}

170 
	gMPEG1Ü2AudioSŒ—mP¬£r
::~
	$MPEG1Ü2AudioSŒ—mP¬£r
() {

171 
	}
}

173 
MPEG1Ü2AudioSŒ—mP¬£r
::
	$»gi¡”R—dIÁ”e¡
(* 
to
,

174 
maxSize
) {

175 
fTo
 = 
to
;

176 
fMaxSize
 = 
maxSize
;

177 
	}
}

179 
	gMPEG1Ü2AudioSŒ—mP¬£r
::
	$·r£
(& 
numTrunÿ‹dBy‹s
) {

180 
Œy
 {

181 
	`§veP¬£rS‹
();

184 ((
fCu¼’tF¿me
.
hdr
 = 
	`‹¡4By‹s
())&0xFFE00000) != 0xFFE00000) {

185 
	`skBy‹s
(1);

186 
	`§veP¬£rS‹
();

189 
fCu¼’tF¿me
.
	`£tP¬amsFromH—d”
();

192 
äameSize
 = 
fCu¼’tF¿me
.frameSize + 4;

193 ià(
äameSize
 > 
fMaxSize
) {

194 
numTrunÿ‹dBy‹s
 = 
äameSize
 - 
fMaxSize
;

195 
äameSize
 = 
fMaxSize
;

197 
numTrunÿ‹dBy‹s
 = 0;

200 
	`g‘By‹s
(
fTo
, 
äameSize
);

201 
	`skBy‹s
(
numTrunÿ‹dBy‹s
);

203  
äameSize
;

204 } 
	`ÿtch
 () {

205 #ifdeà
DEBUG


206 
	`årštf
(
¡d”r
, "MPEG1or2AudioStreamParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

210 
	}
}

	@liveMedia/MPEG1or2Demux.cpp

21 
	~"MPEG1Ü2Demux.hh
"

22 
	~"MPEG1Ü2DemuxedEËm’rySŒ—m.hh
"

23 
	~"SŒ—mP¬£r.hh
"

24 
	~<¡dlib.h
>

29 
	eMPEGP¬£S‹
 {

30 
	mPARSING_PACK_HEADER
,

31 
	mPARSING_SYSTEM_HEADER
,

32 
	mPARSING_PES_PACKET


35 şas 
	cMPEGProg¿mSŒ—mP¬£r
: 
public
 
SŒ—mP¬£r
 {

36 
public
:

37 
MPEGProg¿mSŒ—mP¬£r
(
MPEG1Ü2Demux
* 
usšgDemux
, 
F¿medSourû
* 
šputSourû
);

38 
	mvœtu®
 ~
MPEGProg¿mSŒ—mP¬£r
();

40 
	mpublic
:

41 
·r£
();

45 
	m´iv©e
:

46 
£tP¬£S‹
(
MPEGP¬£S‹
 
·r£S‹
);

48 
·r£PackH—d”
();

49 
·r£Sy¡emH—d”
();

50 
·r£PESPack‘
();

52 
BoŞ—n
 
	$isS³cŸlSŒ—mId
(
¡»am_id
) const;

55 
´iv©e
:

56 
MPEG1Ü2Demux
* 
fUsšgDemux
;

57 
MPEGP¬£S‹
 
fCu¼’tP¬£S‹
;

63 şas 
	cMPEG1Ü2Demux
::
OuutDesütÜ
::
SavedD©a
 {

64 
public
:

65 
	$SavedD©a
(* 
buf
, 
size
)

66 : 
	`Ãxt
(
NULL
), 
	`d©a
(
buf
), 
	`d©aSize
(
size
), 
	$numBy‹sU£d
(0) {

68 
vœtu®
 ~
	$SavedD©a
() {

69 
d–‘e
[] 
d©a
;

70 
d–‘e
 
Ãxt
;

71 
	}
}

73 
SavedD©a
* 
	gÃxt
;

74 * 
	gd©a
;

75 
	gd©aSize
, 
	gnumBy‹sU£d
;

81 
	gMPEG1Ü2Demux


82 ::
	$MPEG1Ü2Demux
(
U§geEnvœÚm’t
& 
’v
,

83 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
»şaimWh’La¡ESD›s
)

84 : 
	`Medium
(
’v
),

85 
	`fIÅutSourû
(
šputSourû
), 
	`fMPEGv”siÚ
(0),

86 
	`fNextAudioSŒ—mNumb”
(0), 
	`fNextVideoSŒ—mNumb”
(0),

87 
	`fReşaimWh’La¡ESD›s
(
»şaimWh’La¡ESD›s
), 
	`fNumOut¡ªdšgESs
(0),

88 
	`fNumP’dšgR—ds
(0), 
	$fHaveUnd–iv”edD©a
(
F®£
) {

89 
fP¬£r
 = 
Ãw
 
	`MPEGProg¿mSŒ—mP¬£r
(
this
, 
šputSourû
);

90 
i
 = 0; i < 256; ++i) {

91 
fOuut
[
i
].
§vedD©aH—d
 = fOuut[i].
§vedD©aTa
 = 
NULL
;

92 
fOuut
[
i
].
isPÙ’tŸÎyR—dabË
 = 
F®£
;

93 
fOuut
[
i
].
isCu¼’yAùive
 = 
F®£
;

94 
fOuut
[
i
].
isCu¼’yAwa™šgD©a
 = 
F®£
;

96 
	}
}

98 
	gMPEG1Ü2Demux
::~
	$MPEG1Ü2Demux
() {

99 
d–‘e
 
fP¬£r
;

100 
i
 = 0; i < 256; ++iè
d–‘e
 
fOuut
[i].
§vedD©aH—d
;

101 
Medium
::
	`şo£
(
fIÅutSourû
);

102 
	}
}

104 
MPEG1Ü2Demux
* 
	gMPEG1Ü2Demux


105 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

106 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
»şaimWh’La¡ESD›s
) {

109  
Ãw
 
	`MPEG1Ü2Demux
(
’v
, 
šputSourû
, 
»şaimWh’La¡ESD›s
);

110 
	}
}

112 
	gMPEG1Ü2Demux
::
SCR
::
	$SCR
()

113 : 
	`highB™
(0), 
	`»maššgB™s
(0), 
	`ex‹nsiÚ
(0), 
	$isV®id
(
F®£
) {

114 
	}
}

116 
	gMPEG1Ü2Demux


117 ::
	$nÙeEËm’rySŒ—mD–‘iÚ
(
MPEG1Ü2DemuxedEËm’rySŒ—m
* ) {

118 ià(--
fNumOut¡ªdšgESs
 =ğ0 && 
fReşaimWh’La¡ESD›s
) {

119 
Medium
::
	`şo£
(
this
);

121 
	}
}

123 
	gMPEG1Ü2Demux
::
	$æushIÅut
() {

124 
fP¬£r
->
	`æushIÅut
();

125 
	}
}

127 
MPEG1Ü2DemuxedEËm’rySŒ—m
*

128 
	gMPEG1Ü2Demux
::
	$ÃwEËm’rySŒ—m
(
u_št8_t
 
¡»amIdTag
) {

129 ++
fNumOut¡ªdšgESs
;

130 
fOuut
[
¡»amIdTag
].
isPÙ’tŸÎyR—dabË
 = 
True
;

131  
Ãw
 
	`MPEG1Ü2DemuxedEËm’rySŒ—m
(
	`’vœ
(), 
¡»amIdTag
, *
this
);

132 
	}
}

134 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
	gMPEG1Ü2Demux
::
	$ÃwAudioSŒ—m
() {

135 
ÃwAudioSŒ—mTag
 = 0xC0 | (
fNextAudioSŒ—mNumb”
++&~0xE0);

137  
	`ÃwEËm’rySŒ—m
(
ÃwAudioSŒ—mTag
);

138 
	}
}

140 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
	gMPEG1Ü2Demux
::
	$ÃwVideoSŒ—m
() {

141 
ÃwVideoSŒ—mTag
 = 0xE0 | (
fNextVideoSŒ—mNumb”
++&~0xF0);

143  
	`ÃwEËm’rySŒ—m
(
ÃwVideoSŒ—mTag
);

144 
	}
}

147 
	#RAW_PES
 0xFC

	)

149 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
	gMPEG1Ü2Demux
::
	$ÃwRawPESSŒ—m
() {

150  
	`ÃwEËm’rySŒ—m
(
RAW_PES
);

151 
	}
}

153 
	gMPEG1Ü2Demux
::
»gi¡”R—dIÁ”e¡
(
u_št8_t
 
¡»amIdTag
,

154 * 
to
, 
maxSize
,

155 
F¿medSourû
::
aá”G‘tšgFunc
*‡fterGettingFunc,

156 * 
aá”G‘tšgCl›ÁD©a
,

157 
F¿medSourû
::
ÚClo£Func
* onCloseFunc,

158 * 
ÚClo£Cl›ÁD©a
) {

159 
	gOuutDesütÜ
& 
	gout
 = 
fOuut
[
¡»amIdTag
];

162 ià(
	gout
.
	gisCu¼’yAwa™šgD©a
) {

163 
’vœ
() << "MPEG1or2Demux::registerReadInterest():‡ttempto„ead stream morehan once!\n";

164 
’vœ
().
š‹º®E¼Ü
();

167 
	gout
.
	gto
 = 
to
; out.
	gmaxSize
 = 
maxSize
;

168 
	gout
.
	gfAá”G‘tšgFunc
 = 
aá”G‘tšgFunc
;

169 
	gout
.
	gaá”G‘tšgCl›ÁD©a
 = 
aá”G‘tšgCl›ÁD©a
;

170 
	gout
.
	gfOnClo£Func
 = 
ÚClo£Func
;

171 
	gout
.
	gÚClo£Cl›ÁD©a
 = 
ÚClo£Cl›ÁD©a
;

172 
	gout
.
	gisCu¼’yAùive
 = 
True
;

173 
	gout
.
	gisCu¼’yAwa™šgD©a
 = 
True
;

176 ++
	gfNumP’dšgR—ds
;

179 
BoŞ—n
 
	gMPEG1Ü2Demux
::
u£SavedD©a
(
u_št8_t
 
¡»amIdTag
,

180 * 
to
, 
maxSize
,

181 
F¿medSourû
::
aá”G‘tšgFunc
*‡fterGettingFunc,

182 * 
aá”G‘tšgCl›ÁD©a
) {

183 
	gOuutDesütÜ
& 
	gout
 = 
fOuut
[
¡»amIdTag
];

184 ià(
	gout
.
	g§vedD©aH—d
 =ğ
NULL
è 
F®£
;

186 
	gtÙNumBy‹sCİ›d
 = 0;

187 
	gmaxSize
 > 0 && 
	gout
.
	g§vedD©aH—d
 !ğ
NULL
) {

188 
OuutDesütÜ
::
SavedD©a
& 
§vedD©a
 = *(
out
.
§vedD©aH—d
);

189 * 
	gäom
 = &
§vedD©a
.
d©a
[§vedD©a.
numBy‹sU£d
];

190 
	gnumBy‹sToCİy
 = 
§vedD©a
.
d©aSize
 - savedD©a.
numBy‹sU£d
;

191 ià(
	gnumBy‹sToCİy
 > 
	gmaxSize
ènumBy‹sToCİy = 
maxSize
;

192 
memmove
(
to
, 
äom
, 
numBy‹sToCİy
);

193 
	gto
 +ğ
numBy‹sToCİy
;

194 
	gmaxSize
 -ğ
numBy‹sToCİy
;

195 
	gout
.
	g§vedD©aTÙ®Size
 -ğ
numBy‹sToCİy
;

196 
	gtÙNumBy‹sCİ›d
 +ğ
numBy‹sToCİy
;

197 
	g§vedD©a
.
	gnumBy‹sU£d
 +ğ
numBy‹sToCİy
;

198 ià(
	g§vedD©a
.
	gnumBy‹sU£d
 =ğ
§vedD©a
.
d©aSize
) {

199 
out
.
§vedD©aH—d
 = 
§vedD©a
.
Ãxt
;

200 ià(
	gout
.
	g§vedD©aH—d
 =ğ
NULL
è
out
.
§vedD©aTa
 = NULL;

201 
	g§vedD©a
.
	gÃxt
 = 
NULL
;

202 
	gd–‘e
 &
	g§vedD©a
;

206 
	gout
.
	gisCu¼’yAùive
 = 
True
;

207 ià(
	gaá”G‘tšgFunc
 !ğ
NULL
) {

208 
timev®
 
´e£Á©iÚTime
;

209 
	g´e£Á©iÚTime
.
	gtv_£c
 = 0;…»£Á©iÚTime.
	gtv_u£c
 = 0;

210 (*
	gaá”G‘tšgFunc
)(
	gaá”G‘tšgCl›ÁD©a
, 
	gtÙNumBy‹sCİ›d
,

211 0 , 
	g´e£Á©iÚTime
,

214  
	gTrue
;

217 
	gMPEG1Ü2Demux


218 ::
	$cÚtšueR—dProûssšg
(* 
ş›ÁD©a
,

220 
timev®
 ) {

221 
MPEG1Ü2Demux
* 
demux
 = (MPEG1Ü2Demux*)
ş›ÁD©a
;

222 
demux
->
	`cÚtšueR—dProûssšg
();

223 
	}
}

225 
	gMPEG1Ü2Demux
::
	$cÚtšueR—dProûssšg
() {

226 
fNumP’dšgR—ds
 > 0) {

227 
acquœedSŒ—mIdTag
 = 
fP¬£r
->
	`·r£
();

229 ià(
acquœedSŒ—mIdTag
 != 0) {

231 
OuutDesütÜ
& 
ÃwOut
 = 
fOuut
[
acquœedSŒ—mIdTag
];

232 
ÃwOut
.
isCu¼’yAwa™šgD©a
 = 
F®£
;

239 ià(
ÃwOut
.
fAá”G‘tšgFunc
 !ğ
NULL
) {

240 (*
ÃwOut
.
fAá”G‘tšgFunc
)ÒewOut.
aá”G‘tšgCl›ÁD©a
,

241 
ÃwOut
.
äameSize
, 0 ,

242 
ÃwOut
.
´e£Á©iÚTime
,

244 --
fNumP’dšgR—ds
;

255 
	}
}

257 
	gMPEG1Ü2Demux
::
g‘NextF¿me
(
u_št8_t
 
¡»amIdTag
,

258 * 
to
, 
maxSize
,

259 
F¿medSourû
::
aá”G‘tšgFunc
*‡fterGettingFunc,

260 * 
aá”G‘tšgCl›ÁD©a
,

261 
F¿medSourû
::
ÚClo£Func
* onCloseFunc,

262 * 
ÚClo£Cl›ÁD©a
) {

264 ià(
u£SavedD©a
(
¡»amIdTag
, 
to
, 
maxSize
,

265 
aá”G‘tšgFunc
, 
aá”G‘tšgCl›ÁD©a
)) {

270 
»gi¡”R—dIÁ”e¡
(
¡»amIdTag
, 
to
, 
maxSize
,

271 
aá”G‘tšgFunc
, 
aá”G‘tšgCl›ÁD©a
,

272 
ÚClo£Func
, 
ÚClo£Cl›ÁD©a
);

275 ià(
	gfNumP’dšgR—ds
 =ğ1 || 
fHaveUnd–iv”edD©a
) {

276 
fHaveUnd–iv”edD©a
 = 0;

277 
cÚtšueR—dProûssšg
();

281 
	gMPEG1Ü2Demux
::
	$¡İG‘tšgF¿mes
(
u_št8_t
 
¡»amIdTag
) {

282 
OuutDesütÜ
& 
out
 = 
fOuut
[
¡»amIdTag
];

284 ià(
out
.
isCu¼’yAwa™šgD©a
 && 
fNumP’dšgR—ds
 > 0) --fNumPendingReads;

286 
out
.
isCu¼’yAùive
 = out.
isCu¼’yAwa™šgD©a
 = 
F®£
;

287 
	}
}

289 
	gMPEG1Ü2Demux
::
	$hªdËClosu»
(* 
ş›ÁD©a
) {

290 
MPEG1Ü2Demux
* 
demux
 = (MPEG1Ü2Demux*)
ş›ÁD©a
;

292 
demux
->
fNumP’dšgR—ds
 = 0;

299 
F¿medSourû
::
ÚClo£Func
* 
fOnClo£Func
;

300 * 
ÚClo£Cl›ÁD©a
;

301 } 
§vedP’dšg
[256];

302 
i
, 
numP’dšg
 = 0;

303 
i
 = 0; i < 256; ++i) {

304 
OuutDesütÜ
& 
out
 = 
demux
->
fOuut
[
i
];

305 ià(
out
.
isCu¼’yAwa™šgD©a
) {

306 ià(
out
.
fOnClo£Func
 !ğ
NULL
) {

307 
§vedP’dšg
[
numP’dšg
].
fOnClo£Func
 = 
out
.fOnCloseFunc;

308 
§vedP’dšg
[
numP’dšg
].
ÚClo£Cl›ÁD©a
 = 
out
.onCloseClientData;

309 ++
numP’dšg
;

312 
d–‘e
 
out
.
§vedD©aH—d
; out.§vedD©aH—d = out.
§vedD©aTa
 = 
NULL
;

313 
out
.
§vedD©aTÙ®Size
 = 0;

314 
out
.
isPÙ’tŸÎyR—dabË
 = out.
isCu¼’yAùive
 = out.
isCu¼’yAwa™šgD©a


315 ğ
F®£
;

317 
i
 = 0; i < 
numP’dšg
; ++i) {

318 (*
§vedP’dšg
[
i
].
fOnClo£Func
)(§vedP’dšg[i].
ÚClo£Cl›ÁD©a
);

320 
	}
}

325 
	~<¡ršg.h
>

327 
	gMPEGProg¿mSŒ—mP¬£r
::
	$MPEGProg¿mSŒ—mP¬£r
(
MPEG1Ü2Demux
* 
usšgDemux
,

328 
F¿medSourû
* 
šputSourû
)

329 : 
	`SŒ—mP¬£r
(
šputSourû
, 
MPEG1Ü2Demux
::
hªdËClosu»
, 
usšgDemux
,

330 &
MPEG1Ü2Demux
::
cÚtšueR—dProûssšg
, 
usšgDemux
),

331 
	`fUsšgDemux
(
usšgDemux
), 
	$fCu¼’tP¬£S‹
(
PARSING_PACK_HEADER
) {

332 
	}
}

334 
	gMPEGProg¿mSŒ—mP¬£r
::~
	$MPEGProg¿mSŒ—mP¬£r
() {

335 
	}
}

337 
MPEGProg¿mSŒ—mP¬£r
::
	$£tP¬£S‹
(
MPEGP¬£S‹
 
·r£S‹
) {

338 
fCu¼’tP¬£S‹
 = 
·r£S‹
;

339 
	`§veP¬£rS‹
();

340 
	}
}

342 
	gMPEGProg¿mSŒ—mP¬£r
::
	$·r£
() {

343 
acquœedSŒ—mTagId
 = 0;

345 
Œy
 {

347 
fCu¼’tP¬£S‹
) {

348 
PARSING_PACK_HEADER
: {

349 
	`·r£PackH—d”
();

352 
PARSING_SYSTEM_HEADER
: {

353 
	`·r£Sy¡emH—d”
();

356 
PARSING_PES_PACKET
: {

357 
acquœedSŒ—mTagId
 = 
	`·r£PESPack‘
();

361 } 
acquœedSŒ—mTagId
 == 0);

363  
acquœedSŒ—mTagId
;

364 } 
	`ÿtch
 () {

365 #ifdeà
DEBUG


366 
	`årštf
(
¡d”r
, "MPEGProgramStreamParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

367 
	`fæush
(
¡d”r
);

371 
	}
}

373 
	#PACK_START_CODE
 0x000001BA

	)

374 
	#SYSTEM_HEADER_START_CODE
 0x000001BB

	)

375 
	#PACKET_START_CODE_PREFIX
 0x00000100

	)

377 
šlše
 
BoŞ—n
 
	$isPack‘S¹Code
(
code
) {

378  (
code
&0xFFFFFF00è=ğ
PACKET_START_CODE_PREFIX


379 && 
code
 > 
SYSTEM_HEADER_START_CODE
;

380 
	}
}

382 
	gMPEGProg¿mSŒ—mP¬£r
::
	$·r£PackH—d”
() {

383 #ifdeà
DEBUG


384 
	`årštf
(
¡d”r
, "·rsšg…ack h—d”\n"); 
	`fæush
(stderr);

386 
fœ¡4By‹s
;

388 
fœ¡4By‹s
 = 
	`‹¡4By‹s
();

392 ià(
fœ¡4By‹s
 =ğ
PACK_START_CODE
) {

393 
	`skBy‹s
(4);

395 } ià(
fœ¡4By‹s
 =ğ
SYSTEM_HEADER_START_CODE
) {

396 #ifdeà
DEBUG


397 
	`årštf
(
¡d”r
, "found system header instead of…ack header\n");

399 
	`£tP¬£S‹
(
PARSING_SYSTEM_HEADER
);

401 } ià(
	`isPack‘S¹Code
(
fœ¡4By‹s
)) {

402 #ifdeà
DEBUG


403 
	`årštf
(
¡d”r
, "found…ack‘ s¹ cod0x%02x in¡—d oà·ck h—d”\n", 
fœ¡4By‹s
);

405 
	`£tP¬£S‹
(
PARSING_PES_PACKET
);

409 
	`£tP¬£S‹
(
PARSING_PACK_HEADER
);

410 ià((
fœ¡4By‹s
&0xFF) > 1) {

411 
	`skBy‹s
(4);

413 
	`skBy‹s
(1);

419 
ÃxtBy‹
 = 
	`g‘1By‹
();

420 
MPEG1Ü2Demux
::
SCR
& 
sü
 = 
fUsšgDemux
->
fLa¡S“nSCR
;

421 ià((
ÃxtBy‹
&0xF0) == 0x20) {

422 
fUsšgDemux
->
fMPEGv”siÚ
 = 1;

423 
sü
.
highB™
 = (
ÃxtBy‹
&0x08)>>3;

424 
sü
.
»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

425 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

426 
sü
.
»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

427 
sü
.
»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

428 
sü
.
ex‹nsiÚ
 = 0;

429 
sü
.
isV®id
 = 
True
;

430 
	`skB™s
(24);

432 #ià
	`defšed
(
DEBUG_TIMESTAMPS
è|| defšed(
DEBUG_SCR_TIMESTAMPS
)

433 
	`årštf
(
¡d”r
, "pack hdr system_clock_reference_base: 0x%x",

434 
sü
.
highB™
);

435 
	`årštf
(
¡d”r
, "%08x\n", 
sü
.
»maššgB™s
);

437 } ià((
ÃxtBy‹
&0xC0) == 0x40) {

438 
fUsšgDemux
->
fMPEGv”siÚ
 = 2;

439 
sü
.
highB™
 = (
ÃxtBy‹
&0x20)>>5;

440 
sü
.
»maššgB™s
 = (
ÃxtBy‹
&0x18)<<27;

441 
sü
.
»maššgB™s
 |ğ(
ÃxtBy‹
&0x03)<<28;

442 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

443 
sü
.
»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFF80000)>>4;

444 
sü
.
»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0003FFF8)>>3;

445 
sü
.
ex‹nsiÚ
 = (
Ãxt4By‹s
&0x00000003)<<7;

446 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

447 
sü
.
ex‹nsiÚ
 |ğ(
Ãxt4By‹s
&0xFE000000)>>25;

448 
sü
.
isV®id
 = 
True
;

449 
	`skB™s
(5);

451 #ià
	`defšed
(
DEBUG_TIMESTAMPS
è|| defšed(
DEBUG_SCR_TIMESTAMPS
)

452 
	`årštf
(
¡d”r
, "pack hdr system_clock_reference_base: 0x%x",

453 
sü
.
highB™
);

454 
	`årštf
(
¡d”r
, "%08x\n", 
sü
.
»maššgB™s
);

455 
	`årštf
(
¡d”r
, "pack hdr system_clock_reference_extension: 0x%03x\n",

456 
sü
.
ex‹nsiÚ
);

458 
·ck_¡uffšg_Ëngth
 = 
	`g‘B™s
(3);

459 
	`skBy‹s
(
·ck_¡uffšg_Ëngth
);

461 
fUsšgDemux
->
	`’vœ
() << "StreamParser::parsePack() saw strange byte following…ack_start_code\n";

465 
	`£tP¬£S‹
(
PARSING_SYSTEM_HEADER
);

466 
	}
}

468 
	gMPEGProg¿mSŒ—mP¬£r
::
	$·r£Sy¡emH—d”
() {

469 #ifdeà
DEBUG


470 
	`årštf
(
¡d”r
, "·rsšg sy¡em h—d”\n"); 
	`fæush
(stderr);

472 
Ãxt4By‹s
 = 
	`‹¡4By‹s
();

473 ià(
Ãxt4By‹s
 !ğ
SYSTEM_HEADER_START_CODE
) {

475 
	`£tP¬£S‹
(
PARSING_PES_PACKET
);

479 #ifdeà
DEBUG


480 
	`årštf
(
¡d”r
, "§w sy¡em_h—d”_¡¬t_code\n"); 
	`fæush
(stderr);

482 
	`skBy‹s
(4);

484 
»maššg_h—d”_Ëngth
 = 
	`g‘2By‹s
();

488 ià(
»maššg_h—d”_Ëngth
 < 6) {

489 
fUsšgDemux
->
	`’vœ
() << "StreamParser::parseSystemHeader(): saw strange header_length: "

490 << 
»maššg_h—d”_Ëngth
 << " < 6\n";

492 
	`skBy‹s
(
»maššg_h—d”_Ëngth
);

495 
	`£tP¬£S‹
(
PARSING_PES_PACKET
);

496 
	}
}

498 
	#´iv©e_¡»am_1
 0xBD

	)

499 
	#´iv©e_¡»am_2
 0xBF

	)

502 
BoŞ—n
 
	gMPEGProg¿mSŒ—mP¬£r


503 ::
	$isS³cŸlSŒ—mId
(
¡»am_id
) const {

504 ià(
¡»am_id
 =ğ
RAW_PES
è 
True
;

506 ià(
fUsšgDemux
->
fMPEGv”siÚ
 == 1) {

507  
¡»am_id
 =ğ
´iv©e_¡»am_2
;

509 ià(
¡»am_id
 <ğ
´iv©e_¡»am_2
) {

510  
¡»am_id
 !ğ
´iv©e_¡»am_1
;

511 } ià((
¡»am_id
&0xF0) == 0xF0) {

512 
low”4B™s
 = 
¡»am_id
&0x0F;

513  
low”4B™s
 <= 2 ||†ower4Bits == 0x8 ||†ower4Bits == 0xF;

515  
F®£
;

518 
	}
}

520 
	#READER_NOT_READY
 2

	)

522 
	gMPEGProg¿mSŒ—mP¬£r
::
	$·r£PESPack‘
() {

523 #ifdeà
DEBUG


524 
	`årštf
(
¡d”r
, "·rsšg PES…ack‘\n"); 
	`fæush
(stderr);

526 
Ãxt4By‹s
 = 
	`‹¡4By‹s
();

527 ià(!
	`isPack‘S¹Code
(
Ãxt4By‹s
)) {

529 
	`£tP¬£S‹
(
PARSING_PACK_HEADER
);

533 #ifdeà
DEBUG


534 
	`årštf
(
¡d”r
, "§w…ack‘_¡¬t_code_´efix\n"); 
	`fæush
(stderr);

536 
	`skBy‹s
(3);

538 
¡»am_id
 = 
	`g‘1By‹
();

539 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_TIMESTAMPS
)

540 
¡»amNum
 = 
¡»am_id
;

541 cÚ¡* 
¡»amTy³SŒ
;

542 ià((
¡»am_id
&0xE0) == 0xC0) {

543 
¡»amTy³SŒ
 = "audio";

544 
¡»amNum
 = 
¡»am_id
&~0xE0;

545 } ià((
¡»am_id
&0xF0) == 0xE0) {

546 
¡»amTy³SŒ
 = "video";

547 
¡»amNum
 = 
¡»am_id
&~0xF0;

548 } ià(
¡»am_id
 == 0xbc) {

549 
¡»amTy³SŒ
 = "reserved";

550 } ià(
¡»am_id
 == 0xbd) {

551 
¡»amTy³SŒ
 = "private_1";

552 } ià(
¡»am_id
 == 0xbe) {

553 
¡»amTy³SŒ
 = "padding";

554 } ià(
¡»am_id
 == 0xbf) {

555 
¡»amTy³SŒ
 = "private_2";

557 
¡»amTy³SŒ
 = "unknown";

560 #ifdeà
DEBUG


561 
äameCouÁ
 = 1;

562 
	`årštf
(
¡d”r
, "%d, saw % ¡»am: 0x%02x\n", 
äameCouÁ
, 
¡»amTy³SŒ
, 
¡»amNum
); 
	`fæush
(stderr);

565 
PES_·ck‘_Ëngth
 = 
	`g‘2By‹s
();

566 #ifdeà
DEBUG


567 
	`årštf
(
¡d”r
, "PES_·ck‘_Ëngth: %d\n", 
PES_·ck‘_Ëngth
); 
	`fæush
(stderr);

572 ià(
fUsšgDemux
->
fOuut
[
RAW_PES
].
isPÙ’tŸÎyR—dabË
) {

574 
¡»am_id
 = 
RAW_PES
;

576 
§vedP¬£rOff£t
 = 
	`curOff£t
();

577 #ifdeà
DEBUG_TIMESTAMPS


578 
±s_highB™
 = 0;

579 
±s_»maššgB™s
 = 0;

580 
dts_highB™
 = 0;

581 
dts_»maššgB™s
 = 0;

583 ià(
fUsšgDemux
->
fMPEGv”siÚ
 == 1) {

584 ià(!
	`isS³cŸlSŒ—mId
(
¡»am_id
)) {

585 
ÃxtBy‹
;

586 (
ÃxtBy‹
 = 
	`g‘1By‹
()) == 0xFF) {

588 ià((
ÃxtBy‹
&0xC0) == 0x40) {

589 
	`skBy‹s
(1);

590 
ÃxtBy‹
 = 
	`g‘1By‹
();

592 ià((
ÃxtBy‹
&0xF0) == 0x20) {

593 #ifdeà
DEBUG_TIMESTAMPS


594 
±s_highB™
 = (
ÃxtBy‹
&0x08)>>3;

595 
±s_»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

596 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

597 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

598 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

600 
	`skBy‹s
(4);

602 } ià((
ÃxtBy‹
&0xF0) == 0x30) {

603 #ifdeà
DEBUG_TIMESTAMPS


604 
±s_highB™
 = (
ÃxtBy‹
&0x08)>>3;

605 
±s_»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

606 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

607 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

608 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

610 
ÃxtBy‹
 = 
	`g‘1By‹
();

611 
dts_highB™
 = (
ÃxtBy‹
&0x08)>>3;

612 
dts_»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

613 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

614 
dts_»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

615 
dts_»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

617 
	`skBy‹s
(9);

622 ià(!
	`isS³cŸlSŒ—mId
(
¡»am_id
)) {

624 
Ãxt3By‹s
 = 
	`g‘B™s
(24);

625 #ifdeà
DEBUG_TIMESTAMPS


626 
PTS_DTS_æags
 = (
Ãxt3By‹s
&0x00C000)>>14;

628 #ifdeà
undef


629 
ESCR_æag
 = (
Ãxt3By‹s
&0x002000)>>13;

630 
ES_¿‹_æag
 = (
Ãxt3By‹s
&0x001000)>>12;

631 
DSM_Œick_mode_æag
 = (
Ãxt3By‹s
&0x000800)>>11;

633 
PES_h—d”_d©a_Ëngth
 = (
Ãxt3By‹s
&0x0000FF);

634 #ifdeà
DEBUG


635 
	`årštf
(
¡d”r
, "PES_h—d”_d©a_Ëngth: 0x%02x\n", 
PES_h—d”_d©a_Ëngth
); 
	`fæush
(stderr);

637 #ifdeà
DEBUG_TIMESTAMPS


638 ià(
PTS_DTS_æags
 =ğ0x2 && 
PES_h—d”_d©a_Ëngth
 >= 5) {

639 
ÃxtBy‹
 = 
	`g‘1By‹
();

640 
±s_highB™
 = (
ÃxtBy‹
&0x08)>>3;

641 
±s_»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

642 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

643 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

644 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

646 
	`skBy‹s
(
PES_h—d”_d©a_Ëngth
-5);

647 } ià(
PTS_DTS_æags
 =ğ0x3 && 
PES_h—d”_d©a_Ëngth
 >= 10) {

648 
ÃxtBy‹
 = 
	`g‘1By‹
();

649 
±s_highB™
 = (
ÃxtBy‹
&0x08)>>3;

650 
±s_»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

651 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

652 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

653 
±s_»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

655 
ÃxtBy‹
 = 
	`g‘1By‹
();

656 
dts_highB™
 = (
ÃxtBy‹
&0x08)>>3;

657 
dts_»maššgB™s
 = (
ÃxtBy‹
&0x06)<<29;

658 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

659 
dts_»maššgB™s
 |ğ(
Ãxt4By‹s
&0xFFFE0000)>>2;

660 
dts_»maššgB™s
 |ğ(
Ãxt4By‹s
&0x0000FFFE)>>1;

662 
	`skBy‹s
(
PES_h—d”_d©a_Ëngth
-10);

665 
	`skBy‹s
(
PES_h—d”_d©a_Ëngth
);

669 #ifdeà
DEBUG_TIMESTAMPS


670 
	`årštf
(
¡d”r
, "% ¡»am, ", 
¡»amTy³SŒ
);

671 
	`årštf
(
¡d”r
, "·ck‘…»£Á©iÚ_time_¡amp: 0x%x", 
±s_highB™
);

672 
	`årštf
(
¡d”r
, "%08x\n", 
±s_»maššgB™s
);

673 
	`årštf
(
¡d”r
, "\t\ack‘ decodšg_time_¡amp: 0x%x", 
dts_highB™
);

674 
	`årštf
(
¡d”r
, "%08x\n", 
dts_»maššgB™s
);

679 
acquœedSŒ—mIdTag
 = 0;

680 
cu¼’tP¬£rOff£t
 = 
	`curOff£t
();

681 
by‹sSk³d
 = 
cu¼’tP¬£rOff£t
 - 
§vedP¬£rOff£t
;

682 ià(
¡»am_id
 =ğ
RAW_PES
) {

683 
	`»¡ÜeSavedP¬£rS‹
();

684 
PES_·ck‘_Ëngth
 += 6;

685 
by‹sSk³d
 = 0;

687 ià(
PES_·ck‘_Ëngth
 < 
by‹sSk³d
) {

688 
fUsšgDemux
->
	`’vœ
() << "StreamParser::parsePESPacket(): saw inconsistent PES_packet_length "

689 << 
PES_·ck‘_Ëngth
 << " < "

690 << 
by‹sSk³d
 << "\n";

692 
PES_·ck‘_Ëngth
 -ğ
by‹sSk³d
;

693 #ifdeà
DEBUG


694 
Ãxt4By‹s
 = 
	`‹¡4By‹s
();

699 
MPEG1Ü2Demux
::
OuutDesütÜ_t
& 
out
 = 
fUsšgDemux
->
fOuut
[
¡»am_id
];

700 ià(
out
.
isCu¼’yAwa™šgD©a
) {

701 
numBy‹sToCİy
;

702 ià(
PES_·ck‘_Ëngth
 > 
out
.
maxSize
) {

703 
fUsšgDemux
->
	`’vœ
() << "MPEGProgramStreamParser::parsePESPacket()ƒrror: PES_packet_length ("

704 << 
PES_·ck‘_Ëngth


706 << 
out
.
maxSize
 << ")\n";

707 
numBy‹sToCİy
 = 
out
.
maxSize
;

709 
numBy‹sToCİy
 = 
PES_·ck‘_Ëngth
;

712 
	`g‘By‹s
(
out
.
to
, 
numBy‹sToCİy
);

713 
out
.
äameSize
 = 
numBy‹sToCİy
;

714 #ifdeà
DEBUG


715 
	`årštf
(
¡d”r
, "%d, %d by‹ oàPES_·ck‘_d©¨(out.maxSize: %d); fœ¡ 4 by‹s: 0x%08x\n", 
äameCouÁ
, 
numBy‹sToCİy
, 
out
.
maxSize
, 
Ãxt4By‹s
); 
	`fæush
(stderr);

718 
acquœedSŒ—mIdTag
 = 
¡»am_id
;

719 
PES_·ck‘_Ëngth
 -ğ
numBy‹sToCİy
;

720 } ià(
out
.
isCu¼’yAùive
) {

724 #ifdeà
DEBUG


725 
	`årštf
(
¡d”r
, "%d, cu¼’y und–iv”abË PES d©a; fœ¡ 4 by‹s: 0x%08x - cu¼’y und–iv”abË!\n", 
äameCouÁ
, 
Ãxt4By‹s
); 
	`fæush
(stderr);

727 
	`»¡ÜeSavedP¬£rS‹
();

728 
fUsšgDemux
->
fHaveUnd–iv”edD©a
 = 
True
;

729 
throw
 
READER_NOT_READY
;

730 } ià(
out
.
isPÙ’tŸÎyR—dabË
 &&

731 
out
.
§vedD©aTÙ®Size
 + 
PES_·ck‘_Ëngth
 < 1000000 ) {

734 * 
buf
 = 
Ãw
 [
PES_·ck‘_Ëngth
];

735 
	`g‘By‹s
(
buf
, 
PES_·ck‘_Ëngth
);

736 
MPEG1Ü2Demux
::
OuutDesütÜ
::
SavedD©a
* 
§vedD©a


737 ğ
Ãw
 
MPEG1Ü2Demux
::
OuutDesütÜ
::
	`SavedD©a
(
buf
, 
PES_·ck‘_Ëngth
);

738 ià(
out
.
§vedD©aH—d
 =ğ
NULL
) {

739 
out
.
§vedD©aH—d
 = out.
§vedD©aTa
 = 
§vedD©a
;

741 
out
.
§vedD©aTa
->
Ãxt
 = 
§vedD©a
;

742 
out
.
§vedD©aTa
 = 
§vedD©a
;

744 
out
.
§vedD©aTÙ®Size
 +ğ
PES_·ck‘_Ëngth
;

745 
PES_·ck‘_Ëngth
 = 0;

747 
	`skBy‹s
(
PES_·ck‘_Ëngth
);

751 
	`£tP¬£S‹
(
PARSING_PES_PACKET
);

752 #ifdeà
DEBUG


753 ++
äameCouÁ
;

755  
acquœedSŒ—mIdTag
;

756 
	}
}

	@liveMedia/MPEG1or2DemuxedElementaryStream.cpp

21 
	~"MPEG1Ü2DemuxedEËm’rySŒ—m.hh
"

25 
	gMPEG1Ü2DemuxedEËm’rySŒ—m
::

26 
	$MPEG1Ü2DemuxedEËm’rySŒ—m
(
U§geEnvœÚm’t
& 
’v
, 
u_št8_t
 
¡»amIdTag
,

27 
MPEG1Ü2Demux
& 
sourûDemux
)

28 : 
	`F¿medSourû
(
’v
),

29 
	`fOurSŒ—mIdTag
(
¡»amIdTag
), 
	`fOurSourûDemux
(
sourûDemux
), 
	$fMPEGv”siÚ
(0) {

31 ià((
¡»amIdTag
&0xE0) == 0xC0) {

32 
fMIMEty³
 = "audio/MPEG";

33 } ià((
¡»amIdTag
&0xF0) == 0xE0) {

34 
fMIMEty³
 = "video/MPEG";

36 
fMIMEty³
 = 
MedŸSourû
::
	`MIMEty³
();

38 
	}
}

40 
	gMPEG1Ü2DemuxedEËm’rySŒ—m
::~
	$MPEG1Ü2DemuxedEËm’rySŒ—m
() {

41 
fOurSourûDemux
.
	`nÙeEËm’rySŒ—mD–‘iÚ
(
this
);

42 
	}
}

44 
	gMPEG1Ü2DemuxedEËm’rySŒ—m
::
	$doG‘NextF¿me
() {

45 
fOurSourûDemux
.
	`g‘NextF¿me
(
fOurSŒ—mIdTag
, 
fTo
, 
fMaxSize
,

46 
aá”G‘tšgF¿me
, 
this
,

47 
hªdËClosu»
, 
this
);

48 
	}
}

50 
	gMPEG1Ü2DemuxedEËm’rySŒ—m
::
	$doStİG‘tšgF¿mes
() {

51 
fOurSourûDemux
.
	`¡İG‘tšgF¿mes
(
fOurSŒ—mIdTag
);

52 
	}
}

54 cÚ¡* 
	gMPEG1Ü2DemuxedEËm’rySŒ—m
::
	$MIMEty³
() const {

55  
fMIMEty³
;

56 
	}
}

58 
	gMPEG1Ü2DemuxedEËm’rySŒ—m
::
	$maxF¿meSize
() const {

62 
	}
}

64 
	gMPEG1Ü2DemuxedEËm’rySŒ—m


65 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
,

66 
äameSize
, 
numTrunÿ‹dBy‹s
,

67 
timev®
 
´e£Á©iÚTime
,

68 
du¿tiÚInMiüo£cÚds
) {

69 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
¡»am


70 ğ(
MPEG1Ü2DemuxedEËm’rySŒ—m
*)
ş›ÁD©a
;

71 
¡»am
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

72 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

73 
	}
}

75 
	gMPEG1Ü2DemuxedEËm’rySŒ—m


76 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

77 
timev®
 
´e£Á©iÚTime
,

78 
du¿tiÚInMiüo£cÚds
) {

79 
fF¿meSize
 = 
äameSize
;

80 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

81 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

82 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

84 
fLa¡S“nSCR
 = 
fOurSourûDemux
.
	`Ï¡S“nSCR
();

85 
fMPEGv”siÚ
 = 
fOurSourûDemux
.
	`m³gV”siÚ
();

87 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

88 
	}
}

	@liveMedia/MPEG1or2DemuxedServerMediaSubsession.cpp

22 
	~"MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ.hh
"

23 
	~"MPEG1Ü2AudioSŒ—mF¿m”.hh
"

24 
	~"MPEG1Ü2AudioRTPSšk.hh
"

25 
	~"MPEG1Ü2VideoSŒ—mF¿m”.hh
"

26 
	~"MPEG1Ü2VideoRTPSšk.hh
"

27 
	~"AC3AudioSŒ—mF¿m”.hh
"

28 
	~"AC3AudioRTPSšk.hh
"

29 
	~"By‹SŒ—mFeSourû.hh
"

31 
MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
* 
	gMPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ


32 ::
	$ü—‹New
(
MPEG1Ü2FeS”v”Demux
& 
demux
, 
u_št8_t
 
¡»amIdTag
,

33 
BoŞ—n
 
»u£Fœ¡Sourû
, BoŞ—À
iF¿mesOÆy
, 
vshP”iod
) {

34  
Ãw
 
	`MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
(
demux
, 
¡»amIdTag
,

35 
»u£Fœ¡Sourû
,

36 
iF¿mesOÆy
, 
vshP”iod
);

37 
	}
}

39 
	gMPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ


40 ::
	$MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
(
MPEG1Ü2FeS”v”Demux
& 
demux
,

41 
u_št8_t
 
¡»amIdTag
, 
BoŞ—n
 
»u£Fœ¡Sourû
,

42 
BoŞ—n
 
iF¿mesOÆy
, 
vshP”iod
)

43 : 
	`OnDemªdS”v”MedŸSub£ssiÚ
(
demux
.
	`’vœ
(), 
»u£Fœ¡Sourû
),

44 
	`fOurDemux
(
demux
), 
	`fSŒ—mIdTag
(
¡»amIdTag
),

45 
	`fIF¿mesOÆy
(
iF¿mesOÆy
), 
	$fVSHP”iod
(
vshP”iod
) {

46 
	}
}

48 
	gMPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
::~
	$MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
() {

49 
	}
}

51 
F¿medSourû
* 
MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ


52 ::
	$ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, & 
e¡B™¿‹
) {

53 
F¿medSourû
* 
es
 = 
NULL
;

55 
es
 = 
fOurDemux
.
	`ÃwEËm’rySŒ—m
(
ş›ÁSessiÚId
, 
fSŒ—mIdTag
);

56 ià(
es
 =ğ
NULL
) ;

58 ià((
fSŒ—mIdTag
&0xF0) == 0xC0 ) {

59 
e¡B™¿‹
 = 128;

60  
MPEG1Ü2AudioSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
es
);

61 } ià((
fSŒ—mIdTag
&0xF0) == 0xE0 ) {

62 
e¡B™¿‹
 = 500;

63  
MPEG1Ü2VideoSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
es
,

64 
fIF¿mesOÆy
, 
fVSHP”iod
);

65 } ià(
fSŒ—mIdTag
 == 0xBD ) {

66 
e¡B™¿‹
 = 192;

67  
AC3AudioSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
es
, 0x80);

74 
Medium
::
	`şo£
(
es
);

75  
NULL
;

76 
	}
}

78 
RTPSšk
* 
	gMPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ


79 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

80 
F¿medSourû
* 
šputSourû
) {

81 ià((
fSŒ—mIdTag
&0xF0) == 0xC0 ) {

82  
MPEG1Ü2AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

83 } ià((
fSŒ—mIdTag
&0xF0) == 0xE0 ) {

84  
MPEG1Ü2VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

85 } ià(
fSŒ—mIdTag
 == 0xBD ) {

87 
AC3AudioSŒ—mF¿m”
* 
audioSourû


88 ğ(
AC3AudioSŒ—mF¿m”
*)
šputSourû
;

89  
AC3AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

90 
audioSourû
->
	`§m¶šgR©e
());

92  
NULL
;

94 
	}
}

96 
	gMPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ


97 ::
	$£ekSŒ—mSourû
(
F¿medSourû
* 
šputSourû
, & 
£ekNPT
, , 
u_št64_t
& ) {

98 cÚ¡ 
dur
 = 
	`du¿tiÚ
();

99 cÚ¡ 
size
 = 
fOurDemux
.
	`feSize
();

100 
absBy‹Pos™iÚ
 = 
dur
 =ğ0.0 ? 0 : ()((
£ekNPT
/dur)*
size
);

104 ià((
fSŒ—mIdTag
&0xF0) == 0xC0 ) {

105 
MPEG1Ü2AudioSŒ—mF¿m”
* 
äam”
 = (MPEG1Ü2AudioSŒ—mF¿m”*)
šputSourû
;

106 
äam”
->
	`æushIÅut
();

107 } ià((
fSŒ—mIdTag
&0xF0) == 0xE0 ) {

108 
MPEG1Ü2VideoSŒ—mF¿m”
* 
äam”
 = (MPEG1Ü2VideoSŒ—mF¿m”*)
šputSourû
;

109 
äam”
->
	`æushIÅut
();

113 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
–emSŒ—mSourû


114 ğ(
MPEG1Ü2DemuxedEËm’rySŒ—m
*)(((
F¿medF‹r
*)
šputSourû
)->
	`šputSourû
());

117 
MPEG1Ü2Demux
& 
sourûDemux
 = 
–emSŒ—mSourû
->
	`sourûDemux
();

120 
sourûDemux
.
	`æushIÅut
();

123 
By‹SŒ—mFeSourû
* 
šputFeSourû


124 ğ(
By‹SŒ—mFeSourû
*)(
sourûDemux
.
	`šputSourû
());

129 
šputFeSourû
->
	`£ekToBy‹AbsŞu‹
(
absBy‹Pos™iÚ
);

130 
	}
}

132 
	gMPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
() const {

133  
fOurDemux
.
	`feDu¿tiÚ
();

134 
	}
}

	@liveMedia/MPEG1or2FileServerDemux.cpp

21 
	~"MPEG1Ü2FeS”v”Demux.hh
"

22 
	~"MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ.hh
"

23 
	~"By‹SŒ—mFeSourû.hh
"

25 
MPEG1Ü2FeS”v”Demux
*

26 
	gMPEG1Ü2FeS”v”Demux
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

27 
BoŞ—n
 
»u£Fœ¡Sourû
) {

28  
Ãw
 
	`MPEG1Ü2FeS”v”Demux
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

29 
	}
}

31 
MPEG1Ü2Prog¿mSŒ—mFeDu¿tiÚ
(
U§geEnvœÚm’t
& 
’v
,

32 cÚ¡* 
feName
,

33 & 
feSize
);

34 
	gMPEG1Ü2FeS”v”Demux


35 ::
	$MPEG1Ü2FeS”v”Demux
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

36 
BoŞ—n
 
»u£Fœ¡Sourû
)

37 : 
	`Medium
(
’v
),

38 
	`fReu£Fœ¡Sourû
(
»u£Fœ¡Sourû
),

39 
	`fSessiÚ0Demux
(
NULL
), 
	`fLa¡C»©edDemux
(NULL), 
	`fLa¡Cl›ÁSessiÚId
(~0) {

40 
fFeName
 = 
	`¡rDup
(
feName
);

41 
fFeDu¿tiÚ
 = 
	`MPEG1Ü2Prog¿mSŒ—mFeDu¿tiÚ
(
’v
, 
feName
, 
fFeSize
);

42 
	}
}

44 
	gMPEG1Ü2FeS”v”Demux
::~
	$MPEG1Ü2FeS”v”Demux
() {

45 
Medium
::
	`şo£
(
fSessiÚ0Demux
);

46 
d–‘e
[] (*)
fFeName
;

47 
	}
}

49 
S”v”MedŸSub£ssiÚ
*

50 
	gMPEG1Ü2FeS”v”Demux
::
	$ÃwAudioS”v”MedŸSub£ssiÚ
() {

51  
MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
this
, 0xC0, 
fReu£Fœ¡Sourû
);

52 
	}
}

54 
S”v”MedŸSub£ssiÚ
*

55 
	gMPEG1Ü2FeS”v”Demux
::
	$ÃwVideoS”v”MedŸSub£ssiÚ
(
BoŞ—n
 
iF¿mesOÆy
,

56 
vshP”iod
) {

57  
MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
this
, 0xE0, 
fReu£Fœ¡Sourû
,

58 
iF¿mesOÆy
, 
vshP”iod
);

59 
	}
}

61 
S”v”MedŸSub£ssiÚ
*

62 
	gMPEG1Ü2FeS”v”Demux
::
	$ÃwAC3AudioS”v”MedŸSub£ssiÚ
() {

63  
MPEG1Ü2DemuxedS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
this
, 0xBD, 
fReu£Fœ¡Sourû
);

65 
	}
}

67 
MPEG1Ü2DemuxedEËm’rySŒ—m
*

68 
	gMPEG1Ü2FeS”v”Demux
::
	$ÃwEËm’rySŒ—m
(
ş›ÁSessiÚId
,

69 
u_št8_t
 
¡»amIdTag
) {

70 
MPEG1Ü2Demux
* 
demuxToU£
;

71 ià(
ş›ÁSessiÚId
 == 0) {

78 ià(
fSessiÚ0Demux
 =ğ
NULL
) {

80 
By‹SŒ—mFeSourû
* 
feSourû


81 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

82 ià(
feSourû
 =ğ
NULL
)  NULL;

83 
fSessiÚ0Demux
 = 
MPEG1Ü2Demux
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
, 
F®£
 );

85 
demuxToU£
 = 
fSessiÚ0Demux
;

89 ià(
ş›ÁSessiÚId
 !ğ
fLa¡Cl›ÁSessiÚId
) {

91 
By‹SŒ—mFeSourû
* 
feSourû


92 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

93 ià(
feSourû
 =ğ
NULL
)  NULL;

95 
fLa¡C»©edDemux
 = 
MPEG1Ü2Demux
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
, 
True
);

98 
fLa¡Cl›ÁSessiÚId
 = 
ş›ÁSessiÚId
;

103 
demuxToU£
 = 
fLa¡C»©edDemux
;

106 ià(
demuxToU£
 =ğ
NULL
)  NULL;

108  
demuxToU£
->
	`ÃwEËm’rySŒ—m
(
¡»amIdTag
);

109 
	}
}

112 
BoŞ—n
 
g‘MPEG1Ü2TimeCode
(
F¿medSourû
* 
d©aSourû
,

113 
MPEG1Ü2Demux
& 
·»ÁDemux
,

114 
BoŞ—n
 
»tuºFœ¡S“nCode
,

115 & 
timeCode
);

117 
	$MPEG1Ü2Prog¿mSŒ—mFeDu¿tiÚ
(
U§geEnvœÚm’t
& 
’v
,

118 cÚ¡* 
feName
,

119 & 
feSize
) {

120 
F¿medSourû
* 
d©aSourû
 = 
NULL
;

121 
du¿tiÚ
 = 0.0;

122 
feSize
 = 0;

126 
By‹SŒ—mFeSourû
* 
feSourû
 = By‹SŒ—mFeSourû::
	`ü—‹New
(
’v
, 
feName
);

127 ià(
feSourû
 =ğ
NULL
) ;

128 
d©aSourû
 = 
feSourû
;

130 
feSize
 = ()(
feSourû
->
	`feSize
());

131 ià(
feSize
 == 0) ;

134 
MPEG1Ü2Demux
* 
ba£Demux
 = MPEG1Ü2Demux::
	`ü—‹New
(
’v
, 
d©aSourû
, 
True
);

135 ià(
ba£Demux
 =ğ
NULL
) ;

138 
d©aSourû
 = 
ba£Demux
->
	`ÃwRawPESSŒ—m
();

141 
fœ¡TimeCode
;

142 ià(!
	`g‘MPEG1Ü2TimeCode
(
d©aSourû
, *
ba£Demux
, 
True
, 
fœ¡TimeCode
)) ;

147 
ba£Demux
->
	`æushIÅut
();

148 cÚ¡ 
¡¬tBy‹FromEnd
 = 100000;

149 
ÃwFePos™iÚ


150 ğ
feSize
 < 
¡¬tBy‹FromEnd
 ? 0 : fileSize - startByteFromEnd;

151 ià(
ÃwFePos™iÚ
 > 0è
feSourû
->
	`£ekToBy‹AbsŞu‹
(newFilePosition);

153 
Ï¡TimeCode
;

154 ià(!
	`g‘MPEG1Ü2TimeCode
(
d©aSourû
, *
ba£Demux
, 
F®£
, 
Ï¡TimeCode
)) ;

157 
timeCodeDiff
 = 
Ï¡TimeCode
 - 
fœ¡TimeCode
;

158 ià(
timeCodeDiff
 < 0) ;

159 
du¿tiÚ
 = 
timeCodeDiff
;

162 
Medium
::
	`şo£
(
d©aSourû
);

163  
du¿tiÚ
;

164 
	}
}

166 
	#MFSD_DUMMY_SINK_BUFFER_SIZE
 (6+65535è

	)

168 şas 
	cMFSD_DummySšk
: 
public
 
MedŸSšk
 {

169 
public
:

170 
MFSD_DummySšk
(
MPEG1Ü2Demux
& 
demux
, 
BoŞ—n
 
»tuºFœ¡S“nCode
);

171 
	mvœtu®
 ~
MFSD_DummySšk
();

173 
	mw©chV¬ŸbË
;

175 
	m´iv©e
:

177 
vœtu®
 
BoŞ—n
 
cÚtšuePÏyšg
();

179 
	m´iv©e
:

180 
aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

181 
numTrunÿ‹dBy‹s
,

182 
timev®
 
´e£Á©iÚTime
,

183 
du¿tiÚInMiüo£cÚds
);

184 
aá”G‘tšgF¿me1
();

186 
	m´iv©e
:

187 
MPEG1Ü2Demux
& 
fOurDemux
;

188 
BoŞ—n
 
	mfR‘uºFœ¡S“nCode
;

189 
	mfBuf
[
MFSD_DUMMY_SINK_BUFFER_SIZE
];

192 
aá”PÏyšgMFSD_DummySšk
(
MFSD_DummySšk
* 
sšk
);

193 
compu‹SCRTimeCode
(
MPEG1Ü2Demux
::
SCR
 cÚ¡& 
sü
);

195 
BoŞ—n
 
	$g‘MPEG1Ü2TimeCode
(
F¿medSourû
* 
d©aSourû
,

196 
MPEG1Ü2Demux
& 
·»ÁDemux
,

197 
BoŞ—n
 
»tuºFœ¡S“nCode
,

198 & 
timeCode
) {

200 
·»ÁDemux
.
	`Ï¡S“nSCR
().
isV®id
 = 
F®£
;

201 
U§geEnvœÚm’t
& 
’v
 = 
d©aSourû
->
	`’vœ
();

202 
MFSD_DummySšk
 
	`sšk
(
·»ÁDemux
, 
»tuºFœ¡S“nCode
);

203 
sšk
.
	`¡¬tPÏyšg
(*
d©aSourû
,

204 (
MedŸSšk
::
aá”PÏyšgFunc
*)
aá”PÏyšgMFSD_DummySšk
, &
sšk
);

205 
’v
.
	`skScheduËr
().
	`doEv’tLoİ
(&
sšk
.
w©chV¬ŸbË
);

207 
timeCode
 = 
	`compu‹SCRTimeCode
(
·»ÁDemux
.
	`Ï¡S“nSCR
());

208  
·»ÁDemux
.
	`Ï¡S“nSCR
().
isV®id
;

209 
	}
}

214 
	gMFSD_DummySšk
::
	$MFSD_DummySšk
(
MPEG1Ü2Demux
& 
demux
, 
BoŞ—n
 
»tuºFœ¡S“nCode
)

215 : 
	`MedŸSšk
(
demux
.
	`’vœ
()),

216 
	`w©chV¬ŸbË
(0), 
	`fOurDemux
(
demux
), 
	$fR‘uºFœ¡S“nCode
(
»tuºFœ¡S“nCode
) {

217 
	}
}

219 
	gMFSD_DummySšk
::~
	$MFSD_DummySšk
() {

220 
	}
}

222 
BoŞ—n
 
MFSD_DummySšk
::
	$cÚtšuePÏyšg
() {

223 ià(
fSourû
 =ğ
NULL
è 
F®£
;

225 
fSourû
->
	`g‘NextF¿me
(
fBuf
,  fBuf,

226 
aá”G‘tšgF¿me
, 
this
,

227 
ÚSourûClosu»
, 
this
);

228  
True
;

229 
	}
}

231 
	gMFSD_DummySšk
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, ,

233 
timev®
 ,

235 
MFSD_DummySšk
* 
sšk
 = (MFSD_DummySšk*)
ş›ÁD©a
;

236 
sšk
->
	`aá”G‘tšgF¿me1
();

237 
	}
}

239 
	gMFSD_DummySšk
::
	$aá”G‘tšgF¿me1
() {

240 ià(
fR‘uºFœ¡S“nCode
 && 
fOurDemux
.
	`Ï¡S“nSCR
().
isV®id
) {

243 
	`ÚSourûClosu»
();

247 
	`cÚtšuePÏyšg
();

248 
	}
}

250 
	$aá”PÏyšgMFSD_DummySšk
(
MFSD_DummySšk
* 
sšk
) {

252 
sšk
->
w©chV¬ŸbË
 = ~0;

253 
	}
}

255 
compu‹SCRTimeCode
(
MPEG1Ü2Demux
::
SCR
 cÚ¡& 
sü
) {

256 
»suÉ
 = 
sü
.
»maššgB™s
/90000.0 + sü.
ex‹nsiÚ
/300.0;

257 ià(
	gsü
.
	ghighB™
) {

259 cÚ¡ 
	ghighB™V®ue
 = (256*1024*1024)/5625.0;

260 
	g»suÉ
 +ğ
highB™V®ue
;

263  ()
	g»suÉ
;

	@liveMedia/MPEG1or2VideoFileServerMediaSubsession.cpp

22 
	~"MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"MPEG1Ü2VideoRTPSšk.hh
"

24 
	~"By‹SŒ—mFeSourû.hh
"

25 
	~"MPEG1Ü2VideoSŒ—mF¿m”.hh
"

27 
MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ
*

28 
	gMPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

29 cÚ¡* 
feName
,

30 
BoŞ—n
 
»u£Fœ¡Sourû
,

31 
BoŞ—n
 
iF¿mesOÆy
,

32 
vshP”iod
) {

33  
Ãw
 
	`MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
,

34 
iF¿mesOÆy
, 
vshP”iod
);

35 
	}
}

37 
	gMPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ


38 ::
	$MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

39 cÚ¡* 
feName
,

40 
BoŞ—n
 
»u£Fœ¡Sourû
,

41 
BoŞ—n
 
iF¿mesOÆy
,

42 
vshP”iod
)

43 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

44 
	`fIF¿mesOÆy
(
iF¿mesOÆy
), 
	$fVSHP”iod
(
vshP”iod
) {

45 
	}
}

47 
	gMPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ


48 ::~
	$MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ
() {

49 
	}
}

51 
F¿medSourû
* 
MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ


52 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

53 
e¡B™¿‹
 = 500;

55 
By‹SŒ—mFeSourû
* 
feSourû


56 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

57 ià(
feSourû
 =ğ
NULL
)  NULL;

58 
fFeSize
 = 
feSourû
->
	`feSize
();

60  
MPEG1Ü2VideoSŒ—mF¿m”


61 ::
	`ü—‹New
(
	`’vœ
(), 
feSourû
, 
fIF¿mesOÆy
, 
fVSHP”iod
);

62 
	}
}

64 
RTPSšk
* 
	gMPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ


65 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

67 
F¿medSourû
* ) {

68  
MPEG1Ü2VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

69 
	}
}

	@liveMedia/MPEG1or2VideoRTPSink.cpp

21 
	~"MPEG1Ü2VideoRTPSšk.hh
"

22 
	~"MPEG1Ü2VideoSŒ—mF¿m”.hh
"

24 
	gMPEG1Ü2VideoRTPSšk
::
	$MPEG1Ü2VideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
)

25 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 32, 90000, "MPV") {

26 
fPiùu»S‹
.
‹mpÜ®_»ã»nû
 = 0;

27 
fPiùu»S‹
.
piùu»_codšg_ty³
 = fPiùu»S‹.
veùÜ_code_b™s
 = 0;

28 
	}
}

30 
	gMPEG1Ü2VideoRTPSšk
::~
	$MPEG1Ü2VideoRTPSšk
() {

31 
	}
}

33 
MPEG1Ü2VideoRTPSšk
*

34 
MPEG1Ü2VideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
) {

35  
Ãw
 
	`MPEG1Ü2VideoRTPSšk
(
’v
, 
RTPgs
);

36 
	}
}

38 
BoŞ—n
 
	gMPEG1Ü2VideoRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

40  
sourû
.
	`isMPEG1Ü2VideoSŒ—mF¿m”
();

41 
	}
}

43 
BoŞ—n
 
	gMPEG1Ü2VideoRTPSšk
::
	$®lowF¿gm’tiÚAá”S¹
() const {

44  
True
;

45 
	}
}

47 
BoŞ—n
 
	gMPEG1Ü2VideoRTPSšk


48 ::
	$äameCªAµ—rAá”Pack‘S¹
(cÚ¡* 
äameS¹
,

49 
numBy‹sInF¿me
) const {

55 ià(!
fP»viousF¿meWasSliû
è 
True
;

59  
numBy‹sInF¿me
 >= 4

60 && 
äameS¹
[0] == 0 && frameStart[1] == 0 && frameStart[2] == 1

61 && 
äameS¹
[3] >= 1 && frameStart[3] <= 0xAF;

62 
	}
}

64 
	#VIDEO_SEQUENCE_HEADER_START_CODE
 0x000001B3

	)

65 
	#PICTURE_START_CODE
 0x00000100

	)

67 
	gMPEG1Ü2VideoRTPSšk


68 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

69 * 
äameS¹
,

70 
numBy‹sInF¿me
,

71 
timev®
 
äameP»£Á©iÚTime
,

72 
numRemaššgBy‹s
) {

73 
BoŞ—n
 
thisF¿meIsASliû
 = 
F®£
;

74 ià(
	`isFœ¡F¿meInPack‘
()) {

75 
fSequ’ûH—d”P»£Á
 = 
fPack‘BegšsSliû
 = 
fPack‘EndsSliû
 = 
F®£
;

78 ià(
äagm’tiÚOff£t
 == 0) {

80 ià(
numBy‹sInF¿me
 < 4) ;

81 
¡¬tCode
 = (
äameS¹
[0]<<24) | (frameStart[1]<<16)

82 | (
äameS¹
[2]<<8) | frameStart[3];

84 ià(
¡¬tCode
 =ğ
VIDEO_SEQUENCE_HEADER_START_CODE
) {

86 
fSequ’ûH—d”P»£Á
 = 
True
;

87 } ià(
¡¬tCode
 =ğ
PICTURE_START_CODE
) {

91 ià(
numBy‹sInF¿me
 < 8) ;

92 
Ãxt4By‹s
 = (
äameS¹
[4]<<24) | (frameStart[5]<<16)

93 | (
äameS¹
[6]<<8) | frameStart[7];

94 
by‹8
 = 
numBy‹sInF¿me
 =ğ8 ? 0 : 
äameS¹
[8];

96 
fPiùu»S‹
.
‹mpÜ®_»ã»nû
 = (
Ãxt4By‹s
&0xFFC00000)>>(32-10);

97 
fPiùu»S‹
.
piùu»_codšg_ty³
 = (
Ãxt4By‹s
&0x00380000)>>(32-(10+3));

99 
FBV
, 
BFC
, 
FFV
, 
FFC
;

100 
FBV
 = 
BFC
 = 
FFV
 = 
FFC
 = 0;

101 
fPiùu»S‹
.
piùu»_codšg_ty³
) {

103 
FBV
 = (
by‹8
&0x40)>>6;

104 
BFC
 = (
by‹8
&0x38)>>3;

107 
FFV
 = (
Ãxt4By‹s
&0x00000004)>>2;

108 
FFC
 = ((
Ãxt4By‹s
&0x00000003)<<1è| ((
by‹8
&0x80)>>7);

111 
fPiùu»S‹
.
veùÜ_code_b™s
 = (
FBV
<<7è| (
BFC
<<4è| (
FFV
<<3è| 
FFC
;

112 } ià((
¡¬tCode
&0xFFFFFF00) == 0x00000100) {

113 
Ï¡CodeBy‹
 = 
¡¬tCode
&0xFF;

115 ià(
Ï¡CodeBy‹
 <= 0xAF) {

117 
thisF¿meIsASliû
 = 
True
;

123 
	`’vœ
() << "Warning: MPEG1or2VideoRTPSink::doSpecialFrameHandling saw strange first 4 bytes "

124 << (*)
¡¬tCode
 << ", but we're‚ot‡ fragment\n";

128 
thisF¿meIsASliû
 = 
True
;

131 ià(
thisF¿meIsASliû
) {

133 
fPack‘BegšsSliû
 = (
äagm’tiÚOff£t
 == 0);

136 
fPack‘EndsSliû
 = (
numRemaššgBy‹s
 == 0);

144 
videoS³cificH—d”
 =

146 (
fPiùu»S‹
.
‹mpÜ®_»ã»nû
<<16) |

148 (
fSequ’ûH—d”P»£Á
<<13) |

149 (
fPack‘BegšsSliû
<<12) |

150 (
fPack‘EndsSliû
<<11) |

151 (
fPiùu»S‹
.
piùu»_codšg_ty³
<<8) |

152 
fPiùu»S‹
.
veùÜ_code_b™s
;

153 
	`£tS³cŸlH—d”WÜd
(
videoS³cificH—d”
);

157 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

162 
MPEG1Ü2VideoSŒ—mF¿m”
* 
äam”Sourû
 = (MPEG1Ü2VideoSŒ—mF¿m”*)
fSourû
;

163 ià(
äam”Sourû
 !ğ
NULL
 && f¿m”Sourû->
	`piùu»EndM¬k”
()

164 && 
numRemaššgBy‹s
 == 0) {

165 
	`£tM¬k”B™
();

166 
äam”Sourû
->
	`piùu»EndM¬k”
(èğ
F®£
;

169 
fP»viousF¿meWasSliû
 = 
thisF¿meIsASliû
;

170 
	}
}

172 
	gMPEG1Ü2VideoRTPSšk
::
	$¥ecŸlH—d”Size
() const {

175 
	}
}

	@liveMedia/MPEG1or2VideoRTPSource.cpp

21 
	~"MPEG1Ü2VideoRTPSourû.hh
"

23 
MPEG1Ü2VideoRTPSourû
*

24 
	gMPEG1Ü2VideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
¹pTime¡ampF»qu’cy
) {

27  
Ãw
 
	`MPEG1Ü2VideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

28 
¹pTime¡ampF»qu’cy
);

29 
	}
}

31 
	gMPEG1Ü2VideoRTPSourû
::
	$MPEG1Ü2VideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

32 
Groupsock
* 
RTPgs
,

33 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
)

35 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

36 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
){

37 
	}
}

39 
	gMPEG1Ü2VideoRTPSourû
::~
	$MPEG1Ü2VideoRTPSourû
() {

40 
	}
}

42 
BoŞ—n
 
MPEG1Ü2VideoRTPSourû


43 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

44 & 
»suÉS³cŸlH—d”Size
) {

46 ià(
·ck‘
->
	`d©aSize
(è< 4è 
F®£
;

48 
u_št32_t
 
h—d”
 = 
	`Áohl
(*(u_št32_t*)(
·ck‘
->
	`d©a
()));

50 
u_št32_t
 
sB™
 = 
h—d”
&0x00002000;

51 
u_št32_t
 
bB™
 = 
h—d”
&0x00001000;

52 
u_št32_t
 
eB™
 = 
h—d”
&0x00000800;

54 
fCu¼’tPack‘BegšsF¿me
 = (
sB™
|
bB™
) != 0;

55 
fCu¼’tPack‘Com¶‘esF¿me
 = ((
sB™
 !ğ0è&& (
bB™
 =ğ0)è|| (
eB™
 != 0);

57 
»suÉS³cŸlH—d”Size
 = 4;

58  
True
;

59 
	}
}

61 
BoŞ—n
 
	gMPEG1Ü2VideoRTPSourû


62 ::
	$·ck‘IsU§bËInJ™‹rC®cuÏtiÚ
(* 
·ck‘
,

63 
·ck‘Size
) {

65 ià(
·ck‘Size
 < 4è 
F®£
;

69 
h—d”
 = 
	`Áohl
(*(
u_št32_t
*)
·ck‘
);

71 
piùu»Ty³
 = (
h—d”
>>8)&0x7;

72 ià(
piùu»Ty³
 == 1) {

73  
True
;

75  
F®£
;

77 
	}
}

79 cÚ¡* 
	gMPEG1Ü2VideoRTPSourû
::
	$MIMEty³
() const {

81 
	}
}

	@liveMedia/MPEG1or2VideoStreamDiscreteFramer.cpp

24 
	~"MPEG1Ü2VideoSŒ—mDisü‘eF¿m”.hh
"

26 
MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
*

27 
	gMPEG1Ü2VideoSŒ—mDisü‘eF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

28 
F¿medSourû
* 
šputSourû
,

29 
BoŞ—n
 
iF¿mesOÆy
,

30 
vshP”iod
,

31 
BoŞ—n
 
ËaveP»£Á©iÚTimesUnmodif›d
) {

33  
Ãw
 
	`MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
(
’v
, 
šputSourû
,

34 
iF¿mesOÆy
, 
vshP”iod
, 
ËaveP»£Á©iÚTimesUnmodif›d
);

35 
	}
}

37 
	gMPEG1Ü2VideoSŒ—mDisü‘eF¿m”


38 ::
	$MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
(
U§geEnvœÚm’t
& 
’v
,

39 
F¿medSourû
* 
šputSourû
,

40 
BoŞ—n
 
iF¿mesOÆy
, 
vshP”iod
, BoŞ—À
ËaveP»£Á©iÚTimesUnmodif›d
)

41 : 
	`MPEG1Ü2VideoSŒ—mF¿m”
(
’v
, 
šputSourû
, 
iF¿mesOÆy
, 
vshP”iod
,

42 
F®£
 ),

43 
	`fL—veP»£Á©iÚTimesUnmodif›d
(
ËaveP»£Á©iÚTimesUnmodif›d
),

44 
	`fLa¡NÚBF¿meTempÜ®_»ã»nû
(0),

45 
	`fSavedVSHSize
(0), 
	`fSavedVSHTime¡amp
(0.0),

46 
	`fIF¿mesOÆy
(
iF¿mesOÆy
), 
	$fVSHP”iod
(
vshP”iod
) {

47 
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_£c
 = 0;

48 
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_u£c
 = 0;

49 
	}
}

51 
	gMPEG1Ü2VideoSŒ—mDisü‘eF¿m”
::~
	$MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
() {

52 
	}
}

54 
MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
::
	$doG‘NextF¿me
() {

58 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

59 
aá”G‘tšgF¿me
, 
this
,

60 
F¿medSourû
::
hªdËClosu»
, 
this
);

61 
	}
}

63 
	gMPEG1Ü2VideoSŒ—mDisü‘eF¿m”


64 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

65 
numTrunÿ‹dBy‹s
,

66 
timev®
 
´e£Á©iÚTime
,

67 
du¿tiÚInMiüo£cÚds
) {

68 
MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
* 
sourû


69 ğ(
MPEG1Ü2VideoSŒ—mDisü‘eF¿m”
*)
ş›ÁD©a
;

70 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

71 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

72 
	}
}

74 cÚ¡ 
	gäameR©eFromCode
[] = {

93 
	#MILLION
 1000000

	)

95 
	gMPEG1Ü2VideoSŒ—mDisü‘eF¿m”


96 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

97 
timev®
 
´e£Á©iÚTime
,

98 
du¿tiÚInMiüo£cÚds
) {

100 ià(
äameSize
 >ğ4 && 
fTo
[0] == 0 && fTo[1] == 0 && fTo[2] == 1) {

101 
fPiùu»EndM¬k”
 = 
True
;

103 
u_št8_t
 
ÃxtCode
 = 
fTo
[3];

104 ià(
ÃxtCode
 == 0xB3) {

106 ià(
äameSize
 >= 8) {

107 
u_št8_t
 
äame_¿‹_code
 = 
fTo
[7]&0x0F;

108 
fF¿meR©e
 = 
äameR©eFromCode
[
äame_¿‹_code
];

113 
vshSize
;

114 
vshSize
 = 4; vshSiz< 
äameSize
-3; ++vshSize) {

115 ià(
fTo
[
vshSize
] == 0 && fTo[vshSize+1] == 0 && fTo[vshSize+2] == 1 &&

116 (
fTo
[
vshSize
+3] == 0xB8 || fTo[vshSize+3] == 0x00)) ;

118 ià(
vshSize
 =ğ
äameSize
-3) vshSize = frameSize;

119 ià(
vshSize
 <ğ 
fSavedVSHBufãr
) {

120 
	`memmove
(
fSavedVSHBufãr
, 
fTo
, 
vshSize
);

121 
fSavedVSHSize
 = 
vshSize
;

122 
fSavedVSHTime¡amp


123 ğ
´e£Á©iÚTime
.
tv_£c
 +…»£Á©iÚTime.
tv_u£c
/()
MILLION
;

125 } ià(
ÃxtCode
 == 0xB8) {

127 
±s
 = 
´e£Á©iÚTime
.
tv_£c
 +…»£Á©iÚTime.
tv_u£c
/()
MILLION
;

128 ià(
±s
 > 
fSavedVSHTime¡amp
 + 
fVSHP”iod
 &&

129 
fSavedVSHSize
 + 
äameSize
 <ğ
fMaxSize
) {

130 
	`memmove
(&
fTo
[
fSavedVSHSize
], &fTo[0], 
äameSize
);

131 
	`memmove
(&
fTo
[0], 
fSavedVSHBufãr
, 
fSavedVSHSize
);

132 
äameSize
 +ğ
fSavedVSHSize
;

133 
fSavedVSHTime¡amp
 = 
±s
;

137 
i
 = 3;

138 ià(
ÃxtCode
 == 0xB3 ||

139 
ÃxtCode
 == 0xB8 ) {

141 
i
 +ğ4; i < 
äameSize
; ++i) {

142 ià(
fTo
[
i
] == 0x00

143 && 
fTo
[
i
-1] == 1 && fTo[i-2] == 0 && fTo[i-3] == 0) {

144 
ÃxtCode
 = 
fTo
[
i
];

150 ià(
ÃxtCode
 =ğ0x00 && 
i
+2 < 
äameSize
) {

153 ++
i
;

154 
‹mpÜ®_»ã»nû
 = (
fTo
[
i
]<<2)|(fTo[i+1]>>6);

155 
piùu»_codšg_ty³
 = (
fTo
[
i
+1]&0x38)>>3;

158 ià(
fIF¿mesOÆy
 && 
piùu»_codšg_ty³
 != 1) {

159 
	`doG‘NextF¿me
();

164 ià(!
fL—veP»£Á©iÚTimesUnmodif›d
 && 
piùu»_codšg_ty³
 == 3

165 && (
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_u£c
 > 0 ||

166 
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_£c
 > 0)) {

167 
ŒInüem’t


168 ğ
fLa¡NÚBF¿meTempÜ®_»ã»nû
 - 
‹mpÜ®_»ã»nû
;

169 ià(
ŒInüem’t
 < 0)rIncrement += 1024;

171 
usInüem’t
 = 
fF¿meR©e
 == 0.0 ? 0

172 : ()((
ŒInüem’t
*
MILLION
)/
fF¿meR©e
);

173 
£cÚdsToSubŒaù
 = 
usInüem’t
/
MILLION
;

174 
uSecÚdsToSubŒaù
 = 
usInüem’t
%
MILLION
;

176 
´e£Á©iÚTime
 = 
fLa¡NÚBF¿meP»£Á©iÚTime
;

177 ià(()
´e£Á©iÚTime
.
tv_u£c
 < 
uSecÚdsToSubŒaù
) {

178 
´e£Á©iÚTime
.
tv_u£c
 +ğ
MILLION
;

179 ià(
´e£Á©iÚTime
.
tv_£c
 > 0) --presentationTime.tv_sec;

181 
´e£Á©iÚTime
.
tv_u£c
 -ğ
uSecÚdsToSubŒaù
;

182 ià(()
´e£Á©iÚTime
.
tv_£c
 > 
£cÚdsToSubŒaù
) {

183 
´e£Á©iÚTime
.
tv_£c
 -ğ
£cÚdsToSubŒaù
;

185 
´e£Á©iÚTime
.
tv_£c
 =…»£Á©iÚTime.
tv_u£c
 = 0;

188 
fLa¡NÚBF¿meP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

189 
fLa¡NÚBF¿meTempÜ®_»ã»nû
 = 
‹mpÜ®_»ã»nû
;

198 
fF¿meSize
 = 
äameSize
;

199 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

200 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

201 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

202 
	`aá”G‘tšg
(
this
);

203 
	}
}

	@liveMedia/MPEG1or2VideoStreamFramer.cpp

22 
	~"MPEG1Ü2VideoSŒ—mF¿m”.hh
"

23 
	~"MPEGVideoSŒ—mP¬£r.hh
"

24 
	~<¡ršg.h
>

29 
	eMPEGP¬£S‹
 {

30 
	mPARSING_VIDEO_SEQUENCE_HEADER
,

31 
	mPARSING_VIDEO_SEQUENCE_HEADER_SEEN_CODE
,

32 
	mPARSING_GOP_HEADER
,

33 
	mPARSING_GOP_HEADER_SEEN_CODE
,

34 
	mPARSING_PICTURE_HEADER
,

35 
	mPARSING_SLICE


38 
	#VSH_MAX_SIZE
 1000

	)

40 şas 
	cMPEG1Ü2VideoSŒ—mP¬£r
: 
public
 
MPEGVideoSŒ—mP¬£r
 {

41 
public
:

42 
MPEG1Ü2VideoSŒ—mP¬£r
(
MPEG1Ü2VideoSŒ—mF¿m”
* 
usšgSourû
,

43 
F¿medSourû
* 
šputSourû
,

44 
BoŞ—n
 
iF¿mesOÆy
, 
vshP”iod
);

45 
	mvœtu®
 ~
MPEG1Ü2VideoSŒ—mP¬£r
();

47 
	m´iv©e
:

48 
vœtu®
 
æushIÅut
();

49 
vœtu®
 
·r£
();

51 
	m´iv©e
:

52 
»£t
();

54 
MPEG1Ü2VideoSŒ—mF¿m”
* 
	$usšgSourû
() {

55  (
MPEG1Ü2VideoSŒ—mF¿m”
*)
fUsšgSourû
;

57 
	`£tP¬£S‹
(
MPEGP¬£S‹
 
·r£S‹
);

59 
	`·r£VideoSequ’ûH—d”
(
BoŞ—n
 
haveS“nS¹Code
);

60 
	`·r£GOPH—d”
(
BoŞ—n
 
haveS“nS¹Code
);

61 
	`·r£Piùu»H—d”
();

62 
	`·r£Sliû
();

64 
´iv©e
:

65 
MPEGP¬£S‹
 
fCu¼’tP¬£S‹
;

66 
fPiùu»sSšûLa¡GOP
;

68 
fCurPicTempÜ®Reã»nû
;

70 
fCu¼’tSliûNumb”
;

74 
fSavedVSHBufãr
[
VSH_MAX_SIZE
];

75 
fSavedVSHSize
;

76 
fSavedVSHTime¡amp
;

77 
fVSHP”iod
;

78 
BoŞ—n
 
fIF¿mesOÆy
, 
fSkpšgCu¼’tPiùu»
;

80 
	`§veCu¼’tVSH
();

81 
BoŞ—n
 
	`ÃedToU£SavedVSH
();

82 
	`u£SavedVSH
();

83 
	}
};

88 
	gMPEG1Ü2VideoSŒ—mF¿m”
::
	$MPEG1Ü2VideoSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
,

89 
F¿medSourû
* 
šputSourû
,

90 
BoŞ—n
 
iF¿mesOÆy
,

91 
vshP”iod
,

92 
BoŞ—n
 
ü—‹P¬£r
)

93 : 
	$MPEGVideoSŒ—mF¿m”
(
’v
, 
šputSourû
) {

94 
fP¬£r
 = 
ü—‹P¬£r


95 ? 
Ãw
 
	`MPEG1Ü2VideoSŒ—mP¬£r
(
this
, 
šputSourû
,

96 
iF¿mesOÆy
, 
vshP”iod
)

97 : 
NULL
;

98 
	}
}

100 
	gMPEG1Ü2VideoSŒ—mF¿m”
::~
	$MPEG1Ü2VideoSŒ—mF¿m”
() {

101 
	}
}

103 
MPEG1Ü2VideoSŒ—mF¿m”
*

104 
MPEG1Ü2VideoSŒ—mF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

105 
F¿medSourû
* 
šputSourû
,

106 
BoŞ—n
 
iF¿mesOÆy
,

107 
vshP”iod
) {

109  
Ãw
 
	`MPEG1Ü2VideoSŒ—mF¿m”
(
’v
, 
šputSourû
, 
iF¿mesOÆy
, 
vshP”iod
);

110 
	}
}

112 
	gMPEG1Ü2VideoSŒ—mF¿m”
::
	$g‘Cu¼’tPTS
() const {

113  
fP»£Á©iÚTime
.
tv_£c
 + fP»£Á©iÚTime.
tv_u£c
/1000000.0;

114 
	}
}

116 
BoŞ—n
 
	gMPEG1Ü2VideoSŒ—mF¿m”
::
	$isMPEG1Ü2VideoSŒ—mF¿m”
() const {

117  
True
;

118 
	}
}

122 
	gMPEG1Ü2VideoSŒ—mP¬£r


123 ::
	$MPEG1Ü2VideoSŒ—mP¬£r
(
MPEG1Ü2VideoSŒ—mF¿m”
* 
usšgSourû
,

124 
F¿medSourû
* 
šputSourû
,

125 
BoŞ—n
 
iF¿mesOÆy
, 
vshP”iod
)

126 : 
	`MPEGVideoSŒ—mP¬£r
(
usšgSourû
, 
šputSourû
),

127 
	`fCu¼’tP¬£S‹
(
PARSING_VIDEO_SEQUENCE_HEADER
),

128 
	`fVSHP”iod
(
vshP”iod
), 
	$fIF¿mesOÆy
(
iF¿mesOÆy
) {

129 
	`»£t
();

130 
	}
}

132 
	gMPEG1Ü2VideoSŒ—mP¬£r
::~
	$MPEG1Ü2VideoSŒ—mP¬£r
() {

133 
	}
}

135 
MPEG1Ü2VideoSŒ—mP¬£r
::
	$£tP¬£S‹
(
MPEGP¬£S‹
 
·r£S‹
) {

136 
fCu¼’tP¬£S‹
 = 
·r£S‹
;

137 
MPEGVideoSŒ—mP¬£r
::
	`£tP¬£S‹
();

138 
	}
}

140 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$»£t
() {

141 
fPiùu»sSšûLa¡GOP
 = 0;

142 
fCurPicTempÜ®Reã»nû
 = 0;

143 
fCu¼’tSliûNumb”
 = 0;

144 
fSavedVSHSize
 = 0;

145 
fSkpšgCu¼’tPiùu»
 = 
F®£
;

146 
	}
}

148 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$æushIÅut
() {

149 
	`»£t
();

150 
SŒ—mP¬£r
::
	`æushIÅut
();

151 ià(
fCu¼’tP¬£S‹
 !ğ
PARSING_VIDEO_SEQUENCE_HEADER
) {

152 
	`£tP¬£S‹
(
PARSING_GOP_HEADER
);

154 
	}
}

156 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$·r£
() {

157 
Œy
 {

158 
fCu¼’tP¬£S‹
) {

159 
PARSING_VIDEO_SEQUENCE_HEADER
: {

160  
	`·r£VideoSequ’ûH—d”
(
F®£
);

162 
PARSING_VIDEO_SEQUENCE_HEADER_SEEN_CODE
: {

163  
	`·r£VideoSequ’ûH—d”
(
True
);

165 
PARSING_GOP_HEADER
: {

166  
	`·r£GOPH—d”
(
F®£
);

168 
PARSING_GOP_HEADER_SEEN_CODE
: {

169  
	`·r£GOPH—d”
(
True
);

171 
PARSING_PICTURE_HEADER
: {

172  
	`·r£Piùu»H—d”
();

174 
PARSING_SLICE
: {

175  
	`·r£Sliû
();

181 } 
	`ÿtch
 () {

182 #ifdeà
DEBUG


183 
	`årštf
(
¡d”r
, "MPEG1or2VideoStreamParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

187 
	}
}

189 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$§veCu¼’tVSH
() {

190 
äameSize
 = 
	`curF¿meSize
();

191 ià(
äameSize
 >  
fSavedVSHBufãr
) ;

193 
	`memmove
(
fSavedVSHBufãr
, 
fS¹OfF¿me
, 
äameSize
);

194 
fSavedVSHSize
 = 
äameSize
;

195 
fSavedVSHTime¡amp
 = 
	`usšgSourû
()->
	`g‘Cu¼’tPTS
();

196 
	}
}

198 
BoŞ—n
 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$ÃedToU£SavedVSH
() {

199  
	`usšgSourû
()->
	`g‘Cu¼’tPTS
(è> 
fSavedVSHTime¡amp
+
fVSHP”iod


200 && 
fSavedVSHSize
 > 0;

201 
	}
}

203 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$u£SavedVSH
() {

204 
by‹sToU£
 = 
fSavedVSHSize
;

205 
maxBy‹sToU£
 = 
fLim™
 - 
fS¹OfF¿me
;

206 ià(
by‹sToU£
 > 
maxBy‹sToU£
) bytesToUse = maxBytesToUse;

208 
	`memmove
(
fS¹OfF¿me
, 
fSavedVSHBufãr
, 
by‹sToU£
);

211 
fSavedVSHTime¡amp
 = 
	`usšgSourû
()->
	`g‘Cu¼’tPTS
();

213 #ifdeà
DEBUG


214 
	`årštf
(
¡d”r
, "u£d saved video_£qu’û_h—d” (%d by‹s)\n", 
by‹sToU£
);

216  
by‹sToU£
;

217 
	}
}

219 
	#VIDEO_SEQUENCE_HEADER_START_CODE
 0x000001B3

	)

220 
	#GROUP_START_CODE
 0x000001B8

	)

221 
	#PICTURE_START_CODE
 0x00000100

	)

222 
	#SEQUENCE_END_CODE
 0x000001B7

	)

224 cÚ¡ 
	gäameR©eFromCode
[] = {

243 
	gMPEG1Ü2VideoSŒ—mP¬£r


244 ::
	$·r£VideoSequ’ûH—d”
(
BoŞ—n
 
haveS“nS¹Code
) {

245 #ifdeà
DEBUG


246 
	`årštf
(
¡d”r
, "parsing video sequence header\n");

248 
fœ¡4By‹s
;

249 ià(!
haveS“nS¹Code
) {

250 (
fœ¡4By‹s
 = 
	`‹¡4By‹s
()è!ğ
VIDEO_SEQUENCE_HEADER_START_CODE
) {

251 #ifdeà
DEBUG


252 
	`årštf
(
¡d”r
, "ignÜšg‚Ú videØ£qu’û h—d”: 0x%08x\n", 
fœ¡4By‹s
);

254 
	`g‘1By‹
(); 
	`£tP¬£S‹
(
PARSING_VIDEO_SEQUENCE_HEADER
);

257 
fœ¡4By‹s
 = 
	`g‘4By‹s
();

260 
fœ¡4By‹s
 = 
VIDEO_SEQUENCE_HEADER_START_CODE
;

262 
	`§ve4By‹s
(
fœ¡4By‹s
);

265 
·¿mWÜd1
 = 
	`g‘4By‹s
();

266 
	`§ve4By‹s
(
·¿mWÜd1
);

267 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

268 #ifdeà
DEBUG


269 
hÜizÚl_size_v®ue
 = (
·¿mWÜd1
&0xFFF00000)>>(32-12);

270 
v”tiÿl_size_v®ue
 = (
·¿mWÜd1
&0x000FFF00)>>8;

271 
a¥eù_¿tio_šfÜm©iÚ
 = (
·¿mWÜd1
&0x000000F0)>>4;

273 
äame_¿‹_code
 = (
·¿mWÜd1
&0x0000000F);

274 
	`usšgSourû
()->
fF¿meR©e
 = 
äameR©eFromCode
[
äame_¿‹_code
];

275 #ifdeà
DEBUG


276 
b™_¿‹_v®ue
 = (
Ãxt4By‹s
&0xFFFFC000)>>(32-18);

277 
vbv_bufãr_size_v®ue
 = (
Ãxt4By‹s
&0x00001FF8)>>3;

278 
	`årštf
(
¡d”r
, "hÜizÚl_size_v®ue: %d, v”tiÿl_size_v®ue: %d,‡¥eù_¿tio_šfÜm©iÚ: %d, f¿me_¿‹_code: %d (=>%àås), b™_¿‹_v®ue: %d (=>%d bps), vbv_bufãr_size_v®ue: %d\n", 
hÜizÚl_size_v®ue
, 
v”tiÿl_size_v®ue
, 
a¥eù_¿tio_šfÜm©iÚ
, 
äame_¿‹_code
, 
	`usšgSourû
()->
fF¿meR©e
, 
b™_¿‹_v®ue
, b™_¿‹_v®ue*400, 
vbv_bufãr_size_v®ue
);

284 
	`§veToNextCode
(
Ãxt4By‹s
);

285 } 
Ãxt4By‹s
 !ğ
GROUP_START_CODE
 &&‚ext4By‹ !ğ
PICTURE_START_CODE
);

287 
	`£tP¬£S‹
((
Ãxt4By‹s
 =ğ
GROUP_START_CODE
)

288 ? 
PARSING_GOP_HEADER_SEEN_CODE
 : 
PARSING_PICTURE_HEADER
);

292 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fPiùu»sSšûLa¡GOP
);

296 
	`§veCu¼’tVSH
();

298  
	`curF¿meSize
();

299 
	}
}

301 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$·r£GOPH—d”
(
BoŞ—n
 
haveS“nS¹Code
) {

304 ià(
	`ÃedToU£SavedVSH
()è 
	`u£SavedVSH
();

306 #ifdeà
DEBUG


307 
	`årštf
(
¡d”r
, "parsing GOP header\n");

309 
fœ¡4By‹s
;

310 ià(!
haveS“nS¹Code
) {

311 (
fœ¡4By‹s
 = 
	`‹¡4By‹s
()è!ğ
GROUP_START_CODE
) {

312 #ifdeà
DEBUG


313 
	`årštf
(
¡d”r
, "ignÜšg‚Ú GOP s¹ code: 0x%08x\n", 
fœ¡4By‹s
);

315 
	`g‘1By‹
(); 
	`£tP¬£S‹
(
PARSING_GOP_HEADER
);

318 
fœ¡4By‹s
 = 
	`g‘4By‹s
();

321 
fœ¡4By‹s
 = 
GROUP_START_CODE
;

323 
	`§ve4By‹s
(
fœ¡4By‹s
);

326 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

327 
time_code
 = (
Ãxt4By‹s
&0xFFFFFF80)>>(32-25);

328 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_TIMESTAMPS
)

329 
BoŞ—n
 
drİ_äame_æag
 = (
time_code
&0x01000000) != 0;

331 
time_code_hours
 = (
time_code
&0x00F80000)>>19;

332 
time_code_mšu‹s
 = (
time_code
&0x0007E000)>>13;

333 
time_code_£cÚds
 = (
time_code
&0x00000FC0)>>6;

334 
time_code_piùu»s
 = (
time_code
&0x0000003F);

335 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_TIMESTAMPS
)

336 
	`årštf
(
¡d”r
, "time_code: 0x%07x, drİ_äam%d, hour %d, mšu‹ %d, secÚd %d,…iùu» %d\n", 
time_code
, 
drİ_äame_æag
, 
time_code_hours
, 
time_code_mšu‹s
, 
time_code_£cÚds
, 
time_code_piùu»s
);

338 #ifdeà
DEBUG


339 
BoŞ—n
 
şo£d_gİ
 = (
Ãxt4By‹s
&0x00000040) != 0;

340 
BoŞ—n
 
brok’_lšk
 = (
Ãxt4By‹s
&0x00000020) != 0;

341 
	`årštf
(
¡d”r
, "şo£d_gİ: %d, brok’_lšk: %d\n", 
şo£d_gİ
, 
brok’_lšk
);

346 
	`§veToNextCode
(
Ãxt4By‹s
);

347 } 
Ãxt4By‹s
 !ğ
PICTURE_START_CODE
);

350 
	`usšgSourû
()->
	`£tTimeCode
(
time_code_hours
, 
time_code_mšu‹s
,

351 
time_code_£cÚds
, 
time_code_piùu»s
,

352 
fPiùu»sSšûLa¡GOP
);

354 
fPiùu»sSšûLa¡GOP
 = 0;

357 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(0);

359 
	`£tP¬£S‹
(
PARSING_PICTURE_HEADER
);

361  
	`curF¿meSize
();

362 
	}
}

364 
šlše
 
BoŞ—n
 
	$isSliûS¹Code
(
fourBy‹s
) {

365 ià((
fourBy‹s
&0xFFFFFF00è!ğ0x00000100è 
F®£
;

367 
Ï¡By‹
 = 
fourBy‹s
&0xFF;

368  
Ï¡By‹
 <= 0xAF &&†astByte >= 1;

369 
	}
}

371 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$·r£Piùu»H—d”
() {

372 #ifdeà
DEBUG


373 
	`årštf
(
¡d”r
, "parsing…icture header\n");

377 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

378 
‹mpÜ®_»ã»nû
 = (
Ãxt4By‹s
&0xFFC00000)>>(32-10);

379 
piùu»_codšg_ty³
 = (
Ãxt4By‹s
&0x00380000)>>19;

380 #ifdeà
DEBUG


381 
vbv_d–ay
 = (
Ãxt4By‹s
&0x0007FFF8)>>3;

382 
	`årštf
(
¡d”r
, "‹mpÜ®_»ã»nû: %d,…iùu»_codšg_ty³: %d, vbv_d–ay: %d\n", 
‹mpÜ®_»ã»nû
, 
piùu»_codšg_ty³
, 
vbv_d–ay
);

385 
fSkpšgCu¼’tPiùu»
 = 
fIF¿mesOÆy
 && 
piùu»_codšg_ty³
 != 1;

386 ià(
fSkpšgCu¼’tPiùu»
) {

389 
	`skToNextCode
(
Ãxt4By‹s
);

390 } !
	`isSliûS¹Code
(
Ãxt4By‹s
));

393 
	`§ve4By‹s
(
PICTURE_START_CODE
);

397 
	`§veToNextCode
(
Ãxt4By‹s
);

398 } !
	`isSliûS¹Code
(
Ãxt4By‹s
));

401 
	`£tP¬£S‹
(
PARSING_SLICE
);

403 
fCu¼’tSliûNumb”
 = 
Ãxt4By‹s
&0xFF;

406 
fCurPicTempÜ®Reã»nû
 = 
‹mpÜ®_»ã»nû
;

409 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fCurPicTempÜ®Reã»nû
);

411 ià(
fSkpšgCu¼’tPiùu»
) {

412  
	`·r£
();

414  
	`curF¿meSize
();

416 
	}
}

418 
	gMPEG1Ü2VideoSŒ—mP¬£r
::
	$·r£Sliû
() {

420 
Ãxt4By‹s
 = 
PICTURE_START_CODE
|
fCu¼’tSliûNumb”
;

421 #ifdeà
DEBUG_SLICE


422 
	`årštf
(
¡d”r
, "·rsšg sliû: 0x%08x\n", 
Ãxt4By‹s
);

425 ià(
fSkpšgCu¼’tPiùu»
) {

427 
	`skToNextCode
(
Ãxt4By‹s
);

430 
	`§veToNextCode
(
Ãxt4By‹s
);

434 ià(
	`isSliûS¹Code
(
Ãxt4By‹s
)) {

435 
	`£tP¬£S‹
(
PARSING_SLICE
);

436 
fCu¼’tSliûNumb”
 = 
Ãxt4By‹s
&0xFF;

440 ++
fPiùu»sSšûLa¡GOP
;

441 ++
	`usšgSourû
()->
fPiùu»CouÁ
;

442 
	`usšgSourû
()->
fPiùu»EndM¬k”
 = 
True
;

444 
Ãxt4By‹s
) {

445 
SEQUENCE_END_CODE
: {

446 
	`£tP¬£S‹
(
PARSING_VIDEO_SEQUENCE_HEADER
);

449 
VIDEO_SEQUENCE_HEADER_START_CODE
: {

450 
	`£tP¬£S‹
(
PARSING_VIDEO_SEQUENCE_HEADER_SEEN_CODE
);

453 
GROUP_START_CODE
: {

454 
	`£tP¬£S‹
(
PARSING_GOP_HEADER_SEEN_CODE
);

457 
PICTURE_START_CODE
: {

458 
	`£tP¬£S‹
(
PARSING_PICTURE_HEADER
);

462 
	`usšgSourû
()->
	`’vœ
() << "MPEG1or2VideoStreamParser::parseSlice(): Saw unexpected code "

463 << (*)
Ãxt4By‹s
 << "\n";

464 
	`£tP¬£S‹
(
PARSING_SLICE
);

471 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fCurPicTempÜ®Reã»nû
);

473 ià(
fSkpšgCu¼’tPiùu»
) {

474  
	`·r£
();

476  
	`curF¿meSize
();

478 
	}
}

	@liveMedia/MPEG2IndexFromTransportStream.cpp

21 
	~"MPEG2IndexFromT¿n¥ÜtSŒ—m.hh
"

25 
	eRecÜdTy³
 {

26 
	mRECORD_UNPARSED
 = 0,

27 
	mRECORD_VSH
 = 1,

28 
	mRECORD_GOP
 = 2,

29 
	mRECORD_PIC_NON_IFRAME
 = 3,

30 
	mRECORD_PIC_IFRAME
 = 4,

31 
	mRECORD_NAL_H264_SPS
 = 5,

32 
	mRECORD_NAL_H264_PPS
 = 6,

33 
	mRECORD_NAL_H264_SEI
 = 7,

34 
	mRECORD_NAL_H264_NON_IFRAME
 = 8,

35 
	mRECORD_NAL_H264_IFRAME
 = 9,

36 
	mRECORD_NAL_H264_OTHER
 = 10,

37 
	mRECORD_NAL_H265_VPS
 = 11,

38 
	mRECORD_NAL_H265_SPS
 = 12,

39 
	mRECORD_NAL_H265_PPS
 = 13,

40 
	mRECORD_NAL_H265_NON_IFRAME
 = 14,

41 
	mRECORD_NAL_H265_IFRAME
 = 15,

42 
	mRECORD_NAL_H265_OTHER
 = 16,

43 
	mRECORD_JUNK


46 şas 
	cIndexRecÜd
 {

47 
	mpublic
:

48 
IndexRecÜd
(
u_št8_t
 
¡¬tOff£t
, u_št8_ˆ
size
,

49 
Œª¥ÜtPack‘Numb”
, 
pü
);

50 
	mvœtu®
 ~
IndexRecÜd
();

52 
	mRecÜdTy³
& 
	$»cÜdTy³
(è{  
fRecÜdTy³
; }

53 
	$£tFœ¡FÏg
(è{ 
fRecÜdTy³
 = (
RecÜdTy³
)(((
u_št8_t
)fRecÜdTy³è| 0x80); 
	}
}

54 
u_št8_t
 
	$¡¬tOff£t
(ècÚ¡ {  
fS¹Off£t
; 
	}
}

55 
	gu_št8_t
& 
	$size
(è{  
fSize
; 
	}
}

56 
	$pü
(ècÚ¡ {  
fPCR
; 
	}
}

57 
	$Œª¥ÜtPack‘Numb”
(ècÚ¡ {  
fT¿n¥ÜtPack‘Numb”
; 
	}
}

59 
IndexRecÜd
* 
	$Ãxt
(ècÚ¡ {  
fNext
; 
	}
}

60 
addAá”
(
IndexRecÜd
* 
´ev
);

61 
uÆšk
();

63 
	g´iv©e
:

65 
IndexRecÜd
* 
fNext
;

66 
IndexRecÜd
* 
	gfP»v
;

68 
RecÜdTy³
 
	gfRecÜdTy³
;

69 
u_št8_t
 
	gfS¹Off£t
;

70 
u_št8_t
 
	gfSize
;

72 
	gfPCR
;

73 
	gfT¿n¥ÜtPack‘Numb”
;

76 #ifdeà
DEBUG


77 cÚ¡* 
	g»cÜdTy³SŒ
[] = {

98 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, 
	gIndexRecÜd
& 
	gr
) {

99  
	g’v
 << "[" << ((
	gr
.
»cÜdTy³
()&0x80) != 0 ? "1" : "")

100 << 
»cÜdTy³SŒ
[
r
.
»cÜdTy³
()&0x7F] << ":"

101 << ()
r
.
Œª¥ÜtPack‘Numb”
(è<< ":" <<„.
¡¬tOff£t
()

102 << "(" << 
r
.
size
(è<< ")@" <<„.
pü
() << "]";

109 
MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
*

110 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

111 
F¿medSourû
* 
šputSourû
) {

112  
Ãw
 
	`MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
(
’v
, 
šputSourû
);

113 
	}
}

116 
	#MAX_FRAME_SIZE
 400000

	)

120 
	#PARSE_BUFFER_SIZE
 (2*
MAX_FRAME_SIZE
)

	)

123 
	#PAT_PID
 0

	)

125 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m


126 ::
	$MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
(
U§geEnvœÚm’t
& 
’v
,

127 
F¿medSourû
* 
šputSourû
)

128 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

129 
	`fIsH264
(
F®£
), 
	`fIsH265
(False),

130 
	`fIÅutT¿n¥ÜtPack‘CouÁ”
(()-1), 
	`fClosu»Numb”
(0), 
	`fLa¡CÚtšu™yCouÁ”
(~0),

131 
	`fFœ¡PCR
(0.0), 
	`fLa¡PCR
(0.0), 
	`fHaveS“nFœ¡PCR
(
F®£
),

132 
	`fPMT_PID
(0x10), 
	`fVideo_PID
(0xE0),

133 
	`fP¬£BufãrSize
(
PARSE_BUFFER_SIZE
),

134 
	`fP¬£BufãrF¿meS¹
(0), 
	`fP¬£BufãrP¬£End
(4), 
	`fP¬£BufãrD©aEnd
(0),

135 
	`fH—dIndexRecÜd
(
NULL
), 
	$fTaIndexRecÜd
(
NULL
) {

136 
fP¬£Bufãr
 = 
Ãw
 [
fP¬£BufãrSize
];

137 
	}
}

139 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::~
	$MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
() {

140 
d–‘e
 
fH—dIndexRecÜd
;

141 
d–‘e
[] 
fP¬£Bufãr
;

142 
	}
}

144 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$doG‘NextF¿me
() {

147 ià(
	`d–iv”IndexRecÜd
()) ;

150 ià(
	`·r£F¿me
()) {

151 
	`doG‘NextF¿me
();

156 ià(
fP¬£BufãrSize
 - 
fP¬£BufãrD©aEnd
 < 
TRANSPORT_PACKET_SIZE
) {

158 
	`com·ùP¬£Bufãr
();

159 ià(
fP¬£BufãrSize
 - 
fP¬£BufãrD©aEnd
 < 
TRANSPORT_PACKET_SIZE
) {

160 
	`’vœ
() << "ERROR:…arse buffer full; increase MAX_FRAME_SIZE\n";

162 
	`hªdËIÅutClosu»1
();

168 
fIÅutSourû
->
	`g‘NextF¿me
(
fIÅutBufãr
,  fInputBuffer,

169 
aá”G‘tšgF¿me
, 
this
,

170 
hªdËIÅutClosu»
, 
this
);

171 
	}
}

173 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m


174 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

175 
numTrunÿ‹dBy‹s
,

176 
timev®
 
´e£Á©iÚTime
,

177 
du¿tiÚInMiüo£cÚds
) {

178 
MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
* 
sourû


179 ğ(
MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
*)
ş›ÁD©a
;

180 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

181 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

182 
	}
}

184 
	#TRANSPORT_SYNC_BYTE
 0x47

	)

186 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m


187 ::
	$aá”G‘tšgF¿me1
(
äameSize
,

188 
numTrunÿ‹dBy‹s
,

189 
timev®
 
´e£Á©iÚTime
,

190 
du¿tiÚInMiüo£cÚds
) {

191 ià(
äameSize
 < 
TRANSPORT_PACKET_SIZE
 || 
fIÅutBufãr
[0] !ğ
TRANSPORT_SYNC_BYTE
) {

192 ià(
fIÅutBufãr
[0] !ğ
TRANSPORT_SYNC_BYTE
) {

193 
	`’vœ
(è<< "Bad TS synøby‹: 0x" << 
fIÅutBufãr
[0] << "\n";

196 
	`hªdËIÅutClosu»1
();

200 ++
fIÅutT¿n¥ÜtPack‘CouÁ”
;

203 
u_št8_t
 
ad­tiÚ_f›ld_cÚŒŞ
 = (
fIÅutBufãr
[3]&0x30)>>4;

204 
u_št8_t
 
tÙ®H—d”Size


205 ğ
ad­tiÚ_f›ld_cÚŒŞ
 <ğ1 ? 4 : 5 + 
fIÅutBufãr
[4];

206 ià((
ad­tiÚ_f›ld_cÚŒŞ
 =ğ2 && 
tÙ®H—d”Size
 !ğ
TRANSPORT_PACKET_SIZE
) ||

207 (
ad­tiÚ_f›ld_cÚŒŞ
 =ğ3 && 
tÙ®H—d”Size
 >ğ
TRANSPORT_PACKET_SIZE
)) {

208 
	`’vœ
(è<< "Bad \"ad­tiÚ_f›ld_Ëngth\": " << 
fIÅutBufãr
[4] << "\n";

209 
	`doG‘NextF¿me
();

214 ià(
tÙ®H—d”Size
 > 5 && (
fIÅutBufãr
[5]&0x10) != 0) {

216 
u_št32_t
 
püBa£High


217 ğ(
fIÅutBufãr
[6]<<24)|(fInputBuffer[7]<<16)

218 |(
fIÅutBufãr
[8]<<8)|fInputBuffer[9];

219 
pü
 = 
püBa£High
/45000.0f;

220 ià((
fIÅutBufãr
[10]&0x80è!ğ0è
pü
 += 1/90000.0f;

221 
püExt
 = ((
fIÅutBufãr
[10]&0x01)<<8) | fInputBuffer[11];

222 
pü
 +ğ
püExt
/27000000.0f;

224 ià(!
fHaveS“nFœ¡PCR
) {

225 
fFœ¡PCR
 = 
pü
;

226 
fHaveS“nFœ¡PCR
 = 
True
;

227 } ià(
pü
 < 
fLa¡PCR
) {

230 
	`’vœ
(è<< "\nW¬nšg: Aˆabouˆ" << 
fLa¡PCR
-
fFœ¡PCR


232 << 
fLa¡PCR
 << "Ø" << 
pü
 << "\n";

233 
fFœ¡PCR
 -ğ(
fLa¡PCR
 - 
pü
);

235 
fLa¡PCR
 = 
pü
;

239 
u_št16_t
 
PID
 = ((
fIÅutBufãr
[1]&0x1F)<<8) | fInputBuffer[2];

240 ià(
PID
 =ğ
PAT_PID
) {

241 
	`ª®yzePAT
(&
fIÅutBufãr
[
tÙ®H—d”Size
], 
TRANSPORT_PACKET_SIZE
-totalHeaderSize);

242 } ià(
PID
 =ğ
fPMT_PID
) {

243 
	`ª®yzePMT
(&
fIÅutBufãr
[
tÙ®H—d”Size
], 
TRANSPORT_PACKET_SIZE
-totalHeaderSize);

248 
u_št8_t
 
cÚtšu™y_couÁ”
 = 
fIÅutBufãr
[3]&0x0F;

249 ià((
PID
 !ğ
fVideo_PID
) ||

250 !(
ad­tiÚ_f›ld_cÚŒŞ
 == 1 ||‡daptation_field_control == 3) ||

251 
cÚtšu™y_couÁ”
 =ğ
fLa¡CÚtšu™yCouÁ”
) {

252 
	`doG‘NextF¿me
();

255 
fLa¡CÚtšu™yCouÁ”
 = 
cÚtšu™y_couÁ”
;

258 
BoŞ—n
 
·ylßd_un™_¡¬t_šdiÿtÜ
 = (
fIÅutBufãr
[1]&0x40) != 0;

259 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
tÙ®H—d”Size
 < 
TRANSPORT_PACKET_SIZE
 - 8

260 && 
fIÅutBufãr
[
tÙ®H—d”Size
] == 0x00 && fInputBuffer[totalHeaderSize+1] == 0x00

261 && 
fIÅutBufãr
[
tÙ®H—d”Size
+2] == 0x01) {

262 
u_št8_t
 
PES_h—d”_d©a_Ëngth
 = 
fIÅutBufãr
[
tÙ®H—d”Size
+8];

263 
tÙ®H—d”Size
 +ğ9 + 
PES_h—d”_d©a_Ëngth
;

264 ià(
tÙ®H—d”Size
 >ğ
TRANSPORT_PACKET_SIZE
) {

265 
	`’vœ
(è<< "UÃx³ùedly†¬gPES h—d” size: " << 
PES_h—d”_d©a_Ëngth
 << "\n";

267 
	`hªdËIÅutClosu»1
();

273 
vesSize
 = 
TRANSPORT_PACKET_SIZE
 - 
tÙ®H—d”Size
;

274 
	`memmove
(&
fP¬£Bufãr
[
fP¬£BufãrD©aEnd
], &
fIÅutBufãr
[
tÙ®H—d”Size
], 
vesSize
);

275 
fP¬£BufãrD©aEnd
 +ğ
vesSize
;

278 
	`addToTa
(
Ãw
 
	`IndexRecÜd
(
tÙ®H—d”Size
, 
vesSize
, 
fIÅutT¿n¥ÜtPack‘CouÁ”
,

279 
fLa¡PCR
 - 
fFœ¡PCR
));

282 
	`doG‘NextF¿me
();

283 
	}
}

285 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$hªdËIÅutClosu»
(* 
ş›ÁD©a
) {

286 
MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
* 
sourû


287 ğ(
MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
*)
ş›ÁD©a
;

288 
sourû
->
	`hªdËIÅutClosu»1
();

289 
	}
}

291 
	#VIDEO_SEQUENCE_START_CODE
 0xB3

292 
	#VISUAL_OBJECT_SEQUENCE_START_CODE
 0xB0

293 
	#GROUP_START_CODE
 0xB8

294 
	#GROUP_VOP_START_CODE
 0xB3

295 
	#PICTURE_START_CODE
 0x00

296 
	#VOP_START_CODE
 0xB6

297 

	)

298 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$hªdËIÅutClosu»1
() {

299 ià(++
fClosu»Numb”
 =ğ1 && 
fP¬£BufãrD©aEnd
 > 
fP¬£BufãrF¿meS¹


300 && 
fP¬£BufãrD©aEnd
 <ğ
fP¬£BufãrSize
 - 4) {

304 
fP¬£Bufãr
[
fP¬£BufãrD©aEnd
++] = 0;

305 
fP¬£Bufãr
[
fP¬£BufãrD©aEnd
++] = 0;

306 
fP¬£Bufãr
[
fP¬£BufãrD©aEnd
++] = 1;

307 
fP¬£Bufãr
[
fP¬£BufãrD©aEnd
++] = 
PICTURE_START_CODE
;

310 
	`doG‘NextF¿me
();

313 
	`hªdËClosu»
();

315 
	}
}

317 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m


318 ::
	$ª®yzePAT
(* 
pkt
, 
size
) {

320 
size
 >= 17) {

321 
u_št16_t
 
´og¿m_numb”
 = (
pkt
[9]<<8) |…kt[10];

322 ià(
´og¿m_numb”
 != 0) {

323 
fPMT_PID
 = ((
pkt
[11]&0x1F)<<8) |…kt[12];

327 
pkt
 +ğ4; 
size
 -= 4;

329 
	}
}

331 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m


332 ::
	$ª®yzePMT
(* 
pkt
, 
size
) {

336 
u_št16_t
 
£ùiÚ_Ëngth
 = ((
pkt
[2]&0x0F)<<8) |…kt[3];

337 ià(()(4+
£ùiÚ_Ëngth
è< 
size
) size = (4+section_length);

340 ià(
size
 < 22) ;

341 
´og¿m_šfo_Ëngth
 = ((
pkt
[11]&0x0F)<<8) |…kt[12];

342 
pkt
 +ğ13; 
size
 -= 13;

343 ià(
size
 < 
´og¿m_šfo_Ëngth
) ;

344 
pkt
 +ğ
´og¿m_šfo_Ëngth
; 
size
 -=…rogram_info_length;

347 
size
 >= 9) {

348 
u_št8_t
 
¡»am_ty³
 = 
pkt
[0];

349 
u_št16_t
 
–em’ry_PID
 = ((
pkt
[1]&0x1F)<<8) |…kt[2];

350 ià(
¡»am_ty³
 == 1 || stream_type == 2 ||

351 
¡»am_ty³
 == 0x1B || stream_type == 0x24 ) {

352 ià(
¡»am_ty³
 =ğ0x1Bè
fIsH264
 = 
True
;

353 ià(
¡»am_ty³
 =ğ0x24è
fIsH265
 = 
True
;

354 
fVideo_PID
 = 
–em’ry_PID
;

358 
u_št16_t
 
ES_šfo_Ëngth
 = ((
pkt
[3]&0x0F)<<8) |…kt[4];

359 
pkt
 +ğ5; 
size
 -= 5;

360 ià(
size
 < 
ES_šfo_Ëngth
) ;

361 
pkt
 +ğ
ES_šfo_Ëngth
; 
size
 -= ES_info_length;

363 
	}
}

365 
BoŞ—n
 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$d–iv”IndexRecÜd
() {

366 
IndexRecÜd
* 
h—d
 = 
fH—dIndexRecÜd
;

367 ià(
h—d
 =ğ
NULL
è 
F®£
;

370 ià(
h—d
->
	`»cÜdTy³
(è=ğ
RECORD_UNPARSED
è 
F®£
;

373 
IndexRecÜd
* 
Ãxt
 = 
h—d
->
	`Ãxt
();

374 
h—d
->
	`uÆšk
();

375 ià(
Ãxt
 =ğ
h—d
) {

376 
fH—dIndexRecÜd
 = 
fTaIndexRecÜd
 = 
NULL
;

378 
fH—dIndexRecÜd
 = 
Ãxt
;

381 ià(
h—d
->
	`»cÜdTy³
(è=ğ
RECORD_JUNK
) {

383 
d–‘e
 
h—d
;

385  
	`d–iv”IndexRecÜd
();

389 #ifdeà
DEBUG


390 
	`’vœ
(è<< "d–iv”šg: " << *
h—d
 << "\n";

392 ià(
fMaxSize
 < 11) {

393 
fF¿meSize
 = 0;

395 
fTo
[0] = (
u_št8_t
)(
h—d
->
	`»cÜdTy³
());

396 
fTo
[1] = 
h—d
->
	`¡¬tOff£t
();

397 
fTo
[2] = 
h—d
->
	`size
();

399 
pü
 = 
h—d
->
	`pü
();

400 
pü_št
 = ()
pü
;

401 
u_št8_t
 
pü_äac
 = (u_št8_t)(256*(
pü
-
pü_št
));

402 
fTo
[3] = ()(
pü_št
);

403 
fTo
[4] = ()(
pü_št
>>8);

404 
fTo
[5] = ()(
pü_št
>>16);

405 
fTo
[6] = ()(
pü_äac
);

407 
n
 = 
h—d
->
	`Œª¥ÜtPack‘Numb”
();

408 
fTo
[7] = ()(
n
);

409 
fTo
[8] = ()(
n
>>8);

410 
fTo
[9] = ()(
n
>>16);

411 
fTo
[10] = ()(
n
>>24);

412 
fF¿meSize
 = 11;

416 
d–‘e
 
h—d
;

419 
	`aá”G‘tšg
(
this
);

420  
True
;

421 
	}
}

423 
BoŞ—n
 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$·r£F¿me
() {

432 ià(
fP¬£BufãrD©aEnd
-
fP¬£BufãrF¿meS¹
 < 4è 
F®£
;

433 
numIn™ŸlBadBy‹s
 = 0;

434 cÚ¡* 
p
 = &
fP¬£Bufãr
[
fP¬£BufãrF¿meS¹
];

435 ià(!(
p
[0] == 0 &&…[1] == 0 &&…[2] == 1)) {

437 ià(
fP¬£BufãrP¬£End
 =ğ
fP¬£BufãrF¿meS¹
 + 4) {

439 
fP¬£BufãrP¬£End
 = 
fP¬£BufãrF¿meS¹
;

441 
ÃxtCode
;

442 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

444 
numIn™ŸlBadBy‹s
 = 
fP¬£BufãrP¬£End
 - 
fP¬£BufãrF¿meS¹
;

445 
fP¬£BufãrF¿meS¹
 = 
fP¬£BufãrP¬£End
;

446 
fP¬£BufãrP¬£End
 += 4;

447 
p
 = &
fP¬£Bufãr
[
fP¬£BufãrF¿meS¹
];

450 
curCode
 = 
p
[3];

451 ià(
fIsH264
è
curCode
 &= 0x1F;

452 ià(
fIsH265
è
curCode
 = (curCode&0x7E)>>1;

454 
RecÜdTy³
 
curRecÜdTy³
;

455 
ÃxtCode
;

456 ià(
fIsH264
) {

457 
curCode
) {

459 
curRecÜdTy³
 = 
RECORD_NAL_H264_NON_IFRAME
;

460 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

463 
curRecÜdTy³
 = 
RECORD_NAL_H264_IFRAME
;

464 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

467 
curRecÜdTy³
 = 
RECORD_NAL_H264_SEI
;

468 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

471 
curRecÜdTy³
 = 
RECORD_NAL_H264_SPS
;

472 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

475 
curRecÜdTy³
 = 
RECORD_NAL_H264_PPS
;

476 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

479 
curRecÜdTy³
 = 
RECORD_NAL_H264_OTHER
;

480 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

483 } ià(
fIsH265
) {

484 
curCode
) {

487 
curRecÜdTy³
 = 
RECORD_NAL_H265_IFRAME
;

488 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

491 
curRecÜdTy³
 = 
RECORD_NAL_H265_VPS
;

492 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

495 
curRecÜdTy³
 = 
RECORD_NAL_H265_SPS
;

496 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

499 
curRecÜdTy³
 = 
RECORD_NAL_H265_PPS
;

500 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

503 
curRecÜdTy³
 = (
curCode
 <ğ31è? 
RECORD_NAL_H265_NON_IFRAME
 : 
RECORD_NAL_H265_OTHER
;

504 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

508 
curCode
) {

509 
VIDEO_SEQUENCE_START_CODE
:

510 
VISUAL_OBJECT_SEQUENCE_START_CODE
:

511 
curRecÜdTy³
 = 
RECORD_VSH
;

513 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

514 ià(
ÃxtCode
 =ğ
GROUP_START_CODE
 ||

515 
ÃxtCode
 =ğ
PICTURE_START_CODE
 ||‚extCod=ğ
VOP_START_CODE
) ;

516 
fP¬£BufãrP¬£End
 += 4;

519 
GROUP_START_CODE
:

520 
curRecÜdTy³
 = 
RECORD_GOP
;

522 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

523 ià(
ÃxtCode
 =ğ
PICTURE_START_CODE
 ||‚extCod=ğ
VOP_START_CODE
) ;

524 
fP¬£BufãrP¬£End
 += 4;

528 
curRecÜdTy³
 = 
RECORD_PIC_NON_IFRAME
;

530 ià(!
	`·r£ToNextCode
(
ÃxtCode
)è 
F®£
;

531 ià(
ÃxtCode
 =ğ
VIDEO_SEQUENCE_START_CODE
 ||

532 
ÃxtCode
 =ğ
VISUAL_OBJECT_SEQUENCE_START_CODE
 ||

533 
ÃxtCode
 =ğ
GROUP_START_CODE
 ||‚extCod=ğ
GROUP_VOP_START_CODE
 ||

534 
ÃxtCode
 =ğ
PICTURE_START_CODE
 ||‚extCod=ğ
VOP_START_CODE
) ;

535 
fP¬£BufãrP¬£End
 += 4;

541 ià(
curRecÜdTy³
 =ğ
RECORD_PIC_NON_IFRAME
) {

542 ià(
curCode
 =ğ
VOP_START_CODE
) {

543 ià((
fP¬£Bufãr
[
fP¬£BufãrF¿meS¹
+4]&0xC0) == 0) {

545 
curRecÜdTy³
 = 
RECORD_PIC_IFRAME
;

548 ià((
fP¬£Bufãr
[
fP¬£BufãrF¿meS¹
+5]&0x38) == 0x08) {

550 
curRecÜdTy³
 = 
RECORD_PIC_IFRAME
;

557 
äameSize
 = 
fP¬£BufãrP¬£End
 - 
fP¬£BufãrF¿meS¹
 + 
numIn™ŸlBadBy‹s
;

558 #ifdeà
DEBUG


559 
	`’vœ
(è<< "·r£d " << 
»cÜdTy³SŒ
[
curRecÜdTy³
] << ";†ength "

560 << 
äameSize
 << "\n";

562 
IndexRecÜd
* 
r
 = 
fH—dIndexRecÜd
; ;„ =„->
	`Ãxt
()) {

563 ià(
numIn™ŸlBadBy‹s
 >ğ
r
->
	`size
()) {

564 
r
->
	`»cÜdTy³
(èğ
RECORD_JUNK
;

565 
numIn™ŸlBadBy‹s
 -ğ
r
->
	`size
();

567 
r
->
	`»cÜdTy³
(èğ
curRecÜdTy³
;

569 ià(
r
 =ğ
fH—dIndexRecÜd
èr->
	`£tFœ¡FÏg
();

572 ià(
r
->
	`size
(è> 
äameSize
) {

576 
u_št8_t
 
ÃwOff£t
 = 
r
->
	`¡¬tOff£t
(è+ 
äameSize
;

577 
u_št8_t
 
ÃwSize
 = 
r
->
	`size
(è- 
äameSize
;

578 
r
->
	`size
(èğ
äameSize
;

579 #ifdeà
DEBUG


580 
	`’vœ
(è<< "gged„ecÜd (modif›d): " << *
r
 << "\n";

583 
IndexRecÜd
* 
ÃwRecÜd


584 ğ
Ãw
 
	`IndexRecÜd
(
ÃwOff£t
, 
ÃwSize
, 
r
->
	`Œª¥ÜtPack‘Numb”
(),„->
	`pü
());

585 
ÃwRecÜd
->
	`addAá”
(
r
);

586 ià(
fTaIndexRecÜd
 =ğ
r
èfTaIndexRecÜd = 
ÃwRecÜd
;

587 #ifdeà
DEBUG


588 
	`’vœ
(è<< "addedƒxŒ¨»cÜd: " << *
ÃwRecÜd
 << "\n";

591 #ifdeà
DEBUG


592 
	`’vœ
(è<< "gged„ecÜd: " << *
r
 << "\n";

595 
äameSize
 -ğ
r
->
	`size
();

596 ià(
äameSize
 == 0) ;

597 ià(
r
 =ğ
fTaIndexRecÜd
) {

598 
	`’vœ
() << "!!!!!Internal consistencyƒrror!!!!!\n";

599  
F®£
;

604 
fP¬£BufãrF¿meS¹
 = 
fP¬£BufãrP¬£End
;

605 
fP¬£BufãrP¬£End
 += 4;

607  
True
;

608 
	}
}

610 
BoŞ—n
 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m


611 ::
	$·r£ToNextCode
(& 
ÃxtCode
) {

612 cÚ¡* 
p
 = &
fP¬£Bufãr
[
fP¬£BufãrP¬£End
];

613 cÚ¡* 
’d
 = &
fP¬£Bufãr
[
fP¬£BufãrD©aEnd
];

614 
p
 <ğ
’d
-4) {

615 ià(
p
[2] > 1)… += 3;

616 ià(
p
[2] == 0) ++p;

617 ià(
p
[0] == 0 &&…[1] == 0) {

619 
ÃxtCode
 = 
p
[3];

620 
fP¬£BufãrP¬£End
 = 
p
 - &
fP¬£Bufãr
[0];

621  
True
;

622 } 
p
 += 3;

625 
fP¬£BufãrP¬£End
 = 
p
 - &
fP¬£Bufãr
[0];

626  
F®£
;

627 
	}
}

629 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$com·ùP¬£Bufãr
() {

630 #ifdeà
DEBUG


631 
	`’vœ
(è<< "Com·ùšg…¬£ bufãr: [" << 
fP¬£BufãrF¿meS¹


632 << "," << 
fP¬£BufãrP¬£End
 << "," << 
fP¬£BufãrD©aEnd
 << "]";

634 
	`memmove
(&
fP¬£Bufãr
[0], &fP¬£Bufãr[
fP¬£BufãrF¿meS¹
],

635 
fP¬£BufãrD©aEnd
 - 
fP¬£BufãrF¿meS¹
);

636 
fP¬£BufãrD©aEnd
 -ğ
fP¬£BufãrF¿meS¹
;

637 
fP¬£BufãrP¬£End
 -ğ
fP¬£BufãrF¿meS¹
;

638 
fP¬£BufãrF¿meS¹
 = 0;

639 #ifdeà
DEBUG


640 
	`’vœ
(è<< "-> [" << 
fP¬£BufãrF¿meS¹


641 << "," << 
fP¬£BufãrP¬£End
 << "," << 
fP¬£BufãrD©aEnd
 << "]\n";

643 
	}
}

645 
	gMPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	$addToTa
(
IndexRecÜd
* 
ÃwIndexRecÜd
) {

646 #ifdeà
DEBUG


647 
	`’vœ
(è<< "addšg‚ew: " << *
ÃwIndexRecÜd
 << "\n";

649 ià(
fTaIndexRecÜd
 =ğ
NULL
) {

650 
fH—dIndexRecÜd
 = 
fTaIndexRecÜd
 = 
ÃwIndexRecÜd
;

652 
ÃwIndexRecÜd
->
	`addAá”
(
fTaIndexRecÜd
);

653 
fTaIndexRecÜd
 = 
ÃwIndexRecÜd
;

655 
	}
}

659 
	gIndexRecÜd
::
	$IndexRecÜd
(
u_št8_t
 
¡¬tOff£t
, u_št8_ˆ
size
,

660 
Œª¥ÜtPack‘Numb”
, 
pü
)

661 : 
	`fNext
(
this
), 
	`fP»v
Ñhis), 
	`fRecÜdTy³
(
RECORD_UNPARSED
),

662 
	`fS¹Off£t
(
¡¬tOff£t
), 
	`fSize
(
size
),

663 
	`fPCR
(
pü
), 
	$fT¿n¥ÜtPack‘Numb”
(
Œª¥ÜtPack‘Numb”
) {

664 
	}
}

666 
	gIndexRecÜd
::~
	$IndexRecÜd
() {

667 
IndexRecÜd
* 
ÃxtRecÜd
 = 
	`Ãxt
();

668 
	`uÆšk
();

669 ià(
ÃxtRecÜd
 !ğ
this
è
d–‘e
‚extRecord;

670 
	}
}

672 
	gIndexRecÜd
::
	$addAá”
(
IndexRecÜd
* 
´ev
) {

673 
fNext
 = 
´ev
->fNext;

674 
fP»v
 = 
´ev
;

675 
´ev
->
fNext
->
fP»v
 = 
this
;

676 
´ev
->
fNext
 = 
this
;

677 
	}
}

679 
	gIndexRecÜd
::
	$uÆšk
() {

680 
fNext
->
fP»v
 = fPrev;

681 
fP»v
->
fNext
 = fNext;

682 
fNext
 = 
fP»v
 = 
this
;

683 
	}
}

	@liveMedia/MPEG2TransportFileServerMediaSubsession.cpp

22 
	~"MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"Sim¶eRTPSšk.hh
"

25 
MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
*

26 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

27 cÚ¡* 
feName
,

28 cÚ¡* 
šdexFeName
,

29 
BoŞ—n
 
»u£Fœ¡Sourû
) {

30 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe
;

31 ià(
šdexFeName
 !ğ
NULL
 && 
»u£Fœ¡Sourû
) {

33 
’v
 << "MPEG2TransportFileServerMediaSubsession::createNew(): ignoringhe index file‚ame, because \"reuseFirstSource\" is set\n";

34 
šdexFe
 = 
NULL
;

36 
šdexFe
 = 
MPEG2T¿n¥ÜtSŒ—mIndexFe
::
	`ü—‹New
(
’v
, 
šdexFeName
);

38  
Ãw
 
	`MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
šdexFe
,

39 
»u£Fœ¡Sourû
);

40 
	}
}

42 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


43 ::
	$MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

44 cÚ¡* 
feName
,

45 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe
,

46 
BoŞ—n
 
»u£Fœ¡Sourû
)

47 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

48 
	`fIndexFe
(
šdexFe
), 
	`fDu¿tiÚ
(0.0), 
	$fCl›ÁSessiÚHashTabË
(
NULL
) {

49 ià(
fIndexFe
 !ğ
NULL
) {

50 
fDu¿tiÚ
 = 
fIndexFe
->
	`g‘PÏyšgDu¿tiÚ
();

51 
fCl›ÁSessiÚHashTabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

53 
	}
}

55 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


56 ::~
	$MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
() {

57 ià(
fIndexFe
 !ğ
NULL
) {

58 
Medium
::
	`şo£
(
fIndexFe
);

62 
Cl›ÁTrickPÏyS‹
* 
ş›Á


63 ğ(
Cl›ÁTrickPÏyS‹
*)(
fCl›ÁSessiÚHashTabË
->
	`RemoveNext
());

64 ià(
ş›Á
 =ğ
NULL
) ;

65 
d–‘e
 
ş›Á
;

67 
d–‘e
 
fCl›ÁSessiÚHashTabË
;

69 
	}
}

71 
	#TRANSPORT_PACKET_SIZE
 188

	)

72 
	#TRANSPORT_PACKETS_PER_NETWORK_PACKET
 7

	)

75 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


76 ::
	$¡¬tSŒ—m
(
ş›ÁSessiÚId
, * 
¡»amTok’
, 
TaskFunc
* 
¹ıRRHªdËr
,

77 * 
¹ıRRHªdËrCl›ÁD©a
, & 
¹pSeqNum
,

78 & 
¹pTime¡amp
,

79 
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËr
,

80 * 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
) {

81 ià(
fIndexFe
 !ğ
NULL
) {

82 
Cl›ÁTrickPÏyS‹
* 
ş›Á
 = 
	`lookupCl›Á
(
ş›ÁSessiÚId
);

83 ià(
ş›Á
 !ğ
NULL
 && cl›Á->
	`¬eChªgšgSÿË
()) {

85 
ş›Á
->
	`upd©eS‹OnPÏyChªge
(
True
);

86 
OnDemªdS”v”MedŸSub£ssiÚ
::
	`·u£SŒ—m
(
ş›ÁSessiÚId
, 
¡»amTok’
);

89 
ş›Á
->
	`upd©eS‹OnSÿËChªge
();

94 
OnDemªdS”v”MedŸSub£ssiÚ
::
	`¡¬tSŒ—m
(
ş›ÁSessiÚId
, 
¡»amTok’
,

95 
¹ıRRHªdËr
, 
¹ıRRHªdËrCl›ÁD©a
,

96 
¹pSeqNum
, 
¹pTime¡amp
,

97 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËr
, 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
);

98 
	}
}

100 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


101 ::
	$·u£SŒ—m
(
ş›ÁSessiÚId
, * 
¡»amTok’
) {

102 ià(
fIndexFe
 !ğ
NULL
) {

103 
Cl›ÁTrickPÏyS‹
* 
ş›Á
 = 
	`lookupCl›Á
(
ş›ÁSessiÚId
);

104 ià(
ş›Á
 !ğ
NULL
) {

105 
ş›Á
->
	`upd©eS‹OnPÏyChªge
(
F®£
);

110 
OnDemªdS”v”MedŸSub£ssiÚ
::
	`·u£SŒ—m
(
ş›ÁSessiÚId
, 
¡»amTok’
);

111 
	}
}

113 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


114 ::
	$£ekSŒ—m
(
ş›ÁSessiÚId
, * 
¡»amTok’
, & 
£ekNPT
, 
¡»amDu¿tiÚ
, 
u_št64_t
& 
numBy‹s
) {

116 
OnDemªdS”v”MedŸSub£ssiÚ
::
	`£ekSŒ—m
(
ş›ÁSessiÚId
, 
¡»amTok’
, 
£ekNPT
, 
¡»amDu¿tiÚ
, 
numBy‹s
);

119 ià(
fIndexFe
 !ğ
NULL
) {

120 
Cl›ÁTrickPÏyS‹
* 
ş›Á
 = 
	`lookupCl›Á
(
ş›ÁSessiÚId
);

121 ià(
ş›Á
 !ğ
NULL
) {

122 
numTSPack‘sToSŒ—m
 = 
ş›Á
->
	`upd©eS‹FromNPT
(
£ekNPT
, 
¡»amDu¿tiÚ
);

123 
numBy‹s
 = 
numTSPack‘sToSŒ—m
*
TRANSPORT_PACKET_SIZE
;

126 
	}
}

128 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


129 ::
	$£tSŒ—mSÿË
(
ş›ÁSessiÚId
, * 
¡»amTok’
, 
sÿË
) {

130 ià(
fIndexFe
 !ğ
NULL
) {

131 
Cl›ÁTrickPÏyS‹
* 
ş›Á
 = 
	`lookupCl›Á
(
ş›ÁSessiÚId
);

132 ià(
ş›Á
 !ğ
NULL
) {

133 
ş›Á
->
	`£tNextSÿË
(
sÿË
);

138 
OnDemªdS”v”MedŸSub£ssiÚ
::
	`£tSŒ—mSÿË
(
ş›ÁSessiÚId
, 
¡»amTok’
, 
sÿË
);

139 
	}
}

141 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


142 ::
	$d–‘eSŒ—m
(
ş›ÁSessiÚId
, *& 
¡»amTok’
) {

143 ià(
fIndexFe
 !ğ
NULL
) {

144 
Cl›ÁTrickPÏyS‹
* 
ş›Á
 = 
	`lookupCl›Á
(
ş›ÁSessiÚId
);

145 ià(
ş›Á
 !ğ
NULL
) {

146 
ş›Á
->
	`upd©eS‹OnPÏyChªge
(
F®£
);

151 
OnDemªdS”v”MedŸSub£ssiÚ
::
	`d–‘eSŒ—m
(
ş›ÁSessiÚId
, 
¡»amTok’
);

152 
	}
}

154 
Cl›ÁTrickPÏyS‹
* 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
::
	$ÃwCl›ÁTrickPÏyS‹
() {

155  
Ãw
 
	`Cl›ÁTrickPÏyS‹
(
fIndexFe
);

156 
	}
}

158 
F¿medSourû
* 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


159 ::
	$ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, & 
e¡B™¿‹
) {

161 cÚ¡ 
šputD©aChunkSize


162 ğ
TRANSPORT_PACKETS_PER_NETWORK_PACKET
*
TRANSPORT_PACKET_SIZE
;

163 
By‹SŒ—mFeSourû
* 
feSourû


164 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
, 
šputD©aChunkSize
);

165 ià(
feSourû
 =ğ
NULL
)  NULL;

166 
fFeSize
 = 
feSourû
->
	`feSize
();

169 ià(
fFeSize
 > 0 && 
fDu¿tiÚ
 > 0.0) {

170 
e¡B™¿‹
 = ()((
št64_t
)
fFeSize
/(125*
fDu¿tiÚ
) + 0.5);

172 
e¡B™¿‹
 = 5000;

177 
MPEG2T¿n¥ÜtSŒ—mF¿m”
* 
äam”


178 ğ
MPEG2T¿n¥ÜtSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
);

180 ià(
fIndexFe
 !ğ
NULL
) {

182 
Cl›ÁTrickPÏyS‹
* 
ş›Á
 = 
	`lookupCl›Á
(
ş›ÁSessiÚId
);

183 ià(
ş›Á
 =ğ
NULL
) {

184 
ş›Á
 = 
	`ÃwCl›ÁTrickPÏyS‹
();

185 
fCl›ÁSessiÚHashTabË
->
	`Add
((cÚ¡*)
ş›ÁSessiÚId
, 
ş›Á
);

187 
ş›Á
->
	`£tSourû
(
äam”
);

190  
äam”
;

191 
	}
}

193 
RTPSšk
* 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


194 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

196 
F¿medSourû
* ) {

197  
Sim¶eRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

199 1, 
True
, 
F®£
 );

200 
	}
}

202 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
::
	$‹¡SÿËFaùÜ
(& 
sÿË
) {

203 ià(
fIndexFe
 !ğ
NULL
 && 
fDu¿tiÚ
 > 0.0) {

205 
iSÿË
 = 
sÿË
 < 0.0 ? ()(scale - 0.5f) : ()(scale + 0.5f);

206 ià(
iSÿË
 == 0) iScale = 1;

207 
sÿË
 = ()
iSÿË
;

209 
sÿË
 = 1.0f;

211 
	}
}

213 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
() const {

214  
fDu¿tiÚ
;

215 
	}
}

217 
Cl›ÁTrickPÏyS‹
* 
	gMPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


218 ::
	$lookupCl›Á
(
ş›ÁSessiÚId
) {

219  (
Cl›ÁTrickPÏyS‹
*)(
fCl›ÁSessiÚHashTabË
->
	`Lookup
((cÚ¡*)
ş›ÁSessiÚId
));

220 
	}
}

225 
	gCl›ÁTrickPÏyS‹
::
	$Cl›ÁTrickPÏyS‹
(
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe
)

226 : 
	`fIndexFe
(
šdexFe
),

227 
	`fOrigš®T¿n¥ÜtSŒ—mSourû
(
NULL
),

228 
	`fTrickModeF‹r
(
NULL
), 
	`fTrickPÏySourû
(NULL),

229 
	`fF¿m”
(
NULL
),

230 
	`fSÿË
(1.0f), 
	`fNextSÿË
(1.0f), 
	`fNPT
(0.0f),

231 
	`fTSRecÜdNum
(0), 
	$fIxRecÜdNum
(0) {

232 
	}
}

234 
	gCl›ÁTrickPÏyS‹
::
	$upd©eS‹FromNPT
(
Åt
, 
¡»amDu¿tiÚ
) {

235 
fNPT
 = ()
Åt
;

237 
tsRecÜdNum
, 
ixRecÜdNum
;

238 
fIndexFe
->
	`lookupTSPack‘NumFromNPT
(
fNPT
, 
tsRecÜdNum
, 
ixRecÜdNum
);

240 
	`upd©eTSRecÜdNum
();

241 ià(
tsRecÜdNum
 !ğ
fTSRecÜdNum
) {

242 
fTSRecÜdNum
 = 
tsRecÜdNum
;

243 
fIxRecÜdNum
 = 
ixRecÜdNum
;

246 
	`»£ekOrigš®T¿n¥ÜtSŒ—mSourû
();

251 
fF¿m”
->
	`ş—rPIDStusTabË
();

254 
numTSRecÜdsToSŒ—m
 = 0;

255 
püLim™
 = 0.0;

256 ià(
¡»amDu¿tiÚ
 > 0.0) {

258 
¡»amDu¿tiÚ
 +ğ
Åt
 - ()
fNPT
;

260 ià(
¡»amDu¿tiÚ
 > 0.0) {

263 ià(
fNextSÿË
 == 1.0f) {

266 
toTSRecÜdNum
, 
toIxRecÜdNum
;

267 
toNPT
 = ()(
fNPT
 + 
¡»amDu¿tiÚ
);

268 
fIndexFe
->
	`lookupTSPack‘NumFromNPT
(
toNPT
, 
toTSRecÜdNum
, 
toIxRecÜdNum
);

269 ià(
toTSRecÜdNum
 > 
tsRecÜdNum
) {

270 
numTSRecÜdsToSŒ—m
 = 
toTSRecÜdNum
 - 
tsRecÜdNum
;

276 
dœeùiÚ
 = 
fNextSÿË
 < 0.0 ? -1 : 1;

277 
püLim™
 = ()(
¡»amDu¿tiÚ
/(
fNextSÿË
*
dœeùiÚ
));

281 
fF¿m”
->
	`£tNumTSPack‘sToSŒ—m
(
numTSRecÜdsToSŒ—m
);

282 
fF¿m”
->
	`£tPCRLim™
(
püLim™
);

284  
numTSRecÜdsToSŒ—m
;

285 
	}
}

287 
	gCl›ÁTrickPÏyS‹
::
	$upd©eS‹OnSÿËChªge
() {

288 
fSÿË
 = 
fNextSÿË
;

292 ià(
fTrickPÏySourû
 !ğ
NULL
) {

293 
fTrickModeF‹r
->
	`fÜg‘IÅutSourû
();

295 
Medium
::
	`şo£
(
fTrickPÏySourû
);

296 
fTrickPÏySourû
 = 
NULL
;

297 
fTrickModeF‹r
 = 
NULL
;

299 ià(
fNextSÿË
 != 1.0f) {

301 
U§geEnvœÚm’t
& 
’v
 = 
fIndexFe
->
	`’vœ
();

302 
fTrickModeF‹r
 = 
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r


303 ::
	`ü—‹New
(
’v
, 
fOrigš®T¿n¥ÜtSŒ—mSourû
, 
fIndexFe
, (
fNextSÿË
));

304 
fTrickModeF‹r
->
	`£ekTo
(
fTSRecÜdNum
, 
fIxRecÜdNum
);

307 
fTrickPÏySourû
 = 
MPEG2T¿n¥ÜtSŒ—mFromESSourû
::
	`ü—‹New
(
’v
);

308 
fTrickPÏySourû
->
	`addNewVideoSourû
(
fTrickModeF‹r
, 
fIndexFe
->
	`m³gV”siÚ
());

310 
fF¿m”
->
	`chªgeIÅutSourû
(
fTrickPÏySourû
);

313 
	`»£ekOrigš®T¿n¥ÜtSŒ—mSourû
();

314 
fF¿m”
->
	`chªgeIÅutSourû
(
fOrigš®T¿n¥ÜtSŒ—mSourû
);

316 
	}
}

318 
	gCl›ÁTrickPÏyS‹
::
	$upd©eS‹OnPÏyChªge
(
BoŞ—n
 
»v”£ToP»viousVSH
) {

319 
	`upd©eTSRecÜdNum
();

320 ià(
fTrickPÏySourû
 =ğ
NULL
) {

323 
fIndexFe
->
	`lookupPCRFromTSPack‘Num
(
fTSRecÜdNum
, 
»v”£ToP»viousVSH
, 
fNPT
, 
fIxRecÜdNum
);

327 
fIxRecÜdNum
 = 
fTrickModeF‹r
->
	`ÃxtIndexRecÜdNum
();

328 ià(()
fIxRecÜdNum
 < 0) fIxRecordNum = 0;

329 
Œª¥ÜtRecÜdNum
;

330 
pü
;

331 
u_št8_t
 
off£t
, 
size
, 
»cÜdTy³
;

332 ià(
fIndexFe
->
	`»adIndexRecÜdV®ues
(
fIxRecÜdNum
, 
Œª¥ÜtRecÜdNum
,

333 
off£t
, 
size
, 
pü
, 
»cÜdTy³
)) {

334 
fTSRecÜdNum
 = 
Œª¥ÜtRecÜdNum
;

335 
fNPT
 = 
pü
;

338 
	}
}

340 
	gCl›ÁTrickPÏyS‹
::
	$£tSourû
(
MPEG2T¿n¥ÜtSŒ—mF¿m”
* 
äam”
) {

341 
fF¿m”
 = 
äam”
;

342 
fOrigš®T¿n¥ÜtSŒ—mSourû
 = (
By‹SŒ—mFeSourû
*)(
äam”
->
	`šputSourû
());

343 
	}
}

345 
	gCl›ÁTrickPÏyS‹
::
	$upd©eTSRecÜdNum
(){

346 ià(
fF¿m”
 !ğ
NULL
è
fTSRecÜdNum
 +ğ()(fF¿m”->
	`tsPack‘CouÁ
());

347 
	}
}

349 
	gCl›ÁTrickPÏyS‹
::
	$»£ekOrigš®T¿n¥ÜtSŒ—mSourû
() {

350 
u_št64_t
 
tsRecÜdNum64
 = (u_št64_t)
fTSRecÜdNum
;

351 
fOrigš®T¿n¥ÜtSŒ—mSourû
->
	`£ekToBy‹AbsŞu‹
(
tsRecÜdNum64
*
TRANSPORT_PACKET_SIZE
);

352 
	}
}

	@liveMedia/MPEG2TransportStreamFramer.cpp

23 
	~"MPEG2T¿n¥ÜtSŒ—mF¿m”.hh
"

24 
	~<GroupsockH–³r.hh
>

26 
	#TRANSPORT_PACKET_SIZE
 188

	)

30 #ià!
defšed
(
NEW_DURATION_WEIGHT
)

31 
	#NEW_DURATION_WEIGHT
 0.5

	)

35 #ià!
defšed
(
TIME_ADJUSTMENT_FACTOR
)

36 
	#TIME_ADJUSTMENT_FACTOR
 0.8

	)

43 #ià!
defšed
(
MAX_PLAYOUT_BUFFER_DURATION
)

44 
	#MAX_PLAYOUT_BUFFER_DURATION
 0.1

46 

	)

47 #ià!
defšed
(
PCR_PERIOD_VARIATION_RATIO
)

48 
	#PCR_PERIOD_VARIATION_RATIO
 0.5

	)

53 şas 
	cPIDStus
 {

54 
	mpublic
:

55 
	$PIDStus
(
_fœ¡Clock
, 
_fœ¡R—lTime
)

56 : 
	`fœ¡Clock
(
_fœ¡Clock
), 
	`Ï¡Clock
(_firstClock),

57 
	`fœ¡R—lTime
(
_fœ¡R—lTime
), 
	`Ï¡R—lTime
(_firstRealTime),

58 
	$Ï¡Pack‘Num
(0) {

61 
fœ¡Clock
, 
Ï¡Clock
, 
fœ¡R—lTime
, 
Ï¡R—lTime
;

62 
u_št64_t
 
Ï¡Pack‘Num
;

63 
	}
};

68 
MPEG2T¿n¥ÜtSŒ—mF¿m”
* 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”


69 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

70  
Ãw
 
	`MPEG2T¿n¥ÜtSŒ—mF¿m”
(
’v
, 
šputSourû
);

71 
	}
}

73 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”


74 ::
	$MPEG2T¿n¥ÜtSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
)

75 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

76 
	`fTSPack‘CouÁ
(0), 
	`fTSPack‘Du¿tiÚE¡im©e
(0.0), 
	`fTSPCRCouÁ
(0),

77 
	`fLim™NumTSPack‘sToSŒ—m
(
F®£
), 
	`fNumTSPack‘sToSŒ—m
(0),

78 
	`fLim™TSPack‘sToSŒ—mByPCR
(
F®£
), 
	$fPCRLim™
(0.0) {

79 
fPIDStusTabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

80 
	}
}

82 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::~
	$MPEG2T¿n¥ÜtSŒ—mF¿m”
() {

83 
	`ş—rPIDStusTabË
();

84 
d–‘e
 
fPIDStusTabË
;

85 
	}
}

87 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$ş—rPIDStusTabË
() {

88 
PIDStus
* 
pidStus
;

89 (
pidStus
 = (
PIDStus
*)
fPIDStusTabË
->
	`RemoveNext
()è!ğ
NULL
) {

90 
d–‘e
 
pidStus
;

92 
	}
}

94 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$£tNumTSPack‘sToSŒ—m
(
numTSRecÜdsToSŒ—m
) {

95 
fNumTSPack‘sToSŒ—m
 = 
numTSRecÜdsToSŒ—m
;

96 
fLim™NumTSPack‘sToSŒ—m
 = 
numTSRecÜdsToSŒ—m
 > 0;

97 
	}
}

99 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$£tPCRLim™
(
püLim™
) {

100 
fPCRLim™
 = 
püLim™
;

101 
fLim™TSPack‘sToSŒ—mByPCR
 = 
püLim™
 != 0.0;

102 
	}
}

104 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$doG‘NextF¿me
() {

105 ià(
fLim™NumTSPack‘sToSŒ—m
) {

106 ià(
fNumTSPack‘sToSŒ—m
 == 0) {

107 
	`hªdËClosu»
();

110 ià(
fNumTSPack‘sToSŒ—m
*
TRANSPORT_PACKET_SIZE
 < 
fMaxSize
) {

111 
fMaxSize
 = 
fNumTSPack‘sToSŒ—m
*
TRANSPORT_PACKET_SIZE
;

116 
fF¿meSize
 = 0;

117 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

118 
aá”G‘tšgF¿me
, 
this
,

119 
F¿medSourû
::
hªdËClosu»
, 
this
);

120 
	}
}

122 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$doStİG‘tšgF¿mes
() {

123 
F¿medF‹r
::
	`doStİG‘tšgF¿mes
();

124 
fTSPack‘CouÁ
 = 0;

125 
fTSPCRCouÁ
 = 0;

127 
	`ş—rPIDStusTabË
();

128 
	}
}

130 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”


131 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

133 
timev®
 
´e£Á©iÚTime
,

135 
MPEG2T¿n¥ÜtSŒ—mF¿m”
* 
äam”
 = (MPEG2T¿n¥ÜtSŒ—mF¿m”*)
ş›ÁD©a
;

136 
äam”
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
´e£Á©iÚTime
);

137 
	}
}

139 
	#TRANSPORT_SYNC_BYTE
 0x47

	)

141 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$aá”G‘tšgF¿me1
(
äameSize
,

142 
timev®
 
´e£Á©iÚTime
) {

143 
fF¿meSize
 +ğ
äameSize
;

144 cÚ¡ 
numTSPack‘s
 = 
fF¿meSize
/
TRANSPORT_PACKET_SIZE
;

145 
fNumTSPack‘sToSŒ—m
 -ğ
numTSPack‘s
;

146 
fF¿meSize
 = 
numTSPack‘s
*
TRANSPORT_PACKET_SIZE
;

147 ià(
fF¿meSize
 == 0) {

149 
	`hªdËClosu»
();

154 
syncBy‹Pos™iÚ
;

155 
syncBy‹Pos™iÚ
 = 0; syncBy‹Pos™iÚ < 
fF¿meSize
; ++syncBytePosition) {

156 ià(
fTo
[
syncBy‹Pos™iÚ
] =ğ
TRANSPORT_SYNC_BYTE
) ;

158 ià(
syncBy‹Pos™iÚ
 =ğ
fF¿meSize
) {

159 
	`’vœ
() << "No Transport Stream sync byte in data.";

160 
	`hªdËClosu»
();

162 } ià(
syncBy‹Pos™iÚ
 > 0) {

165 
	`memmove
(
fTo
, &fTo[
syncBy‹Pos™iÚ
], 
fF¿meSize
 - syncBytePosition);

166 
fF¿meSize
 -ğ
syncBy‹Pos™iÚ
;

167 
fIÅutSourû
->
	`g‘NextF¿me
(&
fTo
[
fF¿meSize
], 
syncBy‹Pos™iÚ
,

168 
aá”G‘tšgF¿me
, 
this
,

169 
F¿medSourû
::
hªdËClosu»
, 
this
);

173 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

177 
timev®
 
tvNow
;

178 
	`g‘timeofday
(&
tvNow
, 
NULL
);

179 
timeNow
 = 
tvNow
.
tv_£c
 +vNow.
tv_u£c
/1000000.0;

180 
i
 = 0; i < 
numTSPack‘s
; ++i) {

181 ià(!
	`upd©eTSPack‘Du¿tiÚE¡im©e
(&
fTo
[
i
*
TRANSPORT_PACKET_SIZE
], 
timeNow
)) {

183 
	`hªdËClosu»
();

188 
fDu¿tiÚInMiüo£cÚds


189 ğ
numTSPack‘s
 * ()(
fTSPack‘Du¿tiÚE¡im©e
*1000000);

192 
	`aá”G‘tšg
(
this
);

193 
	}
}

195 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mF¿m”
::
	$upd©eTSPack‘Du¿tiÚE¡im©e
(* 
pkt
, 
timeNow
) {

197 ià(
pkt
[0] !ğ
TRANSPORT_SYNC_BYTE
) {

198 
	`’vœ
() << "Missing sync byte!\n";

199  
True
;

202 ++
fTSPack‘CouÁ
;

205 
u_št8_t
 cÚ¡ 
ad­tiÚ_f›ld_cÚŒŞ
 = (
pkt
[3]&0x30)>>4;

206 ià(
ad­tiÚ_f›ld_cÚŒŞ
 !ğ2 &&‡d­tiÚ_f›ld_cÚŒŞ !ğ3è 
True
;

209 
u_št8_t
 cÚ¡ 
ad­tiÚ_f›ld_Ëngth
 = 
pkt
[4];

210 ià(
ad­tiÚ_f›ld_Ëngth
 =ğ0è 
True
;

212 
u_št8_t
 cÚ¡ 
discÚtšu™y_šdiÿtÜ
 = 
pkt
[5]&0x80;

213 
u_št8_t
 cÚ¡ 
püFÏg
 = 
pkt
[5]&0x10;

214 ià(
püFÏg
 =ğ0è 
True
;

217 ++
fTSPCRCouÁ
;

218 
u_št32_t
 
püBa£High
 = (
pkt
[6]<<24)|(pkt[7]<<16)|(pkt[8]<<8)|pkt[9];

219 
şock
 = 
püBa£High
/45000.0;

220 ià((
pkt
[10]&0x80è!ğ0è
şock
 += 1/90000.0;

221 
püExt
 = ((
pkt
[10]&0x01)<<8) |…kt[11];

222 
şock
 +ğ
püExt
/27000000.0;

223 ià(
fLim™TSPack‘sToSŒ—mByPCR
) {

224 ià(
şock
 > 
fPCRLim™
) {

226  
F®£
;

230 
pid
 = ((
pkt
[1]&0x1F)<<8) |…kt[2];

233 
PIDStus
* 
pidStus
 = (PIDStus*)(
fPIDStusTabË
->
	`Lookup
((*)
pid
));

235 ià(
pidStus
 =ğ
NULL
) {

237 
pidStus
 = 
Ãw
 
	`PIDStus
(
şock
, 
timeNow
);

238 
fPIDStusTabË
->
	`Add
((*)
pid
, 
pidStus
);

239 #ifdeà
DEBUG_PCR


240 
	`årštf
(
¡d”r
, "PID 0x%x, FIRST PCR 0x%08x+%d:%03x =ğ%à@ %f,…kˆ#%lu\n", 
pid
, 
püBa£High
, 
pkt
[10]>>7, 
püExt
, 
şock
, 
timeNow
, 
fTSPack‘CouÁ
);

244 
št64_t
 
·ck‘sSšûLa¡
 = (št64_t)(
fTSPack‘CouÁ
 - 
pidStus
->
Ï¡Pack‘Num
);

246 
du¿tiÚP”Pack‘
 = (
şock
 - 
pidStus
->
Ï¡Clock
)/
·ck‘sSšûLa¡
;

250 
m—nPCRP”iod
 = 0.0;

251 ià(
fTSPCRCouÁ
 > 0) {

252 
tsPack‘CouÁ
 = ()(
št64_t
)
fTSPack‘CouÁ
;

253 
tsPCRCouÁ
 = ()(
št64_t
)
fTSPCRCouÁ
;

254 
m—nPCRP”iod
 = 
tsPack‘CouÁ
/
tsPCRCouÁ
;

255 ià(
·ck‘sSšûLa¡
 < 
m—nPCRP”iod
*
PCR_PERIOD_VARIATION_RATIO
è 
True
;

258 ià(
fTSPack‘Du¿tiÚE¡im©e
 == 0.0) {

259 
fTSPack‘Du¿tiÚE¡im©e
 = 
du¿tiÚP”Pack‘
;

260 } ià(
discÚtšu™y_šdiÿtÜ
 =ğ0 && 
du¿tiÚP”Pack‘
 >= 0.0) {

261 
fTSPack‘Du¿tiÚE¡im©e


262 ğ
du¿tiÚP”Pack‘
*
NEW_DURATION_WEIGHT


263 + 
fTSPack‘Du¿tiÚE¡im©e
*(1-
NEW_DURATION_WEIGHT
);

267 
Œªsm™Du¿tiÚ
 = 
timeNow
 - 
pidStus
->
fœ¡R—lTime
;

268 
¶ayoutDu¿tiÚ
 = 
şock
 - 
pidStus
->
fœ¡Clock
;

269 ià(
Œªsm™Du¿tiÚ
 > 
¶ayoutDu¿tiÚ
) {

270 
fTSPack‘Du¿tiÚE¡im©e
 *ğ
TIME_ADJUSTMENT_FACTOR
;

271 } ià(
Œªsm™Du¿tiÚ
 + 
MAX_PLAYOUT_BUFFER_DURATION
 < 
¶ayoutDu¿tiÚ
) {

272 
fTSPack‘Du¿tiÚE¡im©e
 /ğ
TIME_ADJUSTMENT_FACTOR
;

277 
pidStus
->
fœ¡Clock
 = 
şock
;

278 
pidStus
->
fœ¡R—lTime
 = 
timeNow
;

280 #ifdeà
DEBUG_PCR


281 
	`årštf
(
¡d”r
, "PID 0x%x, PCR 0x%08x+%d:%03x =ğ%à@ %à(diff %à@ %f),…kˆ#%lu, discÚ %d =>hi du¿tiÚ %f,‚ewƒ¡im©%f, m—ÀPCR…”iod=%f\n", 
pid
, 
püBa£High
, 
pkt
[10]>>7, 
püExt
, 
şock
, 
timeNow
, clock - 
pidStus
->
fœ¡Clock
,imeNow -…idStus->
fœ¡R—lTime
, 
fTSPack‘CouÁ
, 
discÚtšu™y_šdiÿtÜ
 !ğ0, 
du¿tiÚP”Pack‘
, 
fTSPack‘Du¿tiÚE¡im©e
, 
m—nPCRP”iod
 );

285 
pidStus
->
Ï¡Clock
 = 
şock
;

286 
pidStus
->
Ï¡R—lTime
 = 
timeNow
;

287 
pidStus
->
Ï¡Pack‘Num
 = 
fTSPack‘CouÁ
;

289  
True
;

290 
	}
}

	@liveMedia/MPEG2TransportStreamFromESSource.cpp

22 
	~"MPEG2T¿n¥ÜtSŒ—mFromESSourû.hh
"

24 
	#MAX_INPUT_ES_FRAME_SIZE
 100000

	)

25 
	#SIMPLE_PES_HEADER_SIZE
 14

	)

26 
	#LOW_WATER_MARK
 1000

27 
	#INPUT_BUFFER_SIZE
 (
SIMPLE_PES_HEADER_SIZE
 + 2*
MAX_INPUT_ES_FRAME_SIZE
)

	)

31 şas 
	cIÅutESSourûRecÜd
 {

32 
	mpublic
:

33 
IÅutESSourûRecÜd
(
MPEG2T¿n¥ÜtSŒ—mFromESSourû
& 
·»Á
,

34 
F¿medSourû
* 
šputSourû
,

35 
u_št8_t
 
¡»amId
, 
m³gV”siÚ
,

36 
IÅutESSourûRecÜd
* 
Ãxt
, 
št16_t
 
PID
 = -1);

37 
	mvœtu®
 ~
IÅutESSourûRecÜd
();

39 
IÅutESSourûRecÜd
* 
	$Ãxt
(ècÚ¡ {  
fNext
; }

40 
F¿medSourû
* 
	$šputSourû
(ècÚ¡ {  
fIÅutSourû
; 
	}
}

42 
askFÜNewD©a
();

43 
BoŞ—n
 
d–iv”BufãrToCl›Á
();

45 * 
	$bufãr
(ècÚ¡ {  
fIÅutBufãr
; 
	}
}

46 
	$»£t
() {

48 
fIÅutBufãrBy‹sAvaabË
 = 0;

49 
fIÅutBufãrInU£
 = 
F®£
;

50 
	}
}

52 
	g´iv©e
:

53 
aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

54 
numTrunÿ‹dBy‹s
,

55 
timev®
 
´e£Á©iÚTime
,

56 
du¿tiÚInMiüo£cÚds
);

57 
aá”G‘tšgF¿me1
(
äameSize
,

58 
numTrunÿ‹dBy‹s
,

59 
timev®
 
´e£Á©iÚTime
);

61 
	g´iv©e
:

62 
IÅutESSourûRecÜd
* 
fNext
;

63 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû
& 
	gfP¬’t
;

64 
F¿medSourû
* 
	gfIÅutSourû
;

65 
u_št8_t
 
	gfSŒ—mId
;

66 
	gfMPEGV”siÚ
;

67 * 
	gfIÅutBufãr
;

68 
	gfIÅutBufãrBy‹sAvaabË
;

69 
BoŞ—n
 
	gfIÅutBufãrInU£
;

70 
	gMPEG1Ü2Demux
::
SCR
 
fSCR
;

71 
št16_t
 
	gfPID
;

77 
MPEG2T¿n¥ÜtSŒ—mFromESSourû
* 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû


78 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
) {

79  
Ãw
 
	`MPEG2T¿n¥ÜtSŒ—mFromESSourû
(
’v
);

80 
	}
}

82 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû


83 ::
	$addNewVideoSourû
(
F¿medSourû
* 
šputSourû
, 
m³gV”siÚ
, 
št16_t
 
PID
) {

84 
u_št8_t
 
¡»amId
 = 0xE0 | (
fVideoSourûCouÁ”
++&0x0F);

85 
	`addNewIÅutSourû
(
šputSourû
, 
¡»amId
, 
m³gV”siÚ
, 
PID
);

86 
fHaveVideoSŒ—ms
 = 
True
;

87 
	}
}

89 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû


90 ::
	$addNewAudioSourû
(
F¿medSourû
* 
šputSourû
, 
m³gV”siÚ
, 
št16_t
 
PID
) {

91 
u_št8_t
 
¡»amId
 = 0xC0 | (
fAudioSourûCouÁ”
++&0x0F);

92 
	`addNewIÅutSourû
(
šputSourû
, 
¡»amId
, 
m³gV”siÚ
, 
PID
);

93 
	}
}

95 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû


96 ::
	$MPEG2T¿n¥ÜtSŒ—mFromESSourû
(
U§geEnvœÚm’t
& 
’v
)

97 : 
	`MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
(
’v
),

98 
	`fIÅutSourûs
(
NULL
), 
	`fVideoSourûCouÁ”
(0), 
	`fAudioSourûCouÁ”
(0),

99 
	$fAwa™šgBackgroundD–iv”y
(
F®£
) {

100 
fHaveVideoSŒ—ms
 = 
F®£
;

101 
	}
}

103 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû
::~
	$MPEG2T¿n¥ÜtSŒ—mFromESSourû
() {

104 
	`doStİG‘tšgF¿mes
();

105 
d–‘e
 
fIÅutSourûs
;

106 
	}
}

108 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû
::
	$doStİG‘tšgF¿mes
() {

110 
IÅutESSourûRecÜd
* 
sourûRec
 = 
fIÅutSourûs
; sourûReø!ğ
NULL
;

111 
sourûRec
 = sourûRec->
	`Ãxt
()) {

112 
sourûRec
->
	`šputSourû
()->
	`¡İG‘tšgF¿mes
();

114 
	}
}

116 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû


117 ::
	$awa™NewBufãr
(* 
ŞdBufãr
) {

118 
IÅutESSourûRecÜd
* 
sourûRec
;

120 ià(
ŞdBufãr
 !ğ
NULL
) {

121 
sourûRec
 = 
fIÅutSourûs
; sourûReø!ğ
NULL
;

122 
sourûRec
 = sourûRec->
	`Ãxt
()) {

123 ià(
sourûRec
->
	`bufãr
(è=ğ
ŞdBufãr
) {

124 
sourûRec
->
	`»£t
();

128 
fAwa™šgBackgroundD–iv”y
 = 
F®£
;

131 ià(
	`isCu¼’yAwa™šgD©a
()) {

133 
sourûRec
 = 
fIÅutSourûs
; sourûReø!ğ
NULL
;

134 
sourûRec
 = sourûRec->
	`Ãxt
()) {

135 ià(
sourûRec
->
	`d–iv”BufãrToCl›Á
()) ;

137 
fAwa™šgBackgroundD–iv”y
 = 
True
;

141 
sourûRec
 = 
fIÅutSourûs
; sourûReø!ğ
NULL
;

142 
sourûRec
 = sourûRec->
	`Ãxt
()) {

143 
sourûRec
->
	`askFÜNewD©a
();

145 
	}
}

147 
	gMPEG2T¿n¥ÜtSŒ—mFromESSourû


148 ::
	$addNewIÅutSourû
(
F¿medSourû
* 
šputSourû
,

149 
u_št8_t
 
¡»amId
, 
m³gV”siÚ
, 
št16_t
 
PID
) {

150 ià(
šputSourû
 =ğ
NULL
) ;

151 
fIÅutSourûs
 = 
Ãw
 
	`IÅutESSourûRecÜd
(*
this
, 
šputSourû
, 
¡»amId
,

152 
m³gV”siÚ
, 
fIÅutSourûs
, 
PID
);

153 
	}
}

158 
	gIÅutESSourûRecÜd


159 ::
	$IÅutESSourûRecÜd
(
MPEG2T¿n¥ÜtSŒ—mFromESSourû
& 
·»Á
,

160 
F¿medSourû
* 
šputSourû
,

161 
u_št8_t
 
¡»amId
, 
m³gV”siÚ
,

162 
IÅutESSourûRecÜd
* 
Ãxt
, 
št16_t
 
PID
)

163 : 
	`fNext
(
Ãxt
), 
	`fP¬’t
(
·»Á
), 
	`fIÅutSourû
(
šputSourû
),

164 
	`fSŒ—mId
(
¡»amId
), 
	`fMPEGV”siÚ
(
m³gV”siÚ
), 
	$fPID
(
PID
) {

165 
fIÅutBufãr
 = 
Ãw
 [
INPUT_BUFFER_SIZE
];

166 
	`»£t
();

167 
	}
}

169 
	gIÅutESSourûRecÜd
::~
	$IÅutESSourûRecÜd
() {

170 
Medium
::
	`şo£
(
fIÅutSourû
);

171 
d–‘e
[] 
fIÅutBufãr
;

172 
d–‘e
 
fNext
;

173 
	}
}

175 
	gIÅutESSourûRecÜd
::
	$askFÜNewD©a
() {

176 ià(
fIÅutBufãrInU£
) ;

178 ià(
fIÅutBufãrBy‹sAvaabË
 == 0) {

180 
fIÅutBufãr
[0] = 0; fInputBuffer[1] = 0; fInputBuffer[2] = 1;

181 
fIÅutBufãr
[3] = 
fSŒ—mId
;

182 
fIÅutBufãr
[4] = 0; fInputBuffer[5] = 0;

183 
fIÅutBufãr
[6] = 0x80;

184 
fIÅutBufãr
[7] = 0x80;

185 
fIÅutBufãr
[8] = 5;

187 
fIÅutBufãrBy‹sAvaabË
 = 
SIMPLE_PES_HEADER_SIZE
;

189 ià(
fIÅutBufãrBy‹sAvaabË
 < 
LOW_WATER_MARK
 &&

190 !
fIÅutSourû
->
	`isCu¼’yAwa™šgD©a
()) {

192 
fIÅutSourû
->
	`g‘NextF¿me
(&
fIÅutBufãr
[
fIÅutBufãrBy‹sAvaabË
],

193 
INPUT_BUFFER_SIZE
-
fIÅutBufãrBy‹sAvaabË
,

194 
aá”G‘tšgF¿me
, 
this
,

195 
F¿medSourû
::
hªdËClosu»
, &
fP¬’t
);

197 
	}
}

199 
BoŞ—n
 
	gIÅutESSourûRecÜd
::
	$d–iv”BufãrToCl›Á
() {

200 ià(
fIÅutBufãrInU£
 || 
fIÅutBufãrBy‹sAvaabË
 < 
LOW_WATER_MARK
è 
F®£
;

203 
PES_·ck‘_Ëngth
 = 
fIÅutBufãrBy‹sAvaabË
 - 6;

204 ià(
PES_·ck‘_Ëngth
 > 0xFFFF) {

206 
PES_·ck‘_Ëngth
 = 0;

208 
fIÅutBufãr
[4] = 
PES_·ck‘_Ëngth
>>8;

209 
fIÅutBufãr
[5] = 
PES_·ck‘_Ëngth
;

212 
fIÅutBufãr
[9] = 0x20|(
fSCR
.
highB™
<<3)|(fSCR.
»maššgB™s
>>29)|0x01;

213 
fIÅutBufãr
[10] = 
fSCR
.
»maššgB™s
>>22;

214 
fIÅutBufãr
[11] = (
fSCR
.
»maššgB™s
>>14)|0x01;

215 
fIÅutBufãr
[12] = 
fSCR
.
»maššgB™s
>>7;

216 
fIÅutBufãr
[13] = (
fSCR
.
»maššgB™s
<<1)|0x01;

218 
fIÅutBufãrInU£
 = 
True
;

221 
fP¬’t
.
	`hªdËNewBufãr
(
fIÅutBufãr
, 
fIÅutBufãrBy‹sAvaabË
,

222 
fMPEGV”siÚ
, 
fSCR
, 
fPID
);

224  
True
;

225 
	}
}

227 
	gIÅutESSourûRecÜd


228 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

229 
numTrunÿ‹dBy‹s
,

230 
timev®
 
´e£Á©iÚTime
,

232 
IÅutESSourûRecÜd
* 
sourû
 = (IÅutESSourûRecÜd*)
ş›ÁD©a
;

233 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
);

234 
	}
}

235 
	gIÅutESSourûRecÜd


236 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

237 
timev®
 
´e£Á©iÚTime
) {

238 ià(
numTrunÿ‹dBy‹s
 > 0) {

239 
fP¬’t
.
	`’vœ
() << "MPEG2TransportStreamFromESSource: input bufferoo small; increase \"MAX_INPUT_ES_FRAME_SIZE\" in \"MPEG2TransportStreamFromESSource\" by‡t†east "

240 << 
numTrunÿ‹dBy‹s
 << " bytes!\n";

243 ià(
fIÅutBufãrBy‹sAvaabË
 =ğ
SIMPLE_PES_HEADER_SIZE
) {

245 
fSCR
.
highB™


246 ğ((
´e£Á©iÚTime
.
tv_£c
*45000 + (´e£Á©iÚTime.
tv_u£c
*9)/200)&

248 
fSCR
.
»maššgB™s


249 ğ
´e£Á©iÚTime
.
tv_£c
*90000 + (´e£Á©iÚTime.
tv_u£c
*9)/100;

250 
fSCR
.
ex‹nsiÚ
 = (
´e£Á©iÚTime
.
tv_u£c
*9)%100;

251 #ifdeà
DEBUG_SCR


252 
	`årštf
(
¡d”r
, "PES h—d”: sŒ—m_id 0x%02x,…ts: %u.%06u => SCR 0x%x%08x:%03x\n", 
fSŒ—mId
, ()
´e£Á©iÚTime
.
tv_£c
, (í»£Á©iÚTime.
tv_u£c
, 
fSCR
.
highB™
, fSCR.
»maššgB™s
, fSCR.
ex‹nsiÚ
);

256 
fIÅutBufãrBy‹sAvaabË
 +ğ
äameSize
;

258 
fP¬’t
.
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

261 ià(
fP¬’t
.
fAwa™šgBackgroundD–iv”y
) {

262 
fP¬’t
.
fAwa™šgBackgroundD–iv”y
 = 
F®£
;

263 
fP¬’t
.
	`awa™NewBufãr
(
NULL
);

265 
	}
}

	@liveMedia/MPEG2TransportStreamFromPESSource.cpp

21 
	~"MPEG2T¿n¥ÜtSŒ—mFromPESSourû.hh
"

23 
	#MAX_PES_PACKET_SIZE
 (6+65535)

	)

25 
MPEG2T¿n¥ÜtSŒ—mFromPESSourû
* 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû


26 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
šputSourû
) {

27  
Ãw
 
	`MPEG2T¿n¥ÜtSŒ—mFromPESSourû
(
’v
, 
šputSourû
);

28 
	}
}

30 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû


31 ::
	$MPEG2T¿n¥ÜtSŒ—mFromPESSourû
(
U§geEnvœÚm’t
& 
’v
,

32 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
šputSourû
)

33 : 
	`MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
(
’v
),

34 
	$fIÅutSourû
(
šputSourû
) {

35 
fIÅutBufãr
 = 
Ãw
 [
MAX_PES_PACKET_SIZE
];

36 
	}
}

38 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû
::~
	$MPEG2T¿n¥ÜtSŒ—mFromPESSourû
() {

39 
Medium
::
	`şo£
(
fIÅutSourû
);

40 
d–‘e
[] 
fIÅutBufãr
;

41 
	}
}

43 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû
::
	$doStİG‘tšgF¿mes
() {

44 
fIÅutSourû
->
	`¡İG‘tšgF¿mes
();

45 
	}
}

47 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû


48 ::
	$awa™NewBufãr
(* ) {

49 
fIÅutSourû
->
	`g‘NextF¿me
(
fIÅutBufãr
, 
MAX_PES_PACKET_SIZE
,

50 
aá”G‘tšgF¿me
, 
this
,

51 
F¿medSourû
::
hªdËClosu»
, 
this
);

52 
	}
}

54 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû


55 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

56 
numTrunÿ‹dBy‹s
,

57 
timev®
 
´e£Á©iÚTime
,

58 
du¿tiÚInMiüo£cÚds
) {

59 
MPEG2T¿n¥ÜtSŒ—mFromPESSourû
* 
sourû


60 ğ(
MPEG2T¿n¥ÜtSŒ—mFromPESSourû
*)
ş›ÁD©a
;

61 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

62 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

63 
	}
}

65 
	gMPEG2T¿n¥ÜtSŒ—mFromPESSourû


66 ::
	$aá”G‘tšgF¿me1
(
äameSize
,

68 
timev®
 ,

70 ià(
äameSize
 < 4) ;

72 
	`hªdËNewBufãr
(
fIÅutBufãr
, 
äameSize
,

73 
fIÅutSourû
->
	`m³gV”siÚ
(), fIÅutSourû->
	`Ï¡S“nSCR
());

74 
	}
}

	@liveMedia/MPEG2TransportStreamIndexFile.cpp

24 
	~"MPEG2T¿n¥ÜtSŒ—mIndexFe.hh
"

25 
	~"IÅutFe.hh
"

27 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe


28 ::
	$MPEG2T¿n¥ÜtSŒ—mIndexFe
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
šdexFeName
)

29 : 
	`Medium
(
’v
),

30 
	`fFeName
(
	`¡rDup
(
šdexFeName
)), 
	`fFid
(
NULL
), 
	`fMPEGV”siÚ
(0), 
	`fCu¼’tIndexRecÜdNum
(0),

31 
	`fCachedPCR
(0.0f), 
	`fCachedTSPack‘Numb”
(0), 
	$fNumIndexRecÜds
(0) {

33 
u_št64_t
 
šdexFeSize
 = 
	`G‘FeSize
(
šdexFeName
, 
NULL
);

34 ià(
šdexFeSize
 % 
INDEX_RECORD_SIZE
 != 0) {

35 
’v
 << "W¬nšg: Sizoàthšdex f\"" << 
šdexFeName


36 << "\" (" << ()
šdexFeSize


38 << 
INDEX_RECORD_SIZE
 << ")\n";

40 
fNumIndexRecÜds
 = ()(
šdexFeSize
/
INDEX_RECORD_SIZE
);

41 
	}
}

43 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe


44 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
šdexFeName
) {

45 ià(
šdexFeName
 =ğ
NULL
)  NULL;

46 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe


47 ğ
Ãw
 
	`MPEG2T¿n¥ÜtSŒ—mIndexFe
(
’v
, 
šdexFeName
);

50 ià(
šdexFe
->
	`g‘PÏyšgDu¿tiÚ
() == 0.0f) {

51 
d–‘e
 
šdexFe
;

52 
šdexFe
 = 
NULL
;

55  
šdexFe
;

56 
	}
}

58 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::~
	$MPEG2T¿n¥ÜtSŒ—mIndexFe
() {

59 
	`şo£Fid
();

60 
d–‘e
[] 
fFeName
;

61 
	}
}

63 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe


64 ::
	$lookupTSPack‘NumFromNPT
(& 
Åt
, & 
tsPack‘Numb”
,

65 & 
šdexRecÜdNumb”
) {

66 ià(
Åt
 <ğ0.0 || 
fNumIndexRecÜds
 == 0) {

67 
Åt
 = 0.0f;

68 
tsPack‘Numb”
 = 
šdexRecÜdNumb”
 = 0;

73 ià(
Åt
 =ğ
fCachedPCR
) {

74 
tsPack‘Numb”
 = 
fCachedTSPack‘Numb”
;

75 
šdexRecÜdNumb”
 = 
fCachedIndexRecÜdNumb”
;

81 
BoŞ—n
 
sucûss
 = 
F®£
;

82 
ixFound
 = 0;

84 
ixLeá
 = 0, 
ixRight
 = 
fNumIndexRecÜds
-1;

85 
püLeá
 = 0.0f, 
püRight
;

86 ià(!
	`»adIndexRecÜd
(
ixRight
)) ;

87 
püRight
 = 
	`püFromBuf
();

88 ià(
Åt
 > 
püRight
)‚pt =…crRight;

91 
ixRight
-
ixLeá
 > 1 && 
püLeá
 < 
Åt
 &&‚± <ğ
püRight
) {

92 
ixNew
 = 
ixLeá


93 + ()(((
Åt
-
püLeá
)/(
püRight
-püLeá))*(
ixRight
-
ixLeá
));

94 ià(
ixNew
 =ğ
ixLeá
 || ixNew =ğ
ixRight
) {

96 
ixNew
 = (
ixLeá
+
ixRight
)/2;

98 ià(!
	`»adIndexRecÜd
(
ixNew
)) ;

99 
püNew
 = 
	`püFromBuf
();

100 ià(
püNew
 < 
Åt
) {

101 
püLeá
 = 
püNew
;

102 
ixLeá
 = 
ixNew
;

104 
püRight
 = 
püNew
;

105 
ixRight
 = 
ixNew
;

108 ià(
ixRight
-
ixLeá
 > 1 || 
Åt
 <ğ
püLeá
 ||‚± > 
püRight
) ;

110 
ixFound
 = 
ixRight
;

112 
sucûss
 = 
	`»wšdToCËªPošt
(
ixFound
);

115 ià(
sucûss
 && 
	`»adIndexRecÜd
(
ixFound
)) {

117 
Åt
 = 
fCachedPCR
 = 
	`püFromBuf
();

118 
tsPack‘Numb”
 = 
fCachedTSPack‘Numb”
 = 
	`tsPack‘NumFromBuf
();

119 
šdexRecÜdNumb”
 = 
fCachedIndexRecÜdNumb”
 = 
ixFound
;

122 
Åt
 = 0.0f;

123 
tsPack‘Numb”
 = 
šdexRecÜdNumb”
 = 0;

125 
	`şo£Fid
();

126 
	}
}

128 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe


129 ::
	$lookupPCRFromTSPack‘Num
(& 
tsPack‘Numb”
, 
BoŞ—n
 
»v”£ToP»viousCËªPošt
,

130 & 
pü
, & 
šdexRecÜdNumb”
) {

131 ià(
tsPack‘Numb”
 =ğ0 || 
fNumIndexRecÜds
 == 0) {

132 
pü
 = 0.0f;

133 
šdexRecÜdNumb”
 = 0;

138 ià(
tsPack‘Numb”
 =ğ
fCachedTSPack‘Numb”
) {

139 
pü
 = 
fCachedPCR
;

140 
šdexRecÜdNumb”
 = 
fCachedIndexRecÜdNumb”
;

146 
BoŞ—n
 
sucûss
 = 
F®£
;

147 
ixFound
 = 0;

149 
ixLeá
 = 0, 
ixRight
 = 
fNumIndexRecÜds
-1;

150 
tsLeá
 = 0, 
tsRight
;

151 ià(!
	`»adIndexRecÜd
(
ixRight
)) ;

152 
tsRight
 = 
	`tsPack‘NumFromBuf
();

153 ià(
tsPack‘Numb”
 > 
tsRight
)sPacketNumber =sRight;

156 
ixRight
-
ixLeá
 > 1 && 
tsLeá
 < 
tsPack‘Numb”
 &&sPack‘Numb” <ğ
tsRight
) {

157 
ixNew
 = 
ixLeá


158 + ()(((
tsPack‘Numb”
-
tsLeá
)/(
tsRight
-tsLeá))*(
ixRight
-
ixLeá
));

159 ià(
ixNew
 =ğ
ixLeá
 || ixNew =ğ
ixRight
) {

161 
ixNew
 = (
ixLeá
+
ixRight
)/2;

163 ià(!
	`»adIndexRecÜd
(
ixNew
)) ;

164 
tsNew
 = 
	`tsPack‘NumFromBuf
();

165 ià(
tsNew
 < 
tsPack‘Numb”
) {

166 
tsLeá
 = 
tsNew
;

167 
ixLeá
 = 
ixNew
;

169 
tsRight
 = 
tsNew
;

170 
ixRight
 = 
ixNew
;

173 ià(
ixRight
-
ixLeá
 > 1 || 
tsPack‘Numb”
 <ğ
tsLeá
 ||sPack‘Numb” > 
tsRight
) ;

175 
ixFound
 = 
ixRight
;

176 ià(
»v”£ToP»viousCËªPošt
) {

178 
sucûss
 = 
	`»wšdToCËªPošt
(
ixFound
);

180 
sucûss
 = 
True
;

184 ià(
sucûss
 && 
	`»adIndexRecÜd
(
ixFound
)) {

186 
pü
 = 
fCachedPCR
 = 
	`püFromBuf
();

187 
fCachedTSPack‘Numb”
 = 
	`tsPack‘NumFromBuf
();

188 ià(
»v”£ToP»viousCËªPošt
è
tsPack‘Numb”
 = 
fCachedTSPack‘Numb”
;

189 
šdexRecÜdNumb”
 = 
fCachedIndexRecÜdNumb”
 = 
ixFound
;

192 
pü
 = 0.0f;

193 
šdexRecÜdNumb”
 = 0;

195 
	`şo£Fid
();

196 
	}
}

198 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe


199 ::
	$»adIndexRecÜdV®ues
(
šdexRecÜdNum
,

200 & 
Œª¥ÜtPack‘Num
, 
u_št8_t
& 
off£t
,

201 
u_št8_t
& 
size
, & 
pü
, u_št8_t& 
»cÜdTy³
) {

202 ià(!
	`»adIndexRecÜd
(
šdexRecÜdNum
)è 
F®£
;

204 
Œª¥ÜtPack‘Num
 = 
	`tsPack‘NumFromBuf
();

205 
off£t
 = 
	`off£tFromBuf
();

206 
size
 = 
	`sizeFromBuf
();

207 
pü
 = 
	`püFromBuf
();

208 
»cÜdTy³
 = 
	`»cÜdTy³FromBuf
();

209  
True
;

210 
	}
}

212 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$g‘PÏyšgDu¿tiÚ
() {

213 ià(
fNumIndexRecÜds
 =ğ0 || !
	`»adOÃIndexRecÜd
(fNumIndexRecords-1))  0.0f;

215  
	`püFromBuf
();

216 
	}
}

218 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$m³gV”siÚ
() {

219 ià(
fMPEGV”siÚ
 != 0)  fMPEGVersion;

222 ià(!
	`»adOÃIndexRecÜd
(0))  0;

224 
	`£tMPEGV”siÚFromRecÜdTy³
(
	`»cÜdTy³FromBuf
());

225  
fMPEGV”siÚ
;

226 
	}
}

228 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$İ’Fid
() {

229 ià(
fFid
 =ğ
NULL
 && 
fFeName
 != NULL) {

230 ià((
fFid
 = 
	`O³nIÅutFe
(
	`’vœ
(), 
fFeName
)è!ğ
NULL
) {

231 
fCu¼’tIndexRecÜdNum
 = 0;

235  
fFid
 !ğ
NULL
;

236 
	}
}

238 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$£ekToIndexRecÜd
(
šdexRecÜdNumb”
) {

239 ià(!
	`İ’Fid
()è 
F®£
;

241 ià(
šdexRecÜdNumb”
 =ğ
fCu¼’tIndexRecÜdNum
è 
True
;

243 ià(
	`S“kFe64
(
fFid
, (
št64_t
)(
šdexRecÜdNumb”
*
INDEX_RECORD_SIZE
), 
SEEK_SET
è!ğ0è 
F®£
;

244 
fCu¼’tIndexRecÜdNum
 = 
šdexRecÜdNumb”
;

245  
True
;

246 
	}
}

248 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$»adIndexRecÜd
(
šdexRecÜdNum
) {

250 ià(!
	`£ekToIndexRecÜd
(
šdexRecÜdNum
)) ;

251 ià(
	`ä—d
(
fBuf
, 
INDEX_RECORD_SIZE
, 1, 
fFid
) != 1) ;

252 ++
fCu¼’tIndexRecÜdNum
;

254  
True
;

257  
F®£
;

258 
	}
}

260 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$»adOÃIndexRecÜd
(
šdexRecÜdNum
) {

261 
BoŞ—n
 
»suÉ
 = 
	`»adIndexRecÜd
(
šdexRecÜdNum
);

262 
	`şo£Fid
();

264  
»suÉ
;

265 
	}
}

267 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$şo£Fid
() {

268 ià(
fFid
 !ğ
NULL
) {

269 
	`Clo£IÅutFe
(
fFid
);

270 
fFid
 = 
NULL
;

272 
	}
}

274 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$püFromBuf
() {

275 
pü_št
 = (
fBuf
[5]<<16) | (fBuf[4]<<8) | fBuf[3];

276 
u_št8_t
 
pü_äac
 = 
fBuf
[6];

277  
pü_št
 + 
pü_äac
/256.0f;

278 
	}
}

280 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$tsPack‘NumFromBuf
() {

281  (
fBuf
[10]<<24) | (fBuf[9]<<16) | (fBuf[8]<<8) | fBuf[7];

282 
	}
}

284 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$£tMPEGV”siÚFromRecÜdTy³
(
u_št8_t
 
»cÜdTy³
) {

285 ià(
fMPEGV”siÚ
 != 0) ;

287 
u_št8_t
 cÚ¡ 
»cÜdTy³W™houtS¹B™
 = 
»cÜdTy³
&~0x80;

288 ià(
»cÜdTy³W™houtS¹B™
 >ğ1 &&„ecÜdTy³W™houtS¹B™ <ğ4è
fMPEGV”siÚ
 = 2;

289 ià(
»cÜdTy³W™houtS¹B™
 >ğ5 &&„ecÜdTy³W™houtS¹B™ <ğ10è
fMPEGV”siÚ
 = 5;

291 ià(
»cÜdTy³W™houtS¹B™
 >ğ11 &&„ecÜdTy³W™houtS¹B™ <ğ16è
fMPEGV”siÚ
 = 6;

293 
	}
}

295 
BoŞ—n
 
	gMPEG2T¿n¥ÜtSŒ—mIndexFe
::
	$»wšdToCËªPošt
(&
ixFound
) {

296 
BoŞ—n
 
sucûss
 = 
F®£
;

298 
ixFound
 > 0) {

299 ià(!
	`»adIndexRecÜd
(
ixFound
)) ;

301 
u_št8_t
 
»cÜdTy³
 = 
	`»cÜdTy³FromBuf
();

302 
	`£tMPEGV”siÚFromRecÜdTy³
(
»cÜdTy³
);

308 ià((
»cÜdTy³
&0x80) != 0) {

309 
»cÜdTy³
 &=~ 0x80;

310 ià(
fMPEGV”siÚ
 == 5) {

311 ià(
»cÜdTy³
 == 5 ) {

312 
sucûss
 = 
True
;

315 } ià(
fMPEGV”siÚ
 == 6) {

316 ià(
»cÜdTy³
 == 11 ) {

317 
sucûss
 = 
True
;

321 ià(
»cÜdTy³
 == 1 ) {

322 
sucûss
 = 
True
;

324 } ià(
»cÜdTy³
 == 2 ) {

326 
ÃwIxFound
 = 
ixFound
;

328 --
ÃwIxFound
 > 0) {

329 ià(!
	`»adIndexRecÜd
(
ÃwIxFound
)) ;

330 
»cÜdTy³
 = 
	`»cÜdTy³FromBuf
();

331 ià((
»cÜdTy³
&0x7F) != 1) ;

332 ià((
»cÜdTy³
&0x80) != 0) {

333 
ixFound
 = 
ÃwIxFound
;

338 
sucûss
 = 
True
;

344 --
ixFound
;

346 ià(
ixFound
 =ğ0è
sucûss
 = 
True
;

348  
sucûss
;

349 
	}
}

	@liveMedia/MPEG2TransportStreamMultiplexor.cpp

22 
	~"MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ.hh
"

24 
	#TRANSPORT_PACKET_SIZE
 188

	)

26 
	#PAT_PERIOD
 100

27 
	#PMT_PERIOD
 500

28 

	)

29 
	#PID_TABLE_SIZE
 256

	)

31 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ


32 ::
	$MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
(
U§geEnvœÚm’t
& 
’v
)

33 : 
	`F¿medSourû
(
’v
),

34 
	`fHaveVideoSŒ—ms
(
True
 ),

35 
	`fOutgošgPack‘CouÁ”
(0), 
	`fProg¿mM­V”siÚ
(0),

36 
	`fP»viousIÅutProg¿mM­V”siÚ
(0xFF), 
	`fCu¼’tIÅutProg¿mM­V”siÚ
(0xFF),

37 
	`fPCR_PID
(0), 
	`fCu¼’tPID
(0),

38 
	`fIÅutBufãr
(
NULL
), 
	`fIÅutBufãrSize
(0), 
	`fIÅutBufãrBy‹sU£d
(0),

39 
	$fIsFœ¡Ad­tiÚF›ld
(
True
) {

40 
i
 = 0; i < 
PID_TABLE_SIZE
; ++i) {

41 
fPIDS‹
[
i
].
couÁ”
 = 0;

42 
fPIDS‹
[
i
].
¡»amTy³
 = 0;

44 
	}
}

46 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
::~
	$MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
() {

47 
	}
}

49 
MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
::
	$doG‘NextF¿me
() {

50 ià(
fIÅutBufãrBy‹sU£d
 >ğ
fIÅutBufãrSize
) {

53 
	`awa™NewBufãr
(
fIÅutBufãr
);

59 ià(
fOutgošgPack‘CouÁ”
++ % 
PAT_PERIOD
 == 0) {

60 
	`d–iv”PATPack‘
();

65 
BoŞ—n
 
´og¿mM­HasChªged
 = 
fPIDS‹
[
fCu¼’tPID
].
couÁ”
 == 0

66 || 
fCu¼’tIÅutProg¿mM­V”siÚ
 !ğ
fP»viousIÅutProg¿mM­V”siÚ
;

67 ià(
fOutgošgPack‘CouÁ”
 % 
PMT_PERIOD
 =ğ0 || 
´og¿mM­HasChªged
) {

68 ià(
´og¿mM­HasChªged
) {

69 
fPIDS‹
[
fCu¼’tPID
].
couÁ”
 = 1;

70 
fP»viousIÅutProg¿mM­V”siÚ
 = 
fCu¼’tIÅutProg¿mM­V”siÚ
;

72 
	`d–iv”PMTPack‘
(
´og¿mM­HasChªged
);

77 
	`d–iv”D©aToCl›Á
(
fCu¼’tPID
, 
fIÅutBufãr
, 
fIÅutBufãrSize
,

78 
fIÅutBufãrBy‹sU£d
);

83 ià((
fOutgošgPack‘CouÁ”
%10) == 0) {

86 
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0, (
TaskFunc
*)
F¿medSourû
::
aá”G‘tšg
, 
this
);

88 
	`aá”G‘tšg
(
this
);

90 
	}
}

92 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ


93 ::
hªdËNewBufãr
(* 
bufãr
, 
bufãrSize
,

94 
m³gV”siÚ
, 
MPEG1Ü2Demux
::
SCR
 
sü
, 
št16_t
 
PID
) {

95 ià(
	gbufãrSize
 < 4) ;

96 
	gfIÅutBufãr
 = 
bufãr
;

97 
	gfIÅutBufãrSize
 = 
bufãrSize
;

98 
	gfIÅutBufãrBy‹sU£d
 = 0;

100 
u_št8_t
 
	g¡»am_id
 = 
fIÅutBufãr
[3];

103 ià(
	g¡»am_id
 == 0xBE) {

104 
fIÅutBufãrSize
 = 0;

105 } ià(
	g¡»am_id
 == 0xBC) {

106 
£tProg¿mSŒ—mM­
(
fIÅutBufãrSize
);

107 
	gfIÅutBufãrSize
 = 0;

109 ià(
	gPID
 == -1)

110 
fCu¼’tPID
 = 
¡»am_id
;

112 
	gfCu¼’tPID
 = (
u_št8_t
)
PID
;

115 
	gu_št8_t
& 
	g¡»amTy³
 = 
fPIDS‹
[
fCu¼’tPID
].
¡»amTy³
;

117 ià(
	g¡»amTy³
 == 0) {

120 ià((
¡»am_id
&0xF0) == 0xE0) {

121 
¡»amTy³
 = 
m³gV”siÚ
 == 1 ? 1 : mpegVersion == 2 ? 2 : mpegVersion == 4 ? 0x10 :

122 
m³gV”siÚ
 == 5 ? 0x1B : 0x24 ;

123 } ià((
	g¡»am_id
&0xE0) == 0xC0) {

124 
¡»amTy³
 = 
m³gV”siÚ
 == 1 ? 3 : mpegVersion == 2 ? 4 : 0xF;

125 } ià(
	g¡»am_id
 == 0xBD) {

126 
¡»amTy³
 = 0x06;

128 
	g¡»amTy³
 = 0x81;

132 ià(
	gfPCR_PID
 == 0) {

133 ià((!
fHaveVideoSŒ—ms
 && (
¡»amTy³
 == 3 || streamType == 4 || streamType == 0xF)) ||

134 (
¡»amTy³
 == 1 || streamType == 2 || streamType == 0x10 || streamType == 0x1B || streamType == 0x24) ) {

135 
fPCR_PID
 = 
fCu¼’tPID
;

138 ià(
	gfCu¼’tPID
 =ğ
fPCR_PID
) {

140 
fPCR
 = 
sü
;

145 
doG‘NextF¿me
();

148 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ


149 ::
	$d–iv”D©aToCl›Á
(
u_št8_t
 
pid
, * 
bufãr
, 
bufãrSize
,

150 & 
¡¬tPos™iÚInBufãr
) {

152 ià(
fMaxSize
 < 
TRANSPORT_PACKET_SIZE
) {

153 
fF¿meSize
 = 0;

154 
fNumTrunÿ‹dBy‹s
 = 
TRANSPORT_PACKET_SIZE
;

156 
fF¿meSize
 = 
TRANSPORT_PACKET_SIZE
;

157 
BoŞ—n
 
wlAddPCR
 = 
pid
 =ğ
fPCR_PID
 && 
¡¬tPos™iÚInBufãr
 == 0

158 && !(
fPCR
.
highB™
 =ğ0 && fPCR.
»maššgB™s
 =ğ0 && fPCR.
ex‹nsiÚ
 == 0);

159 cÚ¡ 
numBy‹sAvaabË
 = 
bufãrSize
 - 
¡¬tPos™iÚInBufãr
;

160 
numH—d”By‹s
 = 4;

161 
numPCRBy‹s
 = 0;

162 
numPaddšgBy‹s
 = 0;

163 
numD©aBy‹s
;

164 
u_št8_t
 
ad­tiÚ_f›ld_cÚŒŞ
;

165 ià(
wlAddPCR
) {

166 
ad­tiÚ_f›ld_cÚŒŞ
 = 0x30;

167 
numH—d”By‹s
 += 2;

168 
numPCRBy‹s
 = 6;

169 ià(
numBy‹sAvaabË
 >ğ
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
 - 
numPCRBy‹s
) {

170 
numD©aBy‹s
 = 
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
 - 
numPCRBy‹s
;

172 
numD©aBy‹s
 = 
numBy‹sAvaabË
;

173 
numPaddšgBy‹s


174 ğ
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
 - 
numPCRBy‹s
 - 
numD©aBy‹s
;

176 } ià(
numBy‹sAvaabË
 >ğ
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
) {

178 
ad­tiÚ_f›ld_cÚŒŞ
 = 0x10;

179 
numD©aBy‹s
 = 
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
;

181 
ad­tiÚ_f›ld_cÚŒŞ
 = 0x30;

182 ++
numH—d”By‹s
;

184 
numD©aBy‹s
 = 
numBy‹sAvaabË
;

185 ià(
numD©aBy‹s
 < 
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
) {

186 ++
numH—d”By‹s
;

187 
numPaddšgBy‹s
 = 
TRANSPORT_PACKET_SIZE
 - 
numH—d”By‹s
 - 
numD©aBy‹s
;

194 * 
h—d”
 = 
fTo
;

195 *
h—d”
++ = 0x47;

196 *
h—d”
++ = (
¡¬tPos™iÚInBufãr
 == 0) ? 0x40 : 0x00;

199 *
h—d”
++ = 
pid
;

201 & 
cÚtšu™y_couÁ”
 = 
fPIDS‹
[
pid
].
couÁ”
;

202 *
h—d”
++ = 
ad­tiÚ_f›ld_cÚŒŞ
|(
cÚtšu™y_couÁ”
&0x0F);

204 ++
cÚtšu™y_couÁ”
;

205 ià(
ad­tiÚ_f›ld_cÚŒŞ
 == 0x30) {

207 
u_št8_t
 
ad­tiÚ_f›ld_Ëngth


208 ğ(
numH—d”By‹s
 =ğ5è? 0 : 1 + 
numPCRBy‹s
 + 
numPaddšgBy‹s
;

209 *
h—d”
++ = 
ad­tiÚ_f›ld_Ëngth
;

210 ià(
numH—d”By‹s
 > 5) {

211 
u_št8_t
 
æags
 = 
wlAddPCR
 ? 0x10 : 0x00;

212 ià(
fIsFœ¡Ad­tiÚF›ld
) {

213 
æags
 |= 0x80;

214 
fIsFœ¡Ad­tiÚF›ld
 = 
F®£
;

216 *
h—d”
++ = 
æags
;

217 ià(
wlAddPCR
) {

218 
u_št32_t
 
püHigh32B™s
 = (
fPCR
.
highB™
<<31è| (fPCR.
»maššgB™s
>>1);

219 
u_št8_t
 
püLowB™
 = 
fPCR
.
»maššgB™s
&1;

220 
u_št8_t
 
extHighB™
 = (
fPCR
.
ex‹nsiÚ
&0x100)>>8;

221 *
h—d”
++ = 
püHigh32B™s
>>24;

222 *
h—d”
++ = 
püHigh32B™s
>>16;

223 *
h—d”
++ = 
püHigh32B™s
>>8;

224 *
h—d”
++ = 
püHigh32B™s
;

225 *
h—d”
++ = (
püLowB™
<<7)|0x7E|
extHighB™
;

226 *
h—d”
++ = (
u_št8_t
)
fPCR
.
ex‹nsiÚ
;

232 
i
 = 0; i < 
numPaddšgBy‹s
; ++iè*
h—d”
++ = 0xFF;

235 
	`memmove
(
h—d”
, &
bufãr
[
¡¬tPos™iÚInBufãr
], 
numD©aBy‹s
);

236 
¡¬tPos™iÚInBufãr
 +ğ
numD©aBy‹s
;

238 
	}
}

240 
	#PAT_PID
 0

	)

241 #iâdeà
OUR_PROGRAM_NUMBER


242 
	#OUR_PROGRAM_NUMBER
 1

	)

244 
	#OUR_PROGRAM_MAP_PID
 0x30

	)

246 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
::
	$d–iv”PATPack‘
() {

248 cÚ¡ 
·tSize
 = 
TRANSPORT_PACKET_SIZE
 - 4;

249 * 
·tBufãr
 = 
Ãw
 [
·tSize
];

252 * 
·t
 = 
·tBufãr
;

253 *
·t
++ = 0;

254 *
·t
++ = 0;

255 *
·t
++ = 0xB0;

256 *
·t
++ = 13;

257 *
·t
++ = 0; *pat++ = 1;

258 *
·t
++ = 0xC3;

259 *
·t
++ = 0;

260 *
·t
++ = 0;

261 *
·t
++ = 
OUR_PROGRAM_NUMBER
>>8; *pat++ = OUR_PROGRAM_NUMBER;

262 *
·t
++ = 0xE0|(
OUR_PROGRAM_MAP_PID
>>8);

263 *
·t
++ = 
OUR_PROGRAM_MAP_PID
;

266 
u_št32_t
 
üc
 = 
	`ÿlcuÏ‹CRC
(
·tBufãr
+1, 
·t
 - (patBuffer+1));

267 *
·t
++ = 
üc
>>24; *pat++ = crc>>16; *pat++ = crc>>8; *pat++ = crc;

270 
·t
 < &
·tBufãr
[
·tSize
]) *pat++ = 0xFF;

273 
¡¬tPos™iÚ
 = 0;

274 
	`d–iv”D©aToCl›Á
(
PAT_PID
, 
·tBufãr
, 
·tSize
, 
¡¬tPos™iÚ
);

277 
d–‘e
[] 
·tBufãr
;

278 
	}
}

280 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
::
	$d–iv”PMTPack‘
(
BoŞ—n
 
hasChªged
) {

281 ià(
hasChªged
è++
fProg¿mM­V”siÚ
;

284 cÚ¡ 
pmtSize
 = 
TRANSPORT_PACKET_SIZE
 - 4;

285 * 
pmtBufãr
 = 
Ãw
 [
pmtSize
];

288 * 
pmt
 = 
pmtBufãr
;

289 *
pmt
++ = 0;

290 *
pmt
++ = 2;

291 *
pmt
++ = 0xB0;

292 * 
£ùiÚ_ËngthPŒ
 = 
pmt
;

293 *
pmt
++ = 0;

294 *
pmt
++ = 
OUR_PROGRAM_NUMBER
>>8; *pmt++ = OUR_PROGRAM_NUMBER;

295 *
pmt
++ = 0xC1|((
fProg¿mM­V”siÚ
&0x1F)<<1);

296 *
pmt
++ = 0;

297 *
pmt
++ = 0;

298 *
pmt
++ = 0xE0;

299 *
pmt
++ = 
fPCR_PID
;

300 *
pmt
++ = 0xF0;

301 *
pmt
++ = 0;

302 
pid
 = 0;…id < 
PID_TABLE_SIZE
; ++pid) {

303 ià(
fPIDS‹
[
pid
].
¡»amTy³
 != 0) {

305 *
pmt
++ = 
fPIDS‹
[
pid
].
¡»amTy³
;

306 *
pmt
++ = 0xE0;

307 *
pmt
++ = 
pid
;

308 *
pmt
++ = 0xF0;

309 *
pmt
++ = 0;

312 
£ùiÚ_Ëngth
 = 
pmt
 - (
£ùiÚ_ËngthPŒ
+1) + 4 ;

313 *
£ùiÚ_ËngthPŒ
 = 
£ùiÚ_Ëngth
;

316 
u_št32_t
 
üc
 = 
	`ÿlcuÏ‹CRC
(
pmtBufãr
+1, 
pmt
 - (pmtBuffer+1));

317 *
pmt
++ = 
üc
>>24; *pmt++ = crc>>16; *pmt++ = crc>>8; *pmt++ = crc;

320 
pmt
 < &
pmtBufãr
[
pmtSize
]) *pmt++ = 0xFF;

323 
¡¬tPos™iÚ
 = 0;

324 
	`d–iv”D©aToCl›Á
(
OUR_PROGRAM_MAP_PID
, 
pmtBufãr
, 
pmtSize
, 
¡¬tPos™iÚ
);

327 
d–‘e
[] 
pmtBufãr
;

328 
	}
}

330 
	gMPEG2T¿n¥ÜtSŒ—mMuÉËxÜ
::
	$£tProg¿mSŒ—mM­
(
äameSize
) {

331 ià(
äameSize
 <= 16) ;

332 ià(
äameSize
 > 0xFF) ;

334 
u_št16_t
 
´og¿m_¡»am_m­_Ëngth
 = (
fIÅutBufãr
[4]<<8) | fInputBuffer[5];

335 ià((
u_št16_t
)
äameSize
 > 6+
´og¿m_¡»am_m­_Ëngth
) {

336 
äameSize
 = 6+
´og¿m_¡»am_m­_Ëngth
;

339 
u_št8_t
 
v”siÚBy‹
 = 
fIÅutBufãr
[6];

340 ià((
v”siÚBy‹
&0x80) == 0) ;

341 
fCu¼’tIÅutProg¿mM­V”siÚ
 = 
v”siÚBy‹
&0x1F;

343 
u_št16_t
 
´og¿m_¡»am_šfo_Ëngth
 = (
fIÅutBufãr
[8]<<8) | fInputBuffer[9];

344 
off£t
 = 10 + 
´og¿m_¡»am_šfo_Ëngth
;

346 
u_št16_t
 
–em’ry_¡»am_m­_Ëngth


347 ğ(
fIÅutBufãr
[
off£t
]<<8) | fInputBuffer[offset+1];

348 
off£t
 += 2;

349 
äameSize
 -= 4;

350 ià(
äameSize
 > 
off£t
 + 
–em’ry_¡»am_m­_Ëngth
) {

351 
äameSize
 = 
off£t
 + 
–em’ry_¡»am_m­_Ëngth
;

354 
off£t
 + 4 <ğ
äameSize
) {

355 
u_št8_t
 
¡»am_ty³
 = 
fIÅutBufãr
[
off£t
];

356 
u_št8_t
 
–em’ry_¡»am_id
 = 
fIÅutBufãr
[
off£t
+1];

358 
fPIDS‹
[
–em’ry_¡»am_id
].
¡»amTy³
 = 
¡»am_ty³
;

360 
u_št16_t
 
–em’ry_¡»am_šfo_Ëngth


361 ğ(
fIÅutBufãr
[
off£t
+2]<<8) | fInputBuffer[offset+3];

362 
off£t
 +ğ4 + 
–em’ry_¡»am_šfo_Ëngth
;

364 
	}
}

366 
u_št32_t
 cÚ¡ 
	gCRC32
[256] = {

433 
u_št32_t
 
	$ÿlcuÏ‹CRC
(
u_št8_t
 cÚ¡* 
d©a
, 
d©aL’gth
, 
u_št32_t
 
š™ŸlV®ue
) {

434 
u_št32_t
 
üc
 = 
š™ŸlV®ue
;

436 
d©aL’gth
-- > 0) {

437 
üc
 = (üc<<8è^ 
CRC32
[(üc>>24è^ (
u_št32_t
)(*
d©a
++)];

440  
üc
;

441 
	}
}

	@liveMedia/MPEG2TransportStreamTrickModeFilter.cpp

24 
	~"MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r.hh
"

25 
	~<By‹SŒ—mFeSourû.hh
>

33 
	#KEEP_ORIGINAL_FRAME_RATE
 
F®£


	)

35 
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
* 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r


36 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

37 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe
, 
sÿË
) {

38  
Ãw
 
	`MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
(
’v
, 
šputSourû
, 
šdexFe
, 
sÿË
);

39 
	}
}

41 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r


42 ::
	$MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

43 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe
, 
sÿË
)

44 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

45 
	`fHaveS¹ed
(
F®£
), 
	`fIndexFe
(
šdexFe
), 
	`fSÿË
(
sÿË
), 
	`fDœeùiÚ
(1),

46 
	`fS‹
(
SKIPPING_FRAME
), 
	`fF¿meCouÁ
(0),

47 
	`fNextIndexRecÜdNum
(0), 
	`fNextTSPack‘Num
(0),

48 
	`fCu¼’tTSPack‘Num
(()(-1)), 
	$fU£SavedF¿meNextTime
(
F®£
) {

49 ià(
fSÿË
 < 0) {

50 
fSÿË
 = -fScale;

51 
fDœeùiÚ
 = -1;

53 
	}
}

55 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::~
	$MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
() {

56 
	}
}

58 
BoŞ—n
 
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$£ekTo
(
tsPack‘Numb”
,

59 
šdexRecÜdNumb”
) {

60 
	`£ekToT¿n¥ÜtPack‘
(
tsPack‘Numb”
);

61 
fNextIndexRecÜdNum
 = 
šdexRecÜdNumb”
;

62  
True
;

63 
	}
}

65 
	#isIF¿meS¹
(
ty³
è(Ñy³è=ğ0x81 || (ty³è=ğ0x85 || (ty³è=ğ0x8B )

	)

68 
	#isNÚIF¿meS¹
(
ty³
è(Ñy³è=ğ0x83 || (ty³è=ğ0x88 || (ty³è=ğ0x8E )

	)

70 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$doG‘NextF¿me
() {

75 ià(
fMaxSize
 < 
TRANSPORT_PACKET_SIZE
) {

76 
fF¿meSize
 = 0;

77 
	`aá”G‘tšg
(
this
);

86 
u_št8_t
 
»cÜdTy³
;

87 
»cÜdPCR
;

88 
BoŞ—n
 
’dOfIndexFe
 = 
F®£
;

89 ià(!
fIndexFe
->
	`»adIndexRecÜdV®ues
(
fNextIndexRecÜdNum
,

90 
fDesœedTSPack‘Num
, 
fDesœedD©aOff£t
,

91 
fDesœedD©aSize
, 
»cÜdPCR
,

92 
»cÜdTy³
)) {

96 ià(
fS‹
 !ğ
DELIVERING_SAVED_FRAME
) {

97 
	`ÚSourûClosu»1
();

100 
’dOfIndexFe
 = 
True
;

101 } ià(!
fHaveS¹ed
) {

102 
fFœ¡PCR
 = 
»cÜdPCR
;

103 
fHaveS¹ed
 = 
True
;

106 
fNextIndexRecÜdNum


107 +ğ(
fS‹
 =ğ
DELIVERING_SAVED_FRAME
è? 1 : 
fDœeùiÚ
;

110 
fS‹
) {

111 
SKIPPING_FRAME
:

112 
SAVING_AND_DELIVERING_FRAME
: {

114 ià(
	`isIF¿meS¹
(
»cÜdTy³
)) {

116 
fSavedF¿meIndexRecÜdS¹
 = 
fNextIndexRecÜdNum
 - 
fDœeùiÚ
;

117 
fU£SavedF¿meNextTime
 = 
True
;

119 ià((
fF¿meCouÁ
++)%
fSÿË
 =ğ0 && 
fU£SavedF¿meNextTime
) {

121 
fF¿meCouÁ
 = 1;

122 ià(
fDœeùiÚ
 > 0) {

124 
fS‹
 = 
SAVING_AND_DELIVERING_FRAME
;

126 
fDesœedD©aPCR
 = 
»cÜdPCR
;

127 
	`©‹m±D–iv”yToCl›Á
();

132 
fS‹
 = 
DELIVERING_SAVED_FRAME
;

133 
fSavedSequ’tŸlIndexRecÜdNum
 = 
fNextIndexRecÜdNum
;

134 
fDesœedD©aPCR
 = 
»cÜdPCR
;

136 
fNextIndexRecÜdNum
 = 
fSavedF¿meIndexRecÜdS¹
;

141 
fS‹
 = 
SKIPPING_FRAME
;

143 } ià(
	`isNÚIF¿meS¹
(
»cÜdTy³
)) {

144 ià((
fF¿meCouÁ
++)%
fSÿË
 =ğ0 && 
fU£SavedF¿meNextTime
) {

147 
fF¿meCouÁ
 = 1;

148 
fS‹
 = 
DELIVERING_SAVED_FRAME
;

149 
fSavedSequ’tŸlIndexRecÜdNum
 = 
fNextIndexRecÜdNum
;

150 
fDesœedD©aPCR
 = 
»cÜdPCR
;

152 
fNextIndexRecÜdNum
 = 
fSavedF¿meIndexRecÜdS¹
;

156 
fS‹
 = 
SKIPPING_FRAME
;

160 ià(
fS‹
 =ğ
SAVING_AND_DELIVERING_FRAME
) {

162 
fDesœedD©aPCR
 = 
»cÜdPCR
;

163 
	`©‹m±D–iv”yToCl›Á
();

169 
DELIVERING_SAVED_FRAME
: {

171 ià(
’dOfIndexFe


172 || (
	`isIF¿meS¹
(
»cÜdTy³
)

173 && 
fNextIndexRecÜdNum
-1 !ğ
fSavedF¿meIndexRecÜdS¹
)

174 || 
	`isNÚIF¿meS¹
(
»cÜdTy³
)) {

178 
fNextIndexRecÜdNum
 = 
fSavedSequ’tŸlIndexRecÜdNum
;

179 
fU£SavedF¿meNextTime
 = 
KEEP_ORIGINAL_FRAME_RATE
;

180 
fS‹
 = 
SKIPPING_FRAME
;

184 
	`©‹m±D–iv”yToCl›Á
();

191 
	}
}

193 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$doStİG‘tšgF¿mes
() {

194 
F¿medF‹r
::
	`doStİG‘tšgF¿mes
();

195 
fIndexFe
->
	`¡İR—dšg
();

196 
	}
}

198 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$©‹m±D–iv”yToCl›Á
() {

199 ià(
fCu¼’tTSPack‘Num
 =ğ
fDesœedTSPack‘Num
) {

202 
	`memmove
(
fTo
, &
fIÅutBufãr
[
fDesœedD©aOff£t
], 
fDesœedD©aSize
);

203 
fF¿meSize
 = 
fDesœedD©aSize
;

204 
d–iv”yPCR
 = 
fDœeùiÚ
*(
fDesœedD©aPCR
 - 
fFœ¡PCR
)/
fSÿË
;

205 ià(
d–iv”yPCR
 < 0.0) deliveryPCR = 0.0;

206 
fP»£Á©iÚTime
.
tv_£c
 = ()
d–iv”yPCR
;

207 
fP»£Á©iÚTime
.
tv_u£c


208 ğ()((
d–iv”yPCR
 - 
fP»£Á©iÚTime
.
tv_£c
)*1000000.0f);

211 
	`aá”G‘tšg
(
this
);

214 
	`»adT¿n¥ÜtPack‘
(
fDesœedTSPack‘Num
);

216 
	}
}

218 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$£ekToT¿n¥ÜtPack‘
(
tsPack‘Num
) {

219 ià(
tsPack‘Num
 =ğ
fNextTSPack‘Num
) ;

221 
By‹SŒ—mFeSourû
* 
tsFe
 = (By‹SŒ—mFeSourû*)
fIÅutSourû
;

222 
u_št64_t
 
tsPack‘Num64
 = (u_št64_t)
tsPack‘Num
;

223 
tsFe
->
	`£ekToBy‹AbsŞu‹
(
tsPack‘Num64
*
TRANSPORT_PACKET_SIZE
);

225 
fNextTSPack‘Num
 = 
tsPack‘Num
;

226 
	}
}

228 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$»adT¿n¥ÜtPack‘
(
tsPack‘Num
) {

229 
	`£ekToT¿n¥ÜtPack‘
(
tsPack‘Num
);

230 
fIÅutSourû
->
	`g‘NextF¿me
(
fIÅutBufãr
, 
TRANSPORT_PACKET_SIZE
,

231 
aá”G‘tšgF¿me
, 
this
,

232 
ÚSourûClosu»
, 
this
);

233 
	}
}

235 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r


236 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

238 
timev®
 
´e£Á©iÚTime
,

240 
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
* 
f‹r
 = (MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r*)
ş›ÁD©a
;

241 
f‹r
->
	`aá”G‘tšgF¿me1
(
äameSize
);

242 
	}
}

244 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$aá”G‘tšgF¿me1
(
äameSize
) {

245 ià(
äameSize
 !ğ
TRANSPORT_PACKET_SIZE
) {

247 
	`ÚSourûClosu»1
();

251 
fCu¼’tTSPack‘Num
 = 
fNextTSPack‘Num
;

252 ++
fNextTSPack‘Num
;

255 
	`©‹m±D–iv”yToCl›Á
();

256 
	}
}

258 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

259 
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
* 
f‹r
 = (MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r*)
ş›ÁD©a
;

260 
f‹r
->
	`ÚSourûClosu»1
();

261 
	}
}

263 
	gMPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	$ÚSourûClosu»1
() {

264 
fIndexFe
->
	`¡İR—dšg
();

265 
	`hªdËClosu»
();

266 
	}
}

	@liveMedia/MPEG2TransportUDPServerMediaSubsession.cpp

22 
	~"MPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ.hh
"

23 
	~"BasicUDPSourû.hh
"

24 
	~"Sim¶eRTPSourû.hh
"

25 
	~"MPEG2T¿n¥ÜtSŒ—mF¿m”.hh
"

26 
	~"Sim¶eRTPSšk.hh
"

27 
	~"GroupsockH–³r.hh
"

30 
MPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ
*

31 
	gMPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

32 cÚ¡* 
šputAdd»ssSŒ
, 
PÜt
 cÚ¡& 
šputPÜt
, 
BoŞ—n
 
šputSŒ—mIsRawUDP
) {

33  
Ãw
 
	`MPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ
(
’v
, 
šputAdd»ssSŒ
, 
šputPÜt
, 
šputSŒ—mIsRawUDP
);

34 
	}
}

36 
	gMPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ


37 ::
	$MPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

38 cÚ¡* 
šputAdd»ssSŒ
, 
PÜt
 cÚ¡& 
šputPÜt
, 
BoŞ—n
 
šputSŒ—mIsRawUDP
)

39 : 
	`OnDemªdS”v”MedŸSub£ssiÚ
(
’v
, 
True
 ),

40 
	`fIÅutPÜt
(
šputPÜt
), 
	`fIÅutGroupsock
(
NULL
), 
	$fIÅutSŒ—mIsRawUDP
(
šputSŒ—mIsRawUDP
) {

41 
fIÅutAdd»ssSŒ
 = 
	`¡rDup
(
šputAdd»ssSŒ
);

42 
	}
}

44 
	gMPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ
::

45 ~
	$MPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ
() {

46 
d–‘e
 
fIÅutGroupsock
;

47 
d–‘e
[] (*)
fIÅutAdd»ssSŒ
;

48 
	}
}

50 
F¿medSourû
* 
	gMPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ


51 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

52 
e¡B™¿‹
 = 5000;

54 ià(
fIÅutGroupsock
 =ğ
NULL
) {

56 
š_addr
 
šputAdd»ss
;

57 
šputAdd»ss
.
s_addr
 = 
fIÅutAdd»ssSŒ
 =ğ
NULL
 ? 0 : 
	`our_š‘_addr
(fInputAddressStr);

58 
fIÅutGroupsock
 = 
Ãw
 
	`Groupsock
(
	`’vœ
(), 
šputAdd»ss
, 
fIÅutPÜt
, 255);

61 
F¿medSourû
* 
Œª¥ÜtSŒ—mSourû
;

62 ià(
fIÅutSŒ—mIsRawUDP
) {

63 
Œª¥ÜtSŒ—mSourû
 = 
BasicUDPSourû
::
	`ü—‹New
(
	`’vœ
(), 
fIÅutGroupsock
);

65 
Œª¥ÜtSŒ—mSourû
 = 
Sim¶eRTPSourû
::
	`ü—‹New
(
	`’vœ
(), 
fIÅutGroupsock
, 33, 90000, "video/MP2T", 0, 
F®£
 );

67  
MPEG2T¿n¥ÜtSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
Œª¥ÜtSŒ—mSourû
);

68 
	}
}

70 
RTPSšk
* 
	gMPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ


71 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
, , 
F¿medSourû
* ) {

72  
Sim¶eRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

74 1, 
True
, 
F®£
 );

75 
	}
}

	@liveMedia/MPEG4ESVideoRTPSink.cpp

21 
	~"MPEG4ESVideoRTPSšk.hh
"

22 
	~"MPEG4VideoSŒ—mF¿m”.hh
"

23 
	~"MPEG4LATMAudioRTPSourû.hh
"

25 
	gMPEG4ESVideoRTPSšk


26 ::
	$MPEG4ESVideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
, 
u_št32_t
 
¹pTime¡ampF»qu’cy
,

27 
u_št8_t
 
´ofeAndLev–IndiÿtiÚ
, cÚ¡* 
cÚfigSŒ
)

28 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
, "MP4V-ES"),

29 
	`fVOPIsP»£Á
(
F®£
), 
	`fProfeAndLev–IndiÿtiÚ
(
´ofeAndLev–IndiÿtiÚ
), 
	$fFmSDPLše
(
NULL
) {

30 
fCÚfigBy‹s
 = 
	`·r£G’”®CÚfigSŒ
(
cÚfigSŒ
, 
fNumCÚfigBy‹s
);

31 
	}
}

33 
	gMPEG4ESVideoRTPSšk
::~
	$MPEG4ESVideoRTPSšk
() {

34 
d–‘e
[] 
fFmSDPLše
;

35 
d–‘e
[] 
fCÚfigBy‹s
;

36 
	}
}

38 
MPEG4ESVideoRTPSšk
*

39 
	gMPEG4ESVideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

40 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
,

41 
u_št32_t
 
¹pTime¡ampF»qu’cy
) {

42  
Ãw
 
	`MPEG4ESVideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
);

43 
	}
}

45 
MPEG4ESVideoRTPSšk
*

46 
	gMPEG4ESVideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

47 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
, 
u_št32_t
 
¹pTime¡ampF»qu’cy
,

48 
u_št8_t
 
´ofeAndLev–IndiÿtiÚ
, cÚ¡* 
cÚfigSŒ
) {

49  
Ãw
 
	`MPEG4ESVideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
, 
´ofeAndLev–IndiÿtiÚ
, 
cÚfigSŒ
);

50 
	}
}

52 
BoŞ—n
 
	gMPEG4ESVideoRTPSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

54  
sourû
.
	`isMPEG4VideoSŒ—mF¿m”
();

55 
	}
}

57 
	#VOP_START_CODE
 0x000001B6

	)

59 
	gMPEG4ESVideoRTPSšk


60 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

61 * 
äameS¹
,

62 
numBy‹sInF¿me
,

63 
timev®
 
äameP»£Á©iÚTime
,

64 
numRemaššgBy‹s
) {

65 ià(
äagm’tiÚOff£t
 == 0) {

67 ià(
numBy‹sInF¿me
 < 4) ;

68 
¡¬tCode
 = (
äameS¹
[0]<<24) | (frameStart[1]<<16)

69 | (
äameS¹
[2]<<8) | frameStart[3];

71 
fVOPIsP»£Á
 = 
¡¬tCode
 =ğ
VOP_START_CODE
;

77 
MPEG4VideoSŒ—mF¿m”
* 
äam”Sourû
 = (MPEG4VideoSŒ—mF¿m”*)
fSourû
;

78 ià(
äam”Sourû
 !ğ
NULL
 && f¿m”Sourû->
	`piùu»EndM¬k”
()

79 && 
numRemaššgBy‹s
 == 0) {

80 
	`£tM¬k”B™
();

81 
äam”Sourû
->
	`piùu»EndM¬k”
(èğ
F®£
;

87 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

88 
	}
}

90 
BoŞ—n
 
	gMPEG4ESVideoRTPSšk
::
	$®lowF¿gm’tiÚAá”S¹
() const {

91  
True
;

92 
	}
}

94 
BoŞ—n
 
	gMPEG4ESVideoRTPSšk


95 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

99  !
fVOPIsP»£Á
;

100 
	}
}

102 cÚ¡* 
	gMPEG4ESVideoRTPSšk
::
	$auxSDPLše
() {

106 
cÚfigL’gth
 = 
fNumCÚfigBy‹s
;

107 * 
cÚfig
 = 
fCÚfigBy‹s
;

108 ià(
fProfeAndLev–IndiÿtiÚ
 =ğ0 || 
cÚfig
 =ğ
NULL
) {

110 
MPEG4VideoSŒ—mF¿m”
* 
äam”Sourû
 = (MPEG4VideoSŒ—mF¿m”*)
fSourû
;

111 ià(
äam”Sourû
 =ğ
NULL
)  NULL;

113 
fProfeAndLev–IndiÿtiÚ
 = 
äam”Sourû
->
	`´ofe_ªd_Ëv–_šdiÿtiÚ
();

114 ià(
fProfeAndLev–IndiÿtiÚ
 =ğ0è 
NULL
;

116 
cÚfig
 = 
äam”Sourû
->
	`g‘CÚfigBy‹s
(
cÚfigL’gth
);

117 ià(
cÚfig
 =ğ
NULL
)  NULL;

120 cÚ¡* 
fmFmt
 =

124 
fmFmtSize
 = 
	`¡¾’
(
fmFmt
)

127 + 2*
cÚfigL’gth


129 * 
fm
 = 
Ãw
 [
fmFmtSize
];

130 
	`¥rštf
(
fm
, 
fmFmt
, 
	`¹pPaylßdTy³
(), 
fProfeAndLev–IndiÿtiÚ
);

131 * 
’dPŒ
 = &
fm
[
	`¡¾’
(fmtp)];

132 
i
 = 0; i < 
cÚfigL’gth
; ++i) {

133 
	`¥rštf
(
’dPŒ
, "%02X", 
cÚfig
[
i
]);

134 
’dPŒ
 += 2;

136 
	`¥rštf
(
’dPŒ
, "\r\n");

138 
d–‘e
[] 
fFmSDPLše
;

139 
fFmSDPLše
 = 
	`¡rDup
(
fm
);

140 
d–‘e
[] 
fm
;

141  
fFmSDPLše
;

142 
	}
}

	@liveMedia/MPEG4ESVideoRTPSource.cpp

21 
	~"MPEG4ESVideoRTPSourû.hh
"

27 
MPEG4ESVideoRTPSourû
*

28 
	gMPEG4ESVideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

29 
¹pPaylßdFÜm©
,

30 
¹pTime¡ampF»qu’cy
) {

31  
Ãw
 
	`MPEG4ESVideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

32 
¹pTime¡ampF»qu’cy
);

33 
	}
}

35 
	gMPEG4ESVideoRTPSourû


36 ::
	$MPEG4ESVideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

37 
¹pPaylßdFÜm©
,

38 
¹pTime¡ampF»qu’cy
)

39 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

40 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

41 
	}
}

43 
	gMPEG4ESVideoRTPSourû
::~
	$MPEG4ESVideoRTPSourû
() {

44 
	}
}

46 
BoŞ—n
 
MPEG4ESVideoRTPSourû


47 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

48 & 
»suÉS³cŸlH—d”Size
) {

51 
fCu¼’tPack‘BegšsF¿me


52 ğ
·ck‘
->
	`d©aSize
(è>ğ4 && (·ck‘->
	`d©a
())[0] == 0

53 && (
·ck‘
->
	`d©a
())[1] == 0 && (packet->data())[2] == 1;

56 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

59 
»suÉS³cŸlH—d”Size
 = 0;

60  
True
;

61 
	}
}

63 cÚ¡* 
	gMPEG4ESVideoRTPSourû
::
	$MIMEty³
() const {

65 
	}
}

	@liveMedia/MPEG4GenericRTPSink.cpp

21 
	~"MPEG4G’”icRTPSšk.hh
"

22 
	~"LoÿË.hh
"

23 
	~<ùy³.h
>

25 
	gMPEG4G’”icRTPSšk


26 ::
	$MPEG4G’”icRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

27 
u_št8_t
 
¹pPaylßdFÜm©
,

28 
u_št32_t
 
¹pTime¡ampF»qu’cy
,

29 cÚ¡* 
sdpMedŸTy³SŒšg
,

30 cÚ¡* 
m³g4Mode
, cÚ¡* 
cÚfigSŒšg
,

31 
numChªÃls
)

32 : 
	`MuÉiF¿medRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

33 
¹pTime¡ampF»qu’cy
, "MPEG4-GENERIC", 
numChªÃls
),

34 
	`fSDPMedŸTy³SŒšg
(
	`¡rDup
(
sdpMedŸTy³SŒšg
)),

35 
	`fMPEG4Mode
(
	`¡rDup
(
m³g4Mode
)), 
	`fCÚfigSŒšg
(
	$¡rDup
(
cÚfigSŒšg
)) {

37 ià(
m³g4Mode
 =ğ
NULL
) {

38 
’v
 << "MPEG4GenericRTPSinkƒrror: NULL \"mpeg4Mode\"…arameter\n";

41 
size_t
 cÚ¡ 
Ën
 = 
	`¡¾’
(
m³g4Mode
) + 1;

42 * 
m
 = 
Ãw
 [
Ën
];

44 
LoÿË
 
	`l
("POSIX");

45 
size_t
 
i
 = 0; i < 
Ën
; ++iè
m
[i] = 
	`tŞow”
(
m³g4Mode
[i]);

47 ià(
	`¡rcmp
(
m
, "aac-hbr") != 0) {

48 
’v
 << "MPEG4G’”icRTPSškƒ¼Ü: UnknowÀ\"m³g4Mode\"…¬am‘”: \"" << 
m³g4Mode
 << "\"\n";

50 
d–‘e
[] 
m
;

54 cÚ¡* 
fmFmt
 =

59 
fmFmtSize
 = 
	`¡¾’
(
fmFmt
)

62 + 
	`¡¾’
(
fMPEG4Mode
)

63 + 
	`¡¾’
(
fCÚfigSŒšg
);

64 * 
fm
 = 
Ãw
 [
fmFmtSize
];

65 
	`¥rštf
(
fm
, 
fmFmt
,

66 
	`¹pPaylßdTy³
(),

67 
	`¡rcmp
(
fSDPMedŸTy³SŒšg
, "video") == 0 ? 4 : 5,

68 
fMPEG4Mode
,

69 
fCÚfigSŒšg
);

70 
fFmSDPLše
 = 
	`¡rDup
(
fm
);

71 
d–‘e
[] 
fm
;

72 
	}
}

74 
	gMPEG4G’”icRTPSšk
::~
	$MPEG4G’”icRTPSšk
() {

75 
d–‘e
[] 
fFmSDPLše
;

76 
d–‘e
[] (*)
fCÚfigSŒšg
;

77 
d–‘e
[] (*)
fMPEG4Mode
;

78 
d–‘e
[] (*)
fSDPMedŸTy³SŒšg
;

79 
	}
}

81 
MPEG4G’”icRTPSšk
*

82 
	gMPEG4G’”icRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

83 
u_št8_t
 
¹pPaylßdFÜm©
,

84 
u_št32_t
 
¹pTime¡ampF»qu’cy
,

85 cÚ¡* 
sdpMedŸTy³SŒšg
,

86 cÚ¡* 
m³g4Mode
,

87 cÚ¡* 
cÚfigSŒšg
, 
numChªÃls
) {

88  
Ãw
 
	`MPEG4G’”icRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

89 
¹pTime¡ampF»qu’cy
,

90 
sdpMedŸTy³SŒšg
, 
m³g4Mode
,

91 
cÚfigSŒšg
, 
numChªÃls
);

92 
	}
}

94 
BoŞ—n
 
	gMPEG4G’”icRTPSšk


95 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

98  
F®£
;

99 
	}
}

101 
	gMPEG4G’”icRTPSšk


102 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

103 * 
äameS¹
,

104 
numBy‹sInF¿me
,

105 
timev®
 
äameP»£Á©iÚTime
,

106 
numRemaššgBy‹s
) {

110 
fuÎF¿meSize


111 ğ
äagm’tiÚOff£t
 + 
numBy‹sInF¿me
 + 
numRemaššgBy‹s
;

112 
h—d”s
[4];

113 
h—d”s
[0] = 0; headers[1] = 16 ;

114 
h—d”s
[2] = 
fuÎF¿meSize
 >> 5; headers[3] = (fullFrameSize&0x1F)<<3;

116 
	`£tS³cŸlH—d”By‹s
(
h—d”s
,  headers);

118 ià(
numRemaššgBy‹s
 == 0) {

121 
	`£tM¬k”B™
();

126 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

127 
äameS¹
, 
numBy‹sInF¿me
,

128 
äameP»£Á©iÚTime
,

129 
numRemaššgBy‹s
);

130 
	}
}

132 
	gMPEG4G’”icRTPSšk
::
	$¥ecŸlH—d”Size
() const {

134 
	}
}

136 cÚ¡* 
	gMPEG4G’”icRTPSšk
::
	$sdpMedŸTy³
() const {

137  
fSDPMedŸTy³SŒšg
;

138 
	}
}

140 cÚ¡* 
	gMPEG4G’”icRTPSšk
::
	$auxSDPLše
() {

141  
fFmSDPLše
;

142 
	}
}

	@liveMedia/MPEG4GenericRTPSource.cpp

21 
	~"MPEG4G’”icRTPSourû.hh
"

22 
	~"B™VeùÜ.hh
"

23 
	~"MPEG4LATMAudioRTPSourû.hh
"

27 şas 
	cMPEG4G’”icBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

28 
public
:

29 
MPEG4G’”icBufã»dPack‘
(
MPEG4G’”icRTPSourû
* 
ourSourû
);

30 
	mvœtu®
 ~
MPEG4G’”icBufã»dPack‘
();

32 
	m´iv©e
:

33 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

34 
d©aSize
);

35 
	m´iv©e
:

36 
MPEG4G’”icRTPSourû
* 
fOurSourû
;

39 şas 
	cMPEG4G’”icBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

40 
´iv©e
:

41 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

46 
	sAUH—d”
 {

47 
	msize
;

48 
	mšdex
;

56 
MPEG4G’”icRTPSourû
*

57 
	gMPEG4G’”icRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

58 
¹pPaylßdFÜm©
,

59 
¹pTime¡ampF»qu’cy
,

60 cÚ¡* 
mediumName
,

61 cÚ¡* 
mode
,

62 
sizeL’gth
, 
šdexL’gth
,

63 
šdexD–L’gth


65  
Ãw
 
	`MPEG4G’”icRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

66 
¹pTime¡ampF»qu’cy
, 
mediumName
,

67 
mode
, 
sizeL’gth
, 
šdexL’gth
,

68 
šdexD–L’gth


70 
	}
}

72 
	gMPEG4G’”icRTPSourû


73 ::
	$MPEG4G’”icRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

74 
¹pPaylßdFÜm©
,

75 
¹pTime¡ampF»qu’cy
,

76 cÚ¡* 
mediumName
,

77 cÚ¡* 
mode
,

78 
sizeL’gth
, 
šdexL’gth
,

79 
šdexD–L’gth


81 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

82 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

83 
Ãw
 
MPEG4G’”icBufã»dPack‘FaùÜy
),

84 
	`fSizeL’gth
(
sizeL’gth
), 
	`fIndexL’gth
(
šdexL’gth
),

85 
	`fIndexD–L’gth
(
šdexD–L’gth
),

86 
	`fNumAUH—d”s
(0), 
	`fNextAUH—d”
(0), 
	$fAUH—d”s
(
NULL
) {

87 
mimeTy³L’gth
 =

88 
	`¡¾’
(
mediumName
) + 14 + 1;

89 
fMIMETy³
 = 
Ãw
 [
mimeTy³L’gth
];

90 ià(
fMIMETy³
 !ğ
NULL
) {

91 
	`¥rštf
(
fMIMETy³
, "%s/MPEG4-GENERIC", 
mediumName
);

94 
fMode
 = 
	`¡rDup
(
mode
);

96 ià(
mode
 =ğ
NULL
 ||

97 (
	`¡rcmp
(
mode
, "aac-hbr") != 0 && strcmp(mode, "generic") != 0)) {

98 
	`’vœ
() << "MPEG4GenericRTPSource Warning: Unknown or unsupported \"mode\": "

99 << 
mode
 << "\n";

101 
	}
}

103 
	gMPEG4G’”icRTPSourû
::~
	$MPEG4G’”icRTPSourû
() {

104 
d–‘e
[] 
fAUH—d”s
;

105 
d–‘e
[] 
fMode
;

106 
d–‘e
[] 
fMIMETy³
;

107 
	}
}

109 
BoŞ—n
 
	gMPEG4G’”icRTPSourû


110 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

111 & 
»suÉS³cŸlH—d”Size
) {

112 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

113 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

115 
fCu¼’tPack‘BegšsF¿me
 = 
fCu¼’tPack‘Com¶‘esF¿me
;

119 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

122 
»suÉS³cŸlH—d”Size
 = 0;

123 
fNumAUH—d”s
 = 0;

124 
fNextAUH—d”
 = 0;

125 
d–‘e
[] 
fAUH—d”s
; fAUH—d” ğ
NULL
;

127 ià(
fSizeL’gth
 > 0) {

130 
»suÉS³cŸlH—d”Size
 += 2;

131 ià(
·ck‘Size
 < 
»suÉS³cŸlH—d”Size
è 
F®£
;

133 
AU_h—d”s_Ëngth
 = (
h—d”S¹
[0]<<8)|headerStart[1];

134 
AU_h—d”s_Ëngth_by‹s
 = (
AU_h—d”s_Ëngth
+7)/8;

135 ià(
·ck‘Size


136 < 
»suÉS³cŸlH—d”Size
 + 
AU_h—d”s_Ëngth_by‹s
è 
F®£
;

137 
»suÉS³cŸlH—d”Size
 +ğ
AU_h—d”s_Ëngth_by‹s
;

140 
b™sAva
 = 
AU_h—d”s_Ëngth
 - (
fSizeL’gth
 + 
fIndexL’gth
);

141 ià(
b™sAva
 >ğ0 && (
fSizeL’gth
 + 
fIndexD–L’gth
) > 0) {

142 
fNumAUH—d”s
 = 1 + 
b™sAva
/(
fSizeL’gth
 + 
fIndexD–L’gth
);

144 ià(
fNumAUH—d”s
 > 0) {

145 
fAUH—d”s
 = 
Ãw
 
AUH—d”
[
fNumAUH—d”s
];

147 
B™VeùÜ
 
	`bv
(&
h—d”S¹
[2], 0, 
AU_h—d”s_Ëngth
);

148 
fAUH—d”s
[0].
size
 = 
bv
.
	`g‘B™s
(
fSizeL’gth
);

149 
fAUH—d”s
[0].
šdex
 = 
bv
.
	`g‘B™s
(
fIndexL’gth
);

151 
i
 = 1; i < 
fNumAUH—d”s
; ++i) {

152 
fAUH—d”s
[
i
].
size
 = 
bv
.
	`g‘B™s
(
fSizeL’gth
);

153 
fAUH—d”s
[
i
].
šdex
 = 
bv
.
	`g‘B™s
(
fIndexD–L’gth
);

159  
True
;

160 
	}
}

162 cÚ¡* 
	gMPEG4G’”icRTPSourû
::
	$MIMEty³
() const {

163  
fMIMETy³
;

164 
	}
}

170 
	gMPEG4G’”icBufã»dPack‘


171 ::
	$MPEG4G’”icBufã»dPack‘
(
MPEG4G’”icRTPSourû
* 
ourSourû
)

172 : 
	$fOurSourû
(
ourSourû
) {

173 
	}
}

175 
MPEG4G’”icBufã»dPack‘
::~
	$MPEG4G’”icBufã»dPack‘
() {

176 
	}
}

178 
MPEG4G’”icBufã»dPack‘


179 ::
	$ÃxtEnşo£dF¿meSize
(*& , 
d©aSize
) {

181 
AUH—d”
* 
auH—d”
 = 
fOurSourû
->
fAUH—d”s
;

182 ià(
auH—d”
 =ğ
NULL
è 
d©aSize
;

183 
numAUH—d”s
 = 
fOurSourû
->
fNumAUH—d”s
;

185 ià(
fOurSourû
->
fNextAUH—d”
 >ğ
numAUH—d”s
) {

186 
fOurSourû
->
	`’vœ
() << "MPEG4GenericBufferedPacket::nextEnclosedFrameSize("

187 << 
d©aSize
 << "): dataƒrror ("

188 << 
auH—d”
 << "," << 
fOurSourû
->
fNextAUH—d”


189 << "," << 
numAUH—d”s
 << ")!\n";

190  
d©aSize
;

193 
auH—d”
 = &auH—d”[
fOurSourû
->
fNextAUH—d”
++];

194  
auH—d”
->
size
 <ğ
d©aSize
 ?‡uHeader->size : dataSize;

195 
	}
}

197 
Bufã»dPack‘
* 
	gMPEG4G’”icBufã»dPack‘FaùÜy


198 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

199  
Ãw
 
	`MPEG4G’”icBufã»dPack‘
((
MPEG4G’”icRTPSourû
*)
ourSourû
);

200 
	}
}

205 cÚ¡ 
	g§m¶šgF»qu’cyFromIndex
[16] = {

210 
	$§m¶šgF»qu’cyFromAudioS³cificCÚfig
(cÚ¡* 
cÚfigSŒ
) {

211 * 
cÚfig
 = 
NULL
;

212 
»suÉ
 = 0;

216 
cÚfigSize
;

217 
cÚfig
 = 
	`·r£G’”®CÚfigSŒ
(
cÚfigSŒ
, 
cÚfigSize
);

218 ià(
cÚfig
 =ğ
NULL
) ;

220 ià(
cÚfigSize
 < 2) ;

221 
§m¶šgF»qu’cyIndex
 = ((
cÚfig
[0]&0x07)<<1) | (config[1]>>7);

222 ià(
§m¶šgF»qu’cyIndex
 < 15) {

223 
»suÉ
 = 
§m¶šgF»qu’cyFromIndex
[
§m¶šgF»qu’cyIndex
];

228 ià(
cÚfigSize
 < 5) ;

229 
»suÉ
 = ((
cÚfig
[1]&0x7F)<<17) | (config[2]<<9) | (config[3]<<1) | (config[4]>>7);

232 
d–‘e
[] 
cÚfig
;

233  
»suÉ
;

234 
	}
}

	@liveMedia/MPEG4LATMAudioRTPSink.cpp

21 
	~"MPEG4LATMAudioRTPSšk.hh
"

23 
	gMPEG4LATMAudioRTPSšk


24 ::
	$MPEG4LATMAudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
u_št8_t
 
¹pPaylßdFÜm©
,

26 
u_št32_t
 
¹pTime¡ampF»qu’cy
,

27 cÚ¡* 
¡»amMuxCÚfigSŒšg
,

28 
numChªÃls
,

29 
BoŞ—n
 
®lowMuÉËF¿mesP”Pack‘
)

30 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

31 
¹pTime¡ampF»qu’cy
, "MP4A-LATM", 
numChªÃls
),

32 
	`fSŒ—mMuxCÚfigSŒšg
(
	`¡rDup
(
¡»amMuxCÚfigSŒšg
)),

33 
	$fAÎowMuÉËF¿mesP”Pack‘
(
®lowMuÉËF¿mesP”Pack‘
) {

35 cÚ¡* 
fmFmt
 =

38 
fmFmtSize
 = 
	`¡¾’
(
fmFmt
)

40 + 
	`¡¾’
(
fSŒ—mMuxCÚfigSŒšg
);

41 * 
fm
 = 
Ãw
 [
fmFmtSize
];

42 
	`¥rštf
(
fm
, 
fmFmt
,

43 
	`¹pPaylßdTy³
(),

44 
fSŒ—mMuxCÚfigSŒšg
);

45 
fFmSDPLše
 = 
	`¡rDup
(
fm
);

46 
d–‘e
[] 
fm
;

47 
	}
}

49 
	gMPEG4LATMAudioRTPSšk
::~
	$MPEG4LATMAudioRTPSšk
() {

50 
d–‘e
[] 
fFmSDPLše
;

51 
d–‘e
[] (*)
fSŒ—mMuxCÚfigSŒšg
;

52 
	}
}

54 
MPEG4LATMAudioRTPSšk
*

55 
	gMPEG4LATMAudioRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

56 
u_št8_t
 
¹pPaylßdFÜm©
,

57 
u_št32_t
 
¹pTime¡ampF»qu’cy
,

58 cÚ¡* 
¡»amMuxCÚfigSŒšg
,

59 
numChªÃls
,

60 
BoŞ—n
 
®lowMuÉËF¿mesP”Pack‘
) {

61  
Ãw
 
	`MPEG4LATMAudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

62 
¹pTime¡ampF»qu’cy
, 
¡»amMuxCÚfigSŒšg
,

63 
numChªÃls
,

64 
®lowMuÉËF¿mesP”Pack‘
);

65 
	}
}

67 
BoŞ—n
 
	gMPEG4LATMAudioRTPSšk


68 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

70  
fAÎowMuÉËF¿mesP”Pack‘
;

71 
	}
}

73 
	gMPEG4LATMAudioRTPSšk


74 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

75 * 
äameS¹
,

76 
numBy‹sInF¿me
,

77 
timev®
 
äameP»£Á©iÚTime
,

78 
numRemaššgBy‹s
) {

79 ià(
numRemaššgBy‹s
 == 0) {

82 
	`£tM¬k”B™
();

87 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

88 
äameS¹
, 
numBy‹sInF¿me
,

89 
äameP»£Á©iÚTime
,

90 
numRemaššgBy‹s
);

91 
	}
}

93 cÚ¡* 
	gMPEG4LATMAudioRTPSšk
::
	$auxSDPLše
() {

94  
fFmSDPLše
;

95 
	}
}

	@liveMedia/MPEG4LATMAudioRTPSource.cpp

21 
	~"MPEG4LATMAudioRTPSourû.hh
"

25 şas 
	cLATMBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

26 
public
:

27 
LATMBufã»dPack‘
(
BoŞ—n
 
šşudeLATMD©aL’gthF›ld
);

28 
	mvœtu®
 ~
LATMBufã»dPack‘
();

30 
	m´iv©e
:

31 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

32 
d©aSize
);

34 
	m´iv©e
:

35 
BoŞ—n
 
fInşudeLATMD©aL’gthF›ld
;

38 şas 
	cLATMBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

39 
´iv©e
:

40 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

45 
MPEG4LATMAudioRTPSourû
*

46 
	gMPEG4LATMAudioRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

47 
¹pPaylßdFÜm©
,

48 
¹pTime¡ampF»qu’cy
) {

49  
Ãw
 
	`MPEG4LATMAudioRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

50 
¹pTime¡ampF»qu’cy
);

51 
	}
}

53 
	gMPEG4LATMAudioRTPSourû


54 ::
	$MPEG4LATMAudioRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

55 
¹pPaylßdFÜm©
,

56 
¹pTime¡ampF»qu’cy
)

57 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

58 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

59 
Ãw
 
LATMBufã»dPack‘FaùÜy
),

60 
	$fInşudeLATMD©aL’gthF›ld
(
True
) {

61 
	}
}

63 
	gMPEG4LATMAudioRTPSourû
::~
	$MPEG4LATMAudioRTPSourû
() {

64 
	}
}

66 
MPEG4LATMAudioRTPSourû
::
	$om™LATMD©aL’gthF›ld
() {

67 
fInşudeLATMD©aL’gthF›ld
 = 
F®£
;

68 
	}
}

70 
BoŞ—n
 
	gMPEG4LATMAudioRTPSourû


71 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

72 & 
»suÉS³cŸlH—d”Size
) {

73 
fCu¼’tPack‘BegšsF¿me
 = 
fCu¼’tPack‘Com¶‘esF¿me
;

77 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

80 
»suÉS³cŸlH—d”Size
 = 0;

81  
True
;

82 
	}
}

84 cÚ¡* 
	gMPEG4LATMAudioRTPSourû
::
	$MIMEty³
() const {

86 
	}
}

91 
	gLATMBufã»dPack‘
::
	$LATMBufã»dPack‘
(
BoŞ—n
 
šşudeLATMD©aL’gthF›ld
)

92 : 
	$fInşudeLATMD©aL’gthF›ld
(
šşudeLATMD©aL’gthF›ld
) {

93 
	}
}

95 
LATMBufã»dPack‘
::~
	$LATMBufã»dPack‘
() {

96 
	}
}

98 
LATMBufã»dPack‘


99 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

102 
»suÉF¿meSize
 = 0;

103 
i
;

104 
i
 = 0; i < 
d©aSize
; ++i) {

105 
»suÉF¿meSize
 +ğ
äamePŒ
[
i
];

106 ià(
äamePŒ
[
i
] != 0xFF) ;

108 ++
i
;

109 ià(
fInşudeLATMD©aL’gthF›ld
) {

110 
»suÉF¿meSize
 +ğ
i
;

112 
äamePŒ
 +ğ
i
;

113 
d©aSize
 -ğ
i
;

116  (
»suÉF¿meSize
 <ğ
d©aSize
) ?„esultFrameSize : dataSize;

117 
	}
}

119 
Bufã»dPack‘
* 
	gLATMBufã»dPack‘FaùÜy


120 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

121 
MPEG4LATMAudioRTPSourû
* 
sourû
 = (MPEG4LATMAudioRTPSourû*)
ourSourû
;

122  
Ãw
 
	`LATMBufã»dPack‘
(
sourû
->
	`»tuºedF¿meInşudesLATMD©aL’gthF›ld
());

123 
	}
}

128 
BoŞ—n
 
	$g‘NibbË
(cÚ¡*& 
cÚfigSŒ
,

129 & 
»suÉNibbË
) {

130 
c
 = 
cÚfigSŒ
[0];

131 ià(
c
 =ğ'\0'è 
F®£
;

133 ià(
c
 >= '0' && c <= '9') {

134 
»suÉNibbË
 = 
c
 - '0';

135 } ià(
c
 >= 'A' && c <= 'F') {

136 
»suÉNibbË
 = 10 + 
c
 - 'A';

137 } ià(
c
 >= 'a' && c <= 'f') {

138 
»suÉNibbË
 = 10 + 
c
 - 'a';

140  
F®£
;

143 ++
cÚfigSŒ
;

144  
True
;

145 
	}
}

147 
BoŞ—n
 
	$g‘By‹
(cÚ¡*& 
cÚfigSŒ
, & 
»suÉBy‹
) {

148 
»suÉBy‹
 = 0;

150 
fœ¡NibbË
;

151 ià(!
	`g‘NibbË
(
cÚfigSŒ
, 
fœ¡NibbË
)è 
F®£
;

152 
»suÉBy‹
 = 
fœ¡NibbË
<<4;

154 
£cÚdNibbË
 = 0;

155 ià(!
	`g‘NibbË
(
cÚfigSŒ
, 
£cÚdNibbË
) && configStr[0] != '\0') {

157  
F®£
;

159 
»suÉBy‹
 |ğ
£cÚdNibbË
;

161  
True
;

162 
	}
}

164 
BoŞ—n


165 
	$·r£SŒ—mMuxCÚfigSŒ
(cÚ¡* 
cÚfigSŒ
,

167 
BoŞ—n
& 
audioMuxV”siÚ
,

168 
BoŞ—n
& 
®lSŒ—msSameTimeF¿mšg
,

169 & 
numSubF¿mes
,

170 & 
numProg¿m
,

171 & 
numLay”
,

172 *& 
audioS³cificCÚfig
,

173 & 
audioS³cificCÚfigSize
) {

175 
audioMuxV”siÚ
 = 
F®£
;

176 
®lSŒ—msSameTimeF¿mšg
 = 
True
;

177 
numSubF¿mes
 = 
numProg¿m
 = 
numLay”
 = 0;

178 
audioS³cificCÚfig
 = 
NULL
;

179 
audioS³cificCÚfigSize
 = 0;

182 ià(
cÚfigSŒ
 =ğ
NULL
) ;

184 
ÃxtBy‹
;

186 ià(!
	`g‘By‹
(
cÚfigSŒ
, 
ÃxtBy‹
)) ;

187 
audioMuxV”siÚ
 = (
ÃxtBy‹
&0x80) != 0;

188 ià(
audioMuxV”siÚ
) ;

190 
®lSŒ—msSameTimeF¿mšg
 = ((
ÃxtBy‹
&0x40)>>6) != 0;

191 
numSubF¿mes
 = (
ÃxtBy‹
&0x3F);

193 ià(!
	`g‘By‹
(
cÚfigSŒ
, 
ÃxtBy‹
)) ;

194 
numProg¿m
 = (
ÃxtBy‹
&0xF0)>>4;

196 
numLay”
 = (
ÃxtBy‹
&0x0E)>>1;

200 
»maššgB™
 = 
ÃxtBy‹
&1;

202 
ascSize
 = (
	`¡¾’
(
cÚfigSŒ
)+1)/2 + 1;

203 
audioS³cificCÚfig
 = 
Ãw
 [
ascSize
];

205 
BoŞ—n
 
·r£Sucûss
;

206 
i
 = 0;

208 
ÃxtBy‹
 = 0;

209 
·r£Sucûss
 = 
	`g‘By‹
(
cÚfigSŒ
, 
ÃxtBy‹
);

210 
audioS³cificCÚfig
[
i
++] = (
»maššgB™
<<7)|((
ÃxtBy‹
&0xFE)>>1);

211 
»maššgB™
 = 
ÃxtBy‹
&1;

212 } 
·r£Sucûss
);

213 ià(
i
 !ğ
ascSize
) ;

215 
audioS³cificCÚfigSize
 = 
ascSize
;

216  
True
;

219 
d–‘e
[] 
audioS³cificCÚfig
;

220  
F®£
;

221 
	}
}

223 * 
	$·r£SŒ—mMuxCÚfigSŒ
(cÚ¡* 
cÚfigSŒ
,

225 & 
audioS³cificCÚfigSize
) {

226 
BoŞ—n
 
audioMuxV”siÚ
, 
®lSŒ—msSameTimeF¿mšg
;

227 
numSubF¿mes
, 
numProg¿m
, 
numLay”
;

228 * 
audioS³cificCÚfig
;

230 ià(!
	`·r£SŒ—mMuxCÚfigSŒ
(
cÚfigSŒ
,

231 
audioMuxV”siÚ
, 
®lSŒ—msSameTimeF¿mšg
,

232 
numSubF¿mes
, 
numProg¿m
, 
numLay”
,

233 
audioS³cificCÚfig
, 
audioS³cificCÚfigSize
)) {

234 
audioS³cificCÚfigSize
 = 0;

235  
NULL
;

238  
audioS³cificCÚfig
;

239 
	}
}

241 * 
	$·r£G’”®CÚfigSŒ
(cÚ¡* 
cÚfigSŒ
,

243 & 
cÚfigSize
) {

244 * 
cÚfig
 = 
NULL
;

246 ià(
cÚfigSŒ
 =ğ
NULL
) ;

247 
cÚfigSize
 = (
	`¡¾’
(
cÚfigSŒ
)+1)/2;

249 
cÚfig
 = 
Ãw
 [
cÚfigSize
];

250 ià(
cÚfig
 =ğ
NULL
) ;

252 
i
;

253 
i
 = 0; i < 
cÚfigSize
; ++i) {

254 ià(!
	`g‘By‹
(
cÚfigSŒ
, 
cÚfig
[
i
])) ;

256 ià(
i
 !ğ
cÚfigSize
) ;

258  
cÚfig
;

261 
cÚfigSize
 = 0;

262 
d–‘e
[] 
cÚfig
;

263  
NULL
;

264 
	}
}

	@liveMedia/MPEG4VideoFileServerMediaSubsession.cpp

22 
	~"MPEG4VideoFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"MPEG4ESVideoRTPSšk.hh
"

24 
	~"By‹SŒ—mFeSourû.hh
"

25 
	~"MPEG4VideoSŒ—mF¿m”.hh
"

27 
MPEG4VideoFeS”v”MedŸSub£ssiÚ
*

28 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

29 cÚ¡* 
feName
,

30 
BoŞ—n
 
»u£Fœ¡Sourû
) {

31  
Ãw
 
	`MPEG4VideoFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
);

32 
	}
}

34 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ


35 ::
	$MPEG4VideoFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

36 cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
)

37 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

38 
	`fAuxSDPLše
(
NULL
), 
	`fDÚeFÏg
(0), 
	$fDummyRTPSšk
(
NULL
) {

39 
	}
}

41 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ
::~
	$MPEG4VideoFeS”v”MedŸSub£ssiÚ
() {

42 
d–‘e
[] 
fAuxSDPLše
;

43 
	}
}

45 
	$aá”PÏyšgDummy
(* 
ş›ÁD©a
) {

46 
MPEG4VideoFeS”v”MedŸSub£ssiÚ
* 
sub£ss


47 ğ(
MPEG4VideoFeS”v”MedŸSub£ssiÚ
*)
ş›ÁD©a
;

48 
sub£ss
->
	`aá”PÏyšgDummy1
();

49 
	}
}

51 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ
::
	$aá”PÏyšgDummy1
() {

53 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

55 
	`£tDÚeFÏg
();

56 
	}
}

58 
	$checkFÜAuxSDPLše
(* 
ş›ÁD©a
) {

59 
MPEG4VideoFeS”v”MedŸSub£ssiÚ
* 
sub£ss


60 ğ(
MPEG4VideoFeS”v”MedŸSub£ssiÚ
*)
ş›ÁD©a
;

61 
sub£ss
->
	`checkFÜAuxSDPLše1
();

62 
	}
}

64 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ
::
	$checkFÜAuxSDPLše1
() {

65 cÚ¡* 
da¦
;

67 ià(
fAuxSDPLše
 !ğ
NULL
) {

69 
	`£tDÚeFÏg
();

70 } ià(
fDummyRTPSšk
 !ğ
NULL
 && (
da¦
 = fDummyRTPSšk->
	`auxSDPLše
()) != NULL) {

71 
fAuxSDPLše
ğ
	`¡rDup
(
da¦
);

72 
fDummyRTPSšk
 = 
NULL
;

75 
	`£tDÚeFÏg
();

76 } ià(!
fDÚeFÏg
) {

78 
uSecsToD–ay
 = 100000;

79 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecsToD–ay
,

80 (
TaskFunc
*)
checkFÜAuxSDPLše
, 
this
);

82 
	}
}

84 cÚ¡* 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ
::
	$g‘AuxSDPLše
(
RTPSšk
* 
¹pSšk
, 
F¿medSourû
* 
šputSourû
) {

85 ià(
fAuxSDPLše
 !ğ
NULL
)  fAuxSDPLine;

87 ià(
fDummyRTPSšk
 =ğ
NULL
) {

91 
fDummyRTPSšk
 = 
¹pSšk
;

94 
fDummyRTPSšk
->
	`¡¬tPÏyšg
(*
šputSourû
, 
aá”PÏyšgDummy
, 
this
);

97 
	`checkFÜAuxSDPLše
(
this
);

100 
	`’vœ
().
	`skScheduËr
().
	`doEv’tLoİ
(&
fDÚeFÏg
);

102  
fAuxSDPLše
;

103 
	}
}

105 
F¿medSourû
* 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ


106 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

107 
e¡B™¿‹
 = 500;

110 
By‹SŒ—mFeSourû
* 
feSourû


111 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

112 ià(
feSourû
 =ğ
NULL
)  NULL;

113 
fFeSize
 = 
feSourû
->
	`feSize
();

116  
MPEG4VideoSŒ—mF¿m”
::
	`ü—‹New
(
	`’vœ
(), 
feSourû
);

117 
	}
}

119 
RTPSšk
* 
	gMPEG4VideoFeS”v”MedŸSub£ssiÚ


120 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

121 
¹pPaylßdTy³IfDyÇmic
,

122 
F¿medSourû
* ) {

123  
MPEG4ESVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

124 
¹pPaylßdTy³IfDyÇmic
);

125 
	}
}

	@liveMedia/MPEG4VideoStreamDiscreteFramer.cpp

24 
	~"MPEG4VideoSŒ—mDisü‘eF¿m”.hh
"

26 
MPEG4VideoSŒ—mDisü‘eF¿m”
*

27 
	gMPEG4VideoSŒ—mDisü‘eF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

28 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
ËaveP»£Á©iÚTimesUnmodif›d
) {

30  
Ãw
 
	`MPEG4VideoSŒ—mDisü‘eF¿m”
(
’v
, 
šputSourû
, 
ËaveP»£Á©iÚTimesUnmodif›d
);

31 
	}
}

33 
	gMPEG4VideoSŒ—mDisü‘eF¿m”


34 ::
	$MPEG4VideoSŒ—mDisü‘eF¿m”
(
U§geEnvœÚm’t
& 
’v
,

35 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
ËaveP»£Á©iÚTimesUnmodif›d
)

36 : 
	`MPEG4VideoSŒ—mF¿m”
(
’v
, 
šputSourû
, 
F®£
 ),

37 
	`fL—veP»£Á©iÚTimesUnmodif›d
(
ËaveP»£Á©iÚTimesUnmodif›d
), 
	`vİ_time_šüem’t_»sŞutiÚ
(0), 
	`fNumVTIRB™s
(0),

38 
	$fLa¡NÚBF¿meVİ_time_šüem’t
(0) {

39 
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_£c
 = 0;

40 
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_u£c
 = 0;

41 
	}
}

43 
	gMPEG4VideoSŒ—mDisü‘eF¿m”
::~
	$MPEG4VideoSŒ—mDisü‘eF¿m”
() {

44 
	}
}

46 
MPEG4VideoSŒ—mDisü‘eF¿m”
::
	$doG‘NextF¿me
() {

50 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

51 
aá”G‘tšgF¿me
, 
this
,

52 
F¿medSourû
::
hªdËClosu»
, 
this
);

53 
	}
}

55 
	gMPEG4VideoSŒ—mDisü‘eF¿m”


56 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

57 
numTrunÿ‹dBy‹s
,

58 
timev®
 
´e£Á©iÚTime
,

59 
du¿tiÚInMiüo£cÚds
) {

60 
MPEG4VideoSŒ—mDisü‘eF¿m”
* 
sourû
 = (MPEG4VideoSŒ—mDisü‘eF¿m”*)
ş›ÁD©a
;

61 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

62 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

63 
	}
}

65 
	gMPEG4VideoSŒ—mDisü‘eF¿m”


66 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

67 
timev®
 
´e£Á©iÚTime
,

68 
du¿tiÚInMiüo£cÚds
) {

70 ià(
äameSize
 >ğ4 && 
fTo
[0] == 0 && fTo[1] == 0 && fTo[2] == 1) {

71 
fPiùu»EndM¬k”
 = 
True
;

72 
i
 = 3;

73 ià(
fTo
[
i
] == 0xB0) {

75 ià(
äameSize
 >ğ5è
fProfeAndLev–IndiÿtiÚ
 = 
fTo
[4];

79 
i
 = 7; i < 
äameSize
; ++i) {

80 ià((
fTo
[
i
] == 0xB3 ||

81 
fTo
[
i
] == 0xB6 )

82 && 
fTo
[
i
-1] == 1 && fTo[i-2] == 0 && fTo[i-3] == 0) {

86 
fNumCÚfigBy‹s
 = 
i
 < 
äameSize
 ? i-3 : frameSize;

87 
d–‘e
[] 
fCÚfigBy‹s
; fCÚfigBy‹ ğ
Ãw
 [
fNumCÚfigBy‹s
];

88 
j
 = 0; j < 
fNumCÚfigBy‹s
; ++jè
fCÚfigBy‹s
[j] = 
fTo
[j];

94 
	`ª®yzeVOLH—d”
();

97 ià(
i
 < 
äameSize
) {

98 
u_št8_t
 
ÃxtCode
 = 
fTo
[
i
];

100 ià(
ÃxtCode
 == 0xB3 ) {

102 
i
 +ğ4; i < 
äameSize
; ++i) {

103 ià(
fTo
[
i
] == 0xB6

104 && 
fTo
[
i
-1] == 1 && fTo[i-2] == 0 && fTo[i-3] == 0) {

105 
ÃxtCode
 = 
fTo
[
i
];

111 ià(
ÃxtCode
 =ğ0xB6 && 
i
+5 < 
äameSize
) {

112 ++
i
;

115 
u_št8_t
 
ÃxtBy‹
 = 
fTo
[
i
++];

116 
u_št8_t
 
vİ_codšg_ty³
 = 
ÃxtBy‹
>>6;

121 
u_št32_t
 
Ãxt4By‹s


122 ğ(
fTo
[
i
]<<24)|(fTo[i+1]<<16)|(fTo[i+2]<<8)|fTo[i+3];

123 
i
 += 4;

124 
u_št32_t
 
timeInfo
 = (
ÃxtBy‹
<<(32-6))|(
Ãxt4By‹s
>>6);

125 
modulo_time_ba£
 = 0;

126 
u_št32_t
 
mask
 = 0x80000000;

127 (
timeInfo
&
mask
) != 0) {

128 ++
modulo_time_ba£
;

129 
mask
 >>= 1;

131 
mask
 >>= 2;

134 
vİ_time_šüem’t
 = 0;

136 ià((
mask
>>(
fNumVTIRB™s
-1)) != 0) {

137 
i
 = 0; i < 
fNumVTIRB™s
; ++i) {

138 
vİ_time_šüem’t
 |ğ
timeInfo
&
mask
;

139 
mask
 >>= 1;

141 
mask
 != 0) {

142 
vİ_time_šüem’t
 >>= 1;

143 
mask
 >>= 1;

148 ià(!
fL—veP»£Á©iÚTimesUnmodif›d
 && 
vİ_codšg_ty³
 == 2

149 && (
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_u£c
 > 0 ||

150 
fLa¡NÚBF¿meP»£Á©iÚTime
.
tv_£c
 > 0)) {

151 
timeInüem’t


152 ğ
fLa¡NÚBF¿meVİ_time_šüem’t
 - 
vİ_time_šüem’t
;

153 ià(
timeInüem’t
<0ètimeInüem’ˆ+ğ
vİ_time_šüem’t_»sŞutiÚ
;

154 cÚ¡ 
MILLION
 = 1000000;

155 
usInüem’t
 = 
vİ_time_šüem’t_»sŞutiÚ
 == 0 ? 0.0

156 : (()
timeInüem’t
*
MILLION
)/
vİ_time_šüem’t_»sŞutiÚ
;

157 
£cÚdsToSubŒaù
 = ()(
usInüem’t
/
MILLION
);

158 
uSecÚdsToSubŒaù
 = (()
usInüem’t
)%
MILLION
;

160 
´e£Á©iÚTime
 = 
fLa¡NÚBF¿meP»£Á©iÚTime
;

161 ià(()
´e£Á©iÚTime
.
tv_u£c
 < 
uSecÚdsToSubŒaù
) {

162 
´e£Á©iÚTime
.
tv_u£c
 +ğ
MILLION
;

163 ià(
´e£Á©iÚTime
.
tv_£c
 > 0) --presentationTime.tv_sec;

165 
´e£Á©iÚTime
.
tv_u£c
 -ğ
uSecÚdsToSubŒaù
;

166 ià(()
´e£Á©iÚTime
.
tv_£c
 > 
£cÚdsToSubŒaù
) {

167 
´e£Á©iÚTime
.
tv_£c
 -ğ
£cÚdsToSubŒaù
;

169 
´e£Á©iÚTime
.
tv_£c
 =…»£Á©iÚTime.
tv_u£c
 = 0;

172 
fLa¡NÚBF¿meP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

173 
fLa¡NÚBF¿meVİ_time_šüem’t
 = 
vİ_time_šüem’t
;

180 
fF¿meSize
 = 
äameSize
;

181 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

182 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

183 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

184 
	`aá”G‘tšg
(
this
);

185 
	}
}

187 
BoŞ—n
 
	gMPEG4VideoSŒ—mDisü‘eF¿m”
::
	$g‘NextF¿meB™
(
u_št8_t
& 
»suÉ
) {

188 ià(
fNumB™sS“nSoF¬
/8 >ğ
fNumCÚfigBy‹s
è 
F®£
;

190 
u_št8_t
 
ÃxtBy‹
 = 
fCÚfigBy‹s
[
fNumB™sS“nSoF¬
/8];

191 
»suÉ
 = (
ÃxtBy‹
>>(7-
fNumB™sS“nSoF¬
%8))&1;

192 ++
fNumB™sS“nSoF¬
;

193  
True
;

194 
	}
}

196 
BoŞ—n
 
	gMPEG4VideoSŒ—mDisü‘eF¿m”
::
	$g‘NextF¿meB™s
(
numB™s
,

197 
u_št32_t
& 
»suÉ
) {

198 
»suÉ
 = 0;

199 
i
 = 0; i < 
numB™s
; ++i) {

200 
u_št8_t
 
ÃxtB™
;

201 ià(!
	`g‘NextF¿meB™
(
ÃxtB™
)è 
F®£
;

202 
»suÉ
 = (»suÉ<<1)|
ÃxtB™
;

204  
True
;

205 
	}
}

207 
	gMPEG4VideoSŒ—mDisü‘eF¿m”
::
	$ª®yzeVOLH—d”
() {

209 
i
;

210 
i
 = 3; i < 
fNumCÚfigBy‹s
; ++i) {

211 ià(
fCÚfigBy‹s
[
i
] >= 0x20 && fConfigBytes[i] <= 0x2F

212 && 
fCÚfigBy‹s
[
i
-1] == 1

213 && 
fCÚfigBy‹s
[
i
-2] == 0 && fConfigBytes[i-3] == 0) {

214 ++
i
;

219 
fNumB™sS“nSoF¬
 = 8*
i
 + 9;

221 
u_št8_t
 
is_objeù_Ïy”_id’tif›r
;

222 ià(!
	`g‘NextF¿meB™
(
is_objeù_Ïy”_id’tif›r
)) ;

223 ià(
is_objeù_Ïy”_id’tif›r
è
fNumB™sS“nSoF¬
 += 7;

225 
u_št32_t
 
a¥eù_¿tio_šfo
;

226 ià(!
	`g‘NextF¿meB™s
(4, 
a¥eù_¿tio_šfo
)) ;

227 ià(
a¥eù_¿tio_šfo
 =ğ15 ) 
fNumB™sS“nSoF¬
 += 16;

229 
u_št8_t
 
vŞ_cÚŒŞ_·¿m‘”s
;

230 ià(!
	`g‘NextF¿meB™
(
vŞ_cÚŒŞ_·¿m‘”s
)) ;

231 ià(
vŞ_cÚŒŞ_·¿m‘”s
) {

232 
fNumB™sS“nSoF¬
 += 3;

233 
u_št8_t
 
vbw_·¿m‘”s
;

234 ià(!
	`g‘NextF¿meB™
(
vbw_·¿m‘”s
)) ;

235 ià(
vbw_·¿m‘”s
è
fNumB™sS“nSoF¬
 += 79;

238 
fNumB™sS“nSoF¬
 += 2;

239 
u_št8_t
 
m¬k”_b™
;

240 ià(!
	`g‘NextF¿meB™
(
m¬k”_b™
)) ;

241 ià(
m¬k”_b™
 != 1) ;

243 ià(!
	`g‘NextF¿meB™s
(16, 
vİ_time_šüem’t_»sŞutiÚ
)) ;

244 ià(
vİ_time_šüem’t_»sŞutiÚ
 == 0) ;

247 
fNumVTIRB™s
 = 0;

248 
‹¡
 = 
vİ_time_šüem’t_»sŞutiÚ
;est>0;est /= 2) {

249 ++
fNumVTIRB™s
;

252 
	}
}

	@liveMedia/MPEG4VideoStreamFramer.cpp

26 
	~"MPEG4VideoSŒ—mF¿m”.hh
"

27 
	~"MPEGVideoSŒ—mP¬£r.hh
"

28 
	~"MPEG4LATMAudioRTPSourû.hh
"

29 
	~<¡ršg.h
>

34 
	eMPEGP¬£S‹
 {

35 
	mPARSING_VISUAL_OBJECT_SEQUENCE
,

36 
	mPARSING_VISUAL_OBJECT_SEQUENCE_SEEN_CODE
,

37 
	mPARSING_VISUAL_OBJECT
,

38 
	mPARSING_VIDEO_OBJECT_LAYER
,

39 
	mPARSING_GROUP_OF_VIDEO_OBJECT_PLANE
,

40 
	mPARSING_VIDEO_OBJECT_PLANE
,

41 
	mPARSING_VISUAL_OBJECT_SEQUENCE_END_CODE


44 şas 
	cMPEG4VideoSŒ—mP¬£r
: 
public
 
MPEGVideoSŒ—mP¬£r
 {

45 
public
:

46 
MPEG4VideoSŒ—mP¬£r
(
MPEG4VideoSŒ—mF¿m”
* 
usšgSourû
,

47 
F¿medSourû
* 
šputSourû
);

48 
	mvœtu®
 ~
MPEG4VideoSŒ—mP¬£r
();

50 
	m´iv©e
:

51 
vœtu®
 
æushIÅut
();

52 
vœtu®
 
·r£
();

54 
	m´iv©e
:

55 
MPEG4VideoSŒ—mF¿m”
* 
	$usšgSourû
() {

56  (
MPEG4VideoSŒ—mF¿m”
*)
fUsšgSourû
;

58 
	`£tP¬£S‹
(
MPEGP¬£S‹
 
·r£S‹
);

60 
	`·r£Visu®ObjeùSequ’û
(
BoŞ—n
 
haveS“nS¹Code
 = 
F®£
);

61 
	`·r£Visu®Objeù
();

62 
	`·r£VideoObjeùLay”
();

63 
	`·r£GroupOfVideoObjeùPÏÃ
();

64 
	`·r£VideoObjeùPÏÃ
();

65 
	`·r£Visu®ObjeùSequ’ûEndCode
();

68 
BoŞ—n
 
	`g‘NextF¿meB™
(
u_št8_t
& 
»suÉ
);

69 
BoŞ—n
 
	`g‘NextF¿meB™s
(
numB™s
, 
u_št32_t
& 
»suÉ
);

72 
	`ª®yzeVOLH—d”
();

74 
´iv©e
:

75 
MPEGP¬£S‹
 
fCu¼’tP¬£S‹
;

76 
fNumB™sS“nSoF¬
;

77 
u_št32_t
 
vİ_time_šüem’t_»sŞutiÚ
;

78 
fNumVTIRB™s
;

80 
u_št8_t
 
fixed_vİ_¿‹
;

81 
fixed_vİ_time_šüem’t
;

82 
fSecÚdsSšûLa¡TimeCode
, 
fTÙ®TicksSšûLa¡TimeCode
, 
fP»vNewTÙ®Ticks
;

83 
fP»vPiùu»CouÁD–
;

84 
BoŞ—n
 
fJu¡SawTimeCode
;

85 
	}
};

90 
MPEG4VideoSŒ—mF¿m”
*

91 
	gMPEG4VideoSŒ—mF¿m”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

92 
F¿medSourû
* 
šputSourû
) {

94  
Ãw
 
	`MPEG4VideoSŒ—mF¿m”
(
’v
, 
šputSourû
);

95 
	}
}

97 * 
	gMPEG4VideoSŒ—mF¿m”


98 ::
	$g‘CÚfigBy‹s
(& 
numBy‹s
) const {

99 
numBy‹s
 = 
fNumCÚfigBy‹s
;

100  
fCÚfigBy‹s
;

101 
	}
}

103 
	gMPEG4VideoSŒ—mF¿m”


104 ::
	$£tCÚfigInfo
(
u_št8_t
 
´ofeAndLev–IndiÿtiÚ
, cÚ¡* 
cÚfigSŒ
) {

105 
fProfeAndLev–IndiÿtiÚ
 = 
´ofeAndLev–IndiÿtiÚ
;

107 
d–‘e
[] 
fCÚfigBy‹s
;

108 
fCÚfigBy‹s
 = 
	`·r£G’”®CÚfigSŒ
(
cÚfigSŒ
, 
fNumCÚfigBy‹s
);

109 
	}
}

111 
	gMPEG4VideoSŒ—mF¿m”
::
	$MPEG4VideoSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
,

112 
F¿medSourû
* 
šputSourû
,

113 
BoŞ—n
 
ü—‹P¬£r
)

114 : 
	`MPEGVideoSŒ—mF¿m”
(
’v
, 
šputSourû
),

115 
	`fProfeAndLev–IndiÿtiÚ
(0),

116 
	`fCÚfigBy‹s
(
NULL
), 
	`fNumCÚfigBy‹s
(0),

117 
	`fNewCÚfigBy‹s
(
NULL
), 
	$fNumNewCÚfigBy‹s
(0) {

118 
fP¬£r
 = 
ü—‹P¬£r


119 ? 
Ãw
 
	`MPEG4VideoSŒ—mP¬£r
(
this
, 
šputSourû
)

120 : 
NULL
;

121 
	}
}

123 
	gMPEG4VideoSŒ—mF¿m”
::~
	$MPEG4VideoSŒ—mF¿m”
() {

124 
d–‘e
[] 
fCÚfigBy‹s
; d–‘e[] 
fNewCÚfigBy‹s
;

125 
	}
}

127 
	gMPEG4VideoSŒ—mF¿m”
::
	$¡¬tNewCÚfig
() {

128 
d–‘e
[] 
fNewCÚfigBy‹s
; fNewCÚfigBy‹ ğ
NULL
;

129 
fNumNewCÚfigBy‹s
 = 0;

130 
	}
}

132 
	gMPEG4VideoSŒ—mF¿m”


133 ::
	$­³ndToNewCÚfig
(* 
ÃwCÚfigBy‹s
, 
numNewBy‹s
) {

135 * 
cÚfigNew


136 ğ
Ãw
 [
fNumNewCÚfigBy‹s
 + 
numNewBy‹s
];

139 
	`memmove
(
cÚfigNew
, 
fNewCÚfigBy‹s
, 
fNumNewCÚfigBy‹s
);

140 
	`memmove
(&
cÚfigNew
[
fNumNewCÚfigBy‹s
], 
ÃwCÚfigBy‹s
, 
numNewBy‹s
);

142 
d–‘e
[] 
fNewCÚfigBy‹s
; fNewCÚfigBy‹ ğ
cÚfigNew
;

143 
fNumNewCÚfigBy‹s
 +ğ
numNewBy‹s
;

144 
	}
}

146 
	gMPEG4VideoSŒ—mF¿m”
::
	$com¶‘eNewCÚfig
() {

147 
d–‘e
[] 
fCÚfigBy‹s
; fCÚfigBy‹ ğ
fNewCÚfigBy‹s
;

148 
fNewCÚfigBy‹s
 = 
NULL
;

149 
fNumCÚfigBy‹s
 = 
fNumNewCÚfigBy‹s
;

150 
fNumNewCÚfigBy‹s
 = 0;

151 
	}
}

153 
BoŞ—n
 
	gMPEG4VideoSŒ—mF¿m”
::
	$isMPEG4VideoSŒ—mF¿m”
() const {

154  
True
;

155 
	}
}

159 
	gMPEG4VideoSŒ—mP¬£r


160 ::
	$MPEG4VideoSŒ—mP¬£r
(
MPEG4VideoSŒ—mF¿m”
* 
usšgSourû
,

161 
F¿medSourû
* 
šputSourû
)

162 : 
	`MPEGVideoSŒ—mP¬£r
(
usšgSourû
, 
šputSourû
),

163 
	`fCu¼’tP¬£S‹
(
PARSING_VISUAL_OBJECT_SEQUENCE
),

164 
	`vİ_time_šüem’t_»sŞutiÚ
(0), 
	`fNumVTIRB™s
(0),

165 
	`fixed_vİ_¿‹
(0), 
	`fixed_vİ_time_šüem’t
(0),

166 
	`fSecÚdsSšûLa¡TimeCode
(0), 
	`fTÙ®TicksSšûLa¡TimeCode
(0),

167 
	`fP»vNewTÙ®Ticks
(0), 
	`fP»vPiùu»CouÁD–
(1), 
	$fJu¡SawTimeCode
(
F®£
) {

168 
	}
}

170 
	gMPEG4VideoSŒ—mP¬£r
::~
	$MPEG4VideoSŒ—mP¬£r
() {

171 
	}
}

173 
MPEG4VideoSŒ—mP¬£r
::
	$£tP¬£S‹
(
MPEGP¬£S‹
 
·r£S‹
) {

174 
fCu¼’tP¬£S‹
 = 
·r£S‹
;

175 
MPEGVideoSŒ—mP¬£r
::
	`£tP¬£S‹
();

176 
	}
}

178 
	gMPEG4VideoSŒ—mP¬£r
::
	$æushIÅut
() {

179 
fSecÚdsSšûLa¡TimeCode
 = 0;

180 
fTÙ®TicksSšûLa¡TimeCode
 = 0;

181 
fP»vNewTÙ®Ticks
 = 0;

182 
fP»vPiùu»CouÁD–
 = 1;

184 
SŒ—mP¬£r
::
	`æushIÅut
();

185 ià(
fCu¼’tP¬£S‹
 !ğ
PARSING_VISUAL_OBJECT_SEQUENCE
) {

186 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT_SEQUENCE
);

188 
	}
}

191 
	gMPEG4VideoSŒ—mP¬£r
::
	$·r£
() {

192 
Œy
 {

193 
fCu¼’tP¬£S‹
) {

194 
PARSING_VISUAL_OBJECT_SEQUENCE
: {

195  
	`·r£Visu®ObjeùSequ’û
();

197 
PARSING_VISUAL_OBJECT_SEQUENCE_SEEN_CODE
: {

198  
	`·r£Visu®ObjeùSequ’û
(
True
);

200 
PARSING_VISUAL_OBJECT
: {

201  
	`·r£Visu®Objeù
();

203 
PARSING_VIDEO_OBJECT_LAYER
: {

204  
	`·r£VideoObjeùLay”
();

206 
PARSING_GROUP_OF_VIDEO_OBJECT_PLANE
: {

207  
	`·r£GroupOfVideoObjeùPÏÃ
();

209 
PARSING_VIDEO_OBJECT_PLANE
: {

210  
	`·r£VideoObjeùPÏÃ
();

212 
PARSING_VISUAL_OBJECT_SEQUENCE_END_CODE
: {

213  
	`·r£Visu®ObjeùSequ’ûEndCode
();

219 } 
	`ÿtch
 () {

220 #ifdeà
DEBUG


221 
	`årštf
(
¡d”r
, "MPEG4VideoStreamParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

225 
	}
}

227 
	#VISUAL_OBJECT_SEQUENCE_START_CODE
 0x000001B0

	)

228 
	#VISUAL_OBJECT_SEQUENCE_END_CODE
 0x000001B1

	)

229 
	#GROUP_VOP_START_CODE
 0x000001B3

	)

230 
	#VISUAL_OBJECT_START_CODE
 0x000001B5

	)

231 
	#VOP_START_CODE
 0x000001B6

	)

233 
	gMPEG4VideoSŒ—mP¬£r


234 ::
	$·r£Visu®ObjeùSequ’û
(
BoŞ—n
 
haveS“nS¹Code
) {

235 #ifdeà
DEBUG


236 
	`årštf
(
¡d”r
, "parsing VisualObjectSequence\n");

238 
	`usšgSourû
()->
	`¡¬tNewCÚfig
();

239 
u_št32_t
 
fœ¡4By‹s
;

240 ià(!
haveS“nS¹Code
) {

241 (
fœ¡4By‹s
 = 
	`‹¡4By‹s
()è!ğ
VISUAL_OBJECT_SEQUENCE_START_CODE
) {

242 #ifdeà
DEBUG


243 
	`årštf
(
¡d”r
, "ignÜšg‚Ú VS h—d”: 0x%08x\n", 
fœ¡4By‹s
);

245 
	`g‘1By‹
(); 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT_SEQUENCE
);

248 
fœ¡4By‹s
 = 
	`g‘4By‹s
();

251 
fœ¡4By‹s
 = 
VISUAL_OBJECT_SEQUENCE_START_CODE
;

253 
	`§ve4By‹s
(
fœ¡4By‹s
);

256 
u_št8_t
 
·li
 = 
	`g‘1By‹
();

257 #ifdeà
DEBUG


258 
	`årštf
(
¡d”r
, "´ofe_ªd_Ëv–_šdiÿtiÚ: %02x\n", 
·li
);

260 
	`§veBy‹
(
·li
);

261 
	`usšgSourû
()->
fProfeAndLev–IndiÿtiÚ
 = 
·li
;

265 
u_št32_t
 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

266 
Ãxt4By‹s
 !ğ
VISUAL_OBJECT_START_CODE
) {

267 
	`§veToNextCode
(
Ãxt4By‹s
);

270 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT
);

273 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fTÙ®TicksSšûLa¡TimeCode
);

276 
	`usšgSourû
()->
	`­³ndToNewCÚfig
(
fS¹OfF¿me
, 
	`curF¿meSize
());

278  
	`curF¿meSize
();

279 
	}
}

281 
šlše
 
BoŞ—n
 
	$isVideoObjeùS¹Code
(
u_št32_t
 
code
) {

282  
code
 >= 0x00000100 && code <= 0x0000011F;

283 
	}
}

285 
	gMPEG4VideoSŒ—mP¬£r
::
	$·r£Visu®Objeù
() {

286 #ifdeà
DEBUG


287 
	`årštf
(
¡d”r
, "parsing VisualObject\n");

290 
	`§ve4By‹s
(
VISUAL_OBJECT_START_CODE
);

293 
u_št8_t
 
ÃxtBy‹
 = 
	`g‘1By‹
(); 
	`§veBy‹
(nextByte);

294 
BoŞ—n
 
is_visu®_objeù_id’tif›r
 = (
ÃxtBy‹
&0x80) != 0;

295 
u_št8_t
 
visu®_objeù_ty³
;

296 ià(
is_visu®_objeù_id’tif›r
) {

297 #ifdeà
DEBUG


298 
	`årštf
(
¡d”r
, "visu®_objeù_v”id: 0x%x; visu®_objeù_´iÜ™y: 0x%x\n", (
ÃxtBy‹
&0x78)>>3, (nextByte&0x07));

300 
ÃxtBy‹
 = 
	`g‘1By‹
(); 
	`§veBy‹
(nextByte);

301 
visu®_objeù_ty³
 = (
ÃxtBy‹
&0xF0)>>4;

303 
visu®_objeù_ty³
 = (
ÃxtBy‹
&0x78)>>3;

305 #ifdeà
DEBUG


306 
	`årštf
(
¡d”r
, "visu®_objeù_ty³: 0x%x\n", 
visu®_objeù_ty³
);

309 ià(
visu®_objeù_ty³
 != 1) {

310 
	`usšgSourû
()->
	`’vœ
(è<< "MPEG4VideoSŒ—mP¬£r::·r£Visu®Objeù(): W¬nšg: WdÚ'ˆhªdË visu®_objeù_ty³ " << 
visu®_objeù_ty³
 << "\n";

315 
u_št32_t
 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

316 !
	`isVideoObjeùS¹Code
(
Ãxt4By‹s
)) {

317 
	`§veToNextCode
(
Ãxt4By‹s
);

319 
	`§ve4By‹s
(
Ãxt4By‹s
);

320 #ifdeà
DEBUG


321 
	`årštf
(
¡d”r
, "§w‡ video_objeù_¡¬t_code: 0x%08x\n", 
Ãxt4By‹s
);

324 
	`£tP¬£S‹
(
PARSING_VIDEO_OBJECT_LAYER
);

327 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fTÙ®TicksSšûLa¡TimeCode
);

330 
	`usšgSourû
()->
	`­³ndToNewCÚfig
(
fS¹OfF¿me
, 
	`curF¿meSize
());

332  
	`curF¿meSize
();

333 
	}
}

335 
šlše
 
BoŞ—n
 
	$isVideoObjeùLay”S¹Code
(
u_št32_t
 
code
) {

336  
code
 >= 0x00000120 && code <= 0x0000012F;

337 
	}
}

339 
BoŞ—n
 
	gMPEG4VideoSŒ—mP¬£r
::
	$g‘NextF¿meB™
(
u_št8_t
& 
»suÉ
) {

340 ià(
fNumB™sS“nSoF¬
/8 >ğ
	`curF¿meSize
()è 
F®£
;

342 
u_št8_t
 
ÃxtBy‹
 = 
fS¹OfF¿me
[
fNumB™sS“nSoF¬
/8];

343 
»suÉ
 = (
ÃxtBy‹
>>(7-
fNumB™sS“nSoF¬
%8))&1;

344 ++
fNumB™sS“nSoF¬
;

345  
True
;

346 
	}
}

348 
BoŞ—n
 
	gMPEG4VideoSŒ—mP¬£r
::
	$g‘NextF¿meB™s
(
numB™s
,

349 
u_št32_t
& 
»suÉ
) {

350 
»suÉ
 = 0;

351 
i
 = 0; i < 
numB™s
; ++i) {

352 
u_št8_t
 
ÃxtB™
;

353 ià(!
	`g‘NextF¿meB™
(
ÃxtB™
)è 
F®£
;

354 
»suÉ
 = (»suÉ<<1)|
ÃxtB™
;

356  
True
;

357 
	}
}

359 
	gMPEG4VideoSŒ—mP¬£r
::
	$ª®yzeVOLH—d”
() {

362 
fNumB™sS“nSoF¬
 = 41;

364 
u_št8_t
 
is_objeù_Ïy”_id’tif›r
;

365 ià(!
	`g‘NextF¿meB™
(
is_objeù_Ïy”_id’tif›r
)) ;

366 ià(
is_objeù_Ïy”_id’tif›r
è
fNumB™sS“nSoF¬
 += 7;

368 
u_št32_t
 
a¥eù_¿tio_šfo
;

369 ià(!
	`g‘NextF¿meB™s
(4, 
a¥eù_¿tio_šfo
)) ;

370 ià(
a¥eù_¿tio_šfo
 =ğ15 ) 
fNumB™sS“nSoF¬
 += 16;

372 
u_št8_t
 
vŞ_cÚŒŞ_·¿m‘”s
;

373 ià(!
	`g‘NextF¿meB™
(
vŞ_cÚŒŞ_·¿m‘”s
)) ;

374 ià(
vŞ_cÚŒŞ_·¿m‘”s
) {

375 
fNumB™sS“nSoF¬
 += 3;

376 
u_št8_t
 
vbw_·¿m‘”s
;

377 ià(!
	`g‘NextF¿meB™
(
vbw_·¿m‘”s
)) ;

378 ià(
vbw_·¿m‘”s
è
fNumB™sS“nSoF¬
 += 79;

381 
fNumB™sS“nSoF¬
 += 2;

382 
u_št8_t
 
m¬k”_b™
;

383 ià(!
	`g‘NextF¿meB™
(
m¬k”_b™
)) ;

384 ià(
m¬k”_b™
 != 1) {

385 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::analyzeVOLHeader(): marker_bit 1‚ot set!\n";

389 ià(!
	`g‘NextF¿meB™s
(16, 
vİ_time_šüem’t_»sŞutiÚ
)) ;

390 #ifdeà
DEBUG


391 
	`årštf
(
¡d”r
, "vİ_time_šüem’t_»sŞutiÚ: %d\n", 
vİ_time_šüem’t_»sŞutiÚ
);

393 ià(
vİ_time_šüem’t_»sŞutiÚ
 == 0) {

394 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::analyzeVOLHeader(): vop_time_increment_resolution is zero!\n";

398 
fNumVTIRB™s
 = 0;

399 
‹¡
 = 
vİ_time_šüem’t_»sŞutiÚ
;est>0;est /= 2) {

400 ++
fNumVTIRB™s
;

403 ià(!
	`g‘NextF¿meB™
(
m¬k”_b™
)) ;

404 ià(
m¬k”_b™
 != 1) {

405 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::analyzeVOLHeader(): marker_bit 2‚ot set!\n";

409 ià(!
	`g‘NextF¿meB™
(
fixed_vİ_¿‹
)) ;

410 ià(
fixed_vİ_¿‹
) {

412 ià(!
	`g‘NextF¿meB™s
(
fNumVTIRB™s
, 
fixed_vİ_time_šüem’t
)) ;

413 #ifdeà
DEBUG


414 
	`årštf
(
¡d”r
, "fixed_vİ_time_šüem’t: %d\n", 
fixed_vİ_time_šüem’t
);

415 ià(
fixed_vİ_time_šüem’t
 == 0) {

416 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::analyzeVOLHeader(): fixed_vop_time_increment is zero!\n";

422 
	`usšgSourû
()->
fF¿meR©e
 = ()
vİ_time_šüem’t_»sŞutiÚ
;

423 #ifdeà
DEBUG


424 
	`årštf
(
¡d”r
, "fixed_vİ_¿‹: %d; 'äame' (»®lyickè¿‹: %f\n", 
fixed_vİ_¿‹
, 
	`usšgSourû
()->
fF¿meR©e
);

430 ià(
fNumB™sS“nSoF¬
/8 >ğ
	`curF¿meSize
()) {

431 
”rMsg
[200];

432 
	`¥rštf
(
”rMsg
, "NÙƒnough b™ š VOL h—d”: %d/8 >ğ%d\n", 
fNumB™sS“nSoF¬
, 
	`curF¿meSize
());

433 
	`usšgSourû
()->
	`’vœ
(è<< 
”rMsg
;

435 
	}
}

437 
	gMPEG4VideoSŒ—mP¬£r
::
	$·r£VideoObjeùLay”
() {

438 #ifdeà
DEBUG


439 
	`årštf
(
¡d”r
, "parsing VideoObjectLayer\n");

444 
u_št32_t
 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

445 ià(!
	`isVideoObjeùLay”S¹Code
(
Ãxt4By‹s
)) {

446 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::parseVideoObjectLayer(): This‡ppearso be‡ 'short video header', which we current don't support\n";

452 
	`§veToNextCode
(
Ãxt4By‹s
);

453 } 
Ãxt4By‹s
 !ğ
GROUP_VOP_START_CODE


454 && 
Ãxt4By‹s
 !ğ
VOP_START_CODE
);

456 
	`ª®yzeVOLH—d”
();

458 
	`£tP¬£S‹
((
Ãxt4By‹s
 =ğ
GROUP_VOP_START_CODE
)

459 ? 
PARSING_GROUP_OF_VIDEO_OBJECT_PLANE


460 : 
PARSING_VIDEO_OBJECT_PLANE
);

463 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fTÙ®TicksSšûLa¡TimeCode
);

466 
	`usšgSourû
()->
	`­³ndToNewCÚfig
(
fS¹OfF¿me
, 
	`curF¿meSize
());

467 
	`usšgSourû
()->
	`com¶‘eNewCÚfig
();

469  
	`curF¿meSize
();

470 
	}
}

472 
	gMPEG4VideoSŒ—mP¬£r
::
	$·r£GroupOfVideoObjeùPÏÃ
() {

473 #ifdeà
DEBUG


474 
	`årštf
(
¡d”r
, "parsing GroupOfVideoObjectPlane\n");

477 
	`§ve4By‹s
(
GROUP_VOP_START_CODE
);

480 
u_št8_t
 
Ãxt3By‹s
[3];

481 
	`g‘By‹s
(
Ãxt3By‹s
, 3);

482 
	`§veBy‹
(
Ãxt3By‹s
[0]);saveByte(next3Bytes[1]);saveByte(next3Bytes[2]);

483 
time_code


484 ğ(
Ãxt3By‹s
[0]<<10)|(next3Bytes[1]<<2)|(next3Bytes[2]>>6);

485 
time_code_hours
 = (
time_code
&0x0003E000)>>13;

486 
time_code_mšu‹s
 = (
time_code
&0x00001F80)>>7;

487 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_TIMESTAMPS
)

488 
BoŞ—n
 
m¬k”_b™
 = (
time_code
&0x00000040) != 0;

490 
time_code_£cÚds
 = (
time_code
&0x0000003F);

491 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_TIMESTAMPS
)

492 
	`årštf
(
¡d”r
, "time_code: 0x%05x, hour %d, mšu‹ %d, m¬k”_b™ %d, secÚd %d\n", 
time_code
, 
time_code_hours
, 
time_code_mšu‹s
, 
m¬k”_b™
, 
time_code_£cÚds
);

494 
fJu¡SawTimeCode
 = 
True
;

497 
u_št32_t
 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

498 
Ãxt4By‹s
 !ğ
VOP_START_CODE
) {

499 
	`§veToNextCode
(
Ãxt4By‹s
);

503 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fTÙ®TicksSšûLa¡TimeCode
);

506 
	`usšgSourû
()->
	`£tTimeCode
(
time_code_hours
, 
time_code_mšu‹s
,

507 
time_code_£cÚds
, 0, 0);

510 
fSecÚdsSšûLa¡TimeCode
 = 0;

511 ià(
fixed_vİ_¿‹
è
fTÙ®TicksSšûLa¡TimeCode
 = 0;

513 
	`£tP¬£S‹
(
PARSING_VIDEO_OBJECT_PLANE
);

515  
	`curF¿meSize
();

516 
	}
}

518 
	gMPEG4VideoSŒ—mP¬£r
::
	$·r£VideoObjeùPÏÃ
() {

519 #ifdeà
DEBUG


520 
	`årštf
(
¡d”r
, "#parsing VideoObjectPlane\n");

523 
	`§ve4By‹s
(
VOP_START_CODE
);

526 
u_št8_t
 
ÃxtBy‹
 = 
	`g‘1By‹
(); 
	`§veBy‹
(nextByte);

527 
u_št8_t
 
vİ_codšg_ty³
 = 
ÃxtBy‹
>>6;

531 
u_št32_t
 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

532 
u_št32_t
 
timeInfo
 = (
ÃxtBy‹
<<(32-6))|(
Ãxt4By‹s
>>6);

533 
modulo_time_ba£
 = 0;

534 
u_št32_t
 
mask
 = 0x80000000;

535 (
timeInfo
&
mask
) != 0) {

536 ++
modulo_time_ba£
;

537 
mask
 >>= 1;

539 
mask
 >>= 1;

542 ià((
timeInfo
&
mask
) == 0) {

543 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::parseVideoObjectPlane(): marker bit‚ot set!\n";

545 
mask
 >>= 1;

549 ià((
mask
>>(
fNumVTIRB™s
-1)) == 0) {

550 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::parseVideoObjectPlane(): 32-bits‡re‚otƒnougho get \"vop_time_increment\"!\n";

552 
vİ_time_šüem’t
 = 0;

553 
i
 = 0; i < 
fNumVTIRB™s
; ++i) {

554 
vİ_time_šüem’t
 |ğ
timeInfo
&
mask
;

555 
mask
 >>= 1;

557 
mask
 != 0) {

558 
vİ_time_šüem’t
 >>= 1;

559 
mask
 >>= 1;

561 #ifdeà
DEBUG


562 
	`årštf
(
¡d”r
, "vİ_codšg_ty³: %d(%c), modulo_time_ba£: %d, vİ_time_šüem’t: %d\n", 
vİ_codšg_ty³
, "IPBS"[vİ_codšg_ty³], 
modulo_time_ba£
, 
vİ_time_šüem’t
);

566 
	`§veToNextCode
(
Ãxt4By‹s
);

569 ià(
fixed_vİ_time_šüem’t
 > 0) {

571 
	`usšgSourû
()->
fPiùu»CouÁ
 +ğ
fixed_vİ_time_šüem’t
;

572 ià(
vİ_time_šüem’t
 > 0 || 
modulo_time_ba£
 > 0) {

573 
fTÙ®TicksSšûLa¡TimeCode
 +ğ
fixed_vİ_time_šüem’t
;

578 
ÃwTÙ®Ticks


579 ğ(
fSecÚdsSšûLa¡TimeCode
 + 
modulo_time_ba£
)*
vİ_time_šüem’t_»sŞutiÚ


580 + 
vİ_time_šüem’t
;

581 ià(
ÃwTÙ®Ticks
 =ğ
fP»vNewTÙ®Ticks
 && fPrevNewTotalTicks > 0) {

585 #ifdeà
DEBUG


586 
	`årštf
(
¡d”r
, "Buggy MPEG-4 video stream: \"vop_time_increment\" did‚ot change!\n");

589 
	`usšgSourû
()->
fPiùu»CouÁ
 +ğ
vİ_time_šüem’t
;

590 
fTÙ®TicksSšûLa¡TimeCode
 +ğ
vİ_time_šüem’t
;

591 
fSecÚdsSšûLa¡TimeCode
 +ğ
modulo_time_ba£
;

593 ià(
ÃwTÙ®Ticks
 < 
fP»vNewTÙ®Ticks
 && 
vİ_codšg_ty³
 != 2

594 && 
modulo_time_ba£
 =ğ0 && 
vİ_time_šüem’t
 =ğ0 && !
fJu¡SawTimeCode
) {

599 #ifdeà
DEBUG


600 
	`årštf
(
¡d”r
, "Buggy MPEG-4 video stream: \"vop_time_increment\" wrapped‡round, but without \"modulo_time_base\" changing!\n");

602 ++
fSecÚdsSšûLa¡TimeCode
;

603 
ÃwTÙ®Ticks
 +ğ
vİ_time_šüem’t_»sŞutiÚ
;

605 
fP»vNewTÙ®Ticks
 = 
ÃwTÙ®Ticks
;

606 ià(
vİ_codšg_ty³
 != 2 ) {

607 
piùu»CouÁD–
 = 
ÃwTÙ®Ticks
 - 
fTÙ®TicksSšûLa¡TimeCode
;

608 ià(
piùu»CouÁD–
 <ğ0èpiùu»CouÁD– = 
fP»vPiùu»CouÁD–
;

610 
	`usšgSourû
()->
fPiùu»CouÁ
 +ğ
piùu»CouÁD–
;

611 
fP»vPiùu»CouÁD–
 = 
piùu»CouÁD–
;

612 
fTÙ®TicksSšûLa¡TimeCode
 = 
ÃwTÙ®Ticks
;

613 
fSecÚdsSšûLa¡TimeCode
 +ğ
modulo_time_ba£
;

617 
fJu¡SawTimeCode
 = 
F®£
;

621 
	`usšgSourû
()->
fPiùu»EndM¬k”
 = 
True
;

622 
Ãxt4By‹s
) {

623 
VISUAL_OBJECT_SEQUENCE_END_CODE
: {

624 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT_SEQUENCE_END_CODE
);

627 
VISUAL_OBJECT_SEQUENCE_START_CODE
: {

628 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT_SEQUENCE_SEEN_CODE
);

631 
VISUAL_OBJECT_START_CODE
: {

632 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT
);

635 
GROUP_VOP_START_CODE
: {

636 
	`£tP¬£S‹
(
PARSING_GROUP_OF_VIDEO_OBJECT_PLANE
);

639 
VOP_START_CODE
: {

640 
	`£tP¬£S‹
(
PARSING_VIDEO_OBJECT_PLANE
);

644 ià(
	`isVideoObjeùS¹Code
(
Ãxt4By‹s
)) {

645 
	`£tP¬£S‹
(
PARSING_VIDEO_OBJECT_LAYER
);

646 } ià(
	`isVideoObjeùLay”S¹Code
(
Ãxt4By‹s
)){

648 
u_št32_t
 
Ãxt4By‹s
 = 
	`g‘4By‹s
();

649 
Ãxt4By‹s
 !ğ
VOP_START_CODE
) {

650 
	`§veToNextCode
(
Ãxt4By‹s
);

652 
	`£tP¬£S‹
(
PARSING_VIDEO_OBJECT_PLANE
);

654 
	`usšgSourû
()->
	`’vœ
() << "MPEG4VideoStreamParser::parseVideoObjectPlane(): Saw unexpected code "

655 << (*)
Ãxt4By‹s
 << "\n";

656 
	`£tP¬£S‹
(
PARSING_VIDEO_OBJECT_PLANE
);

663 
	`usšgSourû
()->
	`compu‹P»£Á©iÚTime
(
fTÙ®TicksSšûLa¡TimeCode
);

665  
	`curF¿meSize
();

666 
	}
}

668 
	gMPEG4VideoSŒ—mP¬£r
::
	$·r£Visu®ObjeùSequ’ûEndCode
() {

669 #ifdeà
DEBUG


670 
	`årštf
(
¡d”r
, "parsing VISUAL_OBJECT_SEQUENCE_END_CODE\n");

673 
	`§ve4By‹s
(
VISUAL_OBJECT_SEQUENCE_END_CODE
);

675 
	`£tP¬£S‹
(
PARSING_VISUAL_OBJECT_SEQUENCE
);

678 
	`usšgSourû
()->
fPiùu»EndM¬k”
 = 
True
;

680  
	`curF¿meSize
();

681 
	}
}

	@liveMedia/MPEGVideoStreamFramer.cpp

22 
	~"MPEGVideoSŒ—mP¬£r.hh
"

23 
	~<GroupsockH–³r.hh
>

27 
	gTimeCode
::
	$TimeCode
()

28 : 
	`days
(0), 
	`hours
(0), 
	`mšu‹s
(0), 
	`£cÚds
(0), 
	$piùu»s
(0) {

29 
	}
}

31 
	gTimeCode
::~
	$TimeCode
() {

32 
	}
}

34 
TimeCode
::
İ”©Ü
==(TimeCodcÚ¡& 
¬g2
) {

35  
piùu»s
 =ğ
¬g2
.piùu» && 
£cÚds
 ==‡rg2.seconds

36 && 
mšu‹s
 =ğ
¬g2
.mšu‹ && 
hours
 =ğ¬g2.hour && 
days
 ==‡rg2.days;

41 
	gMPEGVideoSŒ—mF¿m”
::
	$MPEGVideoSŒ—mF¿m”
(
U§geEnvœÚm’t
& 
’v
,

42 
F¿medSourû
* 
šputSourû
)

43 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

44 
	`fF¿meR©e
(0.0) ,

45 
	$fP¬£r
(
NULL
) {

46 
	`»£t
();

47 
	}
}

49 
	gMPEGVideoSŒ—mF¿m”
::~
	$MPEGVideoSŒ—mF¿m”
() {

50 
d–‘e
 
fP¬£r
;

51 
	}
}

53 
	gMPEGVideoSŒ—mF¿m”
::
	$æushIÅut
() {

54 
	`»£t
();

55 ià(
fP¬£r
 !ğ
NULL
èfP¬£r->
	`æushIÅut
();

56 
	}
}

58 
	gMPEGVideoSŒ—mF¿m”
::
	$»£t
() {

59 
fPiùu»CouÁ
 = 0;

60 
fPiùu»EndM¬k”
 = 
F®£
;

61 
fPiùu»sAdju¡m’t
 = 0;

62 
fPiùu»TimeBa£
 = 0.0;

63 
fTcSecsBa£
 = 0;

64 
fHaveS“nFœ¡TimeCode
 = 
F®£
;

67 
	`g‘timeofday
(&
fP»£Á©iÚTimeBa£
, 
NULL
);

68 
	}
}

70 #ifdeà
DEBUG


71 
timev®
 
	gfœ¡PT
;

73 
	gMPEGVideoSŒ—mF¿m”


74 ::
	$compu‹P»£Á©iÚTime
(
numAdd™iÚ®Piùu»s
) {

77 
TimeCode
& 
tc
 = 
fCurGOPTimeCode
;

79 
tcSecs


80 ğ(((
tc
.
days
*24)+tc.
hours
)*60+tc.
mšu‹s
)*60+tc.
£cÚds
 - 
fTcSecsBa£
;

81 
piùu»Time
 = 
fF¿meR©e
 == 0.0 ? 0.0

82 : (
tc
.
piùu»s
 + 
fPiùu»sAdju¡m’t
 + 
numAdd™iÚ®Piùu»s
)/
fF¿meR©e
;

83 
piùu»Time
 < 
fPiùu»TimeBa£
) {

84 ià(
tcSecs
 > 0)cSecs -= 1;

85 
piùu»Time
 += 1.0;

87 
piùu»Time
 -ğ
fPiùu»TimeBa£
;

88 ià(
piùu»Time
 < 0.0)…ictureTime = 0.0;

89 
piùu»SecÚds
 = ()
piùu»Time
;

90 
piùu»F¿ùiÚOfSecÚd
 = 
piùu»Time
 - ()
piùu»SecÚds
;

92 
fP»£Á©iÚTime
 = 
fP»£Á©iÚTimeBa£
;

93 
fP»£Á©iÚTime
.
tv_£c
 +ğ
tcSecs
 + 
piùu»SecÚds
;

94 
fP»£Á©iÚTime
.
tv_u£c
 +ğ()(
piùu»F¿ùiÚOfSecÚd
*1000000.0);

95 ià(
fP»£Á©iÚTime
.
tv_u£c
 >= 1000000) {

96 
fP»£Á©iÚTime
.
tv_u£c
 -= 1000000;

97 ++
fP»£Á©iÚTime
.
tv_£c
;

99 #ifdeà
DEBUG


100 ià(
fœ¡PT
.
tv_£c
 =ğ0 && fœ¡PT.
tv_u£c
 =ğ0èfœ¡PT = 
fP»£Á©iÚTime
;

101 
timev®
 
diffPT
;

102 
diffPT
.
tv_£c
 = 
fP»£Á©iÚTime
.tv_£ø- 
fœ¡PT
.tv_sec;

103 
diffPT
.
tv_u£c
 = 
fP»£Á©iÚTime
.tv_u£ø- 
fœ¡PT
.tv_usec;

104 ià(
fP»£Á©iÚTime
.
tv_u£c
 < 
fœ¡PT
.tv_usec) {

105 --
diffPT
.
tv_£c
;

106 
diffPT
.
tv_u£c
 += 1000000;

108 
	`årštf
(
¡d”r
, "MPEGVideoSŒ—mF¿m”::compu‹P»£Á©iÚTime(%dè-> %lu.%06ld [%lu.%06ld]\n", 
numAdd™iÚ®Piùu»s
, 
fP»£Á©iÚTime
.
tv_£c
, fP»£Á©iÚTime.
tv_u£c
, 
diffPT
.tv_sec, diffPT.tv_usec);

110 
	}
}

112 
	gMPEGVideoSŒ—mF¿m”


113 ::
	$£tTimeCode
(
hours
, 
mšu‹s
, 
£cÚds
,

114 
piùu»s
, 
piùu»sSšûLa¡GOP
) {

115 
TimeCode
& 
tc
 = 
fCurGOPTimeCode
;

116 
days
 = 
tc
.days;

117 ià(
hours
 < 
tc
.hours) {

119 ++
days
;

121 
tc
.
days
 = days;

122 
tc
.
hours
 = hours;

123 
tc
.
mšu‹s
 = minutes;

124 
tc
.
£cÚds
 = seconds;

125 
tc
.
piùu»s
 =…ictures;

126 ià(!
fHaveS“nFœ¡TimeCode
) {

127 
fPiùu»TimeBa£
 = 
fF¿meR©e
 =ğ0.0 ? 0.0 : 
tc
.
piùu»s
/fFrameRate;

128 
fTcSecsBa£
 = (((
tc
.
days
*24)+tc.
hours
)*60+tc.
mšu‹s
)*60+tc.
£cÚds
;

129 
fHaveS“nFœ¡TimeCode
 = 
True
;

130 } ià(
fCurGOPTimeCode
 =ğ
fP»vGOPTimeCode
) {

132 
fPiùu»sAdju¡m’t
 +ğ
piùu»sSšûLa¡GOP
;

135 
fP»vGOPTimeCode
 = 
tc
;

136 
fPiùu»sAdju¡m’t
 = 0;

138 
	}
}

140 
	gMPEGVideoSŒ—mF¿m”
::
	$doG‘NextF¿me
() {

141 
fP¬£r
->
	`»gi¡”R—dIÁ”e¡
(
fTo
, 
fMaxSize
);

142 
	`cÚtšueR—dProûssšg
();

143 
	}
}

145 
	gMPEGVideoSŒ—mF¿m”
::
	$doStİG‘tšgF¿mes
() {

146 
	`æushIÅut
();

147 
F¿medF‹r
::
	`doStİG‘tšgF¿mes
();

148 
	}
}

150 
	gMPEGVideoSŒ—mF¿m”


151 ::
	$cÚtšueR—dProûssšg
(* 
ş›ÁD©a
,

153 
timev®
 ) {

154 
MPEGVideoSŒ—mF¿m”
* 
äam”
 = (MPEGVideoSŒ—mF¿m”*)
ş›ÁD©a
;

155 
äam”
->
	`cÚtšueR—dProûssšg
();

156 
	}
}

158 
	gMPEGVideoSŒ—mF¿m”
::
	$cÚtšueR—dProûssšg
() {

159 
acquœedF¿meSize
 = 
fP¬£r
->
	`·r£
();

160 ià(
acquœedF¿meSize
 > 0) {

163 
fF¿meSize
 = 
acquœedF¿meSize
;

164 
fNumTrunÿ‹dBy‹s
 = 
fP¬£r
->
	`numTrunÿ‹dBy‹s
();

169 
fDu¿tiÚInMiüo£cÚds


170 ğ(
fF¿meR©e
 =ğ0.0 || (()
fPiùu»CouÁ
) < 0) ? 0

171 : ()((
fPiùu»CouÁ
*1000000)/
fF¿meR©e
);

172 #ifdeà
DEBUG


173 
	`årštf
(
¡d”r
, "%d by‹ @%u.%06d, fDu¿tiÚInMiüo£cÚds: %d ((%d*1000000)/%f)\n", 
acquœedF¿meSize
, 
fP»£Á©iÚTime
.
tv_£c
, fP»£Á©iÚTime.
tv_u£c
, 
fDu¿tiÚInMiüo£cÚds
, 
fPiùu»CouÁ
, 
fF¿meR©e
);

175 
fPiùu»CouÁ
 = 0;

179 
	`aá”G‘tšg
(
this
);

185 
	}
}

	@liveMedia/MPEGVideoStreamParser.cpp

21 
	~"MPEGVideoSŒ—mP¬£r.hh
"

23 
	gMPEGVideoSŒ—mP¬£r


24 ::
	$MPEGVideoSŒ—mP¬£r
(
MPEGVideoSŒ—mF¿m”
* 
usšgSourû
,

25 
F¿medSourû
* 
šputSourû
)

26 : 
	`SŒ—mP¬£r
(
šputSourû
, 
F¿medSourû
::
hªdËClosu»
, 
usšgSourû
,

27 &
MPEGVideoSŒ—mF¿m”
::
cÚtšueR—dProûssšg
, 
usšgSourû
),

28 
	$fUsšgSourû
(
usšgSourû
) {

29 
	}
}

31 
	gMPEGVideoSŒ—mP¬£r
::~
	$MPEGVideoSŒ—mP¬£r
() {

32 
	}
}

34 
MPEGVideoSŒ—mP¬£r
::
	$»¡ÜeSavedP¬£rS‹
() {

35 
SŒ—mP¬£r
::
	`»¡ÜeSavedP¬£rS‹
();

36 
fTo
 = 
fSavedTo
;

37 
fNumTrunÿ‹dBy‹s
 = 
fSavedNumTrunÿ‹dBy‹s
;

38 
	}
}

40 
	gMPEGVideoSŒ—mP¬£r
::
	$»gi¡”R—dIÁ”e¡
(* 
to
,

41 
maxSize
) {

42 
fS¹OfF¿me
 = 
fTo
 = 
fSavedTo
 = 
to
;

43 
fLim™
 = 
to
 + 
maxSize
;

44 
fNumTrunÿ‹dBy‹s
 = 
fSavedNumTrunÿ‹dBy‹s
 = 0;

45 
	}
}

	@liveMedia/MatroskaDemuxedTrack.cpp

21 
	~"M©roskaDemuxedT¿ck.hh
"

22 
	~"M©roskaFe.hh
"

24 
	gM©roskaDemuxedT¿ck
::
	$£ekToTime
(& 
£ekNPT
) {

25 
fOurSourûDemux
.
	`£ekToTime
(
£ekNPT
);

26 
	}
}

28 
	gM©roskaDemuxedT¿ck
::
	$M©roskaDemuxedT¿ck
(
U§geEnvœÚm’t
& 
’v
, 
ŒackNumb”
, 
M©roskaDemux
& 
sourûDemux
)

29 : 
	`F¿medSourû
(
’v
),

30 
	`fOurT¿ckNumb”
(
ŒackNumb”
), 
	`fOurSourûDemux
(
sourûDemux
), 
	`fDu¿tiÚImb®ªû
(0),

31 
	$fOpusT¿ckNumb”
(0) {

32 
fP»vP»£Á©iÚTime
.
tv_£c
 = 0; fP»vP»£Á©iÚTime.
tv_u£c
 = 0;

33 
	}
}

35 
	gM©roskaDemuxedT¿ck
::~
	$M©roskaDemuxedT¿ck
() {

36 
fOurSourûDemux
.
	`»moveT¿ck
(
fOurT¿ckNumb”
);

37 
	}
}

39 
	gM©roskaDemuxedT¿ck
::
	$doG‘NextF¿me
() {

40 
fOurSourûDemux
.
	`cÚtšueR—dšg
();

41 
	}
}

43 cÚ¡* 
	gM©roskaDemuxedT¿ck
::
	$MIMEty³
() const {

44 
M©roskaT¿ck
* 
Œack
 = 
fOurSourûDemux
.
fOurFe
.
	`lookup
(
fOurT¿ckNumb”
);

45 ià(
Œack
 =ğ
NULL
)  "(unknown)";

46  
Œack
->
mimeTy³
;

47 
	}
}

	@liveMedia/MatroskaFile.cpp

21 
	~"M©roskaFeP¬£r.hh
"

22 
	~"M©roskaDemuxedT¿ck.hh
"

23 
	~<By‹SŒ—mFeSourû.hh
>

24 
	~<H264VideoSŒ—mDisü‘eF¿m”.hh
>

25 
	~<H265VideoSŒ—mDisü‘eF¿m”.hh
>

26 
	~<MPEG1Ü2AudioRTPSšk.hh
>

27 
	~<MPEG4G’”icRTPSšk.hh
>

28 
	~<AC3AudioRTPSšk.hh
>

29 
	~<Sim¶eRTPSšk.hh
>

30 
	~<VÜbisAudioRTPSšk.hh
>

31 
	~<H264VideoRTPSšk.hh
>

32 
	~<H265VideoRTPSšk.hh
>

33 
	~<VP8VideoRTPSšk.hh
>

34 
	~<VP9VideoRTPSšk.hh
>

35 
	~<TheÜaVideoRTPSšk.hh
>

36 
	~<T140TextRTPSšk.hh
>

40 şas 
	cCuePošt
 {

41 
	mpublic
:

42 
CuePošt
(
cueTime
, 
u_št64_t
 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
 );

43 
	mvœtu®
 ~
CuePošt
();

45 
addCuePošt
(
CuePošt
*& 
roÙ
, 
cueTime
, 
u_št64_t
 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
 ,

46 
BoŞ—n
& 
ÃedToRevi£B®ªûOfP¬’t
);

50 
BoŞ—n
 
lookup
(& 
cueTime
, 
u_št64_t
& 
»suÉClu¡”Off£tInFe
, & 
»suÉBlockNumW™hšClu¡”
);

52 
årštf
(
FILE
* 
fid
, 
CuePošt
* 
cuePošt
);

54 
	m´iv©e
:

56 
CuePošt
* 
fSubT»e
[2];

57 
CuePošt
* 
	$Ëá
(ècÚ¡ {  
fSubT»e
[0]; }

58 
CuePošt
* 
	$right
(ècÚ¡ {  
fSubT»e
[1]; 
	}
}

59 
	gfB®ªû
;

61 
rÙ©e
(
dœeùiÚ
 , 
CuePošt
*& 
roÙ
);

63 
	gfCueTime
;

64 
u_št64_t
 
	gfClu¡”Off£tInFe
;

65 
	gfBlockNumW™hšClu¡”
;

68 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, cÚ¡ 
CuePošt
* 
	gcuePošt
);

74 şas 
	cM©roskaT¿ckTabË
 {

75 
	mpublic
:

76 
M©roskaT¿ckTabË
();

77 
	mvœtu®
 ~
M©roskaT¿ckTabË
();

79 
add
(
M©roskaT¿ck
* 
ÃwT¿ck
, 
ŒackNumb”
);

80 
M©roskaT¿ck
* 
lookup
(
ŒackNumb”
);

82 
	$numT¿cks
() const;

84 şas 
	cI‹¿tÜ
 {

85 
public
:

86 
	`I‹¿tÜ
(
M©roskaT¿ckTabË
& 
ourTabË
);

87 
vœtu®
 ~
	`I‹¿tÜ
();

88 
M©roskaT¿ck
* 
	`Ãxt
();

89 
´iv©e
:

90 
HashTabË
::
I‹¿tÜ
* 
fI‹r
;

93 
´iv©e
:

94 
ä›nd
 
şass
 
I‹¿tÜ
;

95 
HashTabË
* 
fTabË
;

96 
	}
};

102 
	gM©roskaFe


103 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
, 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
,

104 cÚ¡* 
´eã¼edLªguage
) {

105 
Ãw
 
	`M©roskaFe
(
’v
, 
feName
, 
ÚC»©iÚ
, 
ÚC»©iÚCl›ÁD©a
, 
´eã¼edLªguage
);

106 
	}
}

108 
	gM©roskaFe
::
	$M©roskaFe
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
, 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
,

109 cÚ¡* 
´eã¼edLªguage
)

110 : 
	`Medium
(
’v
),

111 
	`fFeName
(
	`¡rDup
(
feName
)), 
	`fOnC»©iÚ
(
ÚC»©iÚ
), 
	`fOnC»©iÚCl›ÁD©a
(
ÚC»©iÚCl›ÁD©a
),

112 
	`fP»ã¼edLªguage
(
	`¡rDup
(
´eã¼edLªguage
)),

113 
	`fTimecodeSÿË
(1000000), 
	`fSegm’tDu¿tiÚ
(0.0), 
	`fSegm’tD©aOff£t
(0), 
	`fClu¡”Off£t
(0), 
	`fCuesOff£t
(0), 
	`fCuePošts
(
NULL
),

114 
	`fCho£nVideoT¿ckNumb”
(0), 
	`fCho£nAudioT¿ckNumb”
(0), 
	$fCho£nSubt™ËT¿ckNumb”
(0) {

115 
fT¿ckTabË
 = 
Ãw
 
M©roskaT¿ckTabË
;

116 
fDemuxesTabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

118 
F¿medSourû
* 
šputSourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
feName
);

119 ià(
šputSourû
 =ğ
NULL
) {

121 
fP¬£rFÜIn™Ÿliz©iÚ
 = 
NULL
;

122 
	`hªdËEndOfT¿ckH—d”P¬sšg
();

125 
fP¬£rFÜIn™Ÿliz©iÚ
 = 
Ãw
 
	`M©roskaFeP¬£r
(*
this
, 
šputSourû
, 
hªdËEndOfT¿ckH—d”P¬sšg
,his, 
NULL
);

127 
	}
}

129 
	gM©roskaFe
::~
	$M©roskaFe
() {

130 
d–‘e
 
fP¬£rFÜIn™Ÿliz©iÚ
;

131 
d–‘e
 
fCuePošts
;

134 
M©roskaDemux
* 
demux
;

135 (
demux
 = (
M©roskaDemux
*)
fDemuxesTabË
->
	`RemoveNext
()è!ğ
NULL
) {

136 
d–‘e
 
demux
;

138 
d–‘e
 
fDemuxesTabË
;

139 
d–‘e
 
fT¿ckTabË
;

141 
d–‘e
[] (*)
fP»ã¼edLªguage
;

142 
d–‘e
[] (*)
fFeName
;

143 
	}
}

145 
	gM©roskaFe
::
	$hªdËEndOfT¿ckH—d”P¬sšg
(* 
ş›ÁD©a
) {

146 ((
M©roskaFe
*)
ş›ÁD©a
)->
	`hªdËEndOfT¿ckH—d”P¬sšg
();

147 
	}
}

149 şas 
	cT¿ckChoiûRecÜd
 {

150 
	mpublic
:

151 
ŒackNumb”
;

152 
u_št8_t
 
	mŒackTy³
;

153 
	mchoiûFÏgs
;

156 
	gM©roskaFe
::
	$hªdËEndOfT¿ckH—d”P¬sšg
() {

165 
numT¿cks
 = 
fT¿ckTabË
->
	`numT¿cks
();

166 ià(
numT¿cks
 > 0) {

167 
T¿ckChoiûRecÜd
* 
ŒackChoiû
 = 
Ãw
 T¿ckChoiûRecÜd[
numT¿cks
];

168 
numEÇbËdT¿cks
 = 0;

169 
M©roskaT¿ckTabË
::
I‹¿tÜ
 
	`™”
(*
fT¿ckTabË
);

170 
M©roskaT¿ck
* 
Œack
;

171 (
Œack
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

172 ià(!
Œack
->
isEÇbËd
 ||¿ck->
ŒackTy³
 =ğ0 ||¿ck->
mimeTy³
[0] == '\0') ;

174 
ŒackChoiû
[
numEÇbËdT¿cks
].
ŒackNumb”
 = 
Œack
->trackNumber;

175 
ŒackChoiû
[
numEÇbËdT¿cks
].
ŒackTy³
 = 
Œack
->trackType;

178 
choiûFÏgs
 = 0;

179 ià(
fP»ã¼edLªguage
 !ğ
NULL
 && 
Œack
->
Ïnguage
 !ğNULL && 
	`¡rcmp
(fPreferredLanguage,rack->language) == 0) {

181 
choiûFÏgs
 |= 1;

183 ià(
Œack
->
isFÜûd
) {

184 
choiûFÏgs
 |= 4;

185 } ià(
Œack
->
isDeçuÉ
) {

186 
choiûFÏgs
 |= 2;

188 
ŒackChoiû
[
numEÇbËdT¿cks
].
choiûFÏgs
 = choiceFlags;

190 ++
numEÇbËdT¿cks
;

194 
u_št8_t
 
ŒackTy³
 = 0x01;¿ckTy³ !ğ
MATROSKA_TRACK_TYPE_OTHER
;rackType <<= 1) {

195 
be¡Num
 = -1;

196 
be¡ChoiûFÏgs
 = -1;

197 
i
 = 0; i < 
numEÇbËdT¿cks
; ++i) {

198 ià(
ŒackChoiû
[
i
].
ŒackTy³
 =ğŒackTy³ && (é¿ckChoiû[i].
choiûFÏgs
 > 
be¡ChoiûFÏgs
) {

199 
be¡Num
 = 
i
;

200 
be¡ChoiûFÏgs
 = ()
ŒackChoiû
[
i
].
choiûFÏgs
;

203 ià(
be¡ChoiûFÏgs
 >= 0) {

204 ià(
ŒackTy³
 =ğ
MATROSKA_TRACK_TYPE_VIDEO
è
fCho£nVideoT¿ckNumb”
 = 
ŒackChoiû
[
be¡Num
].
ŒackNumb”
;

205 ià(
ŒackTy³
 =ğ
MATROSKA_TRACK_TYPE_AUDIO
è
fCho£nAudioT¿ckNumb”
 = 
ŒackChoiû
[
be¡Num
].
ŒackNumb”
;

206 
fCho£nSubt™ËT¿ckNumb”
 = 
ŒackChoiû
[
be¡Num
].
ŒackNumb”
;

210 
d–‘e
[] 
ŒackChoiû
;

213 #ifdeà
DEBUG


214 ià(
fCho£nVideoT¿ckNumb”
 > 0è
	`årštf
(
¡d”r
, "Chosen videorack: #%d\n", fChosenVideoTrackNumber); fprintf(stderr, "No chosen videorack\n");

215 ià(
fCho£nAudioT¿ckNumb”
 > 0è
	`årštf
(
¡d”r
, "Chosen‡udiorack: #%d\n", fChosenAudioTrackNumber); fprintf(stderr, "No chosen‡udiorack\n");

216 ià(
fCho£nSubt™ËT¿ckNumb”
 > 0è
	`årštf
(
¡d”r
, "Chosen subtitlerack: #%d\n", fChosenSubtitleTrackNumber); fprintf(stderr, "No chosen subtitlerack\n");

220 
d–‘e
 
fP¬£rFÜIn™Ÿliz©iÚ
; fP¬£rFÜIn™Ÿliz©iÚ = 
NULL
;

223 ià(
fOnC»©iÚ
 !ğ
NULL
è(*fOnC»©iÚ)(
this
, 
fOnC»©iÚCl›ÁD©a
);

224 
	}
}

226 
M©roskaT¿ck
* 
	gM©roskaFe
::
	$lookup
(
ŒackNumb”
) const {

227  
fT¿ckTabË
->
	`lookup
(
ŒackNumb”
);

228 
	}
}

230 
M©roskaDemux
* 
	gM©roskaFe
::
	$ÃwDemux
() {

231 
M©roskaDemux
* 
demux
 = 
Ãw
 
	`M©roskaDemux
(*
this
);

232 
fDemuxesTabË
->
	`Add
((cÚ¡*)
demux
, demux);

234  
demux
;

235 
	}
}

237 
	gM©roskaFe
::
	$»moveDemux
(
M©roskaDemux
* 
demux
) {

238 
fDemuxesTabË
->
	`Remove
((cÚ¡*)
demux
);

239 
	}
}

241 
	gM©roskaFe
::
	$feDu¿tiÚ
() {

242 ià(
fCuePošts
 =ğ
NULL
)  0.0;

244  
	`£gm’tDu¿tiÚ
()*(
	`timecodeSÿË
()/1000000000.0f);

245 
	}
}

247 
F¿medSourû
* 
	gM©roskaFe


248 ::
	$ü—‹SourûFÜSŒ—mšg
(
F¿medSourû
* 
ba£Sourû
, 
ŒackNumb”
,

249 & 
e¡B™¿‹
, & 
numF‹rsInFrÚtOfT¿ck
) {

250 ià(
ba£Sourû
 =ğ
NULL
)  NULL;

252 
F¿medSourû
* 
»suÉ
 = 
ba£Sourû
;

253 
e¡B™¿‹
 = 100;

254 
numF‹rsInFrÚtOfT¿ck
 = 0;

259 
M©roskaT¿ck
* 
Œack
 = 
	`lookup
(
ŒackNumb”
);

260 ià(
Œack
 !ğ
NULL
) {

261 ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/MPEG") == 0) {

262 
e¡B™¿‹
 = 128;

263 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/AAC") == 0) {

264 
e¡B™¿‹
 = 96;

265 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/AC3") == 0) {

266 
e¡B™¿‹
 = 48;

267 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0) {

268 
e¡B™¿‹
 = 96;

269 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/H264") == 0) {

270 
e¡B™¿‹
 = 500;

272 
OutPack‘Bufãr
::
	`šü—£MaxSizeTo
(300000);

275 
»suÉ
 = 
H264VideoSŒ—mDisü‘eF¿m”
::
	`ü—‹New
(
	`’vœ
(),„esult);

276 ++
numF‹rsInFrÚtOfT¿ck
;

277 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/H265") == 0) {

278 
e¡B™¿‹
 = 500;

280 
OutPack‘Bufãr
::
	`šü—£MaxSizeTo
(300000);

283 
»suÉ
 = 
H265VideoSŒ—mDisü‘eF¿m”
::
	`ü—‹New
(
	`’vœ
(),„esult);

284 ++
numF‹rsInFrÚtOfT¿ck
;

285 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/VP8") == 0) {

286 
e¡B™¿‹
 = 500;

287 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/VP9") == 0) {

288 
e¡B™¿‹
 = 500;

289 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0) {

290 
e¡B™¿‹
 = 500;

291 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "text/T140") == 0) {

292 
e¡B™¿‹
 = 48;

296  
»suÉ
;

297 
	}
}

299 
	#g‘PrivBy‹
(
b
èià(
n
 =ğ0è; dØ{b = *
p
++; --n;} 0è

	)

300 
	#CHECK_PTR
 ià(
±r
 >ğ
lim™
è

	)

301 
	#NUM_BYTES_REMAINING
 ()(
lim™
 - 
±r
è

	)

303 
RTPSšk
* 
	gM©roskaFe


304 ::
	$ü—‹RTPSškFÜT¿ckNumb”
(
ŒackNumb”
, 
Groupsock
* 
¹pGroupsock
,

305 
¹pPaylßdTy³IfDyÇmic
) {

306 
RTPSšk
* 
»suÉ
 = 
NULL
;

309 
M©roskaT¿ck
* 
Œack
 = 
	`lookup
(
ŒackNumb”
);

310 ià(
Œack
 =ğ
NULL
) ;

312 ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/MPEG") == 0) {

313 
»suÉ
 = 
MPEG1Ü2AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

314 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/AAC") == 0) {

317 * 
cÚfigSŒ
 = 
Ãw
 [2*
Œack
->
codecPriv©eSize
 + 1]; ià(cÚfigSŒ =ğ
NULL
) ;

319 
i
 = 0; i < 
Œack
->
codecPriv©eSize
; ++i) {

320 
	`¥rštf
(&
cÚfigSŒ
[2*
i
], "%02X", 
Œack
->
codecPriv©e
[i]);

323 
»suÉ
 = 
MPEG4G’”icRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

324 
¹pPaylßdTy³IfDyÇmic
,

325 
Œack
->
§m¶šgF»qu’cy
,

326 "audio", "AAC-hbr", 
cÚfigSŒ
,

327 
Œack
->
numChªÃls
);

328 
d–‘e
[] 
cÚfigSŒ
;

329 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/AC3") == 0) {

330 
»suÉ
 = 
AC3AudioRTPSšk


331 ::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
, 
Œack
->
§m¶šgF»qu’cy
);

332 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/OPUS") == 0) {

333 
»suÉ
 = 
Sim¶eRTPSšk


334 ::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

335 48000, "audio", "OPUS", 2, 
F®£
 );

336 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0 || strcmp(track->mimeType, "video/THEORA") == 0) {

340 
u_št8_t
* 
id’tifiÿtiÚH—d”
 = 
NULL
; 
id’tifiÿtiÚH—d”Size
 = 0;

341 
u_št8_t
* 
comm’tH—d”
 = 
NULL
; 
comm’tH—d”Size
 = 0;

342 
u_št8_t
* 
£tupH—d”
 = 
NULL
; 
£tupH—d”Size
 = 0;

343 
BoŞ—n
 
isTheÜa
 = 
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0;

346 
u_št8_t
* 
p
 = 
Œack
->
codecPriv©e
;

347 
n
 = 
Œack
->
codecPriv©eSize
;

348 ià(
n
 =ğ0 || 
p
 =ğ
NULL
) ;

350 
u_št8_t
 
numH—d”s
;

351 
	`g‘PrivBy‹
(
numH—d”s
);

352 
h—d”Size
[3];

355 
sizesSum
 = 0;

356 
BoŞ—n
 
sucûss
 = 
True
;

357 
i
;

358 
i
 = 0; i < 
numH—d”s
 && i < 3; ++i) {

359 
Ën
 = 0;

360 
u_št8_t
 
c
;

363 
sucûss
 = 
F®£
;

364 
	`g‘PrivBy‹
(
c
);

365 
sucûss
 = 
True
;

367 
Ën
 +ğ
c
;

368 } 
c
 == 255);

369 ià(!
sucûss
 || 
Ën
 == 0) ;

371 
h—d”Size
[
i
] = 
Ën
;

372 
sizesSum
 +ğ
Ën
;

374 ià(!
sucûss
) ;

377 ià(
numH—d”s
 < 3) {

378 
fš®H—d”Size
 = 
n
 - 
sizesSum
;

379 ià(
fš®H—d”Size
 <= 0) ;

381 
h—d”Size
[
numH—d”s
] = ()
fš®H—d”Size
;

382 ++
numH—d”s
;

384 
numH—d”s
 = 3;

388 
i
 = 0; i < 
numH—d”s
; ++i) {

389 
sucûss
 = 
F®£
;

390 
ÃwH—d”Size
 = 
h—d”Size
[
i
];

391 
u_št8_t
* 
ÃwH—d”
 = 
Ãw
 u_št8_t[
ÃwH—d”Size
];

392 ià(
ÃwH—d”
 =ğ
NULL
) ;

394 
u_št8_t
* 
hdr
 = 
ÃwH—d”
;

395 
ÃwH—d”Size
-- > 0) {

396 
sucûss
 = 
F®£
;

397 
	`g‘PrivBy‹
(*
hdr
++);

398 
sucûss
 = 
True
;

400 ià(!
sucûss
) {

401 
d–‘e
[] 
ÃwH—d”
;

405 
u_št8_t
 
h—d”Ty³
 = 
ÃwH—d”
[0];

406 ià(
h—d”Ty³
 =ğ1 || (
isTheÜa
 && headerType == 0x80)) {

407 
d–‘e
[] 
id’tifiÿtiÚH—d”
; id’tifiÿtiÚH—d” = 
ÃwH—d”
;

408 
id’tifiÿtiÚH—d”Size
 = 
h—d”Size
[
i
];

409 } ià(
h—d”Ty³
 =ğ3 || (
isTheÜa
 && headerType == 0x81)) {

410 
d–‘e
[] 
comm’tH—d”
; comm’tH—d” = 
ÃwH—d”
;

411 
comm’tH—d”Size
 = 
h—d”Size
[
i
];

412 } ià(
h—d”Ty³
 =ğ5 || (
isTheÜa
 && headerType == 0x82)) {

413 
d–‘e
[] 
£tupH—d”
; s‘upH—d” = 
ÃwH—d”
;

414 
£tupH—d”Size
 = 
h—d”Size
[
i
];

416 
d–‘e
[] 
ÃwH—d”
;

419 ià(!
sucûss
) ;

421 ià(
isTheÜa
) {

422 
»suÉ
 = 
TheÜaVideoRTPSšk


423 ::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

424 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

425 
comm’tH—d”
, 
comm’tH—d”Size
,

426 
£tupH—d”
, 
£tupH—d”Size
);

428 
»suÉ
 = 
VÜbisAudioRTPSšk


429 ::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

430 
Œack
->
§m¶šgF»qu’cy
,¿ck->
numChªÃls
,

431 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

432 
comm’tH—d”
, 
comm’tH—d”Size
,

433 
£tupH—d”
, 
£tupH—d”Size
);

437 
d–‘e
[] 
id’tifiÿtiÚH—d”
; d–‘e[] 
comm’tH—d”
; d–‘e[] 
£tupH—d”
;

438 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/H264") == 0) {

440 
u_št8_t
* 
SPS
 = 
NULL
; 
SPSSize
 = 0;

441 
u_št8_t
* 
PPS
 = 
NULL
; 
PPSSize
 = 0;

442 
u_št8_t
* 
SPSªdPPSBy‹s
 = 
NULL
; 
numSPSªdPPSBy‹s
 = 0;

445 ià(
Œack
->
codecPriv©eSize
 < 6) ;

447 
numSPSªdPPSBy‹s
 = 
Œack
->
codecPriv©eSize
 - 5;

448 
SPSªdPPSBy‹s
 = &
Œack
->
codecPriv©e
[5];

452 
i
;

453 
u_št8_t
* 
±r
 = 
SPSªdPPSBy‹s
;

454 
u_št8_t
* 
lim™
 = &
SPSªdPPSBy‹s
[
numSPSªdPPSBy‹s
];

456 
numSPSs
 = (*
±r
++)&0x1F; 
CHECK_PTR
;

457 
i
 = 0; i < 
numSPSs
; ++i) {

458 
¥sSize
 = (*
±r
++)<<8; 
CHECK_PTR
;

459 
¥sSize
 |ğ*
±r
++; 
CHECK_PTR
;

461 ià(
¥sSize
 > 
NUM_BYTES_REMAINING
) ;

462 
u_št8_t
 
Çl_un™_ty³
 = 
±r
[0]&0x1F;

463 ià(
SPS
 =ğ
NULL
 && 
Çl_un™_ty³
 == 7 ) {

464 
SPSSize
 = 
¥sSize
;

465 
SPS
 = 
Ãw
 
u_št8_t
[
¥sSize
];

466 
	`memmove
(
SPS
, 
±r
, 
¥sSize
);

468 
±r
 +ğ
¥sSize
;

471 
numPPSs
 = (*
±r
++)&0x1F; 
CHECK_PTR
;

472 
i
 = 0; i < 
numPPSs
; ++i) {

473 
µsSize
 = (*
±r
++)<<8; 
CHECK_PTR
;

474 
µsSize
 |ğ*
±r
++; 
CHECK_PTR
;

476 ià(
µsSize
 > 
NUM_BYTES_REMAINING
) ;

477 
u_št8_t
 
Çl_un™_ty³
 = 
±r
[0]&0x1F;

478 ià(
PPS
 =ğ
NULL
 && 
Çl_un™_ty³
 == 8 ) {

479 
PPSSize
 = 
µsSize
;

480 
PPS
 = 
Ãw
 
u_št8_t
[
µsSize
];

481 
	`memmove
(
PPS
, 
±r
, 
µsSize
);

483 
±r
 +ğ
µsSize
;

487 
»suÉ
 = 
H264VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

488 
SPS
, 
SPSSize
, 
PPS
, 
PPSSize
);

490 
d–‘e
[] 
SPS
; d–‘e[] 
PPS
;

491 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/H265") == 0) {

492 
u_št8_t
* 
VPS
 = 
NULL
; 
VPSSize
 = 0;

493 
u_št8_t
* 
SPS
 = 
NULL
; 
SPSSize
 = 0;

494 
u_št8_t
* 
PPS
 = 
NULL
; 
PPSSize
 = 0;

495 
u_št8_t
* 
VPS_SPS_PPSBy‹s
 = 
NULL
; 
numVPS_SPS_PPSBy‹s
 = 0;

496 
i
;

499 ià(
Œack
->
codecPriv©eU£sH264FÜm©FÜH265
) {

502 ià(
Œack
->
codecPriv©eSize
 >= 6) {

503 
numVPS_SPS_PPSBy‹s
 = 
Œack
->
codecPriv©eSize
 - 5;

504 
VPS_SPS_PPSBy‹s
 = &
Œack
->
codecPriv©e
[5];

509 ià(
Œack
->
codecPriv©eSize
 >= 23) {

510 
numVPS_SPS_PPSBy‹s
 = 
Œack
->
codecPriv©eSize
 - 22;

511 
VPS_SPS_PPSBy‹s
 = &
Œack
->
codecPriv©e
[22];

517 ià(
numVPS_SPS_PPSBy‹s
 =ğ0 || 
VPS_SPS_PPSBy‹s
 =ğ
NULL
) ;

518 
u_št8_t
* 
±r
 = 
VPS_SPS_PPSBy‹s
;

519 
u_št8_t
* 
lim™
 = &
VPS_SPS_PPSBy‹s
[
numVPS_SPS_PPSBy‹s
];

521 ià(
Œack
->
codecPriv©eU£sH264FÜm©FÜH265
) {

523 
NUM_BYTES_REMAINING
 > 0) {

524 
numNALUn™s
 = (*
±r
++)&0x1F; 
CHECK_PTR
;

525 
i
 = 0; i < 
numNALUn™s
; ++i) {

526 
ÇlUn™L’gth
 = (*
±r
++)<<8; 
CHECK_PTR
;

527 
ÇlUn™L’gth
 |ğ*
±r
++; 
CHECK_PTR
;

529 ià(
ÇlUn™L’gth
 > 
NUM_BYTES_REMAINING
) ;

530 
u_št8_t
 
Çl_un™_ty³
 = (
±r
[0]&0x7E)>>1;

531 ià(
Çl_un™_ty³
 == 32) {

532 
VPSSize
 = 
ÇlUn™L’gth
;

533 
d–‘e
[] 
VPS
; VPS = 
Ãw
 
u_št8_t
[
ÇlUn™L’gth
];

534 
	`memmove
(
VPS
, 
±r
, 
ÇlUn™L’gth
);

535 } ià(
Çl_un™_ty³
 == 33) {

536 
SPSSize
 = 
ÇlUn™L’gth
;

537 
d–‘e
[] 
SPS
; SPS = 
Ãw
 
u_št8_t
[
ÇlUn™L’gth
];

538 
	`memmove
(
SPS
, 
±r
, 
ÇlUn™L’gth
);

539 } ià(
Çl_un™_ty³
 == 34) {

540 
PPSSize
 = 
ÇlUn™L’gth
;

541 
d–‘e
[] 
PPS
; PPS = 
Ãw
 
u_št8_t
[
ÇlUn™L’gth
];

542 
	`memmove
(
PPS
, 
±r
, 
ÇlUn™L’gth
);

544 
±r
 +ğ
ÇlUn™L’gth
;

549 
numOfA¼ays
 = *
±r
++; 
CHECK_PTR
;

550 
j
 = 0; j < 
numOfA¼ays
; ++j) {

551 ++
±r
; 
CHECK_PTR
;

553 
numN®us
 = (*
±r
++)<<8; 
CHECK_PTR
;

554 
numN®us
 |ğ*
±r
++; 
CHECK_PTR
;

556 
i
 = 0; i < 
numN®us
; ++i) {

557 
ÇlUn™L’gth
 = (*
±r
++)<<8; 
CHECK_PTR
;

558 
ÇlUn™L’gth
 |ğ*
±r
++; 
CHECK_PTR
;

560 ià(
ÇlUn™L’gth
 > 
NUM_BYTES_REMAINING
) ;

561 
u_št8_t
 
Çl_un™_ty³
 = (
±r
[0]&0x7E)>>1;

562 ià(
Çl_un™_ty³
 == 32) {

563 
VPSSize
 = 
ÇlUn™L’gth
;

564 
d–‘e
[] 
VPS
; VPS = 
Ãw
 
u_št8_t
[
ÇlUn™L’gth
];

565 
	`memmove
(
VPS
, 
±r
, 
ÇlUn™L’gth
);

566 } ià(
Çl_un™_ty³
 == 33) {

567 
SPSSize
 = 
ÇlUn™L’gth
;

568 
d–‘e
[] 
SPS
; SPS = 
Ãw
 
u_št8_t
[
ÇlUn™L’gth
];

569 
	`memmove
(
SPS
, 
±r
, 
ÇlUn™L’gth
);

570 } ià(
Çl_un™_ty³
 == 34) {

571 
PPSSize
 = 
ÇlUn™L’gth
;

572 
d–‘e
[] 
PPS
; PPS = 
Ãw
 
u_št8_t
[
ÇlUn™L’gth
];

573 
	`memmove
(
PPS
, 
±r
, 
ÇlUn™L’gth
);

575 
±r
 +ğ
ÇlUn™L’gth
;

581 
»suÉ
 = 
H265VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

582 
VPS
, 
VPSSize
, 
SPS
, 
SPSSize
, 
PPS
, 
PPSSize
);

583 
d–‘e
[] 
VPS
; d–‘e[] 
SPS
; d–‘e[] 
PPS
;

584 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/VP8") == 0) {

585 
»suÉ
 = 
VP8VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

586 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/VP9") == 0) {

587 
»suÉ
 = 
VP9VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

588 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "text/T140") == 0) {

589 
»suÉ
 = 
T140TextRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

593  
»suÉ
;

594 
	}
}

596 
	gM©roskaFe
::
	$addT¿ck
(
M©roskaT¿ck
* 
ÃwT¿ck
, 
ŒackNumb”
) {

597 
fT¿ckTabË
->
	`add
(
ÃwT¿ck
, 
ŒackNumb”
);

598 
	}
}

600 
	gM©roskaFe
::
	$addCuePošt
(
cueTime
, 
u_št64_t
 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
) {

601 
BoŞ—n
 
dummy
 = 
F®£
;

602 
CuePošt
::
	`addCuePošt
(
fCuePošts
, 
cueTime
, 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
, 
dummy
);

603 
	}
}

605 
BoŞ—n
 
	gM©roskaFe
::
	$lookupCuePošt
(& 
cueTime
, 
u_št64_t
& 
»suÉClu¡”Off£tInFe
, & 
»suÉBlockNumW™hšClu¡”
) {

606 ià(
fCuePošts
 =ğ
NULL
è 
F®£
;

608 ()
fCuePošts
->
	`lookup
(
cueTime
, 
»suÉClu¡”Off£tInFe
, 
»suÉBlockNumW™hšClu¡”
);

609  
True
;

610 
	}
}

612 
	gM©roskaFe
::
	$´štCuePošts
(
FILE
* 
fid
) {

613 
CuePošt
::
	`årštf
(
fid
, 
fCuePošts
);

614 
	}
}

619 
	gM©roskaT¿ckTabË
::
	$M©roskaT¿ckTabË
()

620 : 
	`fTabË
(
HashTabË
::
	$ü—‹
(
ONE_WORD_HASH_KEYS
)) {

621 
	}
}

623 
M©roskaT¿ckTabË
::~
	$M©roskaT¿ckTabË
() {

625 
M©roskaT¿ck
* 
Œack
;

626 (
Œack
 = (
M©roskaT¿ck
*)
fTabË
->
	`RemoveNext
()è!ğ
NULL
) {

627 
d–‘e
 
Œack
;

629 
d–‘e
 
fTabË
;

630 
	}
}

632 
	gM©roskaT¿ckTabË
::
	$add
(
M©roskaT¿ck
* 
ÃwT¿ck
, 
ŒackNumb”
) {

633 ià(
ÃwT¿ck
 !ğ
NULL
 &&‚ewT¿ck->
ŒackNumb”
 !ğ0è
fTabË
->
	`Remove
((const*)newTrack->trackNumber);

634 
M©roskaT¿ck
* 
exi¡šgT¿ck
 = (M©roskaT¿ck*)
fTabË
->
	`Add
((cÚ¡*)
ŒackNumb”
, 
ÃwT¿ck
);

635 
d–‘e
 
exi¡šgT¿ck
;

636 
	}
}

638 
M©roskaT¿ck
* 
	gM©roskaT¿ckTabË
::
	$lookup
(
ŒackNumb”
) {

639  (
M©roskaT¿ck
*)
fTabË
->
	`Lookup
((cÚ¡*)
ŒackNumb”
);

640 
	}
}

642 
	gM©roskaT¿ckTabË
::
	$numT¿cks
(ècÚ¡ {  
fTabË
->
	`numEÁr›s
(); 
	}
}

644 
	gM©roskaT¿ckTabË
::
I‹¿tÜ
::
	$I‹¿tÜ
(
M©roskaT¿ckTabË
& 
ourTabË
) {

645 
fI‹r
 = 
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*(
ourTabË
.
fTabË
));

646 
	}
}

648 
	gM©roskaT¿ckTabË
::
I‹¿tÜ
::~
	$I‹¿tÜ
() {

649 
d–‘e
 
fI‹r
;

650 
	}
}

652 
M©roskaT¿ck
* 
	gM©roskaT¿ckTabË
::
I‹¿tÜ
::
	$Ãxt
() {

653 cÚ¡* 
key
;

654  (
M©roskaT¿ck
*)
fI‹r
->
	`Ãxt
(
key
);

655 
	}
}

660 
	gM©roskaT¿ck
::
	$M©roskaT¿ck
()

661 : 
	`ŒackNumb”
(0 ), 
	`ŒackTy³
(0 ),

662 
	`isEÇbËd
(
True
), 
	`isDeçuÉ
(True), 
	`isFÜûd
(
F®£
),

663 
	`deçuÉDu¿tiÚ
(0),

664 
	`Çme
(
NULL
), 
	`Ïnguage
(NULL), 
	`codecID
(NULL),

665 
	`§m¶šgF»qu’cy
(0), 
	`numChªÃls
(2), 
	`mimeTy³
(""),

666 
	`codecPriv©eSize
(0), 
	`codecPriv©e
(
NULL
),

667 
	`codecPriv©eU£sH264FÜm©FÜH265
(
F®£
), 
	`codecIsOpus
(False),

668 
	`h—d”SŒ³dBy‹sSize
(0), 
	`h—d”SŒ³dBy‹s
(
NULL
),

669 
	$subäameSizeSize
(0) {

670 
	}
}

672 
	gM©roskaT¿ck
::~
	$M©roskaT¿ck
() {

673 
d–‘e
[] 
Çme
; d–‘e[] 
Ïnguage
; d–‘e[] 
codecID
;

674 
d–‘e
[] 
codecPriv©e
;

675 
d–‘e
[] 
h—d”SŒ³dBy‹s
;

676 
	}
}

681 
	gM©roskaDemux
::
	$M©roskaDemux
(
M©roskaFe
& 
ourFe
)

682 : 
	`Medium
(
ourFe
.
	`’vœ
()),

683 
	`fOurFe
(
ourFe
), 
	`fDemuxedT¿cksTabË
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)),

684 
	$fNextT¿ckTy³ToCheck
(0x1) {

685 
fOurP¬£r
 = 
Ãw
 
	`M©roskaFeP¬£r
(
ourFe
, 
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), ourFe.
	`feName
()),

686 
hªdËEndOfFe
, 
this
,his);

687 
	}
}

689 
	gM©roskaDemux
::~
	$M©roskaDemux
() {

691 
	`hªdËEndOfFe
();

695 
d–‘e
 
fDemuxedT¿cksTabË
;

697 
d–‘e
 
fOurP¬£r
;

698 
fOurFe
.
	`»moveDemux
(
this
);

699 
	}
}

701 
F¿medSourû
* 
	gM©roskaDemux
::
	$ÃwDemuxedT¿ck
() {

702 
dummyResuÉT¿ckNumb”
;

703  
	`ÃwDemuxedT¿ck
(
dummyResuÉT¿ckNumb”
);

704 
	}
}

706 
F¿medSourû
* 
	gM©roskaDemux
::
	$ÃwDemuxedT¿ck
(& 
»suÉT¿ckNumb”
) {

707 
F¿medSourû
* 
»suÉ
;

708 
»suÉT¿ckNumb”
 = 0;

710 
»suÉ
 = 
NULL
;„esuÉ =ğNULL && 
fNextT¿ckTy³ToCheck
 !ğ
MATROSKA_TRACK_TYPE_OTHER
;

711 
fNextT¿ckTy³ToCheck
 <<= 1) {

712 ià(
fNextT¿ckTy³ToCheck
 =ğ
MATROSKA_TRACK_TYPE_VIDEO
è
»suÉT¿ckNumb”
 = 
fOurFe
.
	`cho£nVideoT¿ckNumb”
();

713 ià(
fNextT¿ckTy³ToCheck
 =ğ
MATROSKA_TRACK_TYPE_AUDIO
è
»suÉT¿ckNumb”
 = 
fOurFe
.
	`cho£nAudioT¿ckNumb”
();

714 ià(
fNextT¿ckTy³ToCheck
 =ğ
MATROSKA_TRACK_TYPE_SUBTITLE
è
»suÉT¿ckNumb”
 = 
fOurFe
.
	`cho£nSubt™ËT¿ckNumb”
();

716 
»suÉ
 = 
	`ÃwDemuxedT¿ckByT¿ckNumb”
(
»suÉT¿ckNumb”
);

719  
»suÉ
;

720 
	}
}

722 
F¿medSourû
* 
	gM©roskaDemux
::
	$ÃwDemuxedT¿ckByT¿ckNumb”
(
ŒackNumb”
) {

723 ià(
ŒackNumb”
 =ğ0è 
NULL
;

725 
F¿medSourû
* 
ŒackSourû
 = 
Ãw
 
	`M©roskaDemuxedT¿ck
(
	`’vœ
(), 
ŒackNumb”
, *
this
);

726 
fDemuxedT¿cksTabË
->
	`Add
((cÚ¡*)
ŒackNumb”
, 
ŒackSourû
);

727  
ŒackSourû
;

728 
	}
}

730 
M©roskaDemuxedT¿ck
* 
	gM©roskaDemux
::
	$lookupDemuxedT¿ck
(
ŒackNumb”
) {

731  (
M©roskaDemuxedT¿ck
*)
fDemuxedT¿cksTabË
->
	`Lookup
((cÚ¡*)
ŒackNumb”
);

732 
	}
}

734 
	gM©roskaDemux
::
	$»moveT¿ck
(
ŒackNumb”
) {

735 
fDemuxedT¿cksTabË
->
	`Remove
((cÚ¡*)
ŒackNumb”
);

736 ià(
fDemuxedT¿cksTabË
->
	`numEÁr›s
() == 0) {

738 
Medium
::
	`şo£
(
this
);

740 
	}
}

742 
	gM©roskaDemux
::
	$cÚtšueR—dšg
() {

743 
fOurP¬£r
->
	`cÚtšueP¬sšg
();

744 
	}
}

746 
	gM©roskaDemux
::
	$£ekToTime
(& 
£ekNPT
) {

747 ià(
fOurP¬£r
 !ğ
NULL
èfOurP¬£r->
	`£ekToTime
(
£ekNPT
);

748 
	}
}

750 
	gM©roskaDemux
::
	$hªdËEndOfFe
(* 
ş›ÁD©a
) {

751 ((
M©roskaDemux
*)
ş›ÁD©a
)->
	`hªdËEndOfFe
();

752 
	}
}

754 
	gM©roskaDemux
::
	$hªdËEndOfFe
() {

758 
numT¿cks
 = 
fDemuxedT¿cksTabË
->
	`numEÁr›s
();

759 ià(
numT¿cks
 == 0) ;

760 
M©roskaDemuxedT¿ck
** 
Œacks
 = 
Ãw
 M©roskaDemuxedT¿ck*[
numT¿cks
];

762 
HashTabË
::
I‹¿tÜ
* 
™”
 = HashTabË::I‹¿tÜ::
	`ü—‹
(*
fDemuxedT¿cksTabË
);

763 
i
;

764 cÚ¡* 
ŒackNumb”
;

766 
i
 = 0; i < 
numT¿cks
; ++i) {

767 
Œacks
[
i
] = (
M©roskaDemuxedT¿ck
*)
™”
->
	`Ãxt
(
ŒackNumb”
);

769 
d–‘e
 
™”
;

771 
i
 = 0; i < 
numT¿cks
; ++i) {

772 ià(
Œacks
[
i
] =ğ
NULL
) ;

773 
Œacks
[
i
]->
	`hªdËClosu»
();

776 
d–‘e
[] 
Œacks
;

777 
	}
}

782 
	gCuePošt
::
	$CuePošt
(
cueTime
, 
u_št64_t
 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
)

783 : 
	`fB®ªû
(0),

784 
	`fCueTime
(
cueTime
), 
	`fClu¡”Off£tInFe
(
şu¡”Off£tInFe
), 
	`fBlockNumW™hšClu¡”
(
blockNumW™hšClu¡”
 - 1) {

785 
fSubT»e
[0] = fSubT»e[1] = 
NULL
;

786 
	}
}

788 
	gCuePošt
::~
	$CuePošt
() {

789 
d–‘e
 
fSubT»e
[0]; delete fSubTree[1];

790 
	}
}

792 
	gCuePošt
::
	$addCuePošt
(
CuePošt
*& 
roÙ
, 
cueTime
, 
u_št64_t
 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
,

793 
BoŞ—n
& 
ÃedToRevi£B®ªûOfP¬’t
) {

794 
ÃedToRevi£B®ªûOfP¬’t
 = 
F®£
;

796 ià(
roÙ
 =ğ
NULL
) {

797 
roÙ
 = 
Ãw
 
	`CuePošt
(
cueTime
, 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
);

798 
ÃedToRevi£B®ªûOfP¬’t
 = 
True
;

799 } ià(
cueTime
 =ğ
roÙ
->
fCueTime
) {

801 
roÙ
->
fClu¡”Off£tInFe
 = 
şu¡”Off£tInFe
;

802 
roÙ
->
fBlockNumW™hšClu¡”
 = 
blockNumW™hšClu¡”
 - 1;

805 
dœeùiÚ
 = 
cueTime
 > 
roÙ
->
fCueTime
;

806 
BoŞ—n
 
ÃedToRevi£OurB®ªû
 = 
F®£
;

807 
	`addCuePošt
(
roÙ
->
fSubT»e
[
dœeùiÚ
], 
cueTime
, 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
, 
ÃedToRevi£OurB®ªû
);

809 ià(
ÃedToRevi£OurB®ªû
) {

811 ià(
roÙ
->
fB®ªû
 == 0) {

813 
roÙ
->
fB®ªû
 = -1 + 2*
dœeùiÚ
;

814 
ÃedToRevi£B®ªûOfP¬’t
 = 
True
;

815 } ià(
roÙ
->
fB®ªû
 =ğ1 - 2*
dœeùiÚ
) {

817 
roÙ
->
fB®ªû
 = 0;

820 ià(
roÙ
->
fSubT»e
[
dœeùiÚ
]->
fB®ªû
 == -1 + 2*direction) {

822 
roÙ
->
fB®ªû
 =„oÙ->
fSubT»e
[
dœeùiÚ
]->fBalance = 0;

823 
	`rÙ©e
(1-
dœeùiÚ
, 
roÙ
);

826 
ÃwP¬’tCurB®ªû
 = 
roÙ
->
fSubT»e
[
dœeùiÚ
]->fSubT»e[1-dœeùiÚ]->
fB®ªû
;

827 ià(
ÃwP¬’tCurB®ªû
 =ğ1 - 2*
dœeùiÚ
) {

828 
roÙ
->
fB®ªû
 = 0;

829 
roÙ
->
fSubT»e
[
dœeùiÚ
]->
fB®ªû
 = -1 + 2*direction;

830 } ià(
ÃwP¬’tCurB®ªû
 == 0) {

831 
roÙ
->
fB®ªû
 = 0;

832 
roÙ
->
fSubT»e
[
dœeùiÚ
]->
fB®ªû
 = 0;

834 
roÙ
->
fB®ªû
 = 1 - 2*
dœeùiÚ
;

835 
roÙ
->
fSubT»e
[
dœeùiÚ
]->
fB®ªû
 = 0;

837 
	`rÙ©e
(
dœeùiÚ
, 
roÙ
->
fSubT»e
[direction]);

839 
roÙ
->
fSubT»e
[
dœeùiÚ
]->
fB®ªû
 = 0;

840 
	`rÙ©e
(1-
dœeùiÚ
, 
roÙ
);

845 
	}
}

847 
BoŞ—n
 
	gCuePošt
::
	$lookup
(& 
cueTime
, 
u_št64_t
& 
»suÉClu¡”Off£tInFe
, & 
»suÉBlockNumW™hšClu¡”
) {

848 ià(
cueTime
 < 
fCueTime
) {

849 ià(
	`Ëá
(è=ğ
NULL
) {

850 
»suÉClu¡”Off£tInFe
 = 0;

851 
»suÉBlockNumW™hšClu¡”
 = 0;

852  
F®£
;

854  
	`Ëá
()->
	`lookup
(
cueTime
, 
»suÉClu¡”Off£tInFe
, 
»suÉBlockNumW™hšClu¡”
);

857 ià(
	`right
(è=ğ
NULL
 || !right()->
	`lookup
(
cueTime
, 
»suÉClu¡”Off£tInFe
, 
»suÉBlockNumW™hšClu¡”
)) {

859 
cueTime
 = 
fCueTime
;

860 
»suÉClu¡”Off£tInFe
 = 
fClu¡”Off£tInFe
;

861 
»suÉBlockNumW™hšClu¡”
 = 
fBlockNumW™hšClu¡”
;

863  
True
;

865 
	}
}

867 
	gCuePošt
::
	$årštf
(
FILE
* 
fid
, 
CuePošt
* 
cuePošt
) {

868 ià(
cuePošt
 !ğ
NULL
) {

869 ::
	`årštf
(
fid
, "[");

870 
	`årštf
(
fid
, 
cuePošt
->
	`Ëá
());

872 ::
	`årštf
(
fid
, ",%.1f{%d},", 
cuePošt
->
fCueTime
, cuePošt->
fB®ªû
);

874 
	`årštf
(
fid
, 
cuePošt
->
	`right
());

875 ::
	`årštf
(
fid
, "]");

877 
	}
}

879 
	gCuePošt
::
	$rÙ©e
(
dœeùiÚ
 , 
CuePošt
*& 
roÙ
) {

880 
CuePošt
* 
pivÙ
 = 
roÙ
->
fSubT»e
[1-
dœeùiÚ
];

881 
roÙ
->
fSubT»e
[1-
dœeùiÚ
] = 
pivÙ
->fSubTree[direction];

882 
pivÙ
->
fSubT»e
[
dœeùiÚ
] = 
roÙ
;

883 
roÙ
 = 
pivÙ
;

884 
	}
}

	@liveMedia/MatroskaFileParser.cpp

21 
	~"M©roskaFeP¬£r.hh
"

22 
	~"M©roskaDemuxedT¿ck.hh
"

23 
	~<By‹SŒ—mFeSourû.hh
>

24 
	~<GroupsockH–³r.hh
>

26 
	gM©roskaFeP¬£r
::
M©roskaFeP¬£r
(
M©roskaFe
& 
ourFe
, 
F¿medSourû
* 
šputSourû
,

27 
F¿medSourû
::
ÚClo£Func
* 
ÚEndFunc
, * 
ÚEndCl›ÁD©a
,

28 
M©roskaDemux
* 
ourDemux
)

29 : 
SŒ—mP¬£r
(
šputSourû
, 
ÚEndFunc
, 
ÚEndCl›ÁD©a
, 
cÚtšueP¬sšg
, 
this
),

30 
fOurFe
(
ourFe
), 
fIÅutSourû
(
šputSourû
),

31 
fOnEndFunc
(
ÚEndFunc
), 
fOnEndCl›ÁD©a
(
ÚEndCl›ÁD©a
),

32 
fOurDemux
(
ourDemux
),

33 
fCurOff£tInFe
(0), 
fSavedCurOff£tInFe
(0), 
fLim™Off£tInFe
(0),

34 
fNumH—d”By‹sToSk
(0), 
fClu¡”Timecode
(0), 
fBlockTimecode
(0),

35 
fF¿meSizesW™hšBlock
(
NULL
),

36 
	$fP»£Á©iÚTimeOff£t
(0.0) {

37 ià(
ourDemux
 =ğ
NULL
) {

39 
fCu¼’tP¬£S‹
 = 
PARSING_START_OF_FILE
;

40 
	`cÚtšueP¬sšg
();

42 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_CLUSTER
;

45 
	}
}

47 
	gM©roskaFeP¬£r
::~
	$M©roskaFeP¬£r
() {

48 
d–‘e
[] 
fF¿meSizesW™hšBlock
;

49 
Medium
::
	`şo£
(
fIÅutSourû
);

50 
	}
}

52 
	gM©roskaFeP¬£r
::
	$£ekToTime
(& 
£ekNPT
) {

53 #ifdeà
DEBUG


54 
	`årštf
(
¡d”r
, "£ekToTime(%f)\n", 
£ekNPT
);

56 ià(
£ekNPT
 <= 0.0) {

57 #ifdeà
DEBUG


58 
	`årštf
(
¡d”r
, "\t=> start of file\n");

60 
£ekNPT
 = 0.0;

61 
	`£ekToFePos™iÚ
(0);

62 } ià(
£ekNPT
 >ğ
fOurFe
.
	`feDu¿tiÚ
()) {

63 #ifdeà
DEBUG


64 
	`årštf
(
¡d”r
, "\t=>ƒnd of file\n");

66 
£ekNPT
 = 
fOurFe
.
	`feDu¿tiÚ
();

67 
	`£ekToEndOfFe
();

69 
u_št64_t
 
şu¡”Off£tInFe
;

70 
blockNumW™hšClu¡”
;

71 ià(!
fOurFe
.
	`lookupCuePošt
(
£ekNPT
, 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
)) {

72 #ifdeà
DEBUG


73 
	`årštf
(
¡d”r
, "\t=>‚ot supported\n");

78 #ifdeà
DEBUG


79 
	`årštf
(
¡d”r
, "\t=> s“kim%f, fpos™iÚ %Îu, block‚umb” w™hš clu¡” %d\n", 
£ekNPT
, 
şu¡”Off£tInFe
, 
blockNumW™hšClu¡”
);

81 
	`£ekToFePos™iÚ
(
şu¡”Off£tInFe
);

82 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

85 
	}
}

87 
	gM©roskaFeP¬£r


88 ::
	$cÚtšueP¬sšg
(* 
ş›ÁD©a
, * , , 
timev®
 ) {

89 ((
M©roskaFeP¬£r
*)
ş›ÁD©a
)->
	`cÚtšueP¬sšg
();

90 
	}
}

92 
	gM©roskaFeP¬£r
::
	$cÚtšueP¬sšg
() {

93 ià(
fIÅutSourû
 !ğ
NULL
) {

94 ià(
fIÅutSourû
->
	`isCu¼’yAwa™šgD©a
()) ;

96 ià(!
	`·r£
()) {

104 ià(
fOnEndFunc
 !ğ
NULL
è(*fOnEndFunc)(
fOnEndCl›ÁD©a
);

105 
	}
}

107 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£
() {

108 
BoŞ—n
 
¬eDÚe
 = 
F®£
;

110 
Œy
 {

111 
	`skRemaššgH—d”By‹s
(
True
);

113 
fCu¼’tP¬£S‹
) {

114 
PARSING_START_OF_FILE
: {

115 
¬eDÚe
 = 
	`·r£S¹OfFe
();

118 
LOOKING_FOR_TRACKS
: {

119 
	`lookFÜNextT¿ck
();

122 
PARSING_TRACK
: {

123 
¬eDÚe
 = 
	`·r£T¿ck
();

124 ià(
¬eDÚe
 && 
fOurFe
.
fCuesOff£t
 > 0) {

127 #ifdeà
DEBUG


128 
	`årštf
(
¡d”r
, "S“kšgØfpos™iÚ %Îu (th´eviou¦y-»pÜ‹d†oÿtiÚ oà'Cues')\n", 
fOurFe
.
fCuesOff£t
);

130 
	`£ekToFePos™iÚ
(
fOurFe
.
fCuesOff£t
);

131 
fCu¼’tP¬£S‹
 = 
PARSING_CUES
;

132 
¬eDÚe
 = 
F®£
;

136 
PARSING_CUES
: {

137 
¬eDÚe
 = 
	`·r£Cues
();

140 
LOOKING_FOR_CLUSTER
: {

141 ià(
fOurFe
.
fClu¡”Off£t
 > 0) {

143 #ifdeà
DEBUG


144 
	`årštf
(
¡d”r
, "O±imiz©iÚ: S“kšgØfpos™iÚ %Îu (th´eviou¦y-»pÜ‹d†oÿtiÚ oà¨'Clu¡”')\n", 
fOurFe
.
fClu¡”Off£t
);

146 
	`£ekToFePos™iÚ
(
fOurFe
.
fClu¡”Off£t
);

148 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

151 
LOOKING_FOR_BLOCK
: {

152 
	`lookFÜNextBlock
();

155 
PARSING_BLOCK
: {

156 
	`·r£Block
();

159 
DELIVERING_FRAME_WITHIN_BLOCK
: {

160 ià(!
	`d–iv”F¿meW™hšBlock
()è 
F®£
;

163 
DELIVERING_FRAME_BYTES
: {

164 
	`d–iv”F¿meBy‹s
();

165  
F®£
;

169 } !
¬eDÚe
);

171  
True
;

172 } 
	`ÿtch
 () {

173 #ifdeà
DEBUG


174 
	`årštf
(
¡d”r
, "MatroskaFileParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

176  
F®£
;

178 
	}
}

180 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£S¹OfFe
() {

181 #ifdeà
DEBUG


182 
	`årštf
(
¡d”r
, "parsing start of file\n");

184 
EBMLId
 
id
;

185 
EBMLD©aSize
 
size
;

188 ià(!
	`·r£EBMLIdAndSize
(
id
, 
size
è|| id !ğ
MATROSKA_ID_EBML
) {

189 
fOurFe
.
	`’vœ
() << "ERROR: File does‚ot begin with‡n EBML header\n";

190  
True
;

192 #ifdeà
DEBUG


193 
	`årštf
(
¡d”r
, "M©roskaFeP¬£r::·r£S¹OfFe(): P¬£d id 0x% (%s), size: %Îd\n", 
id
.
	`hexSŒšg
(), id.
	`¡ršgName
(), 
size
.
	`v®
());

196 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_TRACKS
;

197 
	`skH—d”
(
size
);

199  
F®£
;

200 
	}
}

202 
	gM©roskaFeP¬£r
::
	$lookFÜNextT¿ck
() {

203 #ifdeà
DEBUG


204 
	`årštf
(
¡d”r
, "looking for Track\n");

206 
EBMLId
 
id
;

207 
EBMLD©aSize
 
size
;

210 
fCu¼’tP¬£S‹
 =ğ
LOOKING_FOR_TRACKS
) {

211 !
	`·r£EBMLIdAndSize
(
id
, 
size
)) {}

212 #ifdeà
DEBUG


213 
	`årštf
(
¡d”r
, "M©roskaFeP¬£r::lookFÜNextT¿ck(): P¬£d id 0x% (%s), size: %Îd\n", 
id
.
	`hexSŒšg
(), id.
	`¡ršgName
(), 
size
.
	`v®
());

215 
id
.
	`v®
()) {

216 
MATROSKA_ID_SEGMENT
: {

218 
fOurFe
.
fSegm’tD©aOff£t
 = 
fCurOff£tInFe
;

221 
MATROSKA_ID_SEEK_HEAD
: {

224 
MATROSKA_ID_SEEK
: {

227 
MATROSKA_ID_SEEK_ID
: {

228 ià(
	`·r£EBMLNumb”
(
fLa¡S“kId
)) {

229 #ifdeà
DEBUG


230 
	`årštf
(
¡d”r
, "\tS“k ID 0x%s:\t%s\n", 
fLa¡S“kId
.
	`hexSŒšg
(), fLa¡S“kId.
	`¡ršgName
());

235 
MATROSKA_ID_SEEK_POSITION
: {

236 
u_št64_t
 
£ekPos™iÚ
;

237 ià(
	`·r£EBMLV®_unsigÃd64
(
size
, 
£ekPos™iÚ
)) {

238 
u_št64_t
 
off£tInFe
 = 
fOurFe
.
fSegm’tD©aOff£t
 + 
£ekPos™iÚ
;

239 #ifdeà
DEBUG


240 
	`årštf
(
¡d”r
, "\tS“k Pos™iÚ %Îu (=> off£ˆw™hšhfe: %Îu (0x%Îx))\n", 
£ekPos™iÚ
, 
off£tInFe
, offsetInFile);

243 ià(
fLa¡S“kId
 =ğ
MATROSKA_ID_CLUSTER
) {

244 
fOurFe
.
fClu¡”Off£t
 = 
off£tInFe
;

245 } ià(
fLa¡S“kId
 =ğ
MATROSKA_ID_CUES
) {

246 
fOurFe
.
fCuesOff£t
 = 
off£tInFe
;

251 
MATROSKA_ID_INFO
: {

254 
MATROSKA_ID_TIMECODE_SCALE
: {

255 
timecodeSÿË
;

256 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
timecodeSÿË
) &&imecodeScale > 0) {

257 
fOurFe
.
fTimecodeSÿË
 = 
timecodeSÿË
;

258 #ifdeà
DEBUG


259 
	`årštf
(
¡d”r
, "\tTimecode Scale %u‚s (=> Segment Duration == %f seconds)\n",

260 
fOurFe
.
	`timecodeSÿË
(), fOurFe.
	`£gm’tDu¿tiÚ
()*(fOurFe.
fTimecodeSÿË
/1000000000.0f));

265 
MATROSKA_ID_DURATION
: {

266 ià(
	`·r£EBMLV®_æßt
(
size
, 
fOurFe
.
fSegm’tDu¿tiÚ
)) {

267 #ifdeà
DEBUG


268 
	`årštf
(
¡d”r
, "\tSegment Duration %f (== %f seconds)\n",

269 
fOurFe
.
	`£gm’tDu¿tiÚ
(), fOurFe.£gm’tDu¿tiÚ()*(fOurFe.
fTimecodeSÿË
/1000000000.0f));

274 #ifdeà
DEBUG


275 
MATROSKA_ID_TITLE
: {

276 * 
t™Ë
;

277 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
t™Ë
)) {

278 #ifdeà
DEBUG


279 
	`årštf
(
¡d”r
, "\tT™Ë: %s\n", 
t™Ë
);

281 
d–‘e
[] 
t™Ë
;

286 
MATROSKA_ID_TRACKS
: {

287 
fLim™Off£tInFe
 = 
fCurOff£tInFe
 + 
size
.
	`v®
();

288 
fCu¼’tP¬£S‹
 = 
PARSING_TRACK
;

292 
	`skH—d”
(
size
);

296 
	`£tP¬£S‹
();

298 
	}
}

300 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£T¿ck
() {

301 #ifdeà
DEBUG


302 
	`årštf
(
¡d”r
, "parsing Track\n");

305 
M©roskaT¿ck
* 
Œack
 = 
NULL
;

306 
EBMLId
 
id
;

307 
EBMLD©aSize
 
size
;

308 
fCurOff£tInFe
 < 
fLim™Off£tInFe
) {

309 !
	`·r£EBMLIdAndSize
(
id
, 
size
)) {}

310 #ifdeà
DEBUG


311 ià(
id
 =ğ
MATROSKA_ID_TRACK_ENTRY
è
	`årštf
(
¡d”r
, "\n");

312 
	`årštf
(
¡d”r
, "M©roskaFeP¬£r::·r£T¿ck(): P¬£d id 0x% (%s), size: %Îd\n", 
id
.
	`hexSŒšg
(), id.
	`¡ršgName
(), 
size
.
	`v®
());

314 
id
.
	`v®
()) {

315 
MATROSKA_ID_TRACK_ENTRY
: {

317 ià(
Œack
 !ğ
NULL
 &&¿ck->
ŒackNumb”
 =ğ0è
d–‘e
rack;

318 
Œack
 = 
Ãw
 
M©roskaT¿ck
;

321 
MATROSKA_ID_TRACK_NUMBER
: {

322 
ŒackNumb”
;

323 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
ŒackNumb”
)) {

324 #ifdeà
DEBUG


325 
	`årštf
(
¡d”r
, "\tT¿ck Numb” %d\n", 
ŒackNumb”
);

327 ià(
Œack
 !ğ
NULL
 && 
ŒackNumb”
 != 0) {

328 
Œack
->
ŒackNumb”
 =rackNumber;

329 
fOurFe
.
	`addT¿ck
(
Œack
, 
ŒackNumb”
);

334 
MATROSKA_ID_TRACK_TYPE
: {

335 
ŒackTy³
;

336 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
ŒackTy³
è&& 
Œack
 !ğ
NULL
) {

338 
Œack
->
ŒackTy³


339 ğ
ŒackTy³
 =ğ1 ? 
MATROSKA_TRACK_TYPE_VIDEO
 :¿ckTy³ =ğ2 ? 
MATROSKA_TRACK_TYPE_AUDIO


340 : 
ŒackTy³
 =ğ0x11 ? 
MATROSKA_TRACK_TYPE_SUBTITLE
 : 
MATROSKA_TRACK_TYPE_OTHER
;

341 #ifdeà
DEBUG


342 
	`årštf
(
¡d”r
, "\tT¿ck Ty³ 0x%02x (%s)\n", 
ŒackTy³
,

343 
Œack
->
ŒackTy³
 =ğ
MATROSKA_TRACK_TYPE_VIDEO
 ? "video" :

344 
Œack
->
ŒackTy³
 =ğ
MATROSKA_TRACK_TYPE_AUDIO
 ? "audio" :

345 
Œack
->
ŒackTy³
 =ğ
MATROSKA_TRACK_TYPE_SUBTITLE
 ? "subtitle" :

351 
MATROSKA_ID_FLAG_ENABLED
: {

352 
æagEÇbËd
;

353 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
æagEÇbËd
)) {

354 #ifdeà
DEBUG


355 
	`årštf
(
¡d”r
, "\tT¿ck i EÇbËd: %d\n", 
æagEÇbËd
);

357 ià(
Œack
 !ğ
NULL
èŒack->
isEÇbËd
 = 
æagEÇbËd
 != 0;

361 
MATROSKA_ID_FLAG_DEFAULT
: {

362 
æagDeçuÉ
;

363 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
æagDeçuÉ
)) {

364 #ifdeà
DEBUG


365 
	`årštf
(
¡d”r
, "\tT¿ck i DeçuÉ: %d\n", 
æagDeçuÉ
);

367 ià(
Œack
 !ğ
NULL
èŒack->
isDeçuÉ
 = 
æagDeçuÉ
 != 0;

371 
MATROSKA_ID_FLAG_FORCED
: {

372 
æagFÜûd
;

373 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
æagFÜûd
)) {

374 #ifdeà
DEBUG


375 
	`årštf
(
¡d”r
, "\tT¿ck i FÜûd: %d\n", 
æagFÜûd
);

377 ià(
Œack
 !ğ
NULL
èŒack->
isFÜûd
 = 
æagFÜûd
 != 0;

381 
MATROSKA_ID_DEFAULT_DURATION
: {

382 
deçuÉDu¿tiÚ
;

383 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
deçuÉDu¿tiÚ
)) {

384 #ifdeà
DEBUG


385 
	`årštf
(
¡d”r
, "\tDeçuÉ du¿tiÚ %àms\n", 
deçuÉDu¿tiÚ
/1000000.0);

387 ià(
Œack
 !ğ
NULL
èŒack->
deçuÉDu¿tiÚ
 = defaultDuration;

391 
MATROSKA_ID_MAX_BLOCK_ADDITION_ID
: {

392 
maxBlockAdd™iÚID
;

393 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
maxBlockAdd™iÚID
)) {

394 #ifdeà
DEBUG


395 
	`årštf
(
¡d”r
, "\tMax Block Add™iÚ ID: %u\n", 
maxBlockAdd™iÚID
);

400 
MATROSKA_ID_NAME
: {

401 * 
Çme
;

402 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
Çme
)) {

403 #ifdeà
DEBUG


404 
	`årštf
(
¡d”r
, "\tName: %s\n", 
Çme
);

406 ià(
Œack
 !ğ
NULL
) {

407 
d–‘e
[] 
Œack
->
Çme
;rack->name =‚ame;

409 
d–‘e
[] 
Çme
;

414 
MATROSKA_ID_LANGUAGE
: {

415 * 
Ïnguage
;

416 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
Ïnguage
)) {

417 #ifdeà
DEBUG


418 
	`årštf
(
¡d”r
, "\tLªguage: %s\n", 
Ïnguage
);

420 ià(
Œack
 !ğ
NULL
) {

421 
d–‘e
[] 
Œack
->
Ïnguage
;rack->language =†anguage;

423 
d–‘e
[] 
Ïnguage
;

428 
MATROSKA_ID_CODEC
: {

429 * 
codecID
;

430 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
codecID
)) {

431 #ifdeà
DEBUG


432 
	`årštf
(
¡d”r
, "\tCodeøID: %s\n", 
codecID
);

434 ià(
Œack
 !ğ
NULL
) {

435 
d–‘e
[] 
Œack
->
codecID
;rack->codecID = codecID;

438 ià(
	`¡ºcmp
(
codecID
, "A_MPEG", 6) == 0) {

439 
Œack
->
mimeTy³
 = "audio/MPEG";

440 } ià(
	`¡ºcmp
(
codecID
, "A_AAC", 5) == 0) {

441 
Œack
->
mimeTy³
 = "audio/AAC";

442 } ià(
	`¡ºcmp
(
codecID
, "A_AC3", 5) == 0) {

443 
Œack
->
mimeTy³
 = "audio/AC3";

444 } ià(
	`¡ºcmp
(
codecID
, "A_VORBIS", 8) == 0) {

445 
Œack
->
mimeTy³
 = "audio/VORBIS";

446 } ià(
	`¡rcmp
(
codecID
, "A_OPUS") == 0) {

447 
Œack
->
mimeTy³
 = "audio/OPUS";

448 
Œack
->
codecIsOpus
 = 
True
;

449 } ià(
	`¡rcmp
(
codecID
, "V_MPEG4/ISO/AVC") == 0) {

450 
Œack
->
mimeTy³
 = "video/H264";

451 } ià(
	`¡rcmp
(
codecID
, "V_MPEGH/ISO/HEVC") == 0) {

452 
Œack
->
mimeTy³
 = "video/H265";

453 } ià(
	`¡ºcmp
(
codecID
, "V_VP8", 5) == 0) {

454 
Œack
->
mimeTy³
 = "video/VP8";

455 } ià(
	`¡ºcmp
(
codecID
, "V_VP9", 5) == 0) {

456 
Œack
->
mimeTy³
 = "video/VP9";

457 } ià(
	`¡ºcmp
(
codecID
, "V_THEORA", 8) == 0) {

458 
Œack
->
mimeTy³
 = "video/THEORA";

459 } ià(
	`¡ºcmp
(
codecID
, "S_TEXT", 6) == 0) {

460 
Œack
->
mimeTy³
 = "text/T140";

463 
d–‘e
[] 
codecID
;

468 
MATROSKA_ID_CODEC_PRIVATE
: {

469 
u_št8_t
* 
codecPriv©e
;

470 
codecPriv©eSize
;

471 ià(
	`·r£EBMLV®_bš¬y
(
size
, 
codecPriv©e
)) {

472 
codecPriv©eSize
 = ()
size
.
	`v®
();

473 #ifdeà
DEBUG


474 
	`årštf
(
¡d”r
, "\tCodec Private: ");

475 
i
 = 0; i < 
codecPriv©eSize
; ++iè
	`årštf
(
¡d”r
, "%02x:", 
codecPriv©e
[i]);

476 
	`årštf
(
¡d”r
, "\n");

478 ià(
Œack
 !ğ
NULL
) {

479 
d–‘e
[] 
Œack
->
codecPriv©e
;rack->codecPrivate = codecPrivate;

480 
Œack
->
codecPriv©eSize
 = codecPrivateSize;

484 ià(
Œack
->
codecID
 !ğ
NULL
) {

485 ià(
	`¡rcmp
(
Œack
->
codecID
, "V_MPEG4/ISO/AVC") == 0) {

487 ià(
codecPriv©eSize
 >ğ5è
Œack
->
subäameSizeSize
 = (
codecPriv©e
[4]&0x3) + 1;

488 } ià(
	`¡rcmp
(
Œack
->
codecID
, "V_MPEGH/ISO/HEVC") == 0) {

494 ià(
codecPriv©eSize
 < 23 || (
codecPriv©e
[13]&0xF0) != 0xF0 ||

495 (
codecPriv©e
[15]&0xFC) != 0xFC || (codecPrivate[16]&0xFC) != 0xFC ||

496 (
codecPriv©e
[17]&0xF8) != 0xF8 || (codecPrivate[18]&0xF8) != 0xF8) {

498 
Œack
->
codecPriv©eU£sH264FÜm©FÜH265
 = 
True
;

501 ià(
codecPriv©eSize
 >ğ5è
Œack
->
subäameSizeSize
 = (
codecPriv©e
[4]&0x3) + 1;

504 
Œack
->
codecPriv©eU£sH264FÜm©FÜH265
 = 
F®£
;

507 
Œack
->
subäameSizeSize
 = (
codecPriv©e
[21]&0x3) + 1;

512 
d–‘e
[] 
codecPriv©e
;

517 
MATROSKA_ID_VIDEO
: {

520 
MATROSKA_ID_PIXEL_WIDTH
: {

521 
pix–Width
;

522 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
pix–Width
)) {

523 #ifdeà
DEBUG


524 
	`årštf
(
¡d”r
, "\tPix– Width %d\n", 
pix–Width
);

529 
MATROSKA_ID_PIXEL_HEIGHT
: {

530 
pix–Height
;

531 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
pix–Height
)) {

532 #ifdeà
DEBUG


533 
	`årštf
(
¡d”r
, "\tPix– Heighˆ%d\n", 
pix–Height
);

538 
MATROSKA_ID_DISPLAY_WIDTH
: {

539 
di¥ÏyWidth
;

540 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
di¥ÏyWidth
)) {

541 #ifdeà
DEBUG


542 
	`årštf
(
¡d”r
, "\tDi¥Ïy Width %d\n", 
di¥ÏyWidth
);

547 
MATROSKA_ID_DISPLAY_HEIGHT
: {

548 
di¥ÏyHeight
;

549 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
di¥ÏyHeight
)) {

550 #ifdeà
DEBUG


551 
	`årštf
(
¡d”r
, "\tDi¥Ïy Heighˆ%d\n", 
di¥ÏyHeight
);

556 
MATROSKA_ID_DISPLAY_UNIT
: {

557 
di¥ÏyUn™
;

558 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
di¥ÏyUn™
)) {

559 #ifdeà
DEBUG


560 
	`årštf
(
¡d”r
, "\tDi¥Ïy Un™ %d\n", 
di¥ÏyUn™
);

565 
MATROSKA_ID_AUDIO
: {

568 
MATROSKA_ID_SAMPLING_FREQUENCY
: {

569 
§m¶šgF»qu’cy
;

570 ià(
	`·r£EBMLV®_æßt
(
size
, 
§m¶šgF»qu’cy
)) {

571 ià(
Œack
 !ğ
NULL
) {

572 
Œack
->
§m¶šgF»qu’cy
 = ()samplingFrequency;

573 #ifdeà
DEBUG


574 
	`årštf
(
¡d”r
, "\tSam¶šg f»qu’cy %à(->%d)\n", 
§m¶šgF»qu’cy
, 
Œack
->samplingFrequency);

580 
MATROSKA_ID_OUTPUT_SAMPLING_FREQUENCY
: {

581 
ouutSam¶šgF»qu’cy
;

582 ià(
	`·r£EBMLV®_æßt
(
size
, 
ouutSam¶šgF»qu’cy
)) {

583 #ifdeà
DEBUG


584 
	`årštf
(
¡d”r
, "\tOuuˆ§m¶šg f»qu’cy %f\n", 
ouutSam¶šgF»qu’cy
);

589 
MATROSKA_ID_CHANNELS
: {

590 
numChªÃls
;

591 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
numChªÃls
)) {

592 #ifdeà
DEBUG


593 
	`årštf
(
¡d”r
, "\tChªÃl %d\n", 
numChªÃls
);

595 ià(
Œack
 !ğ
NULL
èŒack->
numChªÃls
 =‚umChannels;

599 
MATROSKA_ID_BIT_DEPTH
: {

600 
b™D•th
;

601 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
b™D•th
)) {

602 #ifdeà
DEBUG


603 
	`årštf
(
¡d”r
, "\tB™ D•th %d\n", 
b™D•th
);

608 
MATROSKA_ID_CONTENT_ENCODINGS
:

609 
MATROSKA_ID_CONTENT_ENCODING
: {

612 
MATROSKA_ID_CONTENT_COMPRESSION
: {

615 ià(
Œack
 !ğ
NULL
èŒack->
isEÇbËd
 = 
F®£
;

618 
MATROSKA_ID_CONTENT_COMP_ALGO
: {

619 
cÚ‹ÁCompAlgo
;

620 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
cÚ‹ÁCompAlgo
)) {

621 #ifdeà
DEBUG


622 
	`årštf
(
¡d”r
, "\tCÚ‹Á Com´essiÚ AlgÜ™hm %d (%s)\n", 
cÚ‹ÁCompAlgo
,

623 
cÚ‹ÁCompAlgo
 == 0 ? "zlib" : contentCompAlgo == 3 ? "Header Stripping" : "<unknown>");

626 ià(
Œack
 !ğ
NULL
èŒack->
isEÇbËd
 = 
cÚ‹ÁCompAlgo
 == 3;

630 
MATROSKA_ID_CONTENT_COMP_SETTINGS
: {

631 
u_št8_t
* 
h—d”SŒ³dBy‹s
;

632 
h—d”SŒ³dBy‹sSize
;

633 ià(
	`·r£EBMLV®_bš¬y
(
size
, 
h—d”SŒ³dBy‹s
)) {

634 
h—d”SŒ³dBy‹sSize
 = ()
size
.
	`v®
();

635 #ifdeà
DEBUG


636 
	`årštf
(
¡d”r
, "\tHeader Stripped Bytes: ");

637 
i
 = 0; i < 
h—d”SŒ³dBy‹sSize
; ++iè
	`årštf
(
¡d”r
, "%02x:", 
h—d”SŒ³dBy‹s
[i]);

638 
	`årštf
(
¡d”r
, "\n");

640 ià(
Œack
 !ğ
NULL
) {

641 
d–‘e
[] 
Œack
->
h—d”SŒ³dBy‹s
;rack->headerStrippedBytes = headerStrippedBytes;

642 
Œack
->
h—d”SŒ³dBy‹sSize
 = headerStrippedBytesSize;

644 
d–‘e
[] 
h—d”SŒ³dBy‹s
;

649 
MATROSKA_ID_CONTENT_ENCRYPTION
: {

651 ià(
Œack
 !ğ
NULL
èŒack->
isEÇbËd
 = 
F®£
;

655 
	`skH—d”
(
size
);

659 
	`£tP¬£S‹
();

662 
fLim™Off£tInFe
 = 0;

663 ià(
Œack
 !ğ
NULL
 &&¿ck->
ŒackNumb”
 =ğ0è
d–‘e
rack;

664  
True
;

665 
	}
}

667 
	gM©roskaFeP¬£r
::
	$lookFÜNextBlock
() {

668 #ifdeà
DEBUG


669 
	`årštf
(
¡d”r
, "looking for Block\n");

672 
EBMLId
 
id
;

673 
EBMLD©aSize
 
size
;

674 
fCu¼’tP¬£S‹
 =ğ
LOOKING_FOR_BLOCK
) {

675 !
	`·r£EBMLIdAndSize
(
id
, 
size
)) {}

676 #ifdeà
DEBUG


677 
	`årštf
(
¡d”r
, "M©roskaFeP¬£r::lookFÜNextBlock(): P¬£d id 0x% (%s), size: %Îd\n", 
id
.
	`hexSŒšg
(), id.
	`¡ršgName
(), 
size
.
	`v®
());

679 
id
.
	`v®
()) {

680 
MATROSKA_ID_SEGMENT
: {

683 
MATROSKA_ID_CLUSTER
: {

686 
MATROSKA_ID_TIMECODE
: {

687 
timecode
;

688 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
timecode
)) {

689 
fClu¡”Timecode
 = 
timecode
;

690 #ifdeà
DEBUG


691 
	`årštf
(
¡d”r
, "\tClu¡”imecode: %d (=ğ%à£cÚds)\n", 
fClu¡”Timecode
, fClu¡”Timecode*(
fOurFe
.
fTimecodeSÿË
/1000000000.0));

696 
MATROSKA_ID_BLOCK_GROUP
: {

699 
MATROSKA_ID_SIMPLEBLOCK
:

700 
MATROSKA_ID_BLOCK
: {

701 
fBlockSize
 = ()
size
.
	`v®
();

702 
fCu¼’tP¬£S‹
 = 
PARSING_BLOCK
;

705 
MATROSKA_ID_BLOCK_DURATION
: {

706 
blockDu¿tiÚ
;

707 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
blockDu¿tiÚ
)) {

708 #ifdeà
DEBUG


709 
	`årštf
(
¡d”r
, "\tblock du¿tiÚ: %d (=ğ%àms)\n", 
blockDu¿tiÚ
, ()(blockDu¿tiÚ*
fOurFe
.
fTimecodeSÿË
/1000000.0));

715 #ifdeà
DEBUG


716 
MATROSKA_ID_ATTACHMENTS
: {

719 
MATROSKA_ID_ATTACHED_FILE
: {

722 
MATROSKA_ID_FILE_DESCRIPTION
: {

723 * 
feDesütiÚ
;

724 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
feDesütiÚ
)) {

725 #ifdeà
DEBUG


726 
	`årštf
(
¡d”r
, "\tFDesütiÚ: %s\n", 
feDesütiÚ
);

728 
d–‘e
[] 
feDesütiÚ
;

732 
MATROSKA_ID_FILE_NAME
: {

733 * 
feName
;

734 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
feName
)) {

735 #ifdeà
DEBUG


736 
	`årštf
(
¡d”r
, "\tFName: %s\n", 
feName
);

738 
d–‘e
[] 
feName
;

742 
MATROSKA_ID_FILE_MIME_TYPE
: {

743 * 
feMIMETy³
;

744 ià(
	`·r£EBMLV®_¡ršg
(
size
, 
feMIMETy³
)) {

745 #ifdeà
DEBUG


746 
	`årštf
(
¡d”r
, "\tFMIME Ty³: %s\n", 
feMIMETy³
);

748 
d–‘e
[] 
feMIMETy³
;

752 
MATROSKA_ID_FILE_UID
: {

753 
feUID
;

754 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
feUID
)) {

755 #ifdeà
DEBUG


756 
	`årštf
(
¡d”r
, "\tFUID: 0x%x\n", 
feUID
);

763 
	`skH—d”
(
size
);

767 
	`£tP¬£S‹
();

769 
	}
}

771 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£Cues
() {

772 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_CUES
)

773 
	`årštf
(
¡d”r
, "parsing Cues\n");

775 
EBMLId
 
id
;

776 
EBMLD©aSize
 
size
;

779 ià(!
	`·r£EBMLIdAndSize
(
id
, 
size
è|| id !ğ
MATROSKA_ID_CUES
è 
True
;

780 
fLim™Off£tInFe
 = 
fCurOff£tInFe
 + 
size
.
	`v®
();

782 
cu¼’tCueTime
 = 0.0;

783 
u_št64_t
 
cu¼’tClu¡”Off£tInFe
 = 0;

785 
fCurOff£tInFe
 < 
fLim™Off£tInFe
) {

786 !
	`·r£EBMLIdAndSize
(
id
, 
size
)) {}

787 #ifdeà
DEBUG_CUES


788 ià(
id
 =ğ
MATROSKA_ID_CUE_POINT
è
	`årštf
(
¡d”r
, "\n");

789 
	`årštf
(
¡d”r
, "M©roskaFeP¬£r::·r£Cues(): P¬£d id 0x% (%s), size: %Îd\n", 
id
.
	`hexSŒšg
(), id.
	`¡ršgName
(), 
size
.
	`v®
());

791 
id
.
	`v®
()) {

792 
MATROSKA_ID_CUE_POINT
: {

795 
MATROSKA_ID_CUE_TIME
: {

796 
cueTime
;

797 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
cueTime
)) {

798 
cu¼’tCueTime
 = 
cueTime
*(
fOurFe
.
fTimecodeSÿË
/1000000000.0);

799 #ifdeà
DEBUG_CUES


800 
	`årštf
(
¡d”r
, "\tCuTim%d (=ğ%à£cÚds)\n", 
cueTime
, 
cu¼’tCueTime
);

805 
MATROSKA_ID_CUE_TRACK_POSITIONS
: {

808 
MATROSKA_ID_CUE_TRACK
: {

809 
cueT¿ck
;

810 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
cueT¿ck
)) {

811 #ifdeà
DEBUG_CUES


812 
	`årštf
(
¡d”r
, "\tCuT¿ck %d\n", 
cueT¿ck
);

817 
MATROSKA_ID_CUE_CLUSTER_POSITION
: {

818 
u_št64_t
 
cueClu¡”Pos™iÚ
;

819 ià(
	`·r£EBMLV®_unsigÃd64
(
size
, 
cueClu¡”Pos™iÚ
)) {

820 
cu¼’tClu¡”Off£tInFe
 = 
fOurFe
.
fSegm’tD©aOff£t
 + 
cueClu¡”Pos™iÚ
;

821 #ifdeà
DEBUG_CUES


822 
	`årštf
(
¡d”r
, "\tCuClu¡” Pos™iÚ %Îu (=> off£ˆw™hšhfe: %Îu (0x%Îx))\n", 
cueClu¡”Pos™iÚ
, 
cu¼’tClu¡”Off£tInFe
, currentClusterOffsetInFile);

825 
fOurFe
.
	`addCuePošt
(
cu¼’tCueTime
, 
cu¼’tClu¡”Off£tInFe
, 1 );

829 
MATROSKA_ID_CUE_BLOCK_NUMBER
: {

830 
cueBlockNumb”
;

831 ià(
	`·r£EBMLV®_unsigÃd
(
size
, 
cueBlockNumb”
) && cueBlockNumber != 0) {

832 #ifdeà
DEBUG_CUES


833 
	`årštf
(
¡d”r
, "\tCuBlock Numb” %d\n", 
cueBlockNumb”
);

836 
fOurFe
.
	`addCuePošt
(
cu¼’tCueTime
, 
cu¼’tClu¡”Off£tInFe
, 
cueBlockNumb”
);

841 
	`skH—d”
(
size
);

845 
	`£tP¬£S‹
();

848 
fLim™Off£tInFe
 = 0;

849 #ià
	`defšed
(
DEBUG
è|| defšed(
DEBUG_CUES
)

850 
	`årštf
(
¡d”r
, "done…arsing Cues\n");

852 #ifdeà
DEBUG_CUES


853 
	`årštf
(
¡d”r
, "Cue Pointree: ");

854 
fOurFe
.
	`´štCuePošts
(
¡d”r
);

855 
	`årštf
(
¡d”r
, "\n");

857  
True
;

858 
	}
}

860 ’um { 
	mNoLacšg
, 
	mXhLacšg
, 
	mFixedSizeLacšg
, 
	mEBMLLacšg
 } 
	tM©roskaLacšgTy³
;

862 
	gM©roskaFeP¬£r
::
	$·r£Block
() {

863 #ifdeà
DEBUG


864 
	`årštf
(
¡d”r
, "parsing SimpleBlock or Block\n");

867 
blockS¹Pos
 = 
	`curOff£t
();

870 
EBMLNumb”
 
ŒackNumb”
;

871 ià(!
	`·r£EBMLNumb”
(
ŒackNumb”
)) ;

872 
fBlockT¿ckNumb”
 = ()
ŒackNumb”
.
	`v®
();

875 ià(
fOurDemux
->
	`lookupDemuxedT¿ck
(
fBlockT¿ckNumb”
è=ğ
NULL
) {

876 
h—d”By‹sS“n
 = 
	`curOff£t
(è- 
blockS¹Pos
;

877 ià(
h—d”By‹sS“n
 < 
fBlockSize
) {

878 
	`skBy‹s
(
fBlockSize
 - 
h—d”By‹sS“n
);

880 #ifdeà
DEBUG


881 
	`årštf
(
¡d”r
, "\tSk³d block fÜ unu£d¿ck‚umb” %d\n", 
fBlockT¿ckNumb”
);

883 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

884 
	`£tP¬£S‹
();

888 
M©roskaT¿ck
* 
Œack
 = 
fOurFe
.
	`lookup
(
fBlockT¿ckNumb”
);

889 ià(
Œack
 =ğ
NULL
) ;

892 
fBlockTimecode
 = (
	`g‘1By‹
()<<8)|get1Byte();

895 
u_št8_t
 
c
 = 
	`g‘1By‹
();

896 
c
 &= 0x6;

897 
M©roskaLacšgTy³
 
ÏcšgTy³
 = (
c
==0x0)?
NoLacšg
 : (c==0x02)?
XhLacšg
 : (c==0x04)?
FixedSizeLacšg
 : 
EBMLLacšg
;

898 #ifdeà
DEBUG


899 
	`årštf
(
¡d”r
, "\‰¿ck‚umb” %d,imecod%d (=> %à£cÚds), % Ïcšg\n", 
fBlockT¿ckNumb”
, 
fBlockTimecode
, (
fClu¡”Timecode
+fBlockTimecode)*(
fOurFe
.
fTimecodeSÿË
/1000000000.0), (
ÏcšgTy³
==
NoLacšg
)?"no" : (ÏcšgTy³==
XhLacšg
)?"Xh" : (ÏcšgTy³==
FixedSizeLacšg
)?"fixed-size" : "EBML");

902 ià(
ÏcšgTy³
 =ğ
NoLacšg
) {

903 
fNumF¿mesInBlock
 = 1;

906 
fNumF¿mesInBlock
 = 
	`g‘1By‹
() + 1;

908 
d–‘e
[] 
fF¿meSizesW™hšBlock
; fF¿meSizesW™hšBlock = 
Ãw
 [
fNumF¿mesInBlock
];

909 ià(
fF¿meSizesW™hšBlock
 =ğ
NULL
) ;

911 ià(
ÏcšgTy³
 =ğ
NoLacšg
) {

912 
h—d”By‹sS“n
 = 
	`curOff£t
(è- 
blockS¹Pos
;

913 ià(
h—d”By‹sS“n
 > 
fBlockSize
) ;

915 
fF¿meSizesW™hšBlock
[0] = 
fBlockSize
 - 
h—d”By‹sS“n
;

916 } ià(
ÏcšgTy³
 =ğ
FixedSizeLacšg
) {

917 
h—d”By‹sS“n
 = 
	`curOff£t
(è- 
blockS¹Pos
;

918 ià(
h—d”By‹sS“n
 > 
fBlockSize
) ;

920 
äameBy‹sAvaabË
 = 
fBlockSize
 - 
h—d”By‹sS“n
;

921 
cÚ¡ªtF¿meSize
 = 
äameBy‹sAvaabË
/
fNumF¿mesInBlock
;

923 
i
 = 0; i < 
fNumF¿mesInBlock
; ++i) {

924 
fF¿meSizesW™hšBlock
[
i
] = 
cÚ¡ªtF¿meSize
;

927 
fF¿meSizesW™hšBlock
[
fNumF¿mesInBlock
-1] +ğ
äameBy‹sAvaabË
%fNumFramesInBlock;

929 
curF¿meSize
 = 0;

930 
äameSizesTÙ®
 = 0;

931 
i
;

933 
i
 = 0; i < 
fNumF¿mesInBlock
-1; ++i) {

934 ià(
ÏcšgTy³
 =ğ
EBMLLacšg
) {

935 
EBMLNumb”
 
äameSize
;

936 ià(!
	`·r£EBMLNumb”
(
äameSize
)) ;

937 
fsv
 = ()
äameSize
.
	`v®
();

939 ià(
i
 == 0) {

940 
curF¿meSize
 = 
fsv
;

943 
toSubŒaù
 = (
fsv
>0xFFFFFF)?0x07FFFFFF : (fsv>0xFFFF)?0x0FFFFF : (fsv>0xFF)?0x1FFF : 0x3F;

944 
fsv_sigÃd
 = 
fsv
 - 
toSubŒaù
;

945 
curF¿meSize
 +ğ
fsv_sigÃd
;

946 ià(()
curF¿meSize
 < 0) ;

949 
curF¿meSize
 = 0;

950 
u_št8_t
 
c
;

952 
c
 = 
	`g‘1By‹
();

953 
curF¿meSize
 +ğ
c
;

954 } 
c
 == 0xFF);

956 
fF¿meSizesW™hšBlock
[
i
] = 
curF¿meSize
;

957 
äameSizesTÙ®
 +ğ
curF¿meSize
;

959 ià(
i
 !ğ
fNumF¿mesInBlock
-1) ;

962 
h—d”By‹sS“n
 = 
	`curOff£t
(è- 
blockS¹Pos
;

963 ià(
h—d”By‹sS“n
 + 
äameSizesTÙ®
 > 
fBlockSize
) ;

964 
fF¿meSizesW™hšBlock
[
i
] = 
fBlockSize
 - (
h—d”By‹sS“n
 + 
äameSizesTÙ®
);

969 ià(
Œack
->
h—d”SŒ³dBy‹sSize
 != 0) {

970 
i
 = 0; i < 
fNumF¿mesInBlock
; ++iè
fF¿meSizesW™hšBlock
[i] +ğ
Œack
->
h—d”SŒ³dBy‹sSize
;

972 #ifdeà
DEBUG


973 
	`årštf
(
¡d”r
, "\tThi block cÚš %d f¿me(s); size(s):", 
fNumF¿mesInBlock
);

974 
äameSizesTÙ®
 = 0;

975 
i
 = 0; i < 
fNumF¿mesInBlock
; ++i) {

976 
	`årštf
(
¡d”r
, " %d", 
fF¿meSizesW™hšBlock
[
i
]);

977 
äameSizesTÙ®
 +ğ
fF¿meSizesW™hšBlock
[
i
];

979 ià(
fNumF¿mesInBlock
 > 1è
	`årštf
(
¡d”r
, " (tÙ®: %u)", 
äameSizesTÙ®
);

980 
	`årštf
(
¡d”r
, " bytes\n");

983 
fCu¼’tP¬£S‹
 = 
DELIVERING_FRAME_WITHIN_BLOCK
;

984 
fCurOff£tW™hšF¿me
 = 
fNextF¿meNumb”ToD–iv”
 = 0;

985 
	`£tP¬£S‹
();

990 #ifdeà
DEBUG


991 
	`årštf
(
¡d”r
, "parseBlock(): Error…arsing data;ryingo„ecover...\n");

993 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

994 
	}
}

996 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$d–iv”F¿meW™hšBlock
() {

997 #ifdeà
DEBUG


998 
	`årštf
(
¡d”r
, "delivering frame within SimpleBlock or Block\n");

1001 
M©roskaT¿ck
* 
Œack
 = 
fOurFe
.
	`lookup
(
fBlockT¿ckNumb”
);

1002 ià(
Œack
 =ğ
NULL
) ;

1004 
M©roskaDemuxedT¿ck
* 
demuxedT¿ck
 = 
fOurDemux
->
	`lookupDemuxedT¿ck
(
fBlockT¿ckNumb”
);

1005 ià(
demuxedT¿ck
 =ğ
NULL
) ;

1006 ià(!
demuxedT¿ck
->
	`isCu¼’yAwa™šgD©a
()) {

1010 #ifdeà
DEBUG


1011 
	`årštf
(
¡d”r
, "\tdeã¼šg d–iv”y oàäam#%d (%d by‹s)", 
fNextF¿meNumb”ToD–iv”
, 
fF¿meSizesW™hšBlock
[fNextFrameNumberToDeliver]);

1012 ià(
Œack
->
	`haveSubäames
()è
	`årštf
(
¡d”r
, "[off£ˆ%d]", 
fCurOff£tW™hšF¿me
);

1013 
	`årštf
(
¡d”r
, "\n");

1015 
	`»¡ÜeSavedP¬£rS‹
();

1016  
F®£
;

1019 
äameSize
;

1020 
u_št8_t
 cÚ¡* 
¥ecŸlF¿meSourû
 = 
NULL
;

1021 
u_št8_t
 cÚ¡ 
İusComm’tH—d”
[16]

1023 ià(
Œack
->
codecIsOpus
 && 
demuxedT¿ck
->
fOpusT¿ckNumb”
 < 2) {

1027 ià(
demuxedT¿ck
->
fOpusT¿ckNumb”
 == 0) {

1028 
¥ecŸlF¿meSourû
 = 
Œack
->
codecPriv©e
;

1029 
äameSize
 = 
Œack
->
codecPriv©eSize
;

1031 
¥ecŸlF¿meSourû
 = 
İusComm’tH—d”
;

1032 
äameSize
 =  
İusComm’tH—d”
;

1034 ++
demuxedT¿ck
->
fOpusT¿ckNumb”
;

1036 
äameSize
 = 
fF¿meSizesW™hšBlock
[
fNextF¿meNumb”ToD–iv”
];

1037 ià(
Œack
->
	`haveSubäames
()) {

1039 ià(
fCurOff£tW™hšF¿me
 + 
Œack
->
subäameSizeSize
 > 
äameSize
) ;

1040 
subäameSize
 = 0;

1041 
i
 = 0; i < 
Œack
->
subäameSizeSize
; ++i) {

1042 
u_št8_t
 
c
;

1043 
	`g‘CommÚF¿meBy‹s
(
Œack
, &
c
, 1, 0);

1044 ià(
fCurF¿meNumBy‹sToG‘
 > 0) {

1045 
c
 = 
	`g‘1By‹
();

1046 ++
fCurOff£tW™hšF¿me
;

1048 
subäameSize
 = subäameSize*256 + 
c
;

1050 ià(
subäameSize
 =ğ0 || 
fCurOff£tW™hšF¿me
 + subäameSiz> 
äameSize
) ;

1051 
äameSize
 = 
subäameSize
;

1056 
±
 = (
fClu¡”Timecode
+
fBlockTimecode
)*(
fOurFe
.
fTimecodeSÿË
/1000000000.0)

1057 + 
fNextF¿meNumb”ToD–iv”
*(
Œack
->
deçuÉDu¿tiÚ
/1000000000.0);

1058 ià(
fP»£Á©iÚTimeOff£t
 == 0.0) {

1061 
timev®
 
timeNow
;

1062 
	`g‘timeofday
(&
timeNow
, 
NULL
);

1063 
±Now
 = 
timeNow
.
tv_£c
 +imeNow.
tv_u£c
/1000000.0;

1064 
fP»£Á©iÚTimeOff£t
 = 
±Now
 - 
±
;

1066 
±
 +ğ
fP»£Á©iÚTimeOff£t
;

1067 
timev®
 
´e£Á©iÚTime
;

1068 
´e£Á©iÚTime
.
tv_£c
 = ()
±
;

1069 
´e£Á©iÚTime
.
tv_u£c
 = ()((
±
 -…»£Á©iÚTime.
tv_£c
)*1000000);

1070 
du¿tiÚInMiüo£cÚds
;

1071 ià(
¥ecŸlF¿meSourû
 !ğ
NULL
) {

1072 
du¿tiÚInMiüo£cÚds
 = 0;

1074 
du¿tiÚInMiüo£cÚds
 = 
Œack
->
deçuÉDu¿tiÚ
/1000;

1075 ià(
Œack
->
	`haveSubäames
()) {

1077 ià(
fCurOff£tW™hšF¿me
 + 
äameSize
 + 
Œack
->
subäameSizeSize
 < 
fF¿meSizesW™hšBlock
[
fNextF¿meNumb”ToD–iv”
]) {

1079 
du¿tiÚInMiüo£cÚds
 = 0;

1084 ià(
Œack
->
deçuÉDu¿tiÚ
 == 0) {

1086 ià(
demuxedT¿ck
->
	`´evP»£Á©iÚTime
().
tv_£c
 != 0) {

1087 
demuxedT¿ck
->
	`du¿tiÚImb®ªû
()

1088 +ğ(
´e£Á©iÚTime
.
tv_£c
 - 
demuxedT¿ck
->
	`´evP»£Á©iÚTime
().tv_sec)*1000000

1089 + (
´e£Á©iÚTime
.
tv_u£c
 - 
demuxedT¿ck
->
	`´evP»£Á©iÚTime
().tv_usec);

1091 
adju¡m’t
 = 0;

1092 ià(
demuxedT¿ck
->
	`du¿tiÚImb®ªû
() > 0) {

1094 cÚ¡ 
adju¡m’tTh»shŞd
 = 100000;

1095 
adju¡m’t
 = 
demuxedT¿ck
->
	`du¿tiÚImb®ªû
(è> 
adju¡m’tTh»shŞd


1096 ? 
adju¡m’tTh»shŞd
 : 
demuxedT¿ck
->
	`du¿tiÚImb®ªû
();

1097 } ià(
demuxedT¿ck
->
	`du¿tiÚImb®ªû
() < 0) {

1099 
adju¡m’t
 = ()(-
demuxedT¿ck
->
	`du¿tiÚImb®ªû
()è< 
du¿tiÚInMiüo£cÚds


1100 ? 
demuxedT¿ck
->
	`du¿tiÚImb®ªû
(è: -()
du¿tiÚInMiüo£cÚds
;

1102 
du¿tiÚInMiüo£cÚds
 +ğ
adju¡m’t
;

1103 
demuxedT¿ck
->
	`du¿tiÚImb®ªû
(è-ğ
du¿tiÚInMiüo£cÚds
;

1104 
demuxedT¿ck
->
	`´evP»£Á©iÚTime
(èğ
´e£Á©iÚTime
;

1107 
demuxedT¿ck
->
	`´e£Á©iÚTime
(èğ
´e£Á©iÚTime
;

1108 
demuxedT¿ck
->
	`du¿tiÚInMiüo£cÚds
(èğ
du¿tiÚInMiüo£cÚds
;

1111 ià(
äameSize
 > 
demuxedT¿ck
->
	`maxSize
()) {

1112 
demuxedT¿ck
->
	`numTrunÿ‹dBy‹s
(èğ
äameSize
 - demuxedT¿ck->
	`maxSize
();

1113 
demuxedT¿ck
->
	`äameSize
(èğdemuxedT¿ck->
	`maxSize
();

1115 
demuxedT¿ck
->
	`numTrunÿ‹dBy‹s
() = 0;

1116 
demuxedT¿ck
->
	`äameSize
(èğ
äameSize
;

1118 
	`g‘CommÚF¿meBy‹s
(
Œack
, 
demuxedT¿ck
->
	`to
(), demuxedT¿ck->
	`äameSize
(), demuxedT¿ck->
	`numTrunÿ‹dBy‹s
());

1121 ià(
¥ecŸlF¿meSourû
 !ğ
NULL
) {

1122 
	`memmove
(
demuxedT¿ck
->
	`to
(), 
¥ecŸlF¿meSourû
, demuxedT¿ck->
	`äameSize
());

1123 #ifdeà
DEBUG


1124 
	`årštf
(
¡d”r
, "\td–iv”ed s³cŸÈäame: %d by‹s", 
demuxedT¿ck
->
	`äameSize
());

1125 ià(
demuxedT¿ck
->
	`numTrunÿ‹dBy‹s
(è> 0è
	`årštf
(
¡d”r
, " (%d bytesruncated)", demuxedTrack->numTruncatedBytes());

1126 
	`årštf
(
¡d”r
, " @%u.%06u (%.06àäom s¹); du¿tiÚ %u us\n", 
demuxedT¿ck
->
	`´e£Á©iÚTime
().
tv_£c
, demuxedT¿ck->´e£Á©iÚTime().
tv_u£c
, demuxedT¿ck->´e£Á©iÚTime().tv_£c+demuxedT¿ck->´e£Á©iÚTime().tv_u£c/1000000.0-
fP»£Á©iÚTimeOff£t
, demuxedT¿ck->
	`du¿tiÚInMiüo£cÚds
());

1128 
	`£tP¬£S‹
();

1129 
F¿medSourû
::
	`aá”G‘tšg
(
demuxedT¿ck
);

1131 
fCu¼’tP¬£S‹
 = 
DELIVERING_FRAME_BYTES
;

1132 
	`£tP¬£S‹
();

1134  
True
;

1138 #ifdeà
DEBUG


1139 
	`årštf
(
¡d”r
, "deliverFrameWithinBlock(): Error…arsing data;ryingo„ecover...\n");

1141 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

1142  
True
;

1143 
	}
}

1145 
	gM©roskaFeP¬£r
::
	$d–iv”F¿meBy‹s
() {

1147 
M©roskaT¿ck
* 
Œack
 = 
fOurFe
.
	`lookup
(
fBlockT¿ckNumb”
);

1148 ià(
Œack
 =ğ
NULL
) ;

1150 
M©roskaDemuxedT¿ck
* 
demuxedT¿ck
 = 
fOurDemux
->
	`lookupDemuxedT¿ck
(
fBlockT¿ckNumb”
);

1151 ià(
demuxedT¿ck
 =ğ
NULL
) ;

1153 cÚ¡ 
BANK_SIZE
 = 
	`bªkSize
();

1154 
fCurF¿meNumBy‹sToG‘
 > 0) {

1156 
numBy‹sToG‘
 = 
fCurF¿meNumBy‹sToG‘
 > 
BANK_SIZE
 ? BANK_SIZE : fCurFrameNumBytesToGet;

1157 
	`g‘By‹s
(
fCurF¿meTo
, 
numBy‹sToG‘
);

1158 
fCurF¿meTo
 +ğ
numBy‹sToG‘
;

1159 
fCurF¿meNumBy‹sToG‘
 -ğ
numBy‹sToG‘
;

1160 
fCurOff£tW™hšF¿me
 +ğ
numBy‹sToG‘
;

1161 
	`£tP¬£S‹
();

1163 
fCurF¿meNumBy‹sToSk
 > 0) {

1165 
numBy‹sToSk
 = 
fCurF¿meNumBy‹sToSk
 > 
BANK_SIZE
 ? BANK_SIZE : fCurFrameNumBytesToSkip;

1166 
	`skBy‹s
(
numBy‹sToSk
);

1167 
fCurF¿meNumBy‹sToSk
 -ğ
numBy‹sToSk
;

1168 
fCurOff£tW™hšF¿me
 +ğ
numBy‹sToSk
;

1169 
	`£tP¬£S‹
();

1171 #ifdeà
DEBUG


1172 
	`årštf
(
¡d”r
, "\td–iv”ed f¿m#%d: %d by‹s", 
fNextF¿meNumb”ToD–iv”
, 
demuxedT¿ck
->
	`äameSize
());

1173 ià(
Œack
->
	`haveSubäames
()è
	`årštf
(
¡d”r
, "[off£ˆ%d]", 
fCurOff£tW™hšF¿me
 -¿ck->
subäameSizeSize
 - 
demuxedT¿ck
->
	`äameSize
(è- demuxedT¿ck->
	`numTrunÿ‹dBy‹s
());

1174 ià(
demuxedT¿ck
->
	`numTrunÿ‹dBy‹s
(è> 0è
	`årštf
(
¡d”r
, " (%d bytesruncated)", demuxedTrack->numTruncatedBytes());

1175 
	`årštf
(
¡d”r
, " @%u.%06u (%.06àäom s¹); du¿tiÚ %u us\n", 
demuxedT¿ck
->
	`´e£Á©iÚTime
().
tv_£c
, demuxedT¿ck->´e£Á©iÚTime().
tv_u£c
, demuxedT¿ck->´e£Á©iÚTime().tv_£c+demuxedT¿ck->´e£Á©iÚTime().tv_u£c/1000000.0-
fP»£Á©iÚTimeOff£t
, demuxedT¿ck->
	`du¿tiÚInMiüo£cÚds
());

1178 ià(!
Œack
->
	`haveSubäames
()

1179 || 
fCurOff£tW™hšF¿me
 + 
Œack
->
subäameSizeSize
 >ğ
fF¿meSizesW™hšBlock
[
fNextF¿meNumb”ToD–iv”
]) {

1181 ++
fNextF¿meNumb”ToD–iv”
;

1182 
fCurOff£tW™hšF¿me
 = 0;

1184 ià(
fNextF¿meNumb”ToD–iv”
 =ğ
fNumF¿mesInBlock
) {

1186 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

1188 
fCu¼’tP¬£S‹
 = 
DELIVERING_FRAME_WITHIN_BLOCK
;

1191 
	`£tP¬£S‹
();

1192 
F¿medSourû
::
	`aá”G‘tšg
(
demuxedT¿ck
);

1197 #ifdeà
DEBUG


1198 
	`årštf
(
¡d”r
, "deliverFrameBytes(): Error…arsing data;ryingo„ecover...\n");

1200 
fCu¼’tP¬£S‹
 = 
LOOKING_FOR_BLOCK
;

1201 
	}
}

1203 
	gM©roskaFeP¬£r


1204 ::
	$g‘CommÚF¿meBy‹s
(
M©roskaT¿ck
* 
Œack
, 
u_št8_t
* 
to
, 
numBy‹sToG‘
, 
numBy‹sToSk
) {

1205 ià(
Œack
->
h—d”SŒ³dBy‹sSize
 > 
fCurOff£tW™hšF¿me
) {

1207 
numRemaššgH—d”SŒ³dBy‹s
 = 
Œack
->
h—d”SŒ³dBy‹sSize
 - 
fCurOff£tW™hšF¿me
;

1208 
numH—d”SŒ³dBy‹sToG‘
;

1209 ià(
numBy‹sToG‘
 <ğ
numRemaššgH—d”SŒ³dBy‹s
) {

1210 
numH—d”SŒ³dBy‹sToG‘
 = 
numBy‹sToG‘
;

1211 
numBy‹sToG‘
 = 0;

1212 ià(
numBy‹sToG‘
 + 
numBy‹sToSk
 <ğ
numRemaššgH—d”SŒ³dBy‹s
) {

1213 
numBy‹sToSk
 = 0;

1215 
numBy‹sToSk
 = 
numBy‹sToG‘
 +‚umBy‹sToSk - 
numRemaššgH—d”SŒ³dBy‹s
;

1218 
numH—d”SŒ³dBy‹sToG‘
 = 
numRemaššgH—d”SŒ³dBy‹s
;

1219 
numBy‹sToG‘
 =‚umBy‹sToG‘ - 
numRemaššgH—d”SŒ³dBy‹s
;

1222 ià(
numH—d”SŒ³dBy‹sToG‘
 > 0) {

1223 
	`memmove
(
to
, &
Œack
->
h—d”SŒ³dBy‹s
[
fCurOff£tW™hšF¿me
], 
numH—d”SŒ³dBy‹sToG‘
);

1224 
to
 +ğ
numH—d”SŒ³dBy‹sToG‘
;

1225 
fCurOff£tW™hšF¿me
 +ğ
numH—d”SŒ³dBy‹sToG‘
;

1229 
fCurF¿meTo
 = 
to
;

1230 
fCurF¿meNumBy‹sToG‘
 = 
numBy‹sToG‘
;

1231 
fCurF¿meNumBy‹sToSk
 = 
numBy‹sToSk
;

1232 
	}
}

1234 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLNumb”
(
EBMLNumb”
& 
num
) {

1235 
i
;

1236 
u_št8_t
 
b™mask
 = 0x80;

1237 
i
 = 0; i < 
EBML_NUMBER_MAX_LEN
; ++i) {

1239 ià(
fLim™Off£tInFe
 > 0 && 
fCurOff£tInFe
 > fLim™Off£tInFeè 
F®£
;

1240 
num
.
d©a
[
i
] = 
	`g‘1By‹
();

1241 ++
fCurOff£tInFe
;

1244 ià(
i
 =ğ0 && !
num
.
¡rL—dšg1
 && (num.
d©a
[i]&0xF0) == 0) {

1245 
	`£tP¬£S‹
();

1250 ià((
num
.
d©a
[0]&
b™mask
) != 0) {

1252 ià(
num
.
¡rL—dšg1
ènum.
d©a
[0] &=~ 
b™mask
;

1255 
b™mask
 >>= 1;

1257 ià(
i
 =ğ
EBML_NUMBER_MAX_LEN
è 
F®£
;

1259 
num
.
Ën
 = 
i
+1;

1260  
True
;

1261 
	}
}

1263 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLIdAndSize
(
EBMLId
& 
id
, 
EBMLD©aSize
& 
size
) {

1264  
	`·r£EBMLNumb”
(
id
è&&…¬£EBMLNumb”(
size
);

1265 
	}
}

1267 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLV®_unsigÃd64
(
EBMLD©aSize
& 
size
, 
u_št64_t
& 
»suÉ
) {

1268 
u_št64_t
 
sv
 = 
size
.
	`v®
();

1269 ià(
sv
 > 8è 
F®£
;

1271 
»suÉ
 = 0;

1272 
i
 = ()
sv
; i > 0; --i) {

1273 ià(
fLim™Off£tInFe
 > 0 && 
fCurOff£tInFe
 > fLim™Off£tInFeè 
F®£
;

1275 
u_št8_t
 
c
 = 
	`g‘1By‹
();

1276 ++
fCurOff£tInFe
;

1278 
»suÉ
 =„esuÉ*256 + 
c
;

1281  
True
;

1282 
	}
}

1284 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLV®_unsigÃd
(
EBMLD©aSize
& 
size
, & 
»suÉ
) {

1285 ià(
size
.
	`v®
(è> 4è 
F®£
;

1287 
u_št64_t
 
»suÉ64
;

1288 ià(!
	`·r£EBMLV®_unsigÃd64
(
size
, 
»suÉ64
)è 
F®£
;

1290 
»suÉ
 = ()
»suÉ64
;

1292  
True
;

1293 
	}
}

1295 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLV®_æßt
(
EBMLD©aSize
& 
size
, & 
»suÉ
) {

1296 ià(
size
.
	`v®
() == 4) {

1298 
»suÉAsUnsigÃd
;

1299 ià(!
	`·r£EBMLV®_unsigÃd
(
size
, 
»suÉAsUnsigÃd
)è 
F®£
;

1301 ià( 
»suÉ
 !ğ 
»suÉAsUnsigÃd
è 
F®£
;

1302 
	`memıy
(&
»suÉ
, &
»suÉAsUnsigÃd
, „esult);

1303  
True
;

1304 } ià(
size
.
	`v®
() == 8) {

1306 
u_št64_t
 
»suÉAsUnsigÃd64
;

1307 ià(!
	`·r£EBMLV®_unsigÃd64
(
size
, 
»suÉAsUnsigÃd64
)è 
F®£
;

1309 
»suÉDoubË
;

1310 ià( 
»suÉDoubË
 !ğ 
»suÉAsUnsigÃd64
è 
F®£
;

1311 
	`memıy
(&
»suÉDoubË
, &
»suÉAsUnsigÃd64
, „esultDouble);

1313 
»suÉ
 = ()
»suÉDoubË
;

1314  
True
;

1317  
F®£
;

1319 
	}
}

1321 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLV®_¡ršg
(
EBMLD©aSize
& 
size
, *& 
»suÉ
) {

1322 
»suÉL’gth
 = ()
size
.
	`v®
();

1323 
»suÉ
 = 
Ãw
 [
»suÉL’gth
 + 1];

1324 ià(
»suÉ
 =ğ
NULL
è 
F®£
;

1326 * 
p
 = 
»suÉ
;

1327 
i
;

1328 
i
 = 0; i < 
»suÉL’gth
; ++i) {

1329 ià(
fLim™Off£tInFe
 > 0 && 
fCurOff£tInFe
 > fLimitOffsetInFile) ;

1331 
u_št8_t
 
c
 = 
	`g‘1By‹
();

1332 ++
fCurOff£tInFe
;

1334 *
p
++ = 
c
;

1336 ià(
i
 < 
»suÉL’gth
) {

1337 
d–‘e
[] 
»suÉ
;

1338 
»suÉ
 = 
NULL
;

1339  
F®£
;

1341 *
p
 = '\0';

1343  
True
;

1344 
	}
}

1346 
BoŞ—n
 
	gM©roskaFeP¬£r
::
	$·r£EBMLV®_bš¬y
(
EBMLD©aSize
& 
size
, 
u_št8_t
*& 
»suÉ
) {

1347 
»suÉL’gth
 = ()
size
.
	`v®
();

1348 
»suÉ
 = 
Ãw
 
u_št8_t
[
»suÉL’gth
];

1349 ià(
»suÉ
 =ğ
NULL
è 
F®£
;

1351 
u_št8_t
* 
p
 = 
»suÉ
;

1352 
i
;

1353 
i
 = 0; i < 
»suÉL’gth
; ++i) {

1354 ià(
fLim™Off£tInFe
 > 0 && 
fCurOff£tInFe
 > fLimitOffsetInFile) ;

1356 
u_št8_t
 
c
 = 
	`g‘1By‹
();

1357 ++
fCurOff£tInFe
;

1359 *
p
++ = 
c
;

1361 ià(
i
 < 
»suÉL’gth
) {

1362 
d–‘e
[] 
»suÉ
;

1363 
»suÉ
 = 
NULL
;

1364  
F®£
;

1367  
True
;

1368 
	}
}

1370 
	gM©roskaFeP¬£r
::
	$skH—d”
(
EBMLD©aSize
 cÚ¡& 
size
) {

1371 
u_št64_t
 
sv
 = ()
size
.
	`v®
();

1372 #ifdeà
DEBUG


1373 
	`årštf
(
¡d”r
, "\tskpšg %Îu by‹s\n", 
sv
);

1376 
fNumH—d”By‹sToSk
 = 
sv
;

1377 
	`skRemaššgH—d”By‹s
(
F®£
);

1378 
	}
}

1380 
	gM©roskaFeP¬£r
::
	$skRemaššgH—d”By‹s
(
BoŞ—n
 
isCÚtšu©iÚ
) {

1381 ià(
fNumH—d”By‹sToSk
 == 0) ;

1385 cÚ¡ 
maxBy‹sToSk
 = 
	`bªkSize
();

1386 
fNumH—d”By‹sToSk
 > 0) {

1387 
numBy‹sToSkNow


1388 ğ
fNumH—d”By‹sToSk
 < 
maxBy‹sToSk
 ? ()fNumHeaderBytesToSkip : maxBytesToSkip;

1389 
	`£tP¬£S‹
();

1390 
	`skBy‹s
(
numBy‹sToSkNow
);

1391 #ifdeà
DEBUG


1392 ià(
isCÚtšu©iÚ
 || 
numBy‹sToSkNow
 < 
fNumH—d”By‹sToSk
) {

1393 
	`årštf
(
¡d”r
, "\t\t(skipped %u bytes; %llu bytes„emaining)\n",

1394 
numBy‹sToSkNow
, 
fNumH—d”By‹sToSk
 -‚umBytesToSkipNow);

1397 
fCurOff£tInFe
 +ğ
numBy‹sToSkNow
;

1398 
fNumH—d”By‹sToSk
 -ğ
numBy‹sToSkNow
;

1400 
	}
}

1402 
	gM©roskaFeP¬£r
::
	$£tP¬£S‹
() {

1403 
fSavedCurOff£tInFe
 = 
fCurOff£tInFe
;

1404 
fSavedCurOff£tW™hšF¿me
 = 
fCurOff£tW™hšF¿me
;

1405 
	`§veP¬£rS‹
();

1406 
	}
}

1408 
	gM©roskaFeP¬£r
::
	$»¡ÜeSavedP¬£rS‹
() {

1409 
SŒ—mP¬£r
::
	`»¡ÜeSavedP¬£rS‹
();

1410 
fCurOff£tInFe
 = 
fSavedCurOff£tInFe
;

1411 
fCurOff£tW™hšF¿me
 = 
fSavedCurOff£tW™hšF¿me
;

1412 
	}
}

1414 
	gM©roskaFeP¬£r
::
	$£ekToFePos™iÚ
(
u_št64_t
 
off£tInFe
) {

1415 
By‹SŒ—mFeSourû
* 
feSourû
 = (By‹SŒ—mFeSourû*)
fIÅutSourû
;

1416 ià(
feSourû
 !ğ
NULL
) {

1417 
feSourû
->
	`£ekToBy‹AbsŞu‹
(
off£tInFe
);

1418 
	`»£tS‹Aá”S“kšg
();

1420 
	}
}

1422 
	gM©roskaFeP¬£r
::
	$£ekToEndOfFe
() {

1423 
By‹SŒ—mFeSourû
* 
feSourû
 = (By‹SŒ—mFeSourû*)
fIÅutSourû
;

1424 ià(
feSourû
 !ğ
NULL
) {

1425 
feSourû
->
	`£ekToEnd
();

1426 
	`»£tS‹Aá”S“kšg
();

1428 
	}
}

1430 
	gM©roskaFeP¬£r
::
	$»£tS‹Aá”S“kšg
() {

1432 
fCurOff£tInFe
 = 
fSavedCurOff£tInFe
 = 0;

1433 
fCurOff£tW™hšF¿me
 = 
fSavedCurOff£tW™hšF¿me
 = 0;

1434 
	`æushIÅut
();

1435 
	}
}

	@liveMedia/MatroskaFileServerDemux.cpp

21 
	~"M©roskaFeS”v”Demux.hh
"

22 
	~"MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"M©roskaFeS”v”MedŸSub£ssiÚ.hh
"

25 
	gM©roskaFeS”v”Demux


26 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

27 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
,

28 cÚ¡* 
´eã¼edLªguage
) {

29 ()
Ãw
 
	`M©roskaFeS”v”Demux
(
’v
, 
feName
,

30 
ÚC»©iÚ
, 
ÚC»©iÚCl›ÁD©a
,

31 
´eã¼edLªguage
);

32 
	}
}

34 
S”v”MedŸSub£ssiÚ
* 
	gM©roskaFeS”v”Demux
::
	$ÃwS”v”MedŸSub£ssiÚ
() {

35 
dummyResuÉT¿ckNumb”
;

36  
	`ÃwS”v”MedŸSub£ssiÚ
(
dummyResuÉT¿ckNumb”
);

37 
	}
}

39 
S”v”MedŸSub£ssiÚ
* 
	gM©roskaFeS”v”Demux


40 ::
	$ÃwS”v”MedŸSub£ssiÚ
(& 
»suÉT¿ckNumb”
) {

41 
S”v”MedŸSub£ssiÚ
* 
»suÉ
;

42 
»suÉT¿ckNumb”
 = 0;

44 
»suÉ
 = 
NULL
;„esuÉ =ğNULL && 
fNextT¿ckTy³ToCheck
 !ğ
MATROSKA_TRACK_TYPE_OTHER
; fNextTrackTypeToCheck <<= 1) {

45 ià(
fNextT¿ckTy³ToCheck
 =ğ
MATROSKA_TRACK_TYPE_VIDEO
è
»suÉT¿ckNumb”
 = 
fOurM©roskaFe
->
	`cho£nVideoT¿ckNumb”
();

46 ià(
fNextT¿ckTy³ToCheck
 =ğ
MATROSKA_TRACK_TYPE_AUDIO
è
»suÉT¿ckNumb”
 = 
fOurM©roskaFe
->
	`cho£nAudioT¿ckNumb”
();

47 ià(
fNextT¿ckTy³ToCheck
 =ğ
MATROSKA_TRACK_TYPE_SUBTITLE
è
»suÉT¿ckNumb”
 = 
fOurM©roskaFe
->
	`cho£nSubt™ËT¿ckNumb”
();

49 
»suÉ
 = 
	`ÃwS”v”MedŸSub£ssiÚByT¿ckNumb”
(
»suÉT¿ckNumb”
);

52  
»suÉ
;

53 
	}
}

55 
S”v”MedŸSub£ssiÚ
* 
	gM©roskaFeS”v”Demux


56 ::
	$ÃwS”v”MedŸSub£ssiÚByT¿ckNumb”
(
ŒackNumb”
) {

57 
M©roskaT¿ck
* 
Œack
 = 
fOurM©roskaFe
->
	`lookup
(
ŒackNumb”
);

58 ià(
Œack
 =ğ
NULL
)  NULL;

61 
S”v”MedŸSub£ssiÚ
* 
»suÉ
 = 
NULL
;

62 ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/MPEG") == 0) {

63 
»suÉ
 = 
MP3AudioM©roskaFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
this
, 
Œack
);

65 
»suÉ
 = 
M©roskaFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
this
, 
Œack
);

68 ià(
»suÉ
 !ğ
NULL
) {

69 #ifdeà
DEBUG


70 
	`årštf
(
¡d”r
, "C»©ed 'S”v”MedŸSub£ssiÚ' objeù fÜ¿ck #%d: % (%s)\n", 
Œack
->
ŒackNumb”
,¿ck->
codecID
,¿ck->
mimeTy³
);

74  
»suÉ
;

75 
	}
}

77 
F¿medSourû
* 
	gM©roskaFeS”v”Demux
::
	$ÃwDemuxedT¿ck
(
ş›ÁSessiÚId
, 
ŒackNumb”
) {

78 
M©roskaDemux
* 
demuxToU£
 = 
NULL
;

80 ià(
ş›ÁSessiÚId
 !ğ0 && cl›ÁSessiÚId =ğ
fLa¡Cl›ÁSessiÚId
) {

81 
demuxToU£
 = 
fLa¡C»©edDemux
;

90 ià(
demuxToU£
 =ğ
NULL
èdemuxToU£ = 
fOurM©roskaFe
->
	`ÃwDemux
();

92 
fLa¡Cl›ÁSessiÚId
 = 
ş›ÁSessiÚId
;

93 
fLa¡C»©edDemux
 = 
demuxToU£
;

95  
demuxToU£
->
	`ÃwDemuxedT¿ckByT¿ckNumb”
(
ŒackNumb”
);

96 
	}
}

98 
	gM©roskaFeS”v”Demux


99 ::
	$M©roskaFeS”v”Demux
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

100 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
,

101 cÚ¡* 
´eã¼edLªguage
)

102 : 
	`Medium
(
’v
),

103 
	`fFeName
(
feName
), 
	`fOnC»©iÚ
(
ÚC»©iÚ
), 
	`fOnC»©iÚCl›ÁD©a
(
ÚC»©iÚCl›ÁD©a
),

104 
	`fNextT¿ckTy³ToCheck
(0x1), 
	`fLa¡Cl›ÁSessiÚId
(0), 
	$fLa¡C»©edDemux
(
NULL
) {

105 
M©roskaFe
::
	`ü—‹New
(
’v
, 
feName
, 
ÚM©roskaFeC»©iÚ
, 
this
, 
´eã¼edLªguage
);

106 
	}
}

108 
	gM©roskaFeS”v”Demux
::~
	$M©roskaFeS”v”Demux
() {

109 
Medium
::
	`şo£
(
fOurM©roskaFe
);

110 
	}
}

112 
	gM©roskaFeS”v”Demux
::
	$ÚM©roskaFeC»©iÚ
(
M©roskaFe
* 
ÃwFe
, * 
ş›ÁD©a
) {

113 ((
M©roskaFeS”v”Demux
*)
ş›ÁD©a
)->
	`ÚM©roskaFeC»©iÚ
(
ÃwFe
);

114 
	}
}

116 
	gM©roskaFeS”v”Demux
::
	$ÚM©roskaFeC»©iÚ
(
M©roskaFe
* 
ÃwFe
) {

117 
fOurM©roskaFe
 = 
ÃwFe
;

120 ià(
fOnC»©iÚ
 !ğ
NULL
è(*fOnC»©iÚ)(
this
, 
fOnC»©iÚCl›ÁD©a
);

121 
	}
}

	@liveMedia/MatroskaFileServerMediaSubsession.cpp

22 
	~"M©roskaFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"M©roskaDemuxedT¿ck.hh
"

24 
	~"F¿medF‹r.hh
"

26 
M©roskaFeS”v”MedŸSub£ssiÚ
* 
	gM©roskaFeS”v”MedŸSub£ssiÚ


27 ::
	$ü—‹New
(
M©roskaFeS”v”Demux
& 
demux
, 
M©roskaT¿ck
* 
Œack
) {

28  
Ãw
 
	`M©roskaFeS”v”MedŸSub£ssiÚ
(
demux
, 
Œack
);

29 
	}
}

31 
	gM©roskaFeS”v”MedŸSub£ssiÚ


32 ::
	$M©roskaFeS”v”MedŸSub£ssiÚ
(
M©roskaFeS”v”Demux
& 
demux
, 
M©roskaT¿ck
* 
Œack
)

33 : 
	`FeS”v”MedŸSub£ssiÚ
(
demux
.
	`’vœ
(), demux.
	`feName
(), 
F®£
),

34 
	`fOurDemux
(
demux
), 
	`fT¿ck
(
Œack
), 
	$fNumF‹rsInFrÚtOfT¿ck
(0) {

35 
	}
}

37 
	gM©roskaFeS”v”MedŸSub£ssiÚ
::~
	$M©roskaFeS”v”MedŸSub£ssiÚ
() {

38 
	}
}

40 
M©roskaFeS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
(ècÚ¡ {  
fOurDemux
.
	`feDu¿tiÚ
(); 
	}
}

42 
	gM©roskaFeS”v”MedŸSub£ssiÚ


43 ::
	$£ekSŒ—mSourû
(
F¿medSourû
* 
šputSourû
, & 
£ekNPT
, , 
u_št64_t
& ) {

44 
i
 = 0; i < 
fNumF‹rsInFrÚtOfT¿ck
; ++i) {

46 
šputSourû
 = ((
F¿medF‹r
*)šputSourû)->
	`šputSourû
();

48 ((
M©roskaDemuxedT¿ck
*)
šputSourû
)->
	`£ekToTime
(
£ekNPT
);

49 
	}
}

51 
F¿medSourû
* 
	gM©roskaFeS”v”MedŸSub£ssiÚ


52 ::
	$ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, & 
e¡B™¿‹
) {

53 
F¿medSourû
* 
ba£Sourû
 = 
fOurDemux
.
	`ÃwDemuxedT¿ck
(
ş›ÁSessiÚId
, 
fT¿ck
->
ŒackNumb”
);

54 ià(
ba£Sourû
 =ğ
NULL
)  NULL;

56  
fOurDemux
.
	`ourM©roskaFe
()

57 ->
	`ü—‹SourûFÜSŒ—mšg
(
ba£Sourû
, 
fT¿ck
->
ŒackNumb”
,

58 
e¡B™¿‹
, 
fNumF‹rsInFrÚtOfT¿ck
);

59 
	}
}

61 
RTPSšk
* 
	gM©roskaFeS”v”MedŸSub£ssiÚ


62 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
, 
F¿medSourû
* ) {

63  
fOurDemux
.
	`ourM©roskaFe
()

64 ->
	`ü—‹RTPSškFÜT¿ckNumb”
(
fT¿ck
->
ŒackNumb”
, 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

65 
	}
}

	@liveMedia/Media.cpp

21 
	~"MedŸ.hh
"

22 
	~"HashTabË.hh
"

26 
	gMedium
::
	$Medium
(
U§geEnvœÚm’t
& 
’v
)

27 : 
	`fEnvœÚ
(
’v
), 
	$fNextTask
(
NULL
) {

29 
MedŸLookupTabË
::
	`ourMedŸ
(
’v
)->
	`g’”©eNewName
(
fMediumName
, 
mediumNameMaxL’
);

30 
’v
.
	`£tResuÉMsg
(
fMediumName
);

33 
MedŸLookupTabË
::
	`ourMedŸ
(
’v
)->
	`addNew
(
this
, 
fMediumName
);

34 
	}
}

36 
	gMedium
::~
	$Medium
() {

38 
fEnvœÚ
.
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fNextTask
);

39 
	}
}

41 
BoŞ—n
 
	gMedium
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
mediumName
,

42 
Medium
*& 
»suÉMedium
) {

43 
»suÉMedium
 = 
MedŸLookupTabË
::
	`ourMedŸ
(
’v
)->
	`lookup
(
mediumName
);

44 ià(
»suÉMedium
 =ğ
NULL
) {

45 
’v
.
	`£tResuÉMsg
("Medium ", 
mediumName
, " does‚otƒxist");

46  
F®£
;

49  
True
;

50 
	}
}

52 
	gMedium
::
	$şo£
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
Çme
) {

53 
MedŸLookupTabË
::
	`ourMedŸ
(
’v
)->
	`»move
(
Çme
);

54 
	}
}

56 
	gMedium
::
	$şo£
(
Medium
* 
medium
) {

57 ià(
medium
 =ğ
NULL
) ;

59 
	`şo£
(
medium
->
	`’vœ
(), medium->
	`Çme
());

60 
	}
}

62 
BoŞ—n
 
	gMedium
::
	$isSourû
() const {

63  
F®£
;

64 
	}
}

66 
BoŞ—n
 
	gMedium
::
	$isSšk
() const {

67  
F®£
;

68 
	}
}

70 
BoŞ—n
 
	gMedium
::
	$isRTCPIn¡ªû
() const {

71  
F®£
;

72 
	}
}

74 
BoŞ—n
 
	gMedium
::
	$isRTSPCl›Á
() const {

75  
F®£
;

76 
	}
}

78 
BoŞ—n
 
	gMedium
::
	$isRTSPS”v”
() const {

79  
F®£
;

80 
	}
}

82 
BoŞ—n
 
	gMedium
::
	$isMedŸSessiÚ
() const {

83  
F®£
;

84 
	}
}

86 
BoŞ—n
 
	gMedium
::
	$isS”v”MedŸSessiÚ
() const {

87  
F®£
;

88 
	}
}

93 
_TabËs
* 
	g_TabËs
::
	$g‘OurTabËs
(
U§geEnvœÚm’t
& 
’v
, 
BoŞ—n
 
ü—‹IfNÙP»£Á
) {

94 ià(
’v
.
liveMedŸPriv
 =ğ
NULL
 && 
ü—‹IfNÙP»£Á
) {

95 
’v
.
liveMedŸPriv
 = 
Ãw
 
	`_TabËs
(env);

97  (
_TabËs
*)(
’v
.
liveMedŸPriv
);

98 
	}
}

100 
	g_TabËs
::
	$»şaimIfPossibË
() {

101 ià(
medŸTabË
 =ğ
NULL
 && 
sock‘TabË
 == NULL) {

102 
fEnv
.
liveMedŸPriv
 = 
NULL
;

103 
d–‘e
 
this
;

105 
	}
}

107 
	g_TabËs
::
	$_TabËs
(
U§geEnvœÚm’t
& 
’v
)

108 : 
	`medŸTabË
(
NULL
), 
	`sock‘TabË
(NULL), 
	$fEnv
(
’v
) {

109 
	}
}

111 
	g_TabËs
::~
	$_TabËs
() {

112 
	}
}

117 
MedŸLookupTabË
* MedŸLookupTabË::
	$ourMedŸ
(
U§geEnvœÚm’t
& 
’v
) {

118 
_TabËs
* 
ourTabËs
 = _TabËs::
	`g‘OurTabËs
(
’v
);

119 ià(
ourTabËs
->
medŸTabË
 =ğ
NULL
) {

122 
ourTabËs
->
medŸTabË
 = 
Ãw
 
	`MedŸLookupTabË
(
’v
);

124  
ourTabËs
->
medŸTabË
;

125 
	}
}

127 
Medium
* 
	gMedŸLookupTabË
::
	$lookup
(cÚ¡* 
Çme
) const {

128  (
Medium
*)(
fTabË
->
	`Lookup
(
Çme
));

129 
	}
}

131 
	gMedŸLookupTabË
::
	$addNew
(
Medium
* 
medium
, * 
mediumName
) {

132 
fTabË
->
	`Add
(
mediumName
, (*)
medium
);

133 
	}
}

135 
	gMedŸLookupTabË
::
	$»move
(cÚ¡* 
Çme
) {

136 
Medium
* 
medium
 = 
	`lookup
(
Çme
);

137 ià(
medium
 !ğ
NULL
) {

138 
fTabË
->
	`Remove
(
Çme
);

139 ià(
fTabË
->
	`IsEm±y
()) {

141 
_TabËs
* 
ourTabËs
 = _TabËs::
	`g‘OurTabËs
(
fEnv
);

142 
d–‘e
 
this
;

143 
ourTabËs
->
medŸTabË
 = 
NULL
;

144 
ourTabËs
->
	`»şaimIfPossibË
();

147 
d–‘e
 
medium
;

149 
	}
}

151 
	gMedŸLookupTabË
::
	$g’”©eNewName
(* 
mediumName
,

154 
	`¥rštf
(
mediumName
, "liveMedŸ%d", 
fNameG’”©Ü
++);

155 
	}
}

157 
	gMedŸLookupTabË
::
	$MedŸLookupTabË
(
U§geEnvœÚm’t
& 
’v
)

158 : 
	`fEnv
(
’v
), 
	`fTabË
(
HashTabË
::
	`ü—‹
(
STRING_HASH_KEYS
)), 
	$fNameG’”©Ü
(0) {

159 
	}
}

161 
	gMedŸLookupTabË
::~
	$MedŸLookupTabË
() {

162 
d–‘e
 
fTabË
;

163 
	}
}

	@liveMedia/MediaSession.cpp

22 
	~"liveMedŸ.hh
"

23 
	~"LoÿË.hh
"

24 
	~"GroupsockH–³r.hh
"

25 
	~<ùy³.h
>

29 
MedŸSessiÚ
* 
	gMedŸSessiÚ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

30 cÚ¡* 
sdpDesütiÚ
) {

31 
MedŸSessiÚ
* 
ÃwSessiÚ
 = 
Ãw
 
	`MedŸSessiÚ
(
’v
);

32 ià(
ÃwSessiÚ
 !ğ
NULL
) {

33 ià(!
ÃwSessiÚ
->
	`š™ŸlizeW™hSDP
(
sdpDesütiÚ
)) {

34 
d–‘e
 
ÃwSessiÚ
;

35  
NULL
;

39  
ÃwSessiÚ
;

40 
	}
}

42 
BoŞ—n
 
	gMedŸSessiÚ
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
,

43 cÚ¡* 
š¡ªûName
,

44 
MedŸSessiÚ
*& 
»suÉSessiÚ
) {

45 
»suÉSessiÚ
 = 
NULL
;

47 
Medium
* 
medium
;

48 ià(!
Medium
::
	`lookupByName
(
’v
, 
š¡ªûName
, 
medium
)è 
F®£
;

50 ià(!
medium
->
	`isMedŸSessiÚ
()) {

51 
’v
.
	`£tResuÉMsg
(
š¡ªûName
, " is‚ot‡ 'MediaSession' object");

52  
F®£
;

55 
»suÉSessiÚ
 = (
MedŸSessiÚ
*)
medium
;

56  
True
;

57 
	}
}

59 
	gMedŸSessiÚ
::
	$MedŸSessiÚ
(
U§geEnvœÚm’t
& 
’v
)

60 : 
	`Medium
(
’v
),

61 
	`fSub£ssiÚsH—d
(
NULL
), 
	`fSub£ssiÚsTa
(NULL),

62 
	`fCÚÃùiÚEndpoštName
(
NULL
),

63 
	`fMaxPÏyS¹Time
(0.0f), 
	`fMaxPÏyEndTime
(0.0f), 
	`fAbsS¹Time
(
NULL
), 
	`fAbsEndTime
(NULL),

64 
	`fSÿË
(1.0f), 
	`fS³ed
(1.0f),

65 
	`fMedŸSessiÚTy³
(
NULL
), 
	`fSessiÚName
(NULL), 
	`fSessiÚDesütiÚ
(NULL), 
	$fCÚŒŞP©h
(
NULL
) {

66 
fSourûF‹rAddr
.
s_addr
 = 0;

69 cÚ¡ 
maxCNAMEËn
 = 100;

70 
CNAME
[
maxCNAMEËn
+1];

71 #iâdeà
CRIS


72 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

75 
	`¥rštf
(
CNAME
, "unknowÀho¡ %d", ()(
	`our_¿ndom
()*0x7FFFFFFF));

77 
CNAME
[
maxCNAMEËn
] = '\0';

78 
fCNAME
 = 
	`¡rDup
(
CNAME
);

79 
	}
}

81 
	gMedŸSessiÚ
::~
	$MedŸSessiÚ
() {

82 
d–‘e
 
fSub£ssiÚsH—d
;

83 
d–‘e
[] 
fCNAME
;

84 
d–‘e
[] 
fCÚÃùiÚEndpoštName
;

85 
d–‘e
[] 
fAbsS¹Time
; d–‘e[] 
fAbsEndTime
;

86 
d–‘e
[] 
fMedŸSessiÚTy³
;

87 
d–‘e
[] 
fSessiÚName
;

88 
d–‘e
[] 
fSessiÚDesütiÚ
;

89 
d–‘e
[] 
fCÚŒŞP©h
;

90 
	}
}

92 
BoŞ—n
 
	gMedŸSessiÚ
::
	$isMedŸSessiÚ
() const {

93  
True
;

94 
	}
}

96 
MedŸSub£ssiÚ
* 
	gMedŸSessiÚ
::
	$ü—‹NewMedŸSub£ssiÚ
() {

98  
Ãw
 
	`MedŸSub£ssiÚ
(*
this
);

99 
	}
}

101 
BoŞ—n
 
	gMedŸSessiÚ
::
	$š™ŸlizeW™hSDP
(cÚ¡* 
sdpDesütiÚ
) {

102 ià(
sdpDesütiÚ
 =ğ
NULL
è 
F®£
;

105 cÚ¡* 
sdpLše
 = 
sdpDesütiÚ
;

106 cÚ¡* 
ÃxtSDPLše
;

108 ià(!
	`·r£SDPLše
(
sdpLše
, 
ÃxtSDPLše
)è 
F®£
;

110 ià(
sdpLše
[0] == 'm') ;

111 
sdpLše
 = 
ÃxtSDPLše
;

112 ià(
sdpLše
 =ğ
NULL
) ;

115 ià(
	`·r£SDPLše_s
(
sdpLše
)) ;

116 ià(
	`·r£SDPLše_i
(
sdpLše
)) ;

117 ià(
	`·r£SDPLše_c
(
sdpLše
)) ;

118 ià(
	`·r£SDPA‰ribu‹_cÚŒŞ
(
sdpLše
)) ;

119 ià(
	`·r£SDPA‰ribu‹_¿nge
(
sdpLše
)) ;

120 ià(
	`·r£SDPA‰ribu‹_ty³
(
sdpLše
)) ;

121 ià(
	`·r£SDPA‰ribu‹_sourû_f‹r
(
sdpLše
)) ;

124 
sdpLše
 !ğ
NULL
) {

126 
MedŸSub£ssiÚ
* 
sub£ssiÚ
 = 
	`ü—‹NewMedŸSub£ssiÚ
();

127 ià(
sub£ssiÚ
 =ğ
NULL
) {

128 
	`’vœ
().
	`£tResuÉMsg
("Unableo create‚ew MediaSubsession");

129  
F®£
;

135 * 
mediumName
 = 
	`¡rDupSize
(
sdpLše
);

136 cÚ¡* 
´ÙocŞName
 = 
NULL
;

137 
·ylßdFÜm©
;

138 ià((
	`ssÿnf
(
sdpLše
, "m=%s %hu RTP/AVP %u",

139 
mediumName
, &
sub£ssiÚ
->
fCl›ÁPÜtNum
, &
·ylßdFÜm©
) == 3 ||

140 
	`ssÿnf
(
sdpLše
, "m=%s %hu/%*u RTP/AVP %u",

141 
mediumName
, &
sub£ssiÚ
->
fCl›ÁPÜtNum
, &
·ylßdFÜm©
) == 3)

142 && 
·ylßdFÜm©
 <= 127) {

143 
´ÙocŞName
 = "RTP";

144 } ià((
	`ssÿnf
(
sdpLše
, "m=%s %hu UDP %u",

145 
mediumName
, &
sub£ssiÚ
->
fCl›ÁPÜtNum
, &
·ylßdFÜm©
) == 3 ||

146 
	`ssÿnf
(
sdpLše
, "m=%s %hu udp %u",

147 
mediumName
, &
sub£ssiÚ
->
fCl›ÁPÜtNum
, &
·ylßdFÜm©
) == 3 ||

148 
	`ssÿnf
(
sdpLše
, "m=%s %hu RAW/RAW/UDP %u",

149 
mediumName
, &
sub£ssiÚ
->
fCl›ÁPÜtNum
, &
·ylßdFÜm©
) == 3)

150 && 
·ylßdFÜm©
 <= 127) {

152 
´ÙocŞName
 = "UDP";

155 * 
sdpLšeSŒ
;

156 ià(
ÃxtSDPLše
 =ğ
NULL
) {

157 
sdpLšeSŒ
 = (*)
sdpLše
;

159 
sdpLšeSŒ
 = 
	`¡rDup
(
sdpLše
);

160 
sdpLšeSŒ
[
ÃxtSDPLše
-
sdpLše
] = '\0';

162 
	`’vœ
(è<< "Bad SDP \"m=\"†še: " << 
sdpLšeSŒ
 << "\n";

163 ià(
sdpLšeSŒ
 !ğ(*)
sdpLše
è
d–‘e
[] sdpLineStr;

165 
d–‘e
[] 
mediumName
;

166 
d–‘e
 
sub£ssiÚ
;

170 
sdpLše
 = 
ÃxtSDPLše
;

171 ià(
sdpLše
 =ğ
NULL
) ;

172 ià(!
	`·r£SDPLše
(
sdpLše
, 
ÃxtSDPLše
)è 
F®£
;

174 ià(
sdpLše
[0] == 'm') ;

180 ià(
fSub£ssiÚsTa
 =ğ
NULL
) {

181 
fSub£ssiÚsH—d
 = 
fSub£ssiÚsTa
 = 
sub£ssiÚ
;

183 
fSub£ssiÚsTa
->
	`£tNext
(
sub£ssiÚ
);

184 
fSub£ssiÚsTa
 = 
sub£ssiÚ
;

187 
sub£ssiÚ
->
£rv”PÜtNum
 = sub£ssiÚ->
fCl›ÁPÜtNum
;

189 cÚ¡* 
mS¹
 = 
sdpLše
;

190 
sub£ssiÚ
->
fSavedSDPLšes
 = 
	`¡rDup
(
mS¹
);

192 
sub£ssiÚ
->
fMediumName
 = 
	`¡rDup
(
mediumName
);

193 
d–‘e
[] 
mediumName
;

194 
sub£ssiÚ
->
fPrÙocŞName
 = 
	`¡rDup
(
´ÙocŞName
);

195 
sub£ssiÚ
->
fRTPPaylßdFÜm©
 = 
·ylßdFÜm©
;

199 
sdpLše
 = 
ÃxtSDPLše
;

200 ià(
sdpLše
 =ğ
NULL
) ;

201 ià(!
	`·r£SDPLše
(
sdpLše
, 
ÃxtSDPLše
)è 
F®£
;

203 ià(
sdpLše
[0] == 'm') ;

206 ià(
sub£ssiÚ
->
	`·r£SDPLše_c
(
sdpLše
)) ;

207 ià(
sub£ssiÚ
->
	`·r£SDPLše_b
(
sdpLše
)) ;

208 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_¹pm­
(
sdpLše
)) ;

209 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_¹ımux
(
sdpLše
)) ;

210 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_cÚŒŞ
(
sdpLše
)) ;

211 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_¿nge
(
sdpLše
)) ;

212 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_fm
(
sdpLše
)) ;

213 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_sourû_f‹r
(
sdpLše
)) ;

214 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_x_dim’siÚs
(
sdpLše
)) ;

215 ià(
sub£ssiÚ
->
	`·r£SDPA‰ribu‹_äam”©e
(
sdpLše
)) ;

219 ià(
sdpLše
 !ğ
NULL
è
sub£ssiÚ
->
fSavedSDPLšes
[sdpLše-
mS¹
] = '\0';

223 ià(
sub£ssiÚ
->
fCodecName
 =ğ
NULL
) {

224 
sub£ssiÚ
->
fCodecName


225 ğ
	`lookupPaylßdFÜm©
(
sub£ssiÚ
->
fRTPPaylßdFÜm©
,

226 
sub£ssiÚ
->
fRTPTime¡ampF»qu’cy
,

227 
sub£ssiÚ
->
fNumChªÃls
);

228 ià(
sub£ssiÚ
->
fCodecName
 =ğ
NULL
) {

229 
ty³SŒ
[20];

230 
	`¥rštf
(
ty³SŒ
, "%d", 
sub£ssiÚ
->
fRTPPaylßdFÜm©
);

231 
	`’vœ
().
	`£tResuÉMsg
("Unknown codec‚ame for RTP…ayloadype ",

232 
ty³SŒ
);

233  
F®£
;

241 ià(
sub£ssiÚ
->
fRTPTime¡ampF»qu’cy
 == 0) {

242 
sub£ssiÚ
->
fRTPTime¡ampF»qu’cy


243 ğ
	`guessRTPTime¡ampF»qu’cy
(
sub£ssiÚ
->
fMediumName
,

244 
sub£ssiÚ
->
fCodecName
);

248  
True
;

249 
	}
}

251 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPLše
(cÚ¡* 
šputLše
,

252 cÚ¡*& 
ÃxtLše
){

254 
ÃxtLše
 = 
NULL
;

255 cÚ¡* 
±r
 = 
šputLše
; *ptr != '\0'; ++ptr) {

256 ià(*
±r
 == '\r' || *ptr == '\n') {

258 ++
±r
;

259 *
±r
 == '\r' || *ptr == '\n') ++ptr;

260 
ÃxtLše
 = 
±r
;

261 ià(
ÃxtLše
[0] =ğ'\0'èÃxtLšğ
NULL
;

268 ià(
šputLše
[0] =ğ'\r' || iÅutLše[0] =ğ'\n'è 
True
;

269 ià(
	`¡¾’
(
šputLše
) < 2 || inputLine[1] != '='

270 || 
šputLše
[0] < 'a' || inputLine[0] > 'z') {

271 
	`’vœ
().
	`£tResuÉMsg
("Inv®id SDP†še: ", 
šputLše
);

272  
F®£
;

275  
True
;

276 
	}
}

278 * 
	$·r£CLše
(cÚ¡* 
sdpLše
) {

279 * 
»suÉSŒ
 = 
NULL
;

280 * 
bufãr
 = 
	`¡rDupSize
(
sdpLše
);

281 ià(
	`ssÿnf
(
sdpLše
, "c=IN IP4 %[^/\r\n]", 
bufãr
) == 1) {

283 
»suÉSŒ
 = 
	`¡rDup
(
bufãr
);

285 
d–‘e
[] 
bufãr
;

287  
»suÉSŒ
;

288 
	}
}

290 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPLše_s
(cÚ¡* 
sdpLše
) {

292 * 
bufãr
 = 
	`¡rDupSize
(
sdpLše
);

293 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

295 ià(
	`ssÿnf
(
sdpLše
, "s=%[^\r\n]", 
bufãr
) == 1) {

296 
d–‘e
[] 
fSessiÚName
; fSessiÚNamğ
	`¡rDup
(
bufãr
);

297 
·r£Sucûss
 = 
True
;

299 
d–‘e
[] 
bufãr
;

301  
·r£Sucûss
;

302 
	}
}

304 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPLše_i
(cÚ¡* 
sdpLše
) {

306 * 
bufãr
 = 
	`¡rDupSize
(
sdpLše
);

307 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

309 ià(
	`ssÿnf
(
sdpLše
, "i=%[^\r\n]", 
bufãr
) == 1) {

310 
d–‘e
[] 
fSessiÚDesütiÚ
; fSessiÚDesütiÚ = 
	`¡rDup
(
bufãr
);

311 
·r£Sucûss
 = 
True
;

313 
d–‘e
[] 
bufãr
;

315  
·r£Sucûss
;

316 
	}
}

318 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPLše_c
(cÚ¡* 
sdpLše
) {

322 * 
cÚÃùiÚEndpoštName
 = 
	`·r£CLše
(
sdpLše
);

323 ià(
cÚÃùiÚEndpoštName
 !ğ
NULL
) {

324 
d–‘e
[] 
fCÚÃùiÚEndpoštName
;

325 
fCÚÃùiÚEndpoštName
 = 
cÚÃùiÚEndpoštName
;

326  
True
;

329  
F®£
;

330 
	}
}

332 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPA‰ribu‹_ty³
(cÚ¡* 
sdpLše
) {

334 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

336 * 
bufãr
 = 
	`¡rDupSize
(
sdpLše
);

337 ià(
	`ssÿnf
(
sdpLše
, "añy³: %[^ ]", 
bufãr
) == 1) {

338 
d–‘e
[] 
fMedŸSessiÚTy³
;

339 
fMedŸSessiÚTy³
 = 
	`¡rDup
(
bufãr
);

340 
·r£Sucûss
 = 
True
;

342 
d–‘e
[] 
bufãr
;

344  
·r£Sucûss
;

345 
	}
}

347 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPA‰ribu‹_cÚŒŞ
(cÚ¡* 
sdpLše
) {

349 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

351 * 
cÚŒŞP©h
 = 
	`¡rDupSize
(
sdpLše
);

352 ià(
	`ssÿnf
(
sdpLše
, "a=cÚŒŞ: %s", 
cÚŒŞP©h
) == 1) {

353 
·r£Sucûss
 = 
True
;

354 
d–‘e
[] 
fCÚŒŞP©h
; fCÚŒŞP©h = 
	`¡rDup
(
cÚŒŞP©h
);

356 
d–‘e
[] 
cÚŒŞP©h
;

358  
·r£Sucûss
;

359 
	}
}

361 
BoŞ—n
 
	$·r£RªgeA‰ribu‹
(cÚ¡* 
sdpLše
, & 
¡¬tTime
, & 
’dTime
) {

362  
	`ssÿnf
(
sdpLše
, "aôªge:‚± = %lg - %lg", &
¡¬tTime
, &
’dTime
) == 2;

363 
	}
}

365 
BoŞ—n
 
	$·r£RªgeA‰ribu‹
(cÚ¡* 
sdpLše
, *& 
absS¹Time
, *& 
absEndTime
) {

366 
size_t
 
Ën
 = 
	`¡¾’
(
sdpLše
) + 1;

367 * 
as
 = 
Ãw
 [
Ën
];

368 * 
«
 = 
Ãw
 [
Ën
];

369 
ssÿnfResuÉ
 = 
	`ssÿnf
(
sdpLše
, "aôªge: clock = %[^-\r\n]-%[^\r\n]", 
as
, 
«
);

370 ià(
ssÿnfResuÉ
 == 2) {

371 
absS¹Time
 = 
as
;

372 
absEndTime
 = 
«
;

373 } ià(
ssÿnfResuÉ
 == 1) {

374 
absS¹Time
 = 
as
;

375 
d–‘e
[] 
«
;

377 
d–‘e
[] 
as
; d–‘e[] 
«
;

378  
F®£
;

381  
True
;

382 
	}
}

384 
BoŞ—n
 
	gMedŸSessiÚ
::
	$·r£SDPA‰ribu‹_¿nge
(cÚ¡* 
sdpLše
) {

387 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

389 
¶ayS¹Time
;

390 
¶ayEndTime
;

391 ià(
	`·r£RªgeA‰ribu‹
(
sdpLše
, 
¶ayS¹Time
, 
¶ayEndTime
)) {

392 
·r£Sucûss
 = 
True
;

393 ià(
¶ayS¹Time
 > 
fMaxPÏyS¹Time
) {

394 
fMaxPÏyS¹Time
 = 
¶ayS¹Time
;

396 ià(
¶ayEndTime
 > 
fMaxPÏyEndTime
) {

397 
fMaxPÏyEndTime
 = 
¶ayEndTime
;

399 } ià(
	`·r£RªgeA‰ribu‹
(
sdpLše
, 
	`_absS¹Time
(), 
	`_absEndTime
())) {

400 
·r£Sucûss
 = 
True
;

403  
·r£Sucûss
;

404 
	}
}

406 
BoŞ—n
 
	$·r£SourûF‹rA‰ribu‹
(cÚ¡* 
sdpLše
,

407 
š_addr
& 
sourûAddr
) {

412 
BoŞ—n
 
»suÉ
 = 
F®£
;

413 * 
sourûName
 = 
	`¡rDupSize
(
sdpLše
);

415 ià(
	`ssÿnf
(
sdpLše
, "a=source-filter: incl IN IP4 %*s %s",

416 
sourûName
) != 1) ;

419 
N‘Add»ssLi¡
 
	`add»s£s
(
sourûName
);

420 ià(
add»s£s
.
	`numAdd»s£s
() == 0) ;

422 
ÃtAdd»ssB™s
 
sourûAddrB™s


423 ğ*(
ÃtAdd»ssB™s
*)(
add»s£s
.
	`fœ¡Add»ss
()->
	`d©a
());

424 ià(
sourûAddrB™s
 == 0) ;

426 
sourûAddr
.
s_addr
 = 
sourûAddrB™s
;

427 
»suÉ
 = 
True
;

430 
d–‘e
[] 
sourûName
;

431  
»suÉ
;

432 
	}
}

434 
BoŞ—n
 
	gMedŸSessiÚ


435 ::
	$·r£SDPA‰ribu‹_sourû_f‹r
(cÚ¡* 
sdpLše
) {

436  
	`·r£SourûF‹rA‰ribu‹
(
sdpLše
, 
fSourûF‹rAddr
);

437 
	}
}

439 * 
	gMedŸSessiÚ
::
	$lookupPaylßdFÜm©
(
¹pPaylßdTy³
,

440 & 
äeq
, & 
nCh
) {

443 cÚ¡* 
‹mp
 = 
NULL
;

444 
¹pPaylßdTy³
) {

445 0: {
‹mp
 = "PCMU"; 
äeq
 = 8000; 
nCh
 = 1; ;}

446 2: {
‹mp
 = "G726-32"; 
äeq
 = 8000; 
nCh
 = 1; ;}

447 3: {
‹mp
 = "GSM"; 
äeq
 = 8000; 
nCh
 = 1; ;}

448 4: {
‹mp
 = "G723"; 
äeq
 = 8000; 
nCh
 = 1; ;}

449 5: {
‹mp
 = "DVI4"; 
äeq
 = 8000; 
nCh
 = 1; ;}

450 6: {
‹mp
 = "DVI4"; 
äeq
 = 16000; 
nCh
 = 1; ;}

451 7: {
‹mp
 = "LPC"; 
äeq
 = 8000; 
nCh
 = 1; ;}

452 8: {
‹mp
 = "PCMA"; 
äeq
 = 8000; 
nCh
 = 1; ;}

453 9: {
‹mp
 = "G722"; 
äeq
 = 8000; 
nCh
 = 1; ;}

454 10: {
‹mp
 = "L16"; 
äeq
 = 44100; 
nCh
 = 2; ;}

455 11: {
‹mp
 = "L16"; 
äeq
 = 44100; 
nCh
 = 1; ;}

456 12: {
‹mp
 = "QCELP"; 
äeq
 = 8000; 
nCh
 = 1; ;}

457 14: {
‹mp
 = "MPA"; 
äeq
 = 90000; 
nCh
 = 1; ;}

459 15: {
‹mp
 = "G728"; 
äeq
 = 8000; 
nCh
 = 1; ;}

460 16: {
‹mp
 = "DVI4"; 
äeq
 = 11025; 
nCh
 = 1; ;}

461 17: {
‹mp
 = "DVI4"; 
äeq
 = 22050; 
nCh
 = 1; ;}

462 18: {
‹mp
 = "G729"; 
äeq
 = 8000; 
nCh
 = 1; ;}

463 25: {
‹mp
 = "CELB"; 
äeq
 = 90000; 
nCh
 = 1; ;}

464 26: {
‹mp
 = "JPEG"; 
äeq
 = 90000; 
nCh
 = 1; ;}

465 28: {
‹mp
 = "NV"; 
äeq
 = 90000; 
nCh
 = 1; ;}

466 31: {
‹mp
 = "H261"; 
äeq
 = 90000; 
nCh
 = 1; ;}

467 32: {
‹mp
 = "MPV"; 
äeq
 = 90000; 
nCh
 = 1; ;}

468 33: {
‹mp
 = "MP2T"; 
äeq
 = 90000; 
nCh
 = 1; ;}

469 34: {
‹mp
 = "H263"; 
äeq
 = 90000; 
nCh
 = 1; ;}

472  
	`¡rDup
(
‹mp
);

473 
	}
}

475 
	gMedŸSessiÚ
::
	$guessRTPTime¡ampF»qu’cy
(cÚ¡* 
mediumName
,

476 cÚ¡* 
codecName
) {

482 ià(
	`¡rcmp
(
codecName
, "L16") == 0)  44100;

483 ià(
	`¡rcmp
(
codecName
, "MPA") == 0

484 || 
	`¡rcmp
(
codecName
, "MPA-ROBUST") == 0

485 || 
	`¡rcmp
(
codecName
, "X-MP3-DRAFT-00") == 0)  90000;

488 ià(
	`¡rcmp
(
mediumName
, "video") == 0)  90000;

489 ià(
	`¡rcmp
(
mediumName
, "text") == 0)  1000;

491 
	}
}

493 * 
	gMedŸSessiÚ
::
	$absS¹Time
() const {

494 ià(
fAbsS¹Time
 !ğ
NULL
)  fAbsStartTime;

497 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
this
);

498 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

499 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

500 ià(
sub£ssiÚ
->
	`_absS¹Time
(è!ğ
NULL
)  subsession->_absStartTime();

502  
NULL
;

503 
	}
}

505 * 
	gMedŸSessiÚ
::
	$absEndTime
() const {

506 ià(
fAbsEndTime
 !ğ
NULL
)  fAbsEndTime;

509 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
this
);

510 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

511 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

512 ià(
sub£ssiÚ
->
	`_absEndTime
(è!ğ
NULL
)  subsession->_absEndTime();

514  
NULL
;

515 
	}
}

517 
BoŞ—n
 
	gMedŸSessiÚ


518 ::
	$š™Ÿ‹ByMedŸTy³
(cÚ¡* 
mimeTy³
,

519 
MedŸSub£ssiÚ
*& 
»suÉSub£ssiÚ
,

520 
u£S³cŸlRTPoff£t
) {

522 
»suÉSub£ssiÚ
 = 
NULL
;

523 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
this
);

524 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

525 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

526 
BoŞ—n
 
wasAÌ—dyIn™Ÿ‹d
 = 
sub£ssiÚ
->
	`»adSourû
(è!ğ
NULL
;

527 ià(!
wasAÌ—dyIn™Ÿ‹d
) {

529 ià(!
sub£ssiÚ
->
	`š™Ÿ‹
(
u£S³cŸlRTPoff£t
)è 
F®£
;

533 ià(
	`¡rcmp
(
sub£ssiÚ
->
	`»adSourû
()->
	`MIMEty³
(), 
mimeTy³
) != 0) {

534 ià(!
wasAÌ—dyIn™Ÿ‹d
è
sub£ssiÚ
->
	`deIn™Ÿ‹
();

538 
»suÉSub£ssiÚ
 = 
sub£ssiÚ
;

542 ià(
»suÉSub£ssiÚ
 =ğ
NULL
) {

543 
	`’vœ
().
	`£tResuÉMsg
("Session has‚o usable media subsession");

544  
F®£
;

547  
True
;

548 
	}
}

553 
	gMedŸSub£ssiÚI‹¿tÜ
::
	$MedŸSub£ssiÚI‹¿tÜ
(
MedŸSessiÚ
 cÚ¡& 
£ssiÚ
)

554 : 
	$fOurSessiÚ
(
£ssiÚ
) {

555 
	`»£t
();

556 
	}
}

558 
	gMedŸSub£ssiÚI‹¿tÜ
::~
	$MedŸSub£ssiÚI‹¿tÜ
() {

559 
	}
}

561 
MedŸSub£ssiÚ
* 
MedŸSub£ssiÚI‹¿tÜ
::
	$Ãxt
() {

562 
MedŸSub£ssiÚ
* 
»suÉ
 = 
fNextPŒ
;

564 ià(
fNextPŒ
 !ğ
NULL
èfNextPŒ = fNextPŒ->
fNext
;

566  
»suÉ
;

567 
	}
}

569 
	gMedŸSub£ssiÚI‹¿tÜ
::
	$»£t
() {

570 
fNextPŒ
 = 
fOurSessiÚ
.
fSub£ssiÚsH—d
;

571 
	}
}

576 şas 
	cSDPA‰ribu‹
 {

577 
	mpublic
:

578 
SDPA‰ribu‹
(cÚ¡* 
¡rV®ue
, 
BoŞ—n
 
v®ueIsHexadecim®
);

579 
	mvœtu®
 ~
SDPA‰ribu‹
();

581 cÚ¡* 
	$¡rV®ue
(ècÚ¡ {  
fSŒV®ue
; }

582 cÚ¡* 
	$¡rV®ueToLow”
(ècÚ¡ {  
fSŒV®ueToLow”
; 
	}
}

583 
	$štV®ue
(ècÚ¡ {  
fIÁV®ue
; 
	}
}

584 
BoŞ—n
 
	$v®ueIsHexadecim®
(ècÚ¡ {  
fV®ueIsHexadecim®
; 
	}
}

586 
	g´iv©e
:

587 * 
fSŒV®ue
;

588 * 
	gfSŒV®ueToLow”
;

589 
	gfIÁV®ue
;

590 
BoŞ—n
 
	gfV®ueIsHexadecim®
;

596 
	gMedŸSub£ssiÚ
::
	$MedŸSub£ssiÚ
(
MedŸSessiÚ
& 
·»Á
)

597 : 
	`£rv”PÜtNum
(0), 
	`sšk
(
NULL
), 
	`miscPŒ
(NULL),

598 
	`fP¬’t
(
·»Á
), 
	`fNext
(
NULL
),

599 
	`fCÚÃùiÚEndpoštName
(
NULL
),

600 
	`fCl›ÁPÜtNum
(0), 
	`fRTPPaylßdFÜm©
(0xFF),

601 
	`fSavedSDPLšes
(
NULL
), 
	`fMediumName
(NULL), 
	`fCodecName
(NULL), 
	`fPrÙocŞName
(NULL),

602 
	`fRTPTime¡ampF»qu’cy
(0), 
	`fMuÉËxRTCPW™hRTP
(
F®£
), 
	`fCÚŒŞP©h
(
NULL
),

603 
	`fSourûF‹rAddr
(
·»Á
.
	`sourûF‹rAddr
()), 
	`fBªdwidth
(0),

604 
	`fPÏyS¹Time
(0.0), 
	`fPÏyEndTime
(0.0), 
	`fAbsS¹Time
(
NULL
), 
	`fAbsEndTime
(NULL),

605 
	`fVideoWidth
(0), 
	`fVideoHeight
(0), 
	`fVideoFPS
(0), 
	`fNumChªÃls
(1), 
	`fSÿË
(1.0f), 
	`fNPT_PTS_Off£t
(0.0f),

606 
	`fA‰ribu‹TabË
(
HashTabË
::
	`ü—‹
(
STRING_HASH_KEYS
)),

607 
	`fRTPSock‘
(
NULL
), 
	`fRTCPSock‘
(NULL),

608 
	`fRTPSourû
(
NULL
), 
	`fRTCPIn¡ªû
(NULL), 
	`fR—dSourû
(NULL),

609 
	`fReûiveRawMP3ADUs
(
F®£
), 
	`fReûiveRawJPEGF¿mes
(False),

610 
	$fSessiÚId
(
NULL
) {

611 
¹pInfo
.
£qNum
 = 0;„Info.
time¡amp
 = 0;„Info.
šfoIsNew
 = 
F®£
;

614 
	`£tA‰ribu‹
("´ofe-Ëv–-id", "0", 
True
 );

617 
	`£tA‰ribu‹
("profile-id", "1");

618 
	`£tA‰ribu‹
("level-id", "93");

619 
	`£tA‰ribu‹
("interop-constraints", "B00000000000");

620 
	}
}

622 
	gMedŸSub£ssiÚ
::~
	$MedŸSub£ssiÚ
() {

623 
	`deIn™Ÿ‹
();

625 
d–‘e
[] 
fCÚÃùiÚEndpoštName
; d–‘e[] 
fSavedSDPLšes
;

626 
d–‘e
[] 
fMediumName
; d–‘e[] 
fCodecName
; d–‘e[] 
fPrÙocŞName
;

627 
d–‘e
[] 
fCÚŒŞP©h
;

628 
d–‘e
[] 
fAbsS¹Time
; d–‘e[] 
fAbsEndTime
;

629 
d–‘e
[] 
fSessiÚId
;

632 
SDPA‰ribu‹
* 
©Œ
;

633 (
©Œ
 = (
SDPA‰ribu‹
*)
fA‰ribu‹TabË
->
	`RemoveNext
()è!ğ
NULL
) {

634 
d–‘e
 
©Œ
;

636 
d–‘e
 
fA‰ribu‹TabË
;

638 
d–‘e
 
fNext
;

639 
	}
}

641 
	gMedŸSub£ssiÚ
::
	$addF‹r
(
F¿medF‹r
* 
f‹r
){

642 
fR—dSourû
 = 
f‹r
;

643 
	}
}

645 
	gMedŸSub£ssiÚ
::
	$¶ayS¹Time
() const {

646 ià(
fPÏyS¹Time
 > 0)  fPlayStartTime;

648  
fP¬’t
.
	`¶ayS¹Time
();

649 
	}
}

651 
	gMedŸSub£ssiÚ
::
	$¶ayEndTime
() const {

652 ià(
fPÏyEndTime
 > 0)  fPlayEndTime;

654  
fP¬’t
.
	`¶ayEndTime
();

655 
	}
}

657 * 
	gMedŸSub£ssiÚ
::
	$absS¹Time
() const {

658 ià(
fAbsS¹Time
 !ğ
NULL
)  fAbsStartTime;

660  
fP¬’t
.
	`absS¹Time
();

661 
	}
}

663 * 
	gMedŸSub£ssiÚ
::
	$absEndTime
() const {

664 ià(
fAbsEndTime
 !ğ
NULL
)  fAbsEndTime;

666  
fP¬’t
.
	`absEndTime
();

667 
	}
}

669 
BoŞ—n
 cÚ¡ 
	ghÚÜSDPPÜtChoiû


670 #ifdeà
IGNORE_UNICAST_SDP_PORTS


671 ğ
F®£
;

673 ğ
True
;

676 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$š™Ÿ‹
(
u£S³cŸlRTPoff£t
) {

677 ià(
fR—dSourû
 !ğ
NULL
è 
True
;

680 ià(
fCodecName
 =ğ
NULL
) {

681 
	`’v
().
	`£tResuÉMsg
("Codec is unspecified");

687 
š_addr
 
‹mpAddr
;

688 
‹mpAddr
.
s_addr
 = 
	`cÚÃùiÚEndpoštAdd»ss
();

691 ià(
fCl›ÁPÜtNum
 !ğ0 && (
hÚÜSDPPÜtChoiû
 || 
	`IsMuÉiÿ¡Add»ss
(
‹mpAddr
.
s_addr
))) {

693 
BoŞ—n
 cÚ¡ 
´ÙocŞIsRTP
 = 
	`¡rcmp
(
fPrÙocŞName
, "RTP") == 0;

694 ià(
´ÙocŞIsRTP
 && !
fMuÉËxRTCPW™hRTP
) {

695 
fCl›ÁPÜtNum
 = fClientPortNum&~1;

698 ià(
	`isSSM
()) {

699 
fRTPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
fSourûF‹rAddr
, 
fCl›ÁPÜtNum
);

701 
fRTPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
fCl›ÁPÜtNum
, 255);

703 ià(
fRTPSock‘
 =ğ
NULL
) {

704 
	`’v
().
	`£tResuÉMsg
("Failedo create RTP socket");

708 ià(
´ÙocŞIsRTP
) {

709 ià(
fMuÉËxRTCPW™hRTP
) {

711 
fRTCPSock‘
 = 
fRTPSock‘
;

714 
pÜtNumB™s
 cÚ¡ 
¹ıPÜtNum
 = 
fCl›ÁPÜtNum
|1;

715 ià(
	`isSSM
()) {

716 
fRTCPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
fSourûF‹rAddr
, 
¹ıPÜtNum
);

718 
fRTCPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
¹ıPÜtNum
, 255);

729 
HashTabË
* 
sock‘HashTabË
 = HashTabË::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

730 ià(
sock‘HashTabË
 =ğ
NULL
) ;

731 
BoŞ—n
 
sucûss
 = 
F®£
;

732 
NoReu£
 
	`dummy
(
	`’v
());

737 ià(
	`isSSM
()) {

738 
fRTPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
fSourûF‹rAddr
, 0);

740 
fRTPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 0, 255);

742 ià(
fRTPSock‘
 =ğ
NULL
) {

743 
	`’v
().
	`£tResuÉMsg
("MediaSession::initiate(): unableo create RTP‡nd RTCP sockets");

748 
PÜt
 
	`ş›ÁPÜt
(0);

749 ià(!
	`g‘SourûPÜt
(
	`’v
(), 
fRTPSock‘
->
	`sock‘Num
(), 
ş›ÁPÜt
)) {

752 
fCl›ÁPÜtNum
 = 
	`Áohs
(
ş›ÁPÜt
.
	`num
());

754 ià(
fMuÉËxRTCPW™hRTP
) {

756 
fRTCPSock‘
 = 
fRTPSock‘
;

757 
sucûss
 = 
True
;

762 ià((
fCl›ÁPÜtNum
&1) != 0) {

764 
key
 = ()
fCl›ÁPÜtNum
;

765 
Groupsock
* 
exi¡šg
 = (Groupsock*)
sock‘HashTabË
->
	`Add
((cÚ¡*)
key
, 
fRTPSock‘
);

766 
d–‘e
 
exi¡šg
;

771 
pÜtNumB™s
 
¹ıPÜtNum
 = 
fCl›ÁPÜtNum
|1;

772 ià(
	`isSSM
()) {

773 
fRTCPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
fSourûF‹rAddr
, 
¹ıPÜtNum
);

775 
fRTCPSock‘
 = 
Ãw
 
	`Groupsock
(
	`’v
(), 
‹mpAddr
, 
¹ıPÜtNum
, 255);

777 ià(
fRTCPSock‘
 !ğ
NULL
 && fRTCPSock‘->
	`sock‘Num
() >= 0) {

779 
sucûss
 = 
True
;

783 
d–‘e
 
fRTCPSock‘
; fRTCPSock‘ = 
NULL
;

786 
key
 = ()
fCl›ÁPÜtNum
;

787 
Groupsock
* 
exi¡šg
 = (Groupsock*)
sock‘HashTabË
->
	`Add
((cÚ¡*)
key
, 
fRTPSock‘
);

788 
d–‘e
 
exi¡šg
;

794 
Groupsock
* 
ŞdGS
;

795 (
ŞdGS
 = (
Groupsock
*)
sock‘HashTabË
->
	`RemoveNext
()è!ğ
NULL
) {

796 
d–‘e
 
ŞdGS
;

798 
d–‘e
 
sock‘HashTabË
;

800 ià(!
sucûss
) ;

805 
¹pBufSize
 = 
fBªdwidth
 * 25 / 2;

806 ià(
¹pBufSize
 < 50 * 1024)

807 
¹pBufSize
 = 50 * 1024;

808 
	`šü—£ReûiveBufãrTo
(
	`’v
(), 
fRTPSock‘
->
	`sock‘Num
(), 
¹pBufSize
);

810 ià(
	`isSSM
(è&& 
fRTCPSock‘
 !ğ
NULL
) {

812 
fRTCPSock‘
->
	`chªgeDe¡š©iÚP¬am‘”s
(
fSourûF‹rAddr
,0,~0);

816 ià(!
	`ü—‹SourûObjeùs
(
u£S³cŸlRTPoff£t
)) ;

818 ià(
fR—dSourû
 =ğ
NULL
) {

819 
	`’v
().
	`£tResuÉMsg
("Failedo create„ead source");

824 ià(
fRTPSourû
 !ğ
NULL
 && 
fRTCPSock‘
 != NULL) {

827 
tÙSessiÚBªdwidth


828 ğ
fBªdwidth
 ? fBandwidth + fBandwidth / 20 : 500;

829 
fRTCPIn¡ªû
 = 
RTCPIn¡ªû
::
	`ü—‹New
(
	`’v
(), 
fRTCPSock‘
,

830 
tÙSessiÚBªdwidth
,

832 
fP¬’t
.
	`CNAME
(),

833 
NULL
 ,

834 
fRTPSourû
);

835 ià(
fRTCPIn¡ªû
 =ğ
NULL
) {

836 
	`’v
().
	`£tResuÉMsg
("Failedo create RTCP instance");

841  
True
;

844 
	`deIn™Ÿ‹
();

845 
fCl›ÁPÜtNum
 = 0;

846  
F®£
;

847 
	}
}

849 
	gMedŸSub£ssiÚ
::
	$deIn™Ÿ‹
() {

850 
Medium
::
	`şo£
(
fRTCPIn¡ªû
); fRTCPIn¡ªû = 
NULL
;

852 
Medium
::
	`şo£
(
fR—dSourû
);

853 
fR—dSourû
 = 
NULL
; 
fRTPSourû
 = NULL;

855 
d–‘e
 
fRTPSock‘
;

856 ià(
fRTCPSock‘
 !ğ
fRTPSock‘
è
d–‘e
 fRTCPSocket;

857 
fRTPSock‘
 = 
NULL
; 
fRTCPSock‘
 = NULL;

858 
	}
}

860 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$£tCl›ÁPÜtNum
(
pÜtNum
) {

861 ià(
fR—dSourû
 !ğ
NULL
) {

862 
	`’v
().
	`£tResuÉMsg
("A„ead source has‡lready been created");

863  
F®£
;

866 
fCl›ÁPÜtNum
 = 
pÜtNum
;

867  
True
;

868 
	}
}

870 cÚ¡* 
	gMedŸSub£ssiÚ
::
	$©ŒV®_¡r
(cÚ¡* 
©ŒName
) const {

871 
SDPA‰ribu‹
* 
©Œ
 = (SDPA‰ribu‹*)(
fA‰ribu‹TabË
->
	`Lookup
(
©ŒName
));

872 ià(
©Œ
 =ğ
NULL
)  "";

874  
©Œ
->
	`¡rV®ue
();

875 
	}
}

877 cÚ¡* 
	gMedŸSub£ssiÚ
::
	$©ŒV®_¡rToLow”
(cÚ¡* 
©ŒName
) const {

878 
SDPA‰ribu‹
* 
©Œ
 = (SDPA‰ribu‹*)(
fA‰ribu‹TabË
->
	`Lookup
(
©ŒName
));

879 ià(
©Œ
 =ğ
NULL
)  "";

881  
©Œ
->
	`¡rV®ueToLow”
();

882 
	}
}

884 
	gMedŸSub£ssiÚ
::
	$©ŒV®_št
(cÚ¡* 
©ŒName
) const {

885 
SDPA‰ribu‹
* 
©Œ
 = (SDPA‰ribu‹*)(
fA‰ribu‹TabË
->
	`Lookup
(
©ŒName
));

886 ià(
©Œ
 =ğ
NULL
)  0;

888  
©Œ
->
	`štV®ue
();

889 
	}
}

891 cÚ¡* 
	gMedŸSub£ssiÚ
::
	$fm_cÚfig
() const {

892 cÚ¡* 
»suÉ
 = 
	`©ŒV®_¡r
("config");

893 ià(
»suÉ
[0] =ğ'\0'è»suÉ = 
	`©ŒV®_¡r
("configuration");

895  
»suÉ
;

896 
	}
}

898 
ÃtAdd»ssB™s
 
	gMedŸSub£ssiÚ
::
	$cÚÃùiÚEndpoštAdd»ss
() const {

901 cÚ¡* 
’dpoštSŒšg
 = 
	`cÚÃùiÚEndpoštName
();

902 ià(
’dpoštSŒšg
 =ğ
NULL
) {

903 
’dpoštSŒšg
 = 
	`·»ÁSessiÚ
().
	`cÚÃùiÚEndpoštName
();

905 ià(
’dpoštSŒšg
 =ğ
NULL
) ;

908 
N‘Add»ssLi¡
 
	`add»s£s
(
’dpoštSŒšg
);

909 ià(
add»s£s
.
	`numAdd»s£s
() == 0) ;

911  *(
ÃtAdd»ssB™s
*)(
add»s£s
.
	`fœ¡Add»ss
()->
	`d©a
());

916 
	}
}

918 
	gMedŸSub£ssiÚ
::
	$£tDe¡š©iÚs
(
ÃtAdd»ssB™s
 
deçuÉDe¡Add»ss
) {

921 
ÃtAdd»ssB™s
 
de¡Add»ss
 = 
	`cÚÃùiÚEndpoštAdd»ss
();

922 ià(
de¡Add»ss
 =ğ0ède¡Add»s ğ
deçuÉDe¡Add»ss
;

923 
š_addr
 
de¡Addr
; de¡Addr.
s_addr
 = 
de¡Add»ss
;

926 
de¡TTL
 = ~0;

928 ià(
fRTPSock‘
 !ğ
NULL
) {

929 
PÜt
 
	`de¡PÜt
(
£rv”PÜtNum
);

930 
fRTPSock‘
->
	`chªgeDe¡š©iÚP¬am‘”s
(
de¡Addr
, 
de¡PÜt
, 
de¡TTL
);

932 ià(
fRTCPSock‘
 !ğ
NULL
 && !
	`isSSM
(è&& !
fMuÉËxRTCPW™hRTP
) {

934 
PÜt
 
	`de¡PÜt
(
£rv”PÜtNum
+1);

935 
fRTCPSock‘
->
	`chªgeDe¡š©iÚP¬am‘”s
(
de¡Addr
, 
de¡PÜt
, 
de¡TTL
);

937 
	}
}

939 
	gMedŸSub£ssiÚ
::
	$£tSessiÚId
(cÚ¡* 
£ssiÚId
) {

940 
d–‘e
[] 
fSessiÚId
;

941 
fSessiÚId
 = 
	`¡rDup
(
£ssiÚId
);

942 
	}
}

944 
	gMedŸSub£ssiÚ
::
	$g‘NÜm®PÏyTime
(
timev®
 cÚ¡& 
´e£Á©iÚTime
) {

945 ià(
	`¹pSourû
(è=ğ
NULL
 ||„Sourû()->
	`time¡ampF»qu’cy
() == 0)  0.0;

949 ià(!
	`¹pSourû
()->
	`hasB“nSynchrÚizedUsšgRTCP
()) {

950 ià(!
¹pInfo
.
šfoIsNew
)  0.0;

951 
u_št32_t
 
time¡ampOff£t
 = 
	`¹pSourû
()->
	`curPack‘RTPTime¡amp
(è- 
¹pInfo
.
time¡amp
;

952 
ÅtOff£t
 = (
time¡ampOff£t
/()(
	`¹pSourû
()->
	`time¡ampF»qu’cy
()))*
	`sÿË
();

953 
Åt
 = 
	`¶ayS¹Time
(è+ 
ÅtOff£t
;

955  
Åt
;

959 
±sDoubË
 = ()(
´e£Á©iÚTime
.
tv_£c
 +…»£Á©iÚTime.
tv_u£c
/1000000.0);

961 ià(
¹pInfo
.
šfoIsNew
) {

964 ià(
	`£qNumLT
(
	`¹pSourû
()->
	`curPack‘RTPSeqNum
(), 
¹pInfo
.
£qNum
))  -0.1;

965 
u_št32_t
 
time¡ampOff£t
 = 
	`¹pSourû
()->
	`curPack‘RTPTime¡amp
(è- 
¹pInfo
.
time¡amp
;

966 
ÅtOff£t
 = (
time¡ampOff£t
/()(
	`¹pSourû
()->
	`time¡ampF»qu’cy
()))*
	`sÿË
();

967 
Åt
 = 
	`¶ayS¹Time
(è+ 
ÅtOff£t
;

968 
fNPT_PTS_Off£t
 = 
Åt
 - 
±sDoubË
*
	`sÿË
();

969 
¹pInfo
.
šfoIsNew
 = 
F®£
;

971  
Åt
;

974 ià(
fNPT_PTS_Off£t
 == 0.0)  0.0;

975  ()(
±sDoubË
*
	`sÿË
(è+ 
fNPT_PTS_Off£t
);

978 
	}
}

980 
	gMedŸSub£ssiÚ


981 ::
	$£tA‰ribu‹
(cÚ¡* 
Çme
, cÚ¡* 
v®ue
, 
BoŞ—n
 
v®ueIsHexadecim®
) {

984 
SDPA‰ribu‹
* 
ŞdA‰r
 = (SDPA‰ribu‹*)
fA‰ribu‹TabË
->
	`Lookup
(
Çme
);

985 ià(
ŞdA‰r
 !ğ
NULL
) {

986 
v®ueIsHexadecim®
 = 
ŞdA‰r
->
	`v®ueIsHexadecim®
();

987 
fA‰ribu‹TabË
->
	`Remove
(
Çme
);

988 
d–‘e
 
ŞdA‰r
;

991 
SDPA‰ribu‹
* 
ÃwA‰r
 = 
Ãw
 
	`SDPA‰ribu‹
(
v®ue
, 
v®ueIsHexadecim®
);

992 ()
fA‰ribu‹TabË
->
	`Add
(
Çme
, 
ÃwA‰r
);

993 
	}
}

995 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPLše_c
(cÚ¡* 
sdpLše
) {

999 * 
cÚÃùiÚEndpoštName
 = 
	`·r£CLše
(
sdpLše
);

1000 ià(
cÚÃùiÚEndpoštName
 !ğ
NULL
) {

1001 
d–‘e
[] 
fCÚÃùiÚEndpoštName
;

1002 
fCÚÃùiÚEndpoštName
 = 
cÚÃùiÚEndpoštName
;

1003  
True
;

1006  
F®£
;

1007 
	}
}

1009 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPLše_b
(cÚ¡* 
sdpLše
) {

1012  
	`ssÿnf
(
sdpLše
, "b=AS:%u", &
fBªdwidth
) == 1;

1013 
	}
}

1015 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_¹pm­
(cÚ¡* 
sdpLše
) {

1019 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

1021 
¹pm­PaylßdFÜm©
;

1022 * 
codecName
 = 
	`¡rDupSize
(
sdpLše
);

1023 
¹pTime¡ampF»qu’cy
 = 0;

1024 
numChªÃls
 = 1;

1025 ià(
	`ssÿnf
(
sdpLše
, "a=rtpmap: %u %[^/]/%u/%u",

1026 &
¹pm­PaylßdFÜm©
, 
codecName
, &
¹pTime¡ampF»qu’cy
,

1027 &
numChªÃls
) == 4

1028 || 
	`ssÿnf
(
sdpLše
, "a=rtpmap: %u %[^/]/%u",

1029 &
¹pm­PaylßdFÜm©
, 
codecName
, &
¹pTime¡ampF»qu’cy
) == 3

1030 || 
	`ssÿnf
(
sdpLše
, "a=rtpmap: %u %s",

1031 &
¹pm­PaylßdFÜm©
, 
codecName
) == 2) {

1032 
·r£Sucûss
 = 
True
;

1033 ià(
¹pm­PaylßdFÜm©
 =ğ
fRTPPaylßdFÜm©
) {

1038 
LoÿË
 
	`l
("POSIX");

1039 * 
p
 = 
codecName
; *°!ğ'\0'; ++pè*°ğ
	`touµ”
(*p);

1041 
d–‘e
[] 
fCodecName
; fCodecNamğ
	`¡rDup
(
codecName
);

1042 
fRTPTime¡ampF»qu’cy
 = 
¹pTime¡ampF»qu’cy
;

1043 
fNumChªÃls
 = 
numChªÃls
;

1046 
d–‘e
[] 
codecName
;

1048  
·r£Sucûss
;

1049 
	}
}

1051 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_¹ımux
(cÚ¡* 
sdpLše
) {

1052 ià(
	`¡ºcmp
(
sdpLše
, "a=rtcp-mux", 10) == 0) {

1053 
fMuÉËxRTCPW™hRTP
 = 
True
;

1054  
True
;

1057  
F®£
;

1058 
	}
}

1060 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_cÚŒŞ
(cÚ¡* 
sdpLše
) {

1062 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

1064 * 
cÚŒŞP©h
 = 
	`¡rDupSize
(
sdpLše
);

1065 ià(
	`ssÿnf
(
sdpLše
, "a=cÚŒŞ: %s", 
cÚŒŞP©h
) == 1) {

1066 
·r£Sucûss
 = 
True
;

1067 
d–‘e
[] 
fCÚŒŞP©h
; fCÚŒŞP©h = 
	`¡rDup
(
cÚŒŞP©h
);

1069 
d–‘e
[] 
cÚŒŞP©h
;

1071  
·r£Sucûss
;

1072 
	}
}

1074 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_¿nge
(cÚ¡* 
sdpLše
) {

1077 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

1079 
¶ayS¹Time
;

1080 
¶ayEndTime
;

1081 ià(
	`·r£RªgeA‰ribu‹
(
sdpLše
, 
¶ayS¹Time
, 
¶ayEndTime
)) {

1082 
·r£Sucûss
 = 
True
;

1083 ià(
¶ayS¹Time
 > 
fPÏyS¹Time
) {

1084 
fPÏyS¹Time
 = 
¶ayS¹Time
;

1085 ià(
¶ayS¹Time
 > 
fP¬’t
.
	`¶ayS¹Time
()) {

1086 
fP¬’t
.
	`¶ayS¹Time
(èğ
¶ayS¹Time
;

1089 ià(
¶ayEndTime
 > 
fPÏyEndTime
) {

1090 
fPÏyEndTime
 = 
¶ayEndTime
;

1091 ià(
¶ayEndTime
 > 
fP¬’t
.
	`¶ayEndTime
()) {

1092 
fP¬’t
.
	`¶ayEndTime
(èğ
¶ayEndTime
;

1095 } ià(
	`·r£RªgeA‰ribu‹
(
sdpLše
, 
	`_absS¹Time
(), 
	`_absEndTime
())) {

1096 
·r£Sucûss
 = 
True
;

1099  
·r£Sucûss
;

1100 
	}
}

1102 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_fm
(cÚ¡* 
sdpLše
) {

1106 ià(
	`¡ºcmp
(
sdpLše
, "a=fmtp:", 7) != 0) ; sdpLine += 7;

1107 
	`isdig™
(*
sdpLše
)) ++sdpLine;

1114 cÚ¡ 
sdpLšeL’
 = 
	`¡¾’
(
sdpLše
);

1115 * 
ÇmeSŒ
 = 
Ãw
 [
sdpLšeL’
+1];

1116 * 
v®ueSŒ
 = 
Ãw
 [
sdpLšeL’
+1];

1118 *
sdpLše
 != '\0' && *sdpLine != '\r' && *sdpLine != '\n') {

1119 
ssÿnfResuÉ
 = 
	`ssÿnf
(
sdpLše
, " %[^=; \t\r\n] = %[^; \t\r\n]", 
ÇmeSŒ
, 
v®ueSŒ
);

1120 ià(
ssÿnfResuÉ
 >= 1) {

1123 
LoÿË
 
	`l
("POSIX");

1124 * 
c
 = 
ÇmeSŒ
; *ø!ğ'\0'; ++cè*øğ
	`tŞow”
(*c);

1126 ià(
ssÿnfResuÉ
 == 1) {

1128 
	`£tA‰ribu‹
(
ÇmeSŒ
);

1131 
	`£tA‰ribu‹
(
ÇmeSŒ
, 
v®ueSŒ
);

1136 *
sdpLše
 != '\0' && *sdpLine != '\r' && *sdpLine != '\n' && *sdpLine != ';') ++sdpLine;

1137 *
sdpLše
 == ';') ++sdpLine;

1139 
d–‘e
[] 
ÇmeSŒ
; d–‘e[] 
v®ueSŒ
;

1140  
True
;

1143  
F®£
;

1144 
	}
}

1146 
BoŞ—n
 
	gMedŸSub£ssiÚ


1147 ::
	$·r£SDPA‰ribu‹_sourû_f‹r
(cÚ¡* 
sdpLše
) {

1148  
	`·r£SourûF‹rA‰ribu‹
(
sdpLše
, 
fSourûF‹rAddr
);

1149 
	}
}

1151 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_x_dim’siÚs
(cÚ¡* 
sdpLše
) {

1153 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

1155 
width
, 
height
;

1156 ià(
	`ssÿnf
(
sdpLše
, "a=x-dim’siÚs:%d,%d", &
width
, &
height
) == 2) {

1157 
·r£Sucûss
 = 
True
;

1158 
fVideoWidth
 = ()
width
;

1159 
fVideoHeight
 = ()
height
;

1162  
·r£Sucûss
;

1163 
	}
}

1165 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$·r£SDPA‰ribu‹_äam”©e
(cÚ¡* 
sdpLše
) {

1167 
BoŞ—n
 
·r£Sucûss
 = 
F®£
;

1169 
ä©e
;

1170 
¿‹
;

1171 ià(
	`ssÿnf
(
sdpLše
, "a=äam”©e: %f", &
ä©e
) == 1 || sscanf(sdpLine, "a=framerate:%f", &frate) == 1) {

1172 
·r£Sucûss
 = 
True
;

1173 
fVideoFPS
 = ()
ä©e
;

1174 } ià(
	`ssÿnf
(
sdpLše
, "a=x-äam”©e: %d", &
¿‹
) == 1) {

1175 
·r£Sucûss
 = 
True
;

1176 
fVideoFPS
 = ()
¿‹
;

1179  
·r£Sucûss
;

1180 
	}
}

1182 
BoŞ—n
 
	gMedŸSub£ssiÚ
::
	$ü—‹SourûObjeùs
(
u£S³cŸlRTPoff£t
) {

1185 ià(
	`¡rcmp
(
fPrÙocŞName
, "UDP") == 0) {

1187 
fR—dSourû
 = 
BasicUDPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
);

1188 
fRTPSourû
 = 
NULL
;

1190 ià(
	`¡rcmp
(
fCodecName
, "MP2T") == 0) {

1191 
fR—dSourû
 = 
MPEG2T¿n¥ÜtSŒ—mF¿m”
::
	`ü—‹New
(
	`’v
(), fReadSource);

1199 
BoŞ—n
 
ü—‹Sim¶eRTPSourû
 = 
F®£
;

1200 
BoŞ—n
 
doNÜm®MB™RuË
 = 
F®£
;

1201 ià(
	`¡rcmp
(
fCodecName
, "QCELP") == 0) {

1202 
fR—dSourû
 =

1203 
QCELPAudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPSourû
,

1204 
fRTPPaylßdFÜm©
,

1205 
fRTPTime¡ampF»qu’cy
);

1207 } ià(
	`¡rcmp
(
fCodecName
, "AMR") == 0) {

1208 
fR—dSourû
 =

1209 
AMRAudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPSourû
,

1210 
fRTPPaylßdFÜm©
, 
F®£
 ,

1211 
fNumChªÃls
, 
	`©ŒV®_boŞ
("octet-align"),

1212 
	`©ŒV®_unsigÃd
("interleaving"),

1213 
	`©ŒV®_boŞ
("robust-sorting"),

1214 
	`©ŒV®_boŞ
("crc"));

1216 } ià(
	`¡rcmp
(
fCodecName
, "AMR-WB") == 0) {

1217 
fR—dSourû
 =

1218 
AMRAudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPSourû
,

1219 
fRTPPaylßdFÜm©
, 
True
 ,

1220 
fNumChªÃls
, 
	`©ŒV®_boŞ
("octet-align"),

1221 
	`©ŒV®_unsigÃd
("interleaving"),

1222 
	`©ŒV®_boŞ
("robust-sorting"),

1223 
	`©ŒV®_boŞ
("crc"));

1225 } ià(
	`¡rcmp
(
fCodecName
, "MPA") == 0) {

1226 
fR—dSourû
 = 
fRTPSourû


1227 ğ
MPEG1Ü2AudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1228 
fRTPPaylßdFÜm©
,

1229 
fRTPTime¡ampF»qu’cy
);

1230 } ià(
	`¡rcmp
(
fCodecName
, "MPA-ROBUST") == 0) {

1231 
fR—dSourû
 = 
fRTPSourû


1232 ğ
MP3ADURTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPPaylßdFÜm©
,

1233 
fRTPTime¡ampF»qu’cy
);

1234 ià(
fRTPSourû
 =ğ
NULL
) ;

1236 ià(!
fReûiveRawMP3ADUs
) {

1238 
MP3ADUdeš‹¾—v”
* 
deš‹¾—v”


1239 ğ
MP3ADUdeš‹¾—v”
::
	`ü—‹New
(
	`’v
(), 
fRTPSourû
);

1240 ià(
deš‹¾—v”
 =ğ
NULL
) ;

1243 
fR—dSourû
 = 
MP3FromADUSourû
::
	`ü—‹New
(
	`’v
(), 
deš‹¾—v”
);

1245 } ià(
	`¡rcmp
(
fCodecName
, "X-MP3-DRAFT-00") == 0) {

1248 
fRTPSourû


1249 ğ
Sim¶eRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPPaylßdFÜm©
,

1250 
fRTPTime¡ampF»qu’cy
,

1252 ià(
fRTPSourû
 =ğ
NULL
) ;

1255 
fR—dSourû
 = 
MP3FromADUSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSourû
,

1256 
F®£
 );

1257 } ià(
	`¡rcmp
(
fCodecName
, "MP4A-LATM") == 0) {

1258 
fR—dSourû
 = 
fRTPSourû


1259 ğ
MPEG4LATMAudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1260 
fRTPPaylßdFÜm©
,

1261 
fRTPTime¡ampF»qu’cy
);

1262 } ià(
	`¡rcmp
(
fCodecName
, "VORBIS") == 0) {

1263 
fR—dSourû
 = 
fRTPSourû


1264 ğ
VÜbisAudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1265 
fRTPPaylßdFÜm©
,

1266 
fRTPTime¡ampF»qu’cy
);

1267 } ià(
	`¡rcmp
(
fCodecName
, "THEORA") == 0) {

1268 
fR—dSourû
 = 
fRTPSourû


1269 ğ
TheÜaVideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPPaylßdFÜm©
);

1270 } ià(
	`¡rcmp
(
fCodecName
, "VP8") == 0) {

1271 
fR—dSourû
 = 
fRTPSourû


1272 ğ
VP8VideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1273 
fRTPPaylßdFÜm©
,

1274 
fRTPTime¡ampF»qu’cy
);

1275 } ià(
	`¡rcmp
(
fCodecName
, "VP9") == 0) {

1276 
fR—dSourû
 = 
fRTPSourû


1277 ğ
VP9VideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1278 
fRTPPaylßdFÜm©
,

1279 
fRTPTime¡ampF»qu’cy
);

1280 } ià(
	`¡rcmp
(
fCodecName
, "AC3") == 0 || strcmp(fCodecName, "EAC3") == 0) {

1281 
fR—dSourû
 = 
fRTPSourû


1282 ğ
AC3AudioRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1283 
fRTPPaylßdFÜm©
,

1284 
fRTPTime¡ampF»qu’cy
);

1285 } ià(
	`¡rcmp
(
fCodecName
, "MP4V-ES") == 0) {

1286 
fR—dSourû
 = 
fRTPSourû


1287 ğ
MPEG4ESVideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1288 
fRTPPaylßdFÜm©
,

1289 
fRTPTime¡ampF»qu’cy
);

1290 } ià(
	`¡rcmp
(
fCodecName
, "MPEG4-GENERIC") == 0) {

1291 
fR—dSourû
 = 
fRTPSourû


1292 ğ
MPEG4G’”icRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1293 
fRTPPaylßdFÜm©
,

1294 
fRTPTime¡ampF»qu’cy
,

1295 
fMediumName
, 
	`©ŒV®_¡rToLow”
("mode"),

1296 
	`©ŒV®_unsigÃd
("sizelength"),

1297 
	`©ŒV®_unsigÃd
("indexlength"),

1298 
	`©ŒV®_unsigÃd
("indexdeltalength"));

1299 } ià(
	`¡rcmp
(
fCodecName
, "MPV") == 0) {

1300 
fR—dSourû
 = 
fRTPSourû


1301 ğ
MPEG1Ü2VideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1302 
fRTPPaylßdFÜm©
,

1303 
fRTPTime¡ampF»qu’cy
);

1304 } ià(
	`¡rcmp
(
fCodecName
, "MP2T") == 0) {

1305 
fRTPSourû
 = 
Sim¶eRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPPaylßdFÜm©
,

1306 
fRTPTime¡ampF»qu’cy
, "video/MP2T",

1307 0, 
F®£
);

1308 
fR—dSourû
 = 
MPEG2T¿n¥ÜtSŒ—mF¿m”
::
	`ü—‹New
(
	`’v
(), 
fRTPSourû
);

1310 } ià(
	`¡rcmp
(
fCodecName
, "H261") == 0) {

1311 
fR—dSourû
 = 
fRTPSourû


1312 ğ
H261VideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1313 
fRTPPaylßdFÜm©
,

1314 
fRTPTime¡ampF»qu’cy
);

1315 } ià(
	`¡rcmp
(
fCodecName
, "H263-1998") == 0 ||

1316 
	`¡rcmp
(
fCodecName
, "H263-2000") == 0) {

1317 
fR—dSourû
 = 
fRTPSourû


1318 ğ
H263¶usVideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1319 
fRTPPaylßdFÜm©
,

1320 
fRTPTime¡ampF»qu’cy
);

1321 } ià(
	`¡rcmp
(
fCodecName
, "H264") == 0) {

1322 
fR—dSourû
 = 
fRTPSourû


1323 ğ
H264VideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1324 
fRTPPaylßdFÜm©
,

1325 
fRTPTime¡ampF»qu’cy
);

1326 } ià(
	`¡rcmp
(
fCodecName
, "H265") == 0) {

1327 
BoŞ—n
 
ex³ùDONF›lds
 = 
	`©ŒV®_unsigÃd
("sprop-depack-buf-nalus") > 0;

1328 
fR—dSourû
 = 
fRTPSourû


1329 ğ
H265VideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1330 
fRTPPaylßdFÜm©
,

1331 
ex³ùDONF›lds
,

1332 
fRTPTime¡ampF»qu’cy
);

1333 } ià(
	`¡rcmp
(
fCodecName
, "DV") == 0) {

1334 
fR—dSourû
 = 
fRTPSourû


1335 ğ
DVVideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1336 
fRTPPaylßdFÜm©
,

1337 
fRTPTime¡ampF»qu’cy
);

1338 } ià(
	`¡rcmp
(
fCodecName
, "JPEG") == 0) {

1339 ià(
fReûiveRawJPEGF¿mes
) {

1341 
fR—dSourû
 = 
fRTPSourû


1342 ğ
Sim¶eRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPPaylßdFÜm©
,

1343 
fRTPTime¡ampF»qu’cy
, "video/JPEG",

1344 0 , 
F®£
 );

1347 
fR—dSourû
 = 
fRTPSourû


1348 ğ
JPEGVideoRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1349 
fRTPPaylßdFÜm©
,

1350 
fRTPTime¡ampF»qu’cy
,

1351 
	`videoWidth
(),

1352 
	`videoHeight
());

1354 } ià(
	`¡rcmp
(
fCodecName
, "X-QT") == 0

1355 || 
	`¡rcmp
(
fCodecName
, "X-QUICKTIME") == 0) {

1358 * 
mimeTy³


1359 ğ
Ãw
 [
	`¡¾’
(
	`mediumName
()è+ sŒËn(
	`codecName
()) + 2] ;

1360 
	`¥rštf
(
mimeTy³
, "%s/%s", 
	`mediumName
(), 
	`codecName
());

1361 
fR—dSourû
 = 
fRTPSourû


1362 ğ
QuickTimeG’”icRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
,

1363 
fRTPPaylßdFÜm©
,

1364 
fRTPTime¡ampF»qu’cy
,

1365 
mimeTy³
);

1366 
d–‘e
[] 
mimeTy³
;

1367 } iàĞ
	`¡rcmp
(
fCodecName
, "PCMU") == 0

1368 || 
	`¡rcmp
(
fCodecName
, "GSM") == 0

1369 || 
	`¡rcmp
(
fCodecName
, "DVI4") == 0

1370 || 
	`¡rcmp
(
fCodecName
, "PCMA") == 0

1371 || 
	`¡rcmp
(
fCodecName
, "MP1S") == 0

1372 || 
	`¡rcmp
(
fCodecName
, "MP2P") == 0

1373 || 
	`¡rcmp
(
fCodecName
, "L8") == 0

1374 || 
	`¡rcmp
(
fCodecName
, "L16") == 0

1375 || 
	`¡rcmp
(
fCodecName
, "L20") == 0

1376 || 
	`¡rcmp
(
fCodecName
, "L24") == 0

1377 || 
	`¡rcmp
(
fCodecName
, "G722") == 0

1378 || 
	`¡rcmp
(
fCodecName
, "G726-16") == 0

1379 || 
	`¡rcmp
(
fCodecName
, "G726-24") == 0

1380 || 
	`¡rcmp
(
fCodecName
, "G726-32") == 0

1381 || 
	`¡rcmp
(
fCodecName
, "G726-40") == 0

1382 || 
	`¡rcmp
(
fCodecName
, "SPEEX") == 0

1383 || 
	`¡rcmp
(
fCodecName
, "ILBC") == 0

1384 || 
	`¡rcmp
(
fCodecName
, "OPUS") == 0

1385 || 
	`¡rcmp
(
fCodecName
, "T140") == 0

1386 || 
	`¡rcmp
(
fCodecName
, "DAT12") == 0

1387 || 
	`¡rcmp
(
fCodecName
, "VND.ONVIF.METADATA") == 0

1389 
ü—‹Sim¶eRTPSourû
 = 
True
;

1390 
u£S³cŸlRTPoff£t
 = 0;

1391 ià(
	`¡rcmp
(
fCodecName
, "VND.ONVIF.METADATA") == 0) {

1393 
doNÜm®MB™RuË
 = 
True
;

1395 } ià(
u£S³cŸlRTPoff£t
 >= 0) {

1398 
ü—‹Sim¶eRTPSourû
 = 
True
;

1400 
	`’v
().
	`£tResuÉMsg
("RTP…ayload format unknown or‚ot supported");

1404 ià(
ü—‹Sim¶eRTPSourû
) {

1405 * 
mimeTy³


1406 ğ
Ãw
 [
	`¡¾’
(
	`mediumName
()è+ sŒËn(
	`codecName
()) + 2] ;

1407 
	`¥rštf
(
mimeTy³
, "%s/%s", 
	`mediumName
(), 
	`codecName
());

1408 
fR—dSourû
 = 
fRTPSourû


1409 ğ
Sim¶eRTPSourû
::
	`ü—‹New
(
	`’v
(), 
fRTPSock‘
, 
fRTPPaylßdFÜm©
,

1410 
fRTPTime¡ampF»qu’cy
, 
mimeTy³
,

1411 ()
u£S³cŸlRTPoff£t
,

1412 
doNÜm®MB™RuË
);

1413 
d–‘e
[] 
mimeTy³
;

1417  
True
;

1420  
F®£
;

1421 
	}
}

1426 
	gSDPA‰ribu‹
::
	$SDPA‰ribu‹
(cÚ¡* 
¡rV®ue
, 
BoŞ—n
 
v®ueIsHexadecim®
)

1427 : 
	`fSŒV®ue
(
	`¡rDup
(
¡rV®ue
)), 
	`fSŒV®ueToLow”
(
NULL
), 
	$fV®ueIsHexadecim®
(
v®ueIsHexadecim®
) {

1428 ià(
fSŒV®ue
 =ğ
NULL
) {

1430 
fIÁV®ue
 = 1;

1433 
LoÿË
 
	`l
("POSIX");

1434 
size_t
 
¡rSize
;

1436 
fSŒV®ueToLow”
 = 
	`¡rDupSize
(
fSŒV®ue
, 
¡rSize
);

1437 
i
 = 0; i < 
¡rSize
-1; ++iè
fSŒV®ueToLow”
[i] = 
	`tŞow”
(
fSŒV®ue
[i]);

1438 
fSŒV®ueToLow”
[
¡rSize
-1] = '\0';

1441 ià(
	`ssÿnf
(
fSŒV®ueToLow”
, 
v®ueIsHexadecim®
 ? "%x" : "%d", &
fIÁV®ue
) != 1) {

1442 
fIÁV®ue
 = 0;

1445 
	}
}

1447 
	gSDPA‰ribu‹
::~
	$SDPA‰ribu‹
() {

1448 
d–‘e
[] 
fSŒV®ue
;

1449 
d–‘e
[] 
fSŒV®ueToLow”
;

1450 
	}
}

	@liveMedia/MediaSink.cpp

21 
	~"MedŸSšk.hh
"

22 
	~"GroupsockH–³r.hh
"

23 
	~<¡ršg.h
>

27 
	gMedŸSšk
::
	$MedŸSšk
(
U§geEnvœÚm’t
& 
’v
)

28 : 
	`Medium
(
’v
), 
	$fSourû
(
NULL
) {

29 
	}
}

31 
	gMedŸSšk
::~
	$MedŸSšk
() {

32 
	`¡İPÏyšg
();

33 
	}
}

35 
BoŞ—n
 
	gMedŸSšk
::
	$isSšk
() const {

36  
True
;

37 
	}
}

39 
BoŞ—n
 
	gMedŸSšk
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
sškName
,

40 
MedŸSšk
*& 
»suÉSšk
) {

41 
»suÉSšk
 = 
NULL
;

43 
Medium
* 
medium
;

44 ià(!
Medium
::
	`lookupByName
(
’v
, 
sškName
, 
medium
)è 
F®£
;

46 ià(!
medium
->
	`isSšk
()) {

47 
’v
.
	`£tResuÉMsg
(
sškName
, " is‚ot‡ media sink");

48  
F®£
;

51 
»suÉSšk
 = (
MedŸSšk
*)
medium
;

52  
True
;

53 
	}
}

55 
BoŞ—n
 
	gMedŸSšk
::
	$sourûIsCom·tibËW™hUs
(
MedŸSourû
& 
sourû
) {

57  
sourû
.
	`isF¿medSourû
();

58 
	}
}

60 
BoŞ—n
 
	gMedŸSšk
::
	$¡¬tPÏyšg
(
MedŸSourû
& 
sourû
,

61 
aá”PÏyšgFunc
* 
aá”Func
,

62 * 
aá”Cl›ÁD©a
) {

64 ià(
fSourû
 !ğ
NULL
) {

65 
	`’vœ
().
	`£tResuÉMsg
("This sink is‡lready being…layed");

66  
F®£
;

70 ià(!
	`sourûIsCom·tibËW™hUs
(
sourû
)) {

71 
	`’vœ
().
	`£tResuÉMsg
("MediaSink::startPlaying(): source is‚ot compatible!");

72  
F®£
;

74 
fSourû
 = (
F¿medSourû
*)&
sourû
;

76 
fAá”Func
 = 
aá”Func
;

77 
fAá”Cl›ÁD©a
 = 
aá”Cl›ÁD©a
;

78  
	`cÚtšuePÏyšg
();

79 
	}
}

81 
	gMedŸSšk
::
	$¡İPÏyšg
() {

83 ià(
fSourû
 !ğ
NULL
èfSourû->
	`¡İG‘tšgF¿mes
();

86 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

88 
fSourû
 = 
NULL
;

89 
fAá”Func
 = 
NULL
;

90 
	}
}

92 
	gMedŸSšk
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

93 
MedŸSšk
* 
sšk
 = (MedŸSšk*)
ş›ÁD©a
;

94 
sšk
->
	`ÚSourûClosu»
();

95 
	}
}

97 
	gMedŸSšk
::
	$ÚSourûClosu»
() {

99 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

101 
fSourû
 = 
NULL
;

102 ià(
fAá”Func
 !ğ
NULL
) {

103 (*
fAá”Func
)(
fAá”Cl›ÁD©a
);

105 
	}
}

107 
BoŞ—n
 
	gMedŸSšk
::
	$isRTPSšk
() const {

108  
F®£
;

109 
	}
}

113 
	gOutPack‘Bufãr
::
maxSize
 = 60000;

115 
	gOutPack‘Bufãr


116 ::
	$OutPack‘Bufãr
(
´eã¼edPack‘Size
, 
maxPack‘Size
, 
maxBufãrSize
)

117 : 
	`fP»ã¼ed
(
´eã¼edPack‘Size
), 
	`fMax
(
maxPack‘Size
),

118 
	$fOv”æowD©aSize
(0) {

119 ià(
maxBufãrSize
 =ğ0èmaxBufãrSizğ
maxSize
;

120 
maxNumPack‘s
 = (
maxBufãrSize
 + (
maxPack‘Size
-1))/maxPacketSize;

121 
fLim™
 = 
maxNumPack‘s
*
maxPack‘Size
;

122 
fBuf
 = 
Ãw
 [
fLim™
];

123 
	`»£tPack‘S¹
();

124 
	`»£tOff£t
();

125 
	`»£tOv”æowD©a
();

126 
	}
}

128 
	gOutPack‘Bufãr
::~
	$OutPack‘Bufãr
() {

129 
d–‘e
[] 
fBuf
;

130 
	}
}

132 
	gOutPack‘Bufãr
::
	$’queue
(cÚ¡* 
äom
, 
numBy‹s
) {

133 ià(
numBy‹s
 > 
	`tÙ®By‹sAvaabË
()) {

134 #ifdeà
DEBUG


135 
	`årštf
(
¡d”r
, "OutPack‘Bufãr::’queue(èw¬nšg: %d > %d\n", 
numBy‹s
, 
	`tÙ®By‹sAvaabË
());

137 
numBy‹s
 = 
	`tÙ®By‹sAvaabË
();

140 ià(
	`curPŒ
(è!ğ
äom
è
	`memmove
(curPŒ(), from, 
numBy‹s
);

141 
	`šüem’t
(
numBy‹s
);

142 
	}
}

144 
	gOutPack‘Bufãr
::
	$’queueWÜd
(
u_št32_t
 
wÜd
) {

145 
u_št32_t
 
nWÜd
 = 
	`htÚl
(
wÜd
);

146 
	`’queue
((*)&
nWÜd
, 4);

147 
	}
}

149 
	gOutPack‘Bufãr
::
	$š£¹
(cÚ¡* 
äom
, 
numBy‹s
,

150 
toPos™iÚ
) {

151 
»®ToPos™iÚ
 = 
fPack‘S¹
 + 
toPos™iÚ
;

152 ià(
»®ToPos™iÚ
 + 
numBy‹s
 > 
fLim™
) {

153 ià(
»®ToPos™iÚ
 > 
fLim™
) ;

154 
numBy‹s
 = 
fLim™
 - 
»®ToPos™iÚ
;

157 
	`memmove
(&
fBuf
[
»®ToPos™iÚ
], 
äom
, 
numBy‹s
);

158 ià(
toPos™iÚ
 + 
numBy‹s
 > 
fCurOff£t
) {

159 
fCurOff£t
 = 
toPos™iÚ
 + 
numBy‹s
;

161 
	}
}

163 
	gOutPack‘Bufãr
::
	$š£¹WÜd
(
u_št32_t
 
wÜd
, 
toPos™iÚ
) {

164 
u_št32_t
 
nWÜd
 = 
	`htÚl
(
wÜd
);

165 
	`š£¹
((*)&
nWÜd
, 4, 
toPos™iÚ
);

166 
	}
}

168 
	gOutPack‘Bufãr
::
	$exŒaù
(* 
to
, 
numBy‹s
,

169 
äomPos™iÚ
) {

170 
»®FromPos™iÚ
 = 
fPack‘S¹
 + 
äomPos™iÚ
;

171 ià(
»®FromPos™iÚ
 + 
numBy‹s
 > 
fLim™
) {

172 ià(
»®FromPos™iÚ
 > 
fLim™
) ;

173 
numBy‹s
 = 
fLim™
 - 
»®FromPos™iÚ
;

176 
	`memmove
(
to
, &
fBuf
[
»®FromPos™iÚ
], 
numBy‹s
);

177 
	}
}

179 
u_št32_t
 
	gOutPack‘Bufãr
::
	$exŒaùWÜd
(
äomPos™iÚ
) {

180 
u_št32_t
 
nWÜd
;

181 
	`exŒaù
((*)&
nWÜd
, 4, 
äomPos™iÚ
);

182  
	`Áohl
(
nWÜd
);

183 
	}
}

185 
	gOutPack‘Bufãr
::
	$skBy‹s
(
numBy‹s
) {

186 ià(
numBy‹s
 > 
	`tÙ®By‹sAvaabË
()) {

187 
numBy‹s
 = 
	`tÙ®By‹sAvaabË
();

190 
	`šüem’t
(
numBy‹s
);

191 
	}
}

193 
	gOutPack‘Bufãr


194 ::
	$£tOv”æowD©a
(
ov”æowD©aOff£t
,

195 
ov”æowD©aSize
,

196 
timev®
 cÚ¡& 
´e£Á©iÚTime
,

197 
du¿tiÚInMiüo£cÚds
) {

198 
fOv”æowD©aOff£t
 = 
ov”æowD©aOff£t
;

199 
fOv”æowD©aSize
 = 
ov”æowD©aSize
;

200 
fOv”æowP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

201 
fOv”æowDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

202 
	}
}

204 
	gOutPack‘Bufãr
::
	$u£Ov”æowD©a
() {

205 
	`’queue
(&
fBuf
[
fPack‘S¹
 + 
fOv”æowD©aOff£t
], 
fOv”æowD©aSize
);

206 
fCurOff£t
 -ğ
fOv”æowD©aSize
;

207 
	`»£tOv”æowD©a
();

208 
	}
}

210 
	gOutPack‘Bufãr
::
	$adju¡Pack‘S¹
(
numBy‹s
) {

211 
fPack‘S¹
 +ğ
numBy‹s
;

212 ià(
fOv”æowD©aOff£t
 >ğ
numBy‹s
) {

213 
fOv”æowD©aOff£t
 -ğ
numBy‹s
;

215 
fOv”æowD©aOff£t
 = 0;

216 
fOv”æowD©aSize
 = 0;

218 
	}
}

220 
	gOutPack‘Bufãr
::
	$»£tPack‘S¹
() {

221 ià(
fOv”æowD©aSize
 > 0) {

222 
fOv”æowD©aOff£t
 +ğ
fPack‘S¹
;

224 
fPack‘S¹
 = 0;

225 
	}
}

	@liveMedia/MediaSource.cpp

21 
	~"MedŸSourû.hh
"

25 
	gMedŸSourû
::
	$MedŸSourû
(
U§geEnvœÚm’t
& 
’v
)

26 : 
	$Medium
(
’v
) {

27 
	}
}

29 
MedŸSourû
::~
	$MedŸSourû
() {

30 
	}
}

32 
BoŞ—n
 
MedŸSourû
::
	$isSourû
() const {

33  
True
;

34 
	}
}

36 cÚ¡* 
	gMedŸSourû
::
	$MIMEty³
() const {

38 
	}
}

40 
BoŞ—n
 
	gMedŸSourû
::
	$isF¿medSourû
() const {

41  
F®£
;

42 
	}
}

43 
BoŞ—n
 
	gMedŸSourû
::
	$isRTPSourû
() const {

44  
F®£
;

45 
	}
}

46 
BoŞ—n
 
	gMedŸSourû
::
	$isMPEG1Ü2VideoSŒ—mF¿m”
() const {

47  
F®£
;

48 
	}
}

49 
BoŞ—n
 
	gMedŸSourû
::
	$isMPEG4VideoSŒ—mF¿m”
() const {

50  
F®£
;

51 
	}
}

52 
BoŞ—n
 
	gMedŸSourû
::
	$isH264VideoSŒ—mF¿m”
() const {

53  
F®£
;

54 
	}
}

55 
BoŞ—n
 
	gMedŸSourû
::
	$isH265VideoSŒ—mF¿m”
() const {

56  
F®£
;

57 
	}
}

58 
BoŞ—n
 
	gMedŸSourû
::
	$isDVVideoSŒ—mF¿m”
() const {

59  
F®£
;

60 
	}
}

61 
BoŞ—n
 
	gMedŸSourû
::
	$isJPEGVideoSourû
() const {

62  
F®£
;

63 
	}
}

64 
BoŞ—n
 
	gMedŸSourû
::
	$isAMRAudioSourû
() const {

65  
F®£
;

66 
	}
}

68 
BoŞ—n
 
	gMedŸSourû
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
,

69 cÚ¡* 
sourûName
,

70 
MedŸSourû
*& 
»suÉSourû
) {

71 
»suÉSourû
 = 
NULL
;

73 
Medium
* 
medium
;

74 ià(!
Medium
::
	`lookupByName
(
’v
, 
sourûName
, 
medium
)è 
F®£
;

76 ià(!
medium
->
	`isSourû
()) {

77 
’v
.
	`£tResuÉMsg
(
sourûName
, " is‚ot‡ media source");

78  
F®£
;

81 
»suÉSourû
 = (
MedŸSourû
*)
medium
;

82  
True
;

83 
	}
}

85 
	gMedŸSourû
::
	$g‘A‰ribu‹s
() const {

87 
	`’vœ
().
	`£tResuÉMsg
("");

88 
	}
}

	@liveMedia/MultiFramedRTPSink.cpp

22 
	~"MuÉiF¿medRTPSšk.hh
"

23 
	~"GroupsockH–³r.hh
"

27 
	gMuÉiF¿medRTPSšk
::
	$£tPack‘Sizes
(
´eã¼edPack‘Size
,

28 
maxPack‘Size
) {

29 ià(
´eã¼edPack‘Size
 > 
maxPack‘Size
 ||…referredPacketSize == 0) ;

32 
d–‘e
 
fOutBuf
;

33 
fOutBuf
 = 
Ãw
 
	`OutPack‘Bufãr
(
´eã¼edPack‘Size
, 
maxPack‘Size
);

34 
fOurMaxPack‘Size
 = 
maxPack‘Size
;

35 
	}
}

37 
	gMuÉiF¿medRTPSšk
::
	$MuÉiF¿medRTPSšk
(
U§geEnvœÚm’t
& 
’v
,

38 
Groupsock
* 
¹pGS
,

39 
¹pPaylßdTy³
,

40 
¹pTime¡ampF»qu’cy
,

41 cÚ¡* 
¹pPaylßdFÜm©Name
,

42 
numChªÃls
)

43 : 
	`RTPSšk
(
’v
, 
¹pGS
, 
¹pPaylßdTy³
, 
¹pTime¡ampF»qu’cy
,

44 
¹pPaylßdFÜm©Name
, 
numChªÃls
),

45 
	`fOutBuf
(
NULL
), 
	`fCurF¿gm’tiÚOff£t
(0), 
	`fP»viousF¿meEndedF¿gm’tiÚ
(
F®£
),

46 
	`fOnS’dE¼ÜFunc
(
NULL
), 
	$fOnS’dE¼ÜD©a
(
NULL
) {

47 
	`£tPack‘Sizes
(1000, 1456);

50 
	}
}

52 
	gMuÉiF¿medRTPSšk
::~
	$MuÉiF¿medRTPSšk
() {

53 
d–‘e
 
fOutBuf
;

54 
	}
}

56 
	gMuÉiF¿medRTPSšk


57 ::
	$doS³cŸlF¿meHªdlšg
(,

60 
timev®
 
äameP»£Á©iÚTime
,

64 ià(
	`isFœ¡F¿meInPack‘
()) {

65 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

67 
	}
}

69 
BoŞ—n
 
	gMuÉiF¿medRTPSšk
::
	$®lowF¿gm’tiÚAá”S¹
() const {

70  
F®£
;

71 
	}
}

73 
BoŞ—n
 
	gMuÉiF¿medRTPSšk
::
	$®lowOth”F¿mesAá”La¡F¿gm’t
() const {

74  
F®£
;

75 
	}
}

77 
BoŞ—n
 
	gMuÉiF¿medRTPSšk


78 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

80  
True
;

81 
	}
}

83 
	gMuÉiF¿medRTPSšk
::
	$¥ecŸlH—d”Size
() const {

86 
	}
}

88 
	gMuÉiF¿medRTPSšk
::
	$äameS³cificH—d”Size
() const {

91 
	}
}

93 
	gMuÉiF¿medRTPSšk
::
	$compu‹Ov”æowFÜNewF¿me
(
ÃwF¿meSize
) const {

95  
fOutBuf
->
	`numOv”æowBy‹s
(
ÃwF¿meSize
);

96 
	}
}

98 
	gMuÉiF¿medRTPSšk
::
	$£tM¬k”B™
() {

99 
¹pHdr
 = 
fOutBuf
->
	`exŒaùWÜd
(0);

100 
¹pHdr
 |= 0x00800000;

101 
fOutBuf
->
	`š£¹WÜd
(
¹pHdr
, 0);

102 
	}
}

104 
	gMuÉiF¿medRTPSšk
::
	$£tTime¡amp
(
timev®
 
äameP»£Á©iÚTime
) {

106 
fCu¼’tTime¡amp
 = 
	`cÚv”tToRTPTime¡amp
(
äameP»£Á©iÚTime
);

109 
fOutBuf
->
	`š£¹WÜd
(
fCu¼’tTime¡amp
, 
fTime¡ampPos™iÚ
);

110 
	}
}

112 
	gMuÉiF¿medRTPSšk
::
	$£tS³cŸlH—d”WÜd
(
wÜd
,

113 
wÜdPos™iÚ
) {

114 
fOutBuf
->
	`š£¹WÜd
(
wÜd
, 
fS³cŸlH—d”Pos™iÚ
 + 4*
wÜdPos™iÚ
);

115 
	}
}

117 
	gMuÉiF¿medRTPSšk
::
	$£tS³cŸlH—d”By‹s
(cÚ¡* 
by‹s
,

118 
numBy‹s
,

119 
by‹Pos™iÚ
) {

120 
fOutBuf
->
	`š£¹
(
by‹s
, 
numBy‹s
, 
fS³cŸlH—d”Pos™iÚ
 + 
by‹Pos™iÚ
);

121 
	}
}

123 
	gMuÉiF¿medRTPSšk
::
	$£tF¿meS³cificH—d”WÜd
(
wÜd
,

124 
wÜdPos™iÚ
) {

125 
fOutBuf
->
	`š£¹WÜd
(
wÜd
, 
fCurF¿meS³cificH—d”Pos™iÚ
 + 4*
wÜdPos™iÚ
);

126 
	}
}

128 
	gMuÉiF¿medRTPSšk
::
	$£tF¿meS³cificH—d”By‹s
(cÚ¡* 
by‹s
,

129 
numBy‹s
,

130 
by‹Pos™iÚ
) {

131 
fOutBuf
->
	`š£¹
(
by‹s
, 
numBy‹s
, 
fCurF¿meS³cificH—d”Pos™iÚ
 + 
by‹Pos™iÚ
);

132 
	}
}

134 
	gMuÉiF¿medRTPSšk
::
	$£tF¿mePaddšg
(
numPaddšgBy‹s
) {

135 ià(
numPaddšgBy‹s
 > 0) {

137 
·ddšgBufãr
[255];

138 
	`mem£t
(
·ddšgBufãr
, 0, 
numPaddšgBy‹s
);

139 
·ddšgBufãr
[
numPaddšgBy‹s
-1] =‚umPaddingBytes;

140 
fOutBuf
->
	`’queue
(
·ddšgBufãr
, 
numPaddšgBy‹s
);

143 
¹pHdr
 = 
fOutBuf
->
	`exŒaùWÜd
(0);

144 
¹pHdr
 |= 0x20000000;

145 
fOutBuf
->
	`š£¹WÜd
(
¹pHdr
, 0);

147 
	}
}

149 
BoŞ—n
 
	gMuÉiF¿medRTPSšk
::
	$cÚtšuePÏyšg
() {

152 
	`budAndS’dPack‘
(
True
);

153  
True
;

154 
	}
}

156 
	gMuÉiF¿medRTPSšk
::
	$¡İPÏyšg
() {

157 
fOutBuf
->
	`»£tPack‘S¹
();

158 
fOutBuf
->
	`»£tOff£t
();

159 
fOutBuf
->
	`»£tOv”æowD©a
();

162 
MedŸSšk
::
	`¡İPÏyšg
();

163 
	}
}

165 
	gMuÉiF¿medRTPSšk
::
	$budAndS’dPack‘
(
BoŞ—n
 
isFœ¡Pack‘
) {

166 
fIsFœ¡Pack‘
 = 
isFœ¡Pack‘
;

169 
¹pHdr
 = 0x80000000;

170 
¹pHdr
 |ğ(
fRTPPaylßdTy³
<<16);

171 
¹pHdr
 |ğ
fSeqNo
;

172 
fOutBuf
->
	`’queueWÜd
(
¹pHdr
);

176 
fTime¡ampPos™iÚ
 = 
fOutBuf
->
	`curPack‘Size
();

177 
fOutBuf
->
	`skBy‹s
(4);

179 
fOutBuf
->
	`’queueWÜd
(
	`SSRC
());

183 
fS³cŸlH—d”Pos™iÚ
 = 
fOutBuf
->
	`curPack‘Size
();

184 
fS³cŸlH—d”Size
 = 
	`¥ecŸlH—d”Size
();

185 
fOutBuf
->
	`skBy‹s
(
fS³cŸlH—d”Size
);

188 
fTÙ®F¿meS³cificH—d”Sizes
 = 0;

189 
fNoF¿mesLeá
 = 
F®£
;

190 
fNumF¿mesU£dSoF¬
 = 0;

191 
	`·ckF¿me
();

192 
	}
}

194 
	gMuÉiF¿medRTPSšk
::
	$·ckF¿me
() {

198 ià(
fOutBuf
->
	`haveOv”æowD©a
()) {

200 
äameSize
 = 
fOutBuf
->
	`ov”æowD©aSize
();

201 
timev®
 
´e£Á©iÚTime
 = 
fOutBuf
->
	`ov”æowP»£Á©iÚTime
();

202 
du¿tiÚInMiüo£cÚds
 = 
fOutBuf
->
	`ov”æowDu¿tiÚInMiüo£cÚds
();

203 
fOutBuf
->
	`u£Ov”æowD©a
();

205 
	`aá”G‘tšgF¿me1
(
äameSize
, 0, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

208 ià(
fSourû
 =ğ
NULL
) ;

210 
fCurF¿meS³cificH—d”Pos™iÚ
 = 
fOutBuf
->
	`curPack‘Size
();

211 
fCurF¿meS³cificH—d”Size
 = 
	`äameS³cificH—d”Size
();

212 
fOutBuf
->
	`skBy‹s
(
fCurF¿meS³cificH—d”Size
);

213 
fTÙ®F¿meS³cificH—d”Sizes
 +ğ
fCurF¿meS³cificH—d”Size
;

215 
fSourû
->
	`g‘NextF¿me
(
fOutBuf
->
	`curPŒ
(), fOutBuf->
	`tÙ®By‹sAvaabË
(),

216 
aá”G‘tšgF¿me
, 
this
, 
ourHªdËClosu»
,his);

218 
	}
}

220 
	gMuÉiF¿medRTPSšk


221 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
numBy‹sR—d
,

222 
numTrunÿ‹dBy‹s
,

223 
timev®
 
´e£Á©iÚTime
,

224 
du¿tiÚInMiüo£cÚds
) {

225 
MuÉiF¿medRTPSšk
* 
sšk
 = (MuÉiF¿medRTPSšk*)
ş›ÁD©a
;

226 
sšk
->
	`aá”G‘tšgF¿me1
(
numBy‹sR—d
, 
numTrunÿ‹dBy‹s
,

227 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

228 
	}
}

230 
	gMuÉiF¿medRTPSšk


231 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

232 
timev®
 
´e£Á©iÚTime
,

233 
du¿tiÚInMiüo£cÚds
) {

234 ià(
fIsFœ¡Pack‘
) {

236 
	`g‘timeofday
(&
fNextS’dTime
, 
NULL
);

239 
fMo¡ReûÁP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

240 ià(
fIn™ŸlP»£Á©iÚTime
.
tv_£c
 =ğ0 && fIn™ŸlP»£Á©iÚTime.
tv_u£c
 == 0) {

241 
fIn™ŸlP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

244 ià(
numTrunÿ‹dBy‹s
 > 0) {

245 cÚ¡ 
bufãrSize
 = 
fOutBuf
->
	`tÙ®By‹sAvaabË
();

246 
	`’vœ
() << "MultiFramedRTPSink::afterGettingFrame1(): The input frame data wasoo†arge for our buffer size ("

247 << 
bufãrSize
 << "). "

248 << 
numTrunÿ‹dBy‹s
 << " bytes ofrailing data was dropped! Correcthis by increasing \"OutPacketBuffer::maxSize\"o‡t†east "

249 << 
OutPack‘Bufãr
::
maxSize
 + 
numTrunÿ‹dBy‹s
 << ", *before* creatinghis 'RTPSink'. (Current value is "

250 << 
OutPack‘Bufãr
::
maxSize
 << ".)\n";

252 
curF¿gm’tiÚOff£t
 = 
fCurF¿gm’tiÚOff£t
;

253 
numF¿meBy‹sToU£
 = 
äameSize
;

254 
ov”æowBy‹s
 = 0;

260 ià(
fNumF¿mesU£dSoF¬
 > 0) {

261 ià((
fP»viousF¿meEndedF¿gm’tiÚ


262 && !
	`®lowOth”F¿mesAá”La¡F¿gm’t
())

263 || !
	`äameCªAµ—rAá”Pack‘S¹
(
fOutBuf
->
	`curPŒ
(), 
äameSize
)) {

265 
numF¿meBy‹sToU£
 = 0;

266 
fOutBuf
->
	`£tOv”æowD©a
(fOutBuf->
	`curPack‘Size
(), 
äameSize
,

267 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

270 
fP»viousF¿meEndedF¿gm’tiÚ
 = 
F®£
;

272 ià(
numF¿meBy‹sToU£
 > 0) {

274 ià(
fOutBuf
->
	`wouldOv”æow
(
äameSize
)) {

279 ià(
	`isTooBigFÜAPack‘
(
äameSize
)

280 && (
fNumF¿mesU£dSoF¬
 =ğ0 || 
	`®lowF¿gm’tiÚAá”S¹
())) {

282 
ov”æowBy‹s
 = 
	`compu‹Ov”æowFÜNewF¿me
(
äameSize
);

283 
numF¿meBy‹sToU£
 -ğ
ov”æowBy‹s
;

284 
fCurF¿gm’tiÚOff£t
 +ğ
numF¿meBy‹sToU£
;

287 
ov”æowBy‹s
 = 
äameSize
;

288 
numF¿meBy‹sToU£
 = 0;

290 
fOutBuf
->
	`£tOv”æowD©a
(fOutBuf->
	`curPack‘Size
(è+ 
numF¿meBy‹sToU£
,

291 
ov”æowBy‹s
, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

292 } ià(
fCurF¿gm’tiÚOff£t
 > 0) {

295 
fCurF¿gm’tiÚOff£t
 = 0;

296 
fP»viousF¿meEndedF¿gm’tiÚ
 = 
True
;

300 ià(
numF¿meBy‹sToU£
 =ğ0 && 
äameSize
 > 0) {

302 
	`£ndPack‘IfNeûs§ry
();

305 * 
äameS¹
 = 
fOutBuf
->
	`curPŒ
();

306 
fOutBuf
->
	`šüem’t
(
numF¿meBy‹sToU£
);

310 
	`doS³cŸlF¿meHªdlšg
(
curF¿gm’tiÚOff£t
, 
äameS¹
,

311 
numF¿meBy‹sToU£
, 
´e£Á©iÚTime
,

312 
ov”æowBy‹s
);

314 ++
fNumF¿mesU£dSoF¬
;

320 ià(
ov”æowBy‹s
 == 0) {

321 
fNextS’dTime
.
tv_u£c
 +ğ
du¿tiÚInMiüo£cÚds
;

322 
fNextS’dTime
.
tv_£c
 +ğfNextS’dTime.
tv_u£c
/1000000;

323 
fNextS’dTime
.
tv_u£c
 %= 1000000;

332 ià(
fOutBuf
->
	`isP»ã¼edSize
()

333 || 
fOutBuf
->
	`wouldOv”æow
(
numF¿meBy‹sToU£
)

334 || (
fP»viousF¿meEndedF¿gm’tiÚ
 &&

335 !
	`®lowOth”F¿mesAá”La¡F¿gm’t
())

336 || !
	`äameCªAµ—rAá”Pack‘S¹
(
fOutBuf
->
	`curPŒ
(è- 
äameSize
,

337 
äameSize
) ) {

339 
	`£ndPack‘IfNeûs§ry
();

342 
	`·ckF¿me
();

345 
	}
}

347 cÚ¡ 
	g¹pH—d”Size
 = 12;

349 
BoŞ—n
 
	gMuÉiF¿medRTPSšk
::
	$isTooBigFÜAPack‘
(
numBy‹s
) const {

353 
numBy‹s
 +ğ
¹pH—d”Size
 + 
	`¥ecŸlH—d”Size
(è+ 
	`äameS³cificH—d”Size
();

354  
fOutBuf
->
	`isTooBigFÜAPack‘
(
numBy‹s
);

355 
	}
}

357 
	gMuÉiF¿medRTPSšk
::
	$£ndPack‘IfNeûs§ry
() {

358 ià(
fNumF¿mesU£dSoF¬
 > 0) {

360 #ifdeà
TEST_LOSS


361 ià((
	`our_¿ndom
()%10) != 0)

363 ià(!
fRTPIÁ”çû
.
	`£ndPack‘
(
fOutBuf
->
	`·ck‘
(), fOutBuf->
	`curPack‘Size
())) {

365 ià(
fOnS’dE¼ÜFunc
 !ğ
NULL
è(*fOnS’dE¼ÜFunc)(
fOnS’dE¼ÜD©a
);

367 ++
fPack‘CouÁ
;

368 
fTÙ®Où‘CouÁ
 +ğ
fOutBuf
->
	`curPack‘Size
();

369 
fOù‘CouÁ
 +ğ
fOutBuf
->
	`curPack‘Size
()

370 - 
¹pH—d”Size
 - 
fS³cŸlH—d”Size
 - 
fTÙ®F¿meS³cificH—d”Sizes
;

372 ++
fSeqNo
;

375 ià(
fOutBuf
->
	`haveOv”æowD©a
()

376 && 
fOutBuf
->
	`tÙ®By‹sAvaabË
(è> fOutBuf->
	`tÙ®BufãrSize
()/2) {

381 
ÃwPack‘S¹
 = 
fOutBuf
->
	`curPack‘Size
()

382 - (
¹pH—d”Size
 + 
fS³cŸlH—d”Size
 + 
	`äameS³cificH—d”Size
());

383 
fOutBuf
->
	`adju¡Pack‘S¹
(
ÃwPack‘S¹
);

386 
fOutBuf
->
	`»£tPack‘S¹
();

388 
fOutBuf
->
	`»£tOff£t
();

389 
fNumF¿mesU£dSoF¬
 = 0;

391 ià(
fNoF¿mesLeá
) {

393 
	`ÚSourûClosu»
();

398 
timev®
 
timeNow
;

399 
	`g‘timeofday
(&
timeNow
, 
NULL
);

400 
£csDiff
 = 
fNextS’dTime
.
tv_£c
 - 
timeNow
.tv_sec;

401 
št64_t
 
uSecÚdsToGo
 = 
£csDiff
*1000000 + (
fNextS’dTime
.
tv_u£c
 - 
timeNow
.tv_usec);

402 ià(
uSecÚdsToGo
 < 0 || 
£csDiff
 < 0) {

403 
uSecÚdsToGo
 = 0;

407 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecÚdsToGo
, (
TaskFunc
*)
£ndNext
, 
this
);

409 
	}
}

412 
	gMuÉiF¿medRTPSšk
::
	$£ndNext
(* 
fœ¡Arg
) {

413 
MuÉiF¿medRTPSšk
* 
sšk
 = (MuÉiF¿medRTPSšk*)
fœ¡Arg
;

414 
sšk
->
	`budAndS’dPack‘
(
F®£
);

415 
	}
}

417 
	gMuÉiF¿medRTPSšk
::
	$ourHªdËClosu»
(* 
ş›ÁD©a
) {

418 
MuÉiF¿medRTPSšk
* 
sšk
 = (MuÉiF¿medRTPSšk*)
ş›ÁD©a
;

421 
sšk
->
fNoF¿mesLeá
 = 
True
;

422 
sšk
->
	`£ndPack‘IfNeûs§ry
();

423 
	}
}

	@liveMedia/MultiFramedRTPSource.cpp

22 
	~"MuÉiF¿medRTPSourû.hh
"

23 
	~"RTCP.hh
"

24 
	~"GroupsockH–³r.hh
"

25 
	~<¡ršg.h
>

29 şas 
	cReÜd”šgPack‘Bufãr
 {

30 
	mpublic
:

31 
ReÜd”šgPack‘Bufãr
(
Bufã»dPack‘FaùÜy
* 
·ck‘FaùÜy
);

32 
	mvœtu®
 ~
ReÜd”šgPack‘Bufãr
();

33 
»£t
();

35 
Bufã»dPack‘
* 
g‘F»ePack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

36 
BoŞ—n
 
¡ÜePack‘
(
Bufã»dPack‘
* 
bPack‘
);

37 
Bufã»dPack‘
* 
g‘NextCom¶‘edPack‘
(
BoŞ—n
& 
·ck‘LossP»ûded
);

38 
»Ëa£U£dPack‘
(
Bufã»dPack‘
* 
·ck‘
);

39 
	$ä“Pack‘
(
Bufã»dPack‘
* 
·ck‘
) {

40 ià(
·ck‘
 !ğ
fSavedPack‘
) {

41 
d–‘e
 
·ck‘
;

43 
fSavedPack‘F»e
 = 
True
;

46 
BoŞ—n
 
	$isEm±y
(ècÚ¡ {  
fH—dPack‘
 =ğ
NULL
; 
	}
}

48 
	$£tTh»shŞdTime
(
uSecÚds
è{ 
fTh»shŞdTime
 = uSecÚds; 
	}
}

49 
	$»£tHaveS“nFœ¡Pack‘
(è{ 
fHaveS“nFœ¡Pack‘
 = 
F®£
; 
	}
}

51 
	g´iv©e
:

52 
Bufã»dPack‘FaùÜy
* 
fPack‘FaùÜy
;

53 
	gfTh»shŞdTime
;

54 
BoŞ—n
 
	gfHaveS“nFœ¡Pack‘
;

55 
	gfNextEx³ùedSeqNo
;

56 
Bufã»dPack‘
* 
	gfH—dPack‘
;

57 
Bufã»dPack‘
* 
	gfTaPack‘
;

58 
Bufã»dPack‘
* 
	gfSavedPack‘
;

60 
BoŞ—n
 
	gfSavedPack‘F»e
;

66 
	gMuÉiF¿medRTPSourû


67 ::
	$MuÉiF¿medRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

68 
¹pPaylßdFÜm©
,

69 
¹pTime¡ampF»qu’cy
,

70 
Bufã»dPack‘FaùÜy
* 
·ck‘FaùÜy
)

71 : 
	$RTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

72 
	`»£t
();

73 
fReÜd”šgBufãr
 = 
Ãw
 
	`ReÜd”šgPack‘Bufãr
(
·ck‘FaùÜy
);

76 
	`šü—£ReûiveBufãrTo
(
’v
, 
RTPgs
->
	`sock‘Num
(), 50*1024);

77 
	}
}

79 
	gMuÉiF¿medRTPSourû
::
	$»£t
() {

80 
fCu¼’tPack‘BegšsF¿me
 = 
True
;

81 
fCu¼’tPack‘Com¶‘esF¿me
 = 
True
;

82 
fA»DošgN‘wÜkR—ds
 = 
F®£
;

83 
fPack‘R—dInProg»ss
 = 
NULL
;

84 
fN“dD–iv”y
 = 
F®£
;

85 
fPack‘LossInF¿gm’‹dF¿me
 = 
F®£
;

86 
	}
}

88 
	gMuÉiF¿medRTPSourû
::~
	$MuÉiF¿medRTPSourû
() {

89 
d–‘e
 
fReÜd”šgBufãr
;

90 
	}
}

92 
BoŞ—n
 
	gMuÉiF¿medRTPSourû


93 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* ,

94 & 
»suÉS³cŸlH—d”Size
) {

96 
»suÉS³cŸlH—d”Size
 = 0;

97  
True
;

98 
	}
}

100 
BoŞ—n
 
	gMuÉiF¿medRTPSourû


101 ::
	$·ck‘IsU§bËInJ™‹rC®cuÏtiÚ
(* ,

104  
True
;

105 
	}
}

107 
	gMuÉiF¿medRTPSourû
::
	$doStİG‘tšgF¿mes
() {

108 ià(
fPack‘R—dInProg»ss
 !ğ
NULL
) {

109 
fReÜd”šgBufãr
->
	`ä“Pack‘
(
fPack‘R—dInProg»ss
);

110 
fPack‘R—dInProg»ss
 = 
NULL
;

112 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

113 
fRTPIÁ”çû
.
	`¡İN‘wÜkR—dšg
();

114 
fReÜd”šgBufãr
->
	`»£t
();

115 
	`»£t
();

116 
	}
}

118 
	gMuÉiF¿medRTPSourû
::
	$doG‘NextF¿me
() {

119 ià(!
fA»DošgN‘wÜkR—ds
) {

121 
fA»DošgN‘wÜkR—ds
 = 
True
;

122 
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËr


123 ğ(
TaskScheduËr
::
BackgroundHªdËrProc
*)&
ÃtwÜkR—dHªdËr
;

124 
fRTPIÁ”çû
.
	`¡¬tN‘wÜkR—dšg
(
hªdËr
);

127 
fSavedTo
 = 
fTo
;

128 
fSavedMaxSize
 = 
fMaxSize
;

129 
fF¿meSize
 = 0;

130 
fN“dD–iv”y
 = 
True
;

131 
	`doG‘NextF¿me1
();

132 
	}
}

134 
	gMuÉiF¿medRTPSourû
::
	$doG‘NextF¿me1
() {

135 
fN“dD–iv”y
) {

137 
BoŞ—n
 
·ck‘LossP»ûdedThis
;

138 
Bufã»dPack‘
* 
ÃxtPack‘


139 ğ
fReÜd”šgBufãr
->
	`g‘NextCom¶‘edPack‘
(
·ck‘LossP»ûdedThis
);

140 ià(
ÃxtPack‘
 =ğ
NULL
) ;

142 
fN“dD–iv”y
 = 
F®£
;

144 ià(
ÃxtPack‘
->
	`u£CouÁ
() == 0) {

147 
¥ecŸlH—d”Size
;

148 ià(!
	`´oûssS³cŸlH—d”
(
ÃxtPack‘
, 
¥ecŸlH—d”Size
)) {

150 
fReÜd”šgBufãr
->
	`»Ëa£U£dPack‘
(
ÃxtPack‘
);

151 
fN“dD–iv”y
 = 
True
;

154 
ÃxtPack‘
->
	`sk
(
¥ecŸlH—d”Size
);

159 ià(
fCu¼’tPack‘BegšsF¿me
) {

160 ià(
·ck‘LossP»ûdedThis
 || 
fPack‘LossInF¿gm’‹dF¿me
) {

163 
fTo
 = 
fSavedTo
; 
fMaxSize
 = 
fSavedMaxSize
;

164 
fF¿meSize
 = 0;

166 
fPack‘LossInF¿gm’‹dF¿me
 = 
F®£
;

167 } ià(
·ck‘LossP»ûdedThis
) {

169 
fPack‘LossInF¿gm’‹dF¿me
 = 
True
;

171 ià(
fPack‘LossInF¿gm’‹dF¿me
) {

173 
fReÜd”šgBufãr
->
	`»Ëa£U£dPack‘
(
ÃxtPack‘
);

174 
fN“dD–iv”y
 = 
True
;

179 
äameSize
;

180 
ÃxtPack‘
->
	`u£
(
fTo
, 
fMaxSize
, 
äameSize
, 
fNumTrunÿ‹dBy‹s
,

181 
fCurPack‘RTPSeqNum
, 
fCurPack‘RTPTime¡amp
,

182 
fP»£Á©iÚTime
, 
fCurPack‘HasB“nSynchrÚizedUsšgRTCP
,

183 
fCurPack‘M¬k”B™
);

184 
fF¿meSize
 +ğ
äameSize
;

186 ià(!
ÃxtPack‘
->
	`hasU§bËD©a
()) {

188 
fReÜd”šgBufãr
->
	`»Ëa£U£dPack‘
(
ÃxtPack‘
);

191 ià(
fCu¼’tPack‘Com¶‘esF¿me
 && 
fF¿meSize
 > 0) {

193 ià(
fNumTrunÿ‹dBy‹s
 > 0) {

194 
	`’vœ
() << "MultiFramedRTPSource::doGetNextFrame1(): Theotal„eceived frame sizeƒxceedshe client's buffer size ("

195 << 
fSavedMaxSize
 << "). "

196 << 
fNumTrunÿ‹dBy‹s
 << " bytes ofrailing data will be dropped!\n";

199 ià(
fReÜd”šgBufãr
->
	`isEm±y
()) {

203 
	`aá”G‘tšg
(
this
);

206 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0,

207 (
TaskFunc
*)
F¿medSourû
::
aá”G‘tšg
, 
this
);

212 
fTo
 +ğ
äameSize
; 
fMaxSize
 -= frameSize;

213 
fN“dD–iv”y
 = 
True
;

216 
	}
}

218 
	gMuÉiF¿medRTPSourû


219 ::
	$£tPack‘ReÜd”šgTh»shŞdTime
(
uSecÚds
) {

220 
fReÜd”šgBufãr
->
	`£tTh»shŞdTime
(
uSecÚds
);

221 
	}
}

223 
	#ADVANCE
(
n
èdØ{ 
bPack‘
->
	`sk
Ò); } 0)

	)

225 
	gMuÉiF¿medRTPSourû
::
	$ÃtwÜkR—dHªdËr
(
MuÉiF¿medRTPSourû
* 
sourû
, ) {

226 
sourû
->
	`ÃtwÜkR—dHªdËr1
();

227 
	}
}

229 
	gMuÉiF¿medRTPSourû
::
	$ÃtwÜkR—dHªdËr1
() {

230 
Bufã»dPack‘
* 
bPack‘
 = 
fPack‘R—dInProg»ss
;

231 ià(
bPack‘
 =ğ
NULL
) {

233 
bPack‘
 = 
fReÜd”šgBufãr
->
	`g‘F»ePack‘
(
this
);

237 
BoŞ—n
 
»adSucûss
 = 
F®£
;

239 
sockaddr_š
 
äomAdd»ss
;

240 
BoŞ—n
 
·ck‘R—dWasIncom¶‘e
 = 
fPack‘R—dInProg»ss
 !ğ
NULL
;

241 ià(!
bPack‘
->
	`flInD©a
(
fRTPIÁ”çû
, 
äomAdd»ss
, 
·ck‘R—dWasIncom¶‘e
)) {

242 ià(
bPack‘
->
	`by‹sAvaabË
() == 0) {

243 
	`’vœ
() << "MultiFramedRTPSource internalƒrror: Hit†imit when„eading incoming…acket over TCP\n";

245 
fPack‘R—dInProg»ss
 = 
NULL
;

248 ià(
·ck‘R—dWasIncom¶‘e
) {

250 
fPack‘R—dInProg»ss
 = 
bPack‘
;

253 
fPack‘R—dInProg»ss
 = 
NULL
;

255 #ifdeà
TEST_LOSS


256 
	`£tPack‘ReÜd”šgTh»shŞdTime
(0);

258 ià((
	`our_¿ndom
()%10) == 0) ;

262 ià(
bPack‘
->
	`d©aSize
() < 12) ;

263 
¹pHdr
 = 
	`Áohl
(*(
u_št32_t
*)(
bPack‘
->
	`d©a
())); 
	`ADVANCE
(4);

264 
BoŞ—n
 
¹pM¬k”B™
 = (
¹pHdr
&0x00800000) != 0;

265 
¹pTime¡amp
 = 
	`Áohl
(*(
u_št32_t
*)(
bPack‘
->
	`d©a
()));
	`ADVANCE
(4);

266 
¹pSSRC
 = 
	`Áohl
(*(
u_št32_t
*)(
bPack‘
->
	`d©a
())); 
	`ADVANCE
(4);

269 ià((
¹pHdr
&0xC0000000) != 0x80000000) ;

272 
¹pPaylßdTy³
 = ()((
¹pHdr
&0x007F0000)>>16);

273 ià(
¹pPaylßdTy³
 !ğ
	`¹pPaylßdFÜm©
()) {

274 ià(
fRTCPIn¡ªûFÜMuÉËxedRTCPPack‘s
 !ğ
NULL


275 && 
¹pPaylßdTy³
 >= 64 &&„tpPayloadType <= 95) {

278 
fRTCPIn¡ªûFÜMuÉËxedRTCPPack‘s


279 ->
	`šjeùR•Üt
(
bPack‘
->
	`d©a
()-12, bPack‘->
	`d©aSize
()+12, 
äomAdd»ss
);

285 
cc
 = (
¹pHdr
>>24)&0x0F;

286 ià(
bPack‘
->
	`d©aSize
(è< 
cc
*4) ;

287 
	`ADVANCE
(
cc
*4);

290 ià(
¹pHdr
&0x10000000) {

291 ià(
bPack‘
->
	`d©aSize
() < 4) ;

292 
extHdr
 = 
	`Áohl
(*(
u_št32_t
*)(
bPack‘
->
	`d©a
())); 
	`ADVANCE
(4);

293 
»mExtSize
 = 4*(
extHdr
&0xFFFF);

294 ià(
bPack‘
->
	`d©aSize
(è< 
»mExtSize
) ;

295 
	`ADVANCE
(
»mExtSize
);

299 ià(
¹pHdr
&0x20000000) {

300 ià(
bPack‘
->
	`d©aSize
() == 0) ;

301 
numPaddšgBy‹s


302 ğ()(
bPack‘
->
	`d©a
())[bPack‘->
	`d©aSize
()-1];

303 ià(
bPack‘
->
	`d©aSize
(è< 
numPaddšgBy‹s
) ;

304 
bPack‘
->
	`»movePaddšg
(
numPaddšgBy‹s
);

308 ià(
¹pSSRC
 !ğ
fLa¡ReûivedSSRC
) {

311 
fLa¡ReûivedSSRC
 = 
¹pSSRC
;

312 
fReÜd”šgBufãr
->
	`»£tHaveS“nFœ¡Pack‘
();

314 
¹pSeqNo
 = ()(
¹pHdr
&0xFFFF);

315 
BoŞ—n
 
u§bËInJ™‹rC®cuÏtiÚ


316 ğ
	`·ck‘IsU§bËInJ™‹rC®cuÏtiÚ
((
bPack‘
->
	`d©a
()),

317 
bPack‘
->
	`d©aSize
());

318 
timev®
 
´e£Á©iÚTime
;

319 
BoŞ—n
 
hasB“nSynûdUsšgRTCP
;

320 
	`»û±iÚStsDB
()

321 .
	`nÙeIncomšgPack‘
(
¹pSSRC
, 
¹pSeqNo
, 
¹pTime¡amp
,

322 
	`time¡ampF»qu’cy
(),

323 
u§bËInJ™‹rC®cuÏtiÚ
, 
´e£Á©iÚTime
,

324 
hasB“nSynûdUsšgRTCP
, 
bPack‘
->
	`d©aSize
());

327 
timev®
 
timeNow
;

328 
	`g‘timeofday
(&
timeNow
, 
NULL
);

329 
bPack‘
->
	`assignMiscP¬ams
(
¹pSeqNo
, 
¹pTime¡amp
, 
´e£Á©iÚTime
,

330 
hasB“nSynûdUsšgRTCP
, 
¹pM¬k”B™
,

331 
timeNow
);

332 ià(!
fReÜd”šgBufãr
->
	`¡ÜePack‘
(
bPack‘
)) ;

334 
»adSucûss
 = 
True
;

336 ià(!
»adSucûss
è
fReÜd”šgBufãr
->
	`ä“Pack‘
(
bPack‘
);

338 
	`doG‘NextF¿me1
();

340 
	}
}

345 
	#MAX_PACKET_SIZE
 65536

	)

347 
	gBufã»dPack‘
::
	$Bufã»dPack‘
()

348 : 
	`fPack‘Size
(
MAX_PACKET_SIZE
),

349 
	`fBuf
(
Ãw
 [
MAX_PACKET_SIZE
]),

350 
	$fNextPack‘
(
NULL
) {

351 
	}
}

353 
	gBufã»dPack‘
::~
	$Bufã»dPack‘
() {

354 
d–‘e
 
fNextPack‘
;

355 
d–‘e
[] 
fBuf
;

356 
	}
}

358 
	gBufã»dPack‘
::
	$»£t
() {

359 
fH—d
 = 
fTa
 = 0;

360 
fU£CouÁ
 = 0;

361 
fIsFœ¡Pack‘
 = 
F®£
;

362 
	}
}

365 
	gBufã»dPack‘


366 ::
	$ÃxtEnşo£dF¿meSize
(*& , 
d©aSize
) {

370  
d©aSize
;

371 
	}
}

373 
	gBufã»dPack‘


374 ::
	$g‘NextEnşo£dF¿meP¬am‘”s
(*& 
äamePŒ
, 
d©aSize
,

375 & 
äameSize
,

376 & 
äameDu¿tiÚInMiüo£cÚds
) {

383 
äameSize
 = 
	`ÃxtEnşo£dF¿meSize
(
äamePŒ
, 
d©aSize
);

385 
äameDu¿tiÚInMiüo£cÚds
 = 0;

386 
	}
}

388 
BoŞ—n
 
	gBufã»dPack‘
::
	$flInD©a
(
RTPIÁ”çû
& 
¹pIÁ”çû
, 
sockaddr_š
& 
äomAdd»ss
,

389 
BoŞ—n
& 
·ck‘R—dWasIncom¶‘e
) {

390 ià(!
·ck‘R—dWasIncom¶‘e
è
	`»£t
();

392 cÚ¡ 
maxBy‹sToR—d
 = 
	`by‹sAvaabË
();

393 ià(
maxBy‹sToR—d
 =ğ0è 
F®£
;

395 
numBy‹sR—d
;

396 
tıSock‘Num
;

397 
tıSŒ—mChªÃlId
;

398 ià(!
¹pIÁ”çû
.
	`hªdËR—d
(&
fBuf
[
fTa
], 
maxBy‹sToR—d
,

399 
numBy‹sR—d
, 
äomAdd»ss
,

400 
tıSock‘Num
, 
tıSŒ—mChªÃlId
,

401 
·ck‘R—dWasIncom¶‘e
)) {

402  
F®£
;

404 
fTa
 +ğ
numBy‹sR—d
;

405  
True
;

406 
	}
}

408 
	gBufã»dPack‘


409 ::
	$assignMiscP¬ams
(
¹pSeqNo
, 
¹pTime¡amp
,

410 
timev®
 
´e£Á©iÚTime
,

411 
BoŞ—n
 
hasB“nSynûdUsšgRTCP
, BoŞ—À
¹pM¬k”B™
,

412 
timev®
 
timeReûived
) {

413 
fRTPSeqNo
 = 
¹pSeqNo
;

414 
fRTPTime¡amp
 = 
¹pTime¡amp
;

415 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

416 
fHasB“nSynûdUsšgRTCP
 = 
hasB“nSynûdUsšgRTCP
;

417 
fRTPM¬k”B™
 = 
¹pM¬k”B™
;

418 
fTimeReûived
 = 
timeReûived
;

419 
	}
}

421 
	gBufã»dPack‘
::
	$sk
(
numBy‹s
) {

422 
fH—d
 +ğ
numBy‹s
;

423 ià(
fH—d
 > 
fTa
) fHead = fTail;

424 
	}
}

426 
	gBufã»dPack‘
::
	$»movePaddšg
(
numBy‹s
) {

427 ià(
numBy‹s
 > 
fTa
-
fH—d
)‚umBytes = fTail-fHead;

428 
fTa
 -ğ
numBy‹s
;

429 
	}
}

431 
	gBufã»dPack‘
::
	$­³ndD©a
(* 
ÃwD©a
, 
numBy‹s
) {

432 ià(
numBy‹s
 > 
fPack‘Size
-
fTa
)‚umBytes = fPacketSize - fTail;

433 
	`memmove
(&
fBuf
[
fTa
], 
ÃwD©a
, 
numBy‹s
);

434 
fTa
 +ğ
numBy‹s
;

435 
	}
}

437 
	gBufã»dPack‘
::
	$u£
(* 
to
, 
toSize
,

438 & 
by‹sU£d
, & 
by‹sTrunÿ‹d
,

439 & 
¹pSeqNo
, & 
¹pTime¡amp
,

440 
timev®
& 
´e£Á©iÚTime
,

441 
BoŞ—n
& 
hasB“nSynûdUsšgRTCP
,

442 
BoŞ—n
& 
¹pM¬k”B™
) {

443 * 
ÜigF¿mePŒ
 = &
fBuf
[
fH—d
];

444 * 
ÃwF¿mePŒ
 = 
ÜigF¿mePŒ
;

445 
äameSize
, 
äameDu¿tiÚInMiüo£cÚds
;

446 
	`g‘NextEnşo£dF¿meP¬am‘”s
(
ÃwF¿mePŒ
, 
fTa
 - 
fH—d
,

447 
äameSize
, 
äameDu¿tiÚInMiüo£cÚds
);

448 ià(
äameSize
 > 
toSize
) {

449 
by‹sTrunÿ‹d
 +ğ
äameSize
 - 
toSize
;

450 
by‹sU£d
 = 
toSize
;

452 
by‹sTrunÿ‹d
 = 0;

453 
by‹sU£d
 = 
äameSize
;

456 
	`memmove
(
to
, 
ÃwF¿mePŒ
, 
by‹sU£d
);

457 
fH—d
 +ğ(
ÃwF¿mePŒ
 - 
ÜigF¿mePŒ
è+ 
äameSize
;

458 ++
fU£CouÁ
;

460 
¹pSeqNo
 = 
fRTPSeqNo
;

461 
¹pTime¡amp
 = 
fRTPTime¡amp
;

462 
´e£Á©iÚTime
 = 
fP»£Á©iÚTime
;

463 
hasB“nSynûdUsšgRTCP
 = 
fHasB“nSynûdUsšgRTCP
;

464 
¹pM¬k”B™
 = 
fRTPM¬k”B™
;

467 
fP»£Á©iÚTime
.
tv_u£c
 +ğ
äameDu¿tiÚInMiüo£cÚds
;

468 ià(
fP»£Á©iÚTime
.
tv_u£c
 >= 1000000) {

469 
fP»£Á©iÚTime
.
tv_£c
 +ğfP»£Á©iÚTime.
tv_u£c
/1000000;

470 
fP»£Á©iÚTime
.
tv_u£c
 = fPresentationTime.tv_usec%1000000;

472 
	}
}

474 
	gBufã»dPack‘FaùÜy
::
	$Bufã»dPack‘FaùÜy
() {

475 
	}
}

477 
Bufã»dPack‘FaùÜy
::~
	$Bufã»dPack‘FaùÜy
() {

478 
	}
}

480 
Bufã»dPack‘
* 
Bufã»dPack‘FaùÜy


481 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* ) {

482  
Ãw
 
Bufã»dPack‘
;

483 
	}
}

488 
	gReÜd”šgPack‘Bufãr


489 ::
	$ReÜd”šgPack‘Bufãr
(
Bufã»dPack‘FaùÜy
* 
·ck‘FaùÜy
)

490 : 
	`fTh»shŞdTime
(100000) ,

491 
	`fHaveS“nFœ¡Pack‘
(
F®£
), 
	`fH—dPack‘
(
NULL
), 
	`fTaPack‘
(NULL), 
	`fSavedPack‘
(NULL), 
	$fSavedPack‘F»e
(
True
) {

492 
fPack‘FaùÜy
 = (
·ck‘FaùÜy
 =ğ
NULL
)

493 ? (
Ãw
 
Bufã»dPack‘FaùÜy
)

494 : 
·ck‘FaùÜy
;

495 
	}
}

497 
	gReÜd”šgPack‘Bufãr
::~
	$ReÜd”šgPack‘Bufãr
() {

498 
	`»£t
();

499 
d–‘e
 
fPack‘FaùÜy
;

500 
	}
}

502 
	gReÜd”šgPack‘Bufãr
::
	$»£t
() {

503 ià(
fSavedPack‘F»e
è
d–‘e
 
fSavedPack‘
;

504 
d–‘e
 
fH—dPack‘
;

505 
	`»£tHaveS“nFœ¡Pack‘
();

506 
fH—dPack‘
 = 
fTaPack‘
 = 
fSavedPack‘
 = 
NULL
;

507 
	}
}

509 
Bufã»dPack‘
* 
	gReÜd”šgPack‘Bufãr
::
	$g‘F»ePack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

510 ià(
fSavedPack‘
 =ğ
NULL
) {

511 
fSavedPack‘
 = 
fPack‘FaùÜy
->
	`ü—‹NewPack‘
(
ourSourû
);

512 
fSavedPack‘F»e
 = 
True
;

515 ià(
fSavedPack‘F»e
 =ğ
True
) {

516 
fSavedPack‘F»e
 = 
F®£
;

517  
fSavedPack‘
;

519  
fPack‘FaùÜy
->
	`ü—‹NewPack‘
(
ourSourû
);

521 
	}
}

523 
BoŞ—n
 
	gReÜd”šgPack‘Bufãr
::
	$¡ÜePack‘
(
Bufã»dPack‘
* 
bPack‘
) {

524 
¹pSeqNo
 = 
bPack‘
->
	`¹pSeqNo
();

526 ià(!
fHaveS“nFœ¡Pack‘
) {

527 
fNextEx³ùedSeqNo
 = 
¹pSeqNo
;

528 
bPack‘
->
	`isFœ¡Pack‘
(èğ
True
;

529 
fHaveS“nFœ¡Pack‘
 = 
True
;

534 ià(
	`£qNumLT
(
¹pSeqNo
, 
fNextEx³ùedSeqNo
)è 
F®£
;

536 ià(
fTaPack‘
 =ğ
NULL
) {

538 
bPack‘
->
	`ÃxtPack‘
(èğ
NULL
;

539 
fH—dPack‘
 = 
fTaPack‘
 = 
bPack‘
;

540  
True
;

543 ià(
	`£qNumLT
(
fTaPack‘
->
	`¹pSeqNo
(), 
¹pSeqNo
)) {

545 
bPack‘
->
	`ÃxtPack‘
(èğ
NULL
;

546 
fTaPack‘
->
	`ÃxtPack‘
(èğ
bPack‘
;

547 
fTaPack‘
 = 
bPack‘
;

548  
True
;

551 ià(
¹pSeqNo
 =ğ
fTaPack‘
->
	`¹pSeqNo
()) {

553  
F®£
;

557 
Bufã»dPack‘
* 
befÜePŒ
 = 
NULL
;

558 
Bufã»dPack‘
* 
aá”PŒ
 = 
fH—dPack‘
;

559 
aá”PŒ
 !ğ
NULL
) {

560 ià(
	`£qNumLT
(
¹pSeqNo
, 
aá”PŒ
->
	`¹pSeqNo
())) ;

561 ià(
¹pSeqNo
 =ğ
aá”PŒ
->
	`¹pSeqNo
()) {

563  
F®£
;

566 
befÜePŒ
 = 
aá”PŒ
;

567 
aá”PŒ
 =‡á”PŒ->
	`ÃxtPack‘
();

571 
bPack‘
->
	`ÃxtPack‘
(èğ
aá”PŒ
;

572 ià(
befÜePŒ
 =ğ
NULL
) {

573 
fH—dPack‘
 = 
bPack‘
;

575 
befÜePŒ
->
	`ÃxtPack‘
(èğ
bPack‘
;

578  
True
;

579 
	}
}

581 
	gReÜd”šgPack‘Bufãr
::
	$»Ëa£U£dPack‘
(
Bufã»dPack‘
* 
·ck‘
) {

584 ++
fNextEx³ùedSeqNo
;

586 
fH—dPack‘
 = fH—dPack‘->
	`ÃxtPack‘
();

587 ià(!
fH—dPack‘
) {

588 
fTaPack‘
 = 
NULL
;

590 
·ck‘
->
	`ÃxtPack‘
(èğ
NULL
;

592 
	`ä“Pack‘
(
·ck‘
);

593 
	}
}

595 
Bufã»dPack‘
* 
	gReÜd”šgPack‘Bufãr


596 ::
	$g‘NextCom¶‘edPack‘
(
BoŞ—n
& 
·ck‘LossP»ûded
) {

597 ià(
fH—dPack‘
 =ğ
NULL
)  NULL;

602 ià(
fH—dPack‘
->
	`¹pSeqNo
(è=ğ
fNextEx³ùedSeqNo
) {

603 
·ck‘LossP»ûded
 = 
fH—dPack‘
->
	`isFœ¡Pack‘
();

605  
fH—dPack‘
;

611 
BoŞ—n
 
timeTh»shŞdHasB“nExûeded
;

612 ià(
fTh»shŞdTime
 == 0) {

613 
timeTh»shŞdHasB“nExûeded
 = 
True
;

615 
timev®
 
timeNow
;

616 
	`g‘timeofday
(&
timeNow
, 
NULL
);

617 
uSecÚdsSšûReûived


618 ğ(
timeNow
.
tv_£c
 - 
fH—dPack‘
->
	`timeReûived
().tv_sec)*1000000

619 + (
timeNow
.
tv_u£c
 - 
fH—dPack‘
->
	`timeReûived
().tv_usec);

620 
timeTh»shŞdHasB“nExûeded
 = 
uSecÚdsSšûReûived
 > 
fTh»shŞdTime
;

622 ià(
timeTh»shŞdHasB“nExûeded
) {

623 
fNextEx³ùedSeqNo
 = 
fH—dPack‘
->
	`¹pSeqNo
();

625 
·ck‘LossP»ûded
 = 
True
;

626  
fH—dPack‘
;

630  
NULL
;

631 
	}
}

	@liveMedia/OggDemuxedTrack.cpp

21 
	~"OggDemuxedT¿ck.hh
"

22 
	~"OggFe.hh
"

24 
	gOggDemuxedT¿ck
::
	$OggDemuxedT¿ck
(
U§geEnvœÚm’t
& 
’v
, 
ŒackNumb”
, 
OggDemux
& 
sourûDemux
)

25 : 
	`F¿medSourû
(
’v
),

26 
	`fOurT¿ckNumb”
(
ŒackNumb”
), 
	`fOurSourûDemux
(
sourûDemux
),

27 
	$fCu¼’tPageIsCÚtšu©iÚ
(
F®£
) {

28 
fNextP»£Á©iÚTime
.
tv_£c
 = 0; fNextP»£Á©iÚTime.
tv_u£c
 = 0;

29 
	}
}

31 
	gOggDemuxedT¿ck
::~
	$OggDemuxedT¿ck
() {

32 
fOurSourûDemux
.
	`»moveT¿ck
(
fOurT¿ckNumb”
);

33 
	}
}

35 
	gOggDemuxedT¿ck
::
	$doG‘NextF¿me
() {

36 
fOurSourûDemux
.
	`cÚtšueR—dšg
();

37 
	}
}

39 cÚ¡* 
	gOggDemuxedT¿ck
::
	$MIMEty³
() const {

40 
OggT¿ck
* 
Œack
 = 
fOurSourûDemux
.
fOurFe
.
	`lookup
(
fOurT¿ckNumb”
);

41 ià(
Œack
 =ğ
NULL
)  "(unknown)";

42  
Œack
->
mimeTy³
;

43 
	}
}

	@liveMedia/OggFile.cpp

21 
	~"OggFeP¬£r.hh
"

22 
	~"OggDemuxedT¿ck.hh
"

23 
	~"By‹SŒ—mFeSourû.hh
"

24 
	~"VÜbisAudioRTPSšk.hh
"

25 
	~"Sim¶eRTPSšk.hh
"

26 
	~"TheÜaVideoRTPSšk.hh
"

32 şas 
	cOggT¿ckTabË
 {

33 
	mpublic
:

34 
OggT¿ckTabË
();

35 
	mvœtu®
 ~
OggT¿ckTabË
();

37 
add
(
OggT¿ck
* 
ÃwT¿ck
);

38 
OggT¿ck
* 
lookup
(
u_št32_t
 
ŒackNumb”
);

40 
	$numT¿cks
() const;

42 
´iv©e
:

43 
ä›nd
 
şass
 
OggT¿ckTabËI‹¿tÜ
;

44 
HashTabË
* 
fTabË
;

50 
OggFe
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

51 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
) {

52 
Ãw
 
	`OggFe
(
’v
, 
feName
, 
ÚC»©iÚ
, 
ÚC»©iÚCl›ÁD©a
);

53 
	}
}

55 
OggT¿ck
* 
	gOggFe
::
	$lookup
(
u_št32_t
 
ŒackNumb”
) {

56  
fT¿ckTabË
->
	`lookup
(
ŒackNumb”
);

57 
	}
}

59 
OggDemux
* 
	gOggFe
::
	$ÃwDemux
() {

60 
OggDemux
* 
demux
 = 
Ãw
 
	`OggDemux
(*
this
);

61 
fDemuxesTabË
->
	`Add
((cÚ¡*)
demux
, demux);

63  
demux
;

64 
	}
}

66 
	gOggFe
::
	$numT¿cks
() const {

67  
fT¿ckTabË
->
	`numT¿cks
();

68 
	}
}

70 
F¿medSourû
* 
	gOggFe


71 ::
	$ü—‹SourûFÜSŒ—mšg
(
F¿medSourû
* 
ba£Sourû
, 
u_št32_t
 
ŒackNumb”
,

72 & 
e¡B™¿‹
, & 
numF‹rsInFrÚtOfT¿ck
) {

73 ià(
ba£Sourû
 =ğ
NULL
)  NULL;

75 
F¿medSourû
* 
»suÉ
 = 
ba£Sourû
;

76 
numF‹rsInFrÚtOfT¿ck
 = 0;

81 
OggT¿ck
* 
Œack
 = 
	`lookup
(
ŒackNumb”
);

82 ià(
Œack
 !ğ
NULL
) {

83 
e¡B™¿‹
 = 
Œack
->estBitrate;

86  
»suÉ
;

87 
	}
}

89 
RTPSšk
* 
	gOggFe


90 ::
	$ü—‹RTPSškFÜT¿ckNumb”
(
u_št32_t
 
ŒackNumb”
, 
Groupsock
* 
¹pGroupsock
,

91 
¹pPaylßdTy³IfDyÇmic
) {

92 
OggT¿ck
* 
Œack
 = 
	`lookup
(
ŒackNumb”
);

93 ià(
Œack
 =ğ
NULL
 ||¿ck->
mimeTy³
 == NULL)  NULL;

95 
RTPSšk
* 
»suÉ
 = 
NULL
;

97 ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0) {

100 
»suÉ
 = 
VÜbisAudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

101 
Œack
->
§m¶šgF»qu’cy
,¿ck->
numChªÃls
,

102 
Œack
->
vtoHdrs
.
h—d”
[0],¿ck->vtoHdrs.
h—d”Size
[0],

103 
Œack
->
vtoHdrs
.
h—d”
[1],¿ck->vtoHdrs.
h—d”Size
[1],

104 
Œack
->
vtoHdrs
.
h—d”
[2],¿ck->vtoHdrs.
h—d”Size
[2]);

105 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/OPUS") == 0) {

106 
»suÉ
 = 
Sim¶eRTPSšk


107 ::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

108 48000, "audio", "OPUS", 2, 
F®£
 );

109 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0) {

112 
»suÉ
 = 
TheÜaVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

113 
Œack
->
vtoHdrs
.
h—d”
[0],¿ck->vtoHdrs.
h—d”Size
[0],

114 
Œack
->
vtoHdrs
.
h—d”
[1],¿ck->vtoHdrs.
h—d”Size
[1],

115 
Œack
->
vtoHdrs
.
h—d”
[2],¿ck->vtoHdrs.
h—d”Size
[2]);

118  
»suÉ
;

119 
	}
}

122 
	gOggFe
::
	$OggFe
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

123 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
)

124 : 
	`Medium
(
’v
),

125 
	`fFeName
(
	`¡rDup
(
feName
)),

126 
	`fOnC»©iÚ
(
ÚC»©iÚ
), 
	$fOnC»©iÚCl›ÁD©a
(
ÚC»©iÚCl›ÁD©a
) {

127 
fT¿ckTabË
 = 
Ãw
 
OggT¿ckTabË
;

128 
fDemuxesTabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

130 
F¿medSourû
* 
šputSourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
feName
);

131 ià(
šputSourû
 =ğ
NULL
) {

133 
fP¬£rFÜIn™Ÿliz©iÚ
 = 
NULL
;

134 
	`hªdËEndOfBosPageP¬sšg
();

137 
fP¬£rFÜIn™Ÿliz©iÚ


138 ğ
Ãw
 
	`OggFeP¬£r
(*
this
, 
šputSourû
, 
hªdËEndOfBosPageP¬sšg
,his);

140 
	}
}

142 
	gOggFe
::~
	$OggFe
() {

143 
d–‘e
 
fP¬£rFÜIn™Ÿliz©iÚ
;

146 
OggDemux
* 
demux
;

147 (
demux
 = (
OggDemux
*)
fDemuxesTabË
->
	`RemoveNext
()è!ğ
NULL
) {

148 
d–‘e
 
demux
;

150 
d–‘e
 
fDemuxesTabË
;

151 
d–‘e
 
fT¿ckTabË
;

153 
d–‘e
[] (*)
fFeName
;

154 
	}
}

156 
	gOggFe
::
	$hªdËEndOfBosPageP¬sšg
(* 
ş›ÁD©a
) {

157 ((
OggFe
*)
ş›ÁD©a
)->
	`hªdËEndOfBosPageP¬sšg
();

158 
	}
}

160 
	gOggFe
::
	$hªdËEndOfBosPageP¬sšg
() {

162 
d–‘e
 
fP¬£rFÜIn™Ÿliz©iÚ
; fP¬£rFÜIn™Ÿliz©iÚ = 
NULL
;

165 ià(
fOnC»©iÚ
 !ğ
NULL
è(*fOnC»©iÚ)(
this
, 
fOnC»©iÚCl›ÁD©a
);

166 
	}
}

168 
	gOggFe
::
	$addT¿ck
(
OggT¿ck
* 
ÃwT¿ck
) {

169 
fT¿ckTabË
->
	`add
(
ÃwT¿ck
);

170 
	}
}

172 
	gOggFe
::
	$»moveDemux
(
OggDemux
* 
demux
) {

173 
fDemuxesTabË
->
	`Remove
((cÚ¡*)
demux
);

174 
	}
}

179 
	gOggT¿ckTabË
::
	$OggT¿ckTabË
()

180 : 
	`fTabË
(
HashTabË
::
	$ü—‹
(
ONE_WORD_HASH_KEYS
)) {

181 
	}
}

183 
OggT¿ckTabË
::~
	$OggT¿ckTabË
() {

185 
OggT¿ck
* 
Œack
;

186 (
Œack
 = (
OggT¿ck
*)
fTabË
->
	`RemoveNext
()è!ğ
NULL
) {

187 
d–‘e
 
Œack
;

189 
d–‘e
 
fTabË
;

190 
	}
}

192 
	gOggT¿ckTabË
::
	$add
(
OggT¿ck
* 
ÃwT¿ck
) {

193 
OggT¿ck
* 
exi¡šgT¿ck


194 ğ(
OggT¿ck
*)
fTabË
->
	`Add
((cÚ¡*)
ÃwT¿ck
->
ŒackNumb”
,‚ewTrack);

195 
d–‘e
 
exi¡šgT¿ck
;

196 
	}
}

198 
OggT¿ck
* 
	gOggT¿ckTabË
::
	$lookup
(
u_št32_t
 
ŒackNumb”
) {

199  (
OggT¿ck
*)
fTabË
->
	`Lookup
((cÚ¡*)
ŒackNumb”
);

200 
	}
}

202 
	gOggT¿ckTabË
::
	$numT¿cks
(ècÚ¡ {  
fTabË
->
	`numEÁr›s
(); 
	}
}

204 
	gOggT¿ckTabËI‹¿tÜ
::
	$OggT¿ckTabËI‹¿tÜ
(
OggT¿ckTabË
& 
ourTabË
) {

205 
fI‹r
 = 
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*(
ourTabË
.
fTabË
));

206 
	}
}

208 
	gOggT¿ckTabËI‹¿tÜ
::~
	$OggT¿ckTabËI‹¿tÜ
() {

209 
d–‘e
 
fI‹r
;

210 
	}
}

212 
OggT¿ck
* 
	gOggT¿ckTabËI‹¿tÜ
::
	$Ãxt
() {

213 cÚ¡* 
key
;

214  (
OggT¿ck
*)
fI‹r
->
	`Ãxt
(
key
);

215 
	}
}

220 
	gOggT¿ck
::
	$OggT¿ck
()

221 : 
	`ŒackNumb”
(0), 
	`mimeTy³
(
NULL
),

222 
	`§m¶šgF»qu’cy
(48000), 
	`numChªÃls
(2), 
	$e¡B™¿‹
(100) {

223 
vtoHdrs
.
h—d”
[0] = vtoHdrs.h—d”[1] = vtoHdrs.h—d”[2] = 
NULL
;

224 
vtoHdrs
.
h—d”Size
[0] = vtoHdrs.headerSize[1] = vtoHdrs.headerSize[2] = 0;

226 
vtoHdrs
.
vÜbis_mode_couÁ
 = 0;

227 
vtoHdrs
.
vÜbis_mode_blockæag
 = 
NULL
;

228 
	}
}

230 
	gOggT¿ck
::~
	$OggT¿ck
() {

231 
d–‘e
[] 
vtoHdrs
.
h—d”
[0]; delete[] vtoHdrs.header[1]; delete[] vtoHdrs.header[2];

232 
d–‘e
[] 
vtoHdrs
.
vÜbis_mode_blockæag
;

233 
	}
}

238 
F¿medSourû
* 
	gOggDemux
::
	$ÃwDemuxedT¿ck
(
u_št32_t
& 
»suÉT¿ckNumb”
) {

239 
OggT¿ck
* 
ÃxtT¿ck
;

241 
ÃxtT¿ck
 = 
fI‹r
->
	`Ãxt
();

242 } 
ÃxtT¿ck
 !ğ
NULL
 &&‚extT¿ck->
mimeTy³
 == NULL);

244 ià(
ÃxtT¿ck
 =ğ
NULL
) {

245 
»suÉT¿ckNumb”
 = 0;

246  
NULL
;

249 
»suÉT¿ckNumb”
 = 
ÃxtT¿ck
->
ŒackNumb”
;

250 
F¿medSourû
* 
ŒackSourû
 = 
Ãw
 
	`OggDemuxedT¿ck
(
	`’vœ
(), 
»suÉT¿ckNumb”
, *
this
);

251 
fDemuxedT¿cksTabË
->
	`Add
((cÚ¡*)
»suÉT¿ckNumb”
, 
ŒackSourû
);

252  
ŒackSourû
;

253 
	}
}

255 
F¿medSourû
* 
	gOggDemux
::
	$ÃwDemuxedT¿ckByT¿ckNumb”
(
ŒackNumb”
) {

256 ià(
ŒackNumb”
 =ğ0è 
NULL
;

258 
F¿medSourû
* 
ŒackSourû
 = 
Ãw
 
	`OggDemuxedT¿ck
(
	`’vœ
(), 
ŒackNumb”
, *
this
);

259 
fDemuxedT¿cksTabË
->
	`Add
((cÚ¡*)
ŒackNumb”
, 
ŒackSourû
);

260  
ŒackSourû
;

261 
	}
}

263 
OggDemuxedT¿ck
* 
	gOggDemux
::
	$lookupDemuxedT¿ck
(
u_št32_t
 
ŒackNumb”
) {

264  (
OggDemuxedT¿ck
*)
fDemuxedT¿cksTabË
->
	`Lookup
((cÚ¡*)
ŒackNumb”
);

265 
	}
}

267 
	gOggDemux
::
	$OggDemux
(
OggFe
& 
ourFe
)

268 : 
	`Medium
(
ourFe
.
	`’vœ
()),

269 
	`fOurFe
(
ourFe
), 
	`fDemuxedT¿cksTabË
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)),

270 
	`fI‹r
(
Ãw
 
	$OggT¿ckTabËI‹¿tÜ
(*
fOurFe
.
fT¿ckTabË
)) {

271 
F¿medSourû
* 
feSourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(
	`’vœ
(), 
ourFe
.
	`feName
());

272 
fOurP¬£r
 = 
Ãw
 
	`OggFeP¬£r
(
ourFe
, 
feSourû
, 
hªdËEndOfFe
, 
this
,his);

273 
	}
}

275 
	gOggDemux
::~
	$OggDemux
() {

278 
	`hªdËEndOfFe
();

282 
d–‘e
 
fDemuxedT¿cksTabË
;

284 
d–‘e
 
fI‹r
;

285 
d–‘e
 
fOurP¬£r
;

286 
fOurFe
.
	`»moveDemux
(
this
);

287 
	}
}

289 
	gOggDemux
::
	$»moveT¿ck
(
u_št32_t
 
ŒackNumb”
) {

290 
fDemuxedT¿cksTabË
->
	`Remove
((cÚ¡*)
ŒackNumb”
);

291 ià(
fDemuxedT¿cksTabË
->
	`numEÁr›s
() == 0) {

293 
d–‘e
 
this
;

295 
	}
}

297 
	gOggDemux
::
	$cÚtšueR—dšg
() {

298 
fOurP¬£r
->
	`cÚtšueP¬sšg
();

299 
	}
}

301 
	gOggDemux
::
	$hªdËEndOfFe
(* 
ş›ÁD©a
) {

302 ((
OggDemux
*)
ş›ÁD©a
)->
	`hªdËEndOfFe
();

303 
	}
}

305 
	gOggDemux
::
	$hªdËEndOfFe
() {

309 
numT¿cks
 = 
fDemuxedT¿cksTabË
->
	`numEÁr›s
();

310 ià(
numT¿cks
 == 0) ;

311 
OggDemuxedT¿ck
** 
Œacks
 = 
Ãw
 OggDemuxedT¿ck*[
numT¿cks
];

313 
HashTabË
::
I‹¿tÜ
* 
™”
 = HashTabË::I‹¿tÜ::
	`ü—‹
(*
fDemuxedT¿cksTabË
);

314 
i
;

315 cÚ¡* 
ŒackNumb”
;

317 
i
 = 0; i < 
numT¿cks
; ++i) {

318 
Œacks
[
i
] = (
OggDemuxedT¿ck
*)
™”
->
	`Ãxt
(
ŒackNumb”
);

320 
d–‘e
 
™”
;

322 
i
 = 0; i < 
numT¿cks
; ++i) {

323 ià(
Œacks
[
i
] =ğ
NULL
) ;

324 
Œacks
[
i
]->
	`hªdËClosu»
();

327 
d–‘e
[] 
Œacks
;

328 
	}
}

	@liveMedia/OggFileParser.cpp

21 
	~"OggFeP¬£r.hh
"

22 
	~"OggDemuxedT¿ck.hh
"

23 
	~<GroupsockH–³r.hh
>

25 
	gPack‘SizeTabË
::
	$Pack‘SizeTabË
(
numb”_·ge_£gm’ts
)

26 : 
	`numCom¶‘edPack‘s
(0), 
	`tÙSizes
(0), 
	`ÃxtPack‘NumToD–iv”
(0),

27 
	$Ï¡Pack‘IsIncom¶‘e
(
F®£
) {

28 
size
 = 
Ãw
 [
numb”_·ge_£gm’ts
];

29 
i
 = 0; i < 
numb”_·ge_£gm’ts
; ++iè
size
[i] = 0;

30 
	}
}

32 
	gPack‘SizeTabË
::~
	$Pack‘SizeTabË
() {

33 
d–‘e
[] 
size
;

34 
	}
}

36 
	gOggFeP¬£r
::
OggFeP¬£r
(
OggFe
& 
ourFe
, 
F¿medSourû
* 
šputSourû
,

37 
F¿medSourû
::
ÚClo£Func
* 
ÚEndFunc
, * 
ÚEndCl›ÁD©a
,

38 
OggDemux
* 
ourDemux
)

39 : 
SŒ—mP¬£r
(
šputSourû
, 
ÚEndFunc
, 
ÚEndCl›ÁD©a
, 
cÚtšueP¬sšg
, 
this
),

40 
fOurFe
(
ourFe
), 
fIÅutSourû
(
šputSourû
),

41 
fOnEndFunc
(
ÚEndFunc
), 
fOnEndCl›ÁD©a
(
ÚEndCl›ÁD©a
),

42 
fOurDemux
(
ourDemux
), 
fNumUnfulfËdT¿cks
(0),

43 
fPack‘SizeTabË
(
NULL
), 
fCu¼’tT¿ckNumb”
(0), 
	$fSavedPack‘
(
NULL
) {

44 ià(
ourDemux
 =ğ
NULL
) {

46 
fCu¼’tP¬£S‹
 = 
PARSING_START_OF_FILE
;

47 
	`cÚtšueP¬sšg
();

49 
fCu¼’tP¬£S‹
 = 
PARSING_AND_DELIVERING_PAGES
;

52 
	}
}

54 
	gOggFeP¬£r
::~
	$OggFeP¬£r
() {

55 
d–‘e
[] 
fSavedPack‘
;

56 
d–‘e
 
fPack‘SizeTabË
;

57 
Medium
::
	`şo£
(
fIÅutSourû
);

58 
	}
}

60 
	gOggFeP¬£r
::
	$cÚtšueP¬sšg
(* 
ş›ÁD©a
, * 
±r
, 
size
, 
timev®
 
´e£Á©iÚTime
) {

61 ((
OggFeP¬£r
*)
ş›ÁD©a
)->
	`cÚtšueP¬sšg
();

62 
	}
}

64 
	gOggFeP¬£r
::
	$cÚtšueP¬sšg
() {

65 ià(
fIÅutSourû
 !ğ
NULL
) {

66 ià(
fIÅutSourû
->
	`isCu¼’yAwa™šgD©a
()) ;

69 ià(!
	`·r£
()) {

78 ià(
fOnEndFunc
 !ğ
NULL
è(*fOnEndFunc)(
fOnEndCl›ÁD©a
);

79 
	}
}

81 
BoŞ—n
 
	gOggFeP¬£r
::
	$·r£
() {

82 
Œy
 {

84 
fCu¼’tP¬£S‹
) {

85 
PARSING_START_OF_FILE
: {

86 ià(
	`·r£S¹OfFe
()è 
True
;

88 
PARSING_AND_DELIVERING_PAGES
: {

89 
	`·r£AndD–iv”Pages
();

91 
DELIVERING_PACKET_WITHIN_PAGE
: {

92 ià(
	`d–iv”Pack‘W™hšPage
()è 
F®£
;

96 } 
	`ÿtch
 () {

97 #ifdeà
DEBUG


98 
	`årštf
(
¡d”r
, "OggFileParser::parse() EXCEPTION (This is‚ormal behavior - *not*‡nƒrror)\n");

100  
F®£
;

102 
	}
}

104 
BoŞ—n
 
	gOggFeP¬£r
::
	$·r£S¹OfFe
() {

105 #ifdeà
DEBUG


106 
	`årštf
(
¡d”r
, "parsing start of file\n");

110 
u_št8_t
 
h—d”_ty³_æag
;

112 
h—d”_ty³_æag
 = 
	`·r£In™ŸlPage
();

113 } (
h—d”_ty³_æag
&0x02è!ğ0 || 
	`ÃedH—d”s
());

115 #ifdeà
DEBUG


116 
	`årštf
(
¡d”r
, "Finished…arsing start of file\n");

118  
True
;

119 
	}
}

121 
u_št32_t
 
	$by‹Sw­
(
u_št32_t
 
x
) {

122  (
x
<<24)|((x<<8)&0x00FF0000)|((x>>8)&0x0000FF00)|(x>>24);

123 
	}
}

125 
u_št8_t
 
	gOggFeP¬£r
::
	$·r£In™ŸlPage
() {

126 
u_št8_t
 
h—d”_ty³_æag
;

127 
u_št32_t
 
b™¡»am_£rŸl_numb”
;

128 
	`·r£S¹OfPage
(
h—d”_ty³_æag
, 
b™¡»am_£rŸl_numb”
);

132 
OggT¿ck
* 
Œack
;

133 ià((
h—d”_ty³_æag
&0x02) != 0) {

134 cÚ¡* 
mimeTy³
 = 
NULL
;

135 ià(
fPack‘SizeTabË
 !ğ
NULL
 && fPack‘SizeTabË->
size
[0] >= 8) {

136 
buf
[8];

137 
	`‹¡By‹s
((
u_št8_t
*)
buf
, 8);

139 ià(
	`¡ºcmp
(&
buf
[1], "vorbis", 6) == 0) {

140 
mimeTy³
 = "audio/VORBIS";

141 ++
fNumUnfulfËdT¿cks
;

142 } ià(
	`¡ºcmp
(
buf
, "OpusHead", 8) == 0) {

143 
mimeTy³
 = "audio/OPUS";

144 ++
fNumUnfulfËdT¿cks
;

145 } ià(
	`¡ºcmp
(&
buf
[1], "theora", 6) == 0) {

146 
mimeTy³
 = "video/THEORA";

147 ++
fNumUnfulfËdT¿cks
;

152 
Œack
 = 
Ãw
 
OggT¿ck
;

153 
Œack
->
ŒackNumb”
 = 
b™¡»am_£rŸl_numb”
;

154 
Œack
->
mimeTy³
 = mimeType;

155 
fOurFe
.
	`addT¿ck
(
Œack
);

158 
Œack
 = 
fOurFe
.
	`lookup
(
b™¡»am_£rŸl_numb”
);

161 ià(
Œack
 !ğ
NULL
) {

162 #ifdeà
DEBUG


163 
	`årštf
(
¡d”r
, "Thisrack's MIMEype: %s\n",

164 
Œack
->
mimeTy³
 =ğ
NULL
 ? "(unknown)" :rack->mimeType);

166 ià(
Œack
->
mimeTy³
 !ğ
NULL
 &&

167 (
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0 ||

168 
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0 ||

169 
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/OPUS") == 0)) {

172 
BoŞ—n
 
isVÜbis
 = 
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0;

173 
BoŞ—n
 
isTheÜa
 = 
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0;

175 
j
 = 0; j < 
fPack‘SizeTabË
->
numCom¶‘edPack‘s
 && 
Œack
->
	`weN“dH—d”s
(); ++j) {

176 cÚ¡ 
·ck‘Size
 = 
fPack‘SizeTabË
->
size
[
j
];

177 ià(
·ck‘Size
 == 0) ;

179 
d–‘e
[] 
fSavedPack‘
 ; fSavedPack‘ = 
Ãw
 
u_št8_t
[
·ck‘Size
];

180 
	`g‘By‹s
(
fSavedPack‘
, 
·ck‘Size
);

181 
fPack‘SizeTabË
->
tÙSizes
 -ğ
·ck‘Size
;

184 
BoŞ—n
 
h—d”IsKnown
 = 
F®£
;

185 
šdex
 = 0;

186 ià(
isVÜbis
) {

187 
u_št8_t
 cÚ¡ 
fœ¡By‹
 = 
fSavedPack‘
[0];

189 
h—d”IsKnown
 = 
fœ¡By‹
 == 1 || firstByte == 3 || firstByte == 5;

190 
šdex
 = (
fœ¡By‹
-1)/2;

191 } ià(
isTheÜa
) {

192 
u_št8_t
 cÚ¡ 
fœ¡By‹
 = 
fSavedPack‘
[0];

194 
h—d”IsKnown
 = 
fœ¡By‹
 == 0x80 || firstByte == 0x81 || firstByte == 0x82;

195 
šdex
 = 
fœ¡By‹
 &~0x80;

197 ià(
	`¡ºcmp
((cÚ¡*)
fSavedPack‘
, "OpusHead", 8) == 0) {

198 
h—d”IsKnown
 = 
True
;

199 
šdex
 = 0;

200 } ià(
	`¡ºcmp
((cÚ¡*)
fSavedPack‘
, "OpusTags", 8) == 0) {

201 
h—d”IsKnown
 = 
True
;

202 
šdex
 = 1;

205 ià(
h—d”IsKnown
) {

206 #ifdeà
DEBUG


207 cÚ¡* 
h—d”Name
[3] = { "identification", "comment", "setup" };

208 
	`årštf
(
¡d”r
, "Saved %d-by‹ % \"%s\" h—d”\n", 
·ck‘Size
, 
Œack
->
mimeTy³
,

209 
h—d”Name
[
šdex
]);

212 ià(!
	`v®id©eH—d”
(
Œack
, 
fSavedPack‘
, 
·ck‘Size
)) ;

215 
d–‘e
[] 
Œack
->
vtoHdrs
.
h—d”
[
šdex
];

216 
Œack
->
vtoHdrs
.
h—d”
[
šdex
] = 
fSavedPack‘
;

217 
fSavedPack‘
 = 
NULL
;

218 
Œack
->
vtoHdrs
.
h—d”Size
[
šdex
] = 
·ck‘Size
;

220 ià(!
Œack
->
	`weN“dH—d”s
()) {

222 --
fNumUnfulfËdT¿cks
;

232 ià(
fPack‘SizeTabË
->
tÙSizes
 > 0) {

233 #ifdeà
DEBUG


234 
	`årštf
(
¡d”r
, "Skpšg %d„emaššg…ack‘ d©¨by‹s\n", 
fPack‘SizeTabË
->
tÙSizes
);

236 
	`skBy‹s
(
fPack‘SizeTabË
->
tÙSizes
);

239  
h—d”_ty³_æag
;

240 
	}
}

244 şas 
	cLEB™VeùÜ
 {

245 
	mpublic
:

246 
	$LEB™VeùÜ
(
u_št8_t
 cÚ¡* 
p
, 
numBy‹s
)

247 : 
	`fPŒ
(
p
), 
	`fEnd
(&p[
numBy‹s
]), 
	$fNumB™sRemaššgInCu¼’tBy‹
(8) {

250 
u_št32_t
 
	$g‘B™s
(
numB™s
 ) {

251 ià(
	`noMÜeB™s
()) {

253 } ià(
numB™s
 =ğ
fNumB™sRemaššgInCu¼’tBy‹
) {

254 
u_št32_t
 
»suÉ
 = (*
fPŒ
++)>>(8-
fNumB™sRemaššgInCu¼’tBy‹
);

255 
fNumB™sRemaššgInCu¼’tBy‹
 = 8;

257  
»suÉ
;

258 } ià(
numB™s
 < 
fNumB™sRemaššgInCu¼’tBy‹
) {

259 
u_št8_t
 
mask
 = 0xFF>>(8-
numB™s
);

260 
u_št32_t
 
»suÉ
 = ((*
fPŒ
)>>(8-
fNumB™sRemaššgInCu¼’tBy‹
)è& 
mask
;

261 
fNumB™sRemaššgInCu¼’tBy‹
 -ğ
numB™s
;

263  
»suÉ
;

266 
nbr
 = 
fNumB™sRemaššgInCu¼’tBy‹
;

267 
u_št32_t
 
fœ¡B™s
 = 
	`g‘B™s
(
nbr
);

268 
u_št32_t
 
ÃxtB™s
 = 
	`g‘B™s
(
numB™s
 - 
nbr
);

270  (
ÃxtB™s
<<
nbr
è| 
fœ¡B™s
;

272 
	}
}

274 
	$skB™s
(
numB™s
) {

275 
numB™s
 > 32) {

276 ()
	`g‘B™s
(32);

277 
numB™s
 -= 32;

279 ()
	`g‘B™s
(
numB™s
);

280 
	}
}

282 
	$numB™sRemaššg
(è{  (
fEnd
-
fPŒ
-1)*8 + 
fNumB™sRemaššgInCu¼’tBy‹
; 
	}
}

283 
BoŞ—n
 
	$noMÜeB™s
(ècÚ¡ {  
fPŒ
 >ğ
fEnd
; 
	}
}

285 
	g´iv©e
:

286 
u_št8_t
 cÚ¡* 
fPŒ
;

287 
u_št8_t
 cÚ¡* 
	gfEnd
;

288 
	gfNumB™sRemaššgInCu¼’tBy‹
;

291 
	$og
(
n
) {

292 ià(
n
 < 0)  0;

294 
x
 = ()
n
;

295 
»suÉ
 = 0;

297 
x
 > 0) {

298 ++
»suÉ
;

299 
x
 >>= 1;

302  
»suÉ
;

303 
	}
}

305 
	$lookup1_v®ues
(
codebook_’Œ›s
, 
codebook_dim’siÚs
) {

308 
»tuº_v®ue
 = 0;

309 
pow”V®ue
;

312 ++
»tuº_v®ue
;

314 ià(
»tuº_v®ue
 =ğ1è
pow”V®ue
 = 1;

316 
pow”V®ue
 = 1;

317 
i
 = 0; i < 
codebook_dim’siÚs
; ++i) {

318 
pow”V®ue
 *ğ
»tuº_v®ue
;

321 } 
pow”V®ue
 <ğ
codebook_’Œ›s
);

322 
»tuº_v®ue
 -= 1;

324  
»tuº_v®ue
;

325 
	}
}

327 
BoŞ—n
 
	$·r£VÜbisS‘up_codebook
(
LEB™VeùÜ
& 
bv
) {

328 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

330 
sync
 = 
bv
.
	`g‘B™s
(24);

331 ià(
sync
 !ğ0x564342è 
F®£
;

332 
codebook_dim’siÚs
 = 
bv
.
	`g‘B™s
(16);

333 
codebook_’Œ›s
 = 
bv
.
	`g‘B™s
(24);

334 
Üd”ed
 = 
bv
.
	`g‘B™s
(1);

335 #ifdeà
DEBUG_SETUP_HEADER


336 
	`årštf
(
¡d”r
, "\t\t\tcodebook_dimensions: %d; codebook_entries: %d, ordered: %d\n",

337 
codebook_dim’siÚs
, 
codebook_’Œ›s
, 
Üd”ed
);

339 ià(!
Üd”ed
) {

340 
¥¬£
 = 
bv
.
	`g‘B™s
(1);

341 #ifdeà
DEBUG_SETUP_HEADER


342 
	`årštf
(
¡d”r
, "\t\t\t!Üd”ed: s·r£ %d\n", 
¥¬£
);

344 
i
 = 0; i < 
codebook_’Œ›s
; ++i) {

345 
codewÜdL’gth
;

347 ià(
¥¬£
) {

348 
æag
 = 
bv
.
	`g‘B™s
(1);

349 ià(
æag
) {

350 
codewÜdL’gth
 = 
bv
.
	`g‘B™s
(5) + 1;

352 
codewÜdL’gth
 = 0;

355 
codewÜdL’gth
 = 
bv
.
	`g‘B™s
(5) + 1;

357 #ifdeà
DEBUG_SETUP_HEADER


358 
	`årštf
(
¡d”r
, "\t\t\t\tcodewÜd†’gth[%d]:\t%d\n", 
i
, 
codewÜdL’gth
);

360 
codewÜdL’gth
 = codewordLength;

364 #ifdeà
DEBUG_SETUP_HEADER


365 
	`årštf
(
¡d”r
, "\t\t\tordered:\n");

367 
cu¼’t_’Œy
 = 0;

368 
cu¼’t_Ëngth
 = 
bv
.
	`g‘B™s
(5) + 1;

370 
numb”
 = 
bv
.
	`g‘B™s
(
	`og
(
codebook_’Œ›s
 - 
cu¼’t_’Œy
));

371 #ifdeà
DEBUG_SETUP_HEADER


372 
	`årštf
(
¡d”r
, "\t\t\t\tcodeword†ength[%d..%d]:\t%d\n",

373 
cu¼’t_’Œy
, cu¼’t_’Œy + 
numb”
 - 1, 
cu¼’t_Ëngth
);

375 
cu¼’t_’Œy
 +ğ
numb”
;

376 ià(
cu¼’t_’Œy
 > 
codebook_’Œ›s
) {

377 
	`årštf
(
¡d”r
, "VÜbi codebook…¬sšgƒ¼Ü: cu¼’t_’Œy %d > codebook_’Œ› %d!\n", 
cu¼’t_’Œy
, 
codebook_’Œ›s
);

378  
F®£
;

380 ++
cu¼’t_Ëngth
;

381 } 
cu¼’t_’Œy
 < 
codebook_’Œ›s
);

384 
codebook_lookup_ty³
 = 
bv
.
	`g‘B™s
(4);

385 #ifdeà
DEBUG_SETUP_HEADER


386 
	`årštf
(
¡d”r
, "\t\t\tcodebook_lookup_ty³: %d\n", 
codebook_lookup_ty³
);

388 ià(
codebook_lookup_ty³
 > 2) {

389 
	`årštf
(
¡d”r
, "VÜbi codebook…¬sšgƒ¼Ü: codebook_lookup_ty³ %d!\n", 
codebook_lookup_ty³
);

390  
F®£
;

391 } ià(
codebook_lookup_ty³
 > 0) {

392 
bv
.
	`skB™s
(32+32);

393 
codebook_v®ue_b™s
 = 
bv
.
	`g‘B™s
(4) + 1;

394 
bv
.
	`skB™s
(1);

395 
codebook_lookup_v®ues
;

396 ià(
codebook_lookup_ty³
 == 1) {

397 
codebook_lookup_v®ues
 = 
	`lookup1_v®ues
(
codebook_’Œ›s
, 
codebook_dim’siÚs
);

399 
codebook_lookup_v®ues
 = 
codebook_’Œ›s
*
codebook_dim’siÚs
;

402 
bv
.
	`skB™s
(
codebook_lookup_v®ues
*
codebook_v®ue_b™s
);

405  
True
;

406 
	}
}

408 
BoŞ—n
 
	$·r£VÜbisS‘up_codebooks
(
LEB™VeùÜ
& 
bv
) {

409 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

411 
vÜbis_codebook_couÁ
 = 
bv
.
	`g‘B™s
(8) + 1;

412 #ifdeà
DEBUG_SETUP_HEADER


413 
	`årštf
(
¡d”r
, "\tCodebooks: vÜbis_codebook_couÁ: %d\n", 
vÜbis_codebook_couÁ
);

415 
i
 = 0; i < 
vÜbis_codebook_couÁ
; ++i) {

416 #ifdeà
DEBUG_SETUP_HEADER


417 
	`årštf
(
¡d”r
, "\t\tCodebook %d:\n", 
i
);

419 ià(!
	`·r£VÜbisS‘up_codebook
(
bv
)è 
F®£
;

422  
True
;

423 
	}
}

425 
BoŞ—n
 
	$·r£VÜbisS‘up_timeDomašT¿nsfÜms
(
LEB™VeùÜ
& 
bv
) {

426 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

428 
vÜbis_time_couÁ
 = 
bv
.
	`g‘B™s
(6) + 1;

429 #ifdeà
DEBUG_SETUP_HEADER


430 
	`årštf
(
¡d”r
, "\tTimdomaš¿nsfÜms: vÜbis_time_couÁ: %d\n", 
vÜbis_time_couÁ
);

432 
i
 = 0; i < 
vÜbis_time_couÁ
; ++i) {

433 
v®
 = 
bv
.
	`g‘B™s
(16);

434 ià(
v®
 != 0) {

435 
	`årštf
(
¡d”r
, "VÜbi Timdomaš¿nsfÜms,„—d‚Ú-z”Øv®u%d\n", 
v®
);

436  
F®£
;

440  
True
;

441 
	}
}

443 
BoŞ—n
 
	$·r£VÜbisS‘up_æoÜs
(
LEB™VeùÜ
& 
bv
) {

444 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

446 
vÜbis_æoÜ_couÁ
 = 
bv
.
	`g‘B™s
(6) + 1;

447 #ifdeà
DEBUG_SETUP_HEADER


448 
	`årštf
(
¡d”r
, "\tFloÜs: vÜbis_æoÜ_couÁ: %d\n", 
vÜbis_æoÜ_couÁ
);

450 
i
 = 0; i < 
vÜbis_æoÜ_couÁ
; ++i) {

451 
æoÜTy³
 = 
bv
.
	`g‘B™s
(16);

452 ià(
æoÜTy³
 == 0) {

453 
bv
.
	`skB™s
(8+16+16+6+8);

454 
æoÜ0_numb”_of_books
 = 
bv
.
	`g‘B™s
(4) + 1;

455 
bv
.
	`skB™s
(
æoÜ0_numb”_of_books
*8);

456 } ià(
æoÜTy³
 == 1) {

457 
æoÜ1_·¹™iÚs
 = 
bv
.
	`g‘B™s
(5);

459 * 
æoÜ1_·¹™iÚ_şass_li¡
 = 
Ãw
 [
æoÜ1_·¹™iÚs
];

460 
maximum_şass
 = 0, 
j
;

461 
j
 = 0; j < 
æoÜ1_·¹™iÚs
; ++j) {

462 
æoÜ1_·¹™iÚ_şass_li¡
[
j
] = 
bv
.
	`g‘B™s
(4);

463 ià(
æoÜ1_·¹™iÚ_şass_li¡
[
j
] > 
maximum_şass
) maximum_class = floor1_partition_class_list[j];

466 * 
æoÜ1_şass_dim’siÚs
 = 
Ãw
 [
maximum_şass
 + 1];

467 
j
 = 0; j <ğ
maximum_şass
; ++j) {

468 
æoÜ1_şass_dim’siÚs
[
j
] = 
bv
.
	`g‘B™s
(3) + 1;

469 
æoÜ1_şass_subşas£s
 = 
bv
.
	`g‘B™s
(2);

470 ià(
æoÜ1_şass_subşas£s
 != 0) {

471 
bv
.
	`skB™s
(8);

474 
twoExp_æoÜ1_şass_subşas£s
 = 1 << 
æoÜ1_şass_subşas£s
;

475 
bv
.
	`skB™s
(
twoExp_æoÜ1_şass_subşas£s
*8);

478 
bv
.
	`skB™s
(2);

479 
¿ngeb™s
 = 
bv
.
	`g‘B™s
(4);

480 
j
 = 0; j < 
æoÜ1_·¹™iÚs
; ++j) {

481 
cu¼’t_şass_numb”
 = 
æoÜ1_·¹™iÚ_şass_li¡
[
j
];

482 
bv
.
	`skB™s
(
æoÜ1_şass_dim’siÚs
[
cu¼’t_şass_numb”
] * 
¿ngeb™s
);

485 
d–‘e
[] 
æoÜ1_·¹™iÚ_şass_li¡
;

486 
d–‘e
[] 
æoÜ1_şass_dim’siÚs
;

488 
	`årštf
(
¡d”r
, "VÜbi FloÜs,„—d bad floÜy³ %d\n", 
æoÜTy³
);

489  
F®£
;

493  
True
;

494 
	}
}

496 
BoŞ—n
 
	$·r£VÜbisS‘up_»sidues
(
LEB™VeùÜ
& 
bv
) {

497 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

499 
vÜbis_»sidue_couÁ
 = 
bv
.
	`g‘B™s
(6) + 1;

500 #ifdeà
DEBUG_SETUP_HEADER


501 
	`årštf
(
¡d”r
, "\tResidues: vÜbis_»sidue_couÁ: %d\n", 
vÜbis_»sidue_couÁ
);

503 
i
 = 0; i < 
vÜbis_»sidue_couÁ
; ++i) {

504 
vÜbis_»sidue_ty³
 = 
bv
.
	`g‘B™s
(16);

505 ià(
vÜbis_»sidue_ty³
 > 2) {

506 
	`årštf
(
¡d”r
, "VÜbi Residues,„—d bad vÜbis_»sidue_ty³: %d\n", 
vÜbis_»sidue_ty³
);

507  
F®£
;

509 
bv
.
	`skB™s
(24+24+24);

510 
»sidue_şassifiÿtiÚs
 = 
bv
.
	`g‘B™s
(6) + 1;

511 
bv
.
	`skB™s
(8);

513 
u_št8_t
* 
»sidue_ÿsÿde
 = 
Ãw
 u_št8_t[
»sidue_şassifiÿtiÚs
];

514 
j
;

515 
j
 = 0; j < 
»sidue_şassifiÿtiÚs
; ++j) {

516 
u_št8_t
 
high_b™s
 = 0;

517 
u_št8_t
 
low_b™s
 = 
bv
.
	`g‘B™s
(3);

518 
b™æag
 = 
bv
.
	`g‘B™s
(1);

519 ià(
b™æag
) {

520 
high_b™s
 = 
bv
.
	`g‘B™s
(5);

523 
»sidue_ÿsÿde
[
j
] = (
high_b™s
<<3è| 
low_b™s
;

526 
j
 = 0; j < 
»sidue_şassifiÿtiÚs
; ++j) {

527 
u_št8_t
 cÚ¡ 
ÿsÿde
 = 
»sidue_ÿsÿde
[
j
];

528 
u_št8_t
 
mask
 = 0x80;

529 
mask
 != 0) {

530 ià((
ÿsÿde
&
mask
è!ğ0è
bv
.
	`skB™s
(8);

531 
mask
 >>= 1;

535 
d–‘e
[] 
»sidue_ÿsÿde
;

539  
True
;

540 
	}
}

542 
BoŞ—n
 
	$·r£VÜbisS‘up_m­pšgs
(
LEB™VeùÜ
& 
bv
, 
audio_chªÃls
) {

543 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

545 
vÜbis_m­pšg_couÁ
 = 
bv
.
	`g‘B™s
(6) + 1;

546 #ifdeà
DEBUG_SETUP_HEADER


547 
	`årštf
(
¡d”r
, "\tM­pšgs: vÜbis_m­pšg_couÁ: %d\n", 
vÜbis_m­pšg_couÁ
);

549 
i
 = 0; i < 
vÜbis_m­pšg_couÁ
; ++i) {

550 
vÜbis_m­pšg_ty³
 = 
bv
.
	`g‘B™s
(16);

551 ià(
vÜbis_m­pšg_ty³
 != 0) {

552 
	`årštf
(
¡d”r
, "VÜbi M­pšgs,„—d bad vÜbis_m­pšg_ty³: %d\n", 
vÜbis_m­pšg_ty³
);

553  
F®£
;

556 
vÜbis_m­pšg_subm­s
 = 1;

557 ià(
bv
.
	`g‘B™s
(1)è
vÜbis_m­pšg_subm­s
 = bv.getBits(4) + 1;

559 ià(
bv
.
	`g‘B™s
(1)) {

560 
vÜbis_m­pšg_cou¶šg_¡•s
 = 
bv
.
	`g‘B™s
(8) + 1;

562 
j
 = 0; j < 
vÜbis_m­pšg_cou¶šg_¡•s
; ++j) {

563 
og_audio_chªÃls_mšus_1
 = 
	`og
(
audio_chªÃls
 - 1);

564 
bv
.
	`skB™s
(2*
og_audio_chªÃls_mšus_1
);

568 
»£rved
 = 
bv
.
	`g‘B™s
(2);

569 ià(
»£rved
 != 0) {

570 
	`årštf
(
¡d”r
, "Vorbis Mappings,„ead bad 'reserved' field\n");

571  
F®£
;

574 ià(
vÜbis_m­pšg_subm­s
 > 1) {

575 
j
 = 0; j < 
audio_chªÃls
; ++j) {

576 
vÜbis_m­pšg_mux
 = 
bv
.
	`g‘B™s
(4);

578 
	`årštf
(
¡d”r
, "\t\t\t\tvÜbis_m­pšg_mux[%d]: %d\n", 
j
, 
vÜbis_m­pšg_mux
);

579 ià(
vÜbis_m­pšg_mux
 >ğ
vÜbis_m­pšg_subm­s
) {

580 
	`årštf
(
¡d”r
, "VÜbi M­pšgs,„—d bad \"vÜbis_m­pšg_mux\" %d (>ğ\"vÜbis_m­pšg_subm­s\" %d)\n", 
vÜbis_m­pšg_mux
, 
vÜbis_m­pšg_subm­s
);

581  
F®£
;

586 
bv
.
	`skB™s
(
vÜbis_m­pšg_subm­s
*(8+8+8));

589  
True
;

590 
	}
}

592 
BoŞ—n
 
	$·r£VÜbisS‘up_modes
(
LEB™VeùÜ
& 
bv
, 
OggT¿ck
* 
Œack
) {

593 ià(
bv
.
	`noMÜeB™s
()è 
F®£
;

595 
vÜbis_mode_couÁ
 = 
bv
.
	`g‘B™s
(6) + 1;

596 
og_vÜbis_mode_couÁ_mšus_1
 = 
	`og
(
vÜbis_mode_couÁ
 - 1);

597 #ifdeà
DEBUG_SETUP_HEADER


598 
	`årštf
(
¡d”r
, "\tModes: vorbis_mode_count: %d (ilog(%d-1):%d)\n",

599 
vÜbis_mode_couÁ
, vÜbis_mode_couÁ, 
og_vÜbis_mode_couÁ_mšus_1
);

601 
Œack
->
vtoHdrs
.
vÜbis_mode_couÁ
 = vorbis_mode_count;

602 
Œack
->
vtoHdrs
.
og_vÜbis_mode_couÁ_mšus_1
 = ilog_vorbis_mode_count_minus_1;

603 
Œack
->
vtoHdrs
.
vÜbis_mode_blockæag
 = 
Ãw
 
u_št8_t
[
vÜbis_mode_couÁ
];

605 
i
 = 0; i < 
vÜbis_mode_couÁ
; ++i) {

606 
Œack
->
vtoHdrs
.
vÜbis_mode_blockæag
[
i
] = (
u_št8_t
)
bv
.
	`g‘B™s
(1);

607 #ifdeà
DEBUG_SETUP_HEADER


608 
	`årštf
(
¡d”r
, "\t\tMod%d: vÜbis_mode_blockæag: %d\n", 
i
, 
Œack
->
vtoHdrs
.
vÜbis_mode_blockæag
[i]);

610 
bv
.
	`skB™s
(16+16+8);

613  
True
;

614 
	}
}

616 
BoŞ—n
 
	$·r£VÜbisS‘upH—d”
(
OggT¿ck
* 
Œack
, 
u_št8_t
 cÚ¡* 
p
, 
h—d”Size
) {

617 
LEB™VeùÜ
 
	`bv
(
p
, 
h—d”Size
);

619 ià(!
	`·r£VÜbisS‘up_codebooks
(
bv
)) ;

620 ià(!
	`·r£VÜbisS‘up_timeDomašT¿nsfÜms
(
bv
)) ;

621 ià(!
	`·r£VÜbisS‘up_æoÜs
(
bv
)) ;

622 ià(!
	`·r£VÜbisS‘up_»sidues
(
bv
)) ;

623 ià(!
	`·r£VÜbisS‘up_m­pšgs
(
bv
, 
Œack
->
numChªÃls
)) ;

624 ià(!
	`·r£VÜbisS‘up_modes
(
bv
, 
Œack
)) ;

625 
äamšgFÏg
 = 
bv
.
	`g‘B™s
(1);

626 ià(
äamšgFÏg
 == 0) {

627 
	`årštf
(
¡d”r
, "Vorbis \"setup\" header did‚otƒnd with‡ 'framing flag'!\n");

631  
True
;

635  
F®£
;

636 
	}
}

638 #ifdeà
DEBUG


639 
	#CHECK_PTR
 ià(
p
 >ğ
pEnd
è 
F®£


	)

640 
	#´štComm’t
(
p
, 
Ën
èdØ{ 
k
 = 0; k <†’; ++kè{ 
CHECK_PTR
; 
	`årštf
(
¡d”r
, "%c", *p++); } } 0)

	)

643 
BoŞ—n
 
	$v®id©eComm’tH—d”
(
u_št8_t
 cÚ¡ *
p
, 
h—d”Size
,

644 
isOpus
 = 0) {

645 ià(
h—d”Size
 < 15+
isOpus
) {

646 
	`årštf
(
¡d”r
, "\"comm’t\" h—d” i toØshÜˆ(%d by‹s)\n", 
h—d”Size
);

647  
F®£
;

650 #ifdeà
DEBUG


651 
u_št8_t
 cÚ¡* 
pEnd
 = &
p
[
h—d”Size
];

652 
p
 +ğ7+
isOpus
;

654 
u_št32_t
 
v’dÜ_Ëngth
 = (
p
[3]<<24)|(p[2]<<16)|(p[1]<<8)|p[0];… += 4;

655 
	`årštf
(
¡d”r
, "\tvendor_string:");

656 
	`´štComm’t
(
p
, 
v’dÜ_Ëngth
);

657 
	`årštf
(
¡d”r
, "\n");

659 
u_št32_t
 
u£r_comm’t_li¡_Ëngth
 = (
p
[3]<<24)|(p[2]<<16)|(p[1]<<8)|p[0];… += 4;

660 
i
 = 0; i < 
u£r_comm’t_li¡_Ëngth
; ++i) {

661 
CHECK_PTR
; 
u_št32_t
 
Ëngth
 = (
p
[3]<<24)|(p[2]<<16)|(p[1]<<8)|p[0];… += 4;

662 
	`årštf
(
¡d”r
, "\tu£r_comm’t[%d]:", 
i
);

663 
	`´štComm’t
(
p
, 
Ëngth
);

664 
	`årštf
(
¡d”r
, "\n");

668  
True
;

669 
	}
}

671 
	$blocksizeFromExpÚ’t
(
expÚ’t
) {

672 
»suÉ
 = 1;

673 
i
 = 0; i < 
expÚ’t
; ++iè
»suÉ
 = 2*result;

674  
»suÉ
;

675 
	}
}

677 
BoŞ—n
 
	gOggFeP¬£r
::
	$v®id©eH—d”
(
OggT¿ck
* 
Œack
, 
u_št8_t
 cÚ¡* 
p
, 
h—d”Size
) {

679 ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0) {

680 
u_št8_t
 cÚ¡ 
fœ¡By‹
 = 
p
[0];

682 ià(
fœ¡By‹
 == 1) {

683 ià(
h—d”Size
 < 30) {

684 
	`årštf
(
¡d”r
, "VÜbi \"id’tifiÿtiÚ\" h—d” i toØshÜˆ(%d by‹s)\n", 
h—d”Size
);

685  
F®£
;

686 } ià((
p
[29]&0x1) != 1) {

687 
	`årštf
(
¡d”r
, "Vorbis \"identification\" header: 'framing_flag' is‚ot set\n");

688  
F®£
;

691 
p
 += 7;

692 
u_št32_t
 
vÜbis_v”siÚ
 = (
p
[3]<<24)|(p[2]<<16)|(p[1]<<8)|p[0];… += 4;

693 ià(
vÜbis_v”siÚ
 != 0) {

694 
	`årštf
(
¡d”r
, "VÜbi \"id’tifiÿtiÚ\" h—d” ha ¨bad 'vÜbis_v”siÚ': 0x%08x\n", 
vÜbis_v”siÚ
);

695  
F®£
;

698 
u_št8_t
 
audio_chªÃls
 = *
p
++;

699 ià(
audio_chªÃls
 == 0) {

700 
	`årštf
(
¡d”r
, "Vorbis \"identification\" header: 'audio_channels' is 0!\n");

701  
F®£
;

703 
Œack
->
numChªÃls
 = 
audio_chªÃls
;

705 
u_št32_t
 
audio_§m¶e_¿‹
 = (
p
[3]<<24)|(p[2]<<16)|(p[1]<<8)|p[0];… += 4;

706 ià(
audio_§m¶e_¿‹
 == 0) {

707 
	`årštf
(
¡d”r
, "Vorbis \"identification\" header: 'audio_sample_rate' is 0!\n");

708  
F®£
;

710 
Œack
->
§m¶šgF»qu’cy
 = 
audio_§m¶e_¿‹
;

712 
p
 += 4;

713 
u_št32_t
 
b™¿‹_nomš®
 = (
p
[3]<<24)|(p[2]<<16)|(p[1]<<8)|p[0];… += 4;

714 ià(
b™¿‹_nomš®
 > 0è
Œack
->
e¡B™¿‹
 = (bitrate_nominal+500)/1000;

716 
p
 += 4;

719 
u_št8_t
 
blocksizeB™s
 = *
p
++;

720 & 
blocksize_0
 = 
Œack
->
vtoHdrs
.
blocksize
[0];

721 & 
blocksize_1
 = 
Œack
->
vtoHdrs
.
blocksize
[1];

722 
blocksize_0
 = 
	`blocksizeFromExpÚ’t
(
blocksizeB™s
&0x0F);

723 
blocksize_1
 = 
	`blocksizeFromExpÚ’t
(
blocksizeB™s
>>4);

725 
uSecsP”Sam¶e
 = 1000000.0/(
Œack
->
§m¶šgF»qu’cy
*2);

727 
Œack
->
vtoHdrs
.
uSecsP”Pack‘
[0] = ()(
uSecsP”Sam¶e
*
blocksize_0
);

728 
Œack
->
vtoHdrs
.
uSecsP”Pack‘
[1] = ()(
uSecsP”Sam¶e
*
blocksize_1
);

729 #ifdeà
DEBUG


730 
	`årštf
(
¡d”r
, "\t%u Hz, %u-channel, %u kbps (est), block sizes: %u,%u (%u,%u us)\n",

731 
Œack
->
§m¶šgF»qu’cy
,¿ck->
numChªÃls
,¿ck->
e¡B™¿‹
,

732 
blocksize_0
, 
blocksize_1
,

733 
Œack
->
vtoHdrs
.
uSecsP”Pack‘
[0],rack->vtoHdrs.uSecsPerPacket[1]);

736 ià(!(
blocksize_0
 <ğ
blocksize_1
 && blocksize_0 >= 64 && blocksize_1 <= 8192)) {

737 
	`årštf
(
¡d”r
, "Invalid Vorbis \"blocksize_0\" (%d)‡nd/or \"blocksize_1\" (%d)!\n",

738 
blocksize_0
, 
blocksize_1
);

739  
F®£
;

741 } ià(
fœ¡By‹
 == 3) {

742 ià(!
	`v®id©eComm’tH—d”
(
p
, 
h—d”Size
)è 
F®£
;

743 } ià(
fœ¡By‹
 == 5) {

747 
p
 += 7;

748 ià(!
	`·r£VÜbisS‘upH—d”
(
Œack
, 
p
, 
h—d”Size
)) {

749 
	`årštf
(
¡d”r
, "Failedo…arse Vorbis \"setup\" header!\n");

750  
F®£
;

753 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0) {

754 
u_št8_t
 cÚ¡ 
fœ¡By‹
 = 
p
[0];

756 ià(
fœ¡By‹
 == 0x80) {

757 ià(
h—d”Size
 < 42) {

758 
	`årštf
(
¡d”r
, "TheÜ¨\"id’tifiÿtiÚ\" h—d” i toØshÜˆ(%d by‹s)\n", 
h—d”Size
);

759  
F®£
;

760 } ià((
p
[41]&0x7) != 0) {

761 
	`årštf
(
¡d”r
, "Theora \"identification\" header: 'res' bits‡re‚on-zero\n");

762  
F®£
;

765 
Œack
->
vtoHdrs
.
KFGSHIFT
 = ((
p
[40]&3)<<3) | (p[41]>>5);

766 
u_št32_t
 
FRN
 = (
p
[22]<<24) | (p[23]<<16) | (p[24]<<8) |…[25];

767 
u_št32_t
 
FRD
 = (
p
[26]<<24) | (p[27]<<16) | (p[28]<<8) |…[29];

768 #ifdeà
DEBUG


769 
	`årštf
(
¡d”r
, "\tKFGSHIFT %d, F¿m¿‹‚um”©Ü %d, F¿m¿‹ d’omš©Ü %d\n", 
Œack
->
vtoHdrs
.
KFGSHIFT
, 
FRN
, 
FRD
);

771 ià(
FRN
 =ğ0 || 
FRD
 == 0) {

772 
	`årštf
(
¡d”r
, "TheÜ¨\"id’tifiÿtiÚ\" h—d”: Bad FRN‡nd/Ü FRD v®ues: %d, %d\n", 
FRN
, 
FRD
);

773  
F®£
;

775 
Œack
->
vtoHdrs
.
uSecsP”F¿me
 = ()((1000000.0*
FRD
)/
FRN
);

776 #ifdeà
DEBUG


777 
	`årštf
(
¡d”r
, "\t\t=> %u miüo£cÚd ³¸äame\n", 
Œack
->
vtoHdrs
.
uSecsP”F¿me
);

779 } ià(
fœ¡By‹
 == 0x81) {

780 ià(!
	`v®id©eComm’tH—d”
(
p
, 
h—d”Size
)è 
F®£
;

781 } ià(
fœ¡By‹
 == 0x82) {

785 ià(
	`¡ºcmp
((cÚ¡*)
p
, "OpusHead", 8) == 0) {

787 ià(
h—d”Size
 < 19 || (
p
[8]&0xF0è!ğ0è 
F®£
;

789 ià(!
	`v®id©eComm’tH—d”
(
p
, 
h—d”Size
, 1 )è 
F®£
;

793  
True
;

794 
	}
}

796 
	gOggFeP¬£r
::
	$·r£AndD–iv”Pages
() {

797 #ifdeà
DEBUG


798 
	`årštf
(
¡d”r
, "parsing‡nd delivering data\n");

800 
	`·r£AndD–iv”Page
()) {}

801 
	}
}

803 
BoŞ—n
 
	gOggFeP¬£r
::
	$·r£AndD–iv”Page
() {

804 
u_št8_t
 
h—d”_ty³_æag
;

805 
u_št32_t
 
b™¡»am_£rŸl_numb”
;

806 
	`·r£S¹OfPage
(
h—d”_ty³_æag
, 
b™¡»am_£rŸl_numb”
);

808 
OggDemuxedT¿ck
* 
demuxedT¿ck
 = 
fOurDemux
->
	`lookupDemuxedT¿ck
(
b™¡»am_£rŸl_numb”
);

809 ià(
demuxedT¿ck
 =ğ
NULL
) {

810 #ifdeà
DEBUG


811 
	`årštf
(
¡d”r
, "\tIgnoring…age from unreadrack; skipping %d„emaining…acket data bytes\n",

812 
fPack‘SizeTabË
->
tÙSizes
);

814 
	`skBy‹s
(
fPack‘SizeTabË
->
tÙSizes
);

815  
True
;

816 } ià(
fPack‘SizeTabË
->
tÙSizes
 == 0) {

818 #ifdeà
DEBUG


819 
	`årštf
(
¡d”r
, "\t[Œack: %s] Skpšgƒm±y…age\n", 
demuxedT¿ck
->
	`MIMEty³
());

821  
True
;

825 
demuxedT¿ck
->
fCu¼’tPageIsCÚtšu©iÚ
 = (
h—d”_ty³_æag
&0x01) != 0;

826 
fCu¼’tT¿ckNumb”
 = 
b™¡»am_£rŸl_numb”
;

827 
fCu¼’tP¬£S‹
 = 
DELIVERING_PACKET_WITHIN_PAGE
;

828 
	`§veP¬£rS‹
();

829  
F®£
;

830 
	}
}

832 
BoŞ—n
 
	gOggFeP¬£r
::
	$d–iv”Pack‘W™hšPage
() {

833 
OggDemuxedT¿ck
* 
demuxedT¿ck
 = 
fOurDemux
->
	`lookupDemuxedT¿ck
(
fCu¼’tT¿ckNumb”
);

834 ià(
demuxedT¿ck
 =ğ
NULL
è 
F®£
;

836 
·ck‘Num
 = 
fPack‘SizeTabË
->
ÃxtPack‘NumToD–iv”
;

837 
·ck‘Size
 = 
fPack‘SizeTabË
->
size
[
·ck‘Num
];

839 ià(!
demuxedT¿ck
->
	`isCu¼’yAwa™šgD©a
()) {

843 #ifdeà
DEBUG


844 
	`årštf
(
¡d”r
, "\t[track: %s] Deferring delivery of…acket %d (%d bytes%s)\n",

845 
demuxedT¿ck
->
	`MIMEty³
(), 
·ck‘Num
, 
·ck‘Size
,

846 
·ck‘Num
 =ğ
fPack‘SizeTabË
->
numCom¶‘edPack‘s
 ? " (incomplete)" : "");

848  
True
;

852 #ifdeà
DEBUG


853 
	`årštf
(
¡d”r
, "\t[Œack: %s] D–iv”šg…ack‘ %d (%d by‹s%s)\n", 
demuxedT¿ck
->
	`MIMEty³
(),

854 
·ck‘Num
, 
·ck‘Size
,

855 
·ck‘Num
 =ğ
fPack‘SizeTabË
->
numCom¶‘edPack‘s
 ? " (incomplete)" : "");

857 
numBy‹sD–iv”ed


858 ğ
·ck‘Size
 < 
demuxedT¿ck
->
	`maxSize
() ?…acketSize : demuxedTrack->maxSize();

859 
	`g‘By‹s
(
demuxedT¿ck
->
	`to
(), 
numBy‹sD–iv”ed
);

860 
u_št8_t
 
fœ¡By‹
 = 
numBy‹sD–iv”ed
 > 0 ? 
demuxedT¿ck
->
	`to
()[0] : 0x00;

861 
u_št8_t
 
£cÚdBy‹
 = 
numBy‹sD–iv”ed
 > 1 ? 
demuxedT¿ck
->
	`to
()[1] : 0x00;

862 
demuxedT¿ck
->
	`to
(è+ğ
numBy‹sD–iv”ed
;

864 ià(
demuxedT¿ck
->
fCu¼’tPageIsCÚtšu©iÚ
) {

865 
demuxedT¿ck
->
	`äameSize
(è+ğ
numBy‹sD–iv”ed
;

868 
demuxedT¿ck
->
	`äameSize
(èğ
numBy‹sD–iv”ed
;

870 ià(
·ck‘Size
 > 
demuxedT¿ck
->
	`maxSize
()) {

871 
demuxedT¿ck
->
	`numTrunÿ‹dBy‹s
(è+ğ
·ck‘Size
 - demuxedT¿ck->
	`maxSize
();

873 
demuxedT¿ck
->
	`maxSize
(è-ğ
numBy‹sD–iv”ed
;

876 
du¿tiÚInMiüo£cÚds
;

877 
OggT¿ck
* 
Œack
 = 
fOurFe
.
	`lookup
(
demuxedT¿ck
->
fOurT¿ckNumb”
);

879 ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "audio/VORBIS") == 0) {

880 ià((
fœ¡By‹
&0x01) != 0) {

881 
du¿tiÚInMiüo£cÚds
 = 0;

885 
u_št8_t
 cÚ¡ 
mask
 = 0xFE<<(
Œack
->
vtoHdrs
.
og_vÜbis_mode_couÁ_mšus_1
);

886 
u_št8_t
 cÚ¡ 
modeNumb”
 = (
fœ¡By‹
&~
mask
)>>1;

887 ià(
modeNumb”
 >ğ
Œack
->
vtoHdrs
.
vÜbis_mode_couÁ
) {

888 
	`årštf
(
¡d”r
, "Error: Bad mode‚umber %d (>= vorbis_mode_count %d) in Vorbis…acket!\n",

889 
modeNumb”
, 
Œack
->
vtoHdrs
.
vÜbis_mode_couÁ
);

890 
du¿tiÚInMiüo£cÚds
 = 0;

892 
blockNumb”
 = 
Œack
->
vtoHdrs
.
vÜbis_mode_blockæag
[
modeNumb”
];

893 
du¿tiÚInMiüo£cÚds
 = 
Œack
->
vtoHdrs
.
uSecsP”Pack‘
[
blockNumb”
];

896 } ià(
	`¡rcmp
(
Œack
->
mimeTy³
, "video/THEORA") == 0) {

897 ià((
fœ¡By‹
&0x80) != 0) {

898 
du¿tiÚInMiüo£cÚds
 = 0;

900 
du¿tiÚInMiüo£cÚds
 = 
Œack
->
vtoHdrs
.
uSecsP”F¿me
;

903 ià(
fœ¡By‹
 =ğ0x4F && 
£cÚdBy‹
 == 0x70 ) {

904 
du¿tiÚInMiüo£cÚds
 = 0;

908 
u_št8_t
 
cÚfig
 = 
fœ¡By‹
 >> 3;

909 
u_št8_t
 
c
 = 
fœ¡By‹
 & 0x03;

910 cÚ¡ 
cÚfigDu¿tiÚ
[32] = {

921 cÚ¡ 
numF¿mesInPack‘
 = 
c
 =ğ0 ? 1 : c =ğ3 ? (
£cÚdBy‹
&0x3F) : 2;

922 
du¿tiÚInMiüo£cÚds
 = 
numF¿mesInPack‘
*
cÚfigDu¿tiÚ
[
cÚfig
];

926 ià(
demuxedT¿ck
->
	`ÃxtP»£Á©iÚTime
().
tv_£c
 =ğ0 && demuxedT¿ck->ÃxtP»£Á©iÚTime().
tv_u£c
 == 0) {

928 
	`g‘timeofday
(&
demuxedT¿ck
->
	`ÃxtP»£Á©iÚTime
(), 
NULL
);

930 
demuxedT¿ck
->
	`´e£Á©iÚTime
(èğdemuxedT¿ck->
	`ÃxtP»£Á©iÚTime
();

931 
demuxedT¿ck
->
	`du¿tiÚInMiüo£cÚds
(èğ
du¿tiÚInMiüo£cÚds
;

933 
demuxedT¿ck
->
	`ÃxtP»£Á©iÚTime
().
tv_u£c
 +ğ
du¿tiÚInMiüo£cÚds
;

934 
demuxedT¿ck
->
	`ÃxtP»£Á©iÚTime
().
tv_u£c
 >= 1000000) {

935 ++
demuxedT¿ck
->
	`ÃxtP»£Á©iÚTime
().
tv_£c
;

936 
demuxedT¿ck
->
	`ÃxtP»£Á©iÚTime
().
tv_u£c
 -= 1000000;

938 
	`§veP¬£rS‹
();

941 ià(
·ck‘Num
 =ğ
fPack‘SizeTabË
->
numCom¶‘edPack‘s
) {

944 
fCu¼’tP¬£S‹
 = 
PARSING_AND_DELIVERING_PAGES
;

945  
F®£
;

948 ià(
·ck‘Num
 < 
fPack‘SizeTabË
->
numCom¶‘edPack‘s
-1

949 || 
fPack‘SizeTabË
->
Ï¡Pack‘IsIncom¶‘e
) {

952 ++
fPack‘SizeTabË
->
ÃxtPack‘NumToD–iv”
;

955 
fCu¼’tP¬£S‹
 = 
PARSING_AND_DELIVERING_PAGES
;

958 
F¿medSourû
::
	`aá”G‘tšg
(
demuxedT¿ck
);

959  
True
;

960 
	}
}

962 
	gOggFeP¬£r
::
	$·r£S¹OfPage
(
u_št8_t
& 
h—d”_ty³_æag
,

963 
u_št32_t
& 
b™¡»am_£rŸl_numb”
) {

964 
	`§veP¬£rS‹
();

966 
	`‹¡4By‹s
() != 0x4F676753) {

967 
	`skBy‹s
(1);

968 
	`§veP¬£rS‹
();

970 
	`skBy‹s
(4);

971 #ifdeà
DEBUG


972 
	`årštf
(
¡d”r
, "\nSaw Ogg…age header:\n");

975 
u_št8_t
 
¡»am_¡ruùu»_v”siÚ
 = 
	`g‘1By‹
();

976 ià(
¡»am_¡ruùu»_v”siÚ
 != 0) {

977 
	`årštf
(
¡d”r
, "Saw…agw™h unknowÀOgg fv”siÚ‚umb”: 0x%02x\n", 
¡»am_¡ruùu»_v”siÚ
);

980 
h—d”_ty³_æag
 = 
	`g‘1By‹
();

981 #ifdeà
DEBUG


982 
	`årštf
(
¡d”r
, "\th—d”_ty³_æag: 0x%02x (", 
h—d”_ty³_æag
);

983 ià(
h—d”_ty³_æag
&0x01è
	`årštf
(
¡d”r
, "continuation ");

984 ià(
h—d”_ty³_æag
&0x02è
	`årštf
(
¡d”r
, "bos ");

985 ià(
h—d”_ty³_æag
&0x04è
	`årštf
(
¡d”r
, "eos ");

986 
	`årštf
(
¡d”r
, ")\n");

989 
u_št32_t
 
g¿nuË_pos™iÚ1
 = 
	`by‹Sw­
(
	`g‘4By‹s
());

990 
u_št32_t
 
g¿nuË_pos™iÚ2
 = 
	`by‹Sw­
(
	`g‘4By‹s
());

991 
b™¡»am_£rŸl_numb”
 = 
	`by‹Sw­
(
	`g‘4By‹s
());

992 
u_št32_t
 
·ge_£qu’û_numb”
 = 
	`by‹Sw­
(
	`g‘4By‹s
());

993 
u_št32_t
 
CRC_checksum
 = 
	`by‹Sw­
(
	`g‘4By‹s
());

994 
u_št8_t
 
numb”_·ge_£gm’ts
 = 
	`g‘1By‹
();

995 #ifdeà
DEBUG


996 
	`årštf
(
¡d”r
, "\tg¿nuË_pos™iÚ 0x%08x%08x, b™¡»am_£rŸl_numb” 0x%08x,…age_£qu’û_numb” 0x%08x, CRC_checksum 0x%08x,‚umb”_·ge_£gm’t %d\n", 
g¿nuË_pos™iÚ2
, 
g¿nuË_pos™iÚ1
, 
b™¡»am_£rŸl_numb”
, 
·ge_£qu’û_numb”
, 
CRC_checksum
, 
numb”_·ge_£gm’ts
);

999 
	#DUMMY_STATEMENT
(
x
èdØ{x = x;} 0)

	)

1000 
	`DUMMY_STATEMENT
(
g¿nuË_pos™iÚ1
);

1001 
	`DUMMY_STATEMENT
(
g¿nuË_pos™iÚ2
);

1002 
	`DUMMY_STATEMENT
(
·ge_£qu’û_numb”
);

1003 
	`DUMMY_STATEMENT
(
CRC_checksum
);

1007 
d–‘e
 
fPack‘SizeTabË
 ; fPack‘SizeTabË = 
Ãw
 
	`Pack‘SizeTabË
(
numb”_·ge_£gm’ts
);

1008 
u_št8_t
 
Ïcšg_v®ue
 = 0;

1009 #ifdeà
DEBUG


1010 
	`årštf
(
¡d”r
, "\tsegment_table\n");

1012 
i
 = 0; i < 
numb”_·ge_£gm’ts
; ++i) {

1013 
Ïcšg_v®ue
 = 
	`g‘1By‹
();

1014 #ifdeà
DEBUG


1015 
	`årštf
(
¡d”r
, "\t\t%d:\t%d", 
i
, 
Ïcšg_v®ue
);

1017 
fPack‘SizeTabË
->
tÙSizes
 +ğ
Ïcšg_v®ue
;

1018 
fPack‘SizeTabË
->
size
[fPack‘SizeTabË->
numCom¶‘edPack‘s
] +ğ
Ïcšg_v®ue
;

1019 ià(
Ïcšg_v®ue
 < 255) {

1021 #ifdeà
DEBUG


1022 
	`årštf
(
¡d”r
, " (->%d)", 
fPack‘SizeTabË
->
size
[fPack‘SizeTabË->
numCom¶‘edPack‘s
]);

1024 ++
fPack‘SizeTabË
->
numCom¶‘edPack‘s
;

1026 #ifdeà
DEBUG


1027 
	`årštf
(
¡d”r
, "\n");

1031 
fPack‘SizeTabË
->
Ï¡Pack‘IsIncom¶‘e
 = 
Ïcšg_v®ue
 == 255;

1032 
	}
}

	@liveMedia/OggFileServerDemux.cpp

21 
	~"OggFeS”v”Demux.hh
"

22 
	~"OggFeS”v”MedŸSub£ssiÚ.hh
"

24 
	gOggFeS”v”Demux


25 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

26 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
) {

27 ()
Ãw
 
	`OggFeS”v”Demux
(
’v
, 
feName
,

28 
ÚC»©iÚ
, 
ÚC»©iÚCl›ÁD©a
);

29 
	}
}

31 
S”v”MedŸSub£ssiÚ
* 
	gOggFeS”v”Demux
::
	$ÃwS”v”MedŸSub£ssiÚ
() {

32 
u_št32_t
 
dummyResuÉT¿ckNumb”
;

33  
	`ÃwS”v”MedŸSub£ssiÚ
(
dummyResuÉT¿ckNumb”
);

34 
	}
}

36 
S”v”MedŸSub£ssiÚ
* 
	gOggFeS”v”Demux


37 ::
	$ÃwS”v”MedŸSub£ssiÚ
(
u_št32_t
& 
»suÉT¿ckNumb”
) {

38 
»suÉT¿ckNumb”
 = 0;

40 
OggT¿ck
* 
ÃxtT¿ck
 = 
fI‹r
->
	`Ãxt
();

41 ià(
ÃxtT¿ck
 =ğ
NULL
)  NULL;

43  
	`ÃwS”v”MedŸSub£ssiÚByT¿ckNumb”
(
ÃxtT¿ck
->
ŒackNumb”
);

44 
	}
}

46 
S”v”MedŸSub£ssiÚ
* 
	gOggFeS”v”Demux


47 ::
	$ÃwS”v”MedŸSub£ssiÚByT¿ckNumb”
(
u_št32_t
 
ŒackNumb”
) {

48 
OggT¿ck
* 
Œack
 = 
fOurOggFe
->
	`lookup
(
ŒackNumb”
);

49 ià(
Œack
 =ğ
NULL
)  NULL;

51 
S”v”MedŸSub£ssiÚ
* 
»suÉ
 = 
OggFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
this
, 
Œack
);

52 ià(
»suÉ
 !ğ
NULL
) {

53 #ifdeà
DEBUG


54 
	`årštf
(
¡d”r
, "C»©ed 'S”v”MedŸSub£ssiÚ' objeù fÜ¿ck #%d: (%s)\n", 
Œack
->
ŒackNumb”
,¿ck->
mimeTy³
);

58  
»suÉ
;

59 
	}
}

61 
F¿medSourû
* 
	gOggFeS”v”Demux
::
	$ÃwDemuxedT¿ck
(
ş›ÁSessiÚId
, 
u_št32_t
 
ŒackNumb”
) {

62 
OggDemux
* 
demuxToU£
 = 
NULL
;

64 ià(
ş›ÁSessiÚId
 !ğ0 && cl›ÁSessiÚId =ğ
fLa¡Cl›ÁSessiÚId
) {

65 
demuxToU£
 = 
fLa¡C»©edDemux
;

74 ià(
demuxToU£
 =ğ
NULL
èdemuxToU£ = 
fOurOggFe
->
	`ÃwDemux
();

76 
fLa¡Cl›ÁSessiÚId
 = 
ş›ÁSessiÚId
;

77 
fLa¡C»©edDemux
 = 
demuxToU£
;

79  
demuxToU£
->
	`ÃwDemuxedT¿ckByT¿ckNumb”
(
ŒackNumb”
);

80 
	}
}

82 
	gOggFeS”v”Demux


83 ::
	$OggFeS”v”Demux
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

84 
ÚC»©iÚFunc
* 
ÚC»©iÚ
, * 
ÚC»©iÚCl›ÁD©a
)

85 : 
	`Medium
(
’v
),

86 
	`fFeName
(
feName
), 
	`fOnC»©iÚ
(
ÚC»©iÚ
), 
	`fOnC»©iÚCl›ÁD©a
(
ÚC»©iÚCl›ÁD©a
),

87 
	`fI‹r
(
NULL
 ),

88 
	`fLa¡Cl›ÁSessiÚId
(0), 
	$fLa¡C»©edDemux
(
NULL
) {

89 
OggFe
::
	`ü—‹New
(
’v
, 
feName
, 
ÚOggFeC»©iÚ
, 
this
);

90 
	}
}

92 
	gOggFeS”v”Demux
::~
	$OggFeS”v”Demux
() {

93 
Medium
::
	`şo£
(
fOurOggFe
);

95 
d–‘e
 
fI‹r
;

96 
	}
}

98 
	gOggFeS”v”Demux
::
	$ÚOggFeC»©iÚ
(
OggFe
* 
ÃwFe
, * 
ş›ÁD©a
) {

99 ((
OggFeS”v”Demux
*)
ş›ÁD©a
)->
	`ÚOggFeC»©iÚ
(
ÃwFe
);

100 
	}
}

102 
	gOggFeS”v”Demux
::
	$ÚOggFeC»©iÚ
(
OggFe
* 
ÃwFe
) {

103 
fOurOggFe
 = 
ÃwFe
;

105 
fI‹r
 = 
Ãw
 
	`OggT¿ckTabËI‹¿tÜ
(
fOurOggFe
->
	`ŒackTabË
());

108 ià(
fOnC»©iÚ
 !ğ
NULL
è(*fOnC»©iÚ)(
this
, 
fOnC»©iÚCl›ÁD©a
);

109 
	}
}

	@liveMedia/OggFileServerMediaSubsession.cpp

22 
	~"OggFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"OggDemuxedT¿ck.hh
"

24 
	~"F¿medF‹r.hh
"

26 
OggFeS”v”MedŸSub£ssiÚ
* 
	gOggFeS”v”MedŸSub£ssiÚ


27 ::
	$ü—‹New
(
OggFeS”v”Demux
& 
demux
, 
OggT¿ck
* 
Œack
) {

28  
Ãw
 
	`OggFeS”v”MedŸSub£ssiÚ
(
demux
, 
Œack
);

29 
	}
}

31 
	gOggFeS”v”MedŸSub£ssiÚ


32 ::
	$OggFeS”v”MedŸSub£ssiÚ
(
OggFeS”v”Demux
& 
demux
, 
OggT¿ck
* 
Œack
)

33 : 
	`FeS”v”MedŸSub£ssiÚ
(
demux
.
	`’vœ
(), demux.
	`feName
(), 
F®£
),

34 
	`fOurDemux
(
demux
), 
	`fT¿ck
(
Œack
), 
	$fNumF‹rsInFrÚtOfT¿ck
(0) {

35 
	}
}

37 
	gOggFeS”v”MedŸSub£ssiÚ
::~
	$OggFeS”v”MedŸSub£ssiÚ
() {

38 
	}
}

40 
F¿medSourû
* 
OggFeS”v”MedŸSub£ssiÚ


41 ::
	$ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, & 
e¡B™¿‹
) {

42 
F¿medSourû
* 
ba£Sourû
 = 
fOurDemux
.
	`ÃwDemuxedT¿ck
(
ş›ÁSessiÚId
, 
fT¿ck
->
ŒackNumb”
);

43 ià(
ba£Sourû
 =ğ
NULL
)  NULL;

45  
fOurDemux
.
	`ourOggFe
()

46 ->
	`ü—‹SourûFÜSŒ—mšg
(
ba£Sourû
, 
fT¿ck
->
ŒackNumb”
,

47 
e¡B™¿‹
, 
fNumF‹rsInFrÚtOfT¿ck
);

48 
	}
}

50 
RTPSšk
* 
	gOggFeS”v”MedŸSub£ssiÚ


51 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
, 
F¿medSourû
* ) {

52  
fOurDemux
.
	`ourOggFe
()

53 ->
	`ü—‹RTPSškFÜT¿ckNumb”
(
fT¿ck
->
ŒackNumb”
, 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

54 
	}
}

	@liveMedia/OggFileSink.cpp

21 
	~"OggFeSšk.hh
"

22 
	~"OuutFe.hh
"

23 
	~"VÜbisAudioRTPSourû.hh
"

24 
	~"MPEG2T¿n¥ÜtSŒ—mMuÉËxÜ.hh
"

25 
	~"F¿medSourû.hh
"

27 
OggFeSšk
* 
	gOggFeSšk


28 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

29 
§m¶šgF»qu’cy
, cÚ¡* 
cÚfigSŒ
,

30 
bufãrSize
, 
BoŞ—n
 
ÚeFeP”F¿me
) {

32 
FILE
* 
fid
;

33 cÚ¡* 
³rF¿meFeNameP»fix
;

34 ià(
ÚeFeP”F¿me
) {

36 
fid
 = 
NULL
;

37 
³rF¿meFeNameP»fix
 = 
feName
;

40 
fid
 = 
	`O³nOuutFe
(
’v
, 
feName
);

41 ià(
fid
 =ğ
NULL
) ;

42 
³rF¿meFeNameP»fix
 = 
NULL
;

45  
Ãw
 
	`OggFeSšk
(
’v
, 
fid
, 
§m¶šgF»qu’cy
, 
cÚfigSŒ
, 
bufãrSize
, 
³rF¿meFeNameP»fix
);

48  
NULL
;

49 
	}
}

51 
	gOggFeSšk
::
	$OggFeSšk
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
,

52 
§m¶šgF»qu’cy
, cÚ¡* 
cÚfigSŒ
,

53 
bufãrSize
, cÚ¡* 
³rF¿meFeNameP»fix
)

54 : 
	`FeSšk
(
’v
, 
fid
, 
bufãrSize
, 
³rF¿meFeNameP»fix
),

55 
	`fSam¶šgF»qu’cy
(
§m¶šgF»qu’cy
), 
	`fCÚfigSŒ
(
cÚfigSŒ
),

56 
	`fHaveWr™‹nFœ¡F¿me
(
F®£
), 
	`fHaveS“nEOF
(False),

57 
	`fG¿nuËPos™iÚ
(0), 
	`fG¿nuËPos™iÚAdju¡m’t
(0), 
	`fPageSequ’ûNumb”
(0),

58 
	`fIsTheÜa
(
F®£
), 
	`fG¿nuËInüem’tP”F¿me
(1),

59 
	`fAÉF¿meSize
(0), 
	$fAÉNumTrunÿ‹dBy‹s
(0) {

60 
fAÉBufãr
 = 
Ãw
 [
bufãrSize
];

63 
u_št8_t
* 
p
 = 
fPageH—d”By‹s
;

64 *
p
++=0x4f; *p++=0x67; *p++=0x67; *p++=0x53;

65 *
p
++=0;

66 *
p
++=0;

67 *
p
++=0; *p++=0; *p++=0; *p++=0; *p++=0; *p++=0; *p++=0; *p++=0;

69 *
p
++=1; *p++=0; *p++=0; *p++=0;

70 *
p
++=0; *p++=0; *p++=0; *p++=0;

71 *
p
++=0; *p++=0; *p++=0; *p++=0;

72 *
p
=0;

73 
	}
}

75 
	gOggFeSšk
::~
	$OggFeSšk
() {

77 
fHaveS“nEOF
 = 
True
;

78 
OggFeSšk
::
	`addD©a
(
fAÉBufãr
, 
fAÉF¿meSize
, 
fAÉP»£Á©iÚTime
);

80 
d–‘e
[] 
fAÉBufãr
;

81 
	}
}

83 
BoŞ—n
 
	gOggFeSšk
::
	$cÚtšuePÏyšg
() {

86 ià(
fSourû
 =ğ
NULL
è 
F®£
;

88 
fSourû
->
	`g‘NextF¿me
(
fBufãr
, 
fBufãrSize
,

89 
FeSšk
::
aá”G‘tšgF¿me
, 
this
,

90 
ourOnSourûClosu»
, 
this
);

91  
True
;

92 
	}
}

94 
	#PAGE_DATA_MAX_SIZE
 (255*255)

	)

96 
	gOggFeSšk
::
	$addD©a
(cÚ¡* 
d©a
, 
d©aSize
,

97 
timev®
 
´e£Á©iÚTime
) {

98 ià(
d©aSize
 == 0) ;

101 ià(
fIsTheÜa
) {

106 ià(!(
d©a
[0] >= 0x80 && data[0] <= 0x82)) {

107 
fG¿nuËPos™iÚ
 +ğ
fG¿nuËInüem’tP”F¿me
;

110 
±Diff


111 ğ(
´e£Á©iÚTime
.
tv_£c
 - 
fFœ¡P»£Á©iÚTime
.tv_sec)

112 + (
´e£Á©iÚTime
.
tv_u£c
 - 
fFœ¡P»£Á©iÚTime
.tv_usec)/1000000.0;

113 
št64_t
 
ÃwG¿nuËPos™iÚ


114 ğ(
št64_t
)(
fSam¶šgF»qu’cy
*
±Diff
è+ 
fG¿nuËPos™iÚAdju¡m’t
;

115 ià(
ÃwG¿nuËPos™iÚ
 < 
fG¿nuËPos™iÚ
) {

117 
fG¿nuËPos™iÚAdju¡m’t
 +ğ
fG¿nuËPos™iÚ
 - 
ÃwG¿nuËPos™iÚ
;

119 
fG¿nuËPos™iÚ
 = 
ÃwG¿nuËPos™iÚ
;

130 
numPagesToWr™e
 = 
d©aSize
/
PAGE_DATA_MAX_SIZE
 + 1;

133 
i
 = 0; i < 
numPagesToWr™e
; ++i) {

135 
u_št8_t
 
h—d”_ty³_æag
 = 0x0;

136 ià(!
fHaveWr™‹nFœ¡F¿me
 && 
i
 == 0) {

137 
h—d”_ty³_æag
 |= 0x02;

138 
fHaveWr™‹nFœ¡F¿me
 = 
True
;

140 ià(
i
 > 0è
h—d”_ty³_æag
 |= 0x01;

141 ià(
fHaveS“nEOF
 && 
i
 =ğ
numPagesToWr™e
-1è
h—d”_ty³_æag
 |= 0x04;

142 
fPageH—d”By‹s
[5] = 
h—d”_ty³_æag
;

144 ià(
i
 < 
numPagesToWr™e
-1) {

146 
fPageH—d”By‹s
[6] = fPageHeaderBytes[7] = fPageHeaderBytes[8] = fPageHeaderBytes[9] =

147 
fPageH—d”By‹s
[10] = fPageHeaderBytes[11] = fPageHeaderBytes[12] = fPageHeaderBytes[13]

150 
fPageH—d”By‹s
[6] = (
u_št8_t
)
fG¿nuËPos™iÚ
;

151 
fPageH—d”By‹s
[7] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>8);

152 
fPageH—d”By‹s
[8] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>16);

153 
fPageH—d”By‹s
[9] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>24);

154 
fPageH—d”By‹s
[10] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>32);

155 
fPageH—d”By‹s
[11] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>40);

156 
fPageH—d”By‹s
[12] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>48);

157 
fPageH—d”By‹s
[13] = (
u_št8_t
)(
fG¿nuËPos™iÚ
>>56);

160 
fPageH—d”By‹s
[18] = (
u_št8_t
)
fPageSequ’ûNumb”
;

161 
fPageH—d”By‹s
[19] = (
u_št8_t
)(
fPageSequ’ûNumb”
>>8);

162 
fPageH—d”By‹s
[20] = (
u_št8_t
)(
fPageSequ’ûNumb”
>>16);

163 
fPageH—d”By‹s
[21] = (
u_št8_t
)(
fPageSequ’ûNumb”
>>24);

164 ++
fPageSequ’ûNumb”
;

166 
·geD©aSize
;

167 
u_št8_t
 
numb”_·ge_£gm’ts
;

168 ià(
d©aSize
 >ğ
PAGE_DATA_MAX_SIZE
) {

169 
·geD©aSize
 = 
PAGE_DATA_MAX_SIZE
;

170 
numb”_·ge_£gm’ts
 = 255;

172 
·geD©aSize
 = 
d©aSize
;

173 
numb”_·ge_£gm’ts
 = (
·geD©aSize
+255)/255;

175 
fPageH—d”By‹s
[26] = 
numb”_·ge_£gm’ts
;

177 
u_št8_t
 
£gm’t_bË
[255];

178 
j
 = 0; j < ()(
numb”_·ge_£gm’ts
-1); ++j) {

179 
£gm’t_bË
[
j
] = 255;

181 
£gm’t_bË
[
numb”_·ge_£gm’ts
-1] = 
·geD©aSize
%255;

184 
u_št32_t
 
üc
 = 0;

185 
fPageH—d”By‹s
[22] = fPageHeaderBytes[23] = fPageHeaderBytes[24] = fPageHeaderBytes[25] = 0;

186 
üc
 = 
	`ÿlcuÏ‹CRC
(
fPageH—d”By‹s
, 27, 0);

187 
üc
 = 
	`ÿlcuÏ‹CRC
(
£gm’t_bË
, 
numb”_·ge_£gm’ts
, crc);

188 
üc
 = 
	`ÿlcuÏ‹CRC
(
d©a
, 
·geD©aSize
, crc);

189 
fPageH—d”By‹s
[22] = (
u_št8_t
)
üc
;

190 
fPageH—d”By‹s
[23] = (
u_št8_t
)(
üc
>>8);

191 
fPageH—d”By‹s
[24] = (
u_št8_t
)(
üc
>>16);

192 
fPageH—d”By‹s
[25] = (
u_št8_t
)(
üc
>>24);

195 
FeSšk
::
	`addD©a
(
fPageH—d”By‹s
, 27, 
´e£Á©iÚTime
);

198 
FeSšk
::
	`addD©a
(
£gm’t_bË
, 
numb”_·ge_£gm’ts
, 
´e£Á©iÚTime
);

201 
FeSšk
::
	`addD©a
(
d©a
, 
·geD©aSize
, 
´e£Á©iÚTime
);

202 
d©a
 +ğ
·geD©aSize
;

203 
d©aSize
 -ğ
·geD©aSize
;

205 
	}
}

207 
	gOggFeSšk
::
	$aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
timev®
 
´e£Á©iÚTime
) {

208 ià(!
fHaveWr™‹nFœ¡F¿me
) {

209 
fFœ¡P»£Á©iÚTime
 = 
´e£Á©iÚTime
;

213 ià(
fCÚfigSŒ
 !ğ
NULL
 && fConfigStr[0] != '\0') {

214 
u_št8_t
* 
id’tifiÿtiÚHdr
; 
id’tifiÿtiÚHdrSize
;

215 
u_št8_t
* 
comm’tHdr
; 
comm’tHdrSize
;

216 
u_št8_t
* 
£tupHdr
; 
£tupHdrSize
;

217 
u_št32_t
 
id’tF›ld
;

218 
	`·r£VÜbisOrTheÜaCÚfigSŒ
(
fCÚfigSŒ
,

219 
id’tifiÿtiÚHdr
, 
id’tifiÿtiÚHdrSize
,

220 
comm’tHdr
, 
comm’tHdrSize
,

221 
£tupHdr
, 
£tupHdrSize
,

222 
id’tF›ld
);

223 ià(
id’tifiÿtiÚHdrSize
 >= 42

224 && 
	`¡ºcmp
((cÚ¡ *)&
id’tifiÿtiÚHdr
[1], "theora", 6) == 0) {

226 
fIsTheÜa
 = 
True
;

227 
u_št8_t
 cÚ¡ 
KFGSHIFT
 = ((
id’tifiÿtiÚHdr
[40]&3)<<3) | (identificationHdr[41]>>5);

228 
fG¿nuËInüem’tP”F¿me
 = (
u_št64_t
)(1 << 
KFGSHIFT
);

230 
OggFeSšk
::
	`addD©a
(
id’tifiÿtiÚHdr
, 
id’tifiÿtiÚHdrSize
, 
´e£Á©iÚTime
);

231 
OggFeSšk
::
	`addD©a
(
comm’tHdr
, 
comm’tHdrSize
, 
´e£Á©iÚTime
);

235 ià(
£tupHdrSize
 > 
fBufãrSize
) {

236 
fAÉF¿meSize
 = 
fBufãrSize
;

237 
fAÉNumTrunÿ‹dBy‹s
 = 
£tupHdrSize
 - 
fBufãrSize
;

239 
fAÉF¿meSize
 = 
£tupHdrSize
;

240 
fAÉNumTrunÿ‹dBy‹s
 = 0;

242 
	`memmove
(
fAÉBufãr
, 
£tupHdr
, 
fAÉF¿meSize
);

243 
fAÉP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

245 
d–‘e
[] 
id’tifiÿtiÚHdr
;

246 
d–‘e
[] 
comm’tHdr
;

247 
d–‘e
[] 
£tupHdr
;

252 * 
tmpPŒ
 = 
fBufãr
; fBufã¸ğ
fAÉBufãr
; fAltBuffer =mpPtr;

253 
´evF¿meSize
 = 
fAÉF¿meSize
; fAÉF¿meSizğ
äameSize
;

254 
´evNumTrunÿ‹dBy‹s
 = 
fAÉNumTrunÿ‹dBy‹s
; fAÉNumTrunÿ‹dBy‹ ğ
numTrunÿ‹dBy‹s
;

255 
timev®
 
´evP»£Á©iÚTime
 = 
fAÉP»£Á©iÚTime
; fAÉP»£Á©iÚTimğ
´e£Á©iÚTime
;

258 
FeSšk
::
	`aá”G‘tšgF¿me
(
´evF¿meSize
, 
´evNumTrunÿ‹dBy‹s
, 
´evP»£Á©iÚTime
);

259 
	}
}

261 
	gOggFeSšk
::
	$ourOnSourûClosu»
(* 
ş›ÁD©a
) {

262 ((
OggFeSšk
*)
ş›ÁD©a
)->
	`ourOnSourûClosu»
();

263 
	}
}

265 
	gOggFeSšk
::
	$ourOnSourûClosu»
() {

266 
fHaveS“nEOF
 = 
True
;

269 
OggFeSšk
::
	`addD©a
(
fAÉBufãr
, 
fAÉF¿meSize
, 
fAÉP»£Á©iÚTime
);

272 
	`ÚSourûClosu»
();

273 
	}
}

	@liveMedia/OnDemandServerMediaSubsession.cpp

22 
	~"OnDemªdS”v”MedŸSub£ssiÚ.hh
"

23 
	~<GroupsockH–³r.hh
>

25 
	gOnDemªdS”v”MedŸSub£ssiÚ


26 ::
	$OnDemªdS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
,

27 
BoŞ—n
 
»u£Fœ¡Sourû
,

28 
pÜtNumB™s
 
š™ŸlPÜtNum
,

29 
BoŞ—n
 
muÉËxRTCPW™hRTP
)

30 : 
	`S”v”MedŸSub£ssiÚ
(
’v
),

31 
	`fSDPLšes
(
NULL
), 
	`fReu£Fœ¡Sourû
(
»u£Fœ¡Sourû
),

32 
	`fMuÉËxRTCPW™hRTP
(
muÉËxRTCPW™hRTP
), 
	`fLa¡SŒ—mTok’
(
NULL
),

33 
	`fAµHªdËrTask
(
NULL
), 
	$fAµHªdËrCl›ÁD©a
(
NULL
) {

34 
fDe¡š©iÚsHashTabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

35 ià(
fMuÉËxRTCPW™hRTP
) {

36 
fIn™ŸlPÜtNum
 = 
š™ŸlPÜtNum
;

39 
fIn™ŸlPÜtNum
 = (
š™ŸlPÜtNum
+1)&~1;

41 
	`g‘ho¡Çme
(
fCNAME
,  fCNAME);

42 
fCNAME
[ fCNAME-1] = '\0';

43 
	}
}

45 
	gOnDemªdS”v”MedŸSub£ssiÚ
::~
	$OnDemªdS”v”MedŸSub£ssiÚ
() {

46 
d–‘e
[] 
fSDPLšes
;

50 
De¡š©iÚs
* 
de¡š©iÚs


51 ğ(
De¡š©iÚs
*)(
fDe¡š©iÚsHashTabË
->
	`RemoveNext
());

52 ià(
de¡š©iÚs
 =ğ
NULL
) ;

53 
d–‘e
 
de¡š©iÚs
;

55 
d–‘e
 
fDe¡š©iÚsHashTabË
;

56 
	}
}

59 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$sdpLšes
() {

60 ià(
fSDPLšes
 =ğ
NULL
) {

65 
e¡B™¿‹
;

66 
F¿medSourû
* 
šputSourû
 = 
	`ü—‹NewSŒ—mSourû
(0, 
e¡B™¿‹
);

67 ià(
šputSourû
 =ğ
NULL
)  NULL;

69 
š_addr
 
dummyAddr
;

70 
dummyAddr
.
s_addr
 = 0;

71 
Groupsock
* 
dummyGroupsock
 = 
	`ü—‹Groupsock
(
dummyAddr
, 0);

72 
¹pPaylßdTy³
 = 96 + 
	`ŒackNumb”
()-1;

73 
RTPSšk
* 
dummyRTPSšk
 = 
	`ü—‹NewRTPSšk
(
dummyGroupsock
, 
¹pPaylßdTy³
, 
šputSourû
);

74 ià(
dummyRTPSšk
 !ğ
NULL
 && dummyRTPSšk->
	`e¡im©edB™¿‹
(è> 0è
e¡B™¿‹
 = dummyRTPSink->estimatedBitrate();

76 
	`£tSDPLšesFromRTPSšk
(
dummyRTPSšk
, 
šputSourû
, 
e¡B™¿‹
);

77 
Medium
::
	`şo£
(
dummyRTPSšk
);

78 
d–‘e
 
dummyGroupsock
;

79 
	`şo£SŒ—mSourû
(
šputSourû
);

82  
fSDPLšes
;

83 
	}
}

85 
	gOnDemªdS”v”MedŸSub£ssiÚ


86 ::
	$g‘SŒ—mP¬am‘”s
(
ş›ÁSessiÚId
,

87 
ÃtAdd»ssB™s
 
ş›ÁAdd»ss
,

88 
PÜt
 cÚ¡& 
ş›ÁRTPPÜt
,

89 
PÜt
 cÚ¡& 
ş›ÁRTCPPÜt
,

90 
tıSock‘Num
,

91 
¹pChªÃlId
,

92 
¹ıChªÃlId
,

93 
ÃtAdd»ssB™s
& 
de¡š©iÚAdd»ss
,

94 
u_št8_t
& ,

95 
BoŞ—n
& 
isMuÉiÿ¡
,

96 
PÜt
& 
£rv”RTPPÜt
,

97 
PÜt
& 
£rv”RTCPPÜt
,

98 *& 
¡»amTok’
) {

99 ià(
de¡š©iÚAdd»ss
 =ğ0ède¡š©iÚAdd»s ğ
ş›ÁAdd»ss
;

100 
š_addr
 
de¡š©iÚAddr
; de¡š©iÚAddr.
s_addr
 = 
de¡š©iÚAdd»ss
;

101 
isMuÉiÿ¡
 = 
F®£
;

103 ià(
fLa¡SŒ—mTok’
 !ğ
NULL
 && 
fReu£Fœ¡Sourû
) {

106 
£rv”RTPPÜt
 = ((
SŒ—mS‹
*)
fLa¡SŒ—mTok’
)->
	`£rv”RTPPÜt
();

107 
£rv”RTCPPÜt
 = ((
SŒ—mS‹
*)
fLa¡SŒ—mTok’
)->
	`£rv”RTCPPÜt
();

108 ++((
SŒ—mS‹
*)
fLa¡SŒ—mTok’
)->
	`»ã»nûCouÁ
();

109 
¡»amTok’
 = 
fLa¡SŒ—mTok’
;

112 
¡»amB™¿‹
;

113 
F¿medSourû
* 
medŸSourû


114 ğ
	`ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, 
¡»amB™¿‹
);

118 
RTPSšk
* 
¹pSšk
 = 
NULL
;

119 
BasicUDPSšk
* 
udpSšk
 = 
NULL
;

120 
Groupsock
* 
¹pGroupsock
 = 
NULL
;

121 
Groupsock
* 
¹ıGroupsock
 = 
NULL
;

123 ià(
ş›ÁRTPPÜt
.
	`num
(è!ğ0 || 
tıSock‘Num
 >= 0) {

124 
pÜtNumB™s
 
£rv”PÜtNum
;

125 ià(
ş›ÁRTCPPÜt
.
	`num
() == 0) {

127 
NoReu£
 
	`dummy
(
	`’vœ
());

128 
£rv”PÜtNum
 = 
fIn™ŸlPÜtNum
; ; ++serverPortNum) {

129 
š_addr
 
dummyAddr
; dummyAddr.
s_addr
 = 0;

131 
£rv”RTPPÜt
 = 
£rv”PÜtNum
;

132 
¹pGroupsock
 = 
	`ü—‹Groupsock
(
dummyAddr
, 
£rv”RTPPÜt
);

133 ià(
¹pGroupsock
->
	`sock‘Num
() >= 0) ;

136 
udpSšk
 = 
BasicUDPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

141 
NoReu£
 
	`dummy
(
	`’vœ
());

142 
pÜtNumB™s
 
£rv”PÜtNum
 = 
fIn™ŸlPÜtNum
; ; ++serverPortNum) {

143 
š_addr
 
dummyAddr
; dummyAddr.
s_addr
 = 0;

145 
£rv”RTPPÜt
 = 
£rv”PÜtNum
;

146 
¹pGroupsock
 = 
	`ü—‹Groupsock
(
dummyAddr
, 
£rv”RTPPÜt
);

147 ià(
¹pGroupsock
->
	`sock‘Num
() < 0) {

148 
d–‘e
 
¹pGroupsock
;

152 ià(
fMuÉËxRTCPW™hRTP
) {

154 
£rv”RTCPPÜt
 = 
£rv”RTPPÜt
;

155 
¹ıGroupsock
 = 
¹pGroupsock
;

158 
£rv”RTCPPÜt
 = ++
£rv”PÜtNum
;

159 
¹ıGroupsock
 = 
	`ü—‹Groupsock
(
dummyAddr
, 
£rv”RTCPPÜt
);

160 ià(
¹ıGroupsock
->
	`sock‘Num
() < 0) {

161 
d–‘e
 
¹pGroupsock
;

162 
d–‘e
 
¹ıGroupsock
;

170 
¹pPaylßdTy³
 = 96 + 
	`ŒackNumb”
()-1;

171 
¹pSšk
 = 
	`ü—‹NewRTPSšk
(
¹pGroupsock
, 
¹pPaylßdTy³
, 
medŸSourû
);

172 ià(
¹pSšk
 !ğ
NULL
 &&„Sšk->
	`e¡im©edB™¿‹
(è> 0è
¡»amB™¿‹
 =„tpSink->estimatedBitrate();

177 ià(
¹pGroupsock
 !ğ
NULL
è¹pGroupsock->
	`»moveAÎDe¡š©iÚs
();

178 ià(
¹ıGroupsock
 !ğ
NULL
è¹ıGroupsock->
	`»moveAÎDe¡š©iÚs
();

180 ià(
¹pGroupsock
 !ğ
NULL
) {

183 
¹pBufSize
 = 
¡»amB™¿‹
 * 25 / 2;

184 ià(
¹pBufSize
 < 50 * 1024)„tpBufSize = 50 * 1024;

185 
	`šü—£S’dBufãrTo
(
	`’vœ
(), 
¹pGroupsock
->
	`sock‘Num
(), 
¹pBufSize
);

190 
¡»amTok’
 = 
fLa¡SŒ—mTok’


191 ğ
Ãw
 
	`SŒ—mS‹
(*
this
, 
£rv”RTPPÜt
, 
£rv”RTCPPÜt
, 
¹pSšk
, 
udpSšk
,

192 
¡»amB™¿‹
, 
medŸSourû
,

193 
¹pGroupsock
, 
¹ıGroupsock
);

197 
De¡š©iÚs
* 
de¡š©iÚs
;

198 ià(
tıSock‘Num
 < 0) {

199 
de¡š©iÚs
 = 
Ãw
 
	`De¡š©iÚs
(
de¡š©iÚAddr
, 
ş›ÁRTPPÜt
, 
ş›ÁRTCPPÜt
);

201 
de¡š©iÚs
 = 
Ãw
 
	`De¡š©iÚs
(
tıSock‘Num
, 
¹pChªÃlId
, 
¹ıChªÃlId
);

203 
fDe¡š©iÚsHashTabË
->
	`Add
((cÚ¡*)
ş›ÁSessiÚId
, 
de¡š©iÚs
);

204 
	}
}

206 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$¡¬tSŒ—m
(
ş›ÁSessiÚId
,

207 * 
¡»amTok’
,

208 
TaskFunc
* 
¹ıRRHªdËr
,

209 * 
¹ıRRHªdËrCl›ÁD©a
,

210 & 
¹pSeqNum
,

211 & 
¹pTime¡amp
,

212 
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËr
,

213 * 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
) {

214 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

215 
De¡š©iÚs
* 
de¡š©iÚs


216 ğ(
De¡š©iÚs
*)(
fDe¡š©iÚsHashTabË
->
	`Lookup
((cÚ¡*)
ş›ÁSessiÚId
));

217 ià(
¡»amS‹
 !ğ
NULL
) {

218 
¡»amS‹
->
	`¡¬tPÏyšg
(
de¡š©iÚs
, 
ş›ÁSessiÚId
,

219 
¹ıRRHªdËr
, 
¹ıRRHªdËrCl›ÁD©a
,

220 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËr
, 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
);

221 
RTPSšk
* 
¹pSšk
 = 
¡»amS‹
->
	`¹pSšk
();

222 ià(
¹pSšk
 !ğ
NULL
) {

223 
¹pSeqNum
 = 
¹pSšk
->
	`cu¼’tSeqNo
();

224 
¹pTime¡amp
 = 
¹pSšk
->
	`´e£tNextTime¡amp
();

227 
	}
}

229 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$·u£SŒ—m
(,

230 * 
¡»amTok’
) {

233 ià(
fReu£Fœ¡Sourû
) ;

235 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

236 ià(
¡»amS‹
 !ğ
NULL
è¡»amS‹->
	`·u£
();

237 
	}
}

239 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$£ekSŒ—m
(,

240 * 
¡»amTok’
, & 
£ekNPT
, 
¡»amDu¿tiÚ
, 
u_št64_t
& 
numBy‹s
) {

241 
numBy‹s
 = 0;

244 ià(
fReu£Fœ¡Sourû
) ;

246 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

247 ià(
¡»amS‹
 !ğ
NULL
 && sŒ—mS‹->
	`medŸSourû
() != NULL) {

248 
	`£ekSŒ—mSourû
(
¡»amS‹
->
	`medŸSourû
(), 
£ekNPT
, 
¡»amDu¿tiÚ
, 
numBy‹s
);

250 
¡»amS‹
->
	`¡¬tNPT
(èğ()
£ekNPT
;

251 
RTPSšk
* 
¹pSšk
 = 
¡»amS‹
->
	`¹pSšk
();

252 ià(
¹pSšk
 !ğ
NULL
è¹pSšk->
	`»£tP»£Á©iÚTimes
();

254 
	}
}

256 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$£ekSŒ—m
(,

257 * 
¡»amTok’
, *& 
absS¹
, *& 
absEnd
) {

259 ià(
fReu£Fœ¡Sourû
) ;

261 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

262 ià(
¡»amS‹
 !ğ
NULL
 && sŒ—mS‹->
	`medŸSourû
() != NULL) {

263 
	`£ekSŒ—mSourû
(
¡»amS‹
->
	`medŸSourû
(), 
absS¹
, 
absEnd
);

265 
	}
}

267 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$nuÎS“kSŒ—m
(, * 
¡»amTok’
,

268 
¡»amEndTime
, 
u_št64_t
& 
numBy‹s
) {

269 
numBy‹s
 = 0;

271 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

272 ià(
¡»amS‹
 !ğ
NULL
 && sŒ—mS‹->
	`medŸSourû
() != NULL) {

274 
¡»amS‹
->
	`¡¬tNPT
(èğ
	`g‘Cu¼’tNPT
(
¡»amTok’
);

276 
du¿tiÚ
 = 
¡»amEndTime
 - 
¡»amS‹
->
	`¡¬tNPT
();

277 ià(
du¿tiÚ
 < 0.0) duration = 0.0;

278 
	`£tSŒ—mSourûDu¿tiÚ
(
¡»amS‹
->
	`medŸSourû
(), 
du¿tiÚ
, 
numBy‹s
);

280 
RTPSšk
* 
¹pSšk
 = 
¡»amS‹
->
	`¹pSšk
();

281 ià(
¹pSšk
 !ğ
NULL
è¹pSšk->
	`»£tP»£Á©iÚTimes
();

283 
	}
}

285 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$£tSŒ—mSÿË
(,

286 * 
¡»amTok’
, 
sÿË
) {

289 ià(
fReu£Fœ¡Sourû
) ;

291 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

292 ià(
¡»amS‹
 !ğ
NULL
 && sŒ—mS‹->
	`medŸSourû
() != NULL) {

293 
	`£tSŒ—mSourûSÿË
(
¡»amS‹
->
	`medŸSourû
(), 
sÿË
);

295 
	}
}

297 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$g‘Cu¼’tNPT
(* 
¡»amTok’
) {

299 ià(
¡»amTok’
 =ğ
NULL
) ;

301 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

302 
RTPSšk
* 
¹pSšk
 = 
¡»amS‹
->
	`¹pSšk
();

303 ià(
¹pSšk
 =ğ
NULL
) ;

305  
¡»amS‹
->
	`¡¬tNPT
()

306 + (
¹pSšk
->
	`mo¡ReûÁP»£Á©iÚTime
().
tv_£c
 -„Sšk->
	`š™ŸlP»£Á©iÚTime
().tv_sec)

307 + (
¹pSšk
->
	`mo¡ReûÁP»£Á©iÚTime
().
tv_u£c
 -„Sšk->
	`š™ŸlP»£Á©iÚTime
().tv_usec)/1000000.0f;

311 
	}
}

313 
F¿medSourû
* 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$g‘SŒ—mSourû
(* 
¡»amTok’
) {

314 ià(
¡»amTok’
 =ğ
NULL
)  NULL;

316 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

317  
¡»amS‹
->
	`medŸSourû
();

318 
	}
}

320 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$d–‘eSŒ—m
(
ş›ÁSessiÚId
,

321 *& 
¡»amTok’
) {

322 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
¡»amTok’
;

325 
De¡š©iÚs
* 
de¡š©iÚs


326 ğ(
De¡š©iÚs
*)(
fDe¡š©iÚsHashTabË
->
	`Lookup
((cÚ¡*)
ş›ÁSessiÚId
));

327 ià(
de¡š©iÚs
 !ğ
NULL
) {

328 
fDe¡š©iÚsHashTabË
->
	`Remove
((cÚ¡*)
ş›ÁSessiÚId
);

331 ià(
¡»amS‹
 !ğ
NULL
è¡»amS‹->
	`’dPÏyšg
(
de¡š©iÚs
, 
ş›ÁSessiÚId
);

335 ià(
¡»amS‹
 !ğ
NULL
) {

336 ià(
¡»amS‹
->
	`»ã»nûCouÁ
() > 0) --streamState->referenceCount();

337 ià(
¡»amS‹
->
	`»ã»nûCouÁ
() == 0) {

338 
d–‘e
 
¡»amS‹
;

339 
¡»amTok’
 = 
NULL
;

344 
d–‘e
 
de¡š©iÚs
;

345 
	}
}

347 cÚ¡* 
	gOnDemªdS”v”MedŸSub£ssiÚ


348 ::
	$g‘AuxSDPLše
(
RTPSšk
* 
¹pSšk
, 
F¿medSourû
* ) {

350  
¹pSšk
 =ğ
NULL
 ? NULL :„Sšk->
	`auxSDPLše
();

351 
	}
}

353 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$£ekSŒ—mSourû
(
F¿medSourû
* ,

354 & , , 
u_št64_t
& 
numBy‹s
) {

356 
numBy‹s
 = 0;

357 
	}
}

359 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$£ekSŒ—mSourû
(
F¿medSourû
* ,

360 *& 
absS¹
, *& 
absEnd
) {

362 
d–‘e
[] 
absS¹
;‡bsS¹ = 
NULL
;

363 
d–‘e
[] 
absEnd
;‡bsEnd = 
NULL
;

364 
	}
}

366 
	gOnDemªdS”v”MedŸSub£ssiÚ


367 ::
	$£tSŒ—mSourûSÿË
(
F¿medSourû
* , ) {

369 
	}
}

371 
	gOnDemªdS”v”MedŸSub£ssiÚ


372 ::
	$£tSŒ—mSourûDu¿tiÚ
(
F¿medSourû
* , , 
u_št64_t
& 
numBy‹s
) {

374 
numBy‹s
 = 0;

375 
	}
}

377 
	gOnDemªdS”v”MedŸSub£ssiÚ
::
	$şo£SŒ—mSourû
(
F¿medSourû
 *
šputSourû
) {

378 
Medium
::
	`şo£
(
šputSourû
);

379 
	}
}

381 
Groupsock
* 
	gOnDemªdS”v”MedŸSub£ssiÚ


382 ::
	$ü—‹Groupsock
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 
pÜt
) {

384  
Ãw
 
	`Groupsock
(
	`’vœ
(), 
addr
, 
pÜt
, 255);

385 
	}
}

387 
RTCPIn¡ªû
* 
	gOnDemªdS”v”MedŸSub£ssiÚ


388 ::
	$ü—‹RTCP
(
Groupsock
* 
RTCPgs
, 
tÙSessiÚBW
,

389 cÚ¡* 
úame
, 
RTPSšk
* 
sšk
) {

391  
RTCPIn¡ªû
::
	`ü—‹New
(
	`’vœ
(), 
RTCPgs
, 
tÙSessiÚBW
, 
úame
, 
sšk
, 
NULL
 );

392 
	}
}

394 
	gOnDemªdS”v”MedŸSub£ssiÚ


395 ::
	$£tRTCPAµPack‘HªdËr
(
RTCPAµHªdËrFunc
* 
hªdËr
, * 
ş›ÁD©a
) {

396 
fAµHªdËrTask
 = 
hªdËr
;

397 
fAµHªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

398 
	}
}

400 
	gOnDemªdS”v”MedŸSub£ssiÚ


401 ::
	$£ndRTCPAµPack‘
(
u_št8_t
 
subty³
, cÚ¡* 
Çme
,

402 
u_št8_t
* 
­pD•’d’tD©a
, 
­pD•’d’tD©aSize
) {

403 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
fLa¡SŒ—mTok’
;

404 ià(
¡»amS‹
 !ğ
NULL
) {

405 
¡»amS‹
->
	`£ndRTCPAµPack‘
(
subty³
, 
Çme
, 
­pD•’d’tD©a
, 
­pD•’d’tD©aSize
);

407 
	}
}

409 
	gOnDemªdS”v”MedŸSub£ssiÚ


410 ::
	$£tSDPLšesFromRTPSšk
(
RTPSšk
* 
¹pSšk
, 
F¿medSourû
* 
šputSourû
, 
e¡B™¿‹
) {

411 ià(
¹pSšk
 =ğ
NULL
) ;

413 cÚ¡* 
medŸTy³
 = 
¹pSšk
->
	`sdpMedŸTy³
();

414 
¹pPaylßdTy³
 = 
¹pSšk
->
	`¹pPaylßdTy³
();

415 
Add»ssSŒšg
 
	`Add»ssSŒ
(
fS”v”Add»ssFÜSDP
);

416 * 
¹pm­Lše
 = 
¹pSšk
->
	`¹pm­Lše
();

417 cÚ¡* 
¹ımuxLše
 = 
fMuÉËxRTCPW™hRTP
 ? "a=rtcp-mux\r\n" : "";

418 cÚ¡* 
¿ngeLše
 = 
	`¿ngeSDPLše
();

419 cÚ¡* 
auxSDPLše
 = 
	`g‘AuxSDPLše
(
¹pSšk
, 
šputSourû
);

420 ià(
auxSDPLše
 =ğ
NULL
)‡uxSDPLine = "";

422 cÚ¡* cÚ¡ 
sdpFmt
 =

431 
sdpFmtSize
 = 
	`¡¾’
(
sdpFmt
)

432 + 
	`¡¾’
(
medŸTy³
) + 5 + 3

433 + 
	`¡¾’
(
Add»ssSŒ
.
	`v®
())

435 + 
	`¡¾’
(
¹pm­Lše
)

436 + 
	`¡¾’
(
¹ımuxLše
)

437 + 
	`¡¾’
(
¿ngeLše
)

438 + 
	`¡¾’
(
auxSDPLše
)

439 + 
	`¡¾’
(
	`ŒackId
());

440 * 
sdpLšes
 = 
Ãw
 [
sdpFmtSize
];

441 
	`¥rštf
(
sdpLšes
, 
sdpFmt
,

442 
medŸTy³
,

443 
fPÜtNumFÜSDP
,

444 
¹pPaylßdTy³
,

445 
Add»ssSŒ
.
	`v®
(),

446 
e¡B™¿‹
,

447 
¹pm­Lše
,

448 
¹ımuxLše
,

449 
¿ngeLše
,

450 
auxSDPLše
,

451 
	`ŒackId
());

452 
d–‘e
[] (*)
¿ngeLše
; d–‘e[] 
¹pm­Lše
;

454 
fSDPLšes
 = 
	`¡rDup
(
sdpLšes
);

455 
d–‘e
[] 
sdpLšes
;

456 
	}
}

461 
	$aá”PÏyšgSŒ—mS‹
(* 
ş›ÁD©a
) {

462 
SŒ—mS‹
* 
¡»amS‹
 = (SŒ—mS‹*)
ş›ÁD©a
;

463 ià(
¡»amS‹
->
	`¡»amDu¿tiÚ
() == 0.0) {

468 
¡»amS‹
->
	`»şaim
();

473 
	}
}

475 
	gSŒ—mS‹
::
	$SŒ—mS‹
(
OnDemªdS”v”MedŸSub£ssiÚ
& 
ma¡”
,

476 
PÜt
 cÚ¡& 
£rv”RTPPÜt
, PÜˆcÚ¡& 
£rv”RTCPPÜt
,

477 
RTPSšk
* 
¹pSšk
, 
BasicUDPSšk
* 
udpSšk
,

478 
tÙ®BW
, 
F¿medSourû
* 
medŸSourû
,

479 
Groupsock
* 
¹pGS
, Groupsock* 
¹ıGS
)

480 : 
	`fMa¡”
(
ma¡”
), 
	`fA»Cu¼’yPÏyšg
(
F®£
), 
	`fReã»nûCouÁ
(1),

481 
	`fS”v”RTPPÜt
(
£rv”RTPPÜt
), 
	`fS”v”RTCPPÜt
(
£rv”RTCPPÜt
),

482 
	`fRTPSšk
(
¹pSšk
), 
	`fUDPSšk
(
udpSšk
), 
	`fSŒ—mDu¿tiÚ
(
ma¡”
.
	`du¿tiÚ
()),

483 
	`fTÙ®BW
(
tÙ®BW
), 
	`fRTCPIn¡ªû
(
NULL
) ,

484 
	`fMedŸSourû
(
medŸSourû
), 
	`fS¹NPT
(0.0), 
	`fRTPgs
(
¹pGS
), 
	$fRTCPgs
(
¹ıGS
) {

485 
	}
}

487 
	gSŒ—mS‹
::~
	$SŒ—mS‹
() {

488 
	`»şaim
();

489 
	}
}

491 
	gSŒ—mS‹


492 ::
	$¡¬tPÏyšg
(
De¡š©iÚs
* 
de¡s
, 
ş›ÁSessiÚId
,

493 
TaskFunc
* 
¹ıRRHªdËr
, * 
¹ıRRHªdËrCl›ÁD©a
,

494 
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËr
,

495 * 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
) {

496 ià(
de¡s
 =ğ
NULL
) ;

498 ià(
fRTCPIn¡ªû
 =ğ
NULL
 && 
fRTPSšk
 != NULL) {

500 
fRTCPIn¡ªû
 = 
fMa¡”
.
	`ü—‹RTCP
(
fRTCPgs
, 
fTÙ®BW
, (*)fMa¡”.
fCNAME
, 
fRTPSšk
);

502 
fRTCPIn¡ªû
->
	`£tAµHªdËr
(
fMa¡”
.
fAµHªdËrTask
, fMa¡”.
fAµHªdËrCl›ÁD©a
);

505 ià(
de¡s
->
isTCP
) {

507 ià(
fRTPSšk
 !ğ
NULL
) {

508 
fRTPSšk
->
	`addSŒ—mSock‘
(
de¡s
->
tıSock‘Num
, de¡s->
¹pChªÃlId
);

509 
RTPIÁ”çû


510 ::
	`£tS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
fRTPSšk
->
	`’vœ
(), 
de¡s
->
tıSock‘Num
,

511 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËr
, 
£rv”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
);

514 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

515 
fRTCPIn¡ªû
->
	`addSŒ—mSock‘
(
de¡s
->
tıSock‘Num
, de¡s->
¹ıChªÃlId
);

516 
fRTCPIn¡ªû
->
	`£tS³cificRRHªdËr
(
de¡s
->
tıSock‘Num
, de¡s->
¹ıChªÃlId
,

517 
¹ıRRHªdËr
, 
¹ıRRHªdËrCl›ÁD©a
);

522 ià(
fRTPgs
 !ğ
NULL
èfRTPgs->
	`addDe¡š©iÚ
(
de¡s
->
addr
, de¡s->
¹pPÜt
, 
ş›ÁSessiÚId
);

523 ià(
fRTCPgs
 !ğ
NULL
 && !(fRTCPg =ğ
fRTPgs
 && 
de¡s
->
¹ıPÜt
.
	`num
(è=ğde¡s->
¹pPÜt
.num())) {

524 
fRTCPgs
->
	`addDe¡š©iÚ
(
de¡s
->
addr
, de¡s->
¹ıPÜt
, 
ş›ÁSessiÚId
);

526 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

527 
fRTCPIn¡ªû
->
	`£tS³cificRRHªdËr
(
de¡s
->
addr
.
s_addr
, de¡s->
¹ıPÜt
,

528 
¹ıRRHªdËr
, 
¹ıRRHªdËrCl›ÁD©a
);

532 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

535 
fRTCPIn¡ªû
->
	`£ndR•Üt
();

538 ià(!
fA»Cu¼’yPÏyšg
 && 
fMedŸSourû
 !ğ
NULL
) {

539 ià(
fRTPSšk
 !ğ
NULL
) {

540 
fRTPSšk
->
	`¡¬tPÏyšg
(*
fMedŸSourû
, 
aá”PÏyšgSŒ—mS‹
, 
this
);

541 
fA»Cu¼’yPÏyšg
 = 
True
;

542 } ià(
fUDPSšk
 !ğ
NULL
) {

543 
fUDPSšk
->
	`¡¬tPÏyšg
(*
fMedŸSourû
, 
aá”PÏyšgSŒ—mS‹
, 
this
);

544 
fA»Cu¼’yPÏyšg
 = 
True
;

547 
	}
}

549 
	gSŒ—mS‹
::
	$·u£
() {

550 ià(
fRTPSšk
 !ğ
NULL
èfRTPSšk->
	`¡İPÏyšg
();

551 ià(
fUDPSšk
 !ğ
NULL
èfUDPSšk->
	`¡İPÏyšg
();

552 
fA»Cu¼’yPÏyšg
 = 
F®£
;

553 
	}
}

555 
	gSŒ—mS‹
::
	$’dPÏyšg
(
De¡š©iÚs
* 
de¡s
, 
ş›ÁSessiÚId
) {

562 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

565 
fRTCPIn¡ªû
->
	`£ndBYE
();

569 ià(
de¡s
->
isTCP
) {

570 ià(
fRTPSšk
 !ğ
NULL
) {

571 
fRTPSšk
->
	`»moveSŒ—mSock‘
(
de¡s
->
tıSock‘Num
, de¡s->
¹pChªÃlId
);

573 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

574 
fRTCPIn¡ªû
->
	`»moveSŒ—mSock‘
(
de¡s
->
tıSock‘Num
, de¡s->
¹ıChªÃlId
);

575 
fRTCPIn¡ªû
->
	`un£tS³cificRRHªdËr
(
de¡s
->
tıSock‘Num
, de¡s->
¹ıChªÃlId
);

579 ià(
fRTPgs
 !ğ
NULL
èfRTPgs->
	`»moveDe¡š©iÚ
(
ş›ÁSessiÚId
);

580 ià(
fRTCPgs
 !ğ
NULL
 && fRTCPg !ğ
fRTPgs
èfRTCPgs->
	`»moveDe¡š©iÚ
(
ş›ÁSessiÚId
);

581 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

582 
fRTCPIn¡ªû
->
	`un£tS³cificRRHªdËr
(
de¡s
->
addr
.
s_addr
, de¡s->
¹ıPÜt
);

585 
	}
}

587 
	gSŒ—mS‹
::
	$£ndRTCPAµPack‘
(
u_št8_t
 
subty³
, cÚ¡* 
Çme
,

588 
u_št8_t
* 
­pD•’d’tD©a
, 
­pD•’d’tD©aSize
) {

589 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

590 
fRTCPIn¡ªû
->
	`£ndAµPack‘
(
subty³
, 
Çme
, 
­pD•’d’tD©a
, 
­pD•’d’tD©aSize
);

592 
	}
}

594 
	gSŒ—mS‹
::
	$»şaim
() {

596 
Medium
::
	`şo£
(
fRTCPIn¡ªû
è ; fRTCPIn¡ªû = 
NULL
;

597 
Medium
::
	`şo£
(
fRTPSšk
); fRTPSšk = 
NULL
;

598 
Medium
::
	`şo£
(
fUDPSšk
); fUDPSšk = 
NULL
;

600 
fMa¡”
.
	`şo£SŒ—mSourû
(
fMedŸSourû
); fMedŸSourû = 
NULL
;

601 ià(
fMa¡”
.
fLa¡SŒ—mTok’
 =ğ
this
èfMa¡”.fLa¡SŒ—mTok’ = 
NULL
;

603 
d–‘e
 
fRTPgs
;

604 ià(
fRTCPgs
 !ğ
fRTPgs
è
d–‘e
 fRTCPgs;

605 
fRTPgs
 = 
NULL
; 
fRTCPgs
 = NULL;

606 
	}
}

	@liveMedia/OutputFile.cpp

21 #ià(
defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

22 
	~<io.h
>

23 
	~<fú.h
>

25 #iâdeà
_WIN32_WCE


26 
	~<sys/¡©.h
>

28 
	~<¡ršg.h
>

30 
	~"OuutFe.hh
"

32 
FILE
* 
	$O³nOuutFe
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
) {

33 
FILE
* 
fid
;

36 ià(
	`¡rcmp
(
feName
, "stdout") == 0) {

37 
fid
 = 
¡dout
;

38 #ià(
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

39 
	`_£tmode
(
	`_f’o
(
¡dout
), 
_O_BINARY
);

41 } ià(
	`¡rcmp
(
feName
, "stderr") == 0) {

42 
fid
 = 
¡d”r
;

43 #ià(
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
)è&& !defšed(
_WIN32_WCE
)

44 
	`_£tmode
(
	`_f’o
(
¡d”r
), 
_O_BINARY
);

47 
fid
 = 
	`fİ’
(
feName
, "wb");

50 ià(
fid
 =ğ
NULL
) {

51 
’v
.
	`£tResuÉMsg
("uÇbËØİ’ f\"", 
feName
, "\"");

54  
fid
;

55 
	}
}

57 
	$Clo£OuutFe
(
FILE
* 
fid
) {

59 ià(
fid
 !ğ
NULL
 && fid !ğ
¡dout
 && fid !ğ
¡d”r
è
	`fşo£
(fid);

60 
	}
}

	@liveMedia/PassiveServerMediaSubsession.cpp

22 
	~"PassiveS”v”MedŸSub£ssiÚ.hh
"

23 
	~<GroupsockH–³r.hh
>

27 
PassiveS”v”MedŸSub£ssiÚ
*

28 
	gPassiveS”v”MedŸSub£ssiÚ
::
	$ü—‹New
(
RTPSšk
& 
¹pSšk
,

29 
RTCPIn¡ªû
* 
¹ıIn¡ªû
) {

30  
Ãw
 
	`PassiveS”v”MedŸSub£ssiÚ
(
¹pSšk
, 
¹ıIn¡ªû
);

31 
	}
}

33 
	gPassiveS”v”MedŸSub£ssiÚ


34 ::
	$PassiveS”v”MedŸSub£ssiÚ
(
RTPSšk
& 
¹pSšk
, 
RTCPIn¡ªû
* 
¹ıIn¡ªû
)

35 : 
	`S”v”MedŸSub£ssiÚ
(
¹pSšk
.
	`’vœ
()),

36 
	`fSDPLšes
(
NULL
), 
	`fRTPSšk
(
¹pSšk
), 
	$fRTCPIn¡ªû
(
¹ıIn¡ªû
) {

37 
fCl›ÁRTCPSourûRecÜds
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

38 
	}
}

40 şas 
	cRTCPSourûRecÜd
 {

41 
	mpublic
:

42 
	$RTCPSourûRecÜd
(
ÃtAdd»ssB™s
 
addr
, 
PÜt
 cÚ¡& 
pÜt
)

43 : 
	`addr
(
addr
), 
	$pÜt
(
pÜt
) {

46 
ÃtAdd»ssB™s
 
addr
;

47 
PÜt
 
pÜt
;

48 
	}
};

50 
	gPassiveS”v”MedŸSub£ssiÚ
::~
	$PassiveS”v”MedŸSub£ssiÚ
() {

51 
d–‘e
[] 
fSDPLšes
;

55 
RTCPSourûRecÜd
* 
sourû
 = (RTCPSourûRecÜd*)(
fCl›ÁRTCPSourûRecÜds
->
	`RemoveNext
());

56 ià(
sourû
 =ğ
NULL
) ;

57 
d–‘e
 
sourû
;

60 
d–‘e
 
fCl›ÁRTCPSourûRecÜds
;

61 
	}
}

63 
BoŞ—n
 
	gPassiveS”v”MedŸSub£ssiÚ
::
	$¹ıIsMuxed
() {

64 ià(
fRTCPIn¡ªû
 =ğ
NULL
è 
F®£
;

67  &(
fRTPSšk
.
	`groupsockBešgU£d
()è=ğ
fRTCPIn¡ªû
->
	`RTCPgs
();

68 
	}
}

71 
	gPassiveS”v”MedŸSub£ssiÚ
::
	$sdpLšes
() {

72 ià(
fSDPLšes
 =ğ
NULL
 ) {

75 
Groupsock
 cÚ¡& 
gs
 = 
fRTPSšk
.
	`groupsockBešgU£d
();

76 
Add»ssSŒšg
 
	`groupAdd»ssSŒ
(
gs
.
	`groupAdd»ss
());

77 
pÜtNum
 = 
	`Áohs
(
gs
.
	`pÜt
().
	`num
());

78 
‰l
 = 
gs
.
	`‰l
();

79 
¹pPaylßdTy³
 = 
fRTPSšk
.
	`¹pPaylßdTy³
();

80 cÚ¡* 
medŸTy³
 = 
fRTPSšk
.
	`sdpMedŸTy³
();

81 
e¡B™¿‹


82 ğ
fRTCPIn¡ªû
 =ğ
NULL
 ? 50 : fRTCPIn¡ªû->
	`tÙSessiÚBW
();

83 * 
¹pm­Lše
 = 
fRTPSšk
.
	`¹pm­Lše
();

84 cÚ¡* 
¹ımuxLše
 = 
	`¹ıIsMuxed
() ? "a=rtcp-mux\r\n" : "";

85 cÚ¡* 
¿ngeLše
 = 
	`¿ngeSDPLše
();

86 cÚ¡* 
auxSDPLše
 = 
fRTPSšk
.
	`auxSDPLše
();

87 ià(
auxSDPLše
 =ğ
NULL
)‡uxSDPLine = "";

89 cÚ¡* cÚ¡ 
sdpFmt
 =

98 
sdpFmtSize
 = 
	`¡¾’
(
sdpFmt
)

99 + 
	`¡¾’
(
medŸTy³
) + 5 + 3

100 + 
	`¡¾’
(
groupAdd»ssSŒ
.
	`v®
()) + 3

102 + 
	`¡¾’
(
¹pm­Lše
)

103 + 
	`¡¾’
(
¹ımuxLše
)

104 + 
	`¡¾’
(
¿ngeLše
)

105 + 
	`¡¾’
(
auxSDPLše
)

106 + 
	`¡¾’
(
	`ŒackId
());

107 * 
sdpLšes
 = 
Ãw
 [
sdpFmtSize
];

108 
	`¥rštf
(
sdpLšes
, 
sdpFmt
,

109 
medŸTy³
,

110 
pÜtNum
,

111 
¹pPaylßdTy³
,

112 
groupAdd»ssSŒ
.
	`v®
(),

113 
‰l
,

114 
e¡B™¿‹
,

115 
¹pm­Lše
,

116 
¹ımuxLše
,

117 
¿ngeLše
,

118 
auxSDPLše
,

119 
	`ŒackId
());

120 
d–‘e
[] (*)
¿ngeLše
; d–‘e[] 
¹pm­Lše
;

122 
fSDPLšes
 = 
	`¡rDup
(
sdpLšes
);

123 
d–‘e
[] 
sdpLšes
;

126  
fSDPLšes
;

127 
	}
}

129 
	gPassiveS”v”MedŸSub£ssiÚ


130 ::
	$g‘SŒ—mP¬am‘”s
(
ş›ÁSessiÚId
,

131 
ÃtAdd»ssB™s
 
ş›ÁAdd»ss
,

132 
PÜt
 const& ,

133 
PÜt
 cÚ¡& 
ş›ÁRTCPPÜt
,

137 
ÃtAdd»ssB™s
& 
de¡š©iÚAdd»ss
,

138 
u_št8_t
& 
de¡š©iÚTTL
,

139 
BoŞ—n
& 
isMuÉiÿ¡
,

140 
PÜt
& 
£rv”RTPPÜt
,

141 
PÜt
& 
£rv”RTCPPÜt
,

142 *& 
¡»amTok’
) {

143 
isMuÉiÿ¡
 = 
True
;

144 
Groupsock
& 
gs
 = 
fRTPSšk
.
	`groupsockBešgU£d
();

145 ià(
de¡š©iÚTTL
 =ğ255ède¡š©iÚTTL = 
gs
.
	`‰l
();

146 ià(
de¡š©iÚAdd»ss
 == 0) {

147 
de¡š©iÚAdd»ss
 = 
gs
.
	`groupAdd»ss
().
s_addr
;

149 
š_addr
 
de¡š©iÚAddr
; de¡š©iÚAddr.
s_addr
 = 
de¡š©iÚAdd»ss
;

150 
gs
.
	`chªgeDe¡š©iÚP¬am‘”s
(
de¡š©iÚAddr
, 0, 
de¡š©iÚTTL
);

151 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

152 
Groupsock
* 
¹ıGS
 = 
fRTCPIn¡ªû
->
	`RTCPgs
();

153 
¹ıGS
->
	`chªgeDe¡š©iÚP¬am‘”s
(
de¡š©iÚAddr
, 0, 
de¡š©iÚTTL
);

156 
£rv”RTPPÜt
 = 
gs
.
	`pÜt
();

157 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

158 
Groupsock
* 
¹ıGS
 = 
fRTCPIn¡ªû
->
	`RTCPgs
();

159 
£rv”RTCPPÜt
 = 
¹ıGS
->
	`pÜt
();

161 
¡»amTok’
 = 
NULL
;

164 
RTCPSourûRecÜd
* 
sourû
 = 
Ãw
 
	`RTCPSourûRecÜd
(
ş›ÁAdd»ss
, 
ş›ÁRTCPPÜt
);

165 
fCl›ÁRTCPSourûRecÜds
->
	`Add
((cÚ¡*)
ş›ÁSessiÚId
, 
sourû
);

166 
	}
}

168 
	gPassiveS”v”MedŸSub£ssiÚ
::
	$¡¬tSŒ—m
(
ş›ÁSessiÚId
,

170 
TaskFunc
* 
¹ıRRHªdËr
,

171 * 
¹ıRRHªdËrCl›ÁD©a
,

172 & 
¹pSeqNum
,

173 & 
¹pTime¡amp
,

174 
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* ,

176 
¹pSeqNum
 = 
fRTPSšk
.
	`cu¼’tSeqNo
();

177 
¹pTime¡amp
 = 
fRTPSšk
.
	`´e£tNextTime¡amp
();

181 
¡»amB™¿‹
 = 
fRTCPIn¡ªû
 =ğ
NULL
 ? 50 : fRTCPIn¡ªû->
	`tÙSessiÚBW
();

182 
¹pBufSize
 = 
¡»amB™¿‹
 * 25 / 2;

183 ià(
¹pBufSize
 < 50 * 1024)„tpBufSize = 50 * 1024;

184 
	`šü—£S’dBufãrTo
(
	`’vœ
(), 
fRTPSšk
.
	`groupsockBešgU£d
().
	`sock‘Num
(), 
¹pBufSize
);

186 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

189 
fRTCPIn¡ªû
->
	`£ndR•Üt
();

192 
RTCPSourûRecÜd
* 
sourû
 = (RTCPSourûRecÜd*)(
fCl›ÁRTCPSourûRecÜds
->
	`Lookup
((cÚ¡*)
ş›ÁSessiÚId
));

193 ià(
sourû
 !ğ
NULL
) {

194 
fRTCPIn¡ªû
->
	`£tS³cificRRHªdËr
(
sourû
->
addr
, sourû->
pÜt
,

195 
¹ıRRHªdËr
, 
¹ıRRHªdËrCl›ÁD©a
);

198 
	}
}

200 
	gPassiveS”v”MedŸSub£ssiÚ
::
	$g‘Cu¼’tNPT
(* 
¡»amTok’
) {

202 
timev®
 cÚ¡& 
ü—tiÚTime
 = 
fRTPSšk
.
	`ü—tiÚTime
();

204 
timev®
 
timeNow
;

205 
	`g‘timeofday
(&
timeNow
, 
NULL
);

207  ()(
timeNow
.
tv_£c
 - 
ü—tiÚTime
.tv_£ø+ (timeNow.
tv_u£c
 - creationTime.tv_usec)/1000000.0);

208 
	}
}

210 
	gPassiveS”v”MedŸSub£ssiÚ
::
	$d–‘eSŒ—m
(
ş›ÁSessiÚId
, *& ) {

212 
RTCPSourûRecÜd
* 
sourû
 = (RTCPSourûRecÜd*)(
fCl›ÁRTCPSourûRecÜds
->
	`Lookup
((cÚ¡*)
ş›ÁSessiÚId
));

213 ià(
sourû
 !ğ
NULL
) {

214 ià(
fRTCPIn¡ªû
 !ğ
NULL
) {

215 
fRTCPIn¡ªû
->
	`un£tS³cificRRHªdËr
(
sourû
->
addr
, sourû->
pÜt
);

218 
fCl›ÁRTCPSourûRecÜds
->
	`Remove
((cÚ¡*)
ş›ÁSessiÚId
);

219 
d–‘e
 
sourû
;

221 
	}
}

	@liveMedia/ProxyServerMediaSession.cpp

22 
	~"liveMedŸ.hh
"

23 
	~"RTSPCommÚ.hh
"

24 
	~"GroupsockH–³r.hh
"

26 #iâdeà
MILLION


27 
	#MILLION
 1000000

	)

32 şas 
	cProxyS”v”MedŸSub£ssiÚ
: 
public
 
OnDemªdS”v”MedŸSub£ssiÚ
 {

33 
public
:

34 
ProxyS”v”MedŸSub£ssiÚ
(
MedŸSub£ssiÚ
& 
medŸSub£ssiÚ
,

35 
pÜtNumB™s
 
š™ŸlPÜtNum
, 
BoŞ—n
 
muÉËxRTCPW™hRTP
);

36 
	mvœtu®
 ~
ProxyS”v”MedŸSub£ssiÚ
();

38 cÚ¡* 
	$codecName
(ècÚ¡ {  
fCodecName
; }

40 
´iv©e
:

41 
vœtu®
 
F¿medSourû
* 
	`ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
,

42 & 
e¡B™¿‹
);

43 
vœtu®
 
	`şo£SŒ—mSourû
(
F¿medSourû
 *
šputSourû
);

44 
vœtu®
 
RTPSšk
* 
	`ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

45 
¹pPaylßdTy³IfDyÇmic
,

46 
F¿medSourû
* 
šputSourû
);

47 
vœtu®
 
Groupsock
* 
	`ü—‹Groupsock
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 
pÜt
);

48 
vœtu®
 
RTCPIn¡ªû
* 
	`ü—‹RTCP
(
Groupsock
* 
RTCPgs
, 
tÙSessiÚBW
,

49 cÚ¡* 
úame
, 
RTPSšk
* 
sšk
);

51 
´iv©e
:

52 
	`sub£ssiÚByeHªdËr
(* 
ş›ÁD©a
);

53 
	`sub£ssiÚByeHªdËr
();

55 
	$v”bos™yLev–
(ècÚ¡ {  ((
ProxyS”v”MedŸSessiÚ
*)
fP¬’tSessiÚ
)->
fV”bos™yLev–
; 
	}
}

57 
	g´iv©e
:

58 
ä›nd
 
şass
 
ProxyRTSPCl›Á
;

59 
	gMedŸSub£ssiÚ
& 
	gfCl›ÁMedŸSub£ssiÚ
;

60 cÚ¡* 
	gfCodecName
;

61 
ProxyS”v”MedŸSub£ssiÚ
* 
	gfNext
;

62 
BoŞ—n
 
	gfHaveS‘upSŒ—m
;

68 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, cÚ¡ 
	gProxyS”v”MedŸSessiÚ
& 
	gpsms
) {

69  
	g’v
 << "ProxyS”v”MedŸSessiÚ[\"" << 
	gpsms
.
u¾
() << "\"]";

72 
ProxyRTSPCl›Á
*

73 
	$deçuÉC»©eNewProxyRTSPCl›ÁFunc
(
ProxyS”v”MedŸSessiÚ
& 
ourS”v”MedŸSessiÚ
,

74 cÚ¡* 
¹¥URL
,

75 cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
,

76 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
,

77 
sock‘NumToS”v”
) {

78  
Ãw
 
	`ProxyRTSPCl›Á
(
ourS”v”MedŸSessiÚ
, 
¹¥URL
, 
u£ºame
, 
·sswÜd
,

79 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
, 
sock‘NumToS”v”
);

80 
	}
}

82 
ProxyS”v”MedŸSessiÚ
* 
	gProxyS”v”MedŸSessiÚ


83 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
G’”icMedŸS”v”
* 
ourMedŸS”v”
,

84 cÚ¡* 
šputSŒ—mURL
, cÚ¡* 
¡»amName
,

85 cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
,

86 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
, 
sock‘NumToS”v”
,

87 
MedŸT¿nscodšgTabË
* 
ŒªscodšgTabË
) {

88  
Ãw
 
	`ProxyS”v”MedŸSessiÚ
(
’v
, 
ourMedŸS”v”
, 
šputSŒ—mURL
, 
¡»amName
, 
u£ºame
, 
·sswÜd
,

89 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
, 
sock‘NumToS”v”
,

90 
ŒªscodšgTabË
);

91 
	}
}

94 
	gProxyS”v”MedŸSessiÚ


95 ::
	$ProxyS”v”MedŸSessiÚ
(
U§geEnvœÚm’t
& 
’v
, 
G’”icMedŸS”v”
* 
ourMedŸS”v”
,

96 cÚ¡* 
šputSŒ—mURL
, cÚ¡* 
¡»amName
,

97 cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
,

98 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
,

99 
sock‘NumToS”v”
,

100 
MedŸT¿nscodšgTabË
* 
ŒªscodšgTabË
,

101 
ü—‹NewProxyRTSPCl›ÁFunc
* 
ourC»©eNewProxyRTSPCl›ÁFunc
,

102 
pÜtNumB™s
 
š™ŸlPÜtNum
, 
BoŞ—n
 
muÉËxRTCPW™hRTP
)

103 : 
	`S”v”MedŸSessiÚ
(
’v
, 
¡»amName
, 
NULL
, NULL, 
F®£
, NULL),

104 
	`desüibeCom¶‘edFÏg
(0), 
	`fOurMedŸS”v”
(
ourMedŸS”v”
), 
	`fCl›ÁMedŸSessiÚ
(
NULL
),

105 
	`fV”bos™yLev–
(
v”bos™yLev–
),

106 
	`fP»£Á©iÚTimeSessiÚNÜm®iz”
(
Ãw
 
	`P»£Á©iÚTimeSessiÚNÜm®iz”
(
	`’vœ
())),

107 
	`fC»©eNewProxyRTSPCl›ÁFunc
(
ourC»©eNewProxyRTSPCl›ÁFunc
),

108 
	`fT¿nscodšgTabË
(
ŒªscodšgTabË
),

109 
	`fIn™ŸlPÜtNum
(
š™ŸlPÜtNum
), 
	$fMuÉËxRTCPW™hRTP
(
muÉËxRTCPW™hRTP
) {

112 
fProxyRTSPCl›Á


113 ğ(*
fC»©eNewProxyRTSPCl›ÁFunc
)(*
this
, 
šputSŒ—mURL
, 
u£ºame
, 
·sswÜd
,

114 
tuÂ–Ov”HTTPPÜtNum
,

115 
v”bos™yLev–
 > 0 ? verbosityLevel-1 : verbosityLevel,

116 
sock‘NumToS”v”
);

117 
ProxyRTSPCl›Á
::
	`£ndDESCRIBE
(
fProxyRTSPCl›Á
);

118 
	}
}

120 
	gProxyS”v”MedŸSessiÚ
::~
	$ProxyS”v”MedŸSessiÚ
() {

121 ià(
fV”bos™yLev–
 > 0) {

122 
	`’vœ
(è<< *
this
 << "::~ProxyServerMediaSession()\n";

126 ià(
fProxyRTSPCl›Á
 !ğ
NULL
 && 
fCl›ÁMedŸSessiÚ
 != NULL) {

127 
fProxyRTSPCl›Á
->
	`£ndT—rdownCommªd
(*
fCl›ÁMedŸSessiÚ
, 
NULL
, fProxyRTSPCl›Á->
	`auth
());

131 
Medium
::
	`şo£
(
fT¿nscodšgTabË
);

132 
Medium
::
	`şo£
(
fCl›ÁMedŸSessiÚ
);

133 
Medium
::
	`şo£
(
fProxyRTSPCl›Á
);

134 
d–‘e
 
fP»£Á©iÚTimeSessiÚNÜm®iz”
;

135 
	}
}

137 cÚ¡* 
	gProxyS”v”MedŸSessiÚ
::
	$u¾
() const {

138  
fProxyRTSPCl›Á
 =ğ
NULL
 ? NULL : fProxyRTSPCl›Á->
	`u¾
();

139 
	}
}

141 
Groupsock
* 
	gProxyS”v”MedŸSessiÚ
::
	$ü—‹Groupsock
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 
pÜt
) {

143  
Ãw
 
	`Groupsock
(
	`’vœ
(), 
addr
, 
pÜt
, 255);

144 
	}
}

146 
RTCPIn¡ªû
* 
	gProxyS”v”MedŸSessiÚ


147 ::
	$ü—‹RTCP
(
Groupsock
* 
RTCPgs
, 
tÙSessiÚBW
,

148 cÚ¡* 
úame
, 
RTPSšk
* 
sšk
) {

150  
RTCPIn¡ªû
::
	`ü—‹New
(
	`’vœ
(), 
RTCPgs
, 
tÙSessiÚBW
, 
úame
, 
sšk
, 
NULL
 );

151 
	}
}

153 
	gProxyS”v”MedŸSessiÚ
::
	$cÚtšueAá”DESCRIBE
(cÚ¡* 
sdpDesütiÚ
) {

154 
desüibeCom¶‘edFÏg
 = 1;

159 
fCl›ÁMedŸSessiÚ
 = 
MedŸSessiÚ
::
	`ü—‹New
(
	`’vœ
(), 
sdpDesütiÚ
);

160 ià(
fCl›ÁMedŸSessiÚ
 =ğ
NULL
) ;

162 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
fCl›ÁMedŸSessiÚ
);

163 
MedŸSub£ssiÚ
* 
mss
 = 
™”
.
	`Ãxt
(); ms !ğ
NULL
; mss = iter.next()) {

164 
S”v”MedŸSub£ssiÚ
* 
smss


165 ğ
Ãw
 
	`ProxyS”v”MedŸSub£ssiÚ
(*
mss
, 
fIn™ŸlPÜtNum
, 
fMuÉËxRTCPW™hRTP
);

166 
	`addSub£ssiÚ
(
smss
);

167 ià(
fV”bos™yLev–
 > 0) {

168 
	`’vœ
(è<< *
this
 << "‡dded‚ew \"ProxyServerMediaSubsession\" for "

169 << 
mss
->
	`´ÙocŞName
(è<< "/" << mss->
	`mediumName
(è<< "/" << mss->
	`codecName
() << "rack\n";

173 
	}
}

175 
	gProxyS”v”MedŸSessiÚ
::
	$»£tDESCRIBES‹
() {

177 ià(
fOurMedŸS”v”
 !ğ
NULL
) {

179 
fOurMedŸS”v”
->
	`şo£AÎCl›ÁSessiÚsFÜS”v”MedŸSessiÚ
(
this
);

181 
	`d–‘eAÎSub£ssiÚs
();

184 
Medium
::
	`şo£
(
fCl›ÁMedŸSessiÚ
); fCl›ÁMedŸSessiÚ = 
NULL
;

185 
	}
}

189 
	$cÚtšueAá”DESCRIBE
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

190 cÚ¡* 
»s
;

192 ià(
»suÉCode
 == 0) {

194 
»s
 = 
»suÉSŒšg
;

197 
»s
 = 
NULL
;

199 ((
ProxyRTSPCl›Á
*)
¹¥Cl›Á
)->
	`cÚtšueAá”DESCRIBE
(
»s
);

200 
d–‘e
[] 
»suÉSŒšg
;

201 
	}
}

203 
	$cÚtšueAá”SETUP
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

204 ià(
»suÉCode
 == 0) {

205 ((
ProxyRTSPCl›Á
*)
¹¥Cl›Á
)->
	`cÚtšueAá”SETUP
();

207 
d–‘e
[] 
»suÉSŒšg
;

208 
	}
}

210 
	$cÚtšueAá”PLAY
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

211 ((
ProxyRTSPCl›Á
*)
¹¥Cl›Á
)->
	`cÚtšueAá”PLAY
(
»suÉCode
);

212 
d–‘e
[] 
»suÉSŒšg
;

213 
	}
}

215 
	$cÚtšueAá”OPTIONS
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

216 
BoŞ—n
 
£rv”SuµÜtsG‘P¬am‘”
 = 
F®£
;

217 ià(
»suÉCode
 == 0) {

219 
£rv”SuµÜtsG‘P¬am‘”
 = 
	`RTSPO±iÚIsSuµÜ‹d
("GET_PARAMETER", 
»suÉSŒšg
);

221 ((
ProxyRTSPCl›Á
*)
¹¥Cl›Á
)->
	`cÚtšueAá”Liv’essCommªd
(
»suÉCode
, 
£rv”SuµÜtsG‘P¬am‘”
);

222 
d–‘e
[] 
»suÉSŒšg
;

223 
	}
}

225 #ifdeà
SEND_GET_PARAMETER_IF_SUPPORTED


226 
	$cÚtšueAá”GET_PARAMETER
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

227 ((
ProxyRTSPCl›Á
*)
¹¥Cl›Á
)->
	`cÚtšueAá”Liv’essCommªd
(
»suÉCode
, 
True
);

228 
d–‘e
[] 
»suÉSŒšg
;

229 
	}
}

235 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, cÚ¡ 
	gProxyRTSPCl›Á
& 
	g´oxyRTSPCl›Á
) {

236  
	g’v
 << "ProxyRTSPCl›Á[\"" << 
	g´oxyRTSPCl›Á
.
u¾
() << "\"]";

239 
	gProxyRTSPCl›Á
::
	$ProxyRTSPCl›Á
(
ProxyS”v”MedŸSessiÚ
& 
ourS”v”MedŸSessiÚ
, cÚ¡* 
¹¥URL
,

240 cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
,

241 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
, 
sock‘NumToS”v”
)

242 : 
	`RTSPCl›Á
(
ourS”v”MedŸSessiÚ
.
	`’vœ
(), 
¹¥URL
, 
v”bos™yLev–
, "ProxyRTSPClient",

243 
tuÂ–Ov”HTTPPÜtNum
 =ğ(
pÜtNumB™s
)(~0è? 0 :uÂ–Ov”HTTPPÜtNum, 
sock‘NumToS”v”
),

244 
	`fOurS”v”MedŸSessiÚ
(
ourS”v”MedŸSessiÚ
), 
	`fOurURL
(
	`¡rDup
(
¹¥URL
)), 
	`fSŒ—mRTPOv”TCP
(
tuÂ–Ov”HTTPPÜtNum
 != 0),

245 
	`fS‘upQueueH—d
(
NULL
), 
	`fS‘upQueueTa
(NULL), 
	`fNumS‘upsDÚe
(0), 
	`fNextDESCRIBED–ay
(1),

246 
	`fS”v”SuµÜtsG‘P¬am‘”
(
F®£
), 
	`fLa¡CommªdWasPLAY
(False),

247 
	`fLiv’essCommªdTask
(
NULL
), 
	`fDESCRIBECommªdTask
(NULL), 
	$fSub£ssiÚTim”Task
(
NULL
) {

248 ià(
u£ºame
 !ğ
NULL
 && 
·sswÜd
 != NULL) {

249 
fOurAuth’tiÿtÜ
 = 
Ãw
 
	`Auth’tiÿtÜ
(
u£ºame
, 
·sswÜd
);

251 
fOurAuth’tiÿtÜ
 = 
NULL
;

253 
	}
}

255 
	gProxyRTSPCl›Á
::
	$»£t
() {

256 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fLiv’essCommªdTask
); fLiv’essCommªdTask = 
NULL
;

257 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fDESCRIBECommªdTask
); fDESCRIBECommªdTask = 
NULL
;

258 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fSub£ssiÚTim”Task
); fSub£ssiÚTim”Task = 
NULL
;

260 
fS‘upQueueH—d
 = 
fS‘upQueueTa
 = 
NULL
;

261 
fNumS‘upsDÚe
 = 0;

262 
fNextDESCRIBED–ay
 = 1;

263 
fLa¡CommªdWasPLAY
 = 
F®£
;

265 
RTSPCl›Á
::
	`»£t
();

266 
	}
}

268 
	gProxyRTSPCl›Á
::~
	$ProxyRTSPCl›Á
() {

269 
	`»£t
();

271 
d–‘e
 
fOurAuth’tiÿtÜ
;

272 
d–‘e
[] 
fOurURL
;

273 
	}
}

275 
	gProxyRTSPCl›Á
::
	$cÚtšueAá”DESCRIBE
(cÚ¡* 
sdpDesütiÚ
) {

276 ià(
sdpDesütiÚ
 !ğ
NULL
) {

277 
fOurS”v”MedŸSessiÚ
.
	`cÚtšueAá”DESCRIBE
(
sdpDesütiÚ
);

284 
	`scheduËLiv’essCommªd
();

288 
	`scheduËDESCRIBECommªd
();

290 
	}
}

292 
	gProxyRTSPCl›Á
::
	$cÚtšueAá”Liv’essCommªd
(
»suÉCode
, 
BoŞ—n
 
£rv”SuµÜtsG‘P¬am‘”
) {

293 ià(
»suÉCode
 != 0) {

299 
fS”v”SuµÜtsG‘P¬am‘”
 = 
F®£
;

301 ià(
»suÉCode
 < 0) {

304 ià(
fV”bos™yLev–
 > 0) {

305 
	`’vœ
(è<< *
this
 << ":†o¡ cÚÃùiÚØ£rv” ('”ºo': " << -
»suÉCode
 << "). Resetting...\n";

309 
	`»£t
();

310 
fOurS”v”MedŸSessiÚ
.
	`»£tDESCRIBES‹
();

312 
	`£tBa£URL
(
fOurURL
);

313 
	`£ndDESCRIBE
(
this
);

317 
fS”v”SuµÜtsG‘P¬am‘”
 = 
£rv”SuµÜtsG‘P¬am‘”
;

320 
	`scheduËLiv’essCommªd
();

321 
	}
}

323 
	#SUBSESSION_TIMEOUT_SECONDS
 10

324 

	)

325 
	gProxyRTSPCl›Á
::
	$cÚtšueAá”SETUP
() {

326 ià(
fV”bos™yLev–
 > 0) {

327 
	`’vœ
(è<< *
this
 << "::cÚtšueAá”SETUP(): h—d codec: " << 
fS‘upQueueH—d
->
	`codecName
()

328 << ";‚umSub£ssiÚ " << 
fS‘upQueueH—d
->
fP¬’tSessiÚ
->
	`numSub£ssiÚs
() << "\n\tqueue:";

329 
ProxyS”v”MedŸSub£ssiÚ
* 
p
 = 
fS‘upQueueH—d
;… !ğ
NULL
;… =…->
fNext
) {

330 
	`’vœ
(è<< "\t" << 
p
->
	`codecName
();

332 
	`’vœ
() << "\n";

334 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fSub£ssiÚTim”Task
);

337 
ProxyS”v”MedŸSub£ssiÚ
* 
smss
 = 
fS‘upQueueH—d
;

338 
fS‘upQueueH—d
 = fS‘upQueueH—d->
fNext
;

339 ià(
fS‘upQueueH—d
 =ğ
NULL
è
fS‘upQueueTa
 = NULL;

341 ià(
fS‘upQueueH—d
 !ğ
NULL
) {

344 
	`£ndS‘upCommªd
(
fS‘upQueueH—d
->
fCl›ÁMedŸSub£ssiÚ
, ::
cÚtšueAá”SETUP
,

345 
F®£
, 
fSŒ—mRTPOv”TCP
, F®£, 
fOurAuth’tiÿtÜ
);

346 ++
fNumS‘upsDÚe
;

347 
fS‘upQueueH—d
->
fHaveS‘upSŒ—m
 = 
True
;

349 ià(
fNumS‘upsDÚe
 >ğ
smss
->
fP¬’tSessiÚ
->
	`numSub£ssiÚs
()) {

352 
	`£ndPÏyCommªd
(
smss
->
fCl›ÁMedŸSub£ssiÚ
.
	`·»ÁSessiÚ
(), ::
cÚtšueAá”PLAY
, -1.0f, -1.0f, 1.0f, 
fOurAuth’tiÿtÜ
);

355 
fLa¡CommªdWasPLAY
 = 
True
;

361 
fSub£ssiÚTim”Task


362 ğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
SUBSESSION_TIMEOUT_SECONDS
*
MILLION
, (
TaskFunc
*)
sub£ssiÚTimeout
, 
this
);

365 
	}
}

367 
	gProxyRTSPCl›Á
::
	$cÚtšueAá”PLAY
(
»suÉCode
) {

368 ià(
»suÉCode
 != 0) {

371 
	`cÚtšueAá”Liv’essCommªd
(
»suÉCode
, 
fS”v”SuµÜtsG‘P¬am‘”
);

373 
	}
}

375 
	gProxyRTSPCl›Á
::
	$scheduËLiv’essCommªd
() {

377 
d–ayMax
 = 
	`£ssiÚTimeoutP¬am‘”
();

378 ià(
d–ayMax
 == 0) {

379 
d–ayMax
 = 60;

383 cÚ¡ 
us_1¡P¬t
 = 
d–ayMax
*500000;

384 
uSecÚdsToD–ay
;

385 ià(
us_1¡P¬t
 <= 1000000) {

386 
uSecÚdsToD–ay
 = 
us_1¡P¬t
;

388 cÚ¡ 
us_2ndP¬t
 = 
us_1¡P¬t
-1000000;

389 
uSecÚdsToD–ay
 = 
us_1¡P¬t
 + (
us_2ndP¬t
*
	`our_¿ndom
())%us_2ndPart;

391 
fLiv’essCommªdTask
 = 
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecÚdsToD–ay
, 
£ndLiv’essCommªd
, 
this
);

392 
	}
}

394 
	gProxyRTSPCl›Á
::
	$£ndLiv’essCommªd
(* 
ş›ÁD©a
) {

395 
ProxyRTSPCl›Á
* 
¹¥Cl›Á
 = (ProxyRTSPCl›Á*)
ş›ÁD©a
;

400 #ifdeà
SEND_GET_PARAMETER_IF_SUPPORTED


401 
MedŸSessiÚ
* 
£ss
 = 
¹¥Cl›Á
->
fOurS”v”MedŸSessiÚ
.
fCl›ÁMedŸSessiÚ
;

403 ià(
¹¥Cl›Á
->
fS”v”SuµÜtsG‘P¬am‘”
 &&„t¥Cl›Á->
fNumS‘upsDÚe
 > 0 && 
£ss
 !ğ
NULL
) {

404 
¹¥Cl›Á
->
	`£ndG‘P¬am‘”Commªd
(*
£ss
, ::
cÚtšueAá”GET_PARAMETER
, "",„t¥Cl›Á->
	`auth
());

407 
¹¥Cl›Á
->
	`£ndO±iÚsCommªd
(::
cÚtšueAá”OPTIONS
,„t¥Cl›Á->
	`auth
());

408 #ifdeà
SEND_GET_PARAMETER_IF_SUPPORTED


411 
	}
}

413 
	gProxyRTSPCl›Á
::
	$scheduËDESCRIBECommªd
() {

415 
£cÚdsToD–ay
;

416 ià(
fNextDESCRIBED–ay
 <= 256) {

417 
£cÚdsToD–ay
 = 
fNextDESCRIBED–ay
;

418 
fNextDESCRIBED–ay
 *= 2;

420 
£cÚdsToD–ay
 = 256 + (
	`our_¿ndom
()&0xFF);

423 ià(
fV”bos™yLev–
 > 0) {

424 
	`’vœ
(è<< *
this
 << ": RTSP \"DESCRIBE\" commªd faed;ryšg‡gaš iÀ" << 
£cÚdsToD–ay
 << " seconds\n";

426 
fDESCRIBECommªdTask
 = 
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
£cÚdsToD–ay
*
MILLION
, 
£ndDESCRIBE
, 
this
);

427 
	}
}

429 
	gProxyRTSPCl›Á
::
	$£ndDESCRIBE
(* 
ş›ÁD©a
) {

430 
ProxyRTSPCl›Á
* 
¹¥Cl›Á
 = (ProxyRTSPCl›Á*)
ş›ÁD©a
;

431 ià(
¹¥Cl›Á
 !ğ
NULL
è¹¥Cl›Á->
	`£ndDesüibeCommªd
(::
cÚtšueAá”DESCRIBE
,„t¥Cl›Á->
	`auth
());

432 
	}
}

434 
	gProxyRTSPCl›Á
::
	$sub£ssiÚTimeout
(* 
ş›ÁD©a
) {

435 ((
ProxyRTSPCl›Á
*)
ş›ÁD©a
)->
	`hªdËSub£ssiÚTimeout
();

436 
	}
}

438 
	gProxyRTSPCl›Á
::
	$hªdËSub£ssiÚTimeout
() {

440 
MedŸSessiÚ
* 
£ss
 = 
fOurS”v”MedŸSessiÚ
.
fCl›ÁMedŸSessiÚ
;

441 ià(
£ss
 !ğ
NULL
è
	`£ndPÏyCommªd
(*£ss, ::
cÚtšueAá”PLAY
, -1.0f, -1.0f, 1.0f, 
fOurAuth’tiÿtÜ
);

442 
fLa¡CommªdWasPLAY
 = 
True
;

443 
	}
}

448 
	gProxyS”v”MedŸSub£ssiÚ


449 ::
	$ProxyS”v”MedŸSub£ssiÚ
(
MedŸSub£ssiÚ
& 
medŸSub£ssiÚ
,

450 
pÜtNumB™s
 
š™ŸlPÜtNum
, 
BoŞ—n
 
muÉËxRTCPW™hRTP
)

451 : 
	`OnDemªdS”v”MedŸSub£ssiÚ
(
medŸSub£ssiÚ
.
	`·»ÁSessiÚ
().
	`’vœ
(), 
True
 ,

452 
š™ŸlPÜtNum
, 
muÉËxRTCPW™hRTP
),

453 
	`fCl›ÁMedŸSub£ssiÚ
(
medŸSub£ssiÚ
), 
	`fCodecName
(
	`¡rDup
(medŸSub£ssiÚ.
	`codecName
())),

454 
	`fNext
(
NULL
), 
	$fHaveS‘upSŒ—m
(
F®£
) {

455 
	}
}

457 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, cÚ¡ 
	gProxyS”v”MedŸSub£ssiÚ
& 
	gpsmss
) {

458  
	g’v
 << "ProxyS”v”MedŸSub£ssiÚ[\"" << 
	gpsmss
.
codecName
() << "\"]";

461 
	gProxyS”v”MedŸSub£ssiÚ
::~
	$ProxyS”v”MedŸSub£ssiÚ
() {

462 ià(
	`v”bos™yLev–
() > 0) {

463 
	`’vœ
(è<< *
this
 << "::~ProxyServerMediaSubsession()\n";

466 
d–‘e
[] (*)
fCodecName
;

467 
	}
}

469 
F¿medSourû
* 
	gProxyS”v”MedŸSub£ssiÚ
::
	$ü—‹NewSŒ—mSourû
(
ş›ÁSessiÚId
, & 
e¡B™¿‹
) {

470 
ProxyS”v”MedŸSessiÚ
* cÚ¡ 
sms
 = (ProxyS”v”MedŸSessiÚ*)
fP¬’tSessiÚ
;

472 ià(
	`v”bos™yLev–
() > 0) {

473 
	`’vœ
(è<< *
this
 << "::ü—‹NewSŒ—mSourû(£ssiÚ id " << 
ş›ÁSessiÚId
 << ")\n";

477 ià(
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(è=ğ
NULL
) {

478 
fCl›ÁMedŸSub£ssiÚ
.
	`»ûiveRawMP3ADUs
();

479 
fCl›ÁMedŸSub£ssiÚ
.
	`»ûiveRawJPEGF¿mes
();

480 
fCl›ÁMedŸSub£ssiÚ
.
	`š™Ÿ‹
();

481 ià(
	`v”bos™yLev–
() > 0) {

482 
	`’vœ
(è<< "\tIn™Ÿ‹d: " << *
this
 << "\n";

485 ià(
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(è!ğ
NULL
) {

487 ià(
sms
->
fT¿nscodšgTabË
 !ğ
NULL
) {

488 * 
ouutCodecName
;

489 
F¿medF‹r
* 
Œªscod”


490 ğ
sms
->
fT¿nscodšgTabË
->
	`lookupT¿nscod”
(
fCl›ÁMedŸSub£ssiÚ
, 
ouutCodecName
);

491 ià(
Œªscod”
 !ğ
NULL
) {

492 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
Œªscod”
);

493 
d–‘e
[] (*)
fCodecName
; fCodecNamğ
ouutCodecName
;

499 
F¿medF‹r
* 
nÜm®iz”F‹r
 = 
sms
->
fP»£Á©iÚTimeSessiÚNÜm®iz”


500 ->
	`ü—‹NewP»£Á©iÚTimeSub£ssiÚNÜm®iz”
(
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(),

501 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pSourû
(),

502 
fCodecName
);

503 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
nÜm®iz”F‹r
);

507 ià(
	`¡rcmp
(
fCodecName
, "H264") == 0) {

508 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
H264VideoSŒ—mDisü‘eF¿m”


509 ::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
()));

510 } ià(
	`¡rcmp
(
fCodecName
, "H265") == 0) {

511 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
H265VideoSŒ—mDisü‘eF¿m”


512 ::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
()));

513 } ià(
	`¡rcmp
(
fCodecName
, "MP4V-ES") == 0) {

514 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
MPEG4VideoSŒ—mDisü‘eF¿m”


515 ::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(),

516 
True
 ));

517 } ià(
	`¡rcmp
(
fCodecName
, "MPV") == 0) {

518 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
MPEG1Ü2VideoSŒ—mDisü‘eF¿m”


519 ::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(),

520 
F®£
, 5.0, 
True
 ));

521 } ià(
	`¡rcmp
(
fCodecName
, "DV") == 0) {

522 
fCl›ÁMedŸSub£ssiÚ
.
	`addF‹r
(
DVVideoSŒ—mF¿m”


523 ::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(),

524 
F®£
, 
True
 ));

528 ià(
fCl›ÁMedŸSub£ssiÚ
.
	`¹ıIn¡ªû
(è!ğ
NULL
) {

529 
fCl›ÁMedŸSub£ssiÚ
.
	`¹ıIn¡ªû
()->
	`£tByeHªdËr
(
sub£ssiÚByeHªdËr
, 
this
);

533 
ProxyRTSPCl›Á
* cÚ¡ 
´oxyRTSPCl›Á
 = 
sms
->
fProxyRTSPCl›Á
;

534 ià(
ş›ÁSessiÚId
 != 0) {

536 ià(!
fHaveS‘upSŒ—m
) {

540 
BoŞ—n
 
queueWasEm±y
 = 
´oxyRTSPCl›Á
->
fS‘upQueueH—d
 =ğ
NULL
;

541 ià(
queueWasEm±y
) {

542 
´oxyRTSPCl›Á
->
fS‘upQueueH—d
 = 
this
;

544 
´oxyRTSPCl›Á
->
fS‘upQueueTa
->
fNext
 = 
this
;

546 
´oxyRTSPCl›Á
->
fS‘upQueueTa
 = 
this
;

550 ià(
queueWasEm±y
) {

551 
´oxyRTSPCl›Á
->
	`£ndS‘upCommªd
(
fCl›ÁMedŸSub£ssiÚ
, ::
cÚtšueAá”SETUP
,

552 
F®£
, 
´oxyRTSPCl›Á
->
fSŒ—mRTPOv”TCP
, F®£,…roxyRTSPCl›Á->
	`auth
());

553 ++
´oxyRTSPCl›Á
->
fNumS‘upsDÚe
;

554 
fHaveS‘upSŒ—m
 = 
True
;

560 ià(!
´oxyRTSPCl›Á
->
fLa¡CommªdWasPLAY
) {

561 
´oxyRTSPCl›Á
->
	`£ndPÏyCommªd
(
fCl›ÁMedŸSub£ssiÚ
.
	`·»ÁSessiÚ
(), ::
cÚtšueAá”PLAY
, -1.0f ,

562 -1.0f, 1.0f, 
´oxyRTSPCl›Á
->
	`auth
());

563 
´oxyRTSPCl›Á
->
fLa¡CommªdWasPLAY
 = 
True
;

568 
e¡B™¿‹
 = 
fCl›ÁMedŸSub£ssiÚ
.
	`bªdwidth
();

569 ià(
e¡B™¿‹
 == 0)ƒstBitrate = 50;

570  
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
();

571 
	}
}

573 
	gProxyS”v”MedŸSub£ssiÚ
::
	$şo£SŒ—mSourû
(
F¿medSourû
* 
šputSourû
) {

574 ià(
	`v”bos™yLev–
() > 0) {

575 
	`’vœ
(è<< *
this
 << "::closeStreamSource()\n";

581 ià(
fHaveS‘upSŒ—m
) {

582 
ProxyS”v”MedŸSessiÚ
* cÚ¡ 
sms
 = (ProxyS”v”MedŸSessiÚ*)
fP¬’tSessiÚ
;

583 
ProxyRTSPCl›Á
* cÚ¡ 
´oxyRTSPCl›Á
 = 
sms
->
fProxyRTSPCl›Á
;

584 ià(
´oxyRTSPCl›Á
->
fLa¡CommªdWasPLAY
) {

585 
´oxyRTSPCl›Á
->
	`£ndPau£Commªd
(
fCl›ÁMedŸSub£ssiÚ
.
	`·»ÁSessiÚ
(), 
NULL
,…roxyRTSPCl›Á->
	`auth
());

586 
´oxyRTSPCl›Á
->
fLa¡CommªdWasPLAY
 = 
F®£
;

589 
	}
}

591 
RTPSšk
* 
	gProxyS”v”MedŸSub£ssiÚ


592 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
, 
F¿medSourû
* 
šputSourû
) {

593 ià(
	`v”bos™yLev–
() > 0) {

594 
	`’vœ
(è<< *
this
 << "::createNewRTPSink()\n";

599 
RTPSšk
* 
ÃwSšk
;

600 ià(
	`¡rcmp
(
fCodecName
, "AC3") == 0 || strcmp(fCodecName, "EAC3") == 0) {

601 
ÃwSšk
 = 
AC3AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

602 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
());

604 } ià(
	`¡rcmp
(
fCodecName
, "AMR") == 0 || strcmp(fCodecName, "AMR-WB") == 0) {

605 
BoŞ—n
 
isWidebªd
 = 
	`¡rcmp
(
fCodecName
, "AMR-WB") == 0;

606 
ÃwSšk
 = 
AMRAudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

607 
isWidebªd
, 
fCl›ÁMedŸSub£ssiÚ
.
	`numChªÃls
());

609 } ià(
	`¡rcmp
(
fCodecName
, "DV") == 0) {

610 
ÃwSšk
 = 
DVVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

611 } ià(
	`¡rcmp
(
fCodecName
, "GSM") == 0) {

612 
ÃwSšk
 = 
GSMAudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

613 } ià(
	`¡rcmp
(
fCodecName
, "H263-1998") == 0 || strcmp(fCodecName, "H263-2000") == 0) {

614 
ÃwSšk
 = 
H263¶usVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

615 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
());

616 } ià(
	`¡rcmp
(
fCodecName
, "H264") == 0) {

617 
ÃwSšk
 = 
H264VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

618 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_¥rİ·¿m‘”£ts
());

619 } ià(
	`¡rcmp
(
fCodecName
, "H265") == 0) {

620 
ÃwSšk
 = 
H265VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

621 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_¥rİvps
(),

622 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_¥rİ¥s
(),

623 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_¥rİµs
());

624 } ià(
	`¡rcmp
(
fCodecName
, "JPEG") == 0) {

625 
ÃwSšk
 = 
Sim¶eRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 26, 90000, "video", "JPEG",

626 1 , 
F®£
 , False );

627 } ià(
	`¡rcmp
(
fCodecName
, "MP4A-LATM") == 0) {

628 
ÃwSšk
 = 
MPEG4LATMAudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

629 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
(),

630 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_cÚfig
(),

631 
fCl›ÁMedŸSub£ssiÚ
.
	`numChªÃls
());

632 } ià(
	`¡rcmp
(
fCodecName
, "MP4V-ES") == 0) {

633 
ÃwSšk
 = 
MPEG4ESVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

634 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
(),

635 
fCl›ÁMedŸSub£ssiÚ
.
	`©ŒV®_unsigÃd
("profile-level-id"),

636 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_cÚfig
());

637 } ià(
	`¡rcmp
(
fCodecName
, "MPA") == 0) {

638 
ÃwSšk
 = 
MPEG1Ü2AudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

639 } ià(
	`¡rcmp
(
fCodecName
, "MPA-ROBUST") == 0) {

640 
ÃwSšk
 = 
MP3ADURTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

641 } ià(
	`¡rcmp
(
fCodecName
, "MPEG4-GENERIC") == 0) {

642 
ÃwSšk
 = 
MPEG4G’”icRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

643 
¹pPaylßdTy³IfDyÇmic
, 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
(),

644 
fCl›ÁMedŸSub£ssiÚ
.
	`mediumName
(),

645 
fCl›ÁMedŸSub£ssiÚ
.
	`©ŒV®_¡rToLow”
("mode"),

646 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_cÚfig
(), fCl›ÁMedŸSub£ssiÚ.
	`numChªÃls
());

647 } ià(
	`¡rcmp
(
fCodecName
, "MPV") == 0) {

648 
ÃwSšk
 = 
MPEG1Ü2VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
);

649 } ià(
	`¡rcmp
(
fCodecName
, "OPUS") == 0) {

650 
ÃwSšk
 = 
Sim¶eRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

651 48000, "audio", "OPUS", 2, 
F®£
 );

652 } ià(
	`¡rcmp
(
fCodecName
, "T140") == 0) {

653 
ÃwSšk
 = 
T140TextRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

654 } ià(
	`¡rcmp
(
fCodecName
, "THEORA") == 0) {

655 
ÃwSšk
 = 
TheÜaVideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

656 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_cÚfig
());

657 } ià(
	`¡rcmp
(
fCodecName
, "VORBIS") == 0) {

658 
ÃwSšk
 = 
VÜbisAudioRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
,

659 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
(), fCl›ÁMedŸSub£ssiÚ.
	`numChªÃls
(),

660 
fCl›ÁMedŸSub£ssiÚ
.
	`fm_cÚfig
());

661 } ià(
	`¡rcmp
(
fCodecName
, "VP8") == 0) {

662 
ÃwSšk
 = 
VP8VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

663 } ià(
	`¡rcmp
(
fCodecName
, "VP9") == 0) {

664 
ÃwSšk
 = 
VP9VideoRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
, 
¹pPaylßdTy³IfDyÇmic
);

665 } ià(
	`¡rcmp
(
fCodecName
, "AMR") == 0 || strcmp(fCodecName, "AMR-WB") == 0) {

668 ià(
	`v”bos™yLev–
() > 0) {

669 
	`’vœ
() << "\treturns NULL (because we currently don't supporthe…roxying of \""

670 << 
fCl›ÁMedŸSub£ssiÚ
.
	`mediumName
(è<< "/" << 
fCodecName
 << "\" streams)\n";

672  
NULL
;

673 } ià(
	`¡rcmp
(
fCodecName
, "QCELP") == 0 ||

674 
	`¡rcmp
(
fCodecName
, "H261") == 0 ||

675 
	`¡rcmp
(
fCodecName
, "H263-1998") == 0 || strcmp(fCodecName, "H263-2000") == 0 ||

676 
	`¡rcmp
(
fCodecName
, "X-QT") == 0 || strcmp(fCodecName, "X-QUICKTIME") == 0) {

678 ià(
	`v”bos™yLev–
() > 0) {

679 
	`’vœ
() << "\treturns NULL (because we don't have‡ \"RTPSink\" subclass forhis RTP…ayload format)\n";

681  
NULL
;

684 
BoŞ—n
 
®lowMuÉËF¿mesP”Pack‘
 = 
True
;

685 
BoŞ—n
 
doNÜm®MB™RuË
 = 
True
;

687 ià(
	`¡rcmp
(
fCodecName
, "MP2T") == 0) {

688 
doNÜm®MB™RuË
 = 
F®£
;

690 
ÃwSšk
 = 
Sim¶eRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

691 
¹pPaylßdTy³IfDyÇmic
, 
fCl›ÁMedŸSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
(),

692 
fCl›ÁMedŸSub£ssiÚ
.
	`mediumName
(), 
fCodecName
,

693 
fCl›ÁMedŸSub£ssiÚ
.
	`numChªÃls
(), 
®lowMuÉËF¿mesP”Pack‘
, 
doNÜm®MB™RuË
);

698 
ÃwSšk
->
	`’abËRTCPR•Üts
(èğ
F®£
;

701 
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
* 
ssNÜm®iz”
;

702 ià(
	`¡rcmp
(
fCodecName
, "H264") == 0 ||

703 
	`¡rcmp
(
fCodecName
, "H265") == 0 ||

704 
	`¡rcmp
(
fCodecName
, "MP4V-ES") == 0 ||

705 
	`¡rcmp
(
fCodecName
, "MPV") == 0 ||

706 
	`¡rcmp
(
fCodecName
, "DV") == 0) {

708 
ssNÜm®iz”
 = (
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
*)(((
F¿medF‹r
*)
šputSourû
)->
	`šputSourû
());

710 
ssNÜm®iz”
 = (
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
*)
šputSourû
;

712 
ssNÜm®iz”
->
	`£tRTPSšk
(
ÃwSšk
);

714  
ÃwSšk
;

715 
	}
}

717 
Groupsock
* 
	gProxyS”v”MedŸSub£ssiÚ
::
	$ü—‹Groupsock
(
š_addr
 cÚ¡& 
addr
, 
PÜt
 
pÜt
) {

718 
ProxyS”v”MedŸSessiÚ
* 
·»ÁSessiÚ
 = (ProxyS”v”MedŸSessiÚ*)
fP¬’tSessiÚ
;

719  
·»ÁSessiÚ
->
	`ü—‹Groupsock
(
addr
, 
pÜt
);

720 
	}
}

722 
RTCPIn¡ªû
* 
	gProxyS”v”MedŸSub£ssiÚ


723 ::
	$ü—‹RTCP
(
Groupsock
* 
RTCPgs
, 
tÙSessiÚBW
,

724 cÚ¡* 
úame
, 
RTPSšk
* 
sšk
) {

725 
ProxyS”v”MedŸSessiÚ
* 
·»ÁSessiÚ
 = (ProxyS”v”MedŸSessiÚ*)
fP¬’tSessiÚ
;

726  
·»ÁSessiÚ
->
	`ü—‹RTCP
(
RTCPgs
, 
tÙSessiÚBW
, 
úame
, 
sšk
);

727 
	}
}

729 
	gProxyS”v”MedŸSub£ssiÚ
::
	$sub£ssiÚByeHªdËr
(* 
ş›ÁD©a
) {

730 ((
ProxyS”v”MedŸSub£ssiÚ
*)
ş›ÁD©a
)->
	`sub£ssiÚByeHªdËr
();

731 
	}
}

733 
	gProxyS”v”MedŸSub£ssiÚ
::
	$sub£ssiÚByeHªdËr
() {

734 ià(
	`v”bos™yLev–
() > 0) {

735 
	`’vœ
(è<< *
this
 << ":„eceived RTCP \"BYE\". (The back-end stream hasƒnded.)\n";

739 
fHaveS‘upSŒ—m
 = 
F®£
;

740 ià(
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
(è!ğ
NULL
) {

741 
fCl›ÁMedŸSub£ssiÚ
.
	`»adSourû
()->
	`hªdËClosu»
();

746 
ProxyS”v”MedŸSessiÚ
* cÚ¡ 
sms
 = (ProxyS”v”MedŸSessiÚ*)
fP¬’tSessiÚ
;

747 
ProxyRTSPCl›Á
* cÚ¡ 
´oxyRTSPCl›Á
 = 
sms
->
fProxyRTSPCl›Á
;

748 
´oxyRTSPCl›Á
->
	`cÚtšueAá”Liv’essCommªd
(1 ,…roxyRTSPCl›Á->
fS”v”SuµÜtsG‘P¬am‘”
);

749 
	}
}

756 
	gP»£Á©iÚTimeSessiÚNÜm®iz”
::
	$P»£Á©iÚTimeSessiÚNÜm®iz”
(
U§geEnvœÚm’t
& 
’v
)

757 : 
	`Medium
(
’v
),

758 
	`fSub£ssiÚNÜm®iz”s
(
NULL
), 
	$fMa¡”SSNÜm®iz”
(
NULL
) {

759 
	}
}

761 
	gP»£Á©iÚTimeSessiÚNÜm®iz”
::~
	$P»£Á©iÚTimeSessiÚNÜm®iz”
() {

762 
fSub£ssiÚNÜm®iz”s
 !ğ
NULL
) {

763 
d–‘e
 
fSub£ssiÚNÜm®iz”s
;

765 
	}
}

767 
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
* 
	gP»£Á©iÚTimeSessiÚNÜm®iz”


768 ::
	$ü—‹NewP»£Á©iÚTimeSub£ssiÚNÜm®iz”
(
F¿medSourû
* 
šputSourû
, 
RTPSourû
* 
¹pSourû
,

769 cÚ¡* 
codecName
) {

770 
fSub£ssiÚNÜm®iz”s


771 ğ
Ãw
 
	`P»£Á©iÚTimeSub£ssiÚNÜm®iz”
(*
this
, 
šputSourû
, 
¹pSourû
, 
codecName
, 
fSub£ssiÚNÜm®iz”s
);

772  
fSub£ssiÚNÜm®iz”s
;

773 
	}
}

775 
	gP»£Á©iÚTimeSessiÚNÜm®iz”


776 ::
	$nÜm®izeP»£Á©iÚTime
(
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
* 
ssNÜm®iz”
,

777 
timev®
& 
toPT
, timev® cÚ¡& 
äomPT
) {

778 
BoŞ—n
 cÚ¡ 
hasB“nSynûd
 = 
ssNÜm®iz”
->
fRTPSourû
->
	`hasB“nSynchrÚizedUsšgRTCP
();

780 ià(!
hasB“nSynûd
) {

783 
toPT
 = 
äomPT
;

785 ià(
fMa¡”SSNÜm®iz”
 =ğ
NULL
) {

789 
fMa¡”SSNÜm®iz”
 = 
ssNÜm®iz”
;

791 
timev®
 
timeNow
;

792 
	`g‘timeofday
(&
timeNow
, 
NULL
);

795 
fPTAdju¡m’t
.
tv_£c
 = 
timeNow
.tv_£ø- 
äomPT
.tv_sec;

796 
fPTAdju¡m’t
.
tv_u£c
 = 
timeNow
.tv_u£ø- 
äomPT
.tv_usec;

801 
toPT
.
tv_£c
 = 
äomPT
.tv_£ø+ 
fPTAdju¡m’t
.tv_sec - 1;

802 
toPT
.
tv_u£c
 = 
äomPT
.tv_u£ø+ 
fPTAdju¡m’t
.tv_u£ø+ 
MILLION
;

803 
toPT
.
tv_u£c
 > 
MILLION
è{ ++toPT.
tv_£c
;oPT.tv_usec -= MILLION; }

806 
RTPSšk
* cÚ¡ 
¹pSšk
 = 
ssNÜm®iz”
->
fRTPSšk
;

807 ià(
¹pSšk
 !ğ
NULL
) {

808 
¹pSšk
->
	`’abËRTCPR•Üts
(èğ
True
;

811 
	}
}

813 
	gP»£Á©iÚTimeSessiÚNÜm®iz”


814 ::
	$»moveP»£Á©iÚTimeSub£ssiÚNÜm®iz”
(
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
* 
ssNÜm®iz”
) {

816 ià(
fSub£ssiÚNÜm®iz”s
 =ğ
ssNÜm®iz”
) {

817 
fSub£ssiÚNÜm®iz”s
 = fSub£ssiÚNÜm®iz”s->
fNext
;

819 
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
** 
ssPŒPŒ
 = &(
fSub£ssiÚNÜm®iz”s
->
fNext
);

820 *
ssPŒPŒ
 !ğ
ssNÜm®iz”
èssPŒPŒ = &((*ssPŒPŒ)->
fNext
);

821 *
ssPŒPŒ
 = (*ssPŒPŒ)->
fNext
;

823 
	}
}

827 
	gP»£Á©iÚTimeSub£ssiÚNÜm®iz”


828 ::
	$P»£Á©iÚTimeSub£ssiÚNÜm®iz”
(
P»£Á©iÚTimeSessiÚNÜm®iz”
& 
·»Á
, 
F¿medSourû
* 
šputSourû
, 
RTPSourû
* 
¹pSourû
,

829 cÚ¡* 
codecName
, 
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
* 
Ãxt
)

830 : 
	`F¿medF‹r
(
·»Á
.
	`’vœ
(), 
šputSourû
),

831 
	`fP¬’t
(
·»Á
), 
	`fRTPSourû
(
¹pSourû
), 
	`fRTPSšk
(
NULL
), 
	`fCodecName
(
codecName
), 
	$fNext
(
Ãxt
) {

832 
	}
}

834 
	gP»£Á©iÚTimeSub£ssiÚNÜm®iz”
::~
	$P»£Á©iÚTimeSub£ssiÚNÜm®iz”
() {

835 
fP¬’t
.
	`»moveP»£Á©iÚTimeSub£ssiÚNÜm®iz”
(
this
);

836 
	}
}

838 
	gP»£Á©iÚTimeSub£ssiÚNÜm®iz”
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

839 
numTrunÿ‹dBy‹s
,

840 
timev®
 
´e£Á©iÚTime
,

841 
du¿tiÚInMiüo£cÚds
) {

842 ((
P»£Á©iÚTimeSub£ssiÚNÜm®iz”
*)
ş›ÁD©a
)

843 ->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

844 
	}
}

846 
	gP»£Á©iÚTimeSub£ssiÚNÜm®iz”
::
	$aá”G‘tšgF¿me
(
äameSize
,

847 
numTrunÿ‹dBy‹s
,

848 
timev®
 
´e£Á©iÚTime
,

849 
du¿tiÚInMiüo£cÚds
) {

851 
fF¿meSize
 = 
äameSize
;

852 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

853 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

855 
fP¬’t
.
	`nÜm®izeP»£Á©iÚTime
(
this
, 
fP»£Á©iÚTime
, 
´e£Á©iÚTime
);

859 ià(
fRTPSourû
->
	`curPack‘M¬k”B™
(è&& 
	`¡rcmp
(
fCodecName
, "JPEG"è=ğ0è((
Sim¶eRTPSšk
*)
fRTPSšk
)->
	`£tMB™OnNextPack‘
();

862 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

863 
	}
}

865 
	gP»£Á©iÚTimeSub£ssiÚNÜm®iz”
::
	$doG‘NextF¿me
() {

866 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
, 
aá”G‘tšgF¿me
, 
this
, 
F¿medSourû
::
hªdËClosu»
,his);

867 
	}
}

	@liveMedia/QCELPAudioRTPSource.cpp

21 
	~"QCELPAudioRTPSourû.hh
"

22 
	~"MuÉiF¿medRTPSourû.hh
"

23 
	~"F¿medF‹r.hh
"

24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

32 şas 
	cRawQCELPRTPSourû
: 
public
 
MuÉiF¿medRTPSourû
 {

33 
public
:

34 
RawQCELPRTPSourû
* 
ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

35 
Groupsock
* 
RTPgs
,

36 
¹pPaylßdFÜm©
,

37 
¹pTime¡ampF»qu’cy
);

39 
	$š‹¾—veL
(ècÚ¡ {  
fIÁ”ËaveL
; }

40 
	$š‹¾—veN
(ècÚ¡ {  
fIÁ”ËaveN
; 
	}
}

41 & 
	$äameIndex
(è{  
fF¿meIndex
; 
	}
}

43 
	g´iv©e
:

44 
RawQCELPRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

45 
¹pPaylßdFÜm©
,

46 
¹pTime¡ampF»qu’cy
);

49 
	gvœtu®
 ~
RawQCELPRTPSourû
();

51 
	g´iv©e
:

53 
vœtu®
 
BoŞ—n
 
´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

54 & 
»suÉS³cŸlH—d”Size
);

55 
vœtu®
 cÚ¡* 
	$MIMEty³
() const;

57 
vœtu®
 
BoŞ—n
 
	`hasB“nSynchrÚizedUsšgRTCP
();

59 
´iv©e
:

60 
fIÁ”ËaveL
, 
fIÁ”ËaveN
, 
fF¿meIndex
;

61 
fNumSucûssiveSynûdPack‘s
;

62 
	}
};

64 şas 
	cQCELPDeš‹¾—v”
: 
public
 
F¿medF‹r
 {

65 
public
:

66 
QCELPDeš‹¾—v”
* 
ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

67 
RawQCELPRTPSourû
* 
šputSourû
);

69 
	m´iv©e
:

70 
QCELPDeš‹¾—v”
(
U§geEnvœÚm’t
& 
’v
,

71 
RawQCELPRTPSourû
* 
šputSourû
);

74 
	mvœtu®
 ~
QCELPDeš‹¾—v”
();

76 
aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

77 
numTrunÿ‹dBy‹s
,

78 
timev®
 
´e£Á©iÚTime
,

79 
du¿tiÚInMiüo£cÚds
);

80 
aá”G‘tšgF¿me1
(
äameSize
, 
timev®
 
´e£Á©iÚTime
);

82 
	m´iv©e
:

84 
doG‘NextF¿me
();

85 
vœtu®
 
doStİG‘tšgF¿mes
();

87 
	m´iv©e
:

88 
şass
 
QCELPDeš‹¾—všgBufãr
* 
fDeš‹¾—všgBufãr
;

89 
BoŞ—n
 
	mfN“dAF¿me
;

95 
F¿medSourû
*

96 
	gQCELPAudioRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

97 
Groupsock
* 
RTPgs
,

98 
RTPSourû
*& 
»suÉRTPSourû
,

99 
¹pPaylßdFÜm©
,

100 
¹pTime¡ampF»qu’cy
) {

101 
RawQCELPRTPSourû
* 
¿wRTPSourû
;

102 
»suÉRTPSourû
 = 
¿wRTPSourû


103 ğ
RawQCELPRTPSourû
::
	`ü—‹New
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

104 
¹pTime¡ampF»qu’cy
);

105 ià(
»suÉRTPSourû
 =ğ
NULL
)  NULL;

107 
QCELPDeš‹¾—v”
* 
deš‹¾—v”


108 ğ
QCELPDeš‹¾—v”
::
	`ü—‹New
(
’v
, 
¿wRTPSourû
);

109 ià(
deš‹¾—v”
 =ğ
NULL
) {

110 
Medium
::
	`şo£
(
»suÉRTPSourû
);

111 
»suÉRTPSourû
 = 
NULL
;

114  
deš‹¾—v”
;

115 
	}
}

122 şas 
	cQCELPBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

123 
public
:

124 
QCELPBufã»dPack‘
(
RawQCELPRTPSourû
& 
ourSourû
);

125 
	mvœtu®
 ~
QCELPBufã»dPack‘
();

127 
	m´iv©e
:

128 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

129 
d©aSize
);

130 
	m´iv©e
:

131 
RawQCELPRTPSourû
& 
fOurSourû
;

134 şas 
	cQCELPBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

135 
´iv©e
:

136 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

142 
RawQCELPRTPSourû
*

143 
	gRawQCELPRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

144 
¹pPaylßdFÜm©
,

145 
¹pTime¡ampF»qu’cy
) {

146  
Ãw
 
	`RawQCELPRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

147 
¹pTime¡ampF»qu’cy
);

148 
	}
}

150 
	gRawQCELPRTPSourû
::
	$RawQCELPRTPSourû
(
U§geEnvœÚm’t
& 
’v
,

151 
Groupsock
* 
RTPgs
,

152 
¹pPaylßdFÜm©
,

153 
¹pTime¡ampF»qu’cy
)

154 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

155 
¹pTime¡ampF»qu’cy
,

156 
Ãw
 
QCELPBufã»dPack‘FaùÜy
),

157 
	`fIÁ”ËaveL
(0), 
	`fIÁ”ËaveN
(0), 
	`fF¿meIndex
(0),

158 
	$fNumSucûssiveSynûdPack‘s
(0) {

159 
	}
}

161 
	gRawQCELPRTPSourû
::~
	$RawQCELPRTPSourû
() {

162 
	}
}

164 
BoŞ—n
 
RawQCELPRTPSourû


165 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

166 & 
»suÉS³cŸlH—d”Size
) {

167 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

168 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

171 ià(
RTPSourû
::
	`hasB“nSynchrÚizedUsšgRTCP
()) {

172 ++
fNumSucûssiveSynûdPack‘s
;

174 
fNumSucûssiveSynûdPack‘s
 = 0;

178 ià(
·ck‘Size
 < 1è 
F®£
;

182 cÚ¡ 
fœ¡By‹
 = 
h—d”S¹
[0];

183 cÚ¡ 
š‹¾—veL
 = (
fœ¡By‹
&0x38)>>3;

184 cÚ¡ 
š‹¾—veN
 = 
fœ¡By‹
&0x07;

185 #ifdeà
DEBUG


186 
	`årštf
(
¡d”r
, "·ck‘Size: %d, iÁ”ËaveL: %d, iÁ”ËaveN: %d\n", 
·ck‘Size
, 
š‹¾—veL
, 
š‹¾—veN
);

188 ià(
š‹¾—veL
 > 5 || 
š‹¾—veN
 > iÁ”ËaveLè 
F®£
;

190 
fIÁ”ËaveL
 = 
š‹¾—veL
;

191 
fIÁ”ËaveN
 = 
š‹¾—veN
;

192 
fF¿meIndex
 = 0;

194 
»suÉS³cŸlH—d”Size
 = 1;

195  
True
;

196 
	}
}

198 cÚ¡* 
	gRawQCELPRTPSourû
::
	$MIMEty³
() const {

200 
	}
}

202 
BoŞ—n
 
	gRawQCELPRTPSourû
::
	$hasB“nSynchrÚizedUsšgRTCP
() {

207 ià(
fNumSucûssiveSynûdPack‘s
 > ()(
fIÁ”ËaveL
+1)) {

208 
fNumSucûssiveSynûdPack‘s
 = 
fIÁ”ËaveL
+2;

209  
True
;

211  
F®£
;

212 
	}
}

217 
	gQCELPBufã»dPack‘
::
	$QCELPBufã»dPack‘
(
RawQCELPRTPSourû
& 
ourSourû
)

218 : 
	$fOurSourû
(
ourSourû
) {

219 
	}
}

221 
QCELPBufã»dPack‘
::~
	$QCELPBufã»dPack‘
() {

222 
	}
}

224 
QCELPBufã»dPack‘
::

225 
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

227 ià(
d©aSize
 == 0)  0;

228 cÚ¡ 
fœ¡By‹
 = 
äamePŒ
[0];

230 
äameSize
;

231 
fœ¡By‹
) {

232 0: { 
äameSize
 = 1; ; }

233 1: { 
äameSize
 = 4; ; }

234 2: { 
äameSize
 = 8; ; }

235 3: { 
äameSize
 = 17; ; }

236 4: { 
äameSize
 = 35; ; }

237 : { 
äameSize
 = 0; ; }

240 #ifdeà
DEBUG


241 
	`årštf
(
¡d”r
, "QCELPBufã»dPack‘::ÃxtEnşo£dF¿meSize(): f¿meSize: %d, d©aSize: %d\n", 
äameSize
, 
d©aSize
);

243 ià(
d©aSize
 < 
äameSize
)  0;

245 ++
fOurSourû
.
	`äameIndex
();

246  
äameSize
;

247 
	}
}

249 
Bufã»dPack‘
* 
	gQCELPBufã»dPack‘FaùÜy


250 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

251  
Ãw
 
	`QCELPBufã»dPack‘
((
RawQCELPRTPSourû
&)(*
ourSourû
));

252 
	}
}

257 
	#QCELP_MAX_FRAME_SIZE
 35

	)

258 
	#QCELP_MAX_INTERLEAVE_L
 5

	)

259 
	#QCELP_MAX_FRAMES_PER_PACKET
 10

	)

260 
	#QCELP_MAX_INTERLEAVE_GROUP_SIZE
 \

261 ((
QCELP_MAX_INTERLEAVE_L
+1)*
QCELP_MAX_FRAMES_PER_PACKET
)

	)

263 şas 
	cQCELPDeš‹¾—všgBufãr
 {

264 
	mpublic
:

265 
QCELPDeš‹¾—všgBufãr
();

266 
	mvœtu®
 ~
QCELPDeš‹¾—všgBufãr
();

268 
d–iv”IncomšgF¿me
(
äameSize
,

269 
š‹¾—veL
,

270 
š‹¾—veN
,

271 
äameIndex
,

272 
·ck‘SeqNum
,

273 
timev®
 
´e£Á©iÚTime
);

274 
BoŞ—n
 
»Œ›veF¿me
(* 
to
, 
maxSize
,

275 & 
»suÉF¿meSize
, & 
»suÉNumTrunÿ‹dBy‹s
,

276 
timev®
& 
»suÉP»£Á©iÚTime
);

278 * 
	$šputBufãr
(è{  
fIÅutBufãr
; }

279 
	$šputBufãrSize
(ècÚ¡ {  
QCELP_MAX_FRAME_SIZE
; 
	}
}

281 
	g´iv©e
:

282 şas 
	cF¿meDesütÜ
 {

283 
public
:

284 
F¿meDesütÜ
();

285 
	gvœtu®
 ~
F¿meDesütÜ
();

287 
	gäameSize
;

288 * 
	gäameD©a
;

289 
timev®
 
	g´e£Á©iÚTime
;

293 
F¿meDesütÜ
 
	gfF¿mes
[
QCELP_MAX_INTERLEAVE_GROUP_SIZE
][2];

294 
	gfIncomšgBªkId
;

295 
	gfIncomšgBšMax
;

296 
	gfOutgošgBšMax
;

297 
	gfNextOutgošgBš
;

298 
BoŞ—n
 
	gfHaveS“nPack‘s
;

299 
u_št16_t
 
	gfLa¡Pack‘SeqNumFÜGroup
;

300 * 
	gfIÅutBufãr
;

301 
timev®
 
	gfLa¡R‘r›vedP»£Á©iÚTime
;

307 
QCELPDeš‹¾—v”
*

308 
	gQCELPDeš‹¾—v”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

309 
RawQCELPRTPSourû
* 
šputSourû
) {

310  
Ãw
 
	`QCELPDeš‹¾—v”
(
’v
, 
šputSourû
);

311 
	}
}

313 
	gQCELPDeš‹¾—v”
::
	$QCELPDeš‹¾—v”
(
U§geEnvœÚm’t
& 
’v
,

314 
RawQCELPRTPSourû
* 
šputSourû
)

315 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

316 
	$fN“dAF¿me
(
F®£
) {

317 
fDeš‹¾—všgBufãr
 = 
Ãw
 
	`QCELPDeš‹¾—všgBufãr
();

318 
	}
}

320 
	gQCELPDeš‹¾—v”
::~
	$QCELPDeš‹¾—v”
() {

321 
d–‘e
 
fDeš‹¾—všgBufãr
;

322 
	}
}

324 cÚ¡ 
	guSecsP”F¿me
 = 20000;

326 
	gQCELPDeš‹¾—v”
::
	$doG‘NextF¿me
() {

328 ià(
fDeš‹¾—všgBufãr
->
	`»Œ›veF¿me
(
fTo
, 
fMaxSize
,

329 
fF¿meSize
, 
fNumTrunÿ‹dBy‹s
,

330 
fP»£Á©iÚTime
)) {

332 
fN“dAF¿me
 = 
F®£
;

334 
fDu¿tiÚInMiüo£cÚds
 = 
uSecsP”F¿me
;

339 
	`aá”G‘tšg
(
this
);

344 
fN“dAF¿me
 = 
True
;

345 ià(!
fIÅutSourû
->
	`isCu¼’yAwa™šgD©a
()) {

346 
fIÅutSourû
->
	`g‘NextF¿me
(
fDeš‹¾—všgBufãr
->
	`šputBufãr
(),

347 
fDeš‹¾—všgBufãr
->
	`šputBufãrSize
(),

348 
aá”G‘tšgF¿me
, 
this
,

349 
F¿medSourû
::
hªdËClosu»
, 
this
);

351 
	}
}

353 
	gQCELPDeš‹¾—v”
::
	$doStİG‘tšgF¿mes
() {

354 
fN“dAF¿me
 = 
F®£
;

355 
fIÅutSourû
->
	`¡İG‘tšgF¿mes
();

356 
	}
}

358 
	gQCELPDeš‹¾—v”


359 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

361 
timev®
 
´e£Á©iÚTime
,

363 
QCELPDeš‹¾—v”
* 
deš‹¾—v”
 = (QCELPDeš‹¾—v”*)
ş›ÁD©a
;

364 
deš‹¾—v”
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
´e£Á©iÚTime
);

365 
	}
}

367 
	gQCELPDeš‹¾—v”


368 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
timev®
 
´e£Á©iÚTime
) {

369 
RawQCELPRTPSourû
* 
sourû
 = (RawQCELPRTPSourû*)
fIÅutSourû
;

372 
fDeš‹¾—všgBufãr


373 ->
	`d–iv”IncomšgF¿me
(
äameSize
, 
sourû
->
	`š‹¾—veL
(),

374 
sourû
->
	`š‹¾—veN
(), sourû->
	`äameIndex
(),

375 
sourû
->
	`curPack‘RTPSeqNum
(),

376 
´e£Á©iÚTime
);

379 ià(
fN“dAF¿me
è
	`doG‘NextF¿me
();

380 
	}
}

385 
	gQCELPDeš‹¾—všgBufãr
::
	$QCELPDeš‹¾—všgBufãr
()

386 : 
	`fIncomšgBªkId
(0), 
	`fIncomšgBšMax
(0),

387 
	`fOutgošgBšMax
(0), 
	`fNextOutgošgBš
(0),

388 
	$fHaveS“nPack‘s
(
F®£
) {

389 
fIÅutBufãr
 = 
Ãw
 [
QCELP_MAX_FRAME_SIZE
];

390 
	}
}

392 
	gQCELPDeš‹¾—všgBufãr
::~
	$QCELPDeš‹¾—všgBufãr
() {

393 
d–‘e
[] 
fIÅutBufãr
;

394 
	}
}

396 
	gQCELPDeš‹¾—všgBufãr


397 ::
	$d–iv”IncomšgF¿me
(
äameSize
,

398 
š‹¾—veL
,

399 
š‹¾—veN
,

400 
äameIndex
,

401 
·ck‘SeqNum
,

402 
timev®
 
´e£Á©iÚTime
) {

405 ià(
äameSize
 > 
QCELP_MAX_FRAME_SIZE


406 || 
š‹¾—veL
 > 
QCELP_MAX_INTERLEAVE_L
 || 
š‹¾—veN
 > interleaveL

407 || 
äameIndex
 =ğ0 || f¿meIndex > 
QCELP_MAX_FRAMES_PER_PACKET
) {

408 #ifdeà
DEBUG


409 
	`årštf
(
¡d”r
, "QCELPDeš‹¾—všgBufãr::d–iv”IncomšgF¿me(è·¿m sª™y check faed (%d,%d,%d,%d)\n", 
äameSize
, 
š‹¾—veL
, 
š‹¾—veN
, 
äameIndex
);

416 
uSecInüem’t
 = (
äameIndex
-1)*(
š‹¾—veL
+1)*
uSecsP”F¿me
;

417 
´e£Á©iÚTime
.
tv_u£c
 +ğ
uSecInüem’t
;

418 
´e£Á©iÚTime
.
tv_£c
 +ğ´e£Á©iÚTime.
tv_u£c
/1000000;

419 
´e£Á©iÚTime
.
tv_u£c
 =…resentationTime.tv_usec%1000000;

422 ià(!
fHaveS“nPack‘s


423 || 
	`£qNumLT
(
fLa¡Pack‘SeqNumFÜGroup
, 
·ck‘SeqNum
)) {

425 
fHaveS“nPack‘s
 = 
True
;

426 
fLa¡Pack‘SeqNumFÜGroup
 = 
·ck‘SeqNum
 + 
š‹¾—veL
 - 
š‹¾—veN
;

429 
fIncomšgBªkId
 ^= 1;

430 
tmp
 = 
fIncomšgBšMax
;

431 
fIncomšgBšMax
 = 
fOutgošgBšMax
;

432 
fOutgošgBšMax
 = 
tmp
;

433 
fNextOutgošgBš
 = 0;

437 cÚ¡ 
bšNumb”


438 ğ
š‹¾—veN
 + (
äameIndex
-1)*(
š‹¾—veL
+1);

439 
F¿meDesütÜ
& 
šBš
 = 
fF¿mes
[
bšNumb”
][
fIncomšgBªkId
];

440 * 
curBufãr
 = 
šBš
.
äameD©a
;

441 
šBš
.
äameD©a
 = 
fIÅutBufãr
;

442 
šBš
.
äameSize
 = frameSize;

443 
šBš
.
´e£Á©iÚTime
 =…resentationTime;

445 ià(
curBufãr
 =ğ
NULL
ècurBufã¸ğ
Ãw
 [
QCELP_MAX_FRAME_SIZE
];

446 
fIÅutBufãr
 = 
curBufãr
;

448 ià(
bšNumb”
 >ğ
fIncomšgBšMax
) {

449 
fIncomšgBšMax
 = 
bšNumb”
 + 1;

451 
	}
}

453 
BoŞ—n
 
	gQCELPDeš‹¾—všgBufãr


454 ::
	$»Œ›veF¿me
(* 
to
, 
maxSize
,

455 & 
»suÉF¿meSize
, & 
»suÉNumTrunÿ‹dBy‹s
,

456 
timev®
& 
»suÉP»£Á©iÚTime
) {

457 ià(
fNextOutgošgBš
 >ğ
fOutgošgBšMax
è 
F®£
;

459 
F¿meDesütÜ
& 
outBš
 = 
fF¿mes
[
fNextOutgošgBš
][
fIncomšgBªkId
^1];

460 * 
äomPŒ
;

461 
äomSize
 = 
outBš
.
äameSize
;

462 
outBš
.
äameSize
 = 0;

465 
”asu»
 = 14;

466 ià(
äomSize
 == 0) {

467 
äomPŒ
 = &
”asu»
;

468 
äomSize
 = 1;

471 
»suÉP»£Á©iÚTime
 = 
fLa¡R‘r›vedP»£Á©iÚTime
;

472 
»suÉP»£Á©iÚTime
.
tv_u£c
 +ğ
uSecsP”F¿me
;

473 ià(
»suÉP»£Á©iÚTime
.
tv_u£c
 >= 1000000) {

474 ++
»suÉP»£Á©iÚTime
.
tv_£c
;

475 
»suÉP»£Á©iÚTime
.
tv_u£c
 -= 1000000;

479 
äomPŒ
 = 
outBš
.
äameD©a
;

480 
»suÉP»£Á©iÚTime
 = 
outBš
.
´e£Á©iÚTime
;

483 
fLa¡R‘r›vedP»£Á©iÚTime
 = 
»suÉP»£Á©iÚTime
;

485 ià(
äomSize
 > 
maxSize
) {

486 
»suÉNumTrunÿ‹dBy‹s
 = 
äomSize
 - 
maxSize
;

487 
»suÉF¿meSize
 = 
maxSize
;

489 
»suÉNumTrunÿ‹dBy‹s
 = 0;

490 
»suÉF¿meSize
 = 
äomSize
;

492 
	`memmove
(
to
, 
äomPŒ
, 
»suÉF¿meSize
);

494 ++
fNextOutgošgBš
;

495  
True
;

496 
	}
}

498 
	gQCELPDeš‹¾—všgBufãr
::
F¿meDesütÜ
::
	$F¿meDesütÜ
()

499 : 
	`äameSize
(0), 
	$äameD©a
(
NULL
) {

500 
	}
}

502 
	gQCELPDeš‹¾—všgBufãr
::
F¿meDesütÜ
::~
	$F¿meDesütÜ
() {

503 
d–‘e
[] 
äameD©a
;

504 
	}
}

	@liveMedia/QuickTimeFileSink.cpp

21 
	~"QuickTimeFeSšk.hh
"

22 
	~"QuickTimeG’”icRTPSourû.hh
"

23 
	~"GroupsockH–³r.hh
"

24 
	~"IÅutFe.hh
"

25 
	~"OuutFe.hh
"

26 
	~"H263¶usVideoRTPSourû.hh
"

27 
	~"MPEG4G’”icRTPSourû.hh
"

28 
	~"MPEG4LATMAudioRTPSourû.hh
"

29 
	~"Ba£64.hh
"

31 
	~<ùy³.h
>

33 
	#fourCh¬
(
x
,
y
,
z
,
w
èĞ((x)<<24)|((y)<<16)|((z)<<8)|(wè)

	)

35 
	#H264_IDR_FRAME
 0x65

36 

	)

40 şas 
	cChunkDesütÜ
 {

41 
	mpublic
:

42 
ChunkDesütÜ
(
št64_t
 
off£tInFe
, 
size
,

43 
äameSize
, 
äameDu¿tiÚ
,

44 
timev®
 
´e£Á©iÚTime
);

46 
ChunkDesütÜ
* 
ex‹ndChunk
(
št64_t
 
ÃwOff£tInFe
, 
ÃwSize
,

47 
ÃwF¿meSize
,

48 
ÃwF¿meDu¿tiÚ
,

49 
timev®
 
ÃwP»£Á©iÚTime
);

51 
	mpublic
:

52 
ChunkDesütÜ
* 
fNextChunk
;

53 
št64_t
 
	mfOff£tInFe
;

54 
	mfNumF¿mes
;

55 
	mfF¿meSize
;

56 
	mfF¿meDu¿tiÚ
;

57 
timev®
 
	mfP»£Á©iÚTime
;

60 şas 
	cSub£ssiÚBufãr
 {

61 
	mpublic
:

62 
	$Sub£ssiÚBufãr
(
bufãrSize
)

63 : 
	$fBufãrSize
(
bufãrSize
) {

64 
	`»£t
();

65 
fD©a
 = 
Ãw
 [
bufãrSize
];

67 
vœtu®
 ~
	$Sub£ssiÚBufãr
(è{ 
d–‘e
[] 
fD©a
; 
	}
}

68 
	$»£t
(è{ 
fBy‹sInU£
 = 0; 
	}
}

69 
	$addBy‹s
(
numBy‹s
è{ 
fBy‹sInU£
 +ğnumBy‹s; 
	}
}

71 * 
	$d©aS¹
(è{  &
fD©a
[0]; 
	}
}

72 * 
	$d©aEnd
(è{  &
fD©a
[
fBy‹sInU£
]; 
	}
}

73 
	$by‹sInU£
(ècÚ¡ {  
fBy‹sInU£
; 
	}
}

74 
	$by‹sAvaabË
(ècÚ¡ {  
fBufãrSize
 - 
fBy‹sInU£
; 
	}
}

76 
	$£tP»£Á©iÚTime
(
timev®
 cÚ¡& 
´e£Á©iÚTime
) {

77 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

78 
	}
}

79 
timev®
 cÚ¡& 
	$´e£Á©iÚTime
(ècÚ¡ { 
fP»£Á©iÚTime
;
	}
}

81 
	g´iv©e
:

82 
fBufãrSize
;

83 
timev®
 
	gfP»£Á©iÚTime
;

84 * 
	gfD©a
;

85 
	gfBy‹sInU£
;

88 şas 
	cSyncF¿me
 {

89 
	mpublic
:

90 
SyncF¿me
(
äameNum
);

92 
	mpublic
:

93 
şass
 
SyncF¿me
 *
ÃxtSyncF¿me
;

94 
	msfF¿meNum
;

98 şas 
	cCouÁ64
 {

99 
	mpublic
:

100 
	$CouÁ64
()

101 : 
	`hi
(0), 
	$lo
(0) {

104 
İ”©Ü
+=(
¬g
);

106 
u_št32_t
 
hi
, 
lo
;

107 
	}
};

109 şas 
	cSub£ssiÚIOS‹
 {

110 
	mpublic
:

111 
Sub£ssiÚIOS‹
(
QuickTimeFeSšk
& 
sšk
, 
MedŸSub£ssiÚ
& 
sub£ssiÚ
);

112 
	mvœtu®
 ~
Sub£ssiÚIOS‹
();

114 
BoŞ—n
 
£tQT¡©e
();

115 
£tFš®QT¡©e
();

117 
aá”G‘tšgF¿me
(
·ck‘D©aSize
,

118 
timev®
 
´e£Á©iÚTime
);

119 
ÚSourûClosu»
();

121 
BoŞ—n
 
syncOK
(
timev®
 
´e£Á©iÚTime
);

124 
£tHštT¿ck
(
Sub£ssiÚIOS‹
* 
hš‹dT¿ck
,

125 
Sub£ssiÚIOS‹
* 
hštT¿ck
);

126 
BoŞ—n
 
	$isHštT¿ck
(ècÚ¡ {  
fT¿ckHš‹dByUs
 !ğ
NULL
; }

127 
BoŞ—n
 
	$hasHštT¿ck
(ècÚ¡ {  
fHštT¿ckFÜUs
 !ğ
NULL
; 
	}
}

129 
	gU§geEnvœÚm’t
& 
	$’vœ
(ècÚ¡ {  
fOurSšk
.
	`’vœ
(); 
	}
}

131 
	gpublic
:

132 
fCu¼’tT¿ckNumb”
;

133 
	gfT¿ckID
;

134 
Sub£ssiÚIOS‹
* 
	gfHštT¿ckFÜUs
; Sub£ssiÚIOS‹* 
	gfT¿ckHš‹dByUs
;

136 
Sub£ssiÚBufãr
 *
	gfBufãr
, *
	gfP»vBufãr
;

137 
	gQuickTimeFeSšk
& 
	gfOurSšk
;

138 
	gMedŸSub£ssiÚ
& 
	gfOurSub£ssiÚ
;

140 
	gfLa¡Pack‘RTPSeqNum
;

141 
BoŞ—n
 
	gfOurSourûIsAùive
;

143 
BoŞ—n
 
	gfHaveB“nSynûd
;

144 
timev®
 
	gfSyncTime
;

146 
BoŞ—n
 
	gfQTEÇbËT¿ck
;

147 
	gfQTcompÚ’tSubty³
;

148 cÚ¡* 
	gfQTcompÚ’tName
;

149 (
	gQuickTimeFeSšk
::*
	t©omC»©iÚFunc
)();

150 
©omC»©iÚFunc
 
	gfQTMedŸInfÜm©iÚAtomC»©Ü
;

151 
©omC»©iÚFunc
 
	gfQTMedŸD©aAtomC»©Ü
;

152 cÚ¡* 
	gfQTAudioD©aTy³
;

153 
	gfQTSoundSam¶eV”siÚ
;

154 
	gfQTTimeSÿË
;

155 
	gfQTTimeUn™sP”Sam¶e
;

156 
	gfQTBy‹sP”F¿me
;

157 
	gfQTSam¶esP”F¿me
;

160 
	gfQTTÙNumSam¶es
;

161 
	gfQTDu¿tiÚM
;

162 
	gfQTDu¿tiÚT
;

163 
št64_t
 
	gfTKHD_du¿tiÚPo¢
;

165 
	gfQTIn™ŸlOff£tDu¿tiÚ
;

168 
ChunkDesütÜ
 *
	gfH—dChunk
, *
	gfTaChunk
;

169 
	gfNumChunks
;

170 
SyncF¿me
 *
	gfH—dSyncF¿me
, *
	gfTaSyncF¿me
;

173 
	shšf
 {

174 
CouÁ64
 
	gŒpy
;

175 
CouÁ64
 
	gnump
;

176 
CouÁ64
 
	gyl
;

178 
CouÁ64
 
	gdmed
;

179 
CouÁ64
 
	gdimm
;

182 
	gpmax
;

183 
	gdmax
;

184 } 
	gfHINF
;

186 
	g´iv©e
:

187 
u£F¿me
(
Sub£ssiÚBufãr
& 
bufãr
);

188 
u£F¿meFÜHštšg
(
äameSize
,

189 
timev®
 
´e£Á©iÚTime
,

190 
¡¬tSam¶eNumb”
);

193 
u£F¿me1
(
sourûD©aSize
,

194 
timev®
 
´e£Á©iÚTime
,

195 
äameDu¿tiÚ
, 
št64_t
 
de¡FeOff£t
);

198 
	g´iv©e
:

201 
äameSize
;

202 
timev®
 
	g´e£Á©iÚTime
;

203 
št64_t
 
	gde¡FeOff£t
;

206 
	g¡¬tSam¶eNumb”
;

207 
	g£qNum
;

208 
	g¹pH—d”
;

209 
	gnumS³cŸlH—d”s
;

210 
	g¥ecŸlH—d”By‹sL’gth
;

211 
	g¥ecŸlH—d”By‹s
[
SPECIAL_HEADER_BUFFER_SIZE
];

212 
	g·ck‘Sizes
[256];

213 } 
	gfP»vF¿meS‹
;

219 
	gQuickTimeFeSšk
::
	$QuickTimeFeSšk
(
U§geEnvœÚm’t
& 
’v
,

220 
MedŸSessiÚ
& 
šputSessiÚ
,

221 cÚ¡* 
ouutFeName
,

222 
bufãrSize
,

223 
mov›Width
,

224 
mov›Height
,

225 
mov›FPS
,

226 
BoŞ—n
 
·ck‘LossCom³n§‹
,

227 
BoŞ—n
 
syncSŒ—ms
,

228 
BoŞ—n
 
g’”©eHštT¿cks
,

229 
BoŞ—n
 
g’”©eMP4FÜm©
)

230 : 
	`Medium
(
’v
), 
	`fIÅutSessiÚ
(
šputSessiÚ
),

231 
	`fBufãrSize
(
bufãrSize
), 
	`fPack‘LossCom³n§‹
(
·ck‘LossCom³n§‹
),

232 
	`fSyncSŒ—ms
(
syncSŒ—ms
), 
	`fG’”©eMP4FÜm©
(
g’”©eMP4FÜm©
),

233 
	`fA»Cu¼’yBešgPÏyed
(
F®£
),

234 
	`fL¬ge¡RTPtime¡ampF»qu’cy
(0),

235 
	`fNumSub£ssiÚs
(0), 
	`fNumSynûdSub£ssiÚs
(0),

236 
	`fHaveCom¶‘edOuutFe
(
F®£
),

237 
	`fMov›Width
(
mov›Width
), 
	`fMov›Height
(
mov›Height
),

238 
	`fMov›FPS
(
mov›FPS
), 
	$fMaxT¿ckDu¿tiÚM
(0) {

239 
fOutFid
 = 
	`O³nOuutFe
(
’v
, 
ouutFeName
);

240 ià(
fOutFid
 =ğ
NULL
) ;

242 
fNewe¡SyncTime
.
tv_£c
 = fNewe¡SyncTime.
tv_u£c
 = 0;

243 
fFœ¡D©aTime
.
tv_£c
 = fFœ¡D©aTime.
tv_u£c
 = ()(~0);

246 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

247 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

248 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

250 
F¿medSourû
* 
sub£ssiÚSourû
 = 
sub£ssiÚ
->
	`»adSourû
();

251 ià(
sub£ssiÚSourû
 =ğ
NULL
) ;

256 ià(
sub£ssiÚ
->
	`videoWidth
() != 0) {

257 
fMov›Width
 = 
sub£ssiÚ
->
	`videoWidth
();

259 ià(
sub£ssiÚ
->
	`videoHeight
() != 0) {

260 
fMov›Height
 = 
sub£ssiÚ
->
	`videoHeight
();

262 ià(
sub£ssiÚ
->
	`videoFPS
() != 0) {

263 
fMov›FPS
 = 
sub£ssiÚ
->
	`videoFPS
();

266 
Sub£ssiÚIOS‹
* 
ioS‹


267 ğ
Ãw
 
	`Sub£ssiÚIOS‹
(*
this
, *
sub£ssiÚ
);

268 ià(
ioS‹
 =ğ
NULL
 || !ioS‹->
	`£tQT¡©e
()) {

270 
d–‘e
 
ioS‹
; ioS‹ = 
NULL
;

273 
sub£ssiÚ
->
miscPŒ
 = (*)
ioS‹
;

275 ià(
g’”©eHštT¿cks
) {

277 
Sub£ssiÚIOS‹
* 
hštT¿ck


278 ğ
Ãw
 
	`Sub£ssiÚIOS‹
(*
this
, *
sub£ssiÚ
);

279 
Sub£ssiÚIOS‹
::
	`£tHštT¿ck
(
ioS‹
, 
hštT¿ck
);

280 ià(!
hštT¿ck
->
	`£tQT¡©e
()) {

281 
d–‘e
 
hštT¿ck
;

282 
Sub£ssiÚIOS‹
::
	`£tHštT¿ck
(
ioS‹
, 
NULL
);

287 ià(
sub£ssiÚ
->
	`¹ıIn¡ªû
(è!ğ
NULL
) {

288 
sub£ssiÚ
->
	`¹ıIn¡ªû
()->
	`£tByeHªdËr
(
ÚRTCPBye
, 
ioS‹
);

291 
¹pTime¡ampF»qu’cy
 = 
sub£ssiÚ
->
	`¹pTime¡ampF»qu’cy
();

292 ià(
¹pTime¡ampF»qu’cy
 > 
fL¬ge¡RTPtime¡ampF»qu’cy
) {

293 
fL¬ge¡RTPtime¡ampF»qu’cy
 = 
¹pTime¡ampF»qu’cy
;

296 ++
fNumSub£ssiÚs
;

302 
	`g‘timeofday
(&
fS¹Time
, 
NULL
);

303 
fAµËC»©iÚTime
 = 
fS¹Time
.
tv_£c
 - 0x83dac000;

308 
fMDATpos™iÚ
 = 
	`T–lFe64
(
fOutFid
);

309 
	`addAtomH—d”64
("mdat");

311 
fMDATpos™iÚ
 += 8;

312 
	}
}

314 
	gQuickTimeFeSšk
::~
	$QuickTimeFeSšk
() {

315 
	`com¶‘eOuutFe
();

318 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

319 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

320 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

321 ià(
sub£ssiÚ
->
	`»adSourû
(è!ğ
NULL
èsub£ssiÚ->»adSourû()->
	`¡İG‘tšgF¿mes
();

323 
Sub£ssiÚIOS‹
* 
ioS‹


324 ğ(
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

325 ià(
ioS‹
 =ğ
NULL
) ;

327 
d–‘e
 
ioS‹
->
fHštT¿ckFÜUs
;

328 
d–‘e
 
ioS‹
;

332 
	`Clo£OuutFe
(
fOutFid
);

333 
	}
}

335 
QuickTimeFeSšk
*

336 
	gQuickTimeFeSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

337 
MedŸSessiÚ
& 
šputSessiÚ
,

338 cÚ¡* 
ouutFeName
,

339 
bufãrSize
,

340 
mov›Width
,

341 
mov›Height
,

342 
mov›FPS
,

343 
BoŞ—n
 
·ck‘LossCom³n§‹
,

344 
BoŞ—n
 
syncSŒ—ms
,

345 
BoŞ—n
 
g’”©eHštT¿cks
,

346 
BoŞ—n
 
g’”©eMP4FÜm©
) {

347 
QuickTimeFeSšk
* 
ÃwSšk
 =

348 
Ãw
 
	`QuickTimeFeSšk
(
’v
, 
šputSessiÚ
, 
ouutFeName
, 
bufãrSize
, 
mov›Width
, 
mov›Height
, 
mov›FPS
,

349 
·ck‘LossCom³n§‹
, 
syncSŒ—ms
, 
g’”©eHštT¿cks
, 
g’”©eMP4FÜm©
);

350 ià(
ÃwSšk
 =ğ
NULL
 ||‚ewSšk->
fOutFid
 == NULL) {

351 
Medium
::
	`şo£
(
ÃwSšk
);

352  
NULL
;

355  
ÃwSšk
;

356 
	}
}

358 
	gQuickTimeFeSšk


359 ::
	$nÙeRecÜdedF¿me
(
MedŸSub£ssiÚ
& ,

360 , 
timev®
 const& ) {

362 
	}
}

364 
BoŞ—n
 
	gQuickTimeFeSšk
::
	$¡¬tPÏyšg
(
aá”PÏyšgFunc
* 
aá”Func
,

365 * 
aá”Cl›ÁD©a
) {

367 ià(
fA»Cu¼’yBešgPÏyed
) {

368 
	`’vœ
().
	`£tResuÉMsg
("This sink has‡lready been…layed");

369  
F®£
;

372 
fA»Cu¼’yBešgPÏyed
 = 
True
;

373 
fAá”Func
 = 
aá”Func
;

374 
fAá”Cl›ÁD©a
 = 
aá”Cl›ÁD©a
;

376  
	`cÚtšuePÏyšg
();

377 
	}
}

379 
BoŞ—n
 
	gQuickTimeFeSšk
::
	$cÚtšuePÏyšg
() {

382 
BoŞ—n
 
haveAùiveSub£ssiÚs
 = 
F®£
;

383 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

384 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

385 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

386 
F¿medSourû
* 
sub£ssiÚSourû
 = 
sub£ssiÚ
->
	`»adSourû
();

387 ià(
sub£ssiÚSourû
 =ğ
NULL
) ;

389 ià(
sub£ssiÚSourû
->
	`isCu¼’yAwa™šgD©a
()) ;

391 
Sub£ssiÚIOS‹
* 
ioS‹


392 ğ(
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

393 ià(
ioS‹
 =ğ
NULL
) ;

395 
haveAùiveSub£ssiÚs
 = 
True
;

396 * 
toPŒ
 = 
ioS‹
->
fBufãr
->
	`d©aEnd
();

397 
toSize
 = 
ioS‹
->
fBufãr
->
	`by‹sAvaabË
();

398 
sub£ssiÚSourû
->
	`g‘NextF¿me
(
toPŒ
, 
toSize
,

399 
aá”G‘tšgF¿me
, 
ioS‹
,

400 
ÚSourûClosu»
, 
ioS‹
);

402 ià(!
haveAùiveSub£ssiÚs
) {

403 
	`’vœ
().
	`£tResuÉMsg
("No subsessions‡re currently‡ctive");

404  
F®£
;

407  
True
;

408 
	}
}

410 
	gQuickTimeFeSšk


411 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
·ck‘D©aSize
,

412 
numTrunÿ‹dBy‹s
,

413 
timev®
 
´e£Á©iÚTime
,

415 
Sub£ssiÚIOS‹
* 
ioS‹
 = (Sub£ssiÚIOS‹*)
ş›ÁD©a
;

416 ià(!
ioS‹
->
	`syncOK
(
´e£Á©iÚTime
)) {

418 
ioS‹
->
fOurSšk
.
	`cÚtšuePÏyšg
();

421 ià(
numTrunÿ‹dBy‹s
 > 0) {

422 
ioS‹
->
	`’vœ
() << "QuickTimeFileSink::afterGettingFrame(): The input frame data wasoo†arge for our buffer. "

423 << 
numTrunÿ‹dBy‹s


426 
ioS‹
->
	`aá”G‘tšgF¿me
(
·ck‘D©aSize
, 
´e£Á©iÚTime
);

427 
	}
}

429 
	gQuickTimeFeSšk
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

430 
Sub£ssiÚIOS‹
* 
ioS‹
 = (Sub£ssiÚIOS‹*)
ş›ÁD©a
;

431 
ioS‹
->
	`ÚSourûClosu»
();

432 
	}
}

434 
	gQuickTimeFeSšk
::
	$ÚSourûClosu»1
() {

437 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

438 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

439 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

440 
Sub£ssiÚIOS‹
* 
ioS‹


441 ğ(
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

442 ià(
ioS‹
 =ğ
NULL
) ;

444 ià(
ioS‹
->
fOurSourûIsAùive
) ;

447 
	`com¶‘eOuutFe
();

450 ià(
fAá”Func
 !ğ
NULL
) {

451 (*
fAá”Func
)(
fAá”Cl›ÁD©a
);

453 
	}
}

455 
	gQuickTimeFeSšk
::
	$ÚRTCPBye
(* 
ş›ÁD©a
) {

456 
Sub£ssiÚIOS‹
* 
ioS‹
 = (Sub£ssiÚIOS‹*)
ş›ÁD©a
;

458 
timev®
 
timeNow
;

459 
	`g‘timeofday
(&
timeNow
, 
NULL
);

460 
£csDiff


461 ğ
timeNow
.
tv_£c
 - 
ioS‹
->
fOurSšk
.
fS¹Time
.tv_sec;

463 
MedŸSub£ssiÚ
& 
sub£ssiÚ
 = 
ioS‹
->
fOurSub£ssiÚ
;

464 
ioS‹
->
	`’vœ
() << "Received RTCP \"BYE\" on \""

465 << 
sub£ssiÚ
.
	`mediumName
()

466 << "/" << 
sub£ssiÚ
.
	`codecName
()

468 << 
£csDiff
 << " seconds)\n";

471 
ioS‹
->
	`ÚSourûClosu»
();

472 
	}
}

474 
BoŞ—n
 
	$timev®GE
(
timev®
 cÚ¡& 
tv1
,

475 
timev®
 cÚ¡& 
tv2
) {

476  ()
tv1
.
tv_£c
 > ()
tv2
.tv_sec

477 || (
tv1
.
tv_£c
 =ğ
tv2
.tv_sec

478 && ()
tv1
.
tv_u£c
 >ğ()
tv2
.tv_usec);

479 
	}
}

481 
	gQuickTimeFeSšk
::
	$com¶‘eOuutFe
() {

482 ià(
fHaveCom¶‘edOuutFe
 || 
fOutFid
 =ğ
NULL
) ;

486 
št64_t
 
curFeSize
 = 
	`T–lFe64
(
fOutFid
);

487 
	`£tWÜd64
(
fMDATpos™iÚ
, (
u_št64_t
)
curFeSize
);

490 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
fIÅutSessiÚ
);

491 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

492 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

493 
Sub£ssiÚIOS‹
* 
ioS‹


494 ğ(
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

495 ià(
ioS‹
 =ğ
NULL
) ;

497 
ChunkDesütÜ
* cÚ¡ 
h—dChunk
 = 
ioS‹
->
fH—dChunk
;

498 ià(
h—dChunk
 !ğ
NULL


499 && 
	`timev®GE
(
fFœ¡D©aTime
, 
h—dChunk
->
fP»£Á©iÚTime
)) {

500 
fFœ¡D©aTime
 = 
h—dChunk
->
fP»£Á©iÚTime
;

505 
™”
.
	`»£t
();

506 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

507 
Sub£ssiÚIOS‹
* 
ioS‹


508 ğ(
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

509 ià(
ioS‹
 =ğ
NULL
) ;

511 
ioS‹
->
	`£tFš®QT¡©e
();

513 ià(
ioS‹
->
	`hasHštT¿ck
()) {

514 
ioS‹
->
fHštT¿ckFÜUs
->
	`£tFš®QT¡©e
();

518 ià(
fG’”©eMP4FÜm©
) {

520 
	`addAtom_áyp
();

524 
	`addAtom_moov
();

527 
fHaveCom¶‘edOuutFe
 = 
True
;

528 
	}
}

533 
	gSub£ssiÚIOS‹
::
fCu¼’tT¿ckNumb”
 = 0;

535 
	gSub£ssiÚIOS‹
::
	$Sub£ssiÚIOS‹
(
QuickTimeFeSšk
& 
sšk
,

536 
MedŸSub£ssiÚ
& 
sub£ssiÚ
)

537 : 
	`fHštT¿ckFÜUs
(
NULL
), 
	`fT¿ckHš‹dByUs
(NULL),

538 
	`fOurSšk
(
sšk
), 
	`fOurSub£ssiÚ
(
sub£ssiÚ
),

539 
	`fLa¡Pack‘RTPSeqNum
(0), 
	`fHaveB“nSynûd
(
F®£
), 
	`fQTTÙNumSam¶es
(0),

540 
	`fH—dChunk
(
NULL
), 
	`fTaChunk
(NULL), 
	`fNumChunks
(0),

541 
	`fH—dSyncF¿me
(
NULL
), 
	$fTaSyncF¿me
(
NULL
) {

542 
fT¿ckID
 = ++
fCu¼’tT¿ckNumb”
;

544 
fBufãr
 = 
Ãw
 
	`Sub£ssiÚBufãr
(
fOurSšk
.
fBufãrSize
);

545 
fP»vBufãr
 = 
sšk
.
fPack‘LossCom³n§‹


546 ? 
Ãw
 
	`Sub£ssiÚBufãr
(
fOurSšk
.
fBufãrSize
è: 
NULL
;

548 
F¿medSourû
* 
sub£ssiÚSourû
 = 
sub£ssiÚ
.
	`»adSourû
();

549 
fOurSourûIsAùive
 = 
sub£ssiÚSourû
 !ğ
NULL
;

551 
fP»vF¿meS‹
.
´e£Á©iÚTime
.
tv_£c
 = 0;

552 
fP»vF¿meS‹
.
´e£Á©iÚTime
.
tv_u£c
 = 0;

553 
fP»vF¿meS‹
.
£qNum
 = 0;

554 
	}
}

556 
	gSub£ssiÚIOS‹
::~
	$Sub£ssiÚIOS‹
() {

557 
d–‘e
 
fBufãr
; d–‘
fP»vBufãr
;

560 
ChunkDesütÜ
* 
chunk
 = 
fH—dChunk
;

561 
chunk
 !ğ
NULL
) {

562 
ChunkDesütÜ
* 
Ãxt
 = 
chunk
->
fNextChunk
;

563 
d–‘e
 
chunk
;

564 
chunk
 = 
Ãxt
;

568 
SyncF¿me
* 
syncF¿me
 = 
fH—dSyncF¿me
;

569 
syncF¿me
 !ğ
NULL
) {

570 
SyncF¿me
* 
Ãxt
 = 
syncF¿me
->
ÃxtSyncF¿me
;

571 
d–‘e
 
syncF¿me
;

572 
syncF¿me
 = 
Ãxt
;

574 
	}
}

576 
BoŞ—n
 
	gSub£ssiÚIOS‹
::
	$£tQT¡©e
() {

577 cÚ¡* 
noCodecW¬nšg1
 = "Warning: We don't implement‡ QuickTime ";

578 cÚ¡* 
noCodecW¬nšg2
 = " Media Data Type forhe \"";

579 cÚ¡* 
noCodecW¬nšg3
 = "\"rack, so we'll insert‡ dummy \"????\" Media Data Atom instead. A separate, codec-specificƒditing…ass will be‚eeded beforehisrack can be…layed.\n";

582 
fQTEÇbËT¿ck
 = 
True
;

583 
fQTTimeSÿË
 = 
fOurSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
();

584 
fQTTimeUn™sP”Sam¶e
 = 1;

585 
fQTBy‹sP”F¿me
 = 0;

587 
fQTSam¶esP”F¿me
 = 1;

591 ià(
	`isHštT¿ck
()) {

593 
fQTEÇbËT¿ck
 = 
F®£
;

594 
fQTcompÚ’tSubty³
 = 
	`fourCh¬
('h','i','n','t');

595 
fQTcompÚ’tName
 = "hint media handler";

596 
fQTMedŸInfÜm©iÚAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_gmhd
;

597 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_¹p
;

598 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`mediumName
(), "audio") == 0) {

599 
fQTcompÚ’tSubty³
 = 
	`fourCh¬
('s','o','u','n');

600 
fQTcompÚ’tName
 = "Apple Sound Media Handler";

601 
fQTMedŸInfÜm©iÚAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_smhd
;

602 
fQTMedŸD©aAtomC»©Ü


603 ğ&
QuickTimeFeSšk
::
addAtom_soundMedŸG’”®
;

604 
fQTSoundSam¶eV”siÚ
 = 0;

607 ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "X-QT") == 0 ||

608 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "X-QUICKTIME") == 0) {

609 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_g’”icMedŸ
;

610 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "PCMU") == 0) {

611 
fQTAudioD©aTy³
 = "ulaw";

612 
fQTBy‹sP”F¿me
 = 1;

613 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "GSM") == 0) {

614 
fQTAudioD©aTy³
 = "agsm";

615 
fQTBy‹sP”F¿me
 = 33;

616 
fQTSam¶esP”F¿me
 = 160;

617 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "PCMA") == 0) {

618 
fQTAudioD©aTy³
 = "alaw";

619 
fQTBy‹sP”F¿me
 = 1;

620 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "QCELP") == 0) {

621 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_Qşp
;

622 
fQTSam¶esP”F¿me
 = 160;

623 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MPEG4-GENERIC") == 0 ||

624 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MP4A-LATM") == 0) {

625 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_mp4a
;

626 
fQTTimeUn™sP”Sam¶e
 = 1024;

629 
äequ’cyFromCÚfig


630 ğ
	`§m¶šgF»qu’cyFromAudioS³cificCÚfig
(
fOurSub£ssiÚ
.
	`fm_cÚfig
());

631 ià(
äequ’cyFromCÚfig
 !ğ0è
fQTTimeSÿË
 = frequencyFromConfig;

633 
	`’vœ
(è<< 
noCodecW¬nšg1
 << "Audio" << 
noCodecW¬nšg2


634 << 
fOurSub£ssiÚ
.
	`codecName
(è<< 
noCodecW¬nšg3
;

635 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_dummy
;

636 
fQTEÇbËT¿ck
 = 
F®£
;

638 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`mediumName
(), "video") == 0) {

639 
fQTcompÚ’tSubty³
 = 
	`fourCh¬
('v','i','d','e');

640 
fQTcompÚ’tName
 = "Apple Video Media Handler";

641 
fQTMedŸInfÜm©iÚAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_vmhd
;

644 ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "X-QT") == 0 ||

645 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "X-QUICKTIME") == 0) {

646 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_g’”icMedŸ
;

647 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H263-1998") == 0 ||

648 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H263-2000") == 0) {

649 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_h263
;

650 
fQTTimeSÿË
 = 600;

651 
fQTTimeUn™sP”Sam¶e
 = 
fQTTimeSÿË
/
fOurSšk
.
fMov›FPS
;

652 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H264") == 0) {

653 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_avc1
;

654 
fQTTimeSÿË
 = 600;

655 
fQTTimeUn™sP”Sam¶e
 = 
fQTTimeSÿË
/
fOurSšk
.
fMov›FPS
;

656 } ià(
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MP4V-ES") == 0) {

657 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_mp4v
;

658 
fQTTimeSÿË
 = 600;

659 
fQTTimeUn™sP”Sam¶e
 = 
fQTTimeSÿË
/
fOurSšk
.
fMov›FPS
;

661 
	`’vœ
(è<< 
noCodecW¬nšg1
 << "Video" << 
noCodecW¬nšg2


662 << 
fOurSub£ssiÚ
.
	`codecName
(è<< 
noCodecW¬nšg3
;

663 
fQTMedŸD©aAtomC»©Ü
 = &
QuickTimeFeSšk
::
addAtom_dummy
;

664 
fQTEÇbËT¿ck
 = 
F®£
;

667 
	`’vœ
() << "Warning: We don't implement‡ QuickTime Media Handler for mediaype \""

668 << 
fOurSub£ssiÚ
.
	`mediumName
() << "\"";

672 #ifdeà
QT_SUPPORT_PARTIALLY_ONLY


673 
	`’vœ
() << "Warning: We don't have sufficient codec-specific information (e.g., sample sizes)o fully generatehe \""

674 << 
fOurSub£ssiÚ
.
	`mediumName
(è<< "/" << fOurSub£ssiÚ.
	`codecName
()

676 
fQTEÇbËT¿ck
 = 
F®£
;

679  
True
;

682 
	`’vœ
(è<< ", sØ¨Œack fÜh\"" << 
fOurSub£ssiÚ
.
	`mediumName
()

683 << "/" << 
fOurSub£ssiÚ
.
	`codecName
()

685  
F®£
;

686 
	}
}

688 
	gSub£ssiÚIOS‹
::
	$£tFš®QT¡©e
() {

690 
fQTDu¿tiÚT
 = 0;

692 
ChunkDesütÜ
* 
chunk
 = 
fH—dChunk
;

693 
chunk
 !ğ
NULL
) {

694 cÚ¡ 
numF¿mes
 = 
chunk
->
fNumF¿mes
;

695 cÚ¡ 
dur
 = 
numF¿mes
*
chunk
->
fF¿meDu¿tiÚ
;

696 
fQTDu¿tiÚT
 +ğ
dur
;

698 
chunk
 = chunk->
fNextChunk
;

702 
sÿËFaùÜ
 = 
fOurSšk
.
	`mov›TimeSÿË
()/()
fQTTimeSÿË
;

703 
fQTDu¿tiÚM
 = ()(
fQTDu¿tiÚT
*
sÿËFaùÜ
);

705 ià(
fQTDu¿tiÚM
 > 
fOurSšk
.
fMaxT¿ckDu¿tiÚM
) {

706 
fOurSšk
.
fMaxT¿ckDu¿tiÚM
 = 
fQTDu¿tiÚM
;

708 
	}
}

710 
	gSub£ssiÚIOS‹
::
	$aá”G‘tšgF¿me
(
·ck‘D©aSize
,

711 
timev®
 
´e£Á©iÚTime
) {

714 
¹pSeqNum


715 ğ
fOurSub£ssiÚ
.
	`¹pSourû
()->
	`curPack‘RTPSeqNum
();

716 ià(
fOurSšk
.
fPack‘LossCom³n§‹
 && 
fP»vBufãr
->
	`by‹sInU£
() > 0) {

717 
£qNumG­
 = 
¹pSeqNum
 - 
fLa¡Pack‘RTPSeqNum
;

718 
i
 = 1; i < 
£qNumG­
; ++i) {

720 
	`u£F¿me
(*
fP»vBufãr
);

723 
fLa¡Pack‘RTPSeqNum
 = 
¹pSeqNum
;

726 
fOurSšk
.
	`nÙeRecÜdedF¿me
(
fOurSub£ssiÚ
, 
·ck‘D©aSize
, 
´e£Á©iÚTime
);

728 ià(
fBufãr
->
	`by‹sInU£
() == 0) {

729 
fBufãr
->
	`£tP»£Á©iÚTime
(
´e£Á©iÚTime
);

731 
fBufãr
->
	`addBy‹s
(
·ck‘D©aSize
);

735 ià(
fQTMedŸD©aAtomC»©Ü
 =ğ&
QuickTimeFeSšk
::
addAtom_g’”icMedŸ
){

736 
QuickTimeG’”icRTPSourû
* 
¹pSourû


737 ğ(
QuickTimeG’”icRTPSourû
*)
fOurSub£ssiÚ
.
	`¹pSourû
();

738 
QuickTimeG’”icRTPSourû
::
QTS‹
& 
qtS‹
 = 
¹pSourû
->qtState;

739 
fQTTimeSÿË
 = 
qtS‹
.
timesÿË
;

740 ià(
qtS‹
.
width
 != 0) {

741 
fOurSšk
.
fMov›Width
 = 
qtS‹
.
width
;

743 ià(
qtS‹
.
height
 != 0) {

744 
fOurSšk
.
fMov›Height
 = 
qtS‹
.
height
;

749 ià(
qtS‹
.
sdAtomSize
 >= 8) {

750 cÚ¡* 
©om
 = 
qtS‹
.
sdAtom
;

751 
medŸTy³
 = 
	`fourCh¬
(
©om
[4],atom[5],atom[6],atom[7]);

752 
medŸTy³
) {

753 
	`fourCh¬
('a','g','s','m'): {

754 
fQTBy‹sP”F¿me
 = 33;

755 
fQTSam¶esP”F¿me
 = 160;

758 
	`fourCh¬
('Q','c','l','p'): {

759 
fQTBy‹sP”F¿me
 = 35;

760 
fQTSam¶esP”F¿me
 = 160;

763 
	`fourCh¬
('H','c','l','p'): {

764 
fQTBy‹sP”F¿me
 = 17;

765 
fQTSam¶esP”F¿me
 = 160;

768 
	`fourCh¬
('h','2','6','3'): {

769 
fQTTimeUn™sP”Sam¶e
 = 
fQTTimeSÿË
/
fOurSšk
.
fMov›FPS
;

774 } ià(
fQTMedŸD©aAtomC»©Ü
 =ğ&
QuickTimeFeSšk
::
addAtom_Qşp
) {

779 
fQTBy‹sP”F¿me
 = 
·ck‘D©aSize
;

782 
	`u£F¿me
(*
fBufãr
);

783 ià(
fOurSšk
.
fPack‘LossCom³n§‹
) {

785 
Sub£ssiÚBufãr
* 
tmp
 = 
fP»vBufãr
;

786 
fP»vBufãr
 = 
fBufãr
;

787 
fBufãr
 = 
tmp
;

789 
fBufãr
->
	`»£t
();

792 
fOurSšk
.
	`cÚtšuePÏyšg
();

793 
	}
}

795 
	gSub£ssiÚIOS‹
::
	$u£F¿me
(
Sub£ssiÚBufãr
& 
bufãr
) {

796 * cÚ¡ 
äameSourû
 = 
bufãr
.
	`d©aS¹
();

797 cÚ¡ 
äameSize
 = 
bufãr
.
	`by‹sInU£
();

798 
timev®
 cÚ¡& 
´e£Á©iÚTime
 = 
bufãr
.
	`´e£Á©iÚTime
();

799 
št64_t
 cÚ¡ 
de¡FeOff£t
 = 
	`T–lFe64
(
fOurSšk
.
fOutFid
);

800 
§m¶eNumb”OfF¿meS¹
 = 
fQTTÙNumSam¶es
 + 1;

801 
BoŞ—n
 
avcHack
 = 
fQTMedŸD©aAtomC»©Ü
 =ğ&
QuickTimeFeSšk
::
addAtom_avc1
;

805 ià(!
fOurSšk
.
fSyncSŒ—ms


806 || 
fQTcompÚ’tSubty³
 !ğ
	`fourCh¬
('v','i','d','e')) {

807 cÚ¡ 
äameDu¿tiÚ
 = 
fQTTimeUn™sP”Sam¶e
*
fQTSam¶esP”F¿me
;

808 
äameSizeToU£
 = 
äameSize
;

809 ià(
avcHack
è
äameSizeToU£
 += 4;

811 
fQTTÙNumSam¶es
 +ğ
	`u£F¿me1
(
äameSizeToU£
, 
´e£Á©iÚTime
, 
äameDu¿tiÚ
, 
de¡FeOff£t
);

816 
timev®
 cÚ¡& 
µt
 = 
fP»vF¿meS‹
.
´e£Á©iÚTime
;

817 ià(
µt
.
tv_£c
 !ğ0 ||…±.
tv_u£c
 != 0) {

819 
du¿tiÚ
 = (
´e£Á©iÚTime
.
tv_£c
 - 
µt
.tv_sec)

820 + (
´e£Á©iÚTime
.
tv_u£c
 - 
µt
.tv_usec)/1000000.0;

821 ià(
du¿tiÚ
 < 0.0) duration = 0.0;

822 
äameDu¿tiÚ


823 ğ()((2*
du¿tiÚ
*
fQTTimeSÿË
+1)/2);

824 
äameSizeToU£
 = 
fP»vF¿meS‹
.
äameSize
;

825 ià(
avcHack
è
äameSizeToU£
 += 4;

827 
numSam¶es


828 ğ
	`u£F¿me1
(
äameSizeToU£
, 
µt
, 
äameDu¿tiÚ
, 
fP»vF¿meS‹
.
de¡FeOff£t
);

829 
fQTTÙNumSam¶es
 +ğ
numSam¶es
;

830 
§m¶eNumb”OfF¿meS¹
 = 
fQTTÙNumSam¶es
 + 1;

833 ià(
avcHack
 && (*
äameSourû
 =ğ
H264_IDR_FRAME
)) {

834 
SyncF¿me
* 
ÃwSyncF¿me
 = 
Ãw
 
	`SyncF¿me
(
fQTTÙNumSam¶es
 + 1);

835 ià(
fTaSyncF¿me
 =ğ
NULL
) {

836 
fH—dSyncF¿me
 = 
ÃwSyncF¿me
;

838 
fTaSyncF¿me
->
ÃxtSyncF¿me
 = 
ÃwSyncF¿me
;

840 
fTaSyncF¿me
 = 
ÃwSyncF¿me
;

844 
fP»vF¿meS‹
.
äameSize
 = frameSize;

845 
fP»vF¿meS‹
.
´e£Á©iÚTime
 =…resentationTime;

846 
fP»vF¿meS‹
.
de¡FeOff£t
 = destFileOffset;

849 ià(
avcHack
è
fOurSšk
.
	`addWÜd
(
äameSize
);

852 
	`fwr™e
(
äameSourû
, 1, 
äameSize
, 
fOurSšk
.
fOutFid
);

855 ià(
	`hasHštT¿ck
()) {

858 ià(!
fHaveB“nSynûd
) {

859 
fHaveB“nSynûd


860 ğ
fOurSub£ssiÚ
.
	`¹pSourû
()->
	`hasB“nSynchrÚizedUsšgRTCP
();

862 ià(
fHaveB“nSynûd
) {

863 
fHštT¿ckFÜUs
->
	`u£F¿meFÜHštšg
(
äameSize
, 
´e£Á©iÚTime
,

864 
§m¶eNumb”OfF¿meS¹
);

867 
	}
}

869 
	gSub£ssiÚIOS‹
::
	$u£F¿meFÜHštšg
(
äameSize
,

870 
timev®
 
´e£Á©iÚTime
,

871 
¡¬tSam¶eNumb”
) {

876 
BoŞ—n
 
hack263
 = 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "H263-1998") == 0;

877 
BoŞ—n
 
hackm4a_g’”ic
 = 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`mediumName
(), "audio") == 0

878 && 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MPEG4-GENERIC") == 0;

879 
BoŞ—n
 
hackm4a_Ïtm
 = 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`mediumName
(), "audio") == 0

880 && 
	`¡rcmp
(
fOurSub£ssiÚ
.
	`codecName
(), "MP4A-LATM") == 0;

881 
BoŞ—n
 
hackm4a
 = 
hackm4a_g’”ic
 || 
hackm4a_Ïtm
;

882 
BoŞ—n
 
haveS³cŸlH—d”s
 = (
hack263
 || 
hackm4a_g’”ic
);

887 
RTPSourû
* cÚ¡ 
rs
 = 
fOurSub£ssiÚ
.
	`¹pSourû
();

888 
timev®
 cÚ¡& 
µt
 = 
fP»vF¿meS‹
.
´e£Á©iÚTime
;

889 ià(
µt
.
tv_£c
 !ğ0 ||…±.
tv_u£c
 != 0) {

890 
du¿tiÚ
 = (
´e£Á©iÚTime
.
tv_£c
 - 
µt
.tv_sec)

891 + (
´e£Á©iÚTime
.
tv_u£c
 - 
µt
.tv_usec)/1000000.0;

892 ià(
du¿tiÚ
 < 0.0) duration = 0.0;

893 
msDu¿tiÚ
 = ()(
du¿tiÚ
*1000);

894 ià(
msDu¿tiÚ
 > 
fHINF
.
dmax
) fHINF.dmax = msDuration;

895 
hštSam¶eDu¿tiÚ


896 ğ()((2*
du¿tiÚ
*
fQTTimeSÿË
+1)/2);

897 ià(
hackm4a
) {

901 
hštSam¶eDu¿tiÚ
 = 
fT¿ckHš‹dByUs
->
fQTTimeUn™sP”Sam¶e
;

906 ià(
fT¿ckHš‹dByUs
->
fQTTimeSÿË
 !ğ
fOurSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
()) {

907 cÚ¡ 
sÿlšgFaùÜ


908 ğ
fOurSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
()/
fT¿ckHš‹dByUs
->
fQTTimeSÿË
 ;

909 
hštSam¶eDu¿tiÚ
 *ğ
sÿlšgFaùÜ
;

913 
št64_t
 cÚ¡ 
hštSam¶eDe¡FeOff£t
 = 
	`T–lFe64
(
fOurSšk
.
fOutFid
);

915 cÚ¡ 
maxPack‘Size
 = 1450;

916 
numPTEÁr›s


917 ğ(
fP»vF¿meS‹
.
äameSize
 + (
maxPack‘Size
-1))/maxPacketSize;

918 * 
immedŸ‹D©aPŒ
 = 
NULL
;

919 
immedŸ‹D©aBy‹sRemaššg
 = 0;

920 ià(
haveS³cŸlH—d”s
) {

921 
numPTEÁr›s
 = 
fP»vF¿meS‹
.
numS³cŸlH—d”s
;

922 
immedŸ‹D©aPŒ
 = 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹s
;

923 
immedŸ‹D©aBy‹sRemaššg


924 ğ
fP»vF¿meS‹
.
¥ecŸlH—d”By‹sL’gth
;

926 
hštSam¶eSize


927 ğ
fOurSšk
.
	`addH®fWÜd
(
numPTEÁr›s
);

928 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addH®fWÜd
(0x0000);

930 
off£tW™hšSam¶e
 = 0;

931 
i
 = 0; i < 
numPTEÁr›s
; ++i) {

933 
numDTEÁr›s
 = 1;

934 
£qNum
 = 
fP»vF¿meS‹
.seqNum++;

936 
¹pH—d”
 = 
fP»vF¿meS‹
.rtpHeader;

937 ià(
i
+1 < 
numPTEÁr›s
) {

939 
¹pH—d”
 &=~ (1<<23);

941 
d©aF¿meSize
 = (
i
+1 < 
numPTEÁr›s
)

942 ? 
maxPack‘Size
 : 
fP»vF¿meS‹
.
äameSize
 - 
i
*maxPacketSize;

943 
§m¶eNumb”
 = 
fP»vF¿meS‹
.
¡¬tSam¶eNumb”
;

945 
immedŸ‹D©aL’
 = 0;

946 ià(
haveS³cŸlH—d”s
) {

947 ++
numDTEÁr›s
;

948 ià(
immedŸ‹D©aBy‹sRemaššg
 > 0) {

949 ià(
hack263
) {

950 
immedŸ‹D©aL’
 = *
immedŸ‹D©aPŒ
++;

951 --
immedŸ‹D©aBy‹sRemaššg
;

952 ià(
immedŸ‹D©aL’
 > 
immedŸ‹D©aBy‹sRemaššg
) {

954 
immedŸ‹D©aL’
 = 
immedŸ‹D©aBy‹sRemaššg
;

957 
immedŸ‹D©aL’
 = 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹sL’gth
;

960 
d©aF¿meSize
 = 
fP»vF¿meS‹
.
·ck‘Sizes
[
i
] - 
immedŸ‹D©aL’
;

962 ià(
hack263
) {

963 
BoŞ—n
 
Pb™S‘


964 ğ
immedŸ‹D©aL’
 >ğ1 && (
immedŸ‹D©aPŒ
[0]&0x4) != 0;

965 ià(
Pb™S‘
) {

966 
off£tW™hšSam¶e
 += 2;

972 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addWÜd
(0);

973 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addWÜd
(
¹pH—d”
|
£qNum
);

975 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addH®fWÜd
(0x0000);

976 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addH®fWÜd
(
numDTEÁr›s
);

977 
tÙ®Pack‘Size
 = 0;

980 ià(
haveS³cŸlH—d”s
) {

982 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addBy‹
(1);

983 
Ën
 = 
immedŸ‹D©aL’
 > 14 ? 14 : immediateDataLen;

984 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addBy‹
(
Ën
);

985 
tÙ®Pack‘Size
 +ğ
Ën
; 
fHINF
.
dimm
 +=†en;

986 
j
;

987 
j
 = 0; j < 
Ën
; ++j) {

988 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addBy‹
(
immedŸ‹D©aPŒ
[
j
]);

990 
j
 = 
Ën
; j < 14; ++j) {

991 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addBy‹
(0);

994 
immedŸ‹D©aPŒ
 +ğ
immedŸ‹D©aL’
;

995 
immedŸ‹D©aBy‹sRemaššg
 -ğ
immedŸ‹D©aL’
;

998 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addBy‹
(2);

999 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addBy‹
(0);

1000 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addH®fWÜd
(
d©aF¿meSize
);

1001 
tÙ®Pack‘Size
 +ğ
d©aF¿meSize
; 
fHINF
.
dmed
 += dataFrameSize;

1002 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addWÜd
(
§m¶eNumb”
);

1003 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addWÜd
(
off£tW™hšSam¶e
);

1005 cÚ¡ 
by‹sP”Com´essiÚBlock


1006 ğ
fT¿ckHš‹dByUs
->
fQTBy‹sP”F¿me
;

1007 cÚ¡ 
§m¶esP”Com´essiÚBlock


1008 ğ
fT¿ckHš‹dByUs
->
fQTSam¶esP”F¿me
;

1009 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addH®fWÜd
(
by‹sP”Com´essiÚBlock
);

1010 
hštSam¶eSize
 +ğ
fOurSšk
.
	`addH®fWÜd
(
§m¶esP”Com´essiÚBlock
);

1012 
off£tW™hšSam¶e
 +ğ
d©aF¿meSize
;

1015 
fHINF
.
nump
 += 1;

1016 
fHINF
.
yl
 +ğ
tÙ®Pack‘Size
;

1017 
tÙ®Pack‘Size
 += 12;

1018 
fHINF
.
Œpy
 +ğ
tÙ®Pack‘Size
;

1019 ià(
tÙ®Pack‘Size
 > 
fHINF
.
pmax
) fHINF.pmax =otalPacketSize;

1023 
fQTTÙNumSam¶es
 +ğ
	`u£F¿me1
(
hštSam¶eSize
, 
µt
, 
hštSam¶eDu¿tiÚ
,

1024 
hštSam¶eDe¡FeOff£t
);

1028 
fP»vF¿meS‹
.
äameSize
 = frameSize;

1029 
fP»vF¿meS‹
.
´e£Á©iÚTime
 =…resentationTime;

1030 
fP»vF¿meS‹
.
¡¬tSam¶eNumb”
 = startSampleNumber;

1031 
fP»vF¿meS‹
.
¹pH—d”


1032 ğ
rs
->
	`curPack‘M¬k”B™
()<<23

1033 | (
rs
->
	`¹pPaylßdFÜm©
()&0x7F)<<16;

1034 ià(
hack263
) {

1035 
H263¶usVideoRTPSourû
* 
rs_263
 = (H263¶usVideoRTPSourû*)
rs
;

1036 
fP»vF¿meS‹
.
numS³cŸlH—d”s
 = 
rs_263
->
fNumS³cŸlH—d”s
;

1037 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹sL’gth
 = 
rs_263
->
fS³cŸlH—d”By‹sL’gth
;

1038 
i
;

1039 
i
 = 0; i < 
rs_263
->
fS³cŸlH—d”By‹sL’gth
; ++i) {

1040 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹s
[
i
] = 
rs_263
->
fS³cŸlH—d”By‹s
[i];

1042 
i
 = 0; i < 
rs_263
->
fNumS³cŸlH—d”s
; ++i) {

1043 
fP»vF¿meS‹
.
·ck‘Sizes
[
i
] = 
rs_263
->
fPack‘Sizes
[i];

1045 } ià(
hackm4a_g’”ic
) {

1047 cÚ¡ 
sizeL’gth
 = 
fOurSub£ssiÚ
.
	`©ŒV®_unsigÃd
("sizelength");

1048 cÚ¡ 
šdexL’gth
 = 
fOurSub£ssiÚ
.
	`©ŒV®_unsigÃd
("indexlength");

1049 ià(
sizeL’gth
 + 
šdexL’gth
 != 16) {

1050 
	`’vœ
(è<< "W¬nšg: uÃx³ùed 'sizeL’gth' " << 
sizeL’gth


1051 << "‡nd 'šdexL’gth' " << 
šdexL’gth


1054 
fP»vF¿meS‹
.
numS³cŸlH—d”s
 = 1;

1055 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹sL’gth
 = 4;

1056 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹s
[0] = 0;

1057 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹s
[1] = 16;

1058 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹s
[2] = ((
äameSize
<<
šdexL’gth
)&0xFF00)>>8;

1059 
fP»vF¿meS‹
.
¥ecŸlH—d”By‹s
[3] = (
äameSize
<<
šdexL’gth
);

1060 
fP»vF¿meS‹
.
·ck‘Sizes
[0]

1061 ğ
fP»vF¿meS‹
.
¥ecŸlH—d”By‹sL’gth
 + 
äameSize
;

1063 
	}
}

1065 
	gSub£ssiÚIOS‹
::
	$u£F¿me1
(
sourûD©aSize
,

1066 
timev®
 
´e£Á©iÚTime
,

1067 
äameDu¿tiÚ
,

1068 
št64_t
 
de¡FeOff£t
) {

1070 
äameSize
 = 
fQTBy‹sP”F¿me
;

1071 ià(
äameSize
 == 0) {

1073 
äameSize
 = 
sourûD©aSize
;

1075 cÚ¡ 
numF¿mes
 = 
sourûD©aSize
/
äameSize
;

1076 cÚ¡ 
numSam¶es
 = 
numF¿mes
*
fQTSam¶esP”F¿me
;

1079 
ChunkDesütÜ
* 
ÃwTaChunk
;

1080 ià(
fTaChunk
 =ğ
NULL
) {

1081 
ÃwTaChunk
 = 
fH—dChunk


1082 ğ
Ãw
 
	`ChunkDesütÜ
(
de¡FeOff£t
, 
sourûD©aSize
,

1083 
äameSize
, 
äameDu¿tiÚ
, 
´e£Á©iÚTime
);

1085 
ÃwTaChunk
 = 
fTaChunk
->
	`ex‹ndChunk
(
de¡FeOff£t
, 
sourûD©aSize
,

1086 
äameSize
, 
äameDu¿tiÚ
,

1087 
´e£Á©iÚTime
);

1089 ià(
ÃwTaChunk
 !ğ
fTaChunk
) {

1091 ++
fNumChunks
;

1092 
fTaChunk
 = 
ÃwTaChunk
;

1095  
numSam¶es
;

1096 
	}
}

1098 
	gSub£ssiÚIOS‹
::
	$ÚSourûClosu»
() {

1099 
fOurSourûIsAùive
 = 
F®£
;

1100 
fOurSšk
.
	`ÚSourûClosu»1
();

1101 
	}
}

1103 
BoŞ—n
 
	gSub£ssiÚIOS‹
::
	$syncOK
(
timev®
 
´e£Á©iÚTime
) {

1104 
QuickTimeFeSšk
& 
s
 = 
fOurSšk
;

1105 ià(!
s
.
fSyncSŒ—ms
è 
True
;

1107 ià(
s
.
fNumSynûdSub£ssiÚs
 < s.
fNumSub£ssiÚs
) {

1110 ià(!
fHaveB“nSynûd
) {

1112 ià(
fOurSub£ssiÚ
.
	`¹pSourû
()->
	`hasB“nSynchrÚizedUsšgRTCP
()) {

1114 ià(
fQTMedŸD©aAtomC»©Ü
 =ğ&
QuickTimeFeSšk
::
addAtom_avc1
) {

1116 ià((
s
.
fNumSub£ssiÚs
 =ğ2è&& (s.
fNumSynûdSub£ssiÚs
 < (s.fNumSub£ssiÚ - 1))è 
F®£
;

1119 * cÚ¡ 
äameSourû
 = 
fBufãr
->
	`d©aS¹
();

1120 ià(*
äameSourû
 !ğ
H264_IDR_FRAME
è 
F®£
;

1123 
fHaveB“nSynûd
 = 
True
;

1124 
fSyncTime
 = 
´e£Á©iÚTime
;

1125 ++
s
.
fNumSynûdSub£ssiÚs
;

1127 ià(
	`timev®GE
(
fSyncTime
, 
s
.
fNewe¡SyncTime
)) {

1128 
s
.
fNewe¡SyncTime
 = 
fSyncTime
;

1135 ià(
s
.
fNumSynûdSub£ssiÚs
 < s.
fNumSub£ssiÚs
è 
F®£
;

1138  
	`timev®GE
(
´e£Á©iÚTime
, 
s
.
fNewe¡SyncTime
);

1139 
	}
}

1141 
	gSub£ssiÚIOS‹
::
	$£tHštT¿ck
(
Sub£ssiÚIOS‹
* 
hš‹dT¿ck
,

1142 
Sub£ssiÚIOS‹
* 
hštT¿ck
) {

1143 ià(
hš‹dT¿ck
 !ğ
NULL
èhš‹dT¿ck->
fHštT¿ckFÜUs
 = 
hštT¿ck
;

1144 ià(
hštT¿ck
 !ğ
NULL
èhštT¿ck->
fT¿ckHš‹dByUs
 = 
hš‹dT¿ck
;

1145 
	}
}

1147 
	gSyncF¿me
::
	$SyncF¿me
(
äameNum
)

1148 : 
	`ÃxtSyncF¿me
(
NULL
), 
	$sfF¿meNum
(
äameNum
) {

1149 
	}
}

1151 
	gCouÁ64
::
İ”©Ü
+=(
¬g
) {

1152 
ÃwLo
 = 
lo
 + 
¬g
;

1153 ià(
	gÃwLo
 < 
	glo
) {

1154 ++
	ghi
;

1156 
	glo
 = 
ÃwLo
;

1159 
	gChunkDesütÜ


1160 ::
	$ChunkDesütÜ
(
št64_t
 
off£tInFe
, 
size
,

1161 
äameSize
, 
äameDu¿tiÚ
,

1162 
timev®
 
´e£Á©iÚTime
)

1163 : 
	`fNextChunk
(
NULL
), 
	`fOff£tInFe
(
off£tInFe
),

1164 
	`fNumF¿mes
(
size
/
äameSize
),

1165 
	`fF¿meSize
(
äameSize
), 
	`fF¿meDu¿tiÚ
(
äameDu¿tiÚ
),

1166 
	$fP»£Á©iÚTime
(
´e£Á©iÚTime
) {

1167 
	}
}

1169 
ChunkDesütÜ
* 
	gChunkDesütÜ


1170 ::
	$ex‹ndChunk
(
št64_t
 
ÃwOff£tInFe
, 
ÃwSize
,

1171 
ÃwF¿meSize
, 
ÃwF¿meDu¿tiÚ
,

1172 
timev®
 
ÃwP»£Á©iÚTime
) {

1175 ià(
ÃwOff£tInFe
 =ğ
fOff£tInFe
 + 
fNumF¿mes
*
fF¿meSize
) {

1178 ià(
ÃwF¿meSize
 =ğ
fF¿meSize
 && 
ÃwF¿meDu¿tiÚ
 =ğ
fF¿meDu¿tiÚ
) {

1179 
fNumF¿mes
 +ğ
ÃwSize
/
fF¿meSize
;

1180  
this
;

1185 
ChunkDesütÜ
* 
ÃwDesütÜ


1186 ğ
Ãw
 
	`ChunkDesütÜ
(
ÃwOff£tInFe
, 
ÃwSize
,

1187 
ÃwF¿meSize
, 
ÃwF¿meDu¿tiÚ
,

1188 
ÃwP»£Á©iÚTime
);

1190 
fNextChunk
 = 
ÃwDesütÜ
;

1192  
ÃwDesütÜ
;

1193 
	}
}

1198 
	gQuickTimeFeSšk
::
	$addWÜd64
(
u_št64_t
 
wÜd
) {

1199 
	`addBy‹
(()(
wÜd
>>56));‡ddByte(()(word>>48));

1200 
	`addBy‹
(()(
wÜd
>>40));‡ddByte(()(word>>32));

1201 
	`addBy‹
(()(
wÜd
>>24));‡ddByte(()(word>>16));

1202 
	`addBy‹
(()(
wÜd
>>8));‡ddByte(()(word));

1205 
	}
}

1207 
	gQuickTimeFeSšk
::
	$addWÜd
(
wÜd
) {

1208 
	`addBy‹
(
wÜd
>>24);‡ddByte(word>>16);

1209 
	`addBy‹
(
wÜd
>>8);‡ddByte(word);

1212 
	}
}

1214 
	gQuickTimeFeSšk
::
	$addH®fWÜd
(
h®fWÜd
) {

1215 
	`addBy‹
(()(
h®fWÜd
>>8));‡ddByte(()halfWord);

1218 
	}
}

1220 
	gQuickTimeFeSšk
::
	$addZ”oWÜds
(
numWÜds
) {

1221 
i
 = 0; i < 
numWÜds
; ++i) {

1222 
	`addWÜd
(0);

1225  
numWÜds
*4;

1226 
	}
}

1228 
	gQuickTimeFeSšk
::
	$add4By‹SŒšg
(cÚ¡* 
¡r
) {

1229 
	`addBy‹
(
¡r
[0]);‡ddByte(str[1]);‡ddByte(str[2]);‡ddByte(str[3]);

1232 
	}
}

1234 
	gQuickTimeFeSšk
::
	$addArb™¿rySŒšg
(cÚ¡* 
¡r
,

1235 
BoŞ—n
 
ÚeBy‹L’gth
) {

1236 
size
 = 0;

1237 ià(
ÚeBy‹L’gth
) {

1239 
¡rL’gth
 = 
	`¡¾’
(
¡r
);

1240 ià(
¡rL’gth
 >= 256) {

1241 
	`’vœ
() << "QuickTimeFileSink::addArbitraryString(\""

1242 << 
¡r
 << "\") saw string†ongerhan we know howo handle ("

1243 << 
¡rL’gth
 << "\n";

1245 
size
 +ğ
	`addBy‹
(()
¡rL’gth
);

1248 *
¡r
 != '\0') {

1249 
size
 +ğ
	`addBy‹
(*
¡r
++);

1252  
size
;

1253 
	}
}

1255 
	gQuickTimeFeSšk
::
	$addAtomH—d”
(cÚ¡* 
©omName
) {

1257 
	`addWÜd
(0);

1260 
	`add4By‹SŒšg
(
©omName
);

1263 
	}
}

1265 
	gQuickTimeFeSšk
::
	$addAtomH—d”64
(cÚ¡* 
©omName
) {

1267 
	`addWÜd
(1);

1270 
	`add4By‹SŒšg
(
©omName
);

1272 
	`addWÜd64
(0);

1275 
	}
}

1277 
	gQuickTimeFeSšk
::
	$£tWÜd
(
št64_t
 
fePo¢
, 
size
) {

1279 ià(
	`S“kFe64
(
fOutFid
, 
fePo¢
, 
SEEK_SET
) < 0) ;

1280 
	`addWÜd
(
size
);

1281 ià(
	`S“kFe64
(
fOutFid
, 0, 
SEEK_END
) < 0) ;

1287 
	`’vœ
() << "QuickTimeFileSink::setWord(): SeekFile64 failed (err "

1288 << 
	`’vœ
().
	`g‘E¼no
() << ")\n";

1289 
	}
}

1291 
	gQuickTimeFeSšk
::
	$£tWÜd64
(
št64_t
 
fePo¢
, 
u_št64_t
 
size
) {

1293 ià(
	`S“kFe64
(
fOutFid
, 
fePo¢
, 
SEEK_SET
) < 0) ;

1294 
	`addWÜd64
(
size
);

1295 ià(
	`S“kFe64
(
fOutFid
, 0, 
SEEK_END
) < 0) ;

1301 
	`’vœ
() << "QuickTimeFileSink::setWord64(): SeekFile64 failed (err "

1302 << 
	`’vœ
().
	`g‘E¼no
() << ")\n";

1303 
	}
}

1307 
	#addAtom
(
Çme
) \

1308 
QuickTimeFeSšk
::
addAtom_
##
	`Çme
() { \

1309 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
); \

1310 
size
 = 
	`addAtomH—d”
("" #Çm"")

	)

1312 
	#addAtomEnd
 \

1313 
	`£tWÜd
(
š™FePo¢
, 
size
); \

1314  
size
; \

1315 }

	)

1317 
addAtom
(
áyp
);

1318 
	gsize
 +ğ
add4By‹SŒšg
("mp42");

1319 
	gsize
 +ğ
addWÜd
(0x00000000);

1320 
	gsize
 +ğ
add4By‹SŒšg
("mp42");

1321 
	gsize
 +ğ
add4By‹SŒšg
("isom");

1322 
	gaddAtomEnd
;

1324 
addAtom
(
moov
);

1325 
	gsize
 +ğ
addAtom_mvhd
();

1327 ià(
	gfG’”©eMP4FÜm©
) {

1328 
	gsize
 +ğ
addAtom_iods
();

1335 
MedŸSub£ssiÚI‹¿tÜ
 
™”
(
fIÅutSessiÚ
);

1336 
MedŸSub£ssiÚ
* 
	gsub£ssiÚ
;

1337 (
	gsub£ssiÚ
 = 
™”
.
Ãxt
()è!ğ
NULL
) {

1338 
fCu¼’tIOS‹
 = (
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

1339 ià(
	gfCu¼’tIOS‹
 =ğ
NULL
) ;

1340 ià(
¡rcmp
(
sub£ssiÚ
->
mediumName
(), "audio") != 0) ;

1342 
	gsize
 +ğ
addAtom_Œak
();

1344 ià(
	gfCu¼’tIOS‹
->
hasHštT¿ck
()) {

1346 
	gfCu¼’tIOS‹
 = 
fCu¼’tIOS‹
->
fHštT¿ckFÜUs
;

1347 
	gsize
 +ğ
addAtom_Œak
();

1350 
	g™”
.
»£t
();

1351 (
	gsub£ssiÚ
 = 
™”
.
Ãxt
()è!ğ
NULL
) {

1352 
fCu¼’tIOS‹
 = (
Sub£ssiÚIOS‹
*)(
sub£ssiÚ
->
miscPŒ
);

1353 ià(
	gfCu¼’tIOS‹
 =ğ
NULL
) ;

1354 ià(
¡rcmp
(
sub£ssiÚ
->
mediumName
(), "audio") == 0) ;

1356 
	gsize
 +ğ
addAtom_Œak
();

1358 ià(
	gfCu¼’tIOS‹
->
hasHštT¿ck
()) {

1360 
	gfCu¼’tIOS‹
 = 
fCu¼’tIOS‹
->
fHštT¿ckFÜUs
;

1361 
	gsize
 +ğ
addAtom_Œak
();

1364 
	gaddAtomEnd
;

1366 
addAtom
(
mvhd
);

1367 
	gsize
 +ğ
addWÜd
(0x00000000);

1368 
	gsize
 +ğ
addWÜd
(
fAµËC»©iÚTime
);

1369 
	gsize
 +ğ
addWÜd
(
fAµËC»©iÚTime
);

1373 
	gsize
 +ğ
addWÜd
(
mov›TimeSÿË
());

1375 cÚ¡ 
	gdu¿tiÚ
 = 
fMaxT¿ckDu¿tiÚM
;

1376 
	gfMVHD_du¿tiÚPo¢
 = 
T–lFe64
(
fOutFid
);

1377 
	gsize
 +ğ
addWÜd
(
du¿tiÚ
);

1379 
	gsize
 +ğ
addWÜd
(0x00010000);

1380 
	gsize
 +ğ
addWÜd
(0x01000000);

1381 
	gsize
 +ğ
addZ”oWÜds
(2);

1382 
	gsize
 +ğ
addWÜd
(0x00010000);

1383 
	gsize
 +ğ
addZ”oWÜds
(3);

1384 
	gsize
 +ğ
addWÜd
(0x00010000);

1385 
	gsize
 +ğ
addZ”oWÜds
(3);

1386 
	gsize
 +ğ
addWÜd
(0x40000000);

1387 
	gsize
 +ğ
addZ”oWÜds
(6);

1388 
	gsize
 +ğ
addWÜd
(
Sub£ssiÚIOS‹
::
fCu¼’tT¿ckNumb”
+1);

1389 
	gaddAtomEnd
;

1391 
addAtom
(
iods
);

1392 
	gsize
 +ğ
addWÜd
(0x00000000);

1393 
	gsize
 +ğ
addWÜd
(0x10808080);

1394 
	gsize
 +ğ
addWÜd
(0x07004FFF);

1395 
	gsize
 +ğ
addWÜd
(0xFF0FFFFF);

1396 
	gaddAtomEnd
;

1398 
addAtom
(
Œak
);

1399 
	gsize
 +ğ
addAtom_tkhd
();

1403 ià(
	gfCu¼’tIOS‹
->
	gfH—dChunk
 !ğ
NULL


1404 && (
fSyncSŒ—ms
 || 
fCu¼’tIOS‹
->
	$isHštT¿ck
())) {

1405 
size
 +ğ
	`addAtom_edts
();

1406 
	}
}

1409 ià(
	gfCu¼’tIOS‹
->
	$isHštT¿ck
()è
size
 +ğ
	`addAtom_Œef
();

1411 
size
 +ğ
	`addAtom_mdŸ
();

1414 ià(
fCu¼’tIOS‹
->
	$isHštT¿ck
()è
size
 +ğ
	`addAtom_ud
();

1415 
addAtomEnd
;

1417 
	`addAtom
(
tkhd
);

1418 ià(
fCu¼’tIOS‹
->
fQTEÇbËT¿ck
) {

1419 
size
 +ğ
	`addWÜd
(0x0000000F);

1420 
	}
} {

1422 
	gsize
 +ğ
addWÜd
(0x00000000);

1424 
	gsize
 +ğ
addWÜd
(
fAµËC»©iÚTime
);

1425 
	gsize
 +ğ
addWÜd
(
fAµËC»©iÚTime
);

1426 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fT¿ckID
);

1427 
	gsize
 +ğ
addWÜd
(0x00000000);

1429 cÚ¡ 
	gdu¿tiÚ
 = 
fCu¼’tIOS‹
->
fQTDu¿tiÚM
;

1430 
	gfCu¼’tIOS‹
->
	gfTKHD_du¿tiÚPo¢
 = 
T–lFe64
(
fOutFid
);

1431 
	gsize
 +ğ
addWÜd
(
du¿tiÚ
);

1432 
	gsize
 +ğ
addZ”oWÜds
(3);

1433 
	gsize
 +ğ
addWÜd
(0x01000000);

1434 
	gsize
 +ğ
addWÜd
(0x00010000);

1435 
	gsize
 +ğ
addZ”oWÜds
(3);

1436 
	gsize
 +ğ
addWÜd
(0x00010000);

1437 
	gsize
 +ğ
addZ”oWÜds
(3);

1438 
	gsize
 +ğ
addWÜd
(0x40000000);

1439 ià(
¡rcmp
(
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
mediumName
(), "video") == 0) {

1440 
size
 +ğ
addWÜd
(
fMov›Width
<<16);

1441 
	gsize
 +ğ
addWÜd
(
fMov›Height
<<16);

1443 
	gsize
 +ğ
addZ”oWÜds
(2);

1445 
	gaddAtomEnd
;

1447 
addAtom
(
edts
);

1448 
	gsize
 +ğ
addAtom_–¡
();

1449 
	gaddAtomEnd
;

1451 
	#addEd™1
(
du¿tiÚ
,
ŒackPos™iÚ
) do { \

1452 
ŒackDu¿tiÚ
 \

1453 ğ(è((2*(
du¿tiÚ
)*
	`mov›TimeSÿË
()+1)/2); \

1455 
size
 +ğ
	`addWÜd
(
ŒackDu¿tiÚ
); \

1456 
tÙ®Du¿tiÚOfEd™s
 +ğ
ŒackDu¿tiÚ
; \

1457 
size
 +ğ
	`addWÜd
(
ŒackPos™iÚ
); \

1458 
size
 +ğ
	`addWÜd
(0x00010000); \

1459 ++
numEd™s
; \

1460 } 0)

	)

1461 
	#addEd™
(
du¿tiÚ
è
	`addEd™1
((du¿tiÚ),
ed™T¿ckPos™iÚ
)

	)

1462 
	#addEm±yEd™
(
du¿tiÚ
è
	`addEd™1
((du¿tiÚ),(~0))

	)

1464 
addAtom
(
–¡
);

1465 
	gsize
 +ğ
addWÜd
(0x00000000);

1469 
št64_t
 
	gnumEÁr›sPos™iÚ
 = 
T–lFe64
(
fOutFid
);

1470 
	gsize
 +ğ
addWÜd
(0);

1471 
	gnumEd™s
 = 0;

1472 
	gtÙ®Du¿tiÚOfEd™s
 = 0;

1478 cÚ¡ 
	gsyncTh»shŞd
 = 0.1;

1481 
timev®
 
	ged™S¹Time
 = 
fFœ¡D©aTime
;

1482 
	ged™T¿ckPos™iÚ
 = 0;

1483 
	gcu¼’tT¿ckPos™iÚ
 = 0;

1484 
	gŒackDu¿tiÚOfEd™
 = 0.0;

1485 
	gchunkDu¿tiÚ
 = 0;

1487 
ChunkDesütÜ
* 
	gchunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

1488 
	gchunk
 !ğ
NULL
) {

1489 
timev®
 cÚ¡& 
chunkS¹Time
 = 
chunk
->
fP»£Á©iÚTime
;

1490 
	gmov›Du¿tiÚOfEd™


1491 ğ(
chunkS¹Time
.
tv_£c
 - 
ed™S¹Time
.tv_sec)

1492 + (
chunkS¹Time
.
tv_u£c
 - 
ed™S¹Time
.tv_usec)/1000000.0;

1493 
	gŒackDu¿tiÚOfEd™
 = (
cu¼’tT¿ckPos™iÚ
-
ed™T¿ckPos™iÚ
)

1494 / ()(
fCu¼’tIOS‹
->
fQTTimeSÿË
);

1496 
	goutOfSync
 = 
mov›Du¿tiÚOfEd™
 - 
ŒackDu¿tiÚOfEd™
;

1498 ià(
	goutOfSync
 > 
	gsyncTh»shŞd
) {

1502 ià(
	gŒackDu¿tiÚOfEd™
 > 0.0è
addEd™
(
ŒackDu¿tiÚOfEd™
);

1503 
addEm±yEd™
(
outOfSync
);

1505 
	ged™S¹Time
 = 
chunkS¹Time
;

1506 
	ged™T¿ckPos™iÚ
 = 
cu¼’tT¿ckPos™iÚ
;

1507 } ià(
	goutOfSync
 < -
	gsyncTh»shŞd
) {

1510 ià(
	gmov›Du¿tiÚOfEd™
 > 0.0è
addEd™
(
mov›Du¿tiÚOfEd™
);

1512 
	ged™S¹Time
 = 
chunkS¹Time
;

1513 
	ged™T¿ckPos™iÚ
 = 
cu¼’tT¿ckPos™iÚ
;

1517 
	gnumChªÃls
 = 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
numChªÃls
();

1518 
	gchunkDu¿tiÚ
 = 
chunk
->
fNumF¿mes
*chunk->
fF¿meDu¿tiÚ
/
numChªÃls
;

1519 
	gcu¼’tT¿ckPos™iÚ
 +ğ
chunkDu¿tiÚ
;

1521 
	gchunk
 = 
chunk
->
fNextChunk
;

1525 
	gŒackDu¿tiÚOfEd™


1526 +ğ()
chunkDu¿tiÚ
/
fCu¼’tIOS‹
->
fQTTimeSÿË
;

1527 ià(
	gŒackDu¿tiÚOfEd™
 > 0.0è
addEd™
(
ŒackDu¿tiÚOfEd™
);

1530 
£tWÜd
(
numEÁr›sPos™iÚ
, 
numEd™s
);

1535 ià(
	gtÙ®Du¿tiÚOfEd™s
 > 
	gfCu¼’tIOS‹
->
	gfQTDu¿tiÚM
) {

1536 
	gfCu¼’tIOS‹
->
	gfQTDu¿tiÚM
 = 
tÙ®Du¿tiÚOfEd™s
;

1537 
£tWÜd
(
fCu¼’tIOS‹
->
fTKHD_du¿tiÚPo¢
, 
tÙ®Du¿tiÚOfEd™s
);

1540 ià(
	gtÙ®Du¿tiÚOfEd™s
 > 
	gfMaxT¿ckDu¿tiÚM
) {

1541 
	gfMaxT¿ckDu¿tiÚM
 = 
tÙ®Du¿tiÚOfEd™s
;

1542 
£tWÜd
(
fMVHD_du¿tiÚPo¢
, 
tÙ®Du¿tiÚOfEd™s
);

1546 
	gsÿËFaùÜ


1547 ğ
fCu¼’tIOS‹
->
fQTTimeSÿË
/()
mov›TimeSÿË
();

1548 
	gfCu¼’tIOS‹
->
	gfQTDu¿tiÚT


1549 ğ()(
tÙ®Du¿tiÚOfEd™s
*
sÿËFaùÜ
);

1551 
	gaddAtomEnd
;

1553 
addAtom
(
Œef
);

1554 
	gsize
 +ğ
addAtom_hšt
();

1555 
	gaddAtomEnd
;

1557 
addAtom
(
hšt
);

1558 
Sub£ssiÚIOS‹
* 
	ghš‹dT¿ck
 = 
fCu¼’tIOS‹
->
fT¿ckHš‹dByUs
;

1560 
	gsize
 +ğ
addWÜd
(
hš‹dT¿ck
->
fT¿ckID
);

1561 
	gaddAtomEnd
;

1563 
addAtom
(
mdŸ
);

1564 
	gsize
 +ğ
addAtom_mdhd
();

1565 
	gsize
 +ğ
addAtom_hdÌ
();

1566 
	gsize
 +ğ
addAtom_mšf
();

1567 
	gaddAtomEnd
;

1569 
addAtom
(
mdhd
);

1570 
	gsize
 +ğ
addWÜd
(0x00000000);

1571 
	gsize
 +ğ
addWÜd
(
fAµËC»©iÚTime
);

1572 
	gsize
 +ğ
addWÜd
(
fAµËC»©iÚTime
);

1574 cÚ¡ 
	gtimeSÿË
 = 
fCu¼’tIOS‹
->
fQTTimeSÿË
;

1575 
	gsize
 +ğ
addWÜd
(
timeSÿË
);

1577 cÚ¡ 
	gdu¿tiÚ
 = 
fCu¼’tIOS‹
->
fQTDu¿tiÚT
;

1578 
	gsize
 +ğ
addWÜd
(
du¿tiÚ
);

1580 
	gsize
 +ğ
addWÜd
(0x00000000);

1581 
	gaddAtomEnd
;

1583 
addAtom
(
hdÌ
);

1584 
	gsize
 +ğ
addWÜd
(0x00000000);

1585 
	gsize
 +ğ
add4By‹SŒšg
("mhlr");

1586 
	gsize
 +ğ
addWÜd
(
fCu¼’tIOS‹
->
fQTcompÚ’tSubty³
);

1588 
	gsize
 +ğ
add4By‹SŒšg
("appl");

1589 
	gsize
 +ğ
addWÜd
(0x00000000);

1590 
	gsize
 +ğ
addWÜd
(0x00000000);

1591 
	gsize
 +ğ
addArb™¿rySŒšg
(
fCu¼’tIOS‹
->
fQTcompÚ’tName
);

1593 
	gaddAtomEnd
;

1595 
addAtom
(
mšf
);

1596 
	gSub£ssiÚIOS‹
::
©omC»©iÚFunc
 
medŸInfÜm©iÚAtomC»©Ü


1597 ğ
fCu¼’tIOS‹
->
fQTMedŸInfÜm©iÚAtomC»©Ü
;

1598 
	gsize
 +ğ(
this
->*
medŸInfÜm©iÚAtomC»©Ü
)();

1599 
	gsize
 +ğ
addAtom_hdÌ2
();

1600 
	gsize
 +ğ
addAtom_dšf
();

1601 
	gsize
 +ğ
addAtom_¡bl
();

1602 
	gaddAtomEnd
;

1604 
addAtom
(
smhd
);

1605 
	gsize
 +ğ
addZ”oWÜds
(2);

1606 
	gaddAtomEnd
;

1608 
addAtom
(
vmhd
);

1609 
	gsize
 +ğ
addWÜd
(0x00000001);

1610 
	gsize
 +ğ
addWÜd
(0x00408000);

1611 
	gsize
 +ğ
addWÜd
(0x80008000);

1612 
	gaddAtomEnd
;

1614 
addAtom
(
gmhd
);

1615 
	gsize
 +ğ
addAtom_gmš
();

1616 
	gaddAtomEnd
;

1618 
addAtom
(
gmš
);

1619 
	gsize
 +ğ
addWÜd
(0x00000000);

1622 
	gsize
 +ğ
addWÜd
(0x00408000);

1623 
	gsize
 +ğ
addWÜd
(0x80008000);

1624 
	gsize
 +ğ
addWÜd
(0x00000000);

1625 
	gaddAtomEnd
;

1627 
	gQuickTimeFeSšk
::
	$addAtom_hdÌ2
() {

1628 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

1629 
size
 = 
	`addAtomH—d”
("hdlr");

1630 
size
 +ğ
	`addWÜd
(0x00000000);

1631 
size
 +ğ
	`add4By‹SŒšg
("dhlr");

1632 
size
 +ğ
	`add4By‹SŒšg
("alis");

1633 
size
 +ğ
	`add4By‹SŒšg
("appl");

1634 
size
 +ğ
	`addZ”oWÜds
(2);

1635 
size
 +ğ
	`addArb™¿rySŒšg
("Apple Alias Data Handler");

1636 
addAtomEnd
;

1638 
	`addAtom
(
dšf
);

1639 
size
 +ğ
	`addAtom_d»f
();

1640 
addAtomEnd
;

1642 
	`addAtom
(
d»f
);

1643 
size
 +ğ
	`addWÜd
(0x00000000);

1644 
size
 +ğ
	`addWÜd
(0x00000001);

1645 
size
 +ğ
	`addAtom_®is
();

1646 
addAtomEnd
;

1648 
	`addAtom
(
®is
);

1649 
size
 +ğ
	`addWÜd
(0x00000001);

1650 
addAtomEnd
;

1652 
	`addAtom
(
¡bl
);

1653 
size
 +ğ
	`addAtom_¡sd
();

1654 
size
 +ğ
	`addAtom_¡ts
();

1655 ià(
fCu¼’tIOS‹
->
fQTcompÚ’tSubty³
 =ğ
	`fourCh¬
('v','i','d','e')) {

1656 
size
 +ğ
	`addAtom_¡ss
();

1658 
size
 +ğ
	`addAtom_¡sc
();

1659 
size
 +ğ
	`addAtom_¡sz
();

1660 
size
 +ğ
	`addAtom_co64
();

1661 
addAtomEnd
;

1663 
	`addAtom
(
¡sd
);

1664 
size
 +ğ
	`addWÜd
(0x00000000);

1665 
size
 +ğ
	`addWÜd
(0x00000001);

1666 
Sub£ssiÚIOS‹
::
©omC»©iÚFunc
 
medŸD©aAtomC»©Ü


1667 ğ
fCu¼’tIOS‹
->
fQTMedŸD©aAtomC»©Ü
;

1668 
size
 +ğ(
this
->*
medŸD©aAtomC»©Ü
)();

1669 
addAtomEnd
;

1671 
QuickTimeFeSšk
::
	`addAtom_g’”icMedŸ
() {

1672 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

1676 
QuickTimeG’”icRTPSourû
* 
¹pSourû
 = (QuickTimeGenericRTPSource*)

1677 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
	`¹pSourû
();

1678 
QuickTimeG’”icRTPSourû
::
QTS‹
& 
qtS‹
 = 
¹pSourû
->qtState;

1679 cÚ¡* 
äom
 = 
qtS‹
.
sdAtom
;

1680 
size
 = 
qtS‹
.
sdAtomSize
;

1681 
i
 = 0; i < 
size
; ++iè
	`addBy‹
(
äom
[i]);

1682 
addAtomEnd
;

1684 
QuickTimeFeSšk
::
	`addAtom_soundMedŸG’”®
() {

1685 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

1686 
size
 = 
	`addAtomH—d”
(
fCu¼’tIOS‹
->
fQTAudioD©aTy³
);

1689 
size
 +ğ
	`addWÜd
(0x00000000);

1690 
size
 +ğ
	`addWÜd
(0x00000001);

1692 cÚ¡ 
v”siÚ
 = 
fCu¼’tIOS‹
->
fQTSoundSam¶eV”siÚ
;

1693 
size
 +ğ
	`addWÜd
(
v”siÚ
<<16);

1694 
size
 +ğ
	`addWÜd
(0x00000000);

1695 
numChªÃls


1696 ğ()(
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
	`numChªÃls
());

1697 
size
 +ğ
	`addH®fWÜd
(
numChªÃls
);

1698 
size
 +ğ
	`addH®fWÜd
(0x0010);

1700 
size
 +ğ
	`addWÜd
(0xfffe0000);

1702 cÚ¡ 
§m¶eR©eFixedPošt
 = 
fCu¼’tIOS‹
->
fQTTimeSÿË
 << 16;

1703 
size
 +ğ
	`addWÜd
(
§m¶eR©eFixedPošt
);

1704 
addAtomEnd
;

1706 
QuickTimeFeSšk
::
	`addAtom_Qşp
() {

1709 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

1710 
fCu¼’tIOS‹
->
fQTAudioD©aTy³
 = "Qclp";

1711 
fCu¼’tIOS‹
->
fQTSoundSam¶eV”siÚ
 = 1;

1712 
size
 = 
	`addAtom_soundMedŸG’”®
();

1716 
size
 +ğ
	`addWÜd
(0x000000a0);

1717 
size
 +ğ
	`addWÜd
(0x00000000);

1718 
size
 +ğ
	`addWÜd
(0x00000000);

1719 
size
 +ğ
	`addWÜd
(0x00000002);

1722 
size
 +ğ
	`addAtom_wave
();

1723 
addAtomEnd
;

1725 
	`addAtom
(
wave
);

1726 
size
 +ğ
	`addAtom_äma
();

1727 ià(
	`¡rcmp
(
fCu¼’tIOS‹
->
fQTAudioD©aTy³
, "Qclp") == 0) {

1728 
size
 +ğ
	`addWÜd
(0x00000014);

1729 
size
 +ğ
	`add4By‹SŒšg
("Qclp");

1730 ià(
fCu¼’tIOS‹
->
fQTBy‹sP”F¿me
 == 35) {

1731 
size
 +ğ
	`addAtom_Fşp
();

1733 
size
 +ğ
	`addAtom_Hşp
();

1735 
size
 +ğ
	`addWÜd
(0x00000008);

1736 
size
 +ğ
	`addWÜd
(0x00000000);

1737 
size
 +ğ
	`addWÜd
(0x00000000);

1738 
size
 +ğ
	`addWÜd
(0x00000008);

1739 } ià(
	`¡rcmp
(
fCu¼’tIOS‹
->
fQTAudioD©aTy³
, "mp4a") == 0) {

1740 
size
 +ğ
	`addWÜd
(0x0000000c);

1741 
size
 +ğ
	`add4By‹SŒšg
("mp4a");

1742 
size
 +ğ
	`addWÜd
(0x00000000);

1743 
size
 +ğ
	`addAtom_esds
();

1744 
size
 +ğ
	`addWÜd
(0x00000008);

1745 
size
 +ğ
	`addWÜd
(0x00000000);

1747 
addAtomEnd
;

1749 
	`addAtom
(
äma
);

1750 
size
 +ğ
	`add4By‹SŒšg
(
fCu¼’tIOS‹
->
fQTAudioD©aTy³
);

1751 
addAtomEnd
;

1753 
	`addAtom
(
Fşp
);

1754 
size
 +ğ
	`addWÜd
(0x00000000);

1755 
addAtomEnd
;

1757 
	`addAtom
(
Hşp
);

1758 
size
 +ğ
	`addWÜd
(0x00000000);

1759 
addAtomEnd
;

1761 
QuickTimeFeSšk
::
	`addAtom_mp4a
() {

1762 
size
 = 0;

1765 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

1766 
fCu¼’tIOS‹
->
fQTAudioD©aTy³
 = "mp4a";

1768 ià(
fG’”©eMP4FÜm©
) {

1769 
fCu¼’tIOS‹
->
fQTSoundSam¶eV”siÚ
 = 0;

1770 
size
 = 
	`addAtom_soundMedŸG’”®
();

1771 
size
 +ğ
	`addAtom_esds
();

1773 
fCu¼’tIOS‹
->
fQTSoundSam¶eV”siÚ
 = 1;

1774 
size
 = 
	`addAtom_soundMedŸG’”®
();

1778 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fQTTimeUn™sP”Sam¶e
);

1779 
size
 +ğ
	`addWÜd
(0x00000001);

1780 
size
 +ğ
	`addWÜd
(0x00000001);

1781 
size
 +ğ
	`addWÜd
(0x00000002);

1784 
size
 +ğ
	`addAtom_wave
();

1786 
addAtomEnd
;

1788 
	`addAtom
(
esds
);

1790 
MedŸSub£ssiÚ
& 
sub£ssiÚ
 = 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
;

1791 ià(
	`¡rcmp
(
sub£ssiÚ
.
	`mediumName
(), "audio") == 0) {

1793 
size
 +ğ
	`addWÜd
(0x00000000);

1794 
size
 +ğ
	`addWÜd
(0x03808080);

1795 
size
 +ğ
	`addWÜd
(0x2a000000);

1796 
size
 +ğ
	`addWÜd
(0x04808080);

1797 
size
 +ğ
	`addWÜd
(0x1c401500);

1798 
size
 +ğ
	`addWÜd
(0x18000000);

1799 
size
 +ğ
	`addWÜd
(0x6d600000);

1800 
size
 +ğ
	`addWÜd
(0x6d600580);

1801 
size
 +ğ
	`addBy‹
(0x80); size +=‡ddByte(0x80);

1802 } ià(
	`¡rcmp
(
sub£ssiÚ
.
	`mediumName
(), "video") == 0) {

1804 
size
 +ğ
	`addWÜd
(0x00000000);

1805 
size
 +ğ
	`addWÜd
(0x03330000);

1806 
size
 +ğ
	`addWÜd
(0x1f042b20);

1807 
size
 +ğ
	`addWÜd
(0x1104fd46);

1808 
size
 +ğ
	`addWÜd
(0x000d4e10);

1809 
size
 +ğ
	`addWÜd
(0x000d4e10);

1810 
size
 +ğ
	`addBy‹
(0x05);

1814 
cÚfigSize
;

1815 * 
cÚfig


1816 ğ
	`·r£G’”®CÚfigSŒ
(
sub£ssiÚ
.
	`fm_cÚfig
(), 
cÚfigSize
);

1817 
size
 +ğ
	`addBy‹
(
cÚfigSize
);

1818 
i
 = 0; i < 
cÚfigSize
; ++i) {

1819 
size
 +ğ
	`addBy‹
(
cÚfig
[
i
]);

1821 
d–‘e
[] 
cÚfig
;

1823 ià(
	`¡rcmp
(
sub£ssiÚ
.
	`mediumName
(), "audio") == 0) {

1825 
size
 +ğ
	`addWÜd
(0x06808080);

1826 
size
 +ğ
	`addH®fWÜd
(0x0102);

1829 
size
 +ğ
	`addH®fWÜd
(0x0601);

1830 
size
 +ğ
	`addBy‹
(0x02);

1833 
addAtomEnd
;

1835 
	`addAtom
(
¤cq
);

1837 
size
 +ğ
	`addWÜd
(0x00000040);

1839 
addAtomEnd
;

1841 
	`addAtom
(
h263
);

1843 
size
 +ğ
	`addWÜd
(0x00000000);

1844 
size
 +ğ
	`addWÜd
(0x00000001);

1846 
size
 +ğ
	`addWÜd
(0x00020001);

1847 
size
 +ğ
	`add4By‹SŒšg
("appl");

1848 
size
 +ğ
	`addWÜd
(0x00000000);

1849 
size
 +ğ
	`addWÜd
(0x000002fc);

1850 cÚ¡ 
widthAndHeight
 = (
fMov›Width
<<16)|
fMov›Height
;

1851 
size
 +ğ
	`addWÜd
(
widthAndHeight
);

1852 
size
 +ğ
	`addWÜd
(0x00480000);

1853 
size
 +ğ
	`addWÜd
(0x00480000);

1854 
size
 +ğ
	`addWÜd
(0x00000000);

1855 
size
 +ğ
	`addWÜd
(0x00010548);

1857 
size
 +ğ
	`addWÜd
(0x2e323633);

1858 
size
 +ğ
	`addZ”oWÜds
(6);

1859 
size
 +ğ
	`addWÜd
(0x00000018);

1860 
size
 +ğ
	`addH®fWÜd
(0xffff);

1861 
addAtomEnd
;

1863 
	`addAtom
(
avc1
);

1865 
size
 +ğ
	`addWÜd
(0x00000000);

1866 
size
 +ğ
	`addWÜd
(0x00000001);

1868 
size
 +ğ
	`addWÜd
(0x00000000);

1869 
size
 +ğ
	`add4By‹SŒšg
("appl");

1870 
size
 +ğ
	`addWÜd
(0x00000000);

1871 
size
 +ğ
	`addWÜd
(0x00000000);

1872 cÚ¡ 
widthAndHeight
 = (
fMov›Width
<<16)|
fMov›Height
;

1873 
size
 +ğ
	`addWÜd
(
widthAndHeight
);

1874 
size
 +ğ
	`addWÜd
(0x00480000);

1875 
size
 +ğ
	`addWÜd
(0x00480000);

1876 
size
 +ğ
	`addWÜd
(0x00000000);

1877 
size
 +ğ
	`addWÜd
(0x00010548);

1879 
size
 +ğ
	`addWÜd
(0x2e323634);

1880 
size
 +ğ
	`addZ”oWÜds
(6);

1881 
size
 +ğ
	`addWÜd
(0x00000018);

1882 
size
 +ğ
	`addH®fWÜd
(0xffff);

1883 
size
 +ğ
	`addAtom_avcC
();

1884 
addAtomEnd
;

1886 
	`addAtom
(
avcC
);

1888 * 
p£ts
 = 
	`¡rDup
(
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
	`fm_¥rİ·¿m‘”£ts
());

1889 ià(
p£ts
 =ğ
NULL
)  0;

1891 
size_t
 
comma_pos
 = 
	`¡rc¥n
(
p£ts
, ",");

1892 
p£ts
[
comma_pos
] = '\0';

1893 cÚ¡* 
¥s_b64
 = 
p£ts
;

1894 cÚ¡* 
µs_b64
 = &
p£ts
[
comma_pos
+1];

1895 
¥s_couÁ
;

1896 * 
¥s_d©a
 = 
	`ba£64Decode
(
¥s_b64
, 
¥s_couÁ
, 
çl£
);

1897 
µs_couÁ
;

1898 * 
µs_d©a
 = 
	`ba£64Decode
(
µs_b64
, 
µs_couÁ
, 
çl£
);

1901 
size
 +ğ
	`addBy‹
(0x01);

1902 
size
 +ğ
	`addBy‹
(
¥s_d©a
[1]);

1903 
size
 +ğ
	`addBy‹
(
¥s_d©a
[2]);

1904 
size
 +ğ
	`addBy‹
(
¥s_d©a
[3]);

1905 
size
 +ğ
	`addBy‹
(0xff);

1906 
size
 +ğ
	`addBy‹
(0xe0 | (
¥s_couÁ
 > 0 ? 1 : 0) );

1907 ià(
¥s_couÁ
 > 0) {

1908 
size
 +ğ
	`addH®fWÜd
(
¥s_couÁ
);

1909 
i
 = 0; i < 
¥s_couÁ
; i++) {

1910 
size
 +ğ
	`addBy‹
(
¥s_d©a
[
i
]);

1913 
size
 +ğ
	`addBy‹
(
µs_couÁ
 > 0 ? 1 : 0);

1914 ià(
µs_couÁ
 > 0) {

1915 
size
 +ğ
	`addH®fWÜd
(
µs_couÁ
);

1916 
i
 = 0; i < 
µs_couÁ
; i++) {

1917 
size
 +ğ
	`addBy‹
(
µs_d©a
[
i
]);

1922 
d–‘e
[] 
µs_d©a
; d–‘e[] 
¥s_d©a
;

1923 
d–‘e
[] 
p£ts
;

1924 
addAtomEnd
;

1926 
	`addAtom
(
mp4v
);

1928 
size
 +ğ
	`addWÜd
(0x00000000);

1929 
size
 +ğ
	`addWÜd
(0x00000001);

1931 
size
 +ğ
	`addWÜd
(0x00020001);

1932 
size
 +ğ
	`add4By‹SŒšg
("appl");

1933 
size
 +ğ
	`addWÜd
(0x00000200);

1934 
size
 +ğ
	`addWÜd
(0x00000400);

1935 cÚ¡ 
widthAndHeight
 = (
fMov›Width
<<16)|
fMov›Height
;

1936 
size
 +ğ
	`addWÜd
(
widthAndHeight
);

1937 
size
 +ğ
	`addWÜd
(0x00480000);

1938 
size
 +ğ
	`addWÜd
(0x00480000);

1939 
size
 +ğ
	`addWÜd
(0x00000000);

1940 
size
 +ğ
	`addWÜd
(0x00010c4d);

1942 
size
 +ğ
	`addWÜd
(0x5045472d);

1943 
size
 +ğ
	`addWÜd
(0x34205669);

1944 
size
 +ğ
	`addWÜd
(0x64656f00);

1945 
size
 +ğ
	`addZ”oWÜds
(4);

1946 
size
 +ğ
	`addWÜd
(0x00000018);

1947 
size
 +ğ
	`addH®fWÜd
(0xffff);

1948 
size
 +ğ
	`addAtom_esds
();

1949 
size
 +ğ
	`addWÜd
(0x00000000);

1950 
addAtomEnd
;

1952 
QuickTimeFeSšk
::
	`addAtom_¹p
() {

1953 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

1954 
size
 = 
	`addAtomH—d”
("rtp ");

1956 
size
 +ğ
	`addWÜd
(0x00000000);

1957 
size
 +ğ
	`addWÜd
(0x00000001);

1958 
size
 +ğ
	`addWÜd
(0x00010001);

1959 
size
 +ğ
	`addWÜd
(1450);

1961 
size
 +ğ
	`addAtom_tims
();

1962 
addAtomEnd
;

1964 
	`addAtom
(
tims
);

1965 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
	`¹pTime¡ampF»qu’cy
());

1966 
addAtomEnd
;

1968 
	`addAtom
(
¡ts
);

1969 
size
 +ğ
	`addWÜd
(0x00000000);

1973 
št64_t
 
numEÁr›sPos™iÚ
 = 
	`T–lFe64
(
fOutFid
);

1974 
size
 +ğ
	`addWÜd
(0);

1978 
numEÁr›s
 = 0, 
numSam¶esSoF¬
 = 0;

1979 
´evSam¶eDu¿tiÚ
 = 0;

1980 cÚ¡ 
§m¶esP”F¿me
 = 
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
;

1981 
ChunkDesütÜ
* 
chunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

1982 
chunk
 !ğ
NULL
) {

1983 cÚ¡ 
§m¶eDu¿tiÚ
 = 
chunk
->
fF¿meDu¿tiÚ
/
§m¶esP”F¿me
;

1984 ià(
§m¶eDu¿tiÚ
 !ğ
´evSam¶eDu¿tiÚ
) {

1987 ià(
chunk
 !ğ
fCu¼’tIOS‹
->
fH—dChunk
) {

1988 ++
numEÁr›s
;

1989 
size
 +ğ
	`addWÜd
(
numSam¶esSoF¬
);

1990 
size
 +ğ
	`addWÜd
(
´evSam¶eDu¿tiÚ
);

1991 
numSam¶esSoF¬
 = 0;

1995 cÚ¡ 
numSam¶es
 = 
chunk
->
fNumF¿mes
*
§m¶esP”F¿me
;

1996 
numSam¶esSoF¬
 +ğ
numSam¶es
;

1997 
´evSam¶eDu¿tiÚ
 = 
§m¶eDu¿tiÚ
;

1998 
chunk
 = chunk->
fNextChunk
;

2002 ++
numEÁr›s
;

2003 
size
 +ğ
	`addWÜd
(
numSam¶esSoF¬
);

2004 
size
 +ğ
	`addWÜd
(
´evSam¶eDu¿tiÚ
);

2007 
	`£tWÜd
(
numEÁr›sPos™iÚ
, 
numEÁr›s
);

2008 
addAtomEnd
;

2010 
	`addAtom
(
¡ss
);

2011 
size
 +ğ
	`addWÜd
(0x00000000);

2015 
št64_t
 
numEÁr›sPos™iÚ
 = 
	`T–lFe64
(
fOutFid
);

2016 
size
 +ğ
	`addWÜd
(0);

2018 
numEÁr›s
 = 0, 
numSam¶esSoF¬
 = 0;

2019 ià(
fCu¼’tIOS‹
->
fH—dSyncF¿me
 !ğ
NULL
) {

2020 
SyncF¿me
* 
cu¼’tSyncF¿me
 = 
fCu¼’tIOS‹
->
fH—dSyncF¿me
;

2022 
cu¼’tSyncF¿me
 !ğ
NULL
 &&

2023 (
fCu¼’tIOS‹
->
fH—dSyncF¿me
 =ğfCu¼’tIOS‹->
fTaSyncF¿me
 ||

2024 
cu¼’tSyncF¿me
 !ğ
fCu¼’tIOS‹
->
fTaSyncF¿me
)) {

2029 ++
numEÁr›s
;

2030 
size
 +ğ
	`addWÜd
(
cu¼’tSyncF¿me
->
sfF¿meNum
);

2031 
cu¼’tSyncF¿me
 = cu¼’tSyncF¿me->
ÃxtSyncF¿me
;

2035 cÚ¡ 
§m¶esP”F¿me
 = 
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
;

2036 
ChunkDesütÜ
* 
chunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

2037 
chunk
 !ğ
NULL
) {

2038 cÚ¡ 
numSam¶es
 = 
chunk
->
fNumF¿mes
*
§m¶esP”F¿me
;

2039 
numSam¶esSoF¬
 +ğ
numSam¶es
;

2040 
chunk
 = chunk->
fNextChunk
;

2044 
i
;

2045 
i
 = 0; i < 
numSam¶esSoF¬
; i += 12) {

2048 
size
 +ğ
	`addWÜd
(
i
+1);

2049 ++
numEÁr›s
;

2053 ià(
i
 !ğ(
numSam¶esSoF¬
 - 1)) {

2054 
size
 +ğ
	`addWÜd
(
numSam¶esSoF¬
);

2055 ++
numEÁr›s
;

2060 
	`£tWÜd
(
numEÁr›sPos™iÚ
, 
numEÁr›s
);

2061 
addAtomEnd
;

2063 
	`addAtom
(
¡sc
);

2064 
size
 +ğ
	`addWÜd
(0x00000000);

2068 
št64_t
 
numEÁr›sPos™iÚ
 = 
	`T–lFe64
(
fOutFid
);

2069 
size
 +ğ
	`addWÜd
(0);

2073 
numEÁr›s
 = 0, 
chunkNumb”
 = 0;

2074 
´evSam¶esP”Chunk
 = ~0;

2075 cÚ¡ 
§m¶esP”F¿me
 = 
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
;

2076 
ChunkDesütÜ
* 
chunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

2077 
chunk
 !ğ
NULL
) {

2078 ++
chunkNumb”
;

2079 cÚ¡ 
§m¶esP”Chunk
 = 
chunk
->
fNumF¿mes
*
§m¶esP”F¿me
;

2080 ià(
§m¶esP”Chunk
 !ğ
´evSam¶esP”Chunk
) {

2082 ++
numEÁr›s
;

2083 
size
 +ğ
	`addWÜd
(
chunkNumb”
);

2084 
size
 +ğ
	`addWÜd
(
§m¶esP”Chunk
);

2085 
size
 +ğ
	`addWÜd
(0x00000001);

2087 
´evSam¶esP”Chunk
 = 
§m¶esP”Chunk
;

2089 
chunk
 = chunk->
fNextChunk
;

2093 
	`£tWÜd
(
numEÁr›sPos™iÚ
, 
numEÁr›s
);

2094 
addAtomEnd
;

2096 
	`addAtom
(
¡sz
);

2097 
size
 +ğ
	`addWÜd
(0x00000000);

2102 
BoŞ—n
 
haveSšgËEÁryTabË
 = 
True
;

2103 
fœ¡BPS
 = 0.0;

2104 
ChunkDesütÜ
* 
chunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

2105 
chunk
 !ğ
NULL
) {

2106 
bps


2107 ğ()(
chunk
->
fF¿meSize
)/(
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
);

2108 ià(
bps
 < 1.0) {

2114 ià(
fœ¡BPS
 == 0.0) {

2115 
fœ¡BPS
 = 
bps
;

2116 } ià(
bps
 !ğ
fœ¡BPS
) {

2117 
haveSšgËEÁryTabË
 = 
F®£
;

2121 
chunk
 = chunk->
fNextChunk
;

2124 
§m¶eSize
;

2125 ià(
haveSšgËEÁryTabË
) {

2126 ià(
fCu¼’tIOS‹
->
	`isHštT¿ck
()

2127 && 
fCu¼’tIOS‹
->
fH—dChunk
 !ğ
NULL
) {

2128 
§m¶eSize
 = 
fCu¼’tIOS‹
->
fH—dChunk
->
fF¿meSize


2129 / 
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
;

2132 
§m¶eSize
 = 
fCu¼’tIOS‹
->
fQTTimeUn™sP”Sam¶e
;

2135 
§m¶eSize
 = 0;

2137 
size
 +ğ
	`addWÜd
(
§m¶eSize
);

2138 cÚ¡ 
tÙNumSam¶es
 = 
fCu¼’tIOS‹
->
fQTTÙNumSam¶es
;

2139 
size
 +ğ
	`addWÜd
(
tÙNumSam¶es
);

2141 ià(!
haveSšgËEÁryTabË
) {

2144 
ChunkDesütÜ
* 
chunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

2145 
chunk
 !ğ
NULL
) {

2146 
numSam¶es


2147 ğ
chunk
->
fNumF¿mes
*(
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
);

2148 
§m¶eSize


2149 ğ
chunk
->
fF¿meSize
/(
fCu¼’tIOS‹
->
fQTSam¶esP”F¿me
);

2150 
i
 = 0; i < 
numSam¶es
; ++i) {

2151 
size
 +ğ
	`addWÜd
(
§m¶eSize
);

2154 
chunk
 = chunk->
fNextChunk
;

2157 
addAtomEnd
;

2159 
	`addAtom
(
co64
);

2160 
size
 +ğ
	`addWÜd
(0x00000000);

2161 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fNumChunks
);

2164 
ChunkDesütÜ
* 
chunk
 = 
fCu¼’tIOS‹
->
fH—dChunk
;

2165 
chunk
 !ğ
NULL
) {

2166 
size
 +ğ
	`addWÜd64
(
chunk
->
fOff£tInFe
);

2168 
chunk
 = chunk->
fNextChunk
;

2170 
addAtomEnd
;

2172 
	`addAtom
(
ud
);

2173 
size
 +ğ
	`addAtom_Çme
();

2174 
size
 +ğ
	`addAtom_hÁi
();

2175 
size
 +ğ
	`addAtom_hšf
();

2176 
addAtomEnd
;

2178 
	`addAtom
(
Çme
);

2179 
desütiÚ
[100];

2180 
	`¥rštf
(
desütiÚ
, "Hinted %srack",

2181 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
	`mediumName
());

2182 
size
 +ğ
	`addArb™¿rySŒšg
(
desütiÚ
, 
F®£
);

2183 
addAtomEnd
;

2185 
	`addAtom
(
hÁi
);

2186 
size
 +ğ
	`addAtom_sdp
();

2187 
addAtomEnd
;

2189 
QuickTimeFeSšk
::
	`addAtom_sdp
() {

2190 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

2191 
size
 = 
	`addAtomH—d”
("sdp ");

2194 cÚ¡* 
sdpLšes
 = 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
.
	`§vedSDPLšes
();

2197 * 
ÃwSDPLšes
 = 
Ãw
 [
	`¡¾’
(
sdpLšes
)+100 ];

2198 cÚ¡* 
£¬chSŒ
 = "a=control:trackid=";

2199 
BoŞ—n
 
foundS—rchSŒšg
 = 
F®£
;

2200 cÚ¡ *
p1
, *
p2
, *
p3
;

2201 
p1
 = 
sdpLšes
; *p1 != '\0'; ++p1) {

2202 
p2
 = 
p1
,
p3
 = 
£¬chSŒ
; 
	`tŞow”
(*p2) == *p3; ++p2,++p3) {}

2203 ià(*
p3
 == '\0') {

2205 
befÜeT¿ckNumPo¢
 = 
p2
-
sdpLšes
;

2207 
ŒackNumL’gth
;

2208 ià(
	`ssÿnf
(
p2
, " %*d%n", &
ŒackNumL’gth
) < 0) ;

2209 
aá”T¿ckNumPo¢
 = 
befÜeT¿ckNumPo¢
 + 
ŒackNumL’gth
;

2212 
i
;

2213 
i
 = 0; i < 
befÜeT¿ckNumPo¢
; ++iè
ÃwSDPLšes
[i] = 
sdpLšes
[i];

2214 
	`¥rštf
(&
ÃwSDPLšes
[
i
], "%d", 
fCu¼’tIOS‹
->
fT¿ckID
);

2215 
i
 = 
aá”T¿ckNumPo¢
;

2216 
j
 = 
i
 + 
	`¡¾’
(&
ÃwSDPLšes
[i]);

2218 ià((
ÃwSDPLšes
[
j
] = 
sdpLšes
[
i
]) == '\0') ;

2219 ++
i
; ++
j
;

2222 
foundS—rchSŒšg
 = 
True
;

2227 ià(!
foundS—rchSŒšg
) {

2230 
	`¥rštf
(
ÃwSDPLšes
, "%s%s%d\r\n",

2231 
sdpLšes
, 
£¬chSŒ
, 
fCu¼’tIOS‹
->
fT¿ckID
);

2234 
size
 +ğ
	`addArb™¿rySŒšg
(
ÃwSDPLšes
, 
F®£
);

2235 
d–‘e
[] 
ÃwSDPLšes
;

2236 
addAtomEnd
;

2238 
	`addAtom
(
hšf
);

2239 
size
 +ğ
	`addAtom_tÙl
();

2240 
size
 +ğ
	`addAtom_Åck
();

2241 
size
 +ğ
	`addAtom_ay
();

2242 
size
 +ğ
	`addAtom_Œpy
();

2243 
size
 +ğ
	`addAtom_nump
();

2244 
size
 +ğ
	`addAtom_yl
();

2246 
size
 +ğ
	`addAtom_dmed
();

2247 
size
 +ğ
	`addAtom_dimm
();

2248 
size
 +ğ
	`addAtom_d»p
();

2249 
size
 +ğ
	`addAtom_tmš
();

2250 
size
 +ğ
	`addAtom_tmax
();

2251 
size
 +ğ
	`addAtom_pmax
();

2252 
size
 +ğ
	`addAtom_dmax
();

2253 
size
 +ğ
	`addAtom_·yt
();

2254 
addAtomEnd
;

2256 
	`addAtom
(
tÙl
);

2257 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
Œpy
.
lo
);

2258 
addAtomEnd
;

2260 
	`addAtom
(
Åck
);

2261 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
nump
.
lo
);

2262 
addAtomEnd
;

2264 
	`addAtom
(
ay
);

2265 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
yl
.
lo
);

2266 
addAtomEnd
;

2268 
	`addAtom
(
Œpy
);

2269 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
Œpy
.
hi
);

2270 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
Œpy
.
lo
);

2271 
addAtomEnd
;

2273 
	`addAtom
(
nump
);

2274 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
nump
.
hi
);

2275 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
nump
.
lo
);

2276 
addAtomEnd
;

2278 
	`addAtom
(
yl
);

2279 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
yl
.
hi
);

2280 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
yl
.
lo
);

2281 
addAtomEnd
;

2283 
	`addAtom
(
dmed
);

2284 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
dmed
.
hi
);

2285 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
dmed
.
lo
);

2286 
addAtomEnd
;

2288 
	`addAtom
(
dimm
);

2289 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
dimm
.
hi
);

2290 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
dimm
.
lo
);

2291 
addAtomEnd
;

2293 
	`addAtom
(
d»p
);

2294 
size
 +ğ
	`addWÜd
(0);

2295 
size
 +ğ
	`addWÜd
(0);

2296 
addAtomEnd
;

2298 
	`addAtom
(
tmš
);

2299 
size
 +ğ
	`addWÜd
(0);

2300 
addAtomEnd
;

2302 
	`addAtom
(
tmax
);

2303 
size
 +ğ
	`addWÜd
(0);

2304 
addAtomEnd
;

2306 
	`addAtom
(
pmax
);

2307 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
pmax
);

2308 
addAtomEnd
;

2310 
	`addAtom
(
dmax
);

2311 
size
 +ğ
	`addWÜd
(
fCu¼’tIOS‹
->
fHINF
.
dmax
);

2312 
addAtomEnd
;

2314 
	`addAtom
(
·yt
);

2315 
MedŸSub£ssiÚ
& 
ourSub£ssiÚ
 = 
fCu¼’tIOS‹
->
fOurSub£ssiÚ
;

2316 
RTPSourû
* 
¹pSourû
 = 
ourSub£ssiÚ
.
	`¹pSourû
();

2317 
size
 +ğ
	`addWÜd
(
¹pSourû
->
	`¹pPaylßdFÜm©
());

2320 
¹pm­SŒšgL’gth
 = 
	`¡¾’
(
ourSub£ssiÚ
.
	`codecName
()) + 20;

2321 * 
¹pm­SŒšg
 = 
Ãw
 [
¹pm­SŒšgL’gth
];

2322 
	`¥rštf
(
¹pm­SŒšg
, "%s/%d",

2323 
ourSub£ssiÚ
.
	`codecName
(), 
¹pSourû
->
	`time¡ampF»qu’cy
());

2324 
size
 +ğ
	`addArb™¿rySŒšg
(
¹pm­SŒšg
);

2325 
d–‘e
[] 
¹pm­SŒšg
;

2326 
addAtomEnd
;

2329 
QuickTimeFeSšk
::
	`addAtom_dummy
() {

2330 
št64_t
 
š™FePo¢
 = 
	`T–lFe64
(
fOutFid
);

2331 
size
 = 
	`addAtomH—d”
("????");

2332 
addAtomEnd
;

	@liveMedia/QuickTimeGenericRTPSource.cpp

22 
	~"QuickTimeG’”icRTPSourû.hh
"

29 şas 
	cQTG’”icBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

30 
public
:

31 
QTG’”icBufã»dPack‘
(
QuickTimeG’”icRTPSourû
& 
ourSourû
);

32 
	mvœtu®
 ~
QTG’”icBufã»dPack‘
();

34 
	m´iv©e
:

35 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

36 
d©aSize
);

37 
	m´iv©e
:

38 
QuickTimeG’”icRTPSourû
& 
fOurSourû
;

41 şas 
	cQTG’”icBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

42 
´iv©e
:

43 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

49 
QuickTimeG’”icRTPSourû
*

50 
	gQuickTimeG’”icRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

51 
Groupsock
* 
RTPgs
,

52 
¹pPaylßdFÜm©
,

53 
¹pTime¡ampF»qu’cy
,

54 cÚ¡* 
mimeTy³SŒšg
) {

55  
Ãw
 
	`QuickTimeG’”icRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

56 
¹pTime¡ampF»qu’cy
,

57 
mimeTy³SŒšg
);

58 
	}
}

60 
	gQuickTimeG’”icRTPSourû


61 ::
	$QuickTimeG’”icRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

62 
¹pPaylßdFÜm©
,

63 
¹pTime¡ampF»qu’cy
,

64 cÚ¡* 
mimeTy³SŒšg
)

65 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

66 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

67 
Ãw
 
QTG’”icBufã»dPack‘FaùÜy
),

68 
	`fMIMEty³SŒšg
(
	$¡rDup
(
mimeTy³SŒšg
)) {

69 
qtS‹
.
PCK
 = 0;

70 
qtS‹
.
timesÿË
 = 0;

71 
qtS‹
.
sdAtom
 = 
NULL
;

72 
qtS‹
.
sdAtomSize
 = qtS‹.
width
 = qtS‹.
height
 = 0;

73 
	}
}

75 
	gQuickTimeG’”icRTPSourû
::~
	$QuickTimeG’”icRTPSourû
() {

76 
d–‘e
[] 
qtS‹
.
sdAtom
;

77 
d–‘e
[] (*)
fMIMEty³SŒšg
;

78 
	}
}

80 
BoŞ—n
 
	gQuickTimeG’”icRTPSourû


81 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

82 & 
»suÉS³cŸlH—d”Size
) {

83 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

84 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

88 
ex³ùedH—d”Size
 = 4;

89 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

91 
VER
 = (
h—d”S¹
[0]&0xF0)>>4;

92 ià(
VER
 > 1è 
F®£
;

93 
qtS‹
.
PCK
 = (
h—d”S¹
[0]&0x0C)>>2;

94 #ifdeà
DEBUG


95 
BoŞ—n
 
S
 = (
h—d”S¹
[0]&0x02) != 0;

97 
BoŞ—n
 
Q
 = (
h—d”S¹
[0]&0x01) != 0;

99 
BoŞ—n
 
L
 = (
h—d”S¹
[1]&0x80) != 0;

101 #ifdeà
DEBUG


102 
BoŞ—n
 
D
 = (
h—d”S¹
[2]&0x80) != 0;

103 
·ylßdId
 = ((
h—d”S¹
[2]&0x7F)<<8)|headerStart[3];

105 
h—d”S¹
 += 4;

107 #ifdeà
DEBUG


108 
	`årštf
(
¡d”r
, "PCK: %d, S: %d, Q: %d, L: %d, D: %d,…aylßdId: %d\n", 
qtS‹
.
PCK
, 
S
, 
Q
, 
L
, 
D
, 
·ylßdId
);

111 ià(
Q
) {

112 
ex³ùedH—d”Size
 += 4;

113 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

115 #ifdeà
DEBUG


116 
BoŞ—n
 
K
 = (
h—d”S¹
[0]&0x80) != 0;

117 
BoŞ—n
 
F
 = (
h—d”S¹
[0]&0x40) != 0;

118 
BoŞ—n
 
A
 = (
h—d”S¹
[0]&0x20) != 0;

119 
BoŞ—n
 
Z
 = (
h—d”S¹
[0]&0x10) != 0;

121 
·ylßdDesütiÚL’gth
 = (
h—d”S¹
[2]<<8)|headerStart[3];

122 
h—d”S¹
 += 4;

124 #ifdeà
DEBUG


125 
	`årštf
(
¡d”r
, "\tK: %d, F: %d, A: %d, Z: %d,…aylßdDesütiÚL’gth: %d\n", 
K
, 
F
, 
A
, 
Z
, 
·ylßdDesütiÚL’gth
);

128 ià(
·ylßdDesütiÚL’gth
 < 12è 
F®£
;

129 
ex³ùedH—d”Size
 +ğ(
·ylßdDesütiÚL’gth
 - 4);

130 
nÚPaddedSize
 = 
ex³ùedH—d”Size
;

131 
ex³ùedH—d”Size
 += 3;

132 
ex³ùedH—d”Size
 -=ƒxpectedHeaderSize%4;

133 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

134 
·ddšg
 = 
ex³ùedH—d”Size
 - 
nÚPaddedSize
;

136 #ifdeà
DEBUG


137 
medŸTy³
 = (
h—d”S¹
[0]<<24)|(headerStart[1]<<16)

138 |(
h—d”S¹
[2]<<8)|headerStart[3];

140 
qtS‹
.
timesÿË
 = (
h—d”S¹
[4]<<24)|(headerStart[5]<<16)

141 |(
h—d”S¹
[6]<<8)|headerStart[7];

142 
h—d”S¹
 += 8;

144 
·ylßdDesütiÚL’gth
 -= 12;

145 #ifdeà
DEBUG


146 
	`årštf
(
¡d”r
, "\tmedŸTy³: '%c%c%c%c',imesÿË: %d, %d by‹ oàTLV Ëá\n", 
medŸTy³
>>24, (medŸTy³&0xFF0000)>>16, (medŸTy³&0xFF00)>>8, medŸTy³&0xFF, 
qtS‹
.
timesÿË
, 
·ylßdDesütiÚL’gth
);

149 
·ylßdDesütiÚL’gth
 > 3) {

150 
vL’gth
 = (
h—d”S¹
[0]<<8)|headerStart[1];

151 
vTy³
 = (
h—d”S¹
[2]<<8)|headerStart[3];

152 
·ylßdDesütiÚL’gth
 -= 4;

153 ià(
vL’gth
 > 
·ylßdDesütiÚL’gth
è 
F®£
;

154 
h—d”S¹
 += 4;

155 #ifdeà
DEBUG


156 
	`årštf
(
¡d”r
, "\t\tTLV '%c%c',†’gth %d,†—všg %d„emaššg by‹s\n", 
vTy³
>>8,lvTy³&0xFF, 
vL’gth
, 
·ylßdDesütiÚL’gth
 -lvLength);

157 
i
 = 0; i < 
vL’gth
; ++iè
	`årštf
(
¡d”r
, "%02x:", 
h—d”S¹
[i]); fprintf(stderr, "\n");

161 
vTy³
) {

164 
©omL’gth
 = (
h—d”S¹
[0]<<24)|(headerStart[1]<<16)

165 |(
h—d”S¹
[2]<<8)|(headerStart[3]);

166 ià(
©omL’gth
 !ğ()
vL’gth
) ;

168 
d–‘e
[] 
qtS‹
.
sdAtom
; qtS‹.sdAtom = 
Ãw
 [
vL’gth
];

169 
	`memmove
(
qtS‹
.
sdAtom
, 
h—d”S¹
, 
vL’gth
);

170 
qtS‹
.
sdAtomSize
 = 
vL’gth
;

174 
qtS‹
.
width
 = (
h—d”S¹
[0]<<8)|headerStart[1];

178 
qtS‹
.
height
 = (
h—d”S¹
[0]<<8)|headerStart[1];

183 
·ylßdDesütiÚL’gth
 -ğ
vL’gth
;

184 
h—d”S¹
 +ğ
vL’gth
;

186 ià(
·ylßdDesütiÚL’gth
 > 0è 
F®£
;

187 
h—d”S¹
 +ğ
·ddšg
;

190 ià(
L
) {

191 
ex³ùedH—d”Size
 += 4;

192 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

194 
ssInfoL’gth
 = (
h—d”S¹
[2]<<8)|headerStart[3];

195 
h—d”S¹
 += 4;

197 #ifdeà
DEBUG


198 
	`årštf
(
¡d”r
, "\tssInfoL’gth: %d\n", 
ssInfoL’gth
);

201 ià(
ssInfoL’gth
 < 4è 
F®£
;

202 
ex³ùedH—d”Size
 +ğ(
ssInfoL’gth
 - 4);

203 
nÚPaddedSize
 = 
ex³ùedH—d”Size
;

204 
ex³ùedH—d”Size
 += 3;

205 
ex³ùedH—d”Size
 -=ƒxpectedHeaderSize%4;

206 ià(
·ck‘Size
 < 
ex³ùedH—d”Size
è 
F®£
;

207 
·ddšg
 = 
ex³ùedH—d”Size
 - 
nÚPaddedSize
;

209 
ssInfoL’gth
 -= 4;

210 
ssInfoL’gth
 > 3) {

211 
vL’gth
 = (
h—d”S¹
[0]<<8)|headerStart[1];

212 #ifdeà
DEBUG


213 
vTy³
 = (
h—d”S¹
[2]<<8)|headerStart[3];

215 
ssInfoL’gth
 -= 4;

216 ià(
vL’gth
 > 
ssInfoL’gth
è 
F®£
;

217 #ifdeà
DEBUG


218 
	`årštf
(
¡d”r
, "\t\tTLV '%c%c',†’gth %d,†—všg %d„emaššg by‹s\n", 
vTy³
>>8,lvTy³&0xFF, 
vL’gth
, 
ssInfoL’gth
 -lvLength);

219 
i
 = 0; i < 
vL’gth
; ++iè
	`årštf
(
¡d”r
, "%02x:", 
h—d”S¹
[4+i]); fprintf(stderr, "\n");

221 
ssInfoL’gth
 -ğ
vL’gth
;

222 
h—d”S¹
 +ğ4 + 
vL’gth
;

224 ià(
ssInfoL’gth
 > 0è 
F®£
;

225 
h—d”S¹
 +ğ
·ddšg
;

228 
fCu¼’tPack‘BegšsF¿me
 = 
fCu¼’tPack‘Com¶‘esF¿me
;

230 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

232 
»suÉS³cŸlH—d”Size
 = 
ex³ùedH—d”Size
;

233 #ifdeà
DEBUG


234 
	`årštf
(
¡d”r
, "ResuÉ s³cŸÈh—d” size: %d\n", 
»suÉS³cŸlH—d”Size
);

236  
True
;

237 
	}
}

239 cÚ¡* 
	gQuickTimeG’”icRTPSourû
::
	$MIMEty³
() const {

240 ià(
fMIMEty³SŒšg
 =ğ
NULL
è 
MuÉiF¿medRTPSourû
::
	`MIMEty³
();

242  
fMIMEty³SŒšg
;

243 
	}
}

248 
	gQTG’”icBufã»dPack‘


249 ::
	$QTG’”icBufã»dPack‘
(
QuickTimeG’”icRTPSourû
& 
ourSourû
)

250 : 
	$fOurSourû
(
ourSourû
) {

251 
	}
}

253 
QTG’”icBufã»dPack‘
::~
	$QTG’”icBufã»dPack‘
() {

254 
	}
}

256 
QTG’”icBufã»dPack‘
::

257 
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

259 ià(
fOurSourû
.
qtS‹
.
PCK
 !ğ2è 
d©aSize
;

261 ià(
d©aSize
 < 8)  0;

263 
§m¶eL’gth
 = (
äamePŒ
[2]<<8)|framePtr[3];

265 
äamePŒ
 += 8;

266 
d©aSize
 -= 8;

268  
§m¶eL’gth
 < 
d©aSize
 ? sampleLength : dataSize;

269 
	}
}

271 
Bufã»dPack‘
* 
	gQTG’”icBufã»dPack‘FaùÜy


272 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
) {

273  
Ãw
 
	`QTG’”icBufã»dPack‘
((
QuickTimeG’”icRTPSourû
&)(*
ourSourû
));

274 
	}
}

	@liveMedia/RTCP.cpp

21 
	~"RTCP.hh
"

22 
	~"GroupsockH–³r.hh
"

23 
	~"¹ı_äom_¥ec.h
"

24 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_QNX4
)

25 
	#¢´štf
 
_¢´štf


	)

30 şas 
	cRTCPMemb”D©aba£
 {

31 
	mpublic
:

32 
	$RTCPMemb”D©aba£
(
RTCPIn¡ªû
& 
ourRTCPIn¡ªû
)

33 : 
	`fOurRTCPIn¡ªû
(
ourRTCPIn¡ªû
), 
	`fNumMemb”s
(1 ),

34 
	`fTabË
(
HashTabË
::
	$ü—‹
(
ONE_WORD_HASH_KEYS
)) {

37 
vœtu®
 ~
	$RTCPMemb”D©aba£
() {

38 
d–‘e
 
fTabË
;

39 
	}
}

41 
BoŞ—n
 
	$isMemb”
(
s¤c
) const {

42  
fTabË
->
	`Lookup
((*)()
s¤c
è!ğ
NULL
;

43 
	}
}

45 
BoŞ—n
 
	$nÙeMemb”sh
(
s¤c
, 
curTimeCouÁ
) {

46 
BoŞ—n
 
isNew
 = !
	`isMemb”
(
s¤c
);

48 ià(
isNew
) {

49 ++
fNumMemb”s
;

53 
fTabË
->
	`Add
((*)()
s¤c
, (*)()
curTimeCouÁ
);

55  
isNew
;

56 
	}
}

58 
BoŞ—n
 
	$»move
(
s¤c
) {

59 
BoŞ—n
 
wasP»£Á
 = 
fTabË
->
	`Remove
((*)()
s¤c
);

60 ià(
wasP»£Á
) {

61 --
fNumMemb”s
;

63  
wasP»£Á
;

64 
	}
}

66 
	$numMemb”s
() const {

67  
fNumMemb”s
;

68 
	}
}

70 
»­OldMemb”s
(
th»shŞd
);

72 
	g´iv©e
:

73 
RTCPIn¡ªû
& 
fOurRTCPIn¡ªû
;

74 
	gfNumMemb”s
;

75 
HashTabË
* 
	gfTabË
;

78 
	gRTCPMemb”D©aba£
::
	$»­OldMemb”s
(
th»shŞd
) {

79 
BoŞ—n
 
foundOldMemb”
;

80 
u_št32_t
 
ŞdSSRC
 = 0;

83 
foundOldMemb”
 = 
F®£
;

85 
HashTabË
::
I‹¿tÜ
* 
™”


86 ğ
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*
fTabË
);

87 
ušŒ_t
 
timeCouÁ
;

88 cÚ¡* 
key
;

89 (
timeCouÁ
 = (
ušŒ_t
)(
™”
->
	`Ãxt
(
key
))) != 0) {

90 #ifdeà
DEBUG


91 
	`årštf
(
¡d”r
, "»­: checkšg SSRC 0x%lx: %ld (th»shŞd %d)\n", ()
key
, 
timeCouÁ
, 
th»shŞd
);

93 ià(
timeCouÁ
 < (
ušŒ_t
)
th»shŞd
) {

94 
ušŒ_t
 
s¤c
 = (ušŒ_t)
key
;

95 
ŞdSSRC
 = (
u_št32_t
)
s¤c
;

96 
foundOldMemb”
 = 
True
;

99 
d–‘e
 
™”
;

101 ià(
foundOldMemb”
) {

102 #ifdeà
DEBUG


103 
	`årštf
(
¡d”r
, "»­:„emovšg SSRC 0x%x\n", 
ŞdSSRC
);

105 
fOurRTCPIn¡ªû
.
	`»moveSSRC
(
ŞdSSRC
, 
True
);

107 } 
foundOldMemb”
);

108 
	}
}

113 
	$dTimeNow
() {

114 
timev®
 
timeNow
;

115 
	`g‘timeofday
(&
timeNow
, 
NULL
);

116  (è(
timeNow
.
tv_£c
 +imeNow.
tv_u£c
/1000000.0);

117 
	}
}

119 cÚ¡ 
	gmaxRTCPPack‘Size
 = 1456;

121 cÚ¡ 
	g´eã¼edRTCPPack‘Size
 = 1000;

123 
	gRTCPIn¡ªû
::
	$RTCPIn¡ªû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTCPgs
,

124 
tÙSessiÚBW
,

125 cÚ¡* 
úame
,

126 
RTPSšk
* 
sšk
, 
RTPSourû
* 
sourû
,

127 
BoŞ—n
 
isSSMSourû
)

128 : 
	`Medium
(
’v
), 
	`fRTCPIÁ”çû
(
this
, 
RTCPgs
), 
	`fTÙSessiÚBW
(
tÙSessiÚBW
),

129 
	`fSšk
(
sšk
), 
	`fSourû
(
sourû
), 
	`fIsSSMSourû
(
isSSMSourû
),

130 
	`fCNAME
(
RTCP_SDES_CNAME
, 
úame
), 
	`fOutgošgR•ÜtCouÁ
(1),

131 
	`fAveRTCPSize
(0), 
	`fIsIn™Ÿl
(1), 
	`fP»vNumMemb”s
(0),

132 
	`fLa¡S’tSize
(0), 
	`fLa¡ReûivedSize
(0), 
	`fLa¡ReûivedSSRC
(0),

133 
	`fTy³OfEv’t
(
EVENT_UNKNOWN
), 
	`fTy³OfPack‘
(
PACKET_UNKNOWN_TYPE
),

134 
	`fHaveJu¡S’tPack‘
(
F®£
), 
	`fLa¡Pack‘S’tSize
(0),

135 
	`fByeHªdËrTask
(
NULL
), 
	`fByeHªdËrCl›ÁD©a
(NULL),

136 
	`fSRHªdËrTask
(
NULL
), 
	`fSRHªdËrCl›ÁD©a
(NULL),

137 
	`fRRHªdËrTask
(
NULL
), 
	`fRRHªdËrCl›ÁD©a
(NULL),

138 
	`fS³cificRRHªdËrTabË
(
NULL
),

139 
	`fAµHªdËrTask
(
NULL
), 
	$fAµHªdËrCl›ÁD©a
(
NULL
) {

140 #ifdeà
DEBUG


141 
	`årštf
(
¡d”r
, "RTCPIn¡ªû[%p]::RTCPIn¡ªû()\n", 
this
);

143 ià(
fTÙSessiÚBW
 == 0) {

144 
’v
 << "RTCPInstance::RTCPInstanceƒrror:otSessionBW…arameter should‚ot be zero!\n";

145 
fTÙSessiÚBW
 = 1;

148 ià(
isSSMSourû
è
RTCPgs
->
	`muÉiÿ¡S’dOÆy
();

150 
timeNow
 = 
	`dTimeNow
();

151 
fP»vR•ÜtTime
 = 
fNextR•ÜtTime
 = 
timeNow
;

153 
fKnownMemb”s
 = 
Ãw
 
	`RTCPMemb”D©aba£
(*
this
);

154 
fInBuf
 = 
Ãw
 [
maxRTCPPack‘Size
];

155 ià(
fKnownMemb”s
 =ğ
NULL
 || 
fInBuf
 == NULL) ;

156 
fNumBy‹sAÌ—dyR—d
 = 0;

158 
fOutBuf
 = 
Ãw
 
	`OutPack‘Bufãr
(
´eã¼edRTCPPack‘Size
, 
maxRTCPPack‘Size
, maxRTCPPacketSize);

159 ià(
fOutBuf
 =ğ
NULL
) ;

161 ià(
fSourû
 !ğ
NULL
 && fSourû->
	`RTPgs
(è=ğ
RTCPgs
) {

164 
fSourû
->
	`»gi¡”FÜMuÉËxedRTCPPack‘s
(
this
);

167 
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËr


168 ğ(
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgR•ÜtHªdËr
;

169 
fRTCPIÁ”çû
.
	`¡¬tN‘wÜkR—dšg
(
hªdËr
);

173 
fTy³OfEv’t
 = 
EVENT_REPORT
;

174 
	`ÚExpœe
(
this
);

175 
	}
}

177 
	sRRHªdËrRecÜd
 {

178 
TaskFunc
* 
	m¼HªdËrTask
;

179 * 
	m¼HªdËrCl›ÁD©a
;

182 
	gRTCPIn¡ªû
::~
	$RTCPIn¡ªû
() {

183 #ifdeà
DEBUG


184 
	`årštf
(
¡d”r
, "RTCPIn¡ªû[%p]::~RTCPIn¡ªû()\n", 
this
);

186 ià(
fSourû
 !ğ
NULL
èfSourû->
	`d”egi¡”FÜMuÉËxedRTCPPack‘s
();

190 
fTy³OfEv’t
 = 
EVENT_BYE
;

191 
	`£ndBYE
();

193 ià(
fS³cificRRHªdËrTabË
 !ğ
NULL
) {

194 
Add»ssPÜtLookupTabË
::
I‹¿tÜ
 
	`™”
(*
fS³cificRRHªdËrTabË
);

195 
RRHªdËrRecÜd
* 
¼HªdËr
;

196 (
¼HªdËr
 = (
RRHªdËrRecÜd
*)
™”
.
	`Ãxt
()è!ğ
NULL
) {

197 
d–‘e
 
¼HªdËr
;

199 
d–‘e
 
fS³cificRRHªdËrTabË
;

202 
d–‘e
 
fKnownMemb”s
;

203 
d–‘e
 
fOutBuf
;

204 
d–‘e
[] 
fInBuf
;

205 
	}
}

207 
	gRTCPIn¡ªû
::
	$nÙeA¼ivšgRR
(
sockaddr_š
 cÚ¡& 
äomAdd»ssAndPÜt
,

208 
tıSock‘Num
, 
tıSŒ—mChªÃlId
) {

212 ià(
fS³cificRRHªdËrTabË
 !ğ
NULL
) {

213 
ÃtAdd»ssB™s
 
äomAddr
;

214 
pÜtNumB™s
 
äomPÜtNum
;

215 ià(
tıSock‘Num
 < 0) {

217 
äomAddr
 = 
äomAdd»ssAndPÜt
.
sš_addr
.
s_addr
;

218 
äomPÜtNum
 = 
	`Áohs
(
äomAdd»ssAndPÜt
.
sš_pÜt
);

222 
äomAddr
 = 
tıSock‘Num
;

223 
äomPÜtNum
 = 
tıSŒ—mChªÃlId
;

225 
PÜt
 
	`äomPÜt
(
äomPÜtNum
);

226 
RRHªdËrRecÜd
* 
¼HªdËr


227 ğ(
RRHªdËrRecÜd
*)(
fS³cificRRHªdËrTabË
->
	`Lookup
(
äomAddr
, (~0), 
äomPÜt
));

228 ià(
¼HªdËr
 !ğ
NULL
) {

229 ià(
¼HªdËr
->
¼HªdËrTask
 !ğ
NULL
) {

230 (*(
¼HªdËr
->
¼HªdËrTask
))ÔrHªdËr->
¼HªdËrCl›ÁD©a
);

236 ià(
fRRHªdËrTask
 !ğ
NULL
è(*fRRHªdËrTask)(
fRRHªdËrCl›ÁD©a
);

237 
	}
}

239 
RTCPIn¡ªû
* 
	gRTCPIn¡ªû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTCPgs
,

240 
tÙSessiÚBW
,

241 cÚ¡* 
úame
,

242 
RTPSšk
* 
sšk
, 
RTPSourû
* 
sourû
,

243 
BoŞ—n
 
isSSMSourû
) {

244  
Ãw
 
	`RTCPIn¡ªû
(
’v
, 
RTCPgs
, 
tÙSessiÚBW
, 
úame
, 
sšk
, 
sourû
,

245 
isSSMSourû
);

246 
	}
}

248 
BoŞ—n
 
	gRTCPIn¡ªû
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
,

249 cÚ¡* 
š¡ªûName
,

250 
RTCPIn¡ªû
*& 
»suÉIn¡ªû
) {

251 
»suÉIn¡ªû
 = 
NULL
;

253 
Medium
* 
medium
;

254 ià(!
Medium
::
	`lookupByName
(
’v
, 
š¡ªûName
, 
medium
)è 
F®£
;

256 ià(!
medium
->
	`isRTCPIn¡ªû
()) {

257 
’v
.
	`£tResuÉMsg
(
š¡ªûName
, " is‚ot‡ RTCP instance");

258  
F®£
;

261 
»suÉIn¡ªû
 = (
RTCPIn¡ªû
*)
medium
;

262  
True
;

263 
	}
}

265 
BoŞ—n
 
	gRTCPIn¡ªû
::
	$isRTCPIn¡ªû
() const {

266  
True
;

267 
	}
}

269 
	gRTCPIn¡ªû
::
	$numMemb”s
() const {

270 ià(
fKnownMemb”s
 =ğ
NULL
)  0;

272  
fKnownMemb”s
->
	`numMemb”s
();

273 
	}
}

275 
	gRTCPIn¡ªû
::
	$£tByeHªdËr
(
TaskFunc
* 
hªdËrTask
, * 
ş›ÁD©a
,

276 
BoŞ—n
 
hªdËAùiveP¬ticªtsOÆy
) {

277 
fByeHªdËrTask
 = 
hªdËrTask
;

278 
fByeHªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

279 
fByeHªdËAùiveP¬ticªtsOÆy
 = 
hªdËAùiveP¬ticªtsOÆy
;

280 
	}
}

282 
	gRTCPIn¡ªû
::
	$£tSRHªdËr
(
TaskFunc
* 
hªdËrTask
, * 
ş›ÁD©a
) {

283 
fSRHªdËrTask
 = 
hªdËrTask
;

284 
fSRHªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

285 
	}
}

287 
	gRTCPIn¡ªû
::
	$£tRRHªdËr
(
TaskFunc
* 
hªdËrTask
, * 
ş›ÁD©a
) {

288 
fRRHªdËrTask
 = 
hªdËrTask
;

289 
fRRHªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

290 
	}
}

292 
	gRTCPIn¡ªû


293 ::
	$£tS³cificRRHªdËr
(
ÃtAdd»ssB™s
 
äomAdd»ss
, 
PÜt
 
äomPÜt
,

294 
TaskFunc
* 
hªdËrTask
, * 
ş›ÁD©a
) {

295 ià(
hªdËrTask
 =ğ
NULL
 && 
ş›ÁD©a
 == NULL) {

296 
	`un£tS³cificRRHªdËr
(
äomAdd»ss
, 
äomPÜt
);

300 
RRHªdËrRecÜd
* 
¼HªdËr
 = 
Ãw
 RRHandlerRecord;

301 
¼HªdËr
->
¼HªdËrTask
 = 
hªdËrTask
;

302 
¼HªdËr
->
¼HªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

303 ià(
fS³cificRRHªdËrTabË
 =ğ
NULL
) {

304 
fS³cificRRHªdËrTabË
 = 
Ãw
 
Add»ssPÜtLookupTabË
;

306 
RRHªdËrRecÜd
* 
exi¡šgRecÜd
 = (RRHªdËrRecÜd*)
fS³cificRRHªdËrTabË
->
	`Add
(
äomAdd»ss
, (~0), 
äomPÜt
, 
¼HªdËr
);

307 
d–‘e
 
exi¡šgRecÜd
;

309 
	}
}

311 
	gRTCPIn¡ªû


312 ::
	$un£tS³cificRRHªdËr
(
ÃtAdd»ssB™s
 
äomAdd»ss
, 
PÜt
 
äomPÜt
) {

313 ià(
fS³cificRRHªdËrTabË
 =ğ
NULL
) ;

315 
RRHªdËrRecÜd
* 
¼HªdËr


316 ğ(
RRHªdËrRecÜd
*)(
fS³cificRRHªdËrTabË
->
	`Lookup
(
äomAdd»ss
, (~0), 
äomPÜt
));

317 ià(
¼HªdËr
 !ğ
NULL
) {

318 
fS³cificRRHªdËrTabË
->
	`Remove
(
äomAdd»ss
, (~0), 
äomPÜt
);

319 
d–‘e
 
¼HªdËr
;

321 
	}
}

323 
	gRTCPIn¡ªû
::
	$£tAµHªdËr
(
RTCPAµHªdËrFunc
* 
hªdËrTask
, * 
ş›ÁD©a
) {

324 
fAµHªdËrTask
 = 
hªdËrTask
;

325 
fAµHªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

326 
	}
}

328 
	gRTCPIn¡ªû
::
	$£ndAµPack‘
(
u_št8_t
 
subty³
, cÚ¡* 
Çme
,

329 
u_št8_t
* 
­pD•’d’tD©a
, 
­pD•’d’tD©aSize
) {

331 
u_št32_t
 
¹ıHdr
 = 0x80000000;

332 
¹ıHdr
 |ğ(
subty³
&0x1F)<<24;

333 
¹ıHdr
 |ğ(
RTCP_PT_APP
<<16);

334 
Ëngth
 = 2 + (
­pD•’d’tD©aSize
+3)/4;

335 
¹ıHdr
 |ğ(
Ëngth
&0xFFFF);

336 
fOutBuf
->
	`’queueWÜd
(
¹ıHdr
);

339 
fOutBuf
->
	`’queueWÜd
(
fSourû
 !ğ
NULL
 ? fSourû->
	`SSRC
(è: 
fSšk
 != NULL ? fSink->SSRC() : 0);

342 
ÇmeBy‹s
[4];

343 
ÇmeBy‹s
[0] =‚ameBytes[1] =‚ameBytes[2] =‚ameBytes[3] = '\0';

344 ià(
Çme
 !ğ
NULL
) {

345 
	`¢´štf
(
ÇmeBy‹s
, 4, "%s", 
Çme
);

347 
fOutBuf
->
	`’queue
((
u_št8_t
*)
ÇmeBy‹s
, 4);

350 ià(
­pD•’d’tD©a
 !ğ
NULL
 && 
­pD•’d’tD©aSize
 > 0) {

351 
fOutBuf
->
	`’queue
(
­pD•’d’tD©a
, 
­pD•’d’tD©aSize
);

353 
modulo
 = 
­pD•’d’tD©aSize
%4;

354 
·ddšgSize
 = 
modulo
 == 0 ? 0 : 4-modulo;

355 
u_št8_t
 cÚ¡ 
·ddšgBy‹
 = 0x00;

356 
i
 = 0; i < 
·ddšgSize
; ++iè
fOutBuf
->
	`’queue
(&
·ddšgBy‹
, 1);

360 
	`£ndButPack‘
();

361 
	}
}

363 
	gRTCPIn¡ªû
::
	$£tSŒ—mSock‘
(
sockNum
,

364 
¡»amChªÃlId
) {

366 
fRTCPIÁ”çû
.
	`¡İN‘wÜkR—dšg
();

369 
fRTCPIÁ”çû
.
	`£tSŒ—mSock‘
(
sockNum
, 
¡»amChªÃlId
);

372 
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËr


373 ğ(
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgR•ÜtHªdËr
;

374 
fRTCPIÁ”çû
.
	`¡¬tN‘wÜkR—dšg
(
hªdËr
);

375 
	}
}

377 
	gRTCPIn¡ªû
::
	$addSŒ—mSock‘
(
sockNum
,

378 
¡»amChªÃlId
) {

380 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fRTCPIÁ”çû
.
	`gs
()->
	`sock‘Num
());

383 
fRTCPIÁ”çû
.
	`addSŒ—mSock‘
(
sockNum
, 
¡»amChªÃlId
);

386 
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËr


387 ğ(
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgR•ÜtHªdËr
;

388 
fRTCPIÁ”çû
.
	`¡¬tN‘wÜkR—dšg
(
hªdËr
);

389 
	}
}

391 
	gRTCPIn¡ªû


392 ::
	$šjeùR•Üt
(
u_št8_t
 cÚ¡* 
·ck‘
, 
·ck‘Size
, 
sockaddr_š
 cÚ¡& 
äomAdd»ss
) {

393 ià(
·ck‘Size
 > 
maxRTCPPack‘Size
)…acketSize = maxRTCPPacketSize;

394 
	`memmove
(
fInBuf
, 
·ck‘
, 
·ck‘Size
);

396 
	`´oûssIncomšgR•Üt
(
·ck‘Size
, 
äomAdd»ss
, -1, 0xFF);

397 
	}
}

399 cÚ¡ 
	gIP_UDP_HDR_SIZE
 = 28;

402 
	#ADVANCE
(
n
è
pkt
 +ğÒ); 
·ck‘Size
 -ğÒ)

	)

404 
	gRTCPIn¡ªû
::
	$šcomšgR•ÜtHªdËr
(
RTCPIn¡ªû
* 
š¡ªû
,

406 
š¡ªû
->
	`šcomšgR•ÜtHªdËr1
();

407 
	}
}

409 
	gRTCPIn¡ªû
::
	$šcomšgR•ÜtHªdËr1
() {

411 ià(
fNumBy‹sAÌ—dyR—d
 >ğ
maxRTCPPack‘Size
) {

412 
	`’vœ
() << "RTCPInstanceƒrror: Hit†imit when„eading incoming…acket over TCP. Increase \"maxRTCPPacketSize\"\n";

416 
numBy‹sR—d
;

417 
sockaddr_š
 
äomAdd»ss
;

418 
tıSock‘Num
;

419 
tıSŒ—mChªÃlId
;

420 
BoŞ—n
 
·ck‘R—dWasIncom¶‘e
;

421 
BoŞ—n
 
»adResuÉ


422 ğ
fRTCPIÁ”çû
.
	`hªdËR—d
(&
fInBuf
[
fNumBy‹sAÌ—dyR—d
], 
maxRTCPPack‘Size
 - fNumBytesAlreadyRead,

423 
numBy‹sR—d
, 
äomAdd»ss
,

424 
tıSock‘Num
, 
tıSŒ—mChªÃlId
,

425 
·ck‘R—dWasIncom¶‘e
);

427 
·ck‘Size
 = 0;

428 ià(
·ck‘R—dWasIncom¶‘e
) {

429 
fNumBy‹sAÌ—dyR—d
 +ğ
numBy‹sR—d
;

432 
·ck‘Size
 = 
fNumBy‹sAÌ—dyR—d
 + 
numBy‹sR—d
;

433 
fNumBy‹sAÌ—dyR—d
 = 0;

435 ià(!
»adResuÉ
) ;

438 
BoŞ—n
 
·ck‘WasFromOurHo¡
 = 
F®£
;

439 ià(
	`RTCPgs
()->
	`wasLoİedBackFromUs
(
	`’vœ
(), 
äomAdd»ss
)) {

440 
·ck‘WasFromOurHo¡
 = 
True
;

446 ià(
fHaveJu¡S’tPack‘
 && 
fLa¡Pack‘S’tSize
 =ğ
·ck‘Size
) {

448 
fHaveJu¡S’tPack‘
 = 
F®£
;

453 ià(
fIsSSMSourû
 && !
·ck‘WasFromOurHo¡
) {

472 
fRTCPIÁ”çû
.
	`£ndPack‘
(
fInBuf
, 
·ck‘Size
);

473 
fHaveJu¡S’tPack‘
 = 
True
;

474 
fLa¡Pack‘S’tSize
 = 
·ck‘Size
;

477 
	`´oûssIncomšgR•Üt
(
·ck‘Size
, 
äomAdd»ss
, 
tıSock‘Num
, 
tıSŒ—mChªÃlId
);

479 
	}
}

481 
	gRTCPIn¡ªû


482 ::
	$´oûssIncomšgR•Üt
(
·ck‘Size
, 
sockaddr_š
 cÚ¡& 
äomAdd»ssAndPÜt
,

483 
tıSock‘Num
, 
tıSŒ—mChªÃlId
) {

485 
BoŞ—n
 
ÿÎByeHªdËr
 = 
F®£
;

486 * 
pkt
 = 
fInBuf
;

488 #ifdeà
DEBUG


489 
	`årštf
(
¡d”r
, "[%p]§w incomšg RTCP…ack‘ (äom ", 
this
);

490 ià(
tıSock‘Num
 < 0) {

492 
	`årštf
(
¡d”r
, "add»s %s,…Üˆ%d", 
	`Add»ssSŒšg
(
äomAdd»ssAndPÜt
).
	`v®
(), 
	`Áohs
(äomAdd»ssAndPÜt.
sš_pÜt
));

494 
	`årštf
(
¡d”r
, "TCP sock‘ #%d, sŒ—m chªÃÈid %d", 
tıSock‘Num
, 
tıSŒ—mChªÃlId
);

496 
	`årštf
(
¡d”r
, ")\n");

497 
i
 = 0; i < 
·ck‘Size
; ++i) {

498 ià(
i
%4 =ğ0è
	`årštf
(
¡d”r
, " ");

499 
	`årštf
(
¡d”r
, "%02x", 
pkt
[
i
]);

501 
	`årštf
(
¡d”r
, "\n");

503 
tÙPack‘Size
 = 
IP_UDP_HDR_SIZE
 + 
·ck‘Size
;

509 ià(
·ck‘Size
 < 4) ;

510 
¹ıHdr
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
);

511 ià((
¹ıHdr
 & 0xE0FE0000è!ğ(0x80000000 | (
RTCP_PT_SR
<<16)) &&

512 (
¹ıHdr
 & 0xE0FF0000è!ğ(0x80000000 | (
RTCP_PT_APP
<<16))) {

513 #ifdeà
DEBUG


514 
	`årštf
(
¡d”r
, "»jeùed bad RTCP…ack‘: h—d” 0x%08x\n", 
¹ıHdr
);

521 
ty³OfPack‘
 = 
PACKET_UNKNOWN_TYPE
;

522 
»pÜtS’d”SSRC
 = 0;

523 
BoŞ—n
 
·ck‘OK
 = 
F®£
;

525 
u_št8_t
 
rc
 = (
¹ıHdr
>>24)&0x1F;

526 
u_št8_t
 
±
 = (
¹ıHdr
>>16)&0xFF;

527 
Ëngth
 = 4*(
¹ıHdr
&0xFFFF);

528 
	`ADVANCE
(4);

529 ià(
Ëngth
 > 
·ck‘Size
) ;

532 ià(
Ëngth
 < 4) ;†ength -= 4;

533 
»pÜtS’d”SSRC
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

535 
BoŞ—n
 
subPack‘OK
 = 
F®£
;

536 
±
) {

537 
RTCP_PT_SR
: {

538 #ifdeà
DEBUG


539 
	`årštf
(
¡d”r
, "SR\n");

541 ià(
Ëngth
 < 20) ;†ength -= 20;

544 
NTPmsw
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

545 
NTPlsw
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

546 
¹pTime¡amp
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

547 ià(
fSourû
 !ğ
NULL
) {

548 
RTPReû±iÚStsDB
& 
»û±iÚSts


549 ğ
fSourû
->
	`»û±iÚStsDB
();

550 
»û±iÚSts
.
	`nÙeIncomšgSR
(
»pÜtS’d”SSRC
,

551 
NTPmsw
, 
NTPlsw
, 
¹pTime¡amp
);

553 
	`ADVANCE
(8);

556 ià(
fSRHªdËrTask
 !ğ
NULL
è(*fSRHªdËrTask)(
fSRHªdËrCl›ÁD©a
);

560 
RTCP_PT_RR
: {

561 #ifdeà
DEBUG


562 
	`årštf
(
¡d”r
, "RR\n");

564 
»pÜtBlocksSize
 = 
rc
*(6*4);

565 ià(
Ëngth
 < 
»pÜtBlocksSize
) ;

566 
Ëngth
 -ğ
»pÜtBlocksSize
;

568 ià(
fSšk
 !ğ
NULL
) {

570 
RTPT¿nsmissiÚStsDB
& 
ŒªsmissiÚSts
 = 
fSšk
->
	`ŒªsmissiÚStsDB
();

571 
i
 = 0; i < 
rc
; ++i) {

572 
£nd”SSRC
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

574 ià(
£nd”SSRC
 =ğ
fSšk
->
	`SSRC
()) {

575 
lossSts
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

576 
highe¡Reûived
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

577 
j™‹r
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

578 
timeLa¡SR
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

579 
timeSšûLa¡SR
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
); 
	`ADVANCE
(4);

580 
ŒªsmissiÚSts
.
	`nÙeIncomšgRR
(
»pÜtS’d”SSRC
, 
äomAdd»ssAndPÜt
,

581 
lossSts
,

582 
highe¡Reûived
, 
j™‹r
,

583 
timeLa¡SR
, 
timeSšûLa¡SR
);

585 
	`ADVANCE
(4*5);

589 
	`ADVANCE
(
»pÜtBlocksSize
);

592 ià(
±
 =ğ
RTCP_PT_RR
) {

593 
	`nÙeA¼ivšgRR
(
äomAdd»ssAndPÜt
, 
tıSock‘Num
, 
tıSŒ—mChªÃlId
);

596 
subPack‘OK
 = 
True
;

597 
ty³OfPack‘
 = 
PACKET_RTCP_REPORT
;

600 
RTCP_PT_BYE
: {

601 #ifdeà
DEBUG


602 
	`årštf
(
¡d”r
, "BYE\n");

606 ià(
fByeHªdËrTask
 !ğ
NULL


607 && (!
fByeHªdËAùiveP¬ticªtsOÆy


608 || (
fSourû
 !ğ
NULL


609 && 
fSourû
->
	`»û±iÚStsDB
().
	`lookup
(
»pÜtS’d”SSRC
è!ğ
NULL
)

610 || (
fSšk
 !ğ
NULL


611 && 
fSšk
->
	`ŒªsmissiÚStsDB
().
	`lookup
(
»pÜtS’d”SSRC
è!ğ
NULL
))) {

612 
ÿÎByeHªdËr
 = 
True
;

617 
subPack‘OK
 = 
True
;

618 
ty³OfPack‘
 = 
PACKET_BYE
;

621 
RTCP_PT_APP
: {

622 
u_št8_t
& 
subty³
 = 
rc
;

623 #ifdeà
DEBUG


624 
	`årštf
(
¡d”r
, "APP (subty³ 0x%02x)\n", 
subty³
);

626 ià(
Ëngth
 < 4) {

627 #ifdeà
DEBUG


628 
	`årštf
(
¡d”r
, "\tError: No \"name\" field!\n");

632 #ifdeà
DEBUG


633 
	`årštf
(
¡d”r
, "\Šame:%c%c%c%c\n", 
pkt
[0],…kt[1],…kt[2],…kt[3]);

635 
u_št32_t
 
ÇmeBy‹s
 = (
pkt
[0]<<24)|(pkt[1]<<16)|(pkt[2]<<8)|(pkt[3]);

636 
	`ADVANCE
(4);

637 #ifdeà
DEBUG


638 
	`årštf
(
¡d”r
, "\µliÿtiÚ-d•’d’ˆd©¨size: %d by‹s\n", 
Ëngth
);

642 ià(
fAµHªdËrTask
 !ğ
NULL
) {

643 (*
fAµHªdËrTask
)(
fAµHªdËrCl›ÁD©a
, 
subty³
, 
ÇmeBy‹s
, 
pkt
, 
Ëngth
);

645 
subPack‘OK
 = 
True
;

646 
ty³OfPack‘
 = 
PACKET_RTCP_APP
;

650 
RTCP_PT_SDES
: {

651 #ifdeà
DEBUG


653 
	`årštf
(
¡d”r
, "SDES\n");

656 
BoŞ—n
 
chunkOK
 = 
F®£
;

657 
	`ADVANCE
(-4); 
Ëngth
 += 4;

658 
Ëngth
 >= 8) {

659 
chunkOK
 = 
F®£
;

661 
u_št32_t
 
SSRC_CSRC
 = 
	`Áohl
(*(u_št32_t*)
pkt
); 
	`ADVANCE
(4); 
Ëngth
 -= 4;

662 
	`årštf
(
¡d”r
, "\tSSRC/CSRC: 0x%08x\n", 
SSRC_CSRC
);

665 
u_št8_t
 
™emTy³
 = *
pkt
; 
	`ADVANCE
(1); --
Ëngth
;

666 
™emTy³
 != 0) {

667 
™emL’
 = *
pkt
; 
	`ADVANCE
(1); --
Ëngth
;

669 ià(
™emL’
 + 1 > 
Ëngth
 || 
pkt
[itemLen] != 0) ;

671 
	`årštf
(
¡d”r
, "\t\t%s:%s\n",

672 
™emTy³
 == 1 ? "CNAME" :

673 
™emTy³
 == 2 ? "NAME" :

674 
™emTy³
 == 3 ? "EMAIL" :

675 
™emTy³
 == 4 ? "PHONE" :

676 
™emTy³
 == 5 ? "LOC" :

677 
™emTy³
 == 6 ? "TOOL" :

678 
™emTy³
 == 7 ? "NOTE" :

679 
™emTy³
 == 8 ? "PRIV" :

681 
™emTy³
 < 8 ? (*)
pkt


683 
	`ADVANCE
(
™emL’
); 
Ëngth
 -= itemLen;

685 
™emTy³
 = *
pkt
; 
	`ADVANCE
(1); --
Ëngth
;

687 ià(
™emTy³
 != 0) ;

691 
Ëngth
%4 > 0 && *
pkt
 =ğ0è{ 
	`ADVANCE
(1); --length; }

692 ià(
Ëngth
%4 > 0) ;

694 
chunkOK
 = 
True
;

696 ià(!
chunkOK
 || 
Ëngth
 > 0) ;

698 
subPack‘OK
 = 
True
;

701 
RTCP_PT_RTPFB
: {

702 #ifdeà
DEBUG


703 
	`årštf
(
¡d”r
, "RTPFB(unhandled)\n");

705 
subPack‘OK
 = 
True
;

708 
RTCP_PT_PSFB
: {

709 #ifdeà
DEBUG


710 
	`årštf
(
¡d”r
, "PSFB(unhandled)\n");

713 ià(
Ëngth
 >ğ12 && 
pkt
[4] == 'R' &&…kt[5] == 'E' &&…kt[6] == 'M' &&…kt[7] == 'B') {

714 
u_št8_t
 
exp
 = 
pkt
[9]>>2;

715 
u_št32_t
 
mªtis§
 = ((
pkt
[9]&0x03)<<16)|(pkt[10]<<8)|pkt[11];

716 
»mb
 = ()
mªtis§
;

717 
exp
 > 0) {

718 
»mb
 *= 2.0;

719 
exp
 /= 2;

721 
	`årštf
(
¡d”r
, "\tReûiv” E¡im©ed Max B™¿‹ (REMB): %g bps\n", 
»mb
);

724 
subPack‘OK
 = 
True
;

727 
RTCP_PT_XR
: {

728 #ifdeà
DEBUG


729 
	`årštf
(
¡d”r
, "XR(unhandled)\n");

731 
subPack‘OK
 = 
True
;

734 
RTCP_PT_AVB
: {

735 #ifdeà
DEBUG


736 
	`årštf
(
¡d”r
, "AVB(unhandled)\n");

738 
subPack‘OK
 = 
True
;

741 
RTCP_PT_RSI
: {

742 #ifdeà
DEBUG


743 
	`årštf
(
¡d”r
, "RSI(unhandled)\n");

745 
subPack‘OK
 = 
True
;

748 
RTCP_PT_TOKEN
: {

749 #ifdeà
DEBUG


750 
	`årštf
(
¡d”r
, "TOKEN(unhandled)\n");

752 
subPack‘OK
 = 
True
;

755 
RTCP_PT_IDMS
: {

756 #ifdeà
DEBUG


757 
	`årštf
(
¡d”r
, "IDMS(unhandled)\n");

759 
subPack‘OK
 = 
True
;

763 #ifdeà
DEBUG


764 
	`årštf
(
¡d”r
, "UNKNOWN TYPE(0x%x)\n", 
±
);

766 
subPack‘OK
 = 
True
;

770 ià(!
subPack‘OK
) ;

774 #ifdeà
DEBUG


775 
	`årštf
(
¡d”r
, "v®id©ed RTCP sub·ck‘:„c:%d,…t:%d, by‹ »maššg:%d,„•Üˆ£nd” SSRC:0x%08x\n", 
rc
, 
±
, 
Ëngth
, 
»pÜtS’d”SSRC
);

779 
	`ADVANCE
(
Ëngth
);

782 ià(
·ck‘Size
 == 0) {

783 
·ck‘OK
 = 
True
;

785 } ià(
·ck‘Size
 < 4) {

786 #ifdeà
DEBUG


787 
	`årštf
(
¡d”r
, "exŒªeou %d by‹ ©ƒnd oàRTCP…ack‘!\n", 
·ck‘Size
);

791 
¹ıHdr
 = 
	`Áohl
(*(
u_št32_t
*)
pkt
);

792 ià((
¹ıHdr
 & 0xC0000000) != 0x80000000) {

793 #ifdeà
DEBUG


794 
	`årštf
(
¡d”r
, "bad RTCP sub·ck‘: h—d” 0x%08x\n", 
¹ıHdr
);

800 ià(!
·ck‘OK
) {

801 #ifdeà
DEBUG


802 
	`årštf
(
¡d”r
, "»jeùed bad RTCP sub·ck‘: h—d” 0x%08x\n", 
¹ıHdr
);

806 #ifdeà
DEBUG


807 
	`årštf
(
¡d”r
, "validatedƒntire RTCP…acket\n");

811 
	`ÚReûive
(
ty³OfPack‘
, 
tÙPack‘Size
, 
»pÜtS’d”SSRC
);

814 ià(
ÿÎByeHªdËr
 && 
fByeHªdËrTask
 !ğ
NULL
 ) {

815 
TaskFunc
* 
byeHªdËr
 = 
fByeHªdËrTask
;

816 
fByeHªdËrTask
 = 
NULL
;

817 (*
byeHªdËr
)(
fByeHªdËrCl›ÁD©a
);

820 
	}
}

822 
	gRTCPIn¡ªû
::
	$ÚReûive
(
ty³OfPack‘
, 
tÙPack‘Size
,

823 
s¤c
) {

824 
fTy³OfPack‘
 = 
ty³OfPack‘
;

825 
fLa¡ReûivedSize
 = 
tÙPack‘Size
;

826 
fLa¡ReûivedSSRC
 = 
s¤c
;

828 
memb”s
 = ()
	`numMemb”s
();

829 
£nd”s
 = (
fSšk
 !ğ
NULL
) ? 1 : 0;

831 
	`OnReûive
(
this
,

832 
this
,

833 &
memb”s
,

834 &
fP»vNumMemb”s
,

835 &
£nd”s
,

836 &
fAveRTCPSize
,

837 &
fP»vR•ÜtTime
,

838 
	`dTimeNow
(),

839 
fNextR•ÜtTime
);

840 
	}
}

842 
	gRTCPIn¡ªû
::
	$£ndR•Üt
() {

843 #ifdeà
DEBUG


844 
	`årštf
(
¡d”r
, "sending REPORT\n");

847 ià(!
	`addR•Üt
()) ;

850 
	`addSDES
();

853 
	`£ndButPack‘
();

856 cÚ¡ 
memb”shR—pP”iod
 = 5;

857 ià((++
fOutgošgR•ÜtCouÁ
è% 
memb”shR—pP”iod
 == 0) {

858 
th»shŞd
 = 
fOutgošgR•ÜtCouÁ
 - 
memb”shR—pP”iod
;

859 
fKnownMemb”s
->
	`»­OldMemb”s
(
th»shŞd
);

861 
	}
}

863 
	gRTCPIn¡ªû
::
	$£ndBYE
() {

864 #ifdeà
DEBUG


865 
	`årštf
(
¡d”r
, "sending BYE\n");

868 ()
	`addR•Üt
(
True
);

870 
	`addBYE
();

871 
	`£ndButPack‘
();

872 
	}
}

874 
	gRTCPIn¡ªû
::
	$£ndButPack‘
() {

875 #ifdeà
DEBUG


876 
	`årštf
(
¡d”r
, "sending RTCP…acket\n");

877 * 
p
 = 
fOutBuf
->
	`·ck‘
();

878 
i
 = 0; i < 
fOutBuf
->
	`curPack‘Size
(); ++i) {

879 ià(
i
%4 =ğ0è
	`årštf
(
¡d”r
," ");

880 
	`årštf
(
¡d”r
, "%02x", 
p
[
i
]);

882 
	`årštf
(
¡d”r
, "\n");

884 
»pÜtSize
 = 
fOutBuf
->
	`curPack‘Size
();

885 
fRTCPIÁ”çû
.
	`£ndPack‘
(
fOutBuf
->
	`·ck‘
(), 
»pÜtSize
);

886 
fOutBuf
->
	`»£tOff£t
();

888 
fLa¡S’tSize
 = 
IP_UDP_HDR_SIZE
 + 
»pÜtSize
;

889 
fHaveJu¡S’tPack‘
 = 
True
;

890 
fLa¡Pack‘S’tSize
 = 
»pÜtSize
;

891 
	}
}

893 
	gRTCPIn¡ªû
::
	$checkNewSSRC
() {

894  
fKnownMemb”s
->
	`nÙeMemb”sh
(
fLa¡ReûivedSSRC
,

895 
fOutgošgR•ÜtCouÁ
);

896 
	}
}

898 
	gRTCPIn¡ªû
::
	$»moveLa¡ReûivedSSRC
() {

899 
	`»moveSSRC
(
fLa¡ReûivedSSRC
, 
F®£
 );

900 
	}
}

902 
	gRTCPIn¡ªû
::
	$»moveSSRC
(
u_št32_t
 
s¤c
, 
BoŞ—n
 
®soRemoveSts
) {

903 
fKnownMemb”s
->
	`»move
(
s¤c
);

905 ià(
®soRemoveSts
) {

907 ià(
fSourû
 !ğ
NULL
èfSourû->
	`»û±iÚStsDB
().
	`»moveRecÜd
(
s¤c
);

908 ià(
fSšk
 !ğ
NULL
èfSšk->
	`ŒªsmissiÚStsDB
().
	`»moveRecÜd
(
s¤c
);

910 
	}
}

912 
	gRTCPIn¡ªû
::
	$ÚExpœe
(
RTCPIn¡ªû
* 
š¡ªû
) {

913 
š¡ªû
->
	`ÚExpœe1
();

914 
	}
}

918 
BoŞ—n
 
	gRTCPIn¡ªû
::
	$addR•Üt
(
BoŞ—n
 
®waysAdd
) {

920 ià(
fSšk
 !ğ
NULL
) {

921 ià(!
®waysAdd
) {

922 ià(!
fSšk
->
	`’abËRTCPR•Üts
()è 
F®£
;

927 ià(
fSšk
->
	`ÃxtTime¡ampHasB“nP»£t
()è 
F®£
;

930 
	`addSR
();

931 } ià(
fSourû
 !ğ
NULL
) {

932 ià(!
®waysAdd
) {

933 ià(!
fSourû
->
	`’abËRTCPR•Üts
()è 
F®£
;

936 
	`addRR
();

939  
True
;

940 
	}
}

942 
	gRTCPIn¡ªû
::
	$addSR
() {

945 
	`’queueCommÚR•ÜtP»fix
(
RTCP_PT_SR
, 
fSšk
->
	`SSRC
(),

951 
timev®
 
timeNow
;

952 
	`g‘timeofday
(&
timeNow
, 
NULL
);

953 
fOutBuf
->
	`’queueWÜd
(
timeNow
.
tv_£c
 + 0x83AA7E80);

955 
äaùiÚ®P¬t
 = (
timeNow
.
tv_u£c
/15625.0)*0x04000000;

956 
fOutBuf
->
	`’queueWÜd
(()(
äaùiÚ®P¬t
+0.5));

958 
¹pTime¡amp
 = 
fSšk
->
	`cÚv”tToRTPTime¡amp
(
timeNow
);

959 
fOutBuf
->
	`’queueWÜd
(
¹pTime¡amp
);

962 
fOutBuf
->
	`’queueWÜd
(
fSšk
->
	`·ck‘CouÁ
());

963 
fOutBuf
->
	`’queueWÜd
(
fSšk
->
	`où‘CouÁ
());

965 
	`’queueCommÚR•ÜtSuffix
();

966 
	}
}

968 
	gRTCPIn¡ªû
::
	$addRR
() {

971 
	`’queueCommÚR•ÜtP»fix
(
RTCP_PT_RR
, 
fSourû
->
	`SSRC
());

972 
	`’queueCommÚR•ÜtSuffix
();

973 
	}
}

975 
	gRTCPIn¡ªû
::
	$’queueCommÚR•ÜtP»fix
(
·ck‘Ty³
,

976 
SSRC
,

977 
numExŒaWÜds
) {

978 
numR•ÜtšgSourûs
;

979 ià(
fSourû
 =ğ
NULL
) {

980 
numR•ÜtšgSourûs
 = 0;

982 
RTPReû±iÚStsDB
& 
®lReû±iÚSts


983 ğ
fSourû
->
	`»û±iÚStsDB
();

984 
numR•ÜtšgSourûs
 = 
®lReû±iÚSts
.
	`numAùiveSourûsSšûLa¡Re£t
();

986 ià(
numR•ÜtšgSourûs
 >= 32) {‚umReportingSources = 32; }

990 
¹ıHdr
 = 0x80000000;

991 
¹ıHdr
 |ğ(
numR•ÜtšgSourûs
<<24);

992 
¹ıHdr
 |ğ(
·ck‘Ty³
<<16);

993 
¹ıHdr
 |ğ(1 + 
numExŒaWÜds
 + 6*
numR•ÜtšgSourûs
);

995 
fOutBuf
->
	`’queueWÜd
(
¹ıHdr
);

997 
fOutBuf
->
	`’queueWÜd
(
SSRC
);

998 
	}
}

1000 
	gRTCPIn¡ªû
::
	$’queueCommÚR•ÜtSuffix
() {

1002 ià(
fSourû
 !ğ
NULL
) {

1003 
RTPReû±iÚStsDB
& 
®lReû±iÚSts


1004 ğ
fSourû
->
	`»û±iÚStsDB
();

1006 
RTPReû±iÚStsDB
::
I‹¿tÜ
 
	`™”©Ü
(
®lReû±iÚSts
);

1008 
RTPReû±iÚSts
* 
»û±iÚSts
 = 
™”©Ü
.
	`Ãxt
();

1009 ià(
»û±iÚSts
 =ğ
NULL
) ;

1010 
	`’queueR•ÜtBlock
(
»û±iÚSts
);

1013 
®lReû±iÚSts
.
	`»£t
();

1015 
	}
}

1018 
	gRTCPIn¡ªû
::
	$’queueR•ÜtBlock
(
RTPReû±iÚSts
* 
¡©s
) {

1019 
fOutBuf
->
	`’queueWÜd
(
¡©s
->
	`SSRC
());

1021 
highe¡ExtSeqNumReûived
 = 
¡©s
->
	`highe¡ExtSeqNumReûived
();

1023 
tÙNumEx³ùed


1024 ğ
highe¡ExtSeqNumReûived
 - 
¡©s
->
	`ba£ExtSeqNumReûived
();

1025 
tÙNumLo¡
 = 
tÙNumEx³ùed
 - 
¡©s
->
	`tÙNumPack‘sReûived
();

1027 ià(
tÙNumLo¡
 > 0x007FFFFF) {

1028 
tÙNumLo¡
 = 0x007FFFFF;

1029 } ià(
tÙNumLo¡
 < 0) {

1030 ià(
tÙNumLo¡
 < -0x00800000)otNumLost = 0x00800000;

1031 
tÙNumLo¡
 &= 0x00FFFFFF;

1034 
numEx³ùedSšûLa¡Re£t


1035 ğ
highe¡ExtSeqNumReûived
 - 
¡©s
->
	`Ï¡Re£tExtSeqNumReûived
();

1036 
numLo¡SšûLa¡Re£t


1037 ğ
numEx³ùedSšûLa¡Re£t
 - 
¡©s
->
	`numPack‘sReûivedSšûLa¡Re£t
();

1038 
lossF¿ùiÚ
;

1039 ià(
numEx³ùedSšûLa¡Re£t
 =ğ0 || 
numLo¡SšûLa¡Re£t
 < 0) {

1040 
lossF¿ùiÚ
 = 0;

1042 
lossF¿ùiÚ
 = ()

1043 ((
numLo¡SšûLa¡Re£t
 << 8è/ 
numEx³ùedSšûLa¡Re£t
);

1046 
fOutBuf
->
	`’queueWÜd
((
lossF¿ùiÚ
<<24è| 
tÙNumLo¡
);

1047 
fOutBuf
->
	`’queueWÜd
(
highe¡ExtSeqNumReûived
);

1049 
fOutBuf
->
	`’queueWÜd
(
¡©s
->
	`j™‹r
());

1051 
NTPmsw
 = 
¡©s
->
	`Ï¡ReûivedSR_NTPmsw
();

1052 
NTPlsw
 = 
¡©s
->
	`Ï¡ReûivedSR_NTPlsw
();

1053 
LSR
 = ((
NTPmsw
&0xFFFF)<<16)|(
NTPlsw
>>16);

1054 
fOutBuf
->
	`’queueWÜd
(
LSR
);

1057 
timev®
 cÚ¡& 
LSRtime
 = 
¡©s
->
	`Ï¡ReûivedSR_time
();

1058 
timev®
 
timeNow
, 
timeSšûLSR
;

1059 
	`g‘timeofday
(&
timeNow
, 
NULL
);

1060 ià(
timeNow
.
tv_u£c
 < 
LSRtime
.tv_usec) {

1061 
timeNow
.
tv_u£c
 += 1000000;

1062 
timeNow
.
tv_£c
 -= 1;

1064 
timeSšûLSR
.
tv_£c
 = 
timeNow
.tv_£ø- 
LSRtime
.tv_sec;

1065 
timeSšûLSR
.
tv_u£c
 = 
timeNow
.tv_u£ø- 
LSRtime
.tv_usec;

1068 
DLSR
;

1069 ià(
LSR
 == 0) {

1070 
DLSR
 = 0;

1072 
DLSR
 = (
timeSšûLSR
.
tv_£c
<<16)

1073 | ( (((
timeSšûLSR
.
tv_u£c
<<11)+15625)/31250) & 0xFFFF);

1075 
fOutBuf
->
	`’queueWÜd
(
DLSR
);

1076 
	}
}

1078 
	gRTCPIn¡ªû
::
	$addSDES
() {

1082 
numBy‹s
 = 4;

1084 
numBy‹s
 +ğ
fCNAME
.
	`tÙ®Size
();

1085 
numBy‹s
 += 1;

1087 
num4By‹WÜds
 = (
numBy‹s
 + 3)/4;

1089 
¹ıHdr
 = 0x81000000;

1090 
¹ıHdr
 |ğ(
RTCP_PT_SDES
<<16);

1091 
¹ıHdr
 |ğ
num4By‹WÜds
;

1092 
fOutBuf
->
	`’queueWÜd
(
¹ıHdr
);

1094 ià(
fSourû
 !ğ
NULL
) {

1095 
fOutBuf
->
	`’queueWÜd
(
fSourû
->
	`SSRC
());

1096 } ià(
fSšk
 !ğ
NULL
) {

1097 
fOutBuf
->
	`’queueWÜd
(
fSšk
->
	`SSRC
());

1101 
fOutBuf
->
	`’queue
(
fCNAME
.
	`d©a
(), fCNAME.
	`tÙ®Size
());

1104 
numPaddšgBy‹sN“ded
 = 4 - (
fOutBuf
->
	`curPack‘Size
() % 4);

1105 cÚ¡ 
z”o
 = '\0';

1106 
numPaddšgBy‹sN“ded
-- > 0è
fOutBuf
->
	`’queue
(&
z”o
, 1);

1107 
	}
}

1109 
	gRTCPIn¡ªû
::
	$addBYE
() {

1110 
¹ıHdr
 = 0x81000000;

1111 
¹ıHdr
 |ğ(
RTCP_PT_BYE
<<16);

1112 
¹ıHdr
 |= 1;

1113 
fOutBuf
->
	`’queueWÜd
(
¹ıHdr
);

1115 ià(
fSourû
 !ğ
NULL
) {

1116 
fOutBuf
->
	`’queueWÜd
(
fSourû
->
	`SSRC
());

1117 } ià(
fSšk
 !ğ
NULL
) {

1118 
fOutBuf
->
	`’queueWÜd
(
fSšk
->
	`SSRC
());

1120 
	}
}

1122 
	gRTCPIn¡ªû
::
	$scheduË
(
ÃxtTime
) {

1123 
fNextR•ÜtTime
 = 
ÃxtTime
;

1125 
£cÚdsToD–ay
 = 
ÃxtTime
 - 
	`dTimeNow
();

1126 ià(
£cÚdsToD–ay
 < 0) secondsToDelay = 0;

1127 #ifdeà
DEBUG


1128 
	`årštf
(
¡d”r
, "scheduË(%f->%f)\n", 
£cÚdsToD–ay
, 
ÃxtTime
);

1130 
št64_t
 
usToGo
 = (št64_t)(
£cÚdsToD–ay
 * 1000000);

1131 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
usToGo
,

1132 (
TaskFunc
*)
RTCPIn¡ªû
::
ÚExpœe
, 
this
);

1133 
	}
}

1135 
	gRTCPIn¡ªû
::
	$»scheduË
(
ÃxtTime
) {

1136 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

1137 
	`scheduË
(
ÃxtTime
);

1138 
	}
}

1140 
	gRTCPIn¡ªû
::
	$ÚExpœe1
() {

1142 
¹ıBW
 = 0.05*
fTÙSessiÚBW
*1024/8;

1144 
	`OnExpœe
(
this
,

1145 
	`numMemb”s
(),

1146 (
fSšk
 !ğ
NULL
) ? 1 : 0,

1147 
¹ıBW
,

1148 (
fSšk
 !ğ
NULL
) ? 1 : 0,

1149 &
fAveRTCPSize
,

1150 &
fIsIn™Ÿl
,

1151 
	`dTimeNow
(),

1152 &
fP»vR•ÜtTime
,

1153 &
fP»vNumMemb”s


1155 
	}
}

1159 
	gSDESI‹m
::
	$SDESI‹m
(
g
, cÚ¡* 
v®ue
) {

1160 
Ëngth
 = 
	`¡¾’
((cÚ¡*)
v®ue
);

1161 ià(
Ëngth
 > 0xFF)†ength = 0xFF;

1163 
fD©a
[0] = 
g
;

1164 
fD©a
[1] = ()
Ëngth
;

1165 
	`memmove
(&
fD©a
[2], 
v®ue
, 
Ëngth
);

1166 
	}
}

1168 
	gSDESI‹m
::
	$tÙ®Size
() const {

1169  2 + ()
fD©a
[1];

1170 
	}
}

1175 "C" 
	$ScheduË
(
ÃxtTime
, 
ev’t
 
e
) {

1176 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
e
;

1177 ià(
š¡ªû
 =ğ
NULL
) ;

1179 
š¡ªû
->
	`scheduË
(
ÃxtTime
);

1180 
	}
}

1182 "C" 
	$RescheduË
(
ÃxtTime
, 
ev’t
 
e
) {

1183 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
e
;

1184 ià(
š¡ªû
 =ğ
NULL
) ;

1186 
š¡ªû
->
	`»scheduË
(
ÃxtTime
);

1187 
	}
}

1189 "C" 
	$S’dRTCPR•Üt
(
ev’t
 
e
) {

1190 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
e
;

1191 ià(
š¡ªû
 =ğ
NULL
) ;

1193 
š¡ªû
->
	`£ndR•Üt
();

1194 
	}
}

1196 "C" 
	$S’dBYEPack‘
(
ev’t
 
e
) {

1197 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
e
;

1198 ià(
š¡ªû
 =ğ
NULL
) ;

1200 
š¡ªû
->
	`£ndBYE
();

1201 
	}
}

1203 "C" 
	$Ty³OfEv’t
(
ev’t
 
e
) {

1204 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
e
;

1205 ià(
š¡ªû
 =ğ
NULL
è 
EVENT_UNKNOWN
;

1207  
š¡ªû
->
	`ty³OfEv’t
();

1208 
	}
}

1210 "C" 
	$S’tPack‘Size
(
ev’t
 
e
) {

1211 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
e
;

1212 ià(
š¡ªû
 =ğ
NULL
)  0;

1214  
š¡ªû
->
	`£ÁPack‘Size
();

1215 
	}
}

1217 "C" 
	$Pack‘Ty³
(
·ck‘
 
p
) {

1218 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
p
;

1219 ià(
š¡ªû
 =ğ
NULL
è 
PACKET_UNKNOWN_TYPE
;

1221  
š¡ªû
->
	`·ck‘Ty³
();

1222 
	}
}

1224 "C" 
	$ReûivedPack‘Size
(
·ck‘
 
p
) {

1225 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
p
;

1226 ià(
š¡ªû
 =ğ
NULL
)  0;

1228  
š¡ªû
->
	`»ûivedPack‘Size
();

1229 
	}
}

1231 "C" 
	$NewMemb”
(
·ck‘
 
p
) {

1232 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
p
;

1233 ià(
š¡ªû
 =ğ
NULL
)  0;

1235  
š¡ªû
->
	`checkNewSSRC
();

1236 
	}
}

1238 "C" 
	$NewS’d”
(
·ck‘
 ) {

1240 
	}
}

1242 "C" 
	$AddMemb”
(
·ck‘
 ) {

1244 
	}
}

1246 "C" 
	$AddS’d”
(
·ck‘
 ) {

1248 
	}
}

1250 "C" 
	$RemoveMemb”
(
·ck‘
 
p
) {

1251 
RTCPIn¡ªû
* 
š¡ªû
 = (RTCPIn¡ªû*)
p
;

1252 ià(
š¡ªû
 =ğ
NULL
) ;

1254 
š¡ªû
->
	`»moveLa¡ReûivedSSRC
();

1255 
	}
}

1257 "C" 
	$RemoveS’d”
(
·ck‘
 ) {

1259 
	}
}

1261 "C" 
	$d¿nd30
() {

1262 
tmp
 = 
	`our_¿ndom
()&0x3FFFFFFF;

1263  
tmp
/()(1024*1024*1024);

1264 
	}
}

	@liveMedia/RTPInterface.cpp

23 
	~"RTPIÁ”çû.hh
"

24 
	~<GroupsockH–³r.hh
>

25 
	~<¡dio.h
>

37 
HashTabË
* 
	$sock‘HashTabË
(
U§geEnvœÚm’t
& 
’v
, 
BoŞ—n
 
ü—‹IfNÙP»£Á
 = 
True
) {

38 
_TabËs
* 
ourTabËs
 = _TabËs::
	`g‘OurTabËs
(
’v
, 
ü—‹IfNÙP»£Á
);

39 ià(
ourTabËs
 =ğ
NULL
)  NULL;

41 ià(
ourTabËs
->
sock‘TabË
 =ğ
NULL
) {

43 
ourTabËs
->
sock‘TabË
 = 
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
);

45  (
HashTabË
*)(
ourTabËs
->
sock‘TabË
);

46 
	}
}

48 şas 
	cSock‘DesütÜ
 {

49 
	mpublic
:

50 
Sock‘DesütÜ
(
U§geEnvœÚm’t
& 
’v
, 
sock‘Num
);

51 
	mvœtu®
 ~
Sock‘DesütÜ
();

53 
»gi¡”RTPIÁ”çû
(
¡»amChªÃlId
,

54 
RTPIÁ”çû
* 
¹pIÁ”çû
);

55 
RTPIÁ”çû
* 
lookupRTPIÁ”çû
(
¡»amChªÃlId
);

56 
d”egi¡”RTPIÁ”çû
(
¡»amChªÃlId
);

58 
	$£tS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* 
hªdËr
, * 
ş›ÁD©a
) {

59 
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
 = 
hªdËr
;

60 
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
 = 
ş›ÁD©a
;

63 
´iv©e
:

64 
	`tıR—dHªdËr
(
Sock‘DesütÜ
*, 
mask
);

65 
BoŞ—n
 
	`tıR—dHªdËr1
(
mask
);

67 
´iv©e
:

68 
U§geEnvœÚm’t
& 
fEnv
;

69 
fOurSock‘Num
;

70 
HashTabË
* 
fSubChªÃlHashTabË
;

71 
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* 
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
;

72 * 
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
;

73 
u_št8_t
 
fSŒ—mChªÃlId
, 
fSizeBy‹1
;

74 
BoŞ—n
 
fR—dE¼ÜOccu¼ed
, 
fD–‘eMy£lfNext
, 
fA»InR—dHªdËrLoİ
;

75 ’um { 
AWAITING_DOLLAR
, 
AWAITING_STREAM_CHANNEL_ID
, 
AWAITING_SIZE1
, 
AWAITING_SIZE2
, 
AWAITING_PACKET_DATA
 
	}
} 
	gfTCPR—dšgS‹
;

78 
Sock‘DesütÜ
* 
	$lookupSock‘DesütÜ
(
U§geEnvœÚm’t
& 
’v
, 
sockNum
, 
BoŞ—n
 
ü—‹IfNÙFound
 = 
True
) {

79 
HashTabË
* 
bË
 = 
	`sock‘HashTabË
(
’v
, 
ü—‹IfNÙFound
);

80 ià(
bË
 =ğ
NULL
)  NULL;

82 cÚ¡* 
key
 = (cÚ¡*)()
sockNum
;

83 
Sock‘DesütÜ
* 
sock‘DesütÜ
 = (Sock‘DesütÜ*)(
bË
->
	`Lookup
(
key
));

84 ià(
sock‘DesütÜ
 =ğ
NULL
) {

85 ià(
ü—‹IfNÙFound
) {

86 
sock‘DesütÜ
 = 
Ãw
 
	`Sock‘DesütÜ
(
’v
, 
sockNum
);

87 
bË
->
	`Add
((cÚ¡*)()(
sockNum
), 
sock‘DesütÜ
);

88 } ià(
bË
->
	`IsEm±y
()) {

90 
_TabËs
* 
ourTabËs
 = _TabËs::
	`g‘OurTabËs
(
’v
);

91 
d–‘e
 
bË
;

92 
ourTabËs
->
sock‘TabË
 = 
NULL
;

93 
ourTabËs
->
	`»şaimIfPossibË
();

97  
sock‘DesütÜ
;

98 
	}
}

100 
	$»moveSock‘DesütiÚ
(
U§geEnvœÚm’t
& 
’v
, 
sockNum
) {

101 cÚ¡* 
key
 = (cÚ¡*)()
sockNum
;

102 
HashTabË
* 
bË
 = 
	`sock‘HashTabË
(
’v
);

103 
bË
->
	`Remove
(
key
);

105 ià(
bË
->
	`IsEm±y
()) {

107 
_TabËs
* 
ourTabËs
 = _TabËs::
	`g‘OurTabËs
(
’v
);

108 
d–‘e
 
bË
;

109 
ourTabËs
->
sock‘TabË
 = 
NULL
;

110 
ourTabËs
->
	`»şaimIfPossibË
();

112 
	}
}

117 
	gRTPIÁ”çû
::
	$RTPIÁ”çû
(
Medium
* 
owÃr
, 
Groupsock
* 
gs
)

118 : 
	`fOwÃr
(
owÃr
), 
	`fGS
(
gs
),

119 
	`fTCPSŒ—ms
(
NULL
),

120 
	`fNextTCPR—dSize
(0), 
	`fNextTCPR—dSŒ—mSock‘Num
(-1),

121 
	`fNextTCPR—dSŒ—mChªÃlId
(0xFF), 
	`fR—dHªdËrProc
(
NULL
),

122 
	`fAuxR—dHªdËrFunc
(
NULL
), 
	$fAuxR—dHªdËrCl›ÁD©a
(
NULL
) {

127 
	`makeSock‘NÚBlockšg
(
fGS
->
	`sock‘Num
());

128 
	`šü—£S’dBufãrTo
(
	`’vœ
(), 
fGS
->
	`sock‘Num
(), 50*1024);

129 
	}
}

131 
	gRTPIÁ”çû
::~
	$RTPIÁ”çû
() {

132 
	`¡İN‘wÜkR—dšg
();

133 
d–‘e
 
fTCPSŒ—ms
;

134 
	}
}

136 
	gRTPIÁ”çû
::
	$£tSŒ—mSock‘
(
sockNum
,

137 
¡»amChªÃlId
) {

138 
fGS
->
	`»moveAÎDe¡š©iÚs
();

139 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fGS
->
	`sock‘Num
());

140 
fGS
->
	`»£t
();

142 
	`addSŒ—mSock‘
(
sockNum
, 
¡»amChªÃlId
);

143 
	}
}

145 
	gRTPIÁ”çû
::
	$addSŒ—mSock‘
(
sockNum
,

146 
¡»amChªÃlId
) {

147 ià(
sockNum
 < 0) ;

149 
tıSŒ—mRecÜd
* 
¡»ams
 = 
fTCPSŒ—ms
; sŒ—m !ğ
NULL
;

150 
¡»ams
 = sŒ—ms->
fNext
) {

151 ià(
¡»ams
->
fSŒ—mSock‘Num
 =ğ
sockNum


152 && 
¡»ams
->
fSŒ—mChªÃlId
 =ğ
¡»amChªÃlId
) {

157 
fTCPSŒ—ms
 = 
Ãw
 
	`tıSŒ—mRecÜd
(
sockNum
, 
¡»amChªÃlId
, fTCPStreams);

160 
Sock‘DesütÜ
* 
sock‘DesütÜ
 = 
	`lookupSock‘DesütÜ
(
	`’vœ
(), 
sockNum
);

161 
sock‘DesütÜ
->
	`»gi¡”RTPIÁ”çû
(
¡»amChªÃlId
, 
this
);

162 
	}
}

164 
	$d”egi¡”Sock‘
(
U§geEnvœÚm’t
& 
’v
, 
sockNum
, 
¡»amChªÃlId
) {

165 
Sock‘DesütÜ
* 
sock‘DesütÜ
 = 
	`lookupSock‘DesütÜ
(
’v
, 
sockNum
, 
F®£
);

166 ià(
sock‘DesütÜ
 !ğ
NULL
) {

167 
sock‘DesütÜ
->
	`d”egi¡”RTPIÁ”çû
(
¡»amChªÃlId
);

171 
	}
}

173 
	gRTPIÁ”çû
::
	$»moveSŒ—mSock‘
(
sockNum
,

174 
¡»amChªÃlId
) {

176 
tıSŒ—mRecÜd
** 
¡»amsPŒ
 = &
fTCPSŒ—ms
;

178 *
¡»amsPŒ
 !ğ
NULL
) {

179 ià((*
¡»amsPŒ
)->
fSŒ—mSock‘Num
 =ğ
sockNum


180 && (
¡»amChªÃlId
 =ğ0xFF || sŒ—mChªÃlId =ğ(*
¡»amsPŒ
)->
fSŒ—mChªÃlId
)) {

182 
tıSŒ—mRecÜd
* 
Ãxt
 = (*
¡»amsPŒ
)->
fNext
;

183 (*
¡»amsPŒ
)->
fNext
 = 
NULL
;

184 
	`d–‘e
 (*
¡»amsPŒ
);

185 *
¡»amsPŒ
 = 
Ãxt
;

188 
	`d”egi¡”Sock‘
(
	`’vœ
(), 
sockNum
, 
¡»amChªÃlId
);

190 ià(
¡»amChªÃlId
 != 0xFF) ;

193 
¡»amsPŒ
 = &((*¡»amsPŒ)->
fNext
);

196 ià(*
¡»amsPŒ
 =ğ
NULL
) ;

198 
	}
}

200 
	gRTPIÁ”çû
::
	$£tS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
U§geEnvœÚm’t
& 
’v
, 
sock‘Num
,

201 
S”v”Reque¡AÉ”ÇtiveBy‹HªdËr
* 
hªdËr
, * 
ş›ÁD©a
) {

202 
Sock‘DesütÜ
* 
sock‘DesütÜ
 = 
	`lookupSock‘DesütÜ
(
’v
, 
sock‘Num
, 
F®£
);

204 ià(
sock‘DesütÜ
 !ğ
NULL
èsock‘DesütÜ->
	`£tS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
hªdËr
, 
ş›ÁD©a
);

205 
	}
}

207 
	gRTPIÁ”çû
::
	$ş—rS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
U§geEnvœÚm’t
& 
’v
, 
sock‘Num
) {

208 
	`£tS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
’v
, 
sock‘Num
, 
NULL
, NULL);

209 
	}
}

211 
BoŞ—n
 
	gRTPIÁ”çû
::
	$£ndPack‘
(* 
·ck‘
, 
·ck‘Size
) {

212 
BoŞ—n
 
sucûss
 = 
True
;

215 ià(!
fGS
->
	`ouut
(
	`’vœ
(), 
·ck‘
, 
·ck‘Size
)è
sucûss
 = 
F®£
;

218 
tıSŒ—mRecÜd
* 
ÃxtSŒ—m
;

219 
tıSŒ—mRecÜd
* 
¡»am
 = 
fTCPSŒ—ms
; sŒ—m !ğ
NULL
; sŒ—m = 
ÃxtSŒ—m
) {

220 
ÃxtSŒ—m
 = 
¡»am
->
fNext
;

221 ià(!
	`£ndRTPÜRTCPPack‘Ov”TCP
(
·ck‘
, 
·ck‘Size
,

222 
¡»am
->
fSŒ—mSock‘Num
, sŒ—m->
fSŒ—mChªÃlId
)) {

223 
sucûss
 = 
F®£
;

227  
sucûss
;

228 
	}
}

230 
	gRTPIÁ”çû


231 ::
¡¬tN‘wÜkR—dšg
(
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËrProc
) {

233 
’vœ
().
skScheduËr
().

234 
tuºOnBackgroundR—dHªdlšg
(
fGS
->
sock‘Num
(), 
hªdËrProc
, 
fOwÃr
);

237 
	gfR—dHªdËrProc
 = 
hªdËrProc
;

238 
tıSŒ—mRecÜd
* 
	g¡»ams
 = 
fTCPSŒ—ms
; sŒ—m !ğ
NULL
;

239 
	g¡»ams
 = 
¡»ams
->
fNext
) {

241 
Sock‘DesütÜ
* 
sock‘DesütÜ
 = 
lookupSock‘DesütÜ
(
’vœ
(), 
¡»ams
->
fSŒ—mSock‘Num
);

244 
	gsock‘DesütÜ
->
»gi¡”RTPIÁ”çû
(
¡»ams
->
fSŒ—mChªÃlId
, 
this
);

248 
BoŞ—n
 
	gRTPIÁ”çû
::
	$hªdËR—d
(* 
bufãr
, 
bufãrMaxSize
,

249 & 
by‹sR—d
, 
sockaddr_š
& 
äomAdd»ss
,

250 & 
tıSock‘Num
, & 
tıSŒ—mChªÃlId
,

251 
BoŞ—n
& 
·ck‘R—dWasIncom¶‘e
) {

252 
·ck‘R—dWasIncom¶‘e
 = 
F®£
;

253 
BoŞ—n
 
»adSucûss
;

254 ià(
fNextTCPR—dSŒ—mSock‘Num
 < 0) {

256 
tıSock‘Num
 = -1;

257 
»adSucûss
 = 
fGS
->
	`hªdËR—d
(
bufãr
, 
bufãrMaxSize
, 
by‹sR—d
, 
äomAdd»ss
);

260 
tıSock‘Num
 = 
fNextTCPR—dSŒ—mSock‘Num
;

261 
tıSŒ—mChªÃlId
 = 
fNextTCPR—dSŒ—mChªÃlId
;

263 
by‹sR—d
 = 0;

264 
tÙBy‹sToR—d
 = 
fNextTCPR—dSize
;

265 ià(
tÙBy‹sToR—d
 > 
bufãrMaxSize
)otBytesToRead = bufferMaxSize;

266 
curBy‹sToR—d
 = 
tÙBy‹sToR—d
;

267 
curBy‹sR—d
;

268 (
curBy‹sR—d
 = 
	`»adSock‘
(
	`’vœ
(), 
fNextTCPR—dSŒ—mSock‘Num
,

269 &
bufãr
[
by‹sR—d
], 
curBy‹sToR—d
,

270 
äomAdd»ss
)) > 0) {

271 
by‹sR—d
 +ğ
curBy‹sR—d
;

272 ià(
by‹sR—d
 >ğ
tÙBy‹sToR—d
) ;

273 
curBy‹sToR—d
 -ğ
curBy‹sR—d
;

275 
fNextTCPR—dSize
 -ğ
by‹sR—d
;

276 ià(
fNextTCPR—dSize
 == 0) {

278 
»adSucûss
 = 
True
;

279 } ià(
curBy‹sR—d
 < 0) {

281 
by‹sR—d
 = 0;

282 
»adSucûss
 = 
F®£
;

285 
·ck‘R—dWasIncom¶‘e
 = 
True
;

286  
True
;

288 
fNextTCPR—dSŒ—mSock‘Num
 = -1;

291 ià(
»adSucûss
 && 
fAuxR—dHªdËrFunc
 !ğ
NULL
) {

293 (*
fAuxR—dHªdËrFunc
)(
fAuxR—dHªdËrCl›ÁD©a
, 
bufãr
, 
by‹sR—d
);

295  
»adSucûss
;

296 
	}
}

298 
	gRTPIÁ”çû
::
	$¡İN‘wÜkR—dšg
() {

300 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fGS
->
	`sock‘Num
());

303 
tıSŒ—mRecÜd
* 
¡»ams
 = 
fTCPSŒ—ms
; sŒ—m !ğ
NULL
; sŒ—m ğ¡»ams->
fNext
) {

304 
	`d”egi¡”Sock‘
(
	`’vœ
(), 
¡»ams
->
fSŒ—mSock‘Num
, sŒ—ms->
fSŒ—mChªÃlId
);

306 
	}
}

311 
BoŞ—n
 
	gRTPIÁ”çû
::
	$£ndRTPÜRTCPPack‘Ov”TCP
(
u_št8_t
* 
·ck‘
, 
·ck‘Size
,

312 
sock‘Num
, 
¡»amChªÃlId
) {

313 #ifdeà
DEBUG_SEND


314 
	`årštf
(
¡d”r
, "sendRTPorRTCPPacketOverTCP: %d bytes over channel %d (socket %d)\n",

315 
·ck‘Size
, 
¡»amChªÃlId
, 
sock‘Num
); 
	`fæush
(
¡d”r
);

323 
u_št8_t
 
äamšgH—d”
[4];

324 
äamšgH—d”
[0] = '$';

325 
äamšgH—d”
[1] = 
¡»amChªÃlId
;

326 
äamšgH—d”
[2] = (
u_št8_t
è((
·ck‘Size
&0xFF00)>>8);

327 
äamšgH—d”
[3] = (
u_št8_t
è(
·ck‘Size
&0xFF);

328 ià(!
	`£ndD©aOv”TCP
(
sock‘Num
, 
äamšgH—d”
, 4, 
F®£
)) ;

330 ià(!
	`£ndD©aOv”TCP
(
sock‘Num
, 
·ck‘
, 
·ck‘Size
, 
True
)) ;

331 #ifdeà
DEBUG_SEND


332 
	`årštf
(
¡d”r
, "£ndRTPÜRTCPPack‘Ov”TCP: com¶‘ed\n"); 
	`fæush
(stderr);

335  
True
;

338 #ifdeà
DEBUG_SEND


339 
	`årštf
(
¡d”r
, "£ndRTPÜRTCPPack‘Ov”TCP: faed! (”ºØ%d)\n", 
	`’vœ
().
	`g‘E¼no
()); 
	`fæush
(stderr);

341  
F®£
;

342 
	}
}

344 #iâdeà
RTPINTERFACE_BLOCKING_WRITE_TIMEOUT_MS


345 
	#RTPINTERFACE_BLOCKING_WRITE_TIMEOUT_MS
 500

	)

348 
BoŞ—n
 
	gRTPIÁ”çû
::
	$£ndD©aOv”TCP
(
sock‘Num
, 
u_št8_t
 cÚ¡* 
d©a
, 
d©aSize
, 
BoŞ—n
 
fÜûS’dToSucûed
) {

349 
£ndResuÉ
 = 
	`£nd
(
sock‘Num
, (cÚ¡*)
d©a
, 
d©aSize
, 0 );

350 ià(
£ndResuÉ
 < ()
d©aSize
) {

353 
numBy‹sS’tSoF¬
 = 
£ndResuÉ
 < 0 ? 0 : ()sendResult;

354 ià(
numBy‹sS’tSoF¬
 > 0 || (
fÜûS’dToSucûed
 && 
	`’vœ
().
	`g‘E¼no
(è=ğ
EAGAIN
)) {

358 
numBy‹sRemaššgToS’d
 = 
d©aSize
 - 
numBy‹sS’tSoF¬
;

359 #ifdeà
DEBUG_SEND


360 
	`årštf
(
¡d”r
, "£ndD©aOv”TCP:„e£ndšg %d-by‹ s’d (blockšg)\n", 
numBy‹sRemaššgToS’d
); 
	`fæush
(stderr);

362 
	`makeSock‘Blockšg
(
sock‘Num
, 
RTPINTERFACE_BLOCKING_WRITE_TIMEOUT_MS
);

363 
£ndResuÉ
 = 
	`£nd
(
sock‘Num
, (cÚ¡*)(&
d©a
[
numBy‹sS’tSoF¬
]), 
numBy‹sRemaššgToS’d
, 0 );

364 ià(()
£ndResuÉ
 !ğ
numBy‹sRemaššgToS’d
) {

370 #ifdeà
DEBUG_SEND


371 
	`årštf
(
¡d”r
, "£ndD©aOv”TCP: blockšg s’d(èçed (d–iv”šg %d by‹ ouˆoà%d); closšg sock‘ %d\n", 
£ndResuÉ
, 
numBy‹sRemaššgToS’d
, 
sock‘Num
); 
	`fæush
(stderr);

373 
	`»moveSŒ—mSock‘
(
sock‘Num
, 0xFF);

374  
F®£
;

376 
	`makeSock‘NÚBlockšg
(
sock‘Num
);

378  
True
;

379 } ià(
£ndResuÉ
 < 0 && 
	`’vœ
().
	`g‘E¼no
(è!ğ
EAGAIN
) {

382 
	`»moveSŒ—mSock‘
(
sock‘Num
, 0xFF);

385  
F®£
;

388  
True
;

389 
	}
}

391 
	gSock‘DesütÜ
::
	$Sock‘DesütÜ
(
U§geEnvœÚm’t
& 
’v
, 
sock‘Num
)

392 :
	`fEnv
(
’v
), 
	`fOurSock‘Num
(
sock‘Num
),

393 
	`fSubChªÃlHashTabË
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)),

394 
	`fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
NULL
), 
	`fS”v”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
(NULL),

395 
	`fR—dE¼ÜOccu¼ed
(
F®£
), 
	`fD–‘eMy£lfNext
(F®£), 
	`fA»InR—dHªdËrLoİ
(F®£), 
	$fTCPR—dšgS‹
(
AWAITING_DOLLAR
) {

396 
	}
}

398 
	gSock‘DesütÜ
::~
	$Sock‘DesütÜ
() {

399 
fEnv
.
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fOurSock‘Num
);

400 
	`»moveSock‘DesütiÚ
(
fEnv
, 
fOurSock‘Num
);

402 ià(
fSubChªÃlHashTabË
 !ğ
NULL
) {

404 
HashTabË
::
I‹¿tÜ
* 
™”
 = HashTabË::I‹¿tÜ::
	`ü—‹
(*
fSubChªÃlHashTabË
);

405 
RTPIÁ”çû
* 
¹pIÁ”çû
;

406 cÚ¡* 
key
;

408 (
¹pIÁ”çû
 = (
RTPIÁ”çû
*)(
™”
->
	`Ãxt
(
key
))è!ğ
NULL
) {

409 
u_št64_t
 
¡»amChªÃlIdLÚg
 = (u_št64_t)
key
;

410 
¡»amChªÃlId
 = ()
¡»amChªÃlIdLÚg
;

412 
¹pIÁ”çû
->
	`»moveSŒ—mSock‘
(
fOurSock‘Num
, 
¡»amChªÃlId
);

414 
d–‘e
 
™”
;

417 
fSubChªÃlHashTabË
->
	`RemoveNext
(è!ğ
NULL
) {}

418 
d–‘e
 
fSubChªÃlHashTabË
;

422 ià(
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
 !ğ
NULL
) {

426 
u_št8_t
 
¥ecŸlCh¬
 = 
fR—dE¼ÜOccu¼ed
 ? 0xFF : 0xFE;

427 (*
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
)(
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
, 
¥ecŸlCh¬
);

429 
	}
}

431 
	gSock‘DesütÜ
::
	$»gi¡”RTPIÁ”çû
(
¡»amChªÃlId
,

432 
RTPIÁ”çû
* 
¹pIÁ”çû
) {

433 
BoŞ—n
 
isFœ¡Regi¡¿tiÚ
 = 
fSubChªÃlHashTabË
->
	`IsEm±y
();

434 #ià
	`defšed
(
DEBUG_SEND
)||defšed(
DEBUG_RECEIVE
)

435 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::»gi¡”RTPIÁ”çû(chªÃÈ%d): isFœ¡Regi¡¿tiÚ %d\n", 
fOurSock‘Num
, 
¡»amChªÃlId
, 
isFœ¡Regi¡¿tiÚ
);

437 
fSubChªÃlHashTabË
->
	`Add
((cÚ¡*)()
¡»amChªÃlId
,

438 
¹pIÁ”çû
);

440 ià(
isFœ¡Regi¡¿tiÚ
) {

442 
TaskScheduËr
::
BackgroundHªdËrProc
* 
hªdËr


443 ğ(
TaskScheduËr
::
BackgroundHªdËrProc
*)&
tıR—dHªdËr
;

444 
fEnv
.
	`skScheduËr
().

445 
	`£tBackgroundHªdlšg
(
fOurSock‘Num
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
, 
hªdËr
, 
this
);

447 
	}
}

449 
RTPIÁ”çû
* 
	gSock‘DesütÜ


450 ::
	$lookupRTPIÁ”çû
(
¡»amChªÃlId
) {

451 cÚ¡* 
lookupArg
 = (cÚ¡*)()
¡»amChªÃlId
;

452  (
RTPIÁ”çû
*)(
fSubChªÃlHashTabË
->
	`Lookup
(
lookupArg
));

453 
	}
}

455 
	gSock‘DesütÜ


456 ::
	$d”egi¡”RTPIÁ”çû
(
¡»amChªÃlId
) {

457 #ià
	`defšed
(
DEBUG_SEND
)||defšed(
DEBUG_RECEIVE
)

458 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::d”egi¡”RTPIÁ”çû(chªÃÈ%d)\n", 
fOurSock‘Num
, 
¡»amChªÃlId
);

460 
fSubChªÃlHashTabË
->
	`Remove
((cÚ¡*)()
¡»amChªÃlId
);

462 ià(
fSubChªÃlHashTabË
->
	`IsEm±y
(è|| 
¡»amChªÃlId
 == 0xFF) {

464 ià(
fA»InR—dHªdËrLoİ
) {

465 
fD–‘eMy£lfNext
 = 
True
;

467 
d–‘e
 
this
;

470 
	}
}

472 
	gSock‘DesütÜ
::
	$tıR—dHªdËr
(
Sock‘DesütÜ
* 
sock‘DesütÜ
, 
mask
) {

474 
couÁ
 = 2000;

475 
sock‘DesütÜ
->
fA»InR—dHªdËrLoİ
 = 
True
;

476 !
sock‘DesütÜ
->
fD–‘eMy£lfNext
 && sock‘DesütÜ->
	`tıR—dHªdËr1
(
mask
è&& --
couÁ
 > 0) {}

477 
sock‘DesütÜ
->
fA»InR—dHªdËrLoİ
 = 
F®£
;

478 ià(
sock‘DesütÜ
->
fD–‘eMy£lfNext
è
d–‘e
 socketDescriptor;

479 
	}
}

481 
BoŞ—n
 
	gSock‘DesütÜ
::
	$tıR—dHªdËr1
(
mask
) {

490 
u_št8_t
 
c
;

491 
sockaddr_š
 
äomAdd»ss
;

492 ià(
fTCPR—dšgS‹
 !ğ
AWAITING_PACKET_DATA
) {

493 
»suÉ
 = 
	`»adSock‘
(
fEnv
, 
fOurSock‘Num
, &
c
, 1, 
äomAdd»ss
);

494 ià(
»suÉ
 == 0) {

495  
F®£
;

496 } ià(
»suÉ
 != 1) {

497 #ifdeà
DEBUG_RECEIVE


498 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr():„—dSock‘(1 by‹è»tuºed %d (”rÜ)\n", 
fOurSock‘Num
, 
»suÉ
);

500 
fR—dE¼ÜOccu¼ed
 = 
True
;

501 
fD–‘eMy£lfNext
 = 
True
;

502  
F®£
;

506 
BoŞ—n
 
ÿÎAgaš
 = 
True
;

507 
fTCPR—dšgS‹
) {

508 
AWAITING_DOLLAR
: {

509 ià(
c
 == '$') {

510 #ifdeà
DEBUG_RECEIVE


511 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr(): Saw '$'\n", 
fOurSock‘Num
);

513 
fTCPR—dšgS‹
 = 
AWAITING_STREAM_CHANNEL_ID
;

516 ià(
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
 !ğ
NULL
 && 
c
 != 0xFF && c != 0xFE) {

518 (*
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
)(
fS”v”Reque¡AÉ”ÇtiveBy‹HªdËrCl›ÁD©a
, 
c
);

523 
AWAITING_STREAM_CHANNEL_ID
: {

525 ià(
	`lookupRTPIÁ”çû
(
c
è!ğ
NULL
) {

526 
fSŒ—mChªÃlId
 = 
c
;

527 
fTCPR—dšgS‹
 = 
AWAITING_SIZE1
;

530 #ifdeà
DEBUG_RECEIVE


531 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr(): Saw‚Úexi¡’ˆ¡»am chªÃÈid: 0x%02x\n", 
fOurSock‘Num
, 
c
);

533 
fTCPR—dšgS‹
 = 
AWAITING_DOLLAR
;

537 
AWAITING_SIZE1
: {

539 
fSizeBy‹1
 = 
c
;

540 
fTCPR—dšgS‹
 = 
AWAITING_SIZE2
;

543 
AWAITING_SIZE2
: {

545 
size
 = (
fSizeBy‹1
<<8)|
c
;

548 
RTPIÁ”çû
* 
¹pIÁ”çû
 = 
	`lookupRTPIÁ”çû
(
fSŒ—mChªÃlId
);

549 ià(
¹pIÁ”çû
 !ğ
NULL
) {

550 
¹pIÁ”çû
->
fNextTCPR—dSize
 = 
size
;

551 
¹pIÁ”çû
->
fNextTCPR—dSŒ—mSock‘Num
 = 
fOurSock‘Num
;

552 
¹pIÁ”çû
->
fNextTCPR—dSŒ—mChªÃlId
 = 
fSŒ—mChªÃlId
;

554 
fTCPR—dšgS‹
 = 
AWAITING_PACKET_DATA
;

557 
AWAITING_PACKET_DATA
: {

558 
ÿÎAgaš
 = 
F®£
;

559 
fTCPR—dšgS‹
 = 
AWAITING_DOLLAR
;

561 
RTPIÁ”çû
* 
¹pIÁ”çû
 = 
	`lookupRTPIÁ”çû
(
fSŒ—mChªÃlId
);

562 ià(
¹pIÁ”çû
 !ğ
NULL
) {

563 ià(
¹pIÁ”çû
->
fNextTCPR—dSize
 == 0) {

567 ià(
¹pIÁ”çû
->
fR—dHªdËrProc
 !ğ
NULL
) {

568 #ifdeà
DEBUG_RECEIVE


569 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr():„—dšg %d by‹ Ú chªÃÈ%d\n", 
fOurSock‘Num
, 
¹pIÁ”çû
->
fNextTCPR—dSize
,„IÁ”çû->
fNextTCPR—dSŒ—mChªÃlId
);

571 
fTCPR—dšgS‹
 = 
AWAITING_PACKET_DATA
;

572 
¹pIÁ”çû
->
	`fR—dHªdËrProc
ÔIÁ”çû->
fOwÃr
, 
mask
);

574 #ifdeà
DEBUG_RECEIVE


575 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr(): NØhªdË¸´oøfÜ \"¹pIÁ”çû\" fÜ chªÃÈ%d;‚“dØsk %d„emaššg by‹s\n", 
fOurSock‘Num
, 
fSŒ—mChªÃlId
, 
¹pIÁ”çû
->
fNextTCPR—dSize
);

577 
»suÉ
 = 
	`»adSock‘
(
fEnv
, 
fOurSock‘Num
, &
c
, 1, 
äomAdd»ss
);

578 ià(
»suÉ
 < 0) {

579 #ifdeà
DEBUG_RECEIVE


580 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr():„—dSock‘(1 by‹è»tuºed %d (”rÜ)\n", 
fOurSock‘Num
, 
»suÉ
);

582 
fR—dE¼ÜOccu¼ed
 = 
True
;

583 
fD–‘eMy£lfNext
 = 
True
;

584  
F®£
;

586 
fTCPR—dšgS‹
 = 
AWAITING_PACKET_DATA
;

587 ià(
»suÉ
 == 1) {

588 --
¹pIÁ”çû
->
fNextTCPR—dSize
;

589 
ÿÎAgaš
 = 
True
;

594 #ifdeà
DEBUG_RECEIVE


595 
	`årštf
(
¡d”r
, "Sock‘DesütÜ(sock‘ %d)::tıR—dHªdËr(): NØ\"¹pIÁ”çû\" fÜ chªÃÈ%d\n", 
fOurSock‘Num
, 
fSŒ—mChªÃlId
);

600  
ÿÎAgaš
;

601 
	}
}

606 
	gtıSŒ—mRecÜd


607 ::
	$tıSŒ—mRecÜd
(
¡»amSock‘Num
, 
¡»amChªÃlId
,

608 
tıSŒ—mRecÜd
* 
Ãxt
)

609 : 
	`fNext
(
Ãxt
),

610 
	`fSŒ—mSock‘Num
(
¡»amSock‘Num
), 
	$fSŒ—mChªÃlId
(
¡»amChªÃlId
) {

611 
	}
}

613 
	gtıSŒ—mRecÜd
::~
	$tıSŒ—mRecÜd
() {

614 
d–‘e
 
fNext
;

615 
	}
}

	@liveMedia/RTPSink.cpp

21 
	~"RTPSšk.hh
"

22 
	~"GroupsockH–³r.hh
"

26 
BoŞ—n
 
	gRTPSšk
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
sškName
,

27 
RTPSšk
*& 
»suÉSšk
) {

28 
»suÉSšk
 = 
NULL
;

30 
MedŸSšk
* 
sšk
;

31 ià(!
MedŸSšk
::
	`lookupByName
(
’v
, 
sškName
, 
sšk
)è 
F®£
;

33 ià(!
sšk
->
	`isRTPSšk
()) {

34 
’v
.
	`£tResuÉMsg
(
sškName
, " is‚ot‡ RTP sink");

35  
F®£
;

38 
»suÉSšk
 = (
RTPSšk
*)
sšk
;

39  
True
;

40 
	}
}

42 
BoŞ—n
 
	gRTPSšk
::
	$isRTPSšk
() const {

43  
True
;

44 
	}
}

46 
	gRTPSšk
::
	$RTPSšk
(
U§geEnvœÚm’t
& 
’v
,

47 
Groupsock
* 
¹pGS
, 
¹pPaylßdTy³
,

48 
¹pTime¡ampF»qu’cy
,

49 cÚ¡* 
¹pPaylßdFÜm©Name
,

50 
numChªÃls
)

51 : 
	`MedŸSšk
(
’v
), 
	`fRTPIÁ”çû
(
this
, 
¹pGS
),

52 
	`fRTPPaylßdTy³
(
¹pPaylßdTy³
),

53 
	`fPack‘CouÁ
(0), 
	`fOù‘CouÁ
(0), 
	`fTÙ®Où‘CouÁ
(0),

54 
	`fTime¡ampF»qu’cy
(
¹pTime¡ampF»qu’cy
), 
	`fNextTime¡ampHasB“nP»£t
(
F®£
), 
	`fEÇbËRTCPR•Üts
(
True
),

55 
	`fNumChªÃls
(
numChªÃls
), 
	$fE¡im©edB™¿‹
(0) {

56 
fRTPPaylßdFÜm©Name


57 ğ
	`¡rDup
(
¹pPaylßdFÜm©Name
 =ğ
NULL
 ? "???" :„tpPayloadFormatName);

58 
	`g‘timeofday
(&
fC»©iÚTime
, 
NULL
);

59 
fTÙ®Où‘CouÁS¹Time
 = 
fC»©iÚTime
;

60 
	`»£tP»£Á©iÚTimes
();

62 
fSeqNo
 = (
u_št16_t
)
	`our_¿ndom
();

63 
fSSRC
 = 
	`our_¿ndom32
();

64 
fTime¡ampBa£
 = 
	`our_¿ndom32
();

66 
fT¿nsmissiÚStsDB
 = 
Ãw
 
	`RTPT¿nsmissiÚStsDB
(*
this
);

67 
	}
}

69 
	gRTPSšk
::~
	$RTPSšk
() {

70 
d–‘e
 
fT¿nsmissiÚStsDB
;

71 
d–‘e
[] (*)
fRTPPaylßdFÜm©Name
;

72 
	}
}

74 
u_št32_t
 
	gRTPSšk
::
	$cÚv”tToRTPTime¡amp
(
timev®
 
tv
) {

76 
u_št32_t
 
time¡ampInüem’t
 = (
fTime¡ampF»qu’cy
*
tv
.
tv_£c
);

77 
time¡ampInüem’t
 +ğ(
u_št32_t
)(
fTime¡ampF»qu’cy
*(
tv
.
tv_u£c
/1000000.0) + 0.5);

80 ià(
fNextTime¡ampHasB“nP»£t
) {

83 
fTime¡ampBa£
 -ğ
time¡ampInüem’t
;

84 
fNextTime¡ampHasB“nP»£t
 = 
F®£
;

87 
u_št32_t
 cÚ¡ 
¹pTime¡amp
 = 
fTime¡ampBa£
 + 
time¡ampInüem’t
;

88 #ifdeà
DEBUG_TIMESTAMPS


89 
	`årštf
(
¡d”r
, "fTimestampBase: 0x%08x,v: %lu.%06ld\n\t=> RTPimestamp: 0x%08x\n",

90 
fTime¡ampBa£
, 
tv
.
tv_£c
,v.
tv_u£c
, 
¹pTime¡amp
);

91 
	`fæush
(
¡d”r
);

94  
¹pTime¡amp
;

95 
	}
}

97 
u_št32_t
 
	gRTPSšk
::
	$´e£tNextTime¡amp
() {

98 
timev®
 
timeNow
;

99 
	`g‘timeofday
(&
timeNow
, 
NULL
);

101 
u_št32_t
 
tsNow
 = 
	`cÚv”tToRTPTime¡amp
(
timeNow
);

102 
fTime¡ampBa£
 = 
tsNow
;

103 
fNextTime¡ampHasB“nP»£t
 = 
True
;

105  
tsNow
;

106 
	}
}

108 
	gRTPSšk
::
	$g‘TÙ®B™¿‹
(& 
outNumBy‹s
, & 
outEÏp£dTime
) {

109 
timev®
 
timeNow
;

110 
	`g‘timeofday
(&
timeNow
, 
NULL
);

112 
outNumBy‹s
 = 
fTÙ®Où‘CouÁ
;

113 
outEÏp£dTime
 = ()(
timeNow
.
tv_£c
-
fTÙ®Où‘CouÁS¹Time
.tv_sec)

114 + (
timeNow
.
tv_u£c
-
fTÙ®Où‘CouÁS¹Time
.tv_usec)/1000000.0;

116 
fTÙ®Où‘CouÁ
 = 0;

117 
fTÙ®Où‘CouÁS¹Time
 = 
timeNow
;

118 
	}
}

120 
	gRTPSšk
::
	$»£tP»£Á©iÚTimes
() {

121 
fIn™ŸlP»£Á©iÚTime
.
tv_£c
 = 
fMo¡ReûÁP»£Á©iÚTime
.tv_sec = 0;

122 
fIn™ŸlP»£Á©iÚTime
.
tv_u£c
 = 
fMo¡ReûÁP»£Á©iÚTime
.tv_usec = 0;

123 
	}
}

125 cÚ¡* 
	gRTPSšk
::
	$sdpMedŸTy³
() const {

128 
	}
}

130 * 
	gRTPSšk
::
	$¹pm­Lše
() const {

131 ià(
	`¹pPaylßdTy³
() >= 96) {

132 * 
’codšgP¬amsP¬t
;

133 ià(
	`numChªÃls
() != 1) {

134 
’codšgP¬amsP¬t
 = 
Ãw
 [1 + 20 ];

135 
	`¥rštf
(
’codšgP¬amsP¬t
, "/%d", 
	`numChªÃls
());

137 
’codšgP¬amsP¬t
 = 
	`¡rDup
("");

139 cÚ¡* cÚ¡ 
¹pm­Fmt
 = "a=rtpmap:%d %s/%d%s\r\n";

140 
¹pm­FmtSize
 = 
	`¡¾’
(
¹pm­Fmt
)

141 + 3 + 
	`¡¾’
(
	`¹pPaylßdFÜm©Name
())

142 + 20 + 
	`¡¾’
(
’codšgP¬amsP¬t
);

143 * 
¹pm­Lše
 = 
Ãw
 [
¹pm­FmtSize
];

144 
	`¥rštf
(
¹pm­Lše
, 
¹pm­Fmt
,

145 
	`¹pPaylßdTy³
(), 
	`¹pPaylßdFÜm©Name
(),

146 
	`¹pTime¡ampF»qu’cy
(), 
’codšgP¬amsP¬t
);

147 
d–‘e
[] 
’codšgP¬amsP¬t
;

149  
¹pm­Lše
;

152  
	`¡rDup
("");

154 
	}
}

156 cÚ¡* 
	gRTPSšk
::
	$auxSDPLše
() {

157  
NULL
;

158 
	}
}

163 
	gRTPT¿nsmissiÚStsDB
::
	$RTPT¿nsmissiÚStsDB
(
RTPSšk
& 
¹pSšk
)

164 : 
	`fOurRTPSšk
(
¹pSšk
),

165 
	`fTabË
(
HashTabË
::
	$ü—‹
(
ONE_WORD_HASH_KEYS
)) {

166 
fNumReûiv”s
=0;

167 
	}
}

169 
	gRTPT¿nsmissiÚStsDB
::~
	$RTPT¿nsmissiÚStsDB
() {

171 
RTPT¿nsmissiÚSts
* 
¡©s
;

172 (
¡©s
 = (
RTPT¿nsmissiÚSts
*)
fTabË
->
	`RemoveNext
()è!ğ
NULL
) {

173 
d–‘e
 
¡©s
;

177 
d–‘e
 
fTabË
;

178 
	}
}

180 
	gRTPT¿nsmissiÚStsDB


181 ::
	$nÙeIncomšgRR
(
u_št32_t
 
SSRC
, 
sockaddr_š
 cÚ¡& 
Ï¡FromAdd»ss
,

182 
lossSts
, 
Ï¡Pack‘NumReûived
,

183 
j™‹r
, 
Ï¡SRTime
, 
diffSR_RRTime
) {

184 
RTPT¿nsmissiÚSts
* 
¡©s
 = 
	`lookup
(
SSRC
);

185 ià(
¡©s
 =ğ
NULL
) {

188 
¡©s
 = 
Ãw
 
	`RTPT¿nsmissiÚSts
(
fOurRTPSšk
, 
SSRC
);

189 ià(
¡©s
 =ğ
NULL
) ;

190 
	`add
(
SSRC
, 
¡©s
);

191 #ifdeà
DEBUG_RR


192 
	`årštf
(
¡d”r
, "Addšg‚ewƒÁry fÜ SSRC %x iÀRTPT¿nsmissiÚStsDB\n", 
SSRC
);

196 
¡©s
->
	`nÙeIncomšgRR
(
Ï¡FromAdd»ss
,

197 
lossSts
, 
Ï¡Pack‘NumReûived
, 
j™‹r
,

198 
Ï¡SRTime
, 
diffSR_RRTime
);

199 
	}
}

201 
	gRTPT¿nsmissiÚStsDB
::
	$»moveRecÜd
(
u_št32_t
 
SSRC
) {

202 
RTPT¿nsmissiÚSts
* 
¡©s
 = 
	`lookup
(
SSRC
);

203 ià(
¡©s
 !ğ
NULL
) {

204 
SSRC_lÚg
 = ()
SSRC
;

205 
fTabË
->
	`Remove
((cÚ¡*)
SSRC_lÚg
);

206 --
fNumReûiv”s
;

207 
d–‘e
 
¡©s
;

209 
	}
}

211 
	gRTPT¿nsmissiÚStsDB
::
I‹¿tÜ


212 ::
	$I‹¿tÜ
(
RTPT¿nsmissiÚStsDB
& 
»û±iÚStsDB
)

213 : 
	`fI‹r
(
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*(
»û±iÚStsDB
.
fTabË
))) {

214 
	}
}

216 
RTPT¿nsmissiÚStsDB
::
I‹¿tÜ
::~
	$I‹¿tÜ
() {

217 
d–‘e
 
fI‹r
;

218 
	}
}

220 
RTPT¿nsmissiÚSts
*

221 
	gRTPT¿nsmissiÚStsDB
::
I‹¿tÜ
::
	$Ãxt
() {

222 cÚ¡* 
key
;

224  (
RTPT¿nsmissiÚSts
*)(
fI‹r
->
	`Ãxt
(
key
));

225 
	}
}

227 
RTPT¿nsmissiÚSts
* 
	gRTPT¿nsmissiÚStsDB
::
	$lookup
(
u_št32_t
 
SSRC
) const {

228 
SSRC_lÚg
 = ()
SSRC
;

229  (
RTPT¿nsmissiÚSts
*)(
fTabË
->
	`Lookup
((cÚ¡*)
SSRC_lÚg
));

230 
	}
}

232 
	gRTPT¿nsmissiÚStsDB
::
	$add
(
u_št32_t
 
SSRC
, 
RTPT¿nsmissiÚSts
* 
¡©s
) {

233 
SSRC_lÚg
 = ()
SSRC
;

234 
fTabË
->
	`Add
((cÚ¡*)
SSRC_lÚg
, 
¡©s
);

235 ++
fNumReûiv”s
;

236 
	}
}

241 
	gRTPT¿nsmissiÚSts
::
	$RTPT¿nsmissiÚSts
(
RTPSšk
& 
¹pSšk
, 
u_št32_t
 
SSRC
)

242 : 
	`fOurRTPSšk
(
¹pSšk
), 
	`fSSRC
(
SSRC
), 
	`fLa¡Pack‘NumReûived
(0),

243 
	`fPack‘LossR©io
(0), 
	`fTÙNumPack‘sLo¡
(0), 
	`fJ™‹r
(0),

244 
	`fLa¡SRTime
(0), 
	`fDiffSR_RRTime
(0), 
	`fAtL—¡TwoRRsHaveB“nReûived
(
F®£
), 
	`fFœ¡Pack‘
(
True
),

245 
	`fTÙ®Où‘CouÁ_hi
(0), 
	`fTÙ®Où‘CouÁ_lo
(0),

246 
	`fTÙ®Pack‘CouÁ_hi
(0), 
	$fTÙ®Pack‘CouÁ_lo
(0) {

247 
	`g‘timeofday
(&
fTimeC»©ed
, 
NULL
);

249 
fLa¡Où‘CouÁ
 = 
¹pSšk
.
	`où‘CouÁ
();

250 
fLa¡Pack‘CouÁ
 = 
¹pSšk
.
	`·ck‘CouÁ
();

251 
	}
}

253 
	gRTPT¿nsmissiÚSts
::~
	$RTPT¿nsmissiÚSts
(è{
	}
}

255 
RTPT¿nsmissiÚSts


256 ::
	$nÙeIncomšgRR
(
sockaddr_š
 cÚ¡& 
Ï¡FromAdd»ss
,

257 
lossSts
, 
Ï¡Pack‘NumReûived
,

258 
j™‹r
, 
Ï¡SRTime
,

259 
diffSR_RRTime
) {

260 ià(
fFœ¡Pack‘
) {

261 
fFœ¡Pack‘
 = 
F®£
;

262 
fFœ¡Pack‘NumR•Ü‹d
 = 
Ï¡Pack‘NumReûived
;

264 
fAtL—¡TwoRRsHaveB“nReûived
 = 
True
;

265 
fOldLa¡Pack‘NumReûived
 = 
fLa¡Pack‘NumReûived
;

266 
fOldTÙNumPack‘sLo¡
 = 
fTÙNumPack‘sLo¡
;

268 
	`g‘timeofday
(&
fTimeReûived
, 
NULL
);

270 
fLa¡FromAdd»ss
 = 
Ï¡FromAdd»ss
;

271 
fPack‘LossR©io
 = 
lossSts
>>24;

272 
fTÙNumPack‘sLo¡
 = 
lossSts
&0xFFFFFF;

273 
fLa¡Pack‘NumReûived
 = 
Ï¡Pack‘NumReûived
;

274 
fJ™‹r
 = 
j™‹r
;

275 
fLa¡SRTime
 = 
Ï¡SRTime
;

276 
fDiffSR_RRTime
 = 
diffSR_RRTime
;

277 #ifdeà
DEBUG_RR


278 
	`årštf
(
¡d”r
, "RTCP RR data (received‡t %lu.%06ld):†ossStats 0x%08x,†astPacketNumReceived 0x%08x, jitter 0x%08x,†astSRTime 0x%08x, diffSR_RRTime 0x%08x\n",

279 
fTimeReûived
.
tv_£c
, fTimeReûived.
tv_u£c
, 
lossSts
, 
Ï¡Pack‘NumReûived
, 
j™‹r
, 
Ï¡SRTime
, 
diffSR_RRTime
);

280 
¹d
 = 
	`roundTrD–ay
();

281 
	`årštf
(
¡d”r
, "=>„ound-Œ d–ay: 0x%04x (=ğ%à£cÚds)\n", 
¹d
,„td/65536.0);

286 
u_št32_t
 
ÃwOù‘CouÁ
 = 
fOurRTPSšk
.
	`où‘CouÁ
();

287 
u_št32_t
 
où‘CouÁDiff
 = 
ÃwOù‘CouÁ
 - 
fLa¡Où‘CouÁ
;

288 
fLa¡Où‘CouÁ
 = 
ÃwOù‘CouÁ
;

289 
u_št32_t
 
´evTÙ®Où‘CouÁ_lo
 = 
fTÙ®Où‘CouÁ_lo
;

290 
fTÙ®Où‘CouÁ_lo
 +ğ
où‘CouÁDiff
;

291 ià(
fTÙ®Où‘CouÁ_lo
 < 
´evTÙ®Où‘CouÁ_lo
) {

292 ++
fTÙ®Où‘CouÁ_hi
;

295 
u_št32_t
 
ÃwPack‘CouÁ
 = 
fOurRTPSšk
.
	`·ck‘CouÁ
();

296 
u_št32_t
 
·ck‘CouÁDiff
 = 
ÃwPack‘CouÁ
 - 
fLa¡Pack‘CouÁ
;

297 
fLa¡Pack‘CouÁ
 = 
ÃwPack‘CouÁ
;

298 
u_št32_t
 
´evTÙ®Pack‘CouÁ_lo
 = 
fTÙ®Pack‘CouÁ_lo
;

299 
fTÙ®Pack‘CouÁ_lo
 +ğ
·ck‘CouÁDiff
;

300 ià(
fTÙ®Pack‘CouÁ_lo
 < 
´evTÙ®Pack‘CouÁ_lo
) {

301 ++
fTÙ®Pack‘CouÁ_hi
;

303 
	}
}

305 
	gRTPT¿nsmissiÚSts
::
	$roundTrD–ay
() const {

309 ià(
fLa¡SRTime
 == 0) {

317 
Ï¡ReûivedTimeNTP_high


318 ğ
fTimeReûived
.
tv_£c
 + 0x83AA7E80;

319 
äaùiÚ®P¬t
 = (
fTimeReûived
.
tv_u£c
*0x0400)/15625.0;

320 
Ï¡ReûivedTimeNTP


321 ğ()((
Ï¡ReûivedTimeNTP_high
<<16è+ 
äaùiÚ®P¬t
 + 0.5);

323 
¿wResuÉ
 = 
Ï¡ReûivedTimeNTP
 - 
fLa¡SRTime
 - 
fDiffSR_RRTime
;

324 ià(
¿wResuÉ
 < 0) {

327 
¿wResuÉ
 = 0;

329  ()
¿wResuÉ
;

330 
	}
}

332 
	gRTPT¿nsmissiÚSts
::
	$g‘TÙ®Où‘CouÁ
(
u_št32_t
& 
hi
, u_št32_t& 
lo
) {

333 
hi
 = 
fTÙ®Où‘CouÁ_hi
;

334 
lo
 = 
fTÙ®Où‘CouÁ_lo
;

335 
	}
}

337 
	gRTPT¿nsmissiÚSts
::
	$g‘TÙ®Pack‘CouÁ
(
u_št32_t
& 
hi
, u_št32_t& 
lo
) {

338 
hi
 = 
fTÙ®Pack‘CouÁ_hi
;

339 
lo
 = 
fTÙ®Pack‘CouÁ_lo
;

340 
	}
}

342 
	gRTPT¿nsmissiÚSts
::
	$·ck‘sReûivedSšûLa¡RR
() const {

343 ià(!
fAtL—¡TwoRRsHaveB“nReûived
)  0;

345  
fLa¡Pack‘NumReûived
-
fOldLa¡Pack‘NumReûived
;

346 
	}
}

348 
	gRTPT¿nsmissiÚSts
::
	$·ck‘sLo¡B‘w“nRR
() const {

349 ià(!
fAtL—¡TwoRRsHaveB“nReûived
)  0;

351  
fTÙNumPack‘sLo¡
 - 
fOldTÙNumPack‘sLo¡
;

352 
	}
}

	@liveMedia/RTPSource.cpp

21 
	~"RTPSourû.hh
"

22 
	~"GroupsockH–³r.hh
"

26 
BoŞ—n
 
	gRTPSourû
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
,

27 cÚ¡* 
sourûName
,

28 
RTPSourû
*& 
»suÉSourû
) {

29 
»suÉSourû
 = 
NULL
;

31 
MedŸSourû
* 
sourû
;

32 ià(!
MedŸSourû
::
	`lookupByName
(
’v
, 
sourûName
, 
sourû
)è 
F®£
;

34 ià(!
sourû
->
	`isRTPSourû
()) {

35 
’v
.
	`£tResuÉMsg
(
sourûName
, " is‚ot‡ RTP source");

36  
F®£
;

39 
»suÉSourû
 = (
RTPSourû
*)
sourû
;

40  
True
;

41 
	}
}

43 
BoŞ—n
 
	gRTPSourû
::
	$hasB“nSynchrÚizedUsšgRTCP
() {

44  
fCurPack‘HasB“nSynchrÚizedUsšgRTCP
;

45 
	}
}

47 
BoŞ—n
 
	gRTPSourû
::
	$isRTPSourû
() const {

48  
True
;

49 
	}
}

51 
	gRTPSourû
::
	$RTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

52 
¹pPaylßdFÜm©
,

53 
u_št32_t
 
¹pTime¡ampF»qu’cy
)

54 : 
	`F¿medSourû
(
’v
),

55 
	`fRTPIÁ”çû
(
this
, 
RTPgs
),

56 
	`fCurPack‘HasB“nSynchrÚizedUsšgRTCP
(
F®£
), 
	`fLa¡ReûivedSSRC
(0),

57 
	`fRTCPIn¡ªûFÜMuÉËxedRTCPPack‘s
(
NULL
),

58 
	`fRTPPaylßdFÜm©
(
¹pPaylßdFÜm©
), 
	`fTime¡ampF»qu’cy
(
¹pTime¡ampF»qu’cy
),

59 
	`fSSRC
(
	`our_¿ndom32
()), 
	$fEÇbËRTCPR•Üts
(
True
) {

60 
fReû±iÚStsDB
 = 
Ãw
 
	`RTPReû±iÚStsDB
();

61 
	}
}

63 
	gRTPSourû
::~
	$RTPSourû
() {

64 
d–‘e
 
fReû±iÚStsDB
;

65 
	}
}

67 
	gRTPSourû
::
	$g‘A‰ribu‹s
() const {

68 
	`’vœ
().
	`£tResuÉMsg
("");

69 
	}
}

74 
	gRTPReû±iÚStsDB
::
	$RTPReû±iÚStsDB
()

75 : 
	`fTabË
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)), 
	$fTÙNumPack‘sReûived
(0) {

76 
	`»£t
();

77 
	}
}

79 
	gRTPReû±iÚStsDB
::
	$»£t
() {

80 
fNumAùiveSourûsSšûLa¡Re£t
 = 0;

82 
I‹¿tÜ
 
	`™”
(*
this
);

83 
RTPReû±iÚSts
* 
¡©s
;

84 (
¡©s
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

85 
¡©s
->
	`»£t
();

87 
	}
}

89 
	gRTPReû±iÚStsDB
::~
	$RTPReû±iÚStsDB
() {

91 
RTPReû±iÚSts
* 
¡©s
;

92 (
¡©s
 = (
RTPReû±iÚSts
*)
fTabË
->
	`RemoveNext
()è!ğ
NULL
) {

93 
d–‘e
 
¡©s
;

97 
d–‘e
 
fTabË
;

98 
	}
}

100 
	gRTPReû±iÚStsDB


101 ::
	$nÙeIncomšgPack‘
(
u_št32_t
 
SSRC
, 
u_št16_t
 
£qNum
,

102 
u_št32_t
 
¹pTime¡amp
, 
time¡ampF»qu’cy
,

103 
BoŞ—n
 
u£FÜJ™‹rC®cuÏtiÚ
,

104 
timev®
& 
»suÉP»£Á©iÚTime
,

105 
BoŞ—n
& 
»suÉHasB“nSynûdUsšgRTCP
,

106 
·ck‘Size
) {

107 ++
fTÙNumPack‘sReûived
;

108 
RTPReû±iÚSts
* 
¡©s
 = 
	`lookup
(
SSRC
);

109 ià(
¡©s
 =ğ
NULL
) {

112 
¡©s
 = 
Ãw
 
	`RTPReû±iÚSts
(
SSRC
, 
£qNum
);

113 ià(
¡©s
 =ğ
NULL
) ;

114 
	`add
(
SSRC
, 
¡©s
);

117 ià(
¡©s
->
	`numPack‘sReûivedSšûLa¡Re£t
() == 0) {

118 ++
fNumAùiveSourûsSšûLa¡Re£t
;

121 
¡©s
->
	`nÙeIncomšgPack‘
(
£qNum
, 
¹pTime¡amp
, 
time¡ampF»qu’cy
,

122 
u£FÜJ™‹rC®cuÏtiÚ
,

123 
»suÉP»£Á©iÚTime
,

124 
»suÉHasB“nSynûdUsšgRTCP
, 
·ck‘Size
);

125 
	}
}

127 
	gRTPReû±iÚStsDB


128 ::
	$nÙeIncomšgSR
(
u_št32_t
 
SSRC
,

129 
u_št32_t
 
ÁpTime¡ampMSW
, u_št32_ˆ
ÁpTime¡ampLSW
,

130 
u_št32_t
 
¹pTime¡amp
) {

131 
RTPReû±iÚSts
* 
¡©s
 = 
	`lookup
(
SSRC
);

132 ià(
¡©s
 =ğ
NULL
) {

135 
¡©s
 = 
Ãw
 
	`RTPReû±iÚSts
(
SSRC
);

136 ià(
¡©s
 =ğ
NULL
) ;

137 
	`add
(
SSRC
, 
¡©s
);

140 
¡©s
->
	`nÙeIncomšgSR
(
ÁpTime¡ampMSW
, 
ÁpTime¡ampLSW
, 
¹pTime¡amp
);

141 
	}
}

143 
	gRTPReû±iÚStsDB
::
	$»moveRecÜd
(
u_št32_t
 
SSRC
) {

144 
RTPReû±iÚSts
* 
¡©s
 = 
	`lookup
(
SSRC
);

145 ià(
¡©s
 !ğ
NULL
) {

146 
SSRC_lÚg
 = ()
SSRC
;

147 
fTabË
->
	`Remove
((cÚ¡*)
SSRC_lÚg
);

148 
d–‘e
 
¡©s
;

150 
	}
}

152 
	gRTPReû±iÚStsDB
::
I‹¿tÜ


153 ::
	$I‹¿tÜ
(
RTPReû±iÚStsDB
& 
»û±iÚStsDB
)

154 : 
	`fI‹r
(
HashTabË
::
I‹¿tÜ
::
	`ü—‹
(*(
»û±iÚStsDB
.
fTabË
))) {

155 
	}
}

157 
RTPReû±iÚStsDB
::
I‹¿tÜ
::~
	$I‹¿tÜ
() {

158 
d–‘e
 
fI‹r
;

159 
	}
}

161 
RTPReû±iÚSts
*

162 
	gRTPReû±iÚStsDB
::
I‹¿tÜ
::
	$Ãxt
(
BoŞ—n
 
šşudeIÇùiveSourûs
) {

163 cÚ¡* 
key
;

167 
RTPReû±iÚSts
* 
¡©s
;

169 
¡©s
 = (
RTPReû±iÚSts
*)(
fI‹r
->
	`Ãxt
(
key
));

170 } 
¡©s
 !ğ
NULL
 && !
šşudeIÇùiveSourûs


171 && 
¡©s
->
	`numPack‘sReûivedSšûLa¡Re£t
() == 0);

173  
¡©s
;

174 
	}
}

176 
RTPReû±iÚSts
* 
	gRTPReû±iÚStsDB
::
	$lookup
(
u_št32_t
 
SSRC
) const {

177 
SSRC_lÚg
 = ()
SSRC
;

178  (
RTPReû±iÚSts
*)(
fTabË
->
	`Lookup
((cÚ¡*)
SSRC_lÚg
));

179 
	}
}

181 
	gRTPReû±iÚStsDB
::
	$add
(
u_št32_t
 
SSRC
, 
RTPReû±iÚSts
* 
¡©s
) {

182 
SSRC_lÚg
 = ()
SSRC
;

183 
fTabË
->
	`Add
((cÚ¡*)
SSRC_lÚg
, 
¡©s
);

184 
	}
}

188 
	gRTPReû±iÚSts
::
	$RTPReû±iÚSts
(
u_št32_t
 
SSRC
, 
u_št16_t
 
š™ŸlSeqNum
) {

189 
	`š™SeqNum
(
š™ŸlSeqNum
);

190 
	`š™
(
SSRC
);

191 
	}
}

193 
	gRTPReû±iÚSts
::
	$RTPReû±iÚSts
(
u_št32_t
 
SSRC
) {

194 
	`š™
(
SSRC
);

195 
	}
}

197 
	gRTPReû±iÚSts
::~
	$RTPReû±iÚSts
() {

198 
	}
}

200 
RTPReû±iÚSts
::
	$š™
(
u_št32_t
 
SSRC
) {

201 
fSSRC
 = 
SSRC
;

202 
fTÙNumPack‘sReûived
 = 0;

203 
fTÙBy‹sReûived_hi
 = 
fTÙBy‹sReûived_lo
 = 0;

204 
fBa£ExtSeqNumReûived
 = 0;

205 
fHighe¡ExtSeqNumReûived
 = 0;

206 
fHaveS“nIn™ŸlSequ’ûNumb”
 = 
F®£
;

207 
fLa¡T¿ns™
 = ~0;

208 
fP»viousPack‘RTPTime¡amp
 = 0;

209 
fJ™‹r
 = 0.0;

210 
fLa¡ReûivedSR_NTPmsw
 = 
fLa¡ReûivedSR_NTPlsw
 = 0;

211 
fLa¡ReûivedSR_time
.
tv_£c
 = fLa¡ReûivedSR_time.
tv_u£c
 = 0;

212 
fLa¡Pack‘Reû±iÚTime
.
tv_£c
 = fLa¡Pack‘Reû±iÚTime.
tv_u£c
 = 0;

213 
fMšIÁ”Pack‘G­US
 = 0x7FFFFFFF;

214 
fMaxIÁ”Pack‘G­US
 = 0;

215 
fTÙ®IÁ”Pack‘G­s
.
tv_£c
 = fTÙ®IÁ”Pack‘G­s.
tv_u£c
 = 0;

216 
fHasB“nSynchrÚized
 = 
F®£
;

217 
fSyncTime
.
tv_£c
 = fSyncTime.
tv_u£c
 = 0;

218 
	`»£t
();

219 
	}
}

221 
	gRTPReû±iÚSts
::
	$š™SeqNum
(
u_št16_t
 
š™ŸlSeqNum
) {

222 
fBa£ExtSeqNumReûived
 = 0x10000 | 
š™ŸlSeqNum
;

223 
fHighe¡ExtSeqNumReûived
 = 0x10000 | 
š™ŸlSeqNum
;

224 
fHaveS“nIn™ŸlSequ’ûNumb”
 = 
True
;

225 
	}
}

227 #iâdeà
MILLION


228 
	#MILLION
 1000000

	)

231 
	gRTPReû±iÚSts


232 ::
	$nÙeIncomšgPack‘
(
u_št16_t
 
£qNum
, 
u_št32_t
 
¹pTime¡amp
,

233 
time¡ampF»qu’cy
,

234 
BoŞ—n
 
u£FÜJ™‹rC®cuÏtiÚ
,

235 
timev®
& 
»suÉP»£Á©iÚTime
,

236 
BoŞ—n
& 
»suÉHasB“nSynûdUsšgRTCP
,

237 
·ck‘Size
) {

238 ià(!
fHaveS“nIn™ŸlSequ’ûNumb”
è
	`š™SeqNum
(
£qNum
);

240 ++
fNumPack‘sReûivedSšûLa¡Re£t
;

241 ++
fTÙNumPack‘sReûived
;

242 
u_št32_t
 
´evTÙBy‹sReûived_lo
 = 
fTÙBy‹sReûived_lo
;

243 
fTÙBy‹sReûived_lo
 +ğ
·ck‘Size
;

244 ià(
fTÙBy‹sReûived_lo
 < 
´evTÙBy‹sReûived_lo
) {

245 ++
fTÙBy‹sReûived_hi
;

249 
ŞdSeqNum
 = (
fHighe¡ExtSeqNumReûived
&0xFFFF);

250 
£qNumCyşe
 = (
fHighe¡ExtSeqNumReûived
&0xFFFF0000);

251 
£qNumDifã»nû
 = ()(()
£qNum
-()
ŞdSeqNum
);

252 
ÃwSeqNum
 = 0;

253 ià(
	`£qNumLT
((
u_št16_t
)
ŞdSeqNum
, 
£qNum
)) {

256 ià(
£qNumDifã»nû
 >= 0x8000) {

258 
£qNumCyşe
 += 0x10000;

261 
ÃwSeqNum
 = 
£qNumCyşe
|
£qNum
;

262 ià(
ÃwSeqNum
 > 
fHighe¡ExtSeqNumReûived
) {

263 
fHighe¡ExtSeqNumReûived
 = 
ÃwSeqNum
;

265 } ià(
fTÙNumPack‘sReûived
 > 1) {

268 ià(()
£qNumDifã»nû
 >= 0x8000) {

270 
£qNumCyşe
 -= 0x10000;

273 
ÃwSeqNum
 = 
£qNumCyşe
|
£qNum
;

274 ià(
ÃwSeqNum
 < 
fBa£ExtSeqNumReûived
) {

275 
fBa£ExtSeqNumReûived
 = 
ÃwSeqNum
;

280 
timev®
 
timeNow
;

281 
	`g‘timeofday
(&
timeNow
, 
NULL
);

282 ià(
fLa¡Pack‘Reû±iÚTime
.
tv_£c
 != 0

283 || 
fLa¡Pack‘Reû±iÚTime
.
tv_u£c
 != 0) {

284 
g­


285 ğ(
timeNow
.
tv_£c
 - 
fLa¡Pack‘Reû±iÚTime
.tv_£c)*
MILLION


286 + 
timeNow
.
tv_u£c
 - 
fLa¡Pack‘Reû±iÚTime
.tv_usec;

287 ià(
g­
 > 
fMaxIÁ”Pack‘G­US
) {

288 
fMaxIÁ”Pack‘G­US
 = 
g­
;

290 ià(
g­
 < 
fMšIÁ”Pack‘G­US
) {

291 
fMšIÁ”Pack‘G­US
 = 
g­
;

293 
fTÙ®IÁ”Pack‘G­s
.
tv_u£c
 +ğ
g­
;

294 ià(
fTÙ®IÁ”Pack‘G­s
.
tv_u£c
 >ğ
MILLION
) {

295 ++
fTÙ®IÁ”Pack‘G­s
.
tv_£c
;

296 
fTÙ®IÁ”Pack‘G­s
.
tv_u£c
 -ğ
MILLION
;

299 
fLa¡Pack‘Reû±iÚTime
 = 
timeNow
;

307 ià(
u£FÜJ™‹rC®cuÏtiÚ


308 && 
¹pTime¡amp
 !ğ
fP»viousPack‘RTPTime¡amp
) {

309 
¬riv®
 = (
time¡ampF»qu’cy
*
timeNow
.
tv_£c
);

310 
¬riv®
 += ()

311 ((2.0*
time¡ampF»qu’cy
*
timeNow
.
tv_u£c
 + 1000000.0)/2000000);

313 
Œªs™
 = 
¬riv®
 - 
¹pTime¡amp
;

314 ià(
fLa¡T¿ns™
 =ğ(~0)èfLa¡T¿ns™ = 
Œªs™
;

315 
d
 = 
Œªs™
 - 
fLa¡T¿ns™
;

316 
fLa¡T¿ns™
 = 
Œªs™
;

317 ià(
d
 < 0) d = -d;

318 
fJ™‹r
 +ğ(1.0/16.0è* (()
d
 - fJitter);

322 ià(
fSyncTime
.
tv_£c
 =ğ0 && fSyncTime.
tv_u£c
 == 0) {

326 
fSyncTime¡amp
 = 
¹pTime¡amp
;

327 
fSyncTime
 = 
timeNow
;

330 
time¡ampDiff
 = 
¹pTime¡amp
 - 
fSyncTime¡amp
;

335 
timeDiff
 = 
time¡ampDiff
/()
time¡ampF»qu’cy
;

338 cÚ¡ 
mliÚ
 = 1000000;

339 
£cÚds
, 
uSecÚds
;

340 ià(
timeDiff
 >= 0.0) {

341 
£cÚds
 = 
fSyncTime
.
tv_£c
 + ()(
timeDiff
);

342 
uSecÚds
 = 
fSyncTime
.
tv_u£c


343 + ()((
timeDiff
 - (éimeDiff)*
mliÚ
);

344 ià(
uSecÚds
 >ğ
mliÚ
) {

345 
uSecÚds
 -ğ
mliÚ
;

346 ++
£cÚds
;

349 
timeDiff
 = -timeDiff;

350 
£cÚds
 = 
fSyncTime
.
tv_£c
 - ()(
timeDiff
);

351 
uSecÚds
 = 
fSyncTime
.
tv_u£c


352 - ()((
timeDiff
 - (éimeDiff)*
mliÚ
);

353 ià(()
uSecÚds
 < 0) {

354 
uSecÚds
 +ğ
mliÚ
;

355 --
£cÚds
;

358 
»suÉP»£Á©iÚTime
.
tv_£c
 = 
£cÚds
;

359 
»suÉP»£Á©iÚTime
.
tv_u£c
 = 
uSecÚds
;

360 
»suÉHasB“nSynûdUsšgRTCP
 = 
fHasB“nSynchrÚized
;

363 
fSyncTime¡amp
 = 
¹pTime¡amp
;

364 
fSyncTime
 = 
»suÉP»£Á©iÚTime
;

366 
fP»viousPack‘RTPTime¡amp
 = 
¹pTime¡amp
;

367 
	}
}

369 
	gRTPReû±iÚSts
::
	$nÙeIncomšgSR
(
u_št32_t
 
ÁpTime¡ampMSW
,

370 
u_št32_t
 
ÁpTime¡ampLSW
,

371 
u_št32_t
 
¹pTime¡amp
) {

372 
fLa¡ReûivedSR_NTPmsw
 = 
ÁpTime¡ampMSW
;

373 
fLa¡ReûivedSR_NTPlsw
 = 
ÁpTime¡ampLSW
;

375 
	`g‘timeofday
(&
fLa¡ReûivedSR_time
, 
NULL
);

378 
fSyncTime¡amp
 = 
¹pTime¡amp
;

379 
fSyncTime
.
tv_£c
 = 
ÁpTime¡ampMSW
 - 0x83AA7E80;

380 
miüo£cÚds
 = (
ÁpTime¡ampLSW
*15625.0)/0x04000000;

381 
fSyncTime
.
tv_u£c
 = ()(
miüo£cÚds
+0.5);

382 
fHasB“nSynchrÚized
 = 
True
;

383 
	}
}

385 
	gRTPReû±iÚSts
::
	$tÙNumKBy‹sReûived
() const {

386 cÚ¡ 
hiMuÉl›r
 = 0x20000000/125.0;

387  
fTÙBy‹sReûived_hi
*
hiMuÉl›r
 + 
fTÙBy‹sReûived_lo
/1000.0;

388 
	}
}

390 
	gRTPReû±iÚSts
::
	$j™‹r
() const {

391  ()
fJ™‹r
;

392 
	}
}

394 
	gRTPReû±iÚSts
::
	$»£t
() {

395 
fNumPack‘sReûivedSšûLa¡Re£t
 = 0;

396 
fLa¡Re£tExtSeqNumReûived
 = 
fHighe¡ExtSeqNumReûived
;

397 
	}
}

399 
BoŞ—n
 
	$£qNumLT
(
u_št16_t
 
s1
, u_št16_ˆ
s2
) {

401 
diff
 = 
s2
-
s1
;

402 ià(
diff
 > 0) {

403  (
diff
 < 0x8000);

404 } ià(
diff
 < 0) {

405  (
diff
 < -0x8000);

407  
F®£
;

409 
	}
}

	@liveMedia/RTSPClient.cpp

21 
	~"RTSPCl›Á.hh
"

22 
	~"RTSPCommÚ.hh
"

23 
	~"Ba£64.hh
"

24 
	~"LoÿË.hh
"

25 
	~<GroupsockH–³r.hh
>

26 
	~"ourMD5.hh
"

30 
RTSPCl›Á
* 
	gRTSPCl›Á
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
¹¥URL
,

31 
v”bos™yLev–
,

32 cÚ¡* 
­¶iÿtiÚName
,

33 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
,

34 
sock‘NumToS”v”
) {

35  
Ãw
 
	`RTSPCl›Á
(
’v
, 
¹¥URL
,

36 
v”bos™yLev–
, 
­¶iÿtiÚName
, 
tuÂ–Ov”HTTPPÜtNum
, 
sock‘NumToS”v”
);

37 
	}
}

39 
	gRTSPCl›Á
::
	$£ndDesüibeCommªd
(
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

40 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

41  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "DESCRIBE", 
»¥Ú£HªdËr
));

42 
	}
}

44 
	gRTSPCl›Á
::
	$£ndO±iÚsCommªd
(
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

45 ià(
auth’tiÿtÜ
 !ğ
NULL
è
fCu¼’tAuth’tiÿtÜ
 = *authenticator;

46  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "OPTIONS", 
»¥Ú£HªdËr
));

47 
	}
}

49 
	gRTSPCl›Á
::
	$£ndAÂounûCommªd
(cÚ¡* 
sdpDesütiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

50 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

51  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "ANNOUNCE", 
»¥Ú£HªdËr
, 
NULL
, NULL, 
F®£
, 0.0, 0.0, 0.0, 
sdpDesütiÚ
));

52 
	}
}

54 
	gRTSPCl›Á
::
	$£ndS‘upCommªd
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
»¥Ú£HªdËr
*„esponseHandler,

55 
BoŞ—n
 
¡»amOutgošg
, BoŞ—À
¡»amUsšgTCP
, BoŞ—À
fÜûMuÉiÿ¡OnUn¥ecif›d
,

56 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

57 ià(
fTuÂ–Ov”HTTPPÜtNum
 !ğ0è
¡»amUsšgTCP
 = 
True
;

58 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

60 
u_št32_t
 
boŞ—nFÏgs
 = 0;

61 ià(
¡»amUsšgTCP
è
boŞ—nFÏgs
 |= 0x1;

62 ià(
¡»amOutgošg
è
boŞ—nFÏgs
 |= 0x2;

63 ià(
fÜûMuÉiÿ¡OnUn¥ecif›d
è
boŞ—nFÏgs
 |= 0x4;

64  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "SETUP", 
»¥Ú£HªdËr
, 
NULL
, &
sub£ssiÚ
, 
boŞ—nFÏgs
));

65 
	}
}

67 
	gRTSPCl›Á
::
	$£ndPÏyCommªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„esponseHandler,

68 
¡¬t
, 
’d
, 
sÿË
,

69 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

70 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

71 
	`£ndDummyUDPPack‘s
(
£ssiÚ
);

72  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "PLAY", 
»¥Ú£HªdËr
, &
£ssiÚ
, 
NULL
, 0, 
¡¬t
, 
’d
, 
sÿË
));

73 
	}
}

75 
	gRTSPCl›Á
::
	$£ndPÏyCommªd
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
»¥Ú£HªdËr
*„esponseHandler,

76 
¡¬t
, 
’d
, 
sÿË
,

77 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

78 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

79 
	`£ndDummyUDPPack‘s
(
sub£ssiÚ
);

80  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "PLAY", 
»¥Ú£HªdËr
, 
NULL
, &
sub£ssiÚ
, 0, 
¡¬t
, 
’d
, 
sÿË
));

81 
	}
}

83 
	gRTSPCl›Á
::
	$£ndPÏyCommªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„esponseHandler,

84 cÚ¡* 
absS¹Time
, cÚ¡* 
absEndTime
, 
sÿË
,

85 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

86 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

87 
	`£ndDummyUDPPack‘s
(
£ssiÚ
);

88  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, 
»¥Ú£HªdËr
, 
absS¹Time
, 
absEndTime
, 
sÿË
, &
£ssiÚ
, 
NULL
));

89 
	}
}

91 
	gRTSPCl›Á
::
	$£ndPÏyCommªd
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
»¥Ú£HªdËr
*„esponseHandler,

92 cÚ¡* 
absS¹Time
, cÚ¡* 
absEndTime
, 
sÿË
,

93 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

94 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

95 
	`£ndDummyUDPPack‘s
(
sub£ssiÚ
);

96  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, 
»¥Ú£HªdËr
, 
absS¹Time
, 
absEndTime
, 
sÿË
, 
NULL
, &
sub£ssiÚ
));

97 
	}
}

99 
	gRTSPCl›Á
::
	$£ndPau£Commªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

100 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

101  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "PAUSE", 
»¥Ú£HªdËr
, &
£ssiÚ
));

102 
	}
}

104 
	gRTSPCl›Á
::
	$£ndPau£Commªd
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

105 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

106  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "PAUSE", 
»¥Ú£HªdËr
, 
NULL
, &
sub£ssiÚ
));

107 
	}
}

109 
	gRTSPCl›Á
::
	$£ndRecÜdCommªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

110 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

111  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "RECORD", 
»¥Ú£HªdËr
, &
£ssiÚ
));

112 
	}
}

114 
	gRTSPCl›Á
::
	$£ndRecÜdCommªd
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

115 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

116  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "RECORD", 
»¥Ú£HªdËr
, 
NULL
, &
sub£ssiÚ
));

117 
	}
}

119 
	gRTSPCl›Á
::
	$£ndT—rdownCommªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

120 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

121  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "TEARDOWN", 
»¥Ú£HªdËr
, &
£ssiÚ
));

122 
	}
}

124 
	gRTSPCl›Á
::
	$£ndT—rdownCommªd
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

125 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

126  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "TEARDOWN", 
»¥Ú£HªdËr
, 
NULL
, &
sub£ssiÚ
));

127 
	}
}

129 
	gRTSPCl›Á
::
	$£ndS‘P¬am‘”Commªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„esponseHandler,

130 cÚ¡* 
·¿m‘”Name
, cÚ¡* 
·¿m‘”V®ue
,

131 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

132 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

133 * 
·¿mSŒšg
 = 
Ãw
 [
	`¡¾’
(
·¿m‘”Name
è+ sŒËn(
·¿m‘”V®ue
) + 10];

134 
	`¥rštf
(
·¿mSŒšg
, "%s: %s\r\n", 
·¿m‘”Name
, 
·¿m‘”V®ue
);

135 
»suÉ
 = 
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "SET_PARAMETER", 
»¥Ú£HªdËr
, &
£ssiÚ
, 
NULL
, 
F®£
, 0.0, 0.0, 0.0, 
·¿mSŒšg
));

136 
d–‘e
[] 
·¿mSŒšg
;

137  
»suÉ
;

138 
	}
}

140 
	gRTSPCl›Á
::
	$£ndG‘P¬am‘”Commªd
(
MedŸSessiÚ
& 
£ssiÚ
, 
»¥Ú£HªdËr
*„e¥Ú£HªdËr, cÚ¡* 
·¿m‘”Name
,

141 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

142 ià(
fCu¼’tAuth’tiÿtÜ
 < 
auth’tiÿtÜ
) fCurrentAuthenticator = *authenticator;

148 
·¿m‘”NameL’
 = 
·¿m‘”Name
 =ğ
NULL
 ? 0 : 
	`¡¾’
(parameterName);

149 * 
·¿mSŒšg
 = 
Ãw
 [
·¿m‘”NameL’
 + 3];

150 ià(
·¿m‘”Name
 =ğ
NULL
) {

151 
·¿mSŒšg
[0] = '\0';

153 
	`¥rštf
(
·¿mSŒšg
, "%s\r\n", 
·¿m‘”Name
);

155 
»suÉ
 = 
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(++
fCSeq
, "GET_PARAMETER", 
»¥Ú£HªdËr
, &
£ssiÚ
, 
NULL
, 
F®£
, 0.0, 0.0, 0.0, 
·¿mSŒšg
));

156 
d–‘e
[] 
·¿mSŒšg
;

157  
»suÉ
;

158 
	}
}

160 
	gRTSPCl›Á
::
	$£ndDummyUDPPack‘s
(
MedŸSessiÚ
& 
£ssiÚ
, 
numDummyPack‘s
) {

161 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
£ssiÚ
);

162 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

164 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

165 
	`£ndDummyUDPPack‘s
(*
sub£ssiÚ
, 
numDummyPack‘s
);

167 
	}
}

169 
	gRTSPCl›Á
::
	$£ndDummyUDPPack‘s
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, 
numDummyPack‘s
) {

173 
Groupsock
* 
gs1
 = 
NULL
; Groupsock* 
gs2
 = NULL;

174 ià(
sub£ssiÚ
.
	`¹pSourû
(è!ğ
NULL
è
gs1
 = sub£ssiÚ.¹pSourû()->
	`RTPgs
();

175 ià(
sub£ssiÚ
.
	`¹ıIn¡ªû
(è!ğ
NULL
è
gs2
 = sub£ssiÚ.¹ıIn¡ªû()->
	`RTCPgs
();

176 
u_št32_t
 cÚ¡ 
dummy
 = 0xFEEDFACE;

177 
i
 = 0; i < 
numDummyPack‘s
; ++i) {

178 ià(
gs1
 !ğ
NULL
ègs1->
	`ouut
(
	`’vœ
(), (*)&
dummy
,  dummy);

179 ià(
gs2
 !ğ
NULL
ègs2->
	`ouut
(
	`’vœ
(), (*)&
dummy
,  dummy);

181 
	}
}

183 
	gRTSPCl›Á
::
	$£tS³ed
(
MedŸSessiÚ
& 
£ssiÚ
, 
¥“d
) {

187 ià(&
£ssiÚ
 !ğ
NULL
) {

188 
£ssiÚ
.
	`¥“d
(èğ
¥“d
;

189 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
£ssiÚ
);

190 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

192 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

193 
sub£ssiÚ
->
	`¥“d
(èğ
¥“d
;

196 
	}
}

198 
BoŞ—n
 
	gRTSPCl›Á
::
	$chªgeRe¥Ú£HªdËr
(
c£q
, 
»¥Ú£HªdËr
* 
ÃwRe¥Ú£HªdËr
) {

200 
Reque¡RecÜd
* 
»que¡
;

201 ià((
»que¡
 = 
fReque¡sAwa™šgCÚÃùiÚ
.
	`fšdByCSeq
(
c£q
)è!ğ
NULL


202 || (
»que¡
 = 
fReque¡sAwa™šgHTTPTuÂ–šg
.
	`fšdByCSeq
(
c£q
)è!ğ
NULL


203 || (
»que¡
 = 
fReque¡sAwa™šgRe¥Ú£
.
	`fšdByCSeq
(
c£q
)è!ğ
NULL
) {

204 
»que¡
->
	`hªdËr
(èğ
ÃwRe¥Ú£HªdËr
;

205  
True
;

208  
F®£
;

209 
	}
}

211 
BoŞ—n
 
	gRTSPCl›Á
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
,

212 cÚ¡* 
š¡ªûName
,

213 
RTSPCl›Á
*& 
»suÉCl›Á
) {

214 
»suÉCl›Á
 = 
NULL
;

216 
Medium
* 
medium
;

217 ià(!
Medium
::
	`lookupByName
(
’v
, 
š¡ªûName
, 
medium
)è 
F®£
;

219 ià(!
medium
->
	`isRTSPCl›Á
()) {

220 
’v
.
	`£tResuÉMsg
(
š¡ªûName
, " is‚ot‡ RTSP client");

221  
F®£
;

224 
»suÉCl›Á
 = (
RTSPCl›Á
*)
medium
;

225  
True
;

226 
	}
}

228 
	$cİyU£ºameOrPasswÜdSŒšgFromURL
(* 
de¡
, cÚ¡* 
¤c
, 
Ën
) {

231 
Ën
 > 0) {

232 
nBefÜe
 = 0;

233 
nAá”
 = 0;

235 ià(*
¤c
 =ğ'%' && 
Ën
 >ğ3 && 
	`ssÿnf
(¤c+1, "%n%2hhx%n", &
nBefÜe
, 
de¡
, &
nAá”
) == 1) {

236 
codeSize
 = 
nAá”
 - 
nBefÜe
;

238 ++
de¡
;

239 
¤c
 +ğ(1 + 
codeSize
);

240 
Ën
 -ğ(1 + 
codeSize
);

242 *
de¡
++ = *
¤c
++;

243 --
Ën
;

246 *
de¡
 = '\0';

247 
	}
}

249 
BoŞ—n
 
	gRTSPCl›Á
::
	$·r£RTSPURL
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
u¾
,

250 *& 
u£ºame
, *& 
·sswÜd
,

251 
N‘Add»ss
& 
add»ss
,

252 
pÜtNumB™s
& 
pÜtNum
,

253 cÚ¡** 
u¾Suffix
) {

256 cÚ¡* 
´efix
 = "rtsp://";

257 cÚ¡ 
´efixL’gth
 = 7;

258 ià(
	`_¡ºÿ£cmp
(
u¾
, 
´efix
, 
´efixL’gth
) != 0) {

259 
’v
.
	`£tResuÉMsg
("URL i nÙ oàthfÜm \"", 
´efix
, "\"");

263 cÚ¡ 
·r£BufãrSize
 = 100;

264 
·r£Bufãr
[
·r£BufãrSize
];

265 cÚ¡* 
äom
 = &
u¾
[
´efixL’gth
];

269 
u£ºame
 = 
·sswÜd
 = 
NULL
;

270 cÚ¡* 
cŞÚPasswÜdS¹
 = 
NULL
;

271 cÚ¡* 
p
;

272 
p
 = 
äom
; *p != '\0' && *p != '/'; ++p) {

273 ià(*
p
 =ğ':' && 
cŞÚPasswÜdS¹
 =ğ
NULL
) {

274 
cŞÚPasswÜdS¹
 = 
p
;

275 } ià(*
p
 == '@') {

277 ià(
cŞÚPasswÜdS¹
 =ğ
NULL
ècŞÚPasswÜdS¹ = 
p
;

279 cÚ¡* 
u£ºameS¹
 = 
äom
;

280 
u£ºameL’
 = 
cŞÚPasswÜdS¹
 - 
u£ºameS¹
;

281 
u£ºame
 = 
Ãw
 [
u£ºameL’
 + 1] ;

282 
	`cİyU£ºameOrPasswÜdSŒšgFromURL
(
u£ºame
, 
u£ºameS¹
, 
u£ºameL’
);

284 cÚ¡* 
·sswÜdS¹
 = 
cŞÚPasswÜdS¹
;

285 ià(
·sswÜdS¹
 < 
p
) ++passwordStart;

286 
·sswÜdL’
 = 
p
 - 
·sswÜdS¹
;

287 
·sswÜd
 = 
Ãw
 [
·sswÜdL’
 + 1];

288 
	`cİyU£ºameOrPasswÜdSŒšgFromURL
(
·sswÜd
, 
·sswÜdS¹
, 
·sswÜdL’
);

290 
äom
 = 
p
 + 1;

296 * 
to
 = &
·r£Bufãr
[0];

297 
i
;

298 
i
 = 0; i < 
·r£BufãrSize
; ++i) {

299 ià(*
äom
 == '\0' || *from == ':' || *from == '/') {

301 *
to
 = '\0';

304 *
to
++ = *
äom
++;

306 ià(
i
 =ğ
·r£BufãrSize
) {

307 
’v
.
	`£tResuÉMsg
("URL isoo†ong");

311 
N‘Add»ssLi¡
 
	`add»s£s
(
·r£Bufãr
);

312 ià(
add»s£s
.
	`numAdd»s£s
() == 0) {

313 
’v
.
	`£tResuÉMsg
("Failedo find‚etwork‡ddress for \"",

314 
·r£Bufãr
, "\"");

317 
add»ss
 = *(
add»s£s
.
	`fœ¡Add»ss
());

319 
pÜtNum
 = 554;

320 
ÃxtCh¬
 = *
äom
;

321 ià(
ÃxtCh¬
 == ':') {

322 
pÜtNumIÁ
;

323 ià(
	`ssÿnf
(++
äom
, "%d", &
pÜtNumIÁ
) != 1) {

324 
’v
.
	`£tResuÉMsg
("No…ort‚umber follows ':'");

327 ià(
pÜtNumIÁ
 < 1 ||…ortNumInt > 65535) {

328 
’v
.
	`£tResuÉMsg
("Bad…ort‚umber");

331 
pÜtNum
 = (
pÜtNumB™s
)
pÜtNumIÁ
;

332 *
äom
 >= '0' && *from <= '9') ++from;

336 ià(
u¾Suffix
 !ğ
NULL
è*u¾Suffix = 
äom
;

338  
True
;

341  
F®£
;

342 
	}
}

344 
	gRTSPCl›Á
::
	$£tU£rAg’tSŒšg
(cÚ¡* 
u£rAg’tName
) {

345 ià(
u£rAg’tName
 =ğ
NULL
) ;

348 cÚ¡* cÚ¡ 
fÜm©SŒ
 = "User-Agent: %s\r\n";

349 cÚ¡ 
h—d”Size
 = 
	`¡¾’
(
fÜm©SŒ
è+ sŒËn(
u£rAg’tName
);

350 
d–‘e
[] 
fU£rAg’tH—d”SŒ
;

351 
fU£rAg’tH—d”SŒ
 = 
Ãw
 [
h—d”Size
];

352 
	`¥rštf
(
fU£rAg’tH—d”SŒ
, 
fÜm©SŒ
, 
u£rAg’tName
);

353 
fU£rAg’tH—d”SŒL’
 = 
	`¡¾’
(
fU£rAg’tH—d”SŒ
);

354 
	}
}

356 
	gRTSPCl›Á
::
»¥Ú£BufãrSize
 = 20000;

358 
	gRTSPCl›Á
::
	$RTSPCl›Á
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
¹¥URL
,

359 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
,

360 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
, 
sock‘NumToS”v”
)

361 : 
	`Medium
(
’v
),

362 
	`desœedMaxIncomšgPack‘Size
(0), 
	`fV”bos™yLev–
(
v”bos™yLev–
), 
	`fCSeq
(1),

363 
	`fAÎowBasicAuth’tiÿtiÚ
(
True
), 
	`fS”v”Add»ss
(0),

364 
	`fTuÂ–Ov”HTTPPÜtNum
(
tuÂ–Ov”HTTPPÜtNum
),

365 
	`fU£rAg’tH—d”SŒ
(
NULL
), 
	`fU£rAg’tH—d”SŒL’
(0),

366 
	`fIÅutSock‘Num
(-1), 
	`fOuutSock‘Num
(-1), 
	`fBa£URL
(
NULL
), 
	`fTCPSŒ—mIdCouÁ
(0),

367 
	`fLa¡SessiÚId
(
NULL
), 
	`fSessiÚTimeoutP¬am‘”
(0), 
	`fSessiÚCook›CouÁ”
(0), 
	$fHTTPTuÂ–šgCÚÃùiÚIsP’dšg
(
F®£
) {

368 
	`£tBa£URL
(
¹¥URL
);

370 
fRe¥Ú£Bufãr
 = 
Ãw
 [
»¥Ú£BufãrSize
+1];

371 
	`»£tRe¥Ú£Bufãr
();

373 ià(
sock‘NumToS”v”
 >= 0) {

376 
fIÅutSock‘Num
 = 
fOuutSock‘Num
 = 
sock‘NumToS”v”
;

377 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fIÅutSock‘Num
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
,

378 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgD©aHªdËr
, 
this
);

382 cÚ¡* cÚ¡ 
libName
 = "LIVE555 Streaming Media v";

383 cÚ¡* cÚ¡ 
libV”siÚSŒ
 = 
LIVEMEDIA_LIBRARY_VERSION_STRING
;

384 cÚ¡* 
libP»fix
; cÚ¡* 
libSuffix
;

385 ià(
­¶iÿtiÚName
 =ğ
NULL
 ||‡pplicationName[0] == '\0') {

386 
­¶iÿtiÚName
 = 
libP»fix
 = 
libSuffix
 = "";

388 
libP»fix
 = " (";

389 
libSuffix
 = ")";

391 
u£rAg’tNameSize


392 ğ
	`¡¾’
(
­¶iÿtiÚName
è+ sŒËn(
libP»fix
è+ sŒËn(
libName
è+ sŒËn(
libV”siÚSŒ
è+ sŒËn(
libSuffix
) + 1;

393 * 
u£rAg’tName
 = 
Ãw
 [
u£rAg’tNameSize
];

394 
	`¥rštf
(
u£rAg’tName
, "%s%s%s%s%s", 
­¶iÿtiÚName
, 
libP»fix
, 
libName
, 
libV”siÚSŒ
, 
libSuffix
);

395 
	`£tU£rAg’tSŒšg
(
u£rAg’tName
);

396 
d–‘e
[] 
u£rAg’tName
;

397 
	}
}

399 
	gRTSPCl›Á
::~
	$RTSPCl›Á
() {

400 
RTPIÁ”çû
::
	`ş—rS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
	`’vœ
(), 
fIÅutSock‘Num
);

401 
	`»£t
();

403 
d–‘e
[] 
fRe¥Ú£Bufãr
;

404 
d–‘e
[] 
fU£rAg’tH—d”SŒ
;

405 
	}
}

407 
	gRTSPCl›Á
::
	$»£t
() {

408 
	`»£tTCPSock‘s
();

409 
	`»£tRe¥Ú£Bufãr
();

410 
fS”v”Add»ss
 = 0;

412 
	`£tBa£URL
(
NULL
);

414 
fCu¼’tAuth’tiÿtÜ
.
	`»£t
();

416 
d–‘e
[] 
fLa¡SessiÚId
; fLa¡SessiÚId = 
NULL
;

417 
	}
}

419 
	gRTSPCl›Á
::
	$£tBa£URL
(cÚ¡* 
u¾
) {

420 
d–‘e
[] 
fBa£URL
; fBa£URL = 
	`¡rDup
(
u¾
);

421 
	}
}

423 
	gRTSPCl›Á
::
	$g¿bSock‘
() {

424 
šputSock‘
 = 
fIÅutSock‘Num
;

425 
fIÅutSock‘Num
 = -1;

427  
šputSock‘
;

428 
	}
}

430 
	gRTSPCl›Á
::
	$£ndReque¡
(
Reque¡RecÜd
* 
»que¡
) {

431 * 
cmd
 = 
NULL
;

433 
BoŞ—n
 
cÚÃùiÚIsP’dšg
 = 
F®£
;

434 ià(!
fReque¡sAwa™šgCÚÃùiÚ
.
	`isEm±y
()) {

436 
cÚÃùiÚIsP’dšg
 = 
True
;

437 } ià(
fIÅutSock‘Num
 < 0) {

438 
cÚÃùResuÉ
 = 
	`İ’CÚÃùiÚ
();

439 ià(
cÚÃùResuÉ
 < 0) ;

440 ià(
cÚÃùResuÉ
 == 0) {

442 
cÚÃùiÚIsP’dšg
 = 
True
;

445 ià(
cÚÃùiÚIsP’dšg
) {

446 
fReque¡sAwa™šgCÚÃùiÚ
.
	`’queue
(
»que¡
);

447  
»que¡
->
	`c£q
();

451 ià(
fTuÂ–Ov”HTTPPÜtNum
 !ğ0 && 
	`¡rcmp
(
»que¡
->
	`commªdName
(), "GET"è!ğ0 && 
fOuutSock‘Num
 =ğ
fIÅutSock‘Num
) {

452 ià(!
	`£tupHTTPTuÂ–šg1
()) ;

453 
fReque¡sAwa™šgHTTPTuÂ–šg
.
	`’queue
(
»que¡
);

454  
»que¡
->
	`c£q
();

461 * 
cmdURL
 = 
fBa£URL
;

462 
BoŞ—n
 
cmdURLWasAÎoÿ‹d
 = 
F®£
;

464 cÚ¡* 
´ÙocŞSŒ
 = "RTSP/1.0";

466 * 
exŒaH—d”s
 = (*)"";

467 
BoŞ—n
 
exŒaH—d”sW”eAÎoÿ‹d
 = 
F®£
;

469 * 
cÚ‹ÁL’gthH—d”
 = (*)"";

470 
BoŞ—n
 
cÚ‹ÁL’gthH—d”WasAÎoÿ‹d
 = 
F®£
;

472 ià(!
	`£tReque¡F›lds
(
»que¡
,

473 
cmdURL
, 
cmdURLWasAÎoÿ‹d
,

474 
´ÙocŞSŒ
,

475 
exŒaH—d”s
, 
exŒaH—d”sW”eAÎoÿ‹d
)) {

479 cÚ¡* 
cÚ‹ÁSŒ
 = 
»que¡
->
	`cÚ‹ÁSŒ
();

480 ià(
cÚ‹ÁSŒ
 =ğ
NULL
) contentStr = "";

481 
cÚ‹ÁSŒL’
 = 
	`¡¾’
(
cÚ‹ÁSŒ
);

482 ià(
cÚ‹ÁSŒL’
 > 0) {

483 cÚ¡* 
cÚ‹ÁL’gthH—d”Fmt
 =

485 
cÚ‹ÁL’gthH—d”Size
 = 
	`¡¾’
(
cÚ‹ÁL’gthH—d”Fmt
)

487 
cÚ‹ÁL’gthH—d”
 = 
Ãw
 [
cÚ‹ÁL’gthH—d”Size
];

488 
	`¥rštf
(
cÚ‹ÁL’gthH—d”
, 
cÚ‹ÁL’gthH—d”Fmt
, 
cÚ‹ÁSŒL’
);

489 
cÚ‹ÁL’gthH—d”WasAÎoÿ‹d
 = 
True
;

492 * 
auth’tiÿtÜSŒ
 = 
	`ü—‹Auth’tiÿtÜSŒšg
(
»que¡
->
	`commªdName
(), 
fBa£URL
);

494 cÚ¡* cÚ¡ 
cmdFmt
 =

503 
cmdSize
 = 
	`¡¾’
(
cmdFmt
)

504 + 
	`¡¾’
(
»que¡
->
	`commªdName
()è+ sŒËn(
cmdURL
è+ sŒËn(
´ÙocŞSŒ
)

506 + 
	`¡¾’
(
auth’tiÿtÜSŒ
)

507 + 
fU£rAg’tH—d”SŒL’


508 + 
	`¡¾’
(
exŒaH—d”s
)

509 + 
	`¡¾’
(
cÚ‹ÁL’gthH—d”
)

510 + 
cÚ‹ÁSŒL’
;

511 
cmd
 = 
Ãw
 [
cmdSize
];

512 
	`¥rštf
(
cmd
, 
cmdFmt
,

513 
»que¡
->
	`commªdName
(), 
cmdURL
, 
´ÙocŞSŒ
,

514 
»que¡
->
	`c£q
(),

515 
auth’tiÿtÜSŒ
,

516 
fU£rAg’tH—d”SŒ
,

517 
exŒaH—d”s
,

518 
cÚ‹ÁL’gthH—d”
,

519 
cÚ‹ÁSŒ
);

520 
d–‘e
[] 
auth’tiÿtÜSŒ
;

521 ià(
cmdURLWasAÎoÿ‹d
è
d–‘e
[] 
cmdURL
;

522 ià(
exŒaH—d”sW”eAÎoÿ‹d
è
d–‘e
[] 
exŒaH—d”s
;

523 ià(
cÚ‹ÁL’gthH—d”WasAÎoÿ‹d
è
d–‘e
[] 
cÚ‹ÁL’gthH—d”
;

525 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
(è<< "S’dšg„eque¡: " << 
cmd
 << "\n";

527 ià(
fTuÂ–Ov”HTTPPÜtNum
 !ğ0 && 
	`¡rcmp
(
»que¡
->
	`commªdName
(), "GET") != 0 && strcmp(request->commandName(), "POST") != 0) {

530 * 
ÜigCmd
 = 
cmd
;

531 
cmd
 = 
	`ba£64Encode
(
ÜigCmd
, 
	`¡¾’
(cmd));

532 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
(è<< "\tTh»que¡ wa ba£-64ƒncodedo: " << 
cmd
 << "\n\n";

533 
d–‘e
[] 
ÜigCmd
;

536 ià(
	`£nd
(
fOuutSock‘Num
, 
cmd
, 
	`¡¾’
(cmd), 0) < 0) {

537 cÚ¡* 
”rFmt
 = "%s send() failed: ";

538 cÚ¡ 
”rL’gth
 = 
	`¡¾’
(
”rFmt
è+ sŒËn(
»que¡
->
	`commªdName
());

539 * 
”r
 = 
Ãw
 [
”rL’gth
];

540 
	`¥rštf
(
”r
, 
”rFmt
, 
»que¡
->
	`commªdName
());

541 
	`’vœ
().
	`£tResuÉE¼Msg
(
”r
);

542 
d–‘e
[] 
”r
;

548 
c£q
 = 
»que¡
->
	`c£q
();

550 ià(
fTuÂ–Ov”HTTPPÜtNum
 =ğ0 || 
	`¡rcmp
(
»que¡
->
	`commªdName
(), "POST") != 0) {

551 
fReque¡sAwa™šgRe¥Ú£
.
	`’queue
(
»que¡
);

553 
d–‘e
 
»que¡
;

556 
d–‘e
[] 
cmd
;

557  
c£q
;

561 
d–‘e
[] 
cmd
;

562 
	`hªdËReque¡E¼Ü
(
»que¡
);

563 
d–‘e
 
»que¡
;

565 
	}
}

567 * 
	$ü—‹SessiÚSŒšg
(cÚ¡* 
£ssiÚId
) {

568 * 
£ssiÚSŒ
;

569 ià(
£ssiÚId
 !ğ
NULL
) {

570 
£ssiÚSŒ
 = 
Ãw
 [20+
	`¡¾’
(
£ssiÚId
)];

571 
	`¥rštf
(
£ssiÚSŒ
, "SessiÚ: %s\r\n", 
£ssiÚId
);

573 
£ssiÚSŒ
 = 
	`¡rDup
("");

575  
£ssiÚSŒ
;

576 
	}
}

579 * 
	$ü—‹S³edSŒšg
(
¥“d
) {

580 
buf
[100];

581 ià(
¥“d
 == 1.0f ) {

583 
buf
[0] = '\0';

585 
	`¥rštf
(
buf
, "S³ed: %.3f\r\n",
¥“d
);

588  
	`¡rDup
(
buf
);

589 
	}
}

591 * 
	$ü—‹SÿËSŒšg
(
sÿË
, 
cu¼’tSÿË
) {

592 
buf
[100];

593 ià(
sÿË
 =ğ1.0à&& 
cu¼’tSÿË
 == 1.0f) {

595 
buf
[0] = '\0';

597 
LoÿË
 
	`l
("C", 
Num”ic
);

598 
	`¥rštf
(
buf
, "SÿË: %f\r\n", 
sÿË
);

601  
	`¡rDup
(
buf
);

602 
	}
}

604 * 
	$ü—‹RªgeSŒšg
(
¡¬t
, 
’d
, cÚ¡* 
absS¹Time
, cÚ¡* 
absEndTime
) {

605 
buf
[100];

607 ià(
absS¹Time
 !ğ
NULL
) {

610 ià(
absEndTime
 =ğ
NULL
) {

612 
	`¢´štf
(
buf
,  buf, "Rªge: clock=%s-\r\n", 
absS¹Time
);

615 
	`¢´štf
(
buf
,  buf, "Rªge: clock=%s-%s\r\n", 
absS¹Time
, 
absEndTime
);

620 ià(
¡¬t
 < 0) {

622 
buf
[0] = '\0';

623 } ià(
’d
 < 0) {

625 
LoÿË
 
	`l
("C", 
Num”ic
);

626 
	`¥rštf
(
buf
, "Rªge:‚±=%.3f-\r\n", 
¡¬t
);

629 
LoÿË
 
	`l
("C", 
Num”ic
);

630 
	`¥rštf
(
buf
, "Rªge:‚±=%.3f-%.3f\r\n", 
¡¬t
, 
’d
);

634  
	`¡rDup
(
buf
);

635 
	}
}

637 
BoŞ—n
 
	gRTSPCl›Á
::
	$£tReque¡F›lds
(
Reque¡RecÜd
* 
»que¡
,

638 *& 
cmdURL
, 
BoŞ—n
& 
cmdURLWasAÎoÿ‹d
,

639 cÚ¡*& 
´ÙocŞSŒ
,

640 *& 
exŒaH—d”s
, 
BoŞ—n
& 
exŒaH—d”sW”eAÎoÿ‹d


644 ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "DESCRIBE") == 0) {

645 
exŒaH—d”s
 = (*)"Accept:‡pplication/sdp\r\n";

646 } ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "OPTIONS") == 0) {

649 
exŒaH—d”s
 = 
	`ü—‹SessiÚSŒšg
(
fLa¡SessiÚId
);

650 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

651 } ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "ANNOUNCE") == 0) {

652 
exŒaH—d”s
 = (*)"Content-Type:‡pplication/sdp\r\n";

653 } ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "SETUP") == 0) {

654 
MedŸSub£ssiÚ
& 
sub£ssiÚ
 = *
»que¡
->
	`sub£ssiÚ
();

655 
BoŞ—n
 
¡»amUsšgTCP
 = (
»que¡
->
	`boŞ—nFÏgs
()&0x1) != 0;

656 
BoŞ—n
 
¡»amOutgošg
 = (
»que¡
->
	`boŞ—nFÏgs
()&0x2) != 0;

657 
BoŞ—n
 
fÜûMuÉiÿ¡OnUn¥ecif›d
 = (
»que¡
->
	`boŞ—nFÏgs
()&0x4) != 0;

659 cÚ¡ *
´efix
, *
£·¿tÜ
, *
suffix
;

660 
	`cÚ¡ruùSub£ssiÚURL
(
sub£ssiÚ
, 
´efix
, 
£·¿tÜ
, 
suffix
);

662 cÚ¡* 
Œª¥ÜtFmt
;

663 ià(
	`¡rcmp
(
sub£ssiÚ
.
	`´ÙocŞName
(), "UDP") == 0) {

664 
suffix
 = "";

665 
Œª¥ÜtFmt
 = "Transport: RAW/RAW/UDP%s%s%s=%d-%d\r\n";

667 
Œª¥ÜtFmt
 = "Transport: RTP/AVP%s%s%s=%d-%d\r\n";

670 
cmdURL
 = 
Ãw
 [
	`¡¾’
(
´efix
è+ sŒËn(
£·¿tÜ
è+ sŒËn(
suffix
) + 1];

671 
cmdURLWasAÎoÿ‹d
 = 
True
;

672 
	`¥rštf
(
cmdURL
, "%s%s%s", 
´efix
, 
£·¿tÜ
, 
suffix
);

675 cÚ¡* 
Œª¥ÜtTy³SŒ
;

676 cÚ¡* 
modeSŒ
 = 
¡»amOutgošg
 ? ";mode=receive" : "";

678 cÚ¡* 
pÜtTy³SŒ
;

679 
pÜtNumB™s
 
¹pNumb”
, 
¹ıNumb”
;

680 ià(
¡»amUsšgTCP
) {

681 
Œª¥ÜtTy³SŒ
 = "/TCP;unicast";

682 
pÜtTy³SŒ
 = ";interleaved";

683 
¹pNumb”
 = 
fTCPSŒ—mIdCouÁ
++;

684 
¹ıNumb”
 = 
fTCPSŒ—mIdCouÁ
++;

686 
cÚÃùiÚAdd»ss
 = 
sub£ssiÚ
.
	`cÚÃùiÚEndpoštAdd»ss
();

687 
BoŞ—n
 
»que¡MuÉiÿ¡SŒ—mšg


688 ğ
	`IsMuÉiÿ¡Add»ss
(
cÚÃùiÚAdd»ss
è|| (cÚÃùiÚAdd»s =ğ0 && 
fÜûMuÉiÿ¡OnUn¥ecif›d
);

689 
Œª¥ÜtTy³SŒ
 = 
»que¡MuÉiÿ¡SŒ—mšg
 ? ";multicast" : ";unicast";

690 
pÜtTy³SŒ
 = 
»que¡MuÉiÿ¡SŒ—mšg
 ? ";port" : ";client_port";

691 
¹pNumb”
 = 
sub£ssiÚ
.
	`ş›ÁPÜtNum
();

692 ià(
¹pNumb”
 == 0) {

693 
	`’vœ
().
	`£tResuÉMsg
("Client…ort‚umber unknown\n");

694 
d–‘e
[] 
cmdURL
;

695  
F®£
;

697 
¹ıNumb”
 = 
sub£ssiÚ
.
	`¹ıIsMuxed
(è? 
¹pNumb”
 :„tpNumber + 1;

699 
Œª¥ÜtSize
 = 
	`¡¾’
(
Œª¥ÜtFmt
)

700 + 
	`¡¾’
(
Œª¥ÜtTy³SŒ
è+ sŒËn(
modeSŒ
è+ sŒËn(
pÜtTy³SŒ
) + 2*5 ;

701 * 
Œª¥ÜtSŒ
 = 
Ãw
 [
Œª¥ÜtSize
];

702 
	`¥rštf
(
Œª¥ÜtSŒ
, 
Œª¥ÜtFmt
,

703 
Œª¥ÜtTy³SŒ
, 
modeSŒ
, 
pÜtTy³SŒ
, 
¹pNumb”
, 
¹ıNumb”
);

706 * 
£ssiÚSŒ
 = 
	`ü—‹SessiÚSŒšg
(
fLa¡SessiÚId
);

709 * 
blocksizeSŒ
 = 
	`ü—‹BlocksizeSŒšg
(
¡»amUsšgTCP
);

713 
exŒaH—d”s
 = 
Ãw
 [
Œª¥ÜtSize
 + 
	`¡¾’
(
£ssiÚSŒ
è+ sŒËn(
blocksizeSŒ
)];

714 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

715 
	`¥rštf
(
exŒaH—d”s
, "%s%s%s", 
Œª¥ÜtSŒ
, 
£ssiÚSŒ
, 
blocksizeSŒ
);

716 
d–‘e
[] 
Œª¥ÜtSŒ
; d–‘e[] 
£ssiÚSŒ
; d–‘e[] 
blocksizeSŒ
;

717 } ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "GET") == 0 || strcmp(request->commandName(), "POST") == 0) {

721 * 
u£ºame
;

722 * 
·sswÜd
;

723 
N‘Add»ss
 
de¡Add»ss
;

724 
pÜtNumB™s
 
u¾PÜtNum
;

725 ià(!
	`·r£RTSPURL
(
	`’vœ
(), 
fBa£URL
, 
u£ºame
, 
·sswÜd
, 
de¡Add»ss
, 
u¾PÜtNum
, (cÚ¡**)&
cmdURL
)è 
F®£
;

726 ià(
cmdURL
[0] == '\0') cmdURL = (*)"/";

727 
d–‘e
[] 
u£ºame
;

728 
d–‘e
[] 
·sswÜd
;

729 
ÃtAdd»ssB™s
 
£rv”Add»ss
 = *Ò‘Add»ssB™s*)(
de¡Add»ss
.
	`d©a
());

730 
Add»ssSŒšg
 
	`£rv”Add»ssSŒšg
(
£rv”Add»ss
);

732 
´ÙocŞSŒ
 = "HTTP/1.1";

734 ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "GET") == 0) {

737 
timev®
 
time¡amp
;

738 
couÁ”
;

739 } 
£edD©a
;

740 
	`g‘timeofday
(&
£edD©a
.
time¡amp
, 
NULL
);

741 
£edD©a
.
couÁ”
 = ++
fSessiÚCook›CouÁ”
;

742 
	`our_MD5D©a
((*)(&
£edD©a
),  s“dD©a, 
fSessiÚCook›
);

744 
fSessiÚCook›
[23] = '\0';

746 cÚ¡* cÚ¡ 
exŒaH—d”sFmt
 =

752 
exŒaH—d”sSize
 = 
	`¡¾’
(
exŒaH—d”sFmt
)

753 + 
	`¡¾’
(
£rv”Add»ssSŒšg
.
	`v®
())

754 + 
	`¡¾’
(
fSessiÚCook›
);

755 
exŒaH—d”s
 = 
Ãw
 [
exŒaH—d”sSize
];

756 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

757 
	`¥rštf
(
exŒaH—d”s
, 
exŒaH—d”sFmt
,

758 
£rv”Add»ssSŒšg
.
	`v®
(),

759 
fSessiÚCook›
);

761 cÚ¡* cÚ¡ 
exŒaH—d”sFmt
 =

769 
exŒaH—d”sSize
 = 
	`¡¾’
(
exŒaH—d”sFmt
)

770 + 
	`¡¾’
(
£rv”Add»ssSŒšg
.
	`v®
())

771 + 
	`¡¾’
(
fSessiÚCook›
);

772 
exŒaH—d”s
 = 
Ãw
 [
exŒaH—d”sSize
];

773 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

774 
	`¥rštf
(
exŒaH—d”s
, 
exŒaH—d”sFmt
,

775 
£rv”Add»ssSŒšg
.
	`v®
(),

776 
fSessiÚCook›
);

780 ià(
fLa¡SessiÚId
 =ğ
NULL
) {

781 
	`’vœ
().
	`£tResuÉMsg
("No RTSP session is currently in…rogress\n");

782  
F®£
;

785 cÚ¡* 
£ssiÚId
;

786 
Üigš®SÿË
;

787 ià(
»que¡
->
	`£ssiÚ
(è!ğ
NULL
) {

789 
cmdURL
 = (*)
	`£ssiÚURL
(*
»que¡
->
	`£ssiÚ
());

791 
£ssiÚId
 = 
fLa¡SessiÚId
;

792 
Üigš®SÿË
 = 
»que¡
->
	`£ssiÚ
()->
	`sÿË
();

795 cÚ¡ *
´efix
, *
£·¿tÜ
, *
suffix
;

796 
	`cÚ¡ruùSub£ssiÚURL
(*
»que¡
->
	`sub£ssiÚ
(), 
´efix
, 
£·¿tÜ
, 
suffix
);

797 
cmdURL
 = 
Ãw
 [
	`¡¾’
(
´efix
è+ sŒËn(
£·¿tÜ
è+ sŒËn(
suffix
) + 1];

798 
cmdURLWasAÎoÿ‹d
 = 
True
;

799 
	`¥rštf
(
cmdURL
, "%s%s%s", 
´efix
, 
£·¿tÜ
, 
suffix
);

801 
£ssiÚId
 = 
»que¡
->
	`sub£ssiÚ
()->
	`£ssiÚId
();

802 
Üigš®SÿË
 = 
»que¡
->
	`sub£ssiÚ
()->
	`sÿË
();

805 ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "PLAY") == 0) {

808 * 
£ssiÚSŒ
 = 
	`ü—‹SessiÚSŒšg
(
£ssiÚId
);

809 * 
sÿËSŒ
 = 
	`ü—‹SÿËSŒšg
(
»que¡
->
	`sÿË
(), 
Üigš®SÿË
);

810 
¥“d
 = 
»que¡
->
	`£ssiÚ
(è!ğ
NULL
 ?„eque¡->£ssiÚ()->
	`¥“d
(è:„eque¡->
	`sub£ssiÚ
()->speed();

811 * 
¥“dSŒ
 = 
	`ü—‹S³edSŒšg
(
¥“d
);

812 * 
¿ngeSŒ
 = 
	`ü—‹RªgeSŒšg
(
»que¡
->
	`¡¬t
(),„eque¡->
	`’d
(),„eque¡->
	`absS¹Time
(),„eque¡->
	`absEndTime
());

813 
exŒaH—d”s
 = 
Ãw
 [
	`¡¾’
(
£ssiÚSŒ
è+ sŒËn(
sÿËSŒ
è+ sŒËn(
¥“dSŒ
è+ sŒËn(
¿ngeSŒ
) + 1];

814 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

815 
	`¥rštf
(
exŒaH—d”s
, "%s%s%s%s", 
£ssiÚSŒ
, 
sÿËSŒ
, 
¥“dSŒ
, 
¿ngeSŒ
);

816 
d–‘e
[] 
£ssiÚSŒ
; d–‘e[] 
sÿËSŒ
; d–‘e[] 
¥“dSŒ
; d–‘e[] 
¿ngeSŒ
;

819 
exŒaH—d”s
 = 
	`ü—‹SessiÚSŒšg
(
£ssiÚId
);

820 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

824  
True
;

825 
	}
}

827 
BoŞ—n
 
	gRTSPCl›Á
::
	$isRTSPCl›Á
() const {

828  
True
;

829 
	}
}

831 
	gRTSPCl›Á
::
	$»£tTCPSock‘s
() {

832 ià(
fIÅutSock‘Num
 >= 0) {

833 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fIÅutSock‘Num
);

834 ::
	`şo£Sock‘
(
fIÅutSock‘Num
);

835 ià(
fOuutSock‘Num
 !ğ
fIÅutSock‘Num
) {

836 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fOuutSock‘Num
);

837 ::
	`şo£Sock‘
(
fOuutSock‘Num
);

840 
fIÅutSock‘Num
 = 
fOuutSock‘Num
 = -1;

841 
	}
}

843 
	gRTSPCl›Á
::
	$»£tRe¥Ú£Bufãr
() {

844 
fRe¥Ú£By‹sAÌ—dyS“n
 = 0;

845 
fRe¥Ú£BufãrBy‹sLeá
 = 
»¥Ú£BufãrSize
;

846 
	}
}

848 
	gRTSPCl›Á
::
	$İ’CÚÃùiÚ
() {

852 * 
u£ºame
;

853 * 
·sswÜd
;

854 
N‘Add»ss
 
de¡Add»ss
;

855 
pÜtNumB™s
 
u¾PÜtNum
;

856 cÚ¡* 
u¾Suffix
;

857 ià(!
	`·r£RTSPURL
(
	`’vœ
(), 
fBa£URL
, 
u£ºame
, 
·sswÜd
, 
de¡Add»ss
, 
u¾PÜtNum
, &
u¾Suffix
)) ;

858 
pÜtNumB™s
 
de¡PÜtNum
 = 
fTuÂ–Ov”HTTPPÜtNum
 =ğ0 ? 
u¾PÜtNum
 : fTunnelOverHTTPPortNum;

859 ià(
u£ºame
 !ğ
NULL
 || 
·sswÜd
 != NULL) {

860 
fCu¼’tAuth’tiÿtÜ
.
	`£tU£ºameAndPasswÜd
(
u£ºame
, 
·sswÜd
);

861 
d–‘e
[] 
u£ºame
;

862 
d–‘e
[] 
·sswÜd
;

866 
fIÅutSock‘Num
 = 
fOuutSock‘Num
 = 
	`£tupSŒ—mSock‘
(
	`’vœ
(), 0);

867 ià(
fIÅutSock‘Num
 < 0) ;

868 
	`ignÜeSigPeOnSock‘
(
fIÅutSock‘Num
);

871 
fS”v”Add»ss
 = *(
ÃtAdd»ssB™s
*)(
de¡Add»ss
.
	`d©a
());

872 
cÚÃùResuÉ
 = 
	`cÚÃùToS”v”
(
fIÅutSock‘Num
, 
de¡PÜtNum
);

873 ià(
cÚÃùResuÉ
 < 0) ;

874 ià(
cÚÃùResuÉ
 > 0) {

876 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fIÅutSock‘Num
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
,

877 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgD©aHªdËr
, 
this
);

879  
cÚÃùResuÉ
;

882 
	`»£tTCPSock‘s
();

884 
	}
}

886 
	gRTSPCl›Á
::
	$cÚÃùToS”v”
(
sock‘Num
, 
pÜtNumB™s
 
»mÙePÜtNum
) {

887 
	`MAKE_SOCKADDR_IN
(
»mÙeName
, 
fS”v”Add»ss
, 
	`htÚs
(
»mÙePÜtNum
));

888 ià(
fV”bos™yLev–
 >= 1) {

889 
	`’vœ
(è<< "O³nšg cÚÃùiÚØ" << 
	`Add»ssSŒšg
(
»mÙeName
).
	`v®
(è<< ",…Üˆ" << 
»mÙePÜtNum
 << "...\n";

891 ià(
	`cÚÃù
(
sock‘Num
, (
sockaddr
*è&
»mÙeName
, „emoteName) != 0) {

892 cÚ¡ 
”r
 = 
	`’vœ
().
	`g‘E¼no
();

893 ià(
”r
 =ğ
EINPROGRESS
 ||ƒ¼ =ğ
EWOULDBLOCK
) {

895 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
sock‘Num
, 
SOCKET_WRITABLE
|
SOCKET_EXCEPTION
,

896 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
cÚÃùiÚHªdËr
, 
this
);

899 
	`’vœ
().
	`£tResuÉE¼Msg
("connect() failed: ");

900 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
(è<< "..." <<ƒnvœ().
	`g‘ResuÉMsg
() << "\n";

903 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
() << "...local connection opened\n";

906 
	}
}

908 * 
	gRTSPCl›Á
::
	$ü—‹Auth’tiÿtÜSŒšg
(cÚ¡* 
cmd
, cÚ¡* 
u¾
) {

909 
Auth’tiÿtÜ
& 
auth
 = 
fCu¼’tAuth’tiÿtÜ
;

910 ià(
auth
.
	`»®m
(è!ğ
NULL
 &&‡uth.
	`u£ºame
(è!ğNULL &&‡uth.
	`·sswÜd
() != NULL) {

912 * 
auth’tiÿtÜSŒ
;

913 ià(
auth
.
	`nÚû
(è!ğ
NULL
) {

914 cÚ¡* cÚ¡ 
authFmt
 =

917 cÚ¡* 
»¥Ú£
 = 
auth
.
	`compu‹Dige¡Re¥Ú£
(
cmd
, 
u¾
);

918 
authBufSize
 = 
	`¡¾’
(
authFmt
)

919 + 
	`¡¾’
(
auth
.
	`u£ºame
()è+ sŒËn×uth.
	`»®m
())

920 + 
	`¡¾’
(
auth
.
	`nÚû
()è+ sŒËn(
u¾
è+ sŒËn(
»¥Ú£
);

921 
auth’tiÿtÜSŒ
 = 
Ãw
 [
authBufSize
];

922 
	`¥rštf
(
auth’tiÿtÜSŒ
, 
authFmt
,

923 
auth
.
	`u£ºame
(),‡uth.
	`»®m
(),

924 
auth
.
	`nÚû
(), 
u¾
, 
»¥Ú£
);

925 
auth
.
	`»şaimDige¡Re¥Ú£
(
»¥Ú£
);

927 cÚ¡* cÚ¡ 
authFmt
 = "Authorization: Basic %s\r\n";

929 
u£ºamePasswÜdL’gth
 = 
	`¡¾’
(
auth
.
	`u£ºame
()è+ 1 + sŒËn×uth.
	`·sswÜd
());

930 * 
u£ºamePasswÜd
 = 
Ãw
 [
u£ºamePasswÜdL’gth
+1];

931 
	`¥rštf
(
u£ºamePasswÜd
, "%s:%s", 
auth
.
	`u£ºame
(),‡uth.
	`·sswÜd
());

933 * 
»¥Ú£
 = 
	`ba£64Encode
(
u£ºamePasswÜd
, 
u£ºamePasswÜdL’gth
);

934 cÚ¡ 
authBufSize
 = 
	`¡¾’
(
authFmt
è+ sŒËn(
»¥Ú£
) + 1;

935 
auth’tiÿtÜSŒ
 = 
Ãw
 [
authBufSize
];

936 
	`¥rštf
(
auth’tiÿtÜSŒ
, 
authFmt
, 
»¥Ú£
);

937 
d–‘e
[] 
»¥Ú£
; d–‘e[] 
u£ºamePasswÜd
;

940  
auth’tiÿtÜSŒ
;

944  
	`¡rDup
("");

945 
	}
}

947 * 
	gRTSPCl›Á
::
	$ü—‹BlocksizeSŒšg
(
BoŞ—n
 
¡»amUsšgTCP
) {

948 * 
blocksizeSŒ
;

949 
u_št16_t
 
maxPack‘Size
 = 
desœedMaxIncomšgPack‘Size
;

953 
u_št16_t
 cÚ¡ 
h—d”AÎowªû
 = 
¡»amUsšgTCP
 ? 12 : 50 ;

954 ià(
maxPack‘Size
 < 
h—d”AÎowªû
) {

955 
maxPack‘Size
 = 0;

957 
maxPack‘Size
 -ğ
h—d”AÎowªû
;

960 ià(
maxPack‘Size
 > 0) {

961 
blocksizeSŒ
 = 
Ãw
 [25];

962 
	`¥rštf
(
blocksizeSŒ
, "Blocksize: %u\r\n", 
maxPack‘Size
);

964 
blocksizeSŒ
 = 
	`¡rDup
("");

966  
blocksizeSŒ
;

967 
	}
}

969 
	gRTSPCl›Á
::
	$hªdËReque¡E¼Ü
(
Reque¡RecÜd
* 
»que¡
) {

970 
»suÉCode
 = -
	`’vœ
().
	`g‘E¼no
();

971 ià(
»suÉCode
 == 0) {

973 #ià
	`defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_QNX4
)

974 
»suÉCode
 = -
WSAENOTCONN
;

976 
»suÉCode
 = -
ENOTCONN
;

979 ià(
»que¡
->
	`hªdËr
(è!ğ
NULL
è(*»que¡->hªdËr())(
this
, 
»suÉCode
, 
	`¡rDup
(
	`’vœ
().
	`g‘ResuÉMsg
()));

980 
	}
}

982 
BoŞ—n
 
	gRTSPCl›Á


983 ::
	$·r£Re¥Ú£Code
(cÚ¡* 
lše
, & 
»¥Ú£Code
, cÚ¡*& 
»¥Ú£SŒšg
) {

984 ià(
	`ssÿnf
(
lše
, "RTSP/%*s%u", &
»¥Ú£Code
) != 1 &&

985 
	`ssÿnf
(
lše
, "HTTP/%*s%u", &
»¥Ú£Code
è!ğ1è 
F®£
;

990 
»¥Ú£SŒšg
 = 
lše
;

991 
»¥Ú£SŒšg
[0] != '\0' &&„esponseString[0] != ' ' &&„esponseString[0] != '\t') ++responseString;

992 
»¥Ú£SŒšg
[0] != '\0' && (responseString[0] == ' ' ||„esponseString[0] == '\t')) ++responseString;

994  
True
;

995 
	}
}

997 
	gRTSPCl›Á
::
	$hªdËIncomšgReque¡
() {

999 
cmdName
[
RTSP_PARAM_STRING_MAX
];

1000 
u¾P»Suffix
[
RTSP_PARAM_STRING_MAX
];

1001 
u¾Suffix
[
RTSP_PARAM_STRING_MAX
];

1002 
c£q
[
RTSP_PARAM_STRING_MAX
];

1003 
£ssiÚId
[
RTSP_PARAM_STRING_MAX
];

1004 
cÚ‹ÁL’gth
;

1005 ià(!
	`·r£RTSPReque¡SŒšg
(
fRe¥Ú£Bufãr
, 
fRe¥Ú£By‹sAÌ—dyS“n
,

1006 
cmdName
,  cmdName,

1007 
u¾P»Suffix
,  urlPreSuffix,

1008 
u¾Suffix
,  urlSuffix,

1009 
c£q
,  cseq,

1010 
£ssiÚId
,  sessionId,

1011 
cÚ‹ÁL’gth
)) {

1014 ià(
fV”bos™yLev–
 >= 1) {

1015 
	`’vœ
(è<< "Reûived incomšg RTSP„eque¡: " << 
fRe¥Ú£Bufãr
 << "\n";

1017 
tmpBuf
[2*
RTSP_PARAM_STRING_MAX
];

1018 
	`¢´štf
((*)
tmpBuf
, mpBuf,

1019 "RTSP/1.0 405 M‘hod NÙ AÎowed\r\nCSeq: %s\r\n\r\n", 
c£q
);

1020 
	`£nd
(
fOuutSock‘Num
, 
tmpBuf
, 
	`¡¾’
(tmpBuf), 0);

1022 
	}
}

1024 
BoŞ—n
 
	gRTSPCl›Á
::
	$checkFÜH—d”
(cÚ¡* 
lše
, cÚ¡* 
h—d”Name
, 
h—d”NameL’gth
, cÚ¡*& 
h—d”P¬ams
) {

1025 ià(
	`_¡ºÿ£cmp
(
lše
, 
h—d”Name
, 
h—d”NameL’gth
è!ğ0è 
F®£
;

1028 
·¿mIndex
 = 
h—d”NameL’gth
;

1029 
lše
[
·¿mIndex
] != '\0' && (line[paramIndex] == ' ' ||†ine[paramIndex] == '\t')) ++paramIndex;

1030 ià(
lše
[
·¿mIndex
] =ğ'\0'è 
F®£
;

1032 
h—d”P¬ams
 = &
lše
[
·¿mIndex
];

1033  
True
;

1034 
	}
}

1036 
BoŞ—n
 
	gRTSPCl›Á
::
	$·r£T¿n¥ÜtP¬ams
(cÚ¡* 
·¿msSŒ
,

1037 *& 
£rv”Add»ssSŒ
, 
pÜtNumB™s
& 
£rv”PÜtNum
,

1038 & 
¹pChªÃlId
, & 
¹ıChªÃlId
) {

1040 
£rv”Add»ssSŒ
 = 
NULL
;

1041 
£rv”PÜtNum
 = 0;

1042 
¹pChªÃlId
 = 
¹ıChªÃlId
 = 0xFF;

1043 ià(
·¿msSŒ
 =ğ
NULL
è 
F®£
;

1045 * 
foundS”v”Add»ssSŒ
 = 
NULL
;

1046 
BoŞ—n
 
foundS”v”PÜtNum
 = 
F®£
;

1047 
pÜtNumB™s
 
ş›ÁPÜtNum
 = 0;

1048 
BoŞ—n
 
foundCl›ÁPÜtNum
 = 
F®£
;

1049 
BoŞ—n
 
foundChªÃlIds
 = 
F®£
;

1050 
¹pCid
, 
¹ıCid
;

1051 
BoŞ—n
 
isMuÉiÿ¡
 = 
True
;

1052 * 
foundDe¡š©iÚSŒ
 = 
NULL
;

1053 
pÜtNumB™s
 
muÉiÿ¡PÜtNumRTP
, 
muÉiÿ¡PÜtNumRTCP
;

1054 
BoŞ—n
 
foundMuÉiÿ¡PÜtNum
 = 
F®£
;

1057 cÚ¡* 
f›lds
 = 
·¿msSŒ
;

1058 * 
f›ld
 = 
	`¡rDupSize
(
f›lds
);

1059 
	`ssÿnf
(
f›lds
, "%[^;]", 
f›ld
) == 1) {

1060 ià(
	`ssÿnf
(
f›ld
, "£rv”_pÜt=%hu", &
£rv”PÜtNum
) == 1) {

1061 
foundS”v”PÜtNum
 = 
True
;

1062 } ià(
	`ssÿnf
(
f›ld
, "ş›Á_pÜt=%hu", &
ş›ÁPÜtNum
) == 1) {

1063 
foundCl›ÁPÜtNum
 = 
True
;

1064 } ià(
	`_¡ºÿ£cmp
(
f›ld
, "source=", 7) == 0) {

1065 
d–‘e
[] 
foundS”v”Add»ssSŒ
;

1066 
foundS”v”Add»ssSŒ
 = 
	`¡rDup
(
f›ld
+7);

1067 } ià(
	`ssÿnf
(
f›ld
, "š‹¾—ved=%u-%u", &
¹pCid
, &
¹ıCid
) == 2) {

1068 
¹pChªÃlId
 = ()
¹pCid
;

1069 
¹ıChªÃlId
 = ()
¹ıCid
;

1070 
foundChªÃlIds
 = 
True
;

1071 } ià(
	`¡rcmp
(
f›ld
, "unicast") == 0) {

1072 
isMuÉiÿ¡
 = 
F®£
;

1073 } ià(
	`_¡ºÿ£cmp
(
f›ld
, "destination=", 12) == 0) {

1074 
d–‘e
[] 
foundDe¡š©iÚSŒ
;

1075 
foundDe¡š©iÚSŒ
 = 
	`¡rDup
(
f›ld
+12);

1076 } ià(
	`ssÿnf
(
f›ld
, "pÜt=%hu-%hu", &
muÉiÿ¡PÜtNumRTP
, &
muÉiÿ¡PÜtNumRTCP
) == 2 ||

1077 
	`ssÿnf
(
f›ld
, "pÜt=%hu", &
muÉiÿ¡PÜtNumRTP
) == 1) {

1078 
foundMuÉiÿ¡PÜtNum
 = 
True
;

1081 
f›lds
 +ğ
	`¡¾’
(
f›ld
);

1082 
f›lds
[0] == ';') ++fields;

1083 ià(
f›lds
[0] == '\0') ;

1085 
d–‘e
[] 
f›ld
;

1090 ià(
isMuÉiÿ¡
 && 
foundDe¡š©iÚSŒ
 !ğ
NULL
 && 
foundMuÉiÿ¡PÜtNum
) {

1091 
d–‘e
[] 
foundS”v”Add»ssSŒ
;

1092 
£rv”Add»ssSŒ
 = 
foundDe¡š©iÚSŒ
;

1093 
£rv”PÜtNum
 = 
muÉiÿ¡PÜtNumRTP
;

1094  
True
;

1096 
d–‘e
[] 
foundDe¡š©iÚSŒ
;

1103 ià(
foundChªÃlIds
 || 
foundS”v”PÜtNum
 || 
foundCl›ÁPÜtNum
) {

1104 ià(
foundCl›ÁPÜtNum
 && !
foundS”v”PÜtNum
) {

1105 
£rv”PÜtNum
 = 
ş›ÁPÜtNum
;

1107 
£rv”Add»ssSŒ
 = 
foundS”v”Add»ssSŒ
;

1108  
True
;

1111 
d–‘e
[] 
foundS”v”Add»ssSŒ
;

1112  
F®£
;

1113 
	}
}

1115 
BoŞ—n
 
	gRTSPCl›Á
::
	$·r£SÿËP¬am
(cÚ¡* 
·¿mSŒ
, & 
sÿË
) {

1116 
LoÿË
 
	`l
("C", 
Num”ic
);

1117  
	`ssÿnf
(
·¿mSŒ
, "%f", &
sÿË
) == 1;

1118 
	}
}

1120 
BoŞ—n
 
	gRTSPCl›Á
::
	$·r£S³edP¬am
(cÚ¡* 
·¿mSŒ
, & 
¥“d
) {

1121 
LoÿË
 
	`l
("C", 
Num”ic
);

1122  
	`ssÿnf
(
·¿mSŒ
, "%f", &
¥“d
) >= 1;

1123 
	}
}

1125 
BoŞ—n
 
	gRTSPCl›Á
::
	$·r£RTPInfoP¬ams
(cÚ¡*& 
·¿msSŒ
, 
u_št16_t
& 
£qNum
, 
u_št32_t
& 
time¡amp
) {

1126 ià(
·¿msSŒ
 =ğ
NULL
 ||…¬amsSŒ[0] =ğ'\0'è 
F®£
;

1127 
·¿msSŒ
[0] == ',') ++paramsStr;

1130 * 
f›ld
 = 
	`¡rDupSize
(
·¿msSŒ
);

1132 
BoŞ—n
 
§wSeq
 = 
F®£
, 
§wRtime
 = False;

1133 
	`ssÿnf
(
·¿msSŒ
, "%[^;,]", 
f›ld
) == 1) {

1134 ià(
	`ssÿnf
(
f›ld
, "£q=%hu", &
£qNum
) == 1) {

1135 
§wSeq
 = 
True
;

1136 } ià(
	`ssÿnf
(
f›ld
, "¹±ime=%u", &
time¡amp
) == 1) {

1137 
§wRtime
 = 
True
;

1140 
·¿msSŒ
 +ğ
	`¡¾’
(
f›ld
);

1141 ià(
·¿msSŒ
[0] == '\0' ||…aramsStr[0] == ',') ;

1143 ++
·¿msSŒ
;

1146 
d–‘e
[] 
f›ld
;

1148  
§wSeq
 && 
§wRtime
;

1149 
	}
}

1151 
BoŞ—n
 
	gRTSPCl›Á
::
	$hªdËSETUPRe¥Ú£
(
MedŸSub£ssiÚ
& 
sub£ssiÚ
, cÚ¡* 
£ssiÚP¬amsSŒ
, cÚ¡* 
Œª¥ÜtP¬amsSŒ
,

1152 
BoŞ—n
 
¡»amUsšgTCP
) {

1153 * 
£ssiÚId
 = 
Ãw
 [
»¥Ú£BufãrSize
];

1154 
BoŞ—n
 
sucûss
 = 
F®£
;

1157 ià(
£ssiÚP¬amsSŒ
 =ğ
NULL
 || 
	`ssÿnf
(£ssiÚP¬amsSŒ, "%[^;]", 
£ssiÚId
) != 1) {

1158 
	`’vœ
().
	`£tResuÉMsg
("Missing or bad \"Session:\" header");

1161 
sub£ssiÚ
.
	`£tSessiÚId
(
£ssiÚId
);

1162 
d–‘e
[] 
fLa¡SessiÚId
; fLa¡SessiÚId = 
	`¡rDup
(
£ssiÚId
);

1165 cÚ¡* 
aá”SessiÚId
 = 
£ssiÚP¬amsSŒ
 + 
	`¡¾’
(
£ssiÚId
);

1166 
timeoutV®
;

1167 ià(
	`ssÿnf
(
aá”SessiÚId
, ";imeouˆğ%d", &
timeoutV®
) == 1) {

1168 
fSessiÚTimeoutP¬am‘”
 = 
timeoutV®
;

1172 * 
£rv”Add»ssSŒ
;

1173 
pÜtNumB™s
 
£rv”PÜtNum
;

1174 
¹pChªÃlId
, 
¹ıChªÃlId
;

1175 ià(!
	`·r£T¿n¥ÜtP¬ams
(
Œª¥ÜtP¬amsSŒ
, 
£rv”Add»ssSŒ
, 
£rv”PÜtNum
, 
¹pChªÃlId
, 
¹ıChªÃlId
)) {

1176 
	`’vœ
().
	`£tResuÉMsg
("Missing or bad \"Transport:\" header");

1179 
d–‘e
[] 
sub£ssiÚ
.
	`cÚÃùiÚEndpoštName
();

1180 
sub£ssiÚ
.
	`cÚÃùiÚEndpoštName
(èğ
£rv”Add»ssSŒ
;

1181 
sub£ssiÚ
.
£rv”PÜtNum
 = serverPortNum;

1182 
sub£ssiÚ
.
¹pChªÃlId
 =„tpChannelId;

1183 
sub£ssiÚ
.
¹ıChªÃlId
 =„tcpChannelId;

1185 ià(
¡»amUsšgTCP
) {

1187 ià(
sub£ssiÚ
.
	`¹pSourû
(è!ğ
NULL
) {

1188 
sub£ssiÚ
.
	`¹pSourû
()->
	`£tSŒ—mSock‘
(
fIÅutSock‘Num
, sub£ssiÚ.
¹pChªÃlId
);

1190 
sub£ssiÚ
.
	`¹pSourû
()->
	`’abËRTCPR•Üts
(èğ
F®£
;

1193 ià(
sub£ssiÚ
.
	`¹ıIn¡ªû
(è!ğ
NULL
èsub£ssiÚ.¹ıIn¡ªû()->
	`£tSŒ—mSock‘
(
fIÅutSock‘Num
, sub£ssiÚ.
¹ıChªÃlId
);

1194 
RTPIÁ”çû
::
	`£tS”v”Reque¡AÉ”ÇtiveBy‹HªdËr
(
	`’vœ
(), 
fIÅutSock‘Num
, 
hªdËAÉ”ÇtiveReque¡By‹
, 
this
);

1198 
ÃtAdd»ssB™s
 
de¡Add»ss
 = 
sub£ssiÚ
.
	`cÚÃùiÚEndpoštAdd»ss
();

1199 ià(
de¡Add»ss
 =ğ0ède¡Add»s ğ
fS”v”Add»ss
;

1200 
sub£ssiÚ
.
	`£tDe¡š©iÚs
(
de¡Add»ss
);

1203 
sucûss
 = 
True
;

1206 
d–‘e
[] 
£ssiÚId
;

1207  
sucûss
;

1208 
	}
}

1210 
BoŞ—n
 
	gRTSPCl›Á
::
	$hªdËPLAYRe¥Ú£
(
MedŸSessiÚ
& 
£ssiÚ
, 
MedŸSub£ssiÚ
& 
sub£ssiÚ
,

1211 cÚ¡* 
sÿËP¬amsSŒ
, cÚ¡* 
¥“dP¬amsSŒ
,

1212 cÚ¡* 
¿ngeP¬amsSŒ
, cÚ¡* 
¹pInfoP¬amsSŒ
) {

1213 
BoŞ—n
 
sÿËOK
 = 
F®£
, 
¿ngeOK
 = F®£, 
¥“dOK
 = False;

1215 ià(&
£ssiÚ
 !ğ
NULL
) {

1217 ià(
sÿËP¬amsSŒ
 !ğ
NULL
 && !
	`·r£SÿËP¬am
(sÿËP¬amsSŒ, 
£ssiÚ
.
	`sÿË
())) ;

1218 
sÿËOK
 = 
True
;

1219 ià(
¥“dP¬amsSŒ
 !ğ
NULL
 && !
	`·r£S³edP¬am
(¥“dP¬amsSŒ, 
£ssiÚ
.
	`¥“d
())) ;

1220 
¥“dOK
 = 
True
;

1221 
BoŞ—n
 
¡¬tTimeIsNow
;

1222 ià(
¿ngeP¬amsSŒ
 !ğ
NULL
 &&

1223 !
	`·r£RªgeP¬am
(
¿ngeP¬amsSŒ
,

1224 
£ssiÚ
.
	`¶ayS¹Time
(), sessiÚ.
	`¶ayEndTime
(),

1225 
£ssiÚ
.
	`_absS¹Time
(), sessiÚ.
	`_absEndTime
(),

1226 
¡¬tTimeIsNow
)) ;

1227 
¿ngeOK
 = 
True
;

1229 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
£ssiÚ
);

1230 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

1231 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1232 
u_št16_t
 
£qNum
; 
u_št32_t
 
time¡amp
;

1233 
sub£ssiÚ
->
¹pInfo
.
šfoIsNew
 = 
F®£
;

1234 ià(
	`·r£RTPInfoP¬ams
(
¹pInfoP¬amsSŒ
, 
£qNum
, 
time¡amp
)) {

1235 
sub£ssiÚ
->
¹pInfo
.
£qNum
 = seqNum;

1236 
sub£ssiÚ
->
¹pInfo
.
time¡amp
 =imestamp;

1237 
sub£ssiÚ
->
¹pInfo
.
šfoIsNew
 = 
True
;

1240 ià(
sub£ssiÚ
->
	`¹pSourû
(è!ğ
NULL
èsub£ssiÚ->¹pSourû()->
	`’abËRTCPR•Üts
(èğ
True
;

1244 ià(
sÿËP¬amsSŒ
 !ğ
NULL
 && !
	`·r£SÿËP¬am
(sÿËP¬amsSŒ, 
sub£ssiÚ
.
	`sÿË
())) ;

1245 
sÿËOK
 = 
True
;

1246 ià(
¥“dP¬amsSŒ
 !ğ
NULL
 && !
	`·r£S³edP¬am
(¥“dP¬amsSŒ, 
£ssiÚ
.
	`¥“d
())) ;

1247 
¥“dOK
 = 
True
;

1248 
BoŞ—n
 
¡¬tTimeIsNow
;

1249 ià(
¿ngeP¬amsSŒ
 !ğ
NULL
 &&

1250 !
	`·r£RªgeP¬am
(
¿ngeP¬amsSŒ
,

1251 
sub£ssiÚ
.
	`_¶ayS¹Time
(), sub£ssiÚ.
	`_¶ayEndTime
(),

1252 
sub£ssiÚ
.
	`_absS¹Time
(), sub£ssiÚ.
	`_absEndTime
(),

1253 
¡¬tTimeIsNow
)) ;

1254 
¿ngeOK
 = 
True
;

1256 
u_št16_t
 
£qNum
; 
u_št32_t
 
time¡amp
;

1257 
sub£ssiÚ
.
¹pInfo
.
šfoIsNew
 = 
F®£
;

1258 ià(
	`·r£RTPInfoP¬ams
(
¹pInfoP¬amsSŒ
, 
£qNum
, 
time¡amp
)) {

1259 
sub£ssiÚ
.
¹pInfo
.
£qNum
 = seqNum;

1260 
sub£ssiÚ
.
¹pInfo
.
time¡amp
 =imestamp;

1261 
sub£ssiÚ
.
¹pInfo
.
šfoIsNew
 = 
True
;

1264 ià(
sub£ssiÚ
.
	`¹pSourû
(è!ğ
NULL
èsub£ssiÚ.¹pSourû()->
	`’abËRTCPR•Üts
(èğ
True
;

1267  
True
;

1271 ià(!
sÿËOK
) {

1272 
	`’vœ
().
	`£tResuÉMsg
("Bad \"Scale:\" header");

1273 } ià(!
¥“dOK
) {

1274 
	`’vœ
().
	`£tResuÉMsg
("Bad \"Speed:\" header");

1275 } ià(!
¿ngeOK
) {

1276 
	`’vœ
().
	`£tResuÉMsg
("Bad \"Range:\" header");

1278 
	`’vœ
().
	`£tResuÉMsg
("Bad \"RTP-Info:\" header");

1280  
F®£
;

1281 
	}
}

1283 
BoŞ—n
 
	gRTSPCl›Á
::
	$hªdËTEARDOWNRe¥Ú£
(
MedŸSessiÚ
& , 
MedŸSub£ssiÚ
& ) {

1285  
True
;

1286 
	}
}

1288 
BoŞ—n
 
	gRTSPCl›Á
::
	$hªdËGET_PARAMETERRe¥Ú£
(cÚ¡* 
·¿m‘”Name
, *& 
»suÉV®ueSŒšg
, * 
»suÉV®ueSŒšgEnd
) {

1291 ià(
·¿m‘”Name
 !ğ
NULL
 &&…arameterName[0] != '\0') {

1292 ià(
·¿m‘”Name
[1] == '\0') ;

1294 
·¿m‘”NameL’
 = 
	`¡¾’
(
·¿m‘”Name
);

1296 
·¿m‘”NameL’
 -= 2;

1297 ià(
»suÉV®ueSŒšg
 + 
·¿m‘”NameL’
 > 
»suÉV®ueSŒšgEnd
) ;

1298 ià(
	`_¡ºÿ£cmp
(
»suÉV®ueSŒšg
, 
·¿m‘”Name
, 
·¿m‘”NameL’
) == 0) {

1299 
»suÉV®ueSŒšg
 +ğ
·¿m‘”NameL’
;

1301 ià(
»suÉV®ueSŒšg
 =ğ
»suÉV®ueSŒšgEnd
) ;

1303 ià(
»suÉV®ueSŒšg
[0] == ':') ++resultValueString;

1304 
»suÉV®ueSŒšg
 < 
»suÉV®ueSŒšgEnd


1305 && (
»suÉV®ueSŒšg
[0] == ' ' ||„esultValueString[0] == '\t')) {

1306 ++
»suÉV®ueSŒšg
;

1312 
§ved
 = *
»suÉV®ueSŒšgEnd
;

1313 *
»suÉV®ueSŒšgEnd
 = '\0';

1314 
»suÉL’
 = 
	`¡¾’
(
»suÉV®ueSŒšg
);

1315 *
»suÉV®ueSŒšgEnd
 = 
§ved
;

1317 
»suÉL’
 > 0 && (
»suÉV®ueSŒšg
[resultLen-1] == '\r' ||„esultValueString[resultLen-1] == '\n')) --resultLen;

1318 
»suÉV®ueSŒšg
[
»suÉL’
] = '\0';

1320  
True
;

1324 
	`’vœ
().
	`£tResuÉMsg
("Bad \"GET_PARAMETER\"„esponse");

1325  
F®£
;

1326 
	}
}

1328 
BoŞ—n
 
	gRTSPCl›Á
::
	$hªdËAuth’tiÿtiÚFau»
(cÚ¡* 
·¿msSŒ
) {

1329 ià(
·¿msSŒ
 =ğ
NULL
è 
F®£
;

1332 
BoŞ—n
 
»®mHasChªged
 = 
F®£
;

1333 
BoŞ—n
 
isSË
 = 
F®£
;

1334 * 
»®m
 = 
	`¡rDupSize
(
·¿msSŒ
);

1335 * 
nÚû
 = 
	`¡rDupSize
(
·¿msSŒ
);

1336 * 
¡®e
 = 
	`¡rDupSize
(
·¿msSŒ
);

1337 
BoŞ—n
 
sucûss
 = 
True
;

1338 ià(
	`ssÿnf
(
·¿msSŒ
, "Dige¡„—lm=\"%[^\"]\",‚Úû=\"%[^\"]\", sË=%[a-zA-Z]", 
»®m
, 
nÚû
, 
¡®e
) == 3) {

1339 
»®mHasChªged
 = 
fCu¼’tAuth’tiÿtÜ
.
	`»®m
(è=ğ
NULL
 || 
	`¡rcmp
(fCu¼’tAuth’tiÿtÜ.»®m(), 
»®m
) != 0;

1340 
isSË
 = 
	`_¡ºÿ£cmp
(
¡®e
, "true", 4) == 0;

1341 
fCu¼’tAuth’tiÿtÜ
.
	`£tR—lmAndNÚû
(
»®m
, 
nÚû
);

1342 } ià(
	`ssÿnf
(
·¿msSŒ
, "Dige¡„—lm=\"%[^\"]\",‚Úû=\"%[^\"]\"", 
»®m
, 
nÚû
) == 2) {

1343 
»®mHasChªged
 = 
fCu¼’tAuth’tiÿtÜ
.
	`»®m
(è=ğ
NULL
 || 
	`¡rcmp
(fCu¼’tAuth’tiÿtÜ.»®m(), 
»®m
) != 0;

1344 
fCu¼’tAuth’tiÿtÜ
.
	`£tR—lmAndNÚû
(
»®m
, 
nÚû
);

1345 } ià(
	`ssÿnf
(
·¿msSŒ
, "Basiø»®m=\"%[^\"]\"", 
»®m
è=ğ1 && 
fAÎowBasicAuth’tiÿtiÚ
) {

1346 
»®mHasChªged
 = 
fCu¼’tAuth’tiÿtÜ
.
	`»®m
(è=ğ
NULL
 || 
	`¡rcmp
(fCu¼’tAuth’tiÿtÜ.»®m(), 
»®m
) != 0;

1347 
fCu¼’tAuth’tiÿtÜ
.
	`£tR—lmAndNÚû
(
»®m
, 
NULL
);

1349 
sucûss
 = 
F®£
;

1351 
d–‘e
[] 
»®m
; d–‘e[] 
nÚû
; d–‘e[] 
¡®e
;

1353 ià(
sucûss
) {

1354 ià((!
»®mHasChªged
 && !
isSË
è|| 
fCu¼’tAuth’tiÿtÜ
.
	`u£ºame
(è=ğ
NULL
 || fCu¼’tAuth’tiÿtÜ.
	`·sswÜd
() == NULL) {

1358 
sucûss
 = 
F®£
;

1362  
sucûss
;

1363 
	}
}

1365 
BoŞ—n
 
	gRTSPCl›Á
::
	$»£ndCommªd
(
Reque¡RecÜd
* 
»que¡
) {

1366 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
() << "Resending...\n";

1367 ià(
»que¡
 !ğ
NULL
 && 
	`¡rcmp
Ôeque¡->
	`commªdName
(), "GET"è!ğ0è»que¡->
	`c£q
(èğ++
fCSeq
;

1368  
	`£ndReque¡
(
»que¡
) != 0;

1369 
	}
}

1371 cÚ¡* 
	gRTSPCl›Á
::
	$£ssiÚURL
(
MedŸSessiÚ
 cÚ¡& 
£ssiÚ
) const {

1372 cÚ¡* 
u¾
 = 
£ssiÚ
.
	`cÚŒŞP©h
();

1373 ià(
u¾
 =ğ
NULL
 || 
	`¡rcmp
(u¾, "*"è=ğ0èu¾ = 
fBa£URL
;

1375  
u¾
;

1376 
	}
}

1378 
	gRTSPCl›Á
::
	$hªdËAÉ”ÇtiveReque¡By‹
(* 
¹¥Cl›Á
, 
u_št8_t
 
»que¡By‹
) {

1379 ((
RTSPCl›Á
*)
¹¥Cl›Á
)->
	`hªdËAÉ”ÇtiveReque¡By‹1
(
»que¡By‹
);

1380 
	}
}

1382 
	gRTSPCl›Á
::
	$hªdËAÉ”ÇtiveReque¡By‹1
(
u_št8_t
 
»que¡By‹
) {

1383 ià(
»que¡By‹
 == 0xFF) {

1385 
	`hªdËRe¥Ú£By‹s
(-1);

1386 } ià(
»que¡By‹
 == 0xFE) {

1388 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fIÅutSock‘Num
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
,

1389 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgD©aHªdËr
, 
this
);

1392 
fRe¥Ú£Bufãr
[
fRe¥Ú£By‹sAÌ—dyS“n
] = 
»que¡By‹
;

1393 
	`hªdËRe¥Ú£By‹s
(1);

1395 
	}
}

1397 
BoŞ—n
 
	$isAbsŞu‹URL
(cÚ¡* 
u¾
) {

1400 *
u¾
 != '\0' && *url != '/') {

1401 ià(*
u¾
 =ğ':'è 
True
;

1402 ++
u¾
;

1405  
F®£
;

1406 
	}
}

1408 
	gRTSPCl›Á
::
	$cÚ¡ruùSub£ssiÚURL
(
MedŸSub£ssiÚ
 cÚ¡& 
sub£ssiÚ
,

1409 cÚ¡*& 
´efix
,

1410 cÚ¡*& 
£·¿tÜ
,

1411 cÚ¡*& 
suffix
) {

1423 
´efix
 = 
	`£ssiÚURL
(
sub£ssiÚ
.
	`·»ÁSessiÚ
());

1424 ià(
´efix
 =ğ
NULL
)…refix = "";

1426 
suffix
 = 
sub£ssiÚ
.
	`cÚŒŞP©h
();

1427 ià(
suffix
 =ğ
NULL
) suffix = "";

1429 ià(
	`isAbsŞu‹URL
(
suffix
)) {

1430 
´efix
 = 
£·¿tÜ
 = "";

1432 
´efixL’
 = 
	`¡¾’
(
´efix
);

1433 
£·¿tÜ
 = (
´efixL’
 =ğ0 || 
´efix
[´efixL’-1] =ğ'/' || 
suffix
[0] == '/') ? "" : "/";

1435 
	}
}

1437 
BoŞ—n
 
	gRTSPCl›Á
::
	$£tupHTTPTuÂ–šg1
() {

1440 ià(
fV”bos™yLev–
 >= 1) {

1441 
	`’vœ
(è<< "Reque¡šg RTSP-ov”-HTTPuÂ–šg (Ú…Üˆ" << 
fTuÂ–Ov”HTTPPÜtNum
 << ")\n\n";

1445  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(1, "GET", 
»¥Ú£HªdËrFÜHTTP_GET
)) != 0;

1446 
	}
}

1448 
	gRTSPCl›Á
::
	$»¥Ú£HªdËrFÜHTTP_GET
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»¥Ú£Code
, * 
»¥Ú£SŒšg
) {

1449 ià(
¹¥Cl›Á
 !ğ
NULL
è¹¥Cl›Á->
	`»¥Ú£HªdËrFÜHTTP_GET1
(
»¥Ú£Code
, 
»¥Ú£SŒšg
);

1450 
	}
}

1452 
	gRTSPCl›Á
::
	$»¥Ú£HªdËrFÜHTTP_GET1
(
»¥Ú£Code
, * 
»¥Ú£SŒšg
) {

1453 
Reque¡RecÜd
* 
»que¡
;

1455 
d–‘e
[] 
»¥Ú£SŒšg
;

1456 ià(
»¥Ú£Code
 != 0) ;

1460 
fOuutSock‘Num
 = 
	`£tupSŒ—mSock‘
(
	`’vœ
(), 0);

1461 ià(
fOuutSock‘Num
 < 0) ;

1462 
	`ignÜeSigPeOnSock‘
(
fOuutSock‘Num
);

1464 
fHTTPTuÂ–šgCÚÃùiÚIsP’dšg
 = 
True
;

1465 
cÚÃùResuÉ
 = 
	`cÚÃùToS”v”
(
fOuutSock‘Num
, 
fTuÂ–Ov”HTTPPÜtNum
);

1466 ià(
cÚÃùResuÉ
 < 0) ;

1467 ià(
cÚÃùResuÉ
 == 0) {

1470 (
»que¡
 = 
fReque¡sAwa™šgHTTPTuÂ–šg
.
	`dequeue
()è!ğ
NULL
) {

1471 
fReque¡sAwa™šgCÚÃùiÚ
.
	`’queue
(
»que¡
);

1477 ià(!
	`£tupHTTPTuÂ–šg2
()) ;

1480 (
»que¡
 = 
fReque¡sAwa™šgHTTPTuÂ–šg
.
	`dequeue
()è!ğ
NULL
) {

1481 
	`£ndReque¡
(
»que¡
);

1487 
fHTTPTuÂ–šgCÚÃùiÚIsP’dšg
 = 
F®£
;

1488 
	`»£tTCPSock‘s
();

1489 
Reque¡Queue
 
	`»que¡Queue
(
fReque¡sAwa™šgHTTPTuÂ–šg
);

1490 (
»que¡
 = 
»que¡Queue
.
	`dequeue
()è!ğ
NULL
) {

1491 
	`hªdËReque¡E¼Ü
(
»que¡
);

1492 
d–‘e
 
»que¡
;

1494 
	}
}

1496 
BoŞ—n
 
	gRTSPCl›Á
::
	$£tupHTTPTuÂ–šg2
() {

1497 
fHTTPTuÂ–šgCÚÃùiÚIsP’dšg
 = 
F®£
;

1500  
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd
(1, "POST", 
NULL
)) != 0;

1501 
	}
}

1503 
	gRTSPCl›Á
::
	$cÚÃùiÚHªdËr
(* 
š¡ªû
, ) {

1504 
RTSPCl›Á
* 
ş›Á
 = (RTSPCl›Á*)
š¡ªû
;

1505 
ş›Á
->
	`cÚÃùiÚHªdËr1
();

1506 
	}
}

1508 
	gRTSPCl›Á
::
	$cÚÃùiÚHªdËr1
() {

1510 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fOuutSock‘Num
);

1511 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fIÅutSock‘Num
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
,

1512 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
šcomšgD©aHªdËr
, 
this
);

1516 
Reque¡Queue
 
	`tmpReque¡Queue
(
fReque¡sAwa™šgCÚÃùiÚ
);

1517 
Reque¡RecÜd
* 
»que¡
;

1521 
”r
 = 0;

1522 
SOCKLEN_T
 
Ën
 =  
”r
;

1523 ià(
	`g‘sockİt
(
fIÅutSock‘Num
, 
SOL_SOCKET
, 
SO_ERROR
, (*)&
”r
, &
Ën
) < 0 ||ƒrr != 0) {

1524 
	`’vœ
().
	`£tResuÉE¼Msg
("CÚÃùiÚØ£rv” faed: ", 
”r
);

1525 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
(è<< "..." <<ƒnvœ().
	`g‘ResuÉMsg
() << "\n";

1530 ià(
fV”bos™yLev–
 >ğ1è
	`’vœ
() << "...remote connection opened\n";

1531 ià(
fHTTPTuÂ–šgCÚÃùiÚIsP’dšg
 && !
	`£tupHTTPTuÂ–šg2
()) ;

1534 (
»que¡
 = 
tmpReque¡Queue
.
	`dequeue
()è!ğ
NULL
) {

1535 
	`£ndReque¡
(
»que¡
);

1541 
	`»£tTCPSock‘s
();

1542 (
»que¡
 = 
tmpReque¡Queue
.
	`dequeue
()è!ğ
NULL
) {

1543 
	`hªdËReque¡E¼Ü
(
»que¡
);

1544 
d–‘e
 
»que¡
;

1546 
	}
}

1548 
	gRTSPCl›Á
::
	$šcomšgD©aHªdËr
(* 
š¡ªû
, ) {

1549 
RTSPCl›Á
* 
ş›Á
 = (RTSPCl›Á*)
š¡ªû
;

1550 
ş›Á
->
	`šcomšgD©aHªdËr1
();

1551 
	}
}

1553 
	gRTSPCl›Á
::
	$šcomšgD©aHªdËr1
() {

1554 
sockaddr_š
 
dummy
;

1556 
by‹sR—d
 = 
	`»adSock‘
(
	`’vœ
(), 
fIÅutSock‘Num
, (*)&
fRe¥Ú£Bufãr
[
fRe¥Ú£By‹sAÌ—dyS“n
], 
fRe¥Ú£BufãrBy‹sLeá
, 
dummy
);

1557 
	`hªdËRe¥Ú£By‹s
(
by‹sR—d
);

1558 
	}
}

1560 * 
	$g‘Lše
(* 
¡¬tOfLše
) {

1562 * 
±r
 = 
¡¬tOfLše
; *ptr != '\0'; ++ptr) {

1564 ià(*
±r
 == '\r' || *ptr == '\n') {

1566 ià(*
±r
 == '\r') {

1567 *
±r
++ = '\0';

1568 ià(*
±r
 == '\n') ++ptr;

1570 *
±r
++ = '\0';

1572  
±r
;

1576  
NULL
;

1577 
	}
}

1579 
	gRTSPCl›Á
::
	$hªdËRe¥Ú£By‹s
(
ÃwBy‹sR—d
) {

1581 ià(
ÃwBy‹sR—d
 >ğ0 && (êewBy‹sR—d < 
fRe¥Ú£BufãrBy‹sLeá
) ;

1583 ià(
ÃwBy‹sR—d
 >ğ()
fRe¥Ú£BufãrBy‹sLeá
) {

1585 
	`’vœ
().
	`£tResuÉMsg
("RTSP„esponse wasruncated. Increase \"RTSPClient::responseBufferSize\"");

1590 
	`»£tRe¥Ú£Bufãr
();

1591 
Reque¡RecÜd
* 
»que¡
;

1592 ià(
ÃwBy‹sR—d
 > 0) {

1593 ià((
»que¡
 = 
fReque¡sAwa™šgRe¥Ú£
.
	`dequeue
()è!ğ
NULL
) {

1594 
	`hªdËReque¡E¼Ü
(
»que¡
);

1595 
d–‘e
 
»que¡
;

1598 
Reque¡Queue
 
	`»que¡Queue
(
fReque¡sAwa™šgRe¥Ú£
);

1599 
	`»£tTCPSock‘s
();

1601 (
»que¡
 = 
»que¡Queue
.
	`dequeue
()è!ğ
NULL
) {

1602 
	`hªdËReque¡E¼Ü
(
»que¡
);

1603 
d–‘e
 
»que¡
;

1609 
fRe¥Ú£BufãrBy‹sLeá
 -ğ
ÃwBy‹sR—d
;

1610 
fRe¥Ú£By‹sAÌ—dyS“n
 +ğ
ÃwBy‹sR—d
;

1611 
fRe¥Ú£Bufãr
[
fRe¥Ú£By‹sAÌ—dyS“n
] = '\0';

1612 ià(
fV”bos™yLev–
 >ğ1 && 
ÃwBy‹sR—d
 > 1è
	`’vœ
() << "Received " <<‚ewBytesRead << "‚ew bytes of„esponse data.\n";

1614 
numExŒaBy‹sAá”Re¥Ú£
 = 0;

1615 
BoŞ—n
 
»¥Ú£Sucûss
 = 
F®£
;

1619 
BoŞ—n
 
’dOfH—d”s
 = 
F®£
;

1620 cÚ¡* 
±r
 = 
fRe¥Ú£Bufãr
;

1621 ià(
fRe¥Ú£By‹sAÌ—dyS“n
 > 3) {

1622 cÚ¡* cÚ¡ 
±rEnd
 = &
fRe¥Ú£Bufãr
[
fRe¥Ú£By‹sAÌ—dyS“n
-3];

1623 
±r
 < 
±rEnd
) {

1624 ià(*
±r
++ == '\r' && *ptr++ == '\n' && *ptr++ == '\r' && *ptr++ == '\n') {

1626 
’dOfH—d”s
 = 
True
;

1632 ià(!
’dOfH—d”s
) ;

1637 * 
h—d”D©aCİy
;

1638 
»¥Ú£Code
 = 200;

1639 cÚ¡* 
»¥Ú£SŒ
 = 
NULL
;

1640 
Reque¡RecÜd
* 
foundReque¡
 = 
NULL
;

1641 cÚ¡* 
£ssiÚP¬amsSŒ
 = 
NULL
;

1642 cÚ¡* 
Œª¥ÜtP¬amsSŒ
 = 
NULL
;

1643 cÚ¡* 
sÿËP¬amsSŒ
 = 
NULL
;

1644 cÚ¡* 
¥“dP¬amsSŒ
 = 
NULL
;

1645 cÚ¡* 
¿ngeP¬amsSŒ
 = 
NULL
;

1646 cÚ¡* 
¹pInfoP¬amsSŒ
 = 
NULL
;

1647 cÚ¡* 
wwwAuth’tiÿ‹P¬amsSŒ
 = 
NULL
;

1648 cÚ¡* 
publicP¬amsSŒ
 = 
NULL
;

1649 * 
bodyS¹
 = 
NULL
;

1650 
numBodyBy‹s
 = 0;

1651 
»¥Ú£Sucûss
 = 
F®£
;

1653 
h—d”D©aCİy
 = 
Ãw
 [
»¥Ú£BufãrSize
];

1654 
	`¡ºıy
(
h—d”D©aCİy
, 
fRe¥Ú£Bufãr
, 
fRe¥Ú£By‹sAÌ—dyS“n
);

1655 
h—d”D©aCİy
[
fRe¥Ú£By‹sAÌ—dyS“n
] = '\0';

1657 * 
lšeS¹
;

1658 * 
ÃxtLšeS¹
 = 
h—d”D©aCİy
;

1660 
lšeS¹
 = 
ÃxtLšeS¹
;

1661 
ÃxtLšeS¹
 = 
	`g‘Lše
(
lšeS¹
);

1662 } 
lšeS¹
[0] =ğ'\0' && 
ÃxtLšeS¹
 !ğ
NULL
);

1663 ià(!
	`·r£Re¥Ú£Code
(
lšeS¹
, 
»¥Ú£Code
, 
»¥Ú£SŒ
)) {

1665 
	`hªdËIncomšgReque¡
();

1670 
BoŞ—n
 
»achedEndOfH—d”s
;

1671 
c£q
 = 0;

1672 
cÚ‹ÁL’gth
 = 0;

1675 
»achedEndOfH—d”s
 = 
True
;

1676 
lšeS¹
 = 
ÃxtLšeS¹
;

1677 ià(
lšeS¹
 =ğ
NULL
) ;

1679 
ÃxtLšeS¹
 = 
	`g‘Lše
(
lšeS¹
);

1680 ià(
lšeS¹
[0] == '\0') ;

1681 
»achedEndOfH—d”s
 = 
F®£
;

1683 cÚ¡* 
h—d”P¬amsSŒ
;

1684 ià(
	`checkFÜH—d”
(
lšeS¹
, "CSeq:", 5, 
h—d”P¬amsSŒ
)) {

1685 ià(
	`ssÿnf
(
h—d”P¬amsSŒ
, "%u", &
c£q
) != 1 || cseq <= 0) {

1686 
	`’vœ
().
	`£tResuÉMsg
("Bad \"CSeq:\" h—d”: \"", 
lšeS¹
, "\"");

1690 
Reque¡RecÜd
* 
»que¡
;

1691 (
»que¡
 = 
fReque¡sAwa™šgRe¥Ú£
.
	`dequeue
()è!ğ
NULL
) {

1692 ià(
»que¡
->
	`c£q
(è< 
c£q
) {

1694 ià(
fV”bos™yLev–
 >ğ1 && 
	`¡rcmp
(
»que¡
->
	`commªdName
(), "POST") != 0) {

1695 
	`’vœ
(è<< "WARNING: Th£rv” did‚Ù„e¥ÚdØou¸\"" << 
»que¡
->
	`commªdName
() << "\"„equest (CSeq: "

1696 << 
»que¡
->
	`c£q
() << "). The server‡ppearso be buggy (perhaps‚ot handling…ipelined„equests…roperly).\n";

1698 
d–‘e
 
»que¡
;

1699 } ià(
»que¡
->
	`c£q
(è=ğ
c£q
) {

1701 
foundReque¡
 = 
»que¡
;

1708 } ià(
	`checkFÜH—d”
(
lšeS¹
, "CÚ‹Á-L’gth:", 15, 
h—d”P¬amsSŒ
)) {

1709 ià(
	`ssÿnf
(
h—d”P¬amsSŒ
, "%u", &
cÚ‹ÁL’gth
) != 1) {

1710 
	`’vœ
().
	`£tResuÉMsg
("Bad \"CÚ‹Á-L’gth:\" h—d”: \"", 
lšeS¹
, "\"");

1713 } ià(
	`checkFÜH—d”
(
lšeS¹
, "CÚ‹Á-Ba£:", 13, 
h—d”P¬amsSŒ
)) {

1714 
	`£tBa£URL
(
h—d”P¬amsSŒ
);

1715 } ià(
	`checkFÜH—d”
(
lšeS¹
, "SessiÚ:", 8, 
£ssiÚP¬amsSŒ
)) {

1716 } ià(
	`checkFÜH—d”
(
lšeS¹
, "T¿n¥Üt:", 10, 
Œª¥ÜtP¬amsSŒ
)) {

1717 } ià(
	`checkFÜH—d”
(
lšeS¹
, "SÿË:", 6, 
sÿËP¬amsSŒ
)) {

1718 } ià(
	`checkFÜH—d”
(
lšeS¹
, "S³ed:", 6, 
¥“dP¬amsSŒ
)) {

1719 } ià(
	`checkFÜH—d”
(
lšeS¹
, "Rªge:", 6, 
¿ngeP¬amsSŒ
)) {

1720 } ià(
	`checkFÜH—d”
(
lšeS¹
, "RTP-Info:", 9, 
¹pInfoP¬amsSŒ
)) {

1721 } ià(
	`checkFÜH—d”
(
lšeS¹
, "WWW-Auth’tiÿ‹:", 17, 
h—d”P¬amsSŒ
)) {

1724 ià(
wwwAuth’tiÿ‹P¬amsSŒ
 =ğ
NULL
 || 
	`_¡ºÿ£cmp
(
h—d”P¬amsSŒ
, "Digest", 6) == 0) {

1725 
wwwAuth’tiÿ‹P¬amsSŒ
 = 
h—d”P¬amsSŒ
;

1727 } ià(
	`checkFÜH—d”
(
lšeS¹
, "Public:", 7, 
publicP¬amsSŒ
)) {

1728 } ià(
	`checkFÜH—d”
(
lšeS¹
, "AÎow:", 6, 
publicP¬amsSŒ
)) {

1730 } ià(
	`checkFÜH—d”
(
lšeS¹
, "LoÿtiÚ:", 9, 
h—d”P¬amsSŒ
)) {

1731 
	`£tBa£URL
(
h—d”P¬amsSŒ
);

1734 ià(!
»achedEndOfH—d”s
) ;

1736 ià(
foundReque¡
 =ğ
NULL
) {

1738 
foundReque¡
 = 
fReque¡sAwa™šgRe¥Ú£
.
	`dequeue
();

1742 
bodyOff£t
 = 
ÃxtLšeS¹
 =ğ
NULL
 ? 
fRe¥Ú£By‹sAÌ—dyS“n
 :‚extLšeS¹ - 
h—d”D©aCİy
;

1743 
bodyS¹
 = &
fRe¥Ú£Bufãr
[
bodyOff£t
];

1744 
numBodyBy‹s
 = 
fRe¥Ú£By‹sAÌ—dyS“n
 - 
bodyOff£t
;

1745 ià(
cÚ‹ÁL’gth
 > 
numBodyBy‹s
) {

1747 
numExŒaBy‹sN“ded
 = 
cÚ‹ÁL’gth
 - 
numBodyBy‹s
;

1748 
»maššgBufãrSize
 = 
»¥Ú£BufãrSize
 - 
fRe¥Ú£By‹sAÌ—dyS“n
;

1749 ià(
numExŒaBy‹sN“ded
 > 
»maššgBufãrSize
) {

1750 
tmpBuf
[200];

1751 
	`¥rštf
(
tmpBuf
, "Response buffer size (%d) isoo small for \"Content-Length:\" %d (need‡ buffer size of >= %d bytes\n",

1752 
»¥Ú£BufãrSize
, 
cÚ‹ÁL’gth
, 
fRe¥Ú£By‹sAÌ—dyS“n
 + 
numExŒaBy‹sN“ded
);

1753 
	`’vœ
().
	`£tResuÉMsg
(
tmpBuf
);

1757 ià(
fV”bos™yLev–
 >= 1) {

1758 
	`’vœ
(è<< "Hav»ûived " << 
fRe¥Ú£By‹sAÌ—dyS“n
 << "otal bytes of‡ "

1759 << (
foundReque¡
 !ğ
NULL
 ? foundReque¡->
	`commªdName
() : "(unknown)")

1760 << " RTSP„e¥Ú£;‡wa™šg " << 
numExŒaBy‹sN“ded
 << " bytes more.\n";

1762 
d–‘e
[] 
h—d”D©aCİy
;

1763 ià(
foundReque¡
 !ğ
NULL
è
fReque¡sAwa™šgRe¥Ú£
.
	`putAtH—d
(foundRequest);

1768 * 
»¥Ú£End
 = 
bodyS¹
 + 
cÚ‹ÁL’gth
;

1769 
numExŒaBy‹sAá”Re¥Ú£
 = &
fRe¥Ú£Bufãr
[
fRe¥Ú£By‹sAÌ—dyS“n
] - 
»¥Ú£End
;

1771 ià(
fV”bos™yLev–
 >= 1) {

1772 
§ved
 = *
»¥Ú£End
;

1773 *
»¥Ú£End
 = '\0';

1774 
	`’vœ
() << "Received‡ complete "

1775 << (
foundReque¡
 !ğ
NULL
 ? foundReque¡->
	`commªdName
() : "(unknown)")

1776 << "„e¥Ú£:\n" << 
fRe¥Ú£Bufãr
 << "\n";

1777 ià(
numExŒaBy‹sAá”Re¥Ú£
 > 0è
	`’vœ
() << "\t(plus " <<‚umExtraBytesAfterResponse << "‡dditional bytes)\n";

1778 *
»¥Ú£End
 = 
§ved
;

1781 ià(
foundReque¡
 !ğ
NULL
) {

1782 
BoŞ—n
 
ÃedToRe£ndCommªd
 = 
F®£
;

1783 ià(
»¥Ú£Code
 == 200) {

1785 ià(
	`¡rcmp
(
foundReque¡
->
	`commªdName
(), "SETUP") == 0) {

1786 ià(!
	`hªdËSETUPRe¥Ú£
(*
foundReque¡
->
	`sub£ssiÚ
(), 
£ssiÚP¬amsSŒ
, 
Œª¥ÜtP¬amsSŒ
, foundReque¡->
	`boŞ—nFÏgs
()&0x1)) ;

1787 } ià(
	`¡rcmp
(
foundReque¡
->
	`commªdName
(), "PLAY") == 0) {

1788 ià(!
	`hªdËPLAYRe¥Ú£
(*
foundReque¡
->
	`£ssiÚ
(), *foundReque¡->
	`sub£ssiÚ
(), 
sÿËP¬amsSŒ
, 
¥“dP¬amsSŒ
, 
¿ngeP¬amsSŒ
, 
¹pInfoP¬amsSŒ
)) ;

1789 } ià(
	`¡rcmp
(
foundReque¡
->
	`commªdName
(), "TEARDOWN") == 0) {

1790 ià(!
	`hªdËTEARDOWNRe¥Ú£
(*
foundReque¡
->
	`£ssiÚ
(), *foundReque¡->
	`sub£ssiÚ
())) ;

1791 } ià(
	`¡rcmp
(
foundReque¡
->
	`commªdName
(), "GET_PARAMETER") == 0) {

1792 ià(!
	`hªdËGET_PARAMETERRe¥Ú£
(
foundReque¡
->
	`cÚ‹ÁSŒ
(), 
bodyS¹
, 
»¥Ú£End
)) ;

1794 } ià(
»¥Ú£Code
 =ğ401 && 
	`hªdËAuth’tiÿtiÚFau»
(
wwwAuth’tiÿ‹P¬amsSŒ
)) {

1796 
ÃedToRe£ndCommªd
 = 
True
;

1798 ià(
	`¡rcmp
(
foundReque¡
->
	`commªdName
(), "GET") == 0) {

1802 
	`»£tTCPSock‘s
();

1804 } ià(
»¥Ú£Code
 == 301 ||„esponseCode == 302) {

1805 
	`»£tTCPSock‘s
();

1806 
ÃedToRe£ndCommªd
 = 
True
;

1809 ià(
ÃedToRe£ndCommªd
) {

1810 
	`»£tRe¥Ú£Bufãr
();

1811 ià(!
	`»£ndCommªd
(
foundReque¡
)) ;

1812 
d–‘e
[] 
h—d”D©aCİy
;

1817 
»¥Ú£Sucûss
 = 
True
;

1822 ià(
numExŒaBy‹sAá”Re¥Ú£
 > 0) {

1824 * 
»¥Ú£End
 = &
fRe¥Ú£Bufãr
[
fRe¥Ú£By‹sAÌ—dyS“n
 - 
numExŒaBy‹sAá”Re¥Ú£
];

1827 
numBodyBy‹s
 -ğ
numExŒaBy‹sAá”Re¥Ú£
;

1828 ià(
numBodyBy‹s
 > 0) {

1829 
§ved
 = *
»¥Ú£End
;

1830 *
»¥Ú£End
 = '\0';

1831 
bodyS¹
 = 
	`¡rDup
(bodyStart);

1832 *
»¥Ú£End
 = 
§ved
;

1835 
	`memmove
(
fRe¥Ú£Bufãr
, 
»¥Ú£End
, 
numExŒaBy‹sAá”Re¥Ú£
);

1836 
fRe¥Ú£By‹sAÌ—dyS“n
 = 
numExŒaBy‹sAá”Re¥Ú£
;

1837 
fRe¥Ú£BufãrBy‹sLeá
 = 
»¥Ú£BufãrSize
 - 
numExŒaBy‹sAá”Re¥Ú£
;

1838 
fRe¥Ú£Bufãr
[
numExŒaBy‹sAá”Re¥Ú£
] = '\0';

1840 
	`»£tRe¥Ú£Bufãr
();

1842 ià(
foundReque¡
 !ğ
NULL
 && foundReque¡->
	`hªdËr
() != NULL) {

1843 
»suÉCode
;

1844 * 
»suÉSŒšg
;

1845 ià(
»¥Ú£Sucûss
) {

1846 ià(
»¥Ú£Code
 == 200) {

1847 
»suÉCode
 = 0;

1848 
»suÉSŒšg
 = 
numBodyBy‹s
 > 0 ? 
	`¡rDup
(
bodyS¹
è: sŒDup(
publicP¬amsSŒ
);

1851 
»suÉCode
 = 
»¥Ú£Code
;

1852 
»suÉSŒšg
 = 
	`¡rDup
(
»¥Ú£SŒ
);

1853 
	`’vœ
().
	`£tResuÉMsg
(
»¥Ú£SŒ
);

1855 (*
foundReque¡
->
	`hªdËr
())(
this
, 
»suÉCode
, 
»suÉSŒšg
);

1858 
	`hªdËReque¡E¼Ü
(
foundReque¡
);

1861 
d–‘e
 
foundReque¡
;

1862 
d–‘e
[] 
h—d”D©aCİy
;

1863 ià(
numExŒaBy‹sAá”Re¥Ú£
 > 0 && 
numBodyBy‹s
 > 0è
d–‘e
[] 
bodyS¹
;

1864 } 
numExŒaBy‹sAá”Re¥Ú£
 > 0 && 
»¥Ú£Sucûss
);

1865 
	}
}

1870 
	gRTSPCl›Á
::
Reque¡RecÜd
::
	$Reque¡RecÜd
(
c£q
, cÚ¡* 
commªdName
, 
»¥Ú£HªdËr
* 
hªdËr
,

1871 
MedŸSessiÚ
* 
£ssiÚ
, 
MedŸSub£ssiÚ
* 
sub£ssiÚ
, 
u_št32_t
 
boŞ—nFÏgs
,

1872 
¡¬t
, 
’d
, 
sÿË
, cÚ¡* 
cÚ‹ÁSŒ
)

1873 : 
	`fNext
(
NULL
), 
	`fCSeq
(
c£q
), 
	`fCommªdName
(
commªdName
), 
	`fSessiÚ
(
£ssiÚ
), 
	`fSub£ssiÚ
(
sub£ssiÚ
), 
	`fBoŞ—nFÏgs
(
boŞ—nFÏgs
),

1874 
	`fS¹
(
¡¬t
), 
	`fEnd
(
’d
), 
	`fAbsS¹Time
(
NULL
), 
	`fAbsEndTime
(NULL), 
	`fSÿË
(
sÿË
), 
	`fCÚ‹ÁSŒ
(
	`¡rDup
(
cÚ‹ÁSŒ
)), 
	$fHªdËr
(
hªdËr
) {

1875 
	}
}

1877 
	gRTSPCl›Á
::
Reque¡RecÜd
::
	$Reque¡RecÜd
(
c£q
, 
»¥Ú£HªdËr
* 
hªdËr
,

1878 cÚ¡* 
absS¹Time
, cÚ¡* 
absEndTime
, 
sÿË
,

1879 
MedŸSessiÚ
* 
£ssiÚ
, 
MedŸSub£ssiÚ
* 
sub£ssiÚ
)

1880 : 
	`fNext
(
NULL
), 
	`fCSeq
(
c£q
), 
	`fCommªdName
("PLAY"), 
	`fSessiÚ
(
£ssiÚ
), 
	`fSub£ssiÚ
(
sub£ssiÚ
), 
	`fBoŞ—nFÏgs
(0),

1881 
	`fS¹
(0.0f), 
	`fEnd
(-1.0f), 
	`fAbsS¹Time
(
	`¡rDup
(
absS¹Time
)), 
	`fAbsEndTime
(¡rDup(
absEndTime
)), 
	`fSÿË
(
sÿË
),

1882 
	`fCÚ‹ÁSŒ
(
NULL
), 
	$fHªdËr
(
hªdËr
) {

1883 
	}
}

1885 
	gRTSPCl›Á
::
Reque¡RecÜd
::~
	$Reque¡RecÜd
() {

1887 
d–‘e
 
fNext
;

1889 
d–‘e
[] 
fAbsS¹Time
; d–‘e[] 
fAbsEndTime
;

1890 
d–‘e
[] 
fCÚ‹ÁSŒ
;

1891 
	}
}

1896 
	gRTSPCl›Á
::
Reque¡Queue
::
	$Reque¡Queue
()

1897 : 
	`fH—d
(
NULL
), 
	$fTa
(
NULL
) {

1898 
	}
}

1900 
	gRTSPCl›Á
::
Reque¡Queue
::
	$Reque¡Queue
(
Reque¡Queue
& 
ÜigQueue
)

1901 : 
	`fH—d
(
NULL
), 
	$fTa
(
NULL
) {

1902 
Reque¡RecÜd
* 
»que¡
;

1903 (
»que¡
 = 
ÜigQueue
.
	`dequeue
()è!ğ
NULL
) {

1904 
	`’queue
(
»que¡
);

1906 
	}
}

1908 
	gRTSPCl›Á
::
Reque¡Queue
::~
	$Reque¡Queue
() {

1909 
d–‘e
 
fH—d
;

1910 
	}
}

1912 
	gRTSPCl›Á
::
Reque¡Queue
::
	$’queue
(
Reque¡RecÜd
* 
»que¡
) {

1913 ià(
fTa
 =ğ
NULL
) {

1914 
fH—d
 = 
»que¡
;

1916 
fTa
->
	`Ãxt
(èğ
»que¡
;

1918 
fTa
 = 
»que¡
;

1919 
	}
}

1921 
	gRTSPCl›Á
::
Reque¡RecÜd
* 
RTSPCl›Á
::
Reque¡Queue
::
	$dequeue
() {

1922 
Reque¡RecÜd
* 
»que¡
 = 
fH—d
;

1923 ià(
fH—d
 =ğ
fTa
) {

1924 
fH—d
 = 
NULL
;

1925 
fTa
 = 
NULL
;

1927 
fH—d
 = fH—d->
	`Ãxt
();

1929 ià(
»que¡
 !ğ
NULL
è»que¡->
	`Ãxt
() = NULL;

1930  
»que¡
;

1931 
	}
}

1933 
	gRTSPCl›Á
::
Reque¡Queue
::
	$putAtH—d
(
Reque¡RecÜd
* 
»que¡
) {

1934 
»que¡
->
	`Ãxt
(èğ
fH—d
;

1935 
fH—d
 = 
»que¡
;

1936 ià(
fTa
 =ğ
NULL
) {

1937 
fTa
 = 
»que¡
;

1939 
	}
}

1941 
	gRTSPCl›Á
::
Reque¡RecÜd
* 
RTSPCl›Á
::
Reque¡Queue
::
	$fšdByCSeq
(
c£q
) {

1942 
Reque¡RecÜd
* 
»que¡
;

1943 
»que¡
 = 
fH—d
;„eque¡ !ğ
NULL
;„eque¡ =„eque¡->
	`Ãxt
()) {

1944 ià(
»que¡
->
	`c£q
(è=ğ
c£q
) „equest;

1946  
NULL
;

1947 
	}
}

1952 
HªdËrS”v”FÜREGISTERCommªd
* 
	gHªdËrS”v”FÜREGISTERCommªd


1953 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
ÚRTSPCl›ÁC»©iÚFunc
* 
ü—tiÚFunc
, 
PÜt
 
ourPÜt
,

1954 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
) {

1955 
ourSock‘
 = 
	`£tUpOurSock‘
(
’v
, 
ourPÜt
);

1956 ià(
ourSock‘
 =ğ-1è 
NULL
;

1958  
Ãw
 
	`HªdËrS”v”FÜREGISTERCommªd
(
’v
, 
ü—tiÚFunc
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 
v”bos™yLev–
, 
­¶iÿtiÚName
);

1959 
	}
}

1961 
	gHªdËrS”v”FÜREGISTERCommªd


1962 ::
	$HªdËrS”v”FÜREGISTERCommªd
(
U§geEnvœÚm’t
& 
’v
, 
ÚRTSPCl›ÁC»©iÚFunc
* 
ü—tiÚFunc
, 
ourSock‘
, 
PÜt
 
ourPÜt
,

1963 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
)

1964 : 
	`RTSPS”v”
(
’v
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 30 ),

1965 
	`fC»©iÚFunc
(
ü—tiÚFunc
), 
	`fV”bos™yLev–
(
v”bos™yLev–
), 
	`fAµliÿtiÚName
(
	$¡rDup
(
­¶iÿtiÚName
)) {

1966 
	}
}

1968 
	gHªdËrS”v”FÜREGISTERCommªd
::~
	$HªdËrS”v”FÜREGISTERCommªd
() {

1969 
d–‘e
[] 
fAµliÿtiÚName
;

1970 
	}
}

1972 
RTSPCl›Á
* 
	gHªdËrS”v”FÜREGISTERCommªd


1973 ::
	$ü—‹NewRTSPCl›Á
(cÚ¡* 
¹¥URL
, 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
, 
sock‘NumToS”v”
) {

1975  
RTSPCl›Á
::
	`ü—‹New
(
	`’vœ
(), 
¹¥URL
, 
v”bos™yLev–
, 
­¶iÿtiÚName
, 0, 
sock‘NumToS”v”
);

1976 
	}
}

1978 cÚ¡* 
	gHªdËrS”v”FÜREGISTERCommªd
::
	$®lowedCommªdNames
() {

1980 
	}
}

1982 
BoŞ—n
 
	gHªdËrS”v”FÜREGISTERCommªd
::
	$weIm¶em’tREGISTER
(cÚ¡* 
´oxyURLSuffix
, *& 
»¥Ú£SŒ
) {

1983 
»¥Ú£SŒ
 = 
NULL
;

1984  
True
;

1985 
	}
}

1987 
	gHªdËrS”v”FÜREGISTERCommªd
::
	$im¶em’tCmd_REGISTER
(cÚ¡* 
u¾
, cÚ¡* 
u¾Suffix
, 
sock‘ToRemÙeS”v”
,

1988 
BoŞ—n
 
d–iv”VŸTCP
, const* ) {

1990 
RTSPCl›Á
* 
ÃwRTSPCl›Á
 = 
	`ü—‹NewRTSPCl›Á
(
u¾
, 
fV”bos™yLev–
, 
fAµliÿtiÚName
, 
sock‘ToRemÙeS”v”
);

1992 ià(
fC»©iÚFunc
 !ğ
NULL
è(*fC»©iÚFunc)(
ÃwRTSPCl›Á
, 
d–iv”VŸTCP
);

1993 
	}
}

	@liveMedia/RTSPCommon.cpp

21 
	~"RTSPCommÚ.hh
"

22 
	~"LoÿË.hh
"

23 
	~<¡ršg.h
>

24 
	~<¡dio.h
>

25 
	~<ùy³.h
>

26 
	~<time.h
>

28 
	$decodeURL
(* 
u¾
) {

30 * 
cursÜ
 = 
u¾
;

31 *
cursÜ
) {

32 ià((
cursÜ
[0] == '%') &&

33 
cursÜ
[1] && 
	`isxdig™
(cursor[1]) &&

34 
cursÜ
[2] && 
	`isxdig™
(cursor[2])) {

36 
hex
[3];

37 
hex
[0] = 
cursÜ
[1];

38 
hex
[1] = 
cursÜ
[2];

39 
hex
[2] = '\0';

40 *
u¾
++ = ()
	`¡¹Ş
(
hex
, 
NULL
, 16);

41 
cursÜ
 += 3;

44 *
u¾
++ = *
cursÜ
++;

48 *
u¾
 = '\0';

49 
	}
}

51 
BoŞ—n
 
	$·r£RTSPReque¡SŒšg
(cÚ¡* 
»qSŒ
,

52 
»qSŒSize
,

53 * 
»suÉCmdName
,

54 
»suÉCmdNameMaxSize
,

55 * 
»suÉURLP»Suffix
,

56 
»suÉURLP»SuffixMaxSize
,

57 * 
»suÉURLSuffix
,

58 
»suÉURLSuffixMaxSize
,

59 * 
»suÉCSeq
,

60 
»suÉCSeqMaxSize
,

61 * 
»suÉSessiÚIdSŒ
,

62 
»suÉSessiÚIdSŒMaxSize
,

63 & 
cÚ‹ÁL’gth
) {

67 
i
;

68 
i
 = 0; i < 
»qSŒSize
; ++i) {

69 
c
 = 
»qSŒ
[
i
];

70 ià(!(
c
 == ' ' || c == '\t' || c == '\r' || c == '\n' || c == '\0')) ;

72 ià(
i
 =ğ
»qSŒSize
è 
F®£
;

75 
BoŞ—n
 
·r£Sucûeded
 = 
F®£
;

76 
i1
 = 0;

77 ; 
i1
 < 
»suÉCmdNameMaxSize
-1 && 
i
 < 
»qSŒSize
; ++i,++i1) {

78 
c
 = 
»qSŒ
[
i
];

79 ià(
c
 == ' ' || c == '\t') {

80 
·r£Sucûeded
 = 
True
;

84 
»suÉCmdName
[
i1
] = 
c
;

86 
»suÉCmdName
[
i1
] = '\0';

87 ià(!
·r£Sucûeded
è 
F®£
;

90 
j
 = 
i
+1;

91 
j
 < 
»qSŒSize
 && (
»qSŒ
[j] == ' ' ||„eqStr[j] == '\t')) ++j;

92 ; ()
j
 < ()(
»qSŒSize
-8); ++j) {

93 ià((
»qSŒ
[
j
] == 'r' ||„eqStr[j] == 'R')

94 && (
»qSŒ
[
j
+1] == 't' ||„eqStr[j+1] == 'T')

95 && (
»qSŒ
[
j
+2] == 's' ||„eqStr[j+2] == 'S')

96 && (
»qSŒ
[
j
+3] == 'p' ||„eqStr[j+3] == 'P')

97 && 
»qSŒ
[
j
+4] == ':' &&„eqStr[j+5] == '/') {

98 
j
 += 6;

99 ià(
»qSŒ
[
j
] == '/') {

101 ++
j
;

102 
j
 < 
»qSŒSize
 && 
»qSŒ
[j] != '/' &&„eqStr[j] != ' ') ++j;

105 --
j
;

107 
i
 = 
j
;

113 
·r£Sucûeded
 = 
F®£
;

114 
k
 = 
i
+1; ()k < ()(
»qSŒSize
-5); ++k) {

115 ià(
»qSŒ
[
k
] == 'R' &&„eqStr[k+1] == 'T' &&

116 
»qSŒ
[
k
+2] == 'S' &&„eqStr[k+3] == 'P' &&„eqStr[k+4] == '/') {

117 --
k
 >ğ
i
 && 
»qSŒ
[k] == ' ') {}

118 
k1
 = 
k
;

119 
k1
 > 
i
 && 
»qSŒ
[k1] != '/') --k1;

128 
n
 = 0, 
k2
 = 
k1
+1;

129 ià(
k2
 <ğ
k
) {

130 ià(
k
 - 
k1
 + 1 > 
»suÉURLSuffixMaxSize
è 
F®£
;

131 
k2
 <ğ
k
è
»suÉURLSuffix
[
n
++] = 
»qSŒ
[k2++];

133 
»suÉURLSuffix
[
n
] = '\0';

137 
n
 = 0; 
k2
 = 
i
+1;

138 ià(
k2
+1 <ğ
k1
) {

139 ià(
k1
 - 
i
 > 
»suÉURLP»SuffixMaxSize
è 
F®£
;

140 
k2
 <ğ
k1
-1è
»suÉURLP»Suffix
[
n
++] = 
»qSŒ
[k2++];

142 
»suÉURLP»Suffix
[
n
] = '\0';

143 
	`decodeURL
(
»suÉURLP»Suffix
);

145 
i
 = 
k
 + 7;

146 
·r£Sucûeded
 = 
True
;

150 ià(!
·r£Sucûeded
è 
F®£
;

154 
·r£Sucûeded
 = 
F®£
;

155 
j
 = 
i
; ()j < ()(
»qSŒSize
-5); ++j) {

156 ià(
	`_¡ºÿ£cmp
("CSeq:", &
»qSŒ
[
j
], 5) == 0) {

157 
j
 += 5;

158 
j
 < 
»qSŒSize
 && (
»qSŒ
[j] == ' ' ||„eqStr[j] == '\t')) ++j;

159 
n
;

160 
n
 = 0;‚ < 
»suÉCSeqMaxSize
-1 && 
j
 < 
»qSŒSize
; ++n,++j) {

161 
c
 = 
»qSŒ
[
j
];

162 ià(
c
 == '\r' || c == '\n') {

163 
·r£Sucûeded
 = 
True
;

167 
»suÉCSeq
[
n
] = 
c
;

169 
»suÉCSeq
[
n
] = '\0';

173 ià(!
·r£Sucûeded
è 
F®£
;

177 
»suÉSessiÚIdSŒ
[0] = '\0';

178 
j
 = 
i
; ()j < ()(
»qSŒSize
-8); ++j) {

179 ià(
	`_¡ºÿ£cmp
("SessiÚ:", &
»qSŒ
[
j
], 8) == 0) {

180 
j
 += 8;

181 
j
 < 
»qSŒSize
 && (
»qSŒ
[j] == ' ' ||„eqStr[j] == '\t')) ++j;

182 
n
;

183 
n
 = 0;‚ < 
»suÉSessiÚIdSŒMaxSize
-1 && 
j
 < 
»qSŒSize
; ++n,++j) {

184 
c
 = 
»qSŒ
[
j
];

185 ià(
c
 == '\r' || c == '\n') {

189 
»suÉSessiÚIdSŒ
[
n
] = 
c
;

191 
»suÉSessiÚIdSŒ
[
n
] = '\0';

197 
cÚ‹ÁL’gth
 = 0;

198 
j
 = 
i
; ()j < ()(
»qSŒSize
-15); ++j) {

199 ià(
	`_¡ºÿ£cmp
("CÚ‹Á-L’gth:", &(
»qSŒ
[
j
]), 15) == 0) {

200 
j
 += 15;

201 
j
 < 
»qSŒSize
 && (
»qSŒ
[j] == ' ' ||„eqStr[j] == '\t')) ++j;

202 
num
;

203 ià(
	`ssÿnf
(&
»qSŒ
[
j
], "%u", &
num
) == 1) {

204 
cÚ‹ÁL’gth
 = 
num
;

208  
True
;

209 
	}
}

211 
BoŞ—n
 
	$·r£RªgeP¬am
(cÚ¡* 
·¿mSŒ
,

212 & 
¿ngeS¹
, & 
¿ngeEnd
,

213 *& 
absS¹Time
, *& 
absEndTime
,

214 
BoŞ—n
& 
¡¬tTimeIsNow
) {

215 
d–‘e
[] 
absS¹Time
; d–‘e[] 
absEndTime
;

216 
absS¹Time
 = 
absEndTime
 = 
NULL
;

217 
¡¬tTimeIsNow
 = 
F®£
;

218 
¡¬t
, 
’d
;

219 
numCh¬sM©ched1
 = 0, 
numCh¬sM©ched2
 = 0, 
numCh¬sM©ched3
 = 0, 
numCh¬sM©ched4
 = 0;

220 
LoÿË
 
	`l
("C", 
Num”ic
);

221 ià(
	`ssÿnf
(
·¿mSŒ
, "Åˆğ%là- %lf", &
¡¬t
, &
’d
) == 2) {

222 
¿ngeS¹
 = 
¡¬t
;

223 
¿ngeEnd
 = 
’d
;

224 } ià(
	`ssÿnf
(
·¿mSŒ
, "Åˆğ%n%là-", &
numCh¬sM©ched1
, &
¡¬t
) == 1) {

225 ià(
·¿mSŒ
[
numCh¬sM©ched1
] == '-') {

227 
¿ngeS¹
 = 0.0; 
¡¬tTimeIsNow
 = 
True
;

228 
¿ngeEnd
 = -
¡¬t
;

230 
¿ngeS¹
 = 
¡¬t
;

231 
¿ngeEnd
 = 0.0;

233 } ià(
	`ssÿnf
(
·¿mSŒ
, "Åˆğnow - %lf", &
’d
) == 1) {

234 
¿ngeS¹
 = 0.0; 
¡¬tTimeIsNow
 = 
True
;

235 
¿ngeEnd
 = 
’d
;

236 } ià(
	`ssÿnf
(
·¿mSŒ
, "Åˆğnow -%n", &
numCh¬sM©ched2
) == 0 &&‚umCharsMatched2 > 0) {

237 
¿ngeS¹
 = 0.0; 
¡¬tTimeIsNow
 = 
True
;

238 
¿ngeEnd
 = 0.0;

239 } ià(
	`ssÿnf
(
·¿mSŒ
, "şock = %n", &
numCh¬sM©ched3
) == 0 &&‚umCharsMatched3 > 0) {

240 
¿ngeS¹
 = 
¿ngeEnd
 = 0.0;

242 cÚ¡* 
utcTimes
 = &
·¿mSŒ
[
numCh¬sM©ched3
];

243 
size_t
 
Ën
 = 
	`¡¾’
(
utcTimes
) + 1;

244 * 
as
 = 
Ãw
 [
Ën
];

245 * 
«
 = 
Ãw
 [
Ën
];

246 
ssÿnfResuÉ
 = 
	`ssÿnf
(
utcTimes
, "%[^-]-%[^\r\n]", 
as
, 
«
);

247 ià(
ssÿnfResuÉ
 == 2) {

248 
absS¹Time
 = 
as
;

249 
absEndTime
 = 
«
;

250 } ià(
ssÿnfResuÉ
 == 1) {

251 
absS¹Time
 = 
as
;

252 
d–‘e
[] 
«
;

254 
d–‘e
[] 
as
; d–‘e[] 
«
;

255  
F®£
;

257 } ià(
	`ssÿnf
(
·¿mSŒ
, "smğ%n", &
numCh¬sM©ched4
) == 0 &&‚umCharsMatched4 > 0) {

260  
F®£
;

263  
True
;

264 
	}
}

266 
BoŞ—n
 
	$·r£RªgeH—d”
(cÚ¡* 
buf
,

267 & 
¿ngeS¹
, & 
¿ngeEnd
,

268 *& 
absS¹Time
, *& 
absEndTime
,

269 
BoŞ—n
& 
¡¬tTimeIsNow
) {

272 ià(*
buf
 =ğ'\0'è 
F®£
;

273 ià(
	`_¡ºÿ£cmp
(
buf
, "Range: ", 7) == 0) ;

274 ++
buf
;

277 cÚ¡* 
f›lds
 = 
buf
 + 7;

278 *
f›lds
 == ' ') ++fields;

279  
	`·r£RªgeP¬am
(
f›lds
, 
¿ngeS¹
, 
¿ngeEnd
, 
absS¹Time
, 
absEndTime
, 
¡¬tTimeIsNow
);

280 
	}
}

282 
BoŞ—n
 
	$·r£SÿËH—d”
(cÚ¡* 
buf
, & 
sÿË
) {

284 
sÿË
 = 1.0;

288 ià(*
buf
 =ğ'\0'è 
F®£
;

289 ià(
	`_¡ºÿ£cmp
(
buf
, "Scale:", 6) == 0) ;

290 ++
buf
;

293 cÚ¡* 
f›lds
 = 
buf
 + 6;

294 *
f›lds
 == ' ') ++fields;

295 
sc
;

296 ià(
	`ssÿnf
(
f›lds
, "%f", &
sc
) == 1) {

297 
sÿË
 = 
sc
;

299  
F®£
;

302  
True
;

303 
	}
}

306 
BoŞ—n
 
	$isS•¬©Ü
(
c
è{  c =ğ' ' || c =ğ',' || c =ğ';' || c =ğ':'; 
	}
}

308 
BoŞ—n
 
	$RTSPO±iÚIsSuµÜ‹d
(cÚ¡* 
commªdName
, cÚ¡* 
İtiÚsRe¥Ú£SŒšg
) {

310 ià(
commªdName
 =ğ
NULL
 || 
İtiÚsRe¥Ú£SŒšg
 == NULL) ;

312 cÚ¡ 
commªdNameL’
 = 
	`¡¾’
(
commªdName
);

313 ià(
commªdNameL’
 == 0) ;

319 *
İtiÚsRe¥Ú£SŒšg
 !ğ'\0' && 
	`isS•¬©Ü
(*optionsResponseString)) ++optionsResponseString;

320 ià(*
İtiÚsRe¥Ú£SŒšg
 == '\0') ;

323 ià(
	`¡ºcmp
(
commªdName
, 
İtiÚsRe¥Ú£SŒšg
, 
commªdNameL’
) == 0) {

325 
İtiÚsRe¥Ú£SŒšg
 +ğ
commªdNameL’
;

326 ià(*
İtiÚsRe¥Ú£SŒšg
 =ğ'\0' || 
	`isS•¬©Ü
(*İtiÚsRe¥Ú£SŒšg)è 
True
;

330 *
İtiÚsRe¥Ú£SŒšg
 !ğ'\0' && !
	`isS•¬©Ü
(*optionsResponseString)) ++optionsResponseString;

334  
F®£
;

335 
	}
}

337 cÚ¡* 
	$d©eH—d”
() {

338 
buf
[200];

339 #ià!
	`defšed
(
_WIN32_WCE
)

340 
time_t
 
‰
 = 
	`time
(
NULL
);

341 
	`¡ráime
(
buf
,  buf, "D©e: %a, %b %d %Y %H:%M:%S GMT\r\n", 
	`gmtime
(&
‰
));

347 
SYSTEMTIME
 
Sy¡emTime
;

348 
	`G‘Sy¡emTime
(&
Sy¡emTime
);

349 
WCHAR
 
d©eFÜm©
[] = 
L
"ddd, MMM dd yyyy";

350 
WCHAR
 
timeFÜm©
[] = 
L
"HH:mm:ss GMT\r\n";

351 
WCHAR
 
šBuf
[200];

352 
DWORD
 
loÿË
 = 
LOCALE_NEUTRAL
;

354 
»t
 = 
	`G‘D©eFÜm©
(
loÿË
, 0, &
Sy¡emTime
,

355 (
LPTSTR
)
d©eFÜm©
, (LPTSTR)
šBuf
,  inBuf);

356 
šBuf
[
»t
 - 1] = ' ';

357 
»t
 = 
	`G‘TimeFÜm©
(
loÿË
, 0, &
Sy¡emTime
,

358 (
LPTSTR
)
timeFÜm©
,

359 (
LPTSTR
)
šBuf
 + 
»t
, ( inBuf) -„et);

360 
	`wc¡ombs
(
buf
, 
šBuf
, 
	`wc¦’
(inBuf));

362  
buf
;

363 
	}
}

	@liveMedia/RTSPRegisterSender.cpp

21 
	~"RTSPRegi¡”S’d”.hh
"

22 
	~<GroupsockH–³r.hh
>

24 
RTSPRegi¡”S’d”
* 
	gRTSPRegi¡”S’d”


25 ::
ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

26 cÚ¡* 
»mÙeCl›ÁNameOrAdd»ss
, 
pÜtNumB™s
 
»mÙeCl›ÁPÜtNum
, cÚ¡* 
¹¥URLToRegi¡”
,

27 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
¹¥Re¥Ú£HªdËr
, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
,

28 
BoŞ—n
 
»que¡SŒ—mšgVŸTCP
, cÚ¡* 
´oxyURLSuffix
, BoŞ—À
»u£CÚÃùiÚ
,

29 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
) {

30  
Ãw
 
RTSPRegi¡”S’d”
(
’v
, 
»mÙeCl›ÁNameOrAdd»ss
, 
»mÙeCl›ÁPÜtNum
, 
¹¥URLToRegi¡”
,

31 
¹¥Re¥Ú£HªdËr
, 
auth’tiÿtÜ
,

32 
»que¡SŒ—mšgVŸTCP
, 
´oxyURLSuffix
, 
»u£CÚÃùiÚ
,

33 
v”bos™yLev–
, 
­¶iÿtiÚName
);

36 
	gRTSPRegi¡”S’d”
::
	$g¿bCÚÃùiÚ
(& 
sock
, 
sockaddr_š
& 
»mÙeAdd»ss
) {

37 
sock
 = 
	`g¿bSock‘
();

39 
	`MAKE_SOCKADDR_IN
(
»mÙeAddr
, 
fS”v”Add»ss
, 
	`htÚs
(
fRemÙeCl›ÁPÜtNum
));

40 
»mÙeAdd»ss
 = 
»mÙeAddr
;

41 
	}
}

43 
	gRTSPRegi¡”S’d”


44 ::
RTSPRegi¡”S’d”
(
U§geEnvœÚm’t
& 
’v
,

45 cÚ¡* 
»mÙeCl›ÁNameOrAdd»ss
, 
pÜtNumB™s
 
»mÙeCl›ÁPÜtNum
, cÚ¡* 
¹¥URLToRegi¡”
,

46 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
¹¥Re¥Ú£HªdËr
, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
,

47 
BoŞ—n
 
»que¡SŒ—mšgVŸTCP
, cÚ¡* 
´oxyURLSuffix
, BoŞ—À
»u£CÚÃùiÚ
,

48 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
)

49 : 
RTSPCl›Á
(
’v
, 
NULL
, 
v”bos™yLev–
, 
­¶iÿtiÚName
, 0, -1),

50 
	$fRemÙeCl›ÁPÜtNum
(
»mÙeCl›ÁPÜtNum
) {

52 cÚ¡* 
çkeRTSPURLFmt
 = "rtsp://%s:%u/";

53 
çkeRTSPURLSize
 = 
	`¡¾’
(
çkeRTSPURLFmt
è+ sŒËn(
»mÙeCl›ÁNameOrAdd»ss
) + 5 ;

54 * 
çkeRTSPURL
 = 
Ãw
 [
çkeRTSPURLSize
];

55 
	`¥rštf
(
çkeRTSPURL
, 
çkeRTSPURLFmt
, 
»mÙeCl›ÁNameOrAdd»ss
, 
»mÙeCl›ÁPÜtNum
);

56 
	`£tBa£URL
(
çkeRTSPURL
);

57 
d–‘e
[] 
çkeRTSPURL
;

60 ià(
auth’tiÿtÜ
 !ğ
NULL
è
fCu¼’tAuth’tiÿtÜ
 = *authenticator;

61 ()
	`£ndReque¡
(
Ãw
 
	`Reque¡RecÜd_REGISTER
(++
fCSeq
, 
¹¥Re¥Ú£HªdËr
,

62 
¹¥URLToRegi¡”
, 
»u£CÚÃùiÚ
, 
»que¡SŒ—mšgVŸTCP
, 
´oxyURLSuffix
));

63 
	}
}

65 
	gRTSPRegi¡”S’d”
::~
	$RTSPRegi¡”S’d”
() {

66 
	}
}

68 
BoŞ—n
 
RTSPRegi¡”S’d”
::
	$£tReque¡F›lds
(
Reque¡RecÜd
* 
»que¡
,

69 *& 
cmdURL
, 
BoŞ—n
& 
cmdURLWasAÎoÿ‹d
,

70 cÚ¡*& 
´ÙocŞSŒ
,

71 *& 
exŒaH—d”s
, 
BoŞ—n
& 
exŒaH—d”sW”eAÎoÿ‹d
) {

72 ià(
	`¡rcmp
(
»que¡
->
	`commªdName
(), "REGISTER") == 0) {

73 
Reque¡RecÜd_REGISTER
* 
»que¡_REGISTER
 = (Reque¡RecÜd_REGISTER*è
»que¡
;

75 
	`£tBa£URL
(
»que¡_REGISTER
->
	`¹¥URLToRegi¡”
());

76 
cmdURL
 = (*)
	`u¾
();

77 
cmdURLWasAÎoÿ‹d
 = 
F®£
;

81 * 
´oxyURLSuffixP¬am‘”SŒ
;

82 ià(
»que¡_REGISTER
->
	`´oxyURLSuffix
(è=ğ
NULL
) {

83 
´oxyURLSuffixP¬am‘”SŒ
 = 
	`¡rDup
("");

85 cÚ¡* 
´oxyURLSuffixP¬am‘”Fmt
 = ";…roxy_url_suffix=%s";

86 
´oxyURLSuffixP¬am‘”Size
 = 
	`¡¾’
(
´oxyURLSuffixP¬am‘”Fmt
)

87 + 
	`¡¾’
(
»que¡_REGISTER
->
	`´oxyURLSuffix
());

88 
´oxyURLSuffixP¬am‘”SŒ
 = 
Ãw
 [
´oxyURLSuffixP¬am‘”Size
];

89 
	`¥rštf
(
´oxyURLSuffixP¬am‘”SŒ
, 
´oxyURLSuffixP¬am‘”Fmt
, 
»que¡_REGISTER
->
	`´oxyURLSuffix
());

92 cÚ¡* 
Œª¥ÜtH—d”Fmt
 = "Transport: %spreferred_delivery_protocol=%s%s\r\n";

93 
Œª¥ÜtH—d”Size
 = 
	`¡¾’
(
Œª¥ÜtH—d”Fmt
è+ 100 + sŒËn(
´oxyURLSuffixP¬am‘”SŒ
);

94 * 
Œª¥ÜtH—d”SŒ
 = 
Ãw
 [
Œª¥ÜtH—d”Size
];

95 
	`¥rštf
(
Œª¥ÜtH—d”SŒ
, 
Œª¥ÜtH—d”Fmt
,

96 
»que¡_REGISTER
->
	`»u£CÚÃùiÚ
() ? "reuse_connection; " : "",

97 
»que¡_REGISTER
->
	`»que¡SŒ—mšgVŸTCP
() ? "interleaved" : "udp",

98 
´oxyURLSuffixP¬am‘”SŒ
);

99 
d–‘e
[] 
´oxyURLSuffixP¬am‘”SŒ
;

101 
exŒaH—d”s
 = 
Œª¥ÜtH—d”SŒ
;

102 
exŒaH—d”sW”eAÎoÿ‹d
 = 
True
;

104  
True
;

106  
RTSPCl›Á
::
	`£tReque¡F›lds
(
»que¡
, 
cmdURL
, 
cmdURLWasAÎoÿ‹d
, 
´ÙocŞSŒ
, 
exŒaH—d”s
, 
exŒaH—d”sW”eAÎoÿ‹d
);

108 
	}
}

110 
	gRTSPRegi¡”S’d”
::
Reque¡RecÜd_REGISTER


111 ::
Reque¡RecÜd_REGISTER
(
c£q
, 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
¹¥Re¥Ú£HªdËr
, cÚ¡* 
¹¥URLToRegi¡”
,

112 
BoŞ—n
 
»u£CÚÃùiÚ
, BoŞ—À
»que¡SŒ—mšgVŸTCP
, cÚ¡* 
´oxyURLSuffix
)

113 : 
RTSPCl›Á
::
Reque¡RecÜd
(
c£q
, "REGISTER", 
¹¥Re¥Ú£HªdËr
),

114 
fRTSPURLToRegi¡”
(
¡rDup
(
¹¥URLToRegi¡”
)),

115 
fReu£CÚÃùiÚ
(
»u£CÚÃùiÚ
), 
fReque¡SŒ—mšgVŸTCP
(
»que¡SŒ—mšgVŸTCP
), 
fProxyURLSuffix
(
	$¡rDup
(
´oxyURLSuffix
)) {

116 
	}
}

118 
	gRTSPRegi¡”S’d”
::
Reque¡RecÜd_REGISTER
::~
	$Reque¡RecÜd_REGISTER
() {

119 
d–‘e
[] 
fRTSPURLToRegi¡”
;

120 
d–‘e
[] 
fProxyURLSuffix
;

121 
	}
}

	@liveMedia/RTSPServer.cpp

21 
	~"RTSPS”v”.hh
"

22 
	~"RTSPCommÚ.hh
"

23 
	~"RTSPRegi¡”S’d”.hh
"

24 
	~"ProxyS”v”MedŸSessiÚ.hh
"

25 
	~"Ba£64.hh
"

26 
	~<GroupsockH–³r.hh
>

30 
RTSPS”v”
*

31 
	gRTSPS”v”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
ourPÜt
,

32 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
,

33 
»şam©iÚSecÚds
) {

34 
ourSock‘
 = 
	`£tUpOurSock‘
(
’v
, 
ourPÜt
);

35 ià(
ourSock‘
 =ğ-1è 
NULL
;

37  
Ãw
 
	`RTSPS”v”
(
’v
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 
»şam©iÚSecÚds
);

38 
	}
}

40 
BoŞ—n
 
	gRTSPS”v”
::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
,

41 cÚ¡* 
Çme
,

42 
RTSPS”v”
*& 
»suÉS”v”
) {

43 
»suÉS”v”
 = 
NULL
;

45 
Medium
* 
medium
;

46 ià(!
Medium
::
	`lookupByName
(
’v
, 
Çme
, 
medium
)è 
F®£
;

48 ià(!
medium
->
	`isRTSPS”v”
()) {

49 
’v
.
	`£tResuÉMsg
(
Çme
, " is‚ot‡ RTSP server");

50  
F®£
;

53 
»suÉS”v”
 = (
RTSPS”v”
*)
medium
;

54  
True
;

55 
	}
}

57 
¹¥Regi¡”Re¥Ú£HªdËr
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

60 şas 
	cRegi¡”Reque¡RecÜd
: 
public
 
RTSPRegi¡”S’d”
 {

61 
public
:

62 
Regi¡”Reque¡RecÜd
(
RTSPS”v”
& 
ourS”v”
, 
»que¡Id
,

63 cÚ¡* 
»mÙeCl›ÁNameOrAdd»ss
, 
pÜtNumB™s
 
»mÙeCl›ÁPÜtNum
, cÚ¡* 
¹¥URLToRegi¡”
,

64 
RTSPS”v”
::
»¥Ú£HªdËrFÜREGISTER
* 
»¥Ú£HªdËr
, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
,

65 
BoŞ—n
 
»que¡SŒ—mšgVŸTCP
, cÚ¡* 
´oxyURLSuffix
)

66 : 
RTSPRegi¡”S’d”
(
ourS”v”
.
’vœ
(), 
»mÙeCl›ÁNameOrAdd»ss
, 
»mÙeCl›ÁPÜtNum
, 
¹¥URLToRegi¡”
,

67 
¹¥Regi¡”Re¥Ú£HªdËr
, 
auth’tiÿtÜ
,

68 
»que¡SŒ—mšgVŸTCP
, 
´oxyURLSuffix
, 
True
 ,

69 #ifdeà
DEBUG


74 
NULL
),

75 
fOurS”v”
(
ourS”v”
), 
fReque¡Id
(
»que¡Id
), 
	$fRe¥Ú£HªdËr
(
»¥Ú£HªdËr
) {

77 
ourS”v”
.
fP’dšgRegi¡”Reque¡s
->
	`Add
((cÚ¡*)
this
,his);

80 
vœtu®
 ~
	$Regi¡”Reque¡RecÜd
() {

82 
fOurS”v”
.
fP’dšgRegi¡”Reque¡s
->
	`Remove
((cÚ¡*)
this
);

83 
	}
}

85 
	$hªdËRe¥Ú£
(
»suÉCode
, * 
»suÉSŒšg
) {

86 ià(
»suÉCode
 == 0) {

88 
sock
;

89 
sockaddr_š
 
»mÙeAdd»ss
;

91 
	`g¿bCÚÃùiÚ
(
sock
, 
»mÙeAdd»ss
);

92 ià(
sock
 >ğ0è()
fOurS”v”
.
	`ü—‹NewCl›ÁCÚÃùiÚ
(sock, 
»mÙeAdd»ss
);

95 ià(
fRe¥Ú£HªdËr
 !ğ
NULL
) {

97 (*
fRe¥Ú£HªdËr
)(&
fOurS”v”
, 
fReque¡Id
, 
»suÉCode
, 
»suÉSŒšg
);

100 
d–‘e
[] 
»suÉSŒšg
;

104 
d–‘e
 
this
;

105 
	}
}

107 
	g´iv©e
:

108 
RTSPS”v”
& 
fOurS”v”
;

109 
	gfReque¡Id
;

110 
	gRTSPS”v”
::
»¥Ú£HªdËrFÜREGISTER
* 
fRe¥Ú£HªdËr
;

113 
	$¹¥Regi¡”Re¥Ú£HªdËr
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

114 
Regi¡”Reque¡RecÜd
* 
»gi¡”Reque¡RecÜd
 = (Regi¡”Reque¡RecÜd*)
¹¥Cl›Á
;

116 
»gi¡”Reque¡RecÜd
->
	`hªdËRe¥Ú£
(
»suÉCode
, 
»suÉSŒšg
);

117 
	}
}

119 
	gRTSPS”v”
::
	$»gi¡”SŒ—m
(
S”v”MedŸSessiÚ
* 
£rv”MedŸSessiÚ
,

120 cÚ¡* 
»mÙeCl›ÁNameOrAdd»ss
, 
pÜtNumB™s
 
»mÙeCl›ÁPÜtNum
,

121 
»¥Ú£HªdËrFÜREGISTER
* 
»¥Ú£HªdËr
,

122 cÚ¡* 
u£ºame
, cÚ¡* 
·sswÜd
,

123 
BoŞ—n
 
»ûiveOurSŒ—mVŸTCP
, cÚ¡* 
´oxyURLSuffix
) {

126 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
 = 
NULL
;

127 ià(
u£ºame
 !ğ
NULL
) {

128 ià(
·sswÜd
 =ğ
NULL
)…assword = "";

129 
auth’tiÿtÜ
 = 
Ãw
 
	`Auth’tiÿtÜ
(
u£ºame
, 
·sswÜd
);

131 
»que¡Id
 = ++
fRegi¡”Reque¡CouÁ”
;

132 
Ãw
 
	`Regi¡”Reque¡RecÜd
(*
this
, 
»que¡Id
,

133 
»mÙeCl›ÁNameOrAdd»ss
, 
»mÙeCl›ÁPÜtNum
, 
	`¹¥URL
(
£rv”MedŸSessiÚ
),

134 
»¥Ú£HªdËr
, 
auth’tiÿtÜ
,

135 
»ûiveOurSŒ—mVŸTCP
, 
´oxyURLSuffix
);

137 
d–‘e
 
auth’tiÿtÜ
;

138  
»que¡Id
;

139 
	}
}

141 * 
	gRTSPS”v”


142 ::
	$¹¥URL
(
S”v”MedŸSessiÚ
 cÚ¡* 
£rv”MedŸSessiÚ
, 
ş›ÁSock‘
) const {

143 * 
u¾P»fix
 = 
	`¹¥URLP»fix
(
ş›ÁSock‘
);

144 cÚ¡* 
£ssiÚName
 = 
£rv”MedŸSessiÚ
->
	`¡»amName
();

146 * 
»suÉURL
 = 
Ãw
 [
	`¡¾’
(
u¾P»fix
è+ sŒËn(
£ssiÚName
) + 1];

147 
	`¥rštf
(
»suÉURL
, "%s%s", 
u¾P»fix
, 
£ssiÚName
);

149 
d–‘e
[] 
u¾P»fix
;

150  
»suÉURL
;

151 
	}
}

153 * 
	gRTSPS”v”
::
	$¹¥URLP»fix
(
ş›ÁSock‘
) const {

154 
sockaddr_š
 
ourAdd»ss
;

155 ià(
ş›ÁSock‘
 < 0) {

157 
ourAdd»ss
.
sš_addr
.
s_addr
 = 
ReûivšgIÁ”çûAddr
 != 0

158 ? 
ReûivšgIÁ”çûAddr


159 : 
	`ourIPAdd»ss
(
	`’vœ
());

161 
SOCKLEN_T
 
Çm–’
 =  
ourAdd»ss
;

162 
	`g‘sockÇme
(
ş›ÁSock‘
, (
sockaddr
*)&
ourAdd»ss
, &
Çm–’
);

165 
u¾Bufãr
[100];

167 
pÜtNumB™s
 
pÜtNumHo¡Ord”
 = 
	`Áohs
(
fS”v”PÜt
.
	`num
());

168 ià(
pÜtNumHo¡Ord”
 == 554 ) {

169 
	`¥rštf
(
u¾Bufãr
, "¹¥://%s/", 
	`Add»ssSŒšg
(
ourAdd»ss
).
	`v®
());

171 
	`¥rštf
(
u¾Bufãr
, "rtsp://%s:%hu/",

172 
	`Add»ssSŒšg
(
ourAdd»ss
).
	`v®
(), 
pÜtNumHo¡Ord”
);

175  
	`¡rDup
(
u¾Bufãr
);

176 
	}
}

178 
U£rAuth’tiÿtiÚD©aba£
* 
	gRTSPS”v”
::
	$£tAuth’tiÿtiÚD©aba£
(
U£rAuth’tiÿtiÚD©aba£
* 
ÃwDB
) {

179 
U£rAuth’tiÿtiÚD©aba£
* 
ŞdDB
 = 
fAuthDB
;

180 
fAuthDB
 = 
ÃwDB
;

182  
ŞdDB
;

183 
	}
}

185 
BoŞ—n
 
	gRTSPS”v”
::
	$£tUpTuÂ–šgOv”HTTP
(
PÜt
 
h‰pPÜt
) {

186 
fHTTPS”v”Sock‘
 = 
	`£tUpOurSock‘
(
	`’vœ
(), 
h‰pPÜt
);

187 ià(
fHTTPS”v”Sock‘
 >= 0) {

188 
fHTTPS”v”PÜt
 = 
h‰pPÜt
;

189 
	`’vœ
().
	`skScheduËr
().
	`tuºOnBackgroundR—dHªdlšg
(
fHTTPS”v”Sock‘
,

190 
šcomšgCÚÃùiÚHªdËrHTTP
, 
this
);

191  
True
;

194  
F®£
;

195 
	}
}

197 
pÜtNumB™s
 
	gRTSPS”v”
::
	$h‰pS”v”PÜtNum
() const {

198  
	`Áohs
(
fHTTPS”v”PÜt
.
	`num
());

199 
	}
}

201 cÚ¡* 
	gRTSPS”v”
::
	$®lowedCommªdNames
() {

203 
	}
}

205 
BoŞ—n
 
	gRTSPS”v”
::
	$weIm¶em’tREGISTER
(cÚ¡* , *& 
»¥Ú£SŒ
) {

207 
»¥Ú£SŒ
 = 
NULL
;

208  
F®£
;

209 
	}
}

211 
	gRTSPS”v”
::
	$im¶em’tCmd_REGISTER
(const* , const* , ,

212 
BoŞ—n
 , const* ) {

214 
	}
}

216 
U£rAuth’tiÿtiÚD©aba£
* 
	gRTSPS”v”
::
	$g‘Auth’tiÿtiÚD©aba£FÜCommªd
(const* ) {

218  
fAuthDB
;

219 
	}
}

221 
BoŞ—n
 
	gRTSPS”v”
::
	$¥ecŸlCl›ÁAcûssCheck
(, 
sockaddr_š
& , const* ) {

223  
True
;

224 
	}
}

226 
BoŞ—n
 
	gRTSPS”v”
::
	$¥ecŸlCl›ÁU£rAcûssCheck
(, 
sockaddr_š
& ,

229  
True
;

230 
	}
}

233 
	gRTSPS”v”
::
	$RTSPS”v”
(
U§geEnvœÚm’t
& 
’v
,

234 
ourSock‘
, 
PÜt
 
ourPÜt
,

235 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
,

236 
»şam©iÚSecÚds
)

237 : 
	`G’”icMedŸS”v”
(
’v
, 
ourSock‘
, 
ourPÜt
, 
»şam©iÚSecÚds
),

238 
	`fHTTPS”v”Sock‘
(-1), 
	`fHTTPS”v”PÜt
(0),

239 
	`fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
(
NULL
),

240 
	`fTCPSŒ—mšgD©aba£
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)),

241 
	`fP’dšgRegi¡”Reque¡s
(
HashTabË
::
	`ü—‹
(
ONE_WORD_HASH_KEYS
)), 
	`fRegi¡”Reque¡CouÁ”
(0),

242 
	`fAuthDB
(
authD©aba£
), 
	$fAÎowSŒ—mšgRTPOv”TCP
(
True
) {

243 
	}
}

247 şas 
	c¡»amšgOv”TCPRecÜd
 {

248 
	mpublic
:

249 
	$¡»amšgOv”TCPRecÜd
(
u_št32_t
 
£ssiÚId
, 
ŒackNum
, 
¡»amšgOv”TCPRecÜd
* 
Ãxt
)

250 : 
	`fNext
(
Ãxt
), 
	`fSessiÚId
(
£ssiÚId
), 
	$fT¿ckNum
(
ŒackNum
) {

252 
vœtu®
 ~
	$¡»amšgOv”TCPRecÜd
() {

253 
d–‘e
 
fNext
;

254 
	}
}

256 
¡»amšgOv”TCPRecÜd
* 
	gfNext
;

257 
u_št32_t
 
	gfSessiÚId
;

258 
	gfT¿ckNum
;

261 
	gRTSPS”v”
::~
	$RTSPS”v”
() {

263 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
fHTTPS”v”Sock‘
);

264 ::
	`şo£Sock‘
(
fHTTPS”v”Sock‘
);

265 
d–‘e
 
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
;

267 
	`ş—nup
();

270 
Regi¡”Reque¡RecÜd
* 
»gi¡”Reque¡
;

271 (
»gi¡”Reque¡
 = (
Regi¡”Reque¡RecÜd
*)
fP’dšgRegi¡”Reque¡s
->
	`g‘Fœ¡
()è!ğ
NULL
) {

272 
d–‘e
 
»gi¡”Reque¡
;

274 
d–‘e
 
fP’dšgRegi¡”Reque¡s
;

277 
¡»amšgOv”TCPRecÜd
* 
sÙı
;

278 (
sÙı
 = (
¡»amšgOv”TCPRecÜd
*)
fTCPSŒ—mšgD©aba£
->
	`g‘Fœ¡
()è!ğ
NULL
) {

279 
d–‘e
 
sÙı
;

281 
d–‘e
 
fTCPSŒ—mšgD©aba£
;

282 
	}
}

284 
BoŞ—n
 
	gRTSPS”v”
::
	$isRTSPS”v”
() const {

285  
True
;

286 
	}
}

288 
	gRTSPS”v”
::
	$šcomšgCÚÃùiÚHªdËrHTTP
(* 
š¡ªû
, ) {

289 
RTSPS”v”
* 
£rv”
 = (RTSPS”v”*)
š¡ªû
;

290 
£rv”
->
	`šcomšgCÚÃùiÚHªdËrHTTP
();

291 
	}
}

292 
	gRTSPS”v”
::
	$šcomšgCÚÃùiÚHªdËrHTTP
() {

293 
	`šcomšgCÚÃùiÚHªdËrOnSock‘
(
fHTTPS”v”Sock‘
);

294 
	}
}

296 
	gRTSPS”v”


297 ::
	$nÙeTCPSŒ—mšgOnSock‘
(
sock‘Num
, 
RTSPCl›ÁSessiÚ
* 
ş›ÁSessiÚ
, 
ŒackNum
) {

298 
¡»amšgOv”TCPRecÜd
* 
sÙıCur


299 ğ(
¡»amšgOv”TCPRecÜd
*)
fTCPSŒ—mšgD©aba£
->
	`Lookup
((cÚ¡*)
sock‘Num
);

300 
¡»amšgOv”TCPRecÜd
* 
sÙıNew


301 ğ
Ãw
 
	`¡»amšgOv”TCPRecÜd
(
ş›ÁSessiÚ
->
fOurSessiÚId
, 
ŒackNum
, 
sÙıCur
);

302 
fTCPSŒ—mšgD©aba£
->
	`Add
((cÚ¡*)
sock‘Num
, 
sÙıNew
);

303 
	}
}

305 
	gRTSPS”v”


306 ::
	$uÂÙeTCPSŒ—mšgOnSock‘
(
sock‘Num
, 
RTSPCl›ÁSessiÚ
* 
ş›ÁSessiÚ
, 
ŒackNum
) {

307 ià(
sock‘Num
 < 0) ;

308 
¡»amšgOv”TCPRecÜd
* 
sÙıH—d


309 ğ(
¡»amšgOv”TCPRecÜd
*)
fTCPSŒ—mšgD©aba£
->
	`Lookup
((cÚ¡*)
sock‘Num
);

310 ià(
sÙıH—d
 =ğ
NULL
) ;

313 
¡»amšgOv”TCPRecÜd
* 
sÙı
 = 
sÙıH—d
;

314 
¡»amšgOv”TCPRecÜd
* 
sÙıP»v
 = 
sÙıH—d
;

316 ià(
sÙı
->
fSessiÚId
 =ğ
ş›ÁSessiÚ
->
fOurSessiÚId
 && sÙı->
fT¿ckNum
 =ğ
ŒackNum
) ;

317 
sÙıP»v
 = 
sÙı
;

318 
sÙı
 = sÙı->
fNext
;

319 } 
sÙı
 !ğ
NULL
);

320 ià(
sÙı
 =ğ
NULL
) ;

322 ià(
sÙı
 =ğ
sÙıH—d
) {

324 
sÙıH—d
 = 
sÙı
->
fNext
;

325 
sÙı
->
fNext
 = 
NULL
;

326 
d–‘e
 
sÙı
;

328 ià(
sÙıH—d
 =ğ
NULL
) {

330 
fTCPSŒ—mšgD©aba£
->
	`Remove
((cÚ¡*)
sock‘Num
);

333 
fTCPSŒ—mšgD©aba£
->
	`Add
((cÚ¡*)
sock‘Num
, 
sÙıH—d
);

337 
sÙıP»v
->
fNext
 = 
sÙı
->fNext;

338 
sÙı
->
fNext
 = 
NULL
;

339 
d–‘e
 
sÙı
;

341 
	}
}

343 
	gRTSPS”v”
::
	$¡İTCPSŒ—mšgOnSock‘
(
sock‘Num
) {

345 
¡»amšgOv”TCPRecÜd
* 
sÙı


346 ğ(
¡»amšgOv”TCPRecÜd
*)
fTCPSŒ—mšgD©aba£
->
	`Lookup
((cÚ¡*)
sock‘Num
);

347 ià(
sÙı
 !ğ
NULL
) {

349 
£ssiÚIdSŒ
[9];

350 
	`¥rštf
(
£ssiÚIdSŒ
, "%08X", 
sÙı
->
fSessiÚId
);

351 
RTSPCl›ÁSessiÚ
* 
ş›ÁSessiÚ


352 ğ(
RTSPS”v”
::
RTSPCl›ÁSessiÚ
*)(
fCl›ÁSessiÚs
->
	`Lookup
(
£ssiÚIdSŒ
));

353 ià(
ş›ÁSessiÚ
 !ğ
NULL
) {

354 
ş›ÁSessiÚ
->
	`d–‘eSŒ—mByT¿ck
(
sÙı
->
fT¿ckNum
);

357 
¡»amšgOv”TCPRecÜd
* 
sÙıNext
 = 
sÙı
->
fNext
;

358 
sÙı
->
fNext
 = 
NULL
;

359 
d–‘e
 
sÙı
;

360 
sÙı
 = 
sÙıNext
;

361 } 
sÙı
 !ğ
NULL
);

362 
fTCPSŒ—mšgD©aba£
->
	`Remove
((cÚ¡*)
sock‘Num
);

364 
	}
}

369 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


370 ::
	$RTSPCl›ÁCÚÃùiÚ
(
RTSPS”v”
& 
ourS”v”
, 
ş›ÁSock‘
, 
sockaddr_š
 
ş›ÁAddr
)

371 : 
G’”icMedŸS”v”
::
	`Cl›ÁCÚÃùiÚ
(
ourS”v”
, 
ş›ÁSock‘
, 
ş›ÁAddr
),

372 
	`fOurRTSPS”v”
(
ourS”v”
), 
	`fCl›ÁIÅutSock‘
(
fOurSock‘
), 
	`fCl›ÁOuutSock‘
(fOurSocket),

373 
	`fIsAùive
(
True
), 
	`fRecursiÚCouÁ
(0), 
	$fOurSessiÚCook›
(
NULL
) {

374 
	`»£tReque¡Bufãr
();

375 
	}
}

377 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::~
	$RTSPCl›ÁCÚÃùiÚ
() {

378 ià(
fOurSessiÚCook›
 !ğ
NULL
) {

380 
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
->
	`Remove
(
fOurSessiÚCook›
);

381 
d–‘e
[] 
fOurSessiÚCook›
;

384 
	`şo£Sock‘sRTSP
();

385 
	}
}

389 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
P¬amsFÜREGISTER


390 ::
P¬amsFÜREGISTER
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCÚÃùiÚ
, cÚ¡* 
u¾
, cÚ¡* 
u¾Suffix
,

391 
BoŞ—n
 
»u£CÚÃùiÚ
, BoŞ—À
d–iv”VŸTCP
, cÚ¡* 
´oxyURLSuffix
)

392 : 
fOurCÚÃùiÚ
(
ourCÚÃùiÚ
), 
fURL
(
¡rDup
(
u¾
)), 
fURLSuffix
(¡rDup(
u¾Suffix
)),

393 
fReu£CÚÃùiÚ
(
»u£CÚÃùiÚ
), 
fD–iv”VŸTCP
(
d–iv”VŸTCP
), 
fProxyURLSuffix
(
	$¡rDup
(
´oxyURLSuffix
)) {

394 
	}
}

396 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
P¬amsFÜREGISTER
::~
	$P¬amsFÜREGISTER
() {

397 
d–‘e
[] 
fURL
; d–‘e[] 
fURLSuffix
; d–‘e[] 
fProxyURLSuffix
;

398 
	}
}

402 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_OPTIONS
() {

403 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

405 
fCu¼’tCSeq
, 
	`d©eH—d”
(), 
fOurRTSPS”v”
.
	`®lowedCommªdNames
());

406 
	}
}

408 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


409 ::
	$hªdËCmd_GET_PARAMETER
(const* ) {

413 
	`£tRTSPRe¥Ú£
("200 OK", 
LIVEMEDIA_LIBRARY_VERSION_STRING
);

414 
	}
}

416 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


417 ::
	$hªdËCmd_SET_PARAMETER
(const* ) {

421 
	`£tRTSPRe¥Ú£
("200 OK");

422 
	}
}

424 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


425 ::
	$hªdËCmd_DESCRIBE
(cÚ¡* 
u¾P»Suffix
, cÚ¡* 
u¾Suffix
, cÚ¡* 
fuÎReque¡SŒ
) {

426 
S”v”MedŸSessiÚ
* 
£ssiÚ
 = 
NULL
;

427 * 
sdpDesütiÚ
 = 
NULL
;

428 * 
¹¥URL
 = 
NULL
;

430 
u¾TÙ®Suffix
[
RTSP_PARAM_STRING_MAX
];

431 
u¾TÙ®Suffix
[0] = '\0';

432 ià(
u¾P»Suffix
[0] != '\0') {

433 
	`¡rÿt
(
u¾TÙ®Suffix
, 
u¾P»Suffix
);

434 
	`¡rÿt
(
u¾TÙ®Suffix
, "/");

436 
	`¡rÿt
(
u¾TÙ®Suffix
, 
u¾Suffix
);

438 ià(!
	`auth’tiÿtiÚOK
("DESCRIBE", 
u¾TÙ®Suffix
, 
fuÎReque¡SŒ
)) ;

444 
£ssiÚ
 = 
fOurS”v”
.
	`lookupS”v”MedŸSessiÚ
(
u¾TÙ®Suffix
);

445 ià(
£ssiÚ
 =ğ
NULL
) {

446 
	`hªdËCmd_nÙFound
();

452 
£ssiÚ
->
	`šüem’tReã»nûCouÁ
();

455 
sdpDesütiÚ
 = 
£ssiÚ
->
	`g’”©eSDPDesütiÚ
();

456 ià(
sdpDesütiÚ
 =ğ
NULL
) {

459 
	`£tRTSPRe¥Ú£
("404 File Not Found, Or In Incorrect Format");

462 
sdpDesütiÚSize
 = 
	`¡¾’
(
sdpDesütiÚ
);

466 
¹¥URL
 = 
fOurRTSPS”v”
.
	`¹¥URL
(
£ssiÚ
, 
fCl›ÁIÅutSock‘
);

468 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

475 
fCu¼’tCSeq
,

476 
	`d©eH—d”
(),

477 
¹¥URL
,

478 
sdpDesütiÚSize
,

479 
sdpDesütiÚ
);

482 ià(
£ssiÚ
 !ğ
NULL
) {

484 
£ssiÚ
->
	`deüem’tReã»nûCouÁ
();

485 ià(
£ssiÚ
->
	`»ã»nûCouÁ
(è=ğ0 && sessiÚ->
	`d–‘eWh’UÄeã»nûd
()) {

486 
fOurS”v”
.
	`»moveS”v”MedŸSessiÚ
(
£ssiÚ
);

490 
d–‘e
[] 
sdpDesütiÚ
;

491 
d–‘e
[] 
¹¥URL
;

492 
	}
}

494 
	$lookFÜH—d”
(cÚ¡* 
h—d”Name
, cÚ¡* 
sourû
, 
sourûL’
, * 
»suÉSŒ
, 
»suÉMaxSize
) {

495 
»suÉSŒ
[0] = '\0';

496 
h—d”NameL’
 = 
	`¡¾’
(
h—d”Name
);

497 
i
 = 0; i < ()(
sourûL’
-
h—d”NameL’
); ++i) {

498 ià(
	`¡ºcmp
(&
sourû
[
i
], 
h—d”Name
, 
h—d”NameL’
) == 0 && source[i+headerNameLen] == ':') {

500 
i
 +ğ
h—d”NameL’
+1; i < ()
sourûL’
 && (
sourû
[i] == ' ' || source[i] == '\t'); ++i) {}

501 
j
 = 
i
; j < 
sourûL’
; ++j) {

502 ià(
sourû
[
j
] == '\r' || source[j] == '\n') {

504 ià(
j
-
i
+1 > 
»suÉMaxSize
) ;

505 cÚ¡* 
»suÉSourû
 = &
sourû
[
i
];

506 cÚ¡* 
»suÉSourûEnd
 = &
sourû
[
j
];

507 
»suÉSourû
 < 
»suÉSourûEnd
è*
»suÉSŒ
++ = *resultSource++;

508 *
»suÉSŒ
 = '\0';

514 
	}
}

516 
	gRTSPS”v”


517 ::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_REGISTER
(cÚ¡* 
u¾
, cÚ¡* 
u¾Suffix
, cÚ¡* 
fuÎReque¡SŒ
,

518 
BoŞ—n
 
»u£CÚÃùiÚ
, BoŞ—À
d–iv”VŸTCP
, cÚ¡* 
´oxyURLSuffix
) {

519 * 
»¥Ú£SŒ
;

520 ià(
fOurRTSPS”v”
.
	`weIm¶em’tREGISTER
(
´oxyURLSuffix
, 
»¥Ú£SŒ
)) {

522 ià(!
	`auth’tiÿtiÚOK
("REGISTER", 
u¾Suffix
, 
fuÎReque¡SŒ
)) ;

526 
	`£tRTSPRe¥Ú£
(
»¥Ú£SŒ
 =ğ
NULL
 ? "200 OK" :„esponseStr);

527 
d–‘e
[] 
»¥Ú£SŒ
;

529 
P¬amsFÜREGISTER
* 
»gi¡”P¬ams
 = 
Ãw
 
	`P¬amsFÜREGISTER
(
this
, 
u¾
, 
u¾Suffix
, 
»u£CÚÃùiÚ
, 
d–iv”VŸTCP
, 
´oxyURLSuffix
);

530 
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0, (
TaskFunc
*)
cÚtšueHªdlšgREGISTER
, 
»gi¡”P¬ams
);

531 } ià(
»¥Ú£SŒ
 !ğ
NULL
) {

532 
	`£tRTSPRe¥Ú£
(
»¥Ú£SŒ
);

533 
d–‘e
[] 
»¥Ú£SŒ
;

535 
	`hªdËCmd_nÙSuµÜ‹d
();

537 
	}
}

539 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_bad
() {

541 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

543 
	`d©eH—d”
(), 
fOurRTSPS”v”
.
	`®lowedCommªdNames
());

544 
	}
}

546 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_nÙSuµÜ‹d
() {

547 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

549 
fCu¼’tCSeq
, 
	`d©eH—d”
(), 
fOurRTSPS”v”
.
	`®lowedCommªdNames
());

550 
	}
}

552 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_nÙFound
() {

553 
	`£tRTSPRe¥Ú£
("404 Stream Not Found");

554 
	}
}

556 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_£ssiÚNÙFound
() {

557 
	`£tRTSPRe¥Ú£
("454 Session Not Found");

558 
	}
}

560 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËCmd_unsuµÜ‹dT¿n¥Üt
() {

561 
	`£tRTSPRe¥Ú£
("461 Unsupported Transport");

562 
	}
}

564 
BoŞ—n
 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$·r£HTTPReque¡SŒšg
(* 
»suÉCmdName
, 
»suÉCmdNameMaxSize
,

565 * 
u¾Suffix
, 
u¾SuffixMaxSize
,

566 * 
£ssiÚCook›
, 
£ssiÚCook›MaxSize
,

567 * 
acû±SŒ
, 
acû±SŒMaxSize
) {

570 cÚ¡* 
»qSŒ
 = (cÚ¡*)
fReque¡Bufãr
;

571 cÚ¡ 
»qSŒSize
 = 
fReque¡By‹sAÌ—dyS“n
;

574 
BoŞ—n
 
·r£Sucûeded
 = 
F®£
;

575 
i
;

576 
i
 = 0; i < 
»suÉCmdNameMaxSize
-1 && i < 
»qSŒSize
; ++i) {

577 
c
 = 
»qSŒ
[
i
];

578 ià(
c
 == ' ' || c == '\t') {

579 
·r£Sucûeded
 = 
True
;

583 
»suÉCmdName
[
i
] = 
c
;

585 
»suÉCmdName
[
i
] = '\0';

586 ià(!
·r£Sucûeded
è 
F®£
;

589 
·r£Sucûeded
 = 
F®£
;

590 ; 
i
 < 
»qSŒSize
-5 && 
»qSŒ
[i] != '\r' &&„eqStr[i] != '\n'; ++i) {

591 ià(
»qSŒ
[
i
] == 'H' &&„eqStr[i+1] == 'T' &&„eqStr[i+2]== 'T' &&„eqStr[i+3]== 'P' &&„eqStr[i+4]== '/') {

592 
i
 += 5;

593 
·r£Sucûeded
 = 
True
;

597 ià(!
·r£Sucûeded
è 
F®£
;

600 
k
 = 
i
-6;

601 
k
 > 0 && 
»qSŒ
[k] == ' ') --k;

602 
j
 = 
k
;

603 
j
 > 0 && 
»qSŒ
[j] != ' ' &&„eqStr[j] != '/') --j;

605 ià(
k
 - 
j
 + 1 > 
u¾SuffixMaxSize
è 
F®£
;

606 
n
 = 0;

607 ++
j
 <ğ
k
è
u¾Suffix
[
n
++] = 
»qSŒ
[j];

608 
u¾Suffix
[
n
] = '\0';

611 
	`lookFÜH—d”
("x-£ssiÚcook›", &
»qSŒ
[
i
], 
»qSŒSize
-i, 
£ssiÚCook›
, 
£ssiÚCook›MaxSize
);

612 
	`lookFÜH—d”
("Acû±", &
»qSŒ
[
i
], 
»qSŒSize
-i, 
acû±SŒ
, 
acû±SŒMaxSize
);

614  
True
;

615 
	}
}

617 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËHTTPCmd_nÙSuµÜ‹d
() {

618 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

620 
	`d©eH—d”
());

621 
	}
}

623 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËHTTPCmd_nÙFound
() {

624 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

626 
	`d©eH—d”
());

627 
	}
}

629 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËHTTPCmd_OPTIONS
() {

630 #ifdeà
DEBUG


631 
	`årštf
(
¡d”r
, "Handled HTTP \"OPTIONS\"„equest\n");

634 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

642 
	`d©eH—d”
());

643 
	}
}

645 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËHTTPCmd_TuÂ–šgGET
(cÚ¡* 
£ssiÚCook›
) {

648 ià(
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
 =ğ
NULL
) {

649 
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
 = 
HashTabË
::
	`ü—‹
(
STRING_HASH_KEYS
);

651 
d–‘e
[] 
fOurSessiÚCook›
; fOurSessiÚCook› = 
	`¡rDup
(
£ssiÚCook›
);

652 
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
->
	`Add
(
£ssiÚCook›
, (*)
this
);

653 #ifdeà
DEBUG


654 
	`årštf
(
¡d”r
, "HªdËd HTTP \"GET\"„eque¡ (ş›Á ouuˆsock‘: %d)\n", 
fCl›ÁOuutSock‘
);

658 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

665 
	`d©eH—d”
());

666 
	}
}

668 
BoŞ—n
 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


669 ::
	$hªdËHTTPCmd_TuÂ–šgPOST
(cÚ¡* 
£ssiÚCook›
, cÚ¡* 
exŒaD©a
, 
exŒaD©aSize
) {

672 ià(
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
 =ğ
NULL
) {

673 
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
 = 
HashTabË
::
	`ü—‹
(
STRING_HASH_KEYS
);

675 
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
´evCl›ÁCÚÃùiÚ


676 ğ(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
*)(
fOurRTSPS”v”
.
fCl›ÁCÚÃùiÚsFÜHTTPTuÂ–šg
->
	`Lookup
(
£ssiÚCook›
));

677 ià(
´evCl›ÁCÚÃùiÚ
 =ğ
NULL
) {

679 
	`hªdËHTTPCmd_nÙSuµÜ‹d
();

680 
fIsAùive
 = 
F®£
;

681  
F®£
;

683 #ifdeà
DEBUG


684 
	`årštf
(
¡d”r
, "HªdËd HTTP \"POST\"„eque¡ (ş›Á iÅuˆsock‘: %d)\n", 
fCl›ÁIÅutSock‘
);

688 
´evCl›ÁCÚÃùiÚ
->
	`chªgeCl›ÁIÅutSock‘
(
fCl›ÁIÅutSock‘
, 
exŒaD©a
, 
exŒaD©aSize
);

689 
fCl›ÁIÅutSock‘
 = 
fCl›ÁOuutSock‘
 = -1;

690  
True
;

691 
	}
}

693 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËHTTPCmd_SŒ—mšgGET
(const* , const* ) {

695 
	`hªdËHTTPCmd_nÙSuµÜ‹d
();

696 
	}
}

698 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$»£tReque¡Bufãr
() {

699 
Cl›ÁCÚÃùiÚ
::
	`»£tReque¡Bufãr
();

701 
fLa¡CRLF
 = &
fReque¡Bufãr
[-3];

702 
fBa£64Remašd”CouÁ
 = 0;

703 
	}
}

705 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$şo£Sock‘sRTSP
() {

707 
fOurRTSPS”v”
.
	`¡İTCPSŒ—mšgOnSock‘
(
fCl›ÁOuutSock‘
);

710 ià(
fCl›ÁOuutSock‘
 !ğ
fCl›ÁIÅutSock‘
) {

711 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fCl›ÁOuutSock‘
);

712 ::
	`şo£Sock‘
(
fCl›ÁOuutSock‘
);

714 
fCl›ÁOuutSock‘
 = -1;

716 
	`şo£Sock‘s
();

717 
	}
}

719 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËAÉ”ÇtiveReque¡By‹
(* 
š¡ªû
, 
u_št8_t
 
»que¡By‹
) {

720 
RTSPCl›ÁCÚÃùiÚ
* 
cÚÃùiÚ
 = (RTSPCl›ÁCÚÃùiÚ*)
š¡ªû
;

721 
cÚÃùiÚ
->
	`hªdËAÉ”ÇtiveReque¡By‹1
(
»que¡By‹
);

722 
	}
}

724 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËAÉ”ÇtiveReque¡By‹1
(
u_št8_t
 
»que¡By‹
) {

725 ià(
»que¡By‹
 == 0xFF) {

727 
	`hªdËReque¡By‹s
(-1);

728 } ià(
»que¡By‹
 == 0xFE) {

730 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fCl›ÁIÅutSock‘
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
,

731 
šcomšgReque¡HªdËr
, 
this
);

734 ià(
fReque¡BufãrBy‹sLeá
 =ğ0 || 
fReque¡By‹sAÌ—dyS“n
 >ğ
REQUEST_BUFFER_SIZE
) ;

735 
fReque¡Bufãr
[
fReque¡By‹sAÌ—dyS“n
] = 
»que¡By‹
;

736 
	`hªdËReque¡By‹s
(1);

738 
	}
}

741 
	$·r£T¿n¥ÜtH—d”FÜREGISTER
(cÚ¡* 
buf
,

742 
BoŞ—n
 &
»u£CÚÃùiÚ
,

743 
BoŞ—n
& 
d–iv”VŸTCP
,

744 *& 
´oxyURLSuffix
) {

746 
»u£CÚÃùiÚ
 = 
F®£
;

747 
d–iv”VŸTCP
 = 
F®£
;

748 
´oxyURLSuffix
 = 
NULL
;

752 ià(*
buf
 == '\0') ;

753 ià(*
buf
 == '\r' && *(buf+1) == '\n' && *(buf+2) == '\r') ;

754 ià(
	`_¡ºÿ£cmp
(
buf
, "Transport:", 10) == 0) ;

755 ++
buf
;

759 cÚ¡* 
f›lds
 = 
buf
 + 10;

760 *
f›lds
 == ' ') ++fields;

761 * 
f›ld
 = 
	`¡rDupSize
(
f›lds
);

762 
	`ssÿnf
(
f›lds
, "%[^;\r\n]", 
f›ld
) == 1) {

763 ià(
	`¡rcmp
(
f›ld
, "reuse_connection") == 0) {

764 
»u£CÚÃùiÚ
 = 
True
;

765 } ià(
	`_¡ºÿ£cmp
(
f›ld
, "preferred_delivery_protocol=udp", 31) == 0) {

766 
d–iv”VŸTCP
 = 
F®£
;

767 } ià(
	`_¡ºÿ£cmp
(
f›ld
, "preferred_delivery_protocol=interleaved", 39) == 0) {

768 
d–iv”VŸTCP
 = 
True
;

769 } ià(
	`_¡ºÿ£cmp
(
f›ld
, "proxy_url_suffix=", 17) == 0) {

770 
d–‘e
[] 
´oxyURLSuffix
;

771 
´oxyURLSuffix
 = 
	`¡rDup
(
f›ld
+17);

774 
f›lds
 +ğ
	`¡¾’
(
f›ld
);

775 *
f›lds
 == ';' || *fields == ' ' || *fields == '\t') ++fields;

776 ià(*
f›lds
 == '\0' || *fields == '\r' || *fields == '\n') ;

778 
d–‘e
[] 
f›ld
;

779 
	}
}

781 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$hªdËReque¡By‹s
(
ÃwBy‹sR—d
) {

782 
numBy‹sRemaššg
 = 0;

783 ++
fRecursiÚCouÁ
;

786 
RTSPS”v”
::
RTSPCl›ÁSessiÚ
* 
ş›ÁSessiÚ
 = 
NULL
;

788 ià(
ÃwBy‹sR—d
 < 0 || (êewBy‹sR—d >ğ
fReque¡BufãrBy‹sLeá
) {

791 #ifdeà
DEBUG


792 
	`årštf
(
¡d”r
, "RTSPCl›ÁCÚÃùiÚ[%p]::hªdËReque¡By‹s(è»ad %d‚ew by‹ (oà%d);”mš©šg cÚÃùiÚ!\n", 
this
, 
ÃwBy‹sR—d
, 
fReque¡BufãrBy‹sLeá
);

794 
fIsAùive
 = 
F®£
;

798 
BoŞ—n
 
’dOfMsg
 = 
F®£
;

799 * 
±r
 = &
fReque¡Bufãr
[
fReque¡By‹sAÌ—dyS“n
];

800 #ifdeà
DEBUG


801 
±r
[
ÃwBy‹sR—d
] = '\0';

802 
	`årštf
(
¡d”r
, "RTSPClientConnection[%p]::handleRequestBytes() %s %d‚ew bytes:%s\n",

803 
this
, 
numBy‹sRemaššg
 > 0 ? "´oûssšg" : "»ad", 
ÃwBy‹sR—d
, 
±r
);

806 ià(
fCl›ÁOuutSock‘
 !ğ
fCl›ÁIÅutSock‘
 && 
numBy‹sRemaššg
 == 0) {

811 
toIndex
 = 0;

812 
äomIndex
 = 0; fromIndex < 
ÃwBy‹sR—d
; ++fromIndex) {

813 
c
 = 
±r
[
äomIndex
];

814 ià(!(
c
 == ' ' || c == '\t' || c == '\r' || c == '\n')) {

815 
±r
[
toIndex
++] = 
c
;

818 
ÃwBy‹sR—d
 = 
toIndex
;

820 
numBy‹sToDecode
 = 
fBa£64Remašd”CouÁ
 + 
ÃwBy‹sR—d
;

821 
ÃwBa£64Remašd”CouÁ
 = 
numBy‹sToDecode
%4;

822 
numBy‹sToDecode
 -ğ
ÃwBa£64Remašd”CouÁ
;

823 ià(
numBy‹sToDecode
 > 0) {

824 
±r
[
ÃwBy‹sR—d
] = '\0';

825 
decodedSize
;

826 * 
decodedBy‹s
 = 
	`ba£64Decode
((cÚ¡*)(
±r
-
fBa£64Remašd”CouÁ
), 
numBy‹sToDecode
, 
decodedSize
);

827 #ifdeà
DEBUG


828 
	`årštf
(
¡d”r
, "Ba£64-decoded %d iÅuˆby‹ štØ%d‚ew by‹s:", 
numBy‹sToDecode
, 
decodedSize
);

829 
k
 = 0; k < 
decodedSize
; ++kè
	`årštf
(
¡d”r
, "%c", 
decodedBy‹s
[k]);

830 
	`årštf
(
¡d”r
, "\n");

834 * 
to
 = 
±r
-
fBa£64Remašd”CouÁ
;

835 
i
 = 0; i < 
decodedSize
; ++iè*
to
++ = 
decodedBy‹s
[i];

838 
j
 = 0; j < 
ÃwBa£64Remašd”CouÁ
; ++jè*
to
++ = (
±r
-
fBa£64Remašd”CouÁ
+
numBy‹sToDecode
)[j];

840 
ÃwBy‹sR—d
 = 
decodedSize
 - 
fBa£64Remašd”CouÁ
 + 
ÃwBa£64Remašd”CouÁ
;

842 
d–‘e
[] 
decodedBy‹s
;

844 
fBa£64Remašd”CouÁ
 = 
ÃwBa£64Remašd”CouÁ
;

847 * 
tmpPŒ
 = 
fLa¡CRLF
 + 2;

848 ià(
fBa£64Remašd”CouÁ
 == 0) {

850 ià(
tmpPŒ
 < 
fReque¡Bufãr
)mpPtr = fRequestBuffer;

851 
tmpPŒ
 < &
±r
[
ÃwBy‹sR—d
-1]) {

852 ià(*
tmpPŒ
 == '\r' && *(tmpPtr+1) == '\n') {

853 ià(
tmpPŒ
 - 
fLa¡CRLF
 == 2) {

854 
’dOfMsg
 = 
True
;

857 
fLa¡CRLF
 = 
tmpPŒ
;

859 ++
tmpPŒ
;

863 
fReque¡BufãrBy‹sLeá
 -ğ
ÃwBy‹sR—d
;

864 
fReque¡By‹sAÌ—dyS“n
 +ğ
ÃwBy‹sR—d
;

866 ià(!
’dOfMsg
) ;

869 
fReque¡Bufãr
[
fReque¡By‹sAÌ—dyS“n
] = '\0';

870 
cmdName
[
RTSP_PARAM_STRING_MAX
];

871 
u¾P»Suffix
[
RTSP_PARAM_STRING_MAX
];

872 
u¾Suffix
[
RTSP_PARAM_STRING_MAX
];

873 
c£q
[
RTSP_PARAM_STRING_MAX
];

874 
£ssiÚIdSŒ
[
RTSP_PARAM_STRING_MAX
];

875 
cÚ‹ÁL’gth
 = 0;

876 
fLa¡CRLF
[2] = '\0';

877 
BoŞ—n
 
·r£Sucûeded
 = 
	`·r£RTSPReque¡SŒšg
((*)
fReque¡Bufãr
, 
fLa¡CRLF
+2 - fRequestBuffer,

878 
cmdName
,  cmdName,

879 
u¾P»Suffix
,  urlPreSuffix,

880 
u¾Suffix
,  urlSuffix,

881 
c£q
,  cseq,

882 
£ssiÚIdSŒ
,  sessionIdStr,

883 
cÚ‹ÁL’gth
);

884 
fLa¡CRLF
[2] = '\r';

885 
BoŞ—n
 
¶ayAá”S‘up
 = 
F®£
;

886 ià(
·r£Sucûeded
) {

887 #ifdeà
DEBUG


888 
	`årštf
(
¡d”r
, "·r£RTSPReque¡SŒšg(èsucûeded,„‘uºšg cmdNam\"%s\", u¾P»Suffix \"%s\", u¾Suffix \"%s\", CSeq \"%s\", CÚ‹Á-L’gth %u, w™h %d by‹ fŞlowšghmes§ge.\n", 
cmdName
, 
u¾P»Suffix
, 
u¾Suffix
, 
c£q
, 
cÚ‹ÁL’gth
, 
±r
 + 
ÃwBy‹sR—d
 - (
tmpPŒ
 + 2));

891 ià(
±r
 + 
ÃwBy‹sR—d
 < 
tmpPŒ
 + 2 + 
cÚ‹ÁL’gth
) ;

895 
BoŞ—n
 cÚ¡ 
»que¡InşudedSessiÚId
 = 
£ssiÚIdSŒ
[0] != '\0';

896 ià(
»que¡InşudedSessiÚId
) {

897 
ş›ÁSessiÚ
 = (
RTSPS”v”
::
RTSPCl›ÁSessiÚ
*)(
fOurRTSPS”v”
.
fCl›ÁSessiÚs
->
	`Lookup
(
£ssiÚIdSŒ
));

898 ià(
ş›ÁSessiÚ
 !ğ
NULL
èş›ÁSessiÚ->
	`nÙeLiv’ess
();

903 
fCu¼’tCSeq
 = 
c£q
;

904 ià(
	`¡rcmp
(
cmdName
, "OPTIONS") == 0) {

907 ià(
»que¡InşudedSessiÚId
 && 
ş›ÁSessiÚ
 =ğ
NULL
) {

908 
	`hªdËCmd_£ssiÚNÙFound
();

911 
	`hªdËCmd_OPTIONS
();

913 } ià(
u¾P»Suffix
[0] =ğ'\0' && 
u¾Suffix
[0] == '*' && urlSuffix[1] == '\0') {

915 ià(
	`¡rcmp
(
cmdName
, "GET_PARAMETER") == 0) {

916 
	`hªdËCmd_GET_PARAMETER
((cÚ¡*)
fReque¡Bufãr
);

917 } ià(
	`¡rcmp
(
cmdName
, "SET_PARAMETER") == 0) {

918 
	`hªdËCmd_SET_PARAMETER
((cÚ¡*)
fReque¡Bufãr
);

920 
	`hªdËCmd_nÙSuµÜ‹d
();

922 } ià(
	`¡rcmp
(
cmdName
, "DESCRIBE") == 0) {

923 
	`hªdËCmd_DESCRIBE
(
u¾P»Suffix
, 
u¾Suffix
, (cÚ¡*)
fReque¡Bufãr
);

924 } ià(
	`¡rcmp
(
cmdName
, "SETUP") == 0) {

925 
BoŞ—n
 
¬eAuth’tiÿ‹d
 = 
True
;

927 ià(!
»que¡InşudedSessiÚId
) {

934 
u¾TÙ®Suffix
[
RTSP_PARAM_STRING_MAX
];

935 
u¾TÙ®Suffix
[0] = '\0';

936 ià(
u¾P»Suffix
[0] != '\0') {

937 
	`¡rÿt
(
u¾TÙ®Suffix
, 
u¾P»Suffix
);

938 
	`¡rÿt
(
u¾TÙ®Suffix
, "/");

940 
	`¡rÿt
(
u¾TÙ®Suffix
, 
u¾Suffix
);

941 ià(
	`auth’tiÿtiÚOK
("SETUP", 
u¾TÙ®Suffix
, (cÚ¡*)
fReque¡Bufãr
)) {

942 
u_št32_t
 
£ssiÚId
;

944 
£ssiÚId
 = (
u_št32_t
)
	`our_¿ndom32
();

945 
	`¥rštf
(
£ssiÚIdSŒ
, "%08X", 
£ssiÚId
);

946 } 
£ssiÚId
 =ğ0 || 
fOurRTSPS”v”
.
fCl›ÁSessiÚs
->
	`Lookup
(
£ssiÚIdSŒ
è!ğ
NULL
);

947 
ş›ÁSessiÚ
 = (
RTSPCl›ÁSessiÚ
*)
fOurRTSPS”v”
.
	`ü—‹NewCl›ÁSessiÚ
(
£ssiÚId
);

948 
fOurRTSPS”v”
.
fCl›ÁSessiÚs
->
	`Add
(
£ssiÚIdSŒ
, 
ş›ÁSessiÚ
);

950 
¬eAuth’tiÿ‹d
 = 
F®£
;

953 ià(
ş›ÁSessiÚ
 !ğ
NULL
) {

954 
ş›ÁSessiÚ
->
	`hªdËCmd_SETUP
(
this
, 
u¾P»Suffix
, 
u¾Suffix
, (cÚ¡*)
fReque¡Bufãr
);

955 
¶ayAá”S‘up
 = 
ş›ÁSessiÚ
->
fSŒ—mAá”SETUP
;

956 } ià(
¬eAuth’tiÿ‹d
) {

957 
	`hªdËCmd_£ssiÚNÙFound
();

959 } ià(
	`¡rcmp
(
cmdName
, "TEARDOWN") == 0

960 || 
	`¡rcmp
(
cmdName
, "PLAY") == 0

961 || 
	`¡rcmp
(
cmdName
, "PAUSE") == 0

962 || 
	`¡rcmp
(
cmdName
, "GET_PARAMETER") == 0

963 || 
	`¡rcmp
(
cmdName
, "SET_PARAMETER") == 0) {

964 ià(
ş›ÁSessiÚ
 !ğ
NULL
) {

965 
ş›ÁSessiÚ
->
	`hªdËCmd_w™hšSessiÚ
(
this
, 
cmdName
, 
u¾P»Suffix
, 
u¾Suffix
, (cÚ¡*)
fReque¡Bufãr
);

967 
	`hªdËCmd_£ssiÚNÙFound
();

969 } ià(
	`¡rcmp
(
cmdName
, "REGISTER") == 0) {

972 * 
u¾
 = 
	`¡rDupSize
((*)
fReque¡Bufãr
);

973 ià(
	`ssÿnf
((*)
fReque¡Bufãr
, "%* %s", 
u¾
) == 1) {

975 
BoŞ—n
 
»u£CÚÃùiÚ
, 
d–iv”VŸTCP
;

976 * 
´oxyURLSuffix
;

977 
	`·r£T¿n¥ÜtH—d”FÜREGISTER
((cÚ¡ *)
fReque¡Bufãr
, 
»u£CÚÃùiÚ
, 
d–iv”VŸTCP
, 
´oxyURLSuffix
);

979 
	`hªdËCmd_REGISTER
(
u¾
, 
u¾Suffix
, (cÚ¡*)
fReque¡Bufãr
, 
»u£CÚÃùiÚ
, 
d–iv”VŸTCP
, 
´oxyURLSuffix
);

980 
d–‘e
[] 
´oxyURLSuffix
;

982 
	`hªdËCmd_bad
();

984 
d–‘e
[] 
u¾
;

987 
	`hªdËCmd_nÙSuµÜ‹d
();

990 #ifdeà
DEBUG


991 
	`årštf
(
¡d”r
, "parseRTSPRequestString() failed; checking‚ow for HTTP commands (for RTSP-over-HTTPunneling)...\n");

994 
£ssiÚCook›
[
RTSP_PARAM_STRING_MAX
];

995 
acû±SŒ
[
RTSP_PARAM_STRING_MAX
];

996 *
fLa¡CRLF
 = '\0';

997 
·r£Sucûeded
 = 
	`·r£HTTPReque¡SŒšg
(
cmdName
,  cmdName,

998 
u¾Suffix
,  
u¾P»Suffix
,

999 
£ssiÚCook›
,  sessionCookie,

1000 
acû±SŒ
, ‡cceptStr);

1001 *
fLa¡CRLF
 = '\r';

1002 ià(
·r£Sucûeded
) {

1003 #ifdeà
DEBUG


1004 
	`årštf
(
¡d”r
, "·r£HTTPReque¡SŒšg(èsucûeded,„‘uºšg cmdNam\"%s\", u¾Suffix \"%s\", sessiÚCook› \"%s\",‡cû±SŒ \"%s\"\n", 
cmdName
, 
u¾Suffix
, 
£ssiÚCook›
, 
acû±SŒ
);

1007 
BoŞ—n
 
isV®idHTTPCmd
 = 
True
;

1008 ià(
	`¡rcmp
(
cmdName
, "OPTIONS") == 0) {

1009 
	`hªdËHTTPCmd_OPTIONS
();

1010 } ià(
£ssiÚCook›
[0] == '\0') {

1013 ià(
	`¡rcmp
(
acû±SŒ
, "application/x-rtsp-tunnelled") == 0) {

1014 
isV®idHTTPCmd
 = 
F®£
;

1016 
	`hªdËHTTPCmd_SŒ—mšgGET
(
u¾Suffix
, (cÚ¡*)
fReque¡Bufãr
);

1018 } ià(
	`¡rcmp
(
cmdName
, "GET") == 0) {

1019 
	`hªdËHTTPCmd_TuÂ–šgGET
(
£ssiÚCook›
);

1020 } ià(
	`¡rcmp
(
cmdName
, "POST") == 0) {

1023 cÚ¡* 
exŒaD©a
 = 
fLa¡CRLF
+4;

1024 
exŒaD©aSize
 = &
fReque¡Bufãr
[
fReque¡By‹sAÌ—dyS“n
] - 
exŒaD©a
;

1025 ià(
	`hªdËHTTPCmd_TuÂ–šgPOST
(
£ssiÚCook›
, 
exŒaD©a
, 
exŒaD©aSize
)) {

1027 
fIsAùive
 = 
F®£
;

1031 
isV®idHTTPCmd
 = 
F®£
;

1033 ià(!
isV®idHTTPCmd
) {

1034 
	`hªdËHTTPCmd_nÙSuµÜ‹d
();

1037 #ifdeà
DEBUG


1038 
	`årštf
(
¡d”r
, "parseHTTPRequestString() failed!\n");

1040 
	`hªdËCmd_bad
();

1044 #ifdeà
DEBUG


1045 
	`årštf
(
¡d”r
, "£ndšg„e¥Ú£: %s", 
fRe¥Ú£Bufãr
);

1047 
	`£nd
(
fCl›ÁOuutSock‘
, (cÚ¡*)
fRe¥Ú£Bufãr
, 
	`¡¾’
((*)fResponseBuffer), 0);

1049 ià(
¶ayAá”S‘up
) {

1052 
ş›ÁSessiÚ
->
	`hªdËCmd_w™hšSessiÚ
(
this
, "PLAY", 
u¾P»Suffix
, 
u¾Suffix
, (cÚ¡*)
fReque¡Bufãr
);

1057 
»que¡Size
 = (
fLa¡CRLF
+4-
fReque¡Bufãr
è+ 
cÚ‹ÁL’gth
;

1058 
numBy‹sRemaššg
 = 
fReque¡By‹sAÌ—dyS“n
 - 
»que¡Size
;

1059 
	`»£tReque¡Bufãr
();

1061 ià(
numBy‹sRemaššg
 > 0) {

1062 
	`memmove
(
fReque¡Bufãr
, &fReque¡Bufãr[
»que¡Size
], 
numBy‹sRemaššg
);

1063 
ÃwBy‹sR—d
 = 
numBy‹sRemaššg
;

1065 } 
numBy‹sRemaššg
 > 0);

1067 --
fRecursiÚCouÁ
;

1068 ià(!
fIsAùive
) {

1069 ià(
fRecursiÚCouÁ
 > 0è
	`şo£Sock‘s
(); 
d–‘e
 
this
;

1074 
	}
}

1076 
BoŞ—n
 
	$·r£AuthÜiz©iÚH—d”
(cÚ¡* 
buf
,

1077 cÚ¡*& 
u£ºame
,

1078 cÚ¡*& 
»®m
,

1079 cÚ¡*& 
nÚû
, cÚ¡*& 
uri
,

1080 cÚ¡*& 
»¥Ú£
) {

1082 
u£ºame
 = 
»®m
 = 
nÚû
 = 
uri
 = 
»¥Ú£
 = 
NULL
;

1086 ià(*
buf
 =ğ'\0'è 
F®£
;

1087 ià(
	`_¡ºÿ£cmp
(
buf
, "Authorization: Digest ", 22) == 0) ;

1088 ++
buf
;

1092 cÚ¡* 
f›lds
 = 
buf
 + 22;

1093 *
f›lds
 == ' ') ++fields;

1094 * 
·¿m‘”
 = 
	`¡rDupSize
(
f›lds
);

1095 * 
v®ue
 = 
	`¡rDupSize
(
f›lds
);

1097 
v®ue
[0] = '\0';

1098 ià(
	`ssÿnf
(
f›lds
, "%[^=]=\"%[^\"]\"", 
·¿m‘”
, 
v®ue
) != 2 &&

1099 
	`ssÿnf
(
f›lds
, "%[^=]=\"\"", 
·¿m‘”
) != 1) {

1102 ià(
	`¡rcmp
(
·¿m‘”
, "username") == 0) {

1103 
u£ºame
 = 
	`¡rDup
(
v®ue
);

1104 } ià(
	`¡rcmp
(
·¿m‘”
, "realm") == 0) {

1105 
»®m
 = 
	`¡rDup
(
v®ue
);

1106 } ià(
	`¡rcmp
(
·¿m‘”
, "nonce") == 0) {

1107 
nÚû
 = 
	`¡rDup
(
v®ue
);

1108 } ià(
	`¡rcmp
(
·¿m‘”
, "uri") == 0) {

1109 
uri
 = 
	`¡rDup
(
v®ue
);

1110 } ià(
	`¡rcmp
(
·¿m‘”
, "response") == 0) {

1111 
»¥Ú£
 = 
	`¡rDup
(
v®ue
);

1114 
f›lds
 +ğ
	`¡¾’
(
·¿m‘”
è+ 2 + sŒËn(
v®ue
) + 1 ;

1115 *
f›lds
 == ',' || *fields == ' ') ++fields;

1117 ià(*
f›lds
 == '\0' || *fields == '\r' || *fields == '\n') ;

1119 
d–‘e
[] 
·¿m‘”
; d–‘e[] 
v®ue
;

1120  
True
;

1121 
	}
}

1123 
BoŞ—n
 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


1124 ::
	$auth’tiÿtiÚOK
(cÚ¡* 
cmdName
, cÚ¡* 
u¾Suffix
, cÚ¡* 
fuÎReque¡SŒ
) {

1125 ià(!
fOurRTSPS”v”
.
	`¥ecŸlCl›ÁAcûssCheck
(
fCl›ÁIÅutSock‘
, 
fCl›ÁAddr
, 
u¾Suffix
)) {

1126 
	`£tRTSPRe¥Ú£
("401 Unauthorized");

1127  
F®£
;

1131 
U£rAuth’tiÿtiÚD©aba£
* 
authDB
 = 
fOurRTSPS”v”
.
	`g‘Auth’tiÿtiÚD©aba£FÜCommªd
(
cmdName
);

1132 ià(
authDB
 =ğ
NULL
è 
True
;

1134 cÚ¡* 
u£ºame
 = 
NULL
; cÚ¡* 
»®m
 = NULL; cÚ¡* 
nÚû
 = NULL;

1135 cÚ¡* 
uri
 = 
NULL
; cÚ¡* 
»¥Ú£
 = NULL;

1136 
BoŞ—n
 
sucûss
 = 
F®£
;

1141 ià(
fCu¼’tAuth’tiÿtÜ
.
	`nÚû
(è=ğ
NULL
) ;

1146 ià(!
	`·r£AuthÜiz©iÚH—d”
(
fuÎReque¡SŒ
,

1147 
u£ºame
, 
»®m
, 
nÚû
, 
uri
, 
»¥Ú£
)

1148 || 
u£ºame
 =ğ
NULL


1149 || 
»®m
 =ğ
NULL
 || 
	`¡rcmp
Ô—lm, 
fCu¼’tAuth’tiÿtÜ
.
	`»®m
()) != 0

1150 || 
nÚû
 =ğ
NULL
 || 
	`¡rcmp
ÒÚû, 
fCu¼’tAuth’tiÿtÜ
.
	`nÚû
()) != 0

1151 || 
uri
 =ğ
NULL
 || 
»¥Ú£
 == NULL) {

1156 cÚ¡* 
·sswÜd
 = 
authDB
->
	`lookupPasswÜd
(
u£ºame
);

1157 #ifdeà
DEBUG


1158 
	`årštf
(
¡d”r
, "lookupPasswÜd(%sè»tuºed…asswÜd %s\n", 
u£ºame
, 
·sswÜd
);

1160 ià(
·sswÜd
 =ğ
NULL
) ;

1161 
fCu¼’tAuth’tiÿtÜ
.
	`£tU£ºameAndPasswÜd
(
u£ºame
, 
·sswÜd
, 
authDB
->
	`·sswÜdsA»MD5
());

1165 cÚ¡* 
ourRe¥Ú£


1166 ğ
fCu¼’tAuth’tiÿtÜ
.
	`compu‹Dige¡Re¥Ú£
(
cmdName
, 
uri
);

1167 
sucûss
 = (
	`¡rcmp
(
ourRe¥Ú£
, 
»¥Ú£
) == 0);

1168 
fCu¼’tAuth’tiÿtÜ
.
	`»şaimDige¡Re¥Ú£
(
ourRe¥Ú£
);

1171 
d–‘e
[] (*)
»®m
; d–‘e[] (*)
nÚû
;

1172 
d–‘e
[] (*)
uri
; d–‘e[] (*)
»¥Ú£
;

1174 ià(
sucûss
) {

1177 ià(!
fOurRTSPS”v”
.
	`¥ecŸlCl›ÁU£rAcûssCheck
(
fCl›ÁIÅutSock‘
, 
fCl›ÁAddr
, 
u¾Suffix
, 
u£ºame
)) {

1180 
	`£tRTSPRe¥Ú£
("401 Unauthorized");

1181 
d–‘e
[] (*)
u£ºame
;

1182  
F®£
;

1185 
d–‘e
[] (*)
u£ºame
;

1186 ià(
sucûss
è 
True
;

1190 
fCu¼’tAuth’tiÿtÜ
.
	`£tR—lmAndRªdomNÚû
(
authDB
->
	`»®m
());

1191 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

1196 
fCu¼’tCSeq
,

1197 
	`d©eH—d”
(),

1198 
fCu¼’tAuth’tiÿtÜ
.
	`»®m
(), fCu¼’tAuth’tiÿtÜ.
	`nÚû
());

1199  
F®£
;

1200 
	}
}

1202 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


1203 ::
	$£tRTSPRe¥Ú£
(cÚ¡* 
»¥Ú£SŒ
) {

1204 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

1208 
»¥Ú£SŒ
,

1209 
fCu¼’tCSeq
,

1210 
	`d©eH—d”
());

1211 
	}
}

1213 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


1214 ::
	$£tRTSPRe¥Ú£
(cÚ¡* 
»¥Ú£SŒ
, 
u_št32_t
 
£ssiÚId
) {

1215 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

1220 
»¥Ú£SŒ
,

1221 
fCu¼’tCSeq
,

1222 
	`d©eH—d”
(),

1223 
£ssiÚId
);

1224 
	}
}

1226 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


1227 ::
	$£tRTSPRe¥Ú£
(cÚ¡* 
»¥Ú£SŒ
, cÚ¡* 
cÚ‹ÁSŒ
) {

1228 ià(
cÚ‹ÁSŒ
 =ğ
NULL
) contentStr = "";

1229 cÚ¡ 
cÚ‹ÁL’
 = 
	`¡¾’
(
cÚ‹ÁSŒ
);

1231 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

1237 
»¥Ú£SŒ
,

1238 
fCu¼’tCSeq
,

1239 
	`d©eH—d”
(),

1240 
cÚ‹ÁL’
,

1241 
cÚ‹ÁSŒ
);

1242 
	}
}

1244 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


1245 ::
	$£tRTSPRe¥Ú£
(cÚ¡* 
»¥Ú£SŒ
, 
u_št32_t
 
£ssiÚId
, cÚ¡* 
cÚ‹ÁSŒ
) {

1246 ià(
cÚ‹ÁSŒ
 =ğ
NULL
) contentStr = "";

1247 cÚ¡ 
cÚ‹ÁL’
 = 
	`¡¾’
(
cÚ‹ÁSŒ
);

1249 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

1256 
»¥Ú£SŒ
,

1257 
fCu¼’tCSeq
,

1258 
	`d©eH—d”
(),

1259 
£ssiÚId
,

1260 
cÚ‹ÁL’
,

1261 
cÚ‹ÁSŒ
);

1262 
	}
}

1264 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ


1265 ::
	$chªgeCl›ÁIÅutSock‘
(
ÃwSock‘Num
, cÚ¡* 
exŒaD©a
, 
exŒaD©aSize
) {

1266 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fCl›ÁIÅutSock‘
);

1267 
fCl›ÁIÅutSock‘
 = 
ÃwSock‘Num
;

1268 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fCl›ÁIÅutSock‘
, 
SOCKET_READABLE
|
SOCKET_EXCEPTION
,

1269 
šcomšgReque¡HªdËr
, 
this
);

1272 ià(
exŒaD©aSize
 > 0 &&ƒxŒaD©aSiz<ğ
fReque¡BufãrBy‹sLeá
 ) {

1273 * 
±r
 = &
fReque¡Bufãr
[
fReque¡By‹sAÌ—dyS“n
];

1274 
i
 = 0; i < 
exŒaD©aSize
; ++i) {

1275 
±r
[
i
] = 
exŒaD©a
[i];

1277 
	`hªdËReque¡By‹s
(
exŒaD©aSize
);

1279 
	}
}

1281 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$cÚtšueHªdlšgREGISTER
(
P¬amsFÜREGISTER
* 
·¿ms
) {

1282 
·¿ms
->
fOurCÚÃùiÚ
->
	`cÚtšueHªdlšgREGISTER1
(params);

1283 
	}
}

1285 
	gRTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
	$cÚtšueHªdlšgREGISTER1
(
P¬amsFÜREGISTER
* 
·¿ms
) {

1287 
sock‘NumToBackEndS”v”
 = 
·¿ms
->
fReu£CÚÃùiÚ
 ? 
fCl›ÁOuutSock‘
 : -1;

1289 
RTSPS”v”
* 
ourS”v”
 = &
fOurRTSPS”v”
;

1291 ià(
sock‘NumToBackEndS”v”
 >= 0) {

1295 
fCl›ÁIÅutSock‘
 = 
fCl›ÁOuutSock‘
 = -1;

1296 
d–‘e
 
this
;

1299 
ourS”v”
->
	`im¶em’tCmd_REGISTER
(
·¿ms
->
fURL
,…¬ams->
fURLSuffix
, 
sock‘NumToBackEndS”v”
,

1300 
·¿ms
->
fD–iv”VŸTCP
,…¬ams->
fProxyURLSuffix
);

1301 
d–‘e
 
·¿ms
;

1302 
	}
}

1307 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


1308 ::
	$RTSPCl›ÁSessiÚ
(
RTSPS”v”
& 
ourS”v”
, 
u_št32_t
 
£ssiÚId
)

1309 : 
G’”icMedŸS”v”
::
	`Cl›ÁSessiÚ
(
ourS”v”
, 
£ssiÚId
),

1310 
	`fOurRTSPS”v”
(
ourS”v”
), 
	`fIsMuÉiÿ¡
(
F®£
), 
	`fSŒ—mAá”SETUP
(False),

1311 
	`fTCPSŒ—mIdCouÁ
(0), 
	`fNumSŒ—mS‹s
(0), 
	$fSŒ—mS‹s
(
NULL
) {

1312 
	}
}

1314 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ
::~
	$RTSPCl›ÁSessiÚ
() {

1315 
	`»şaimSŒ—mS‹s
();

1316 
	}
}

1318 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ
::
	$d–‘eSŒ—mByT¿ck
(
ŒackNum
) {

1319 ià(
ŒackNum
 >ğ
fNumSŒ—mS‹s
) ;

1320 ià(
fSŒ—mS‹s
[
ŒackNum
].
sub£ssiÚ
 !ğ
NULL
) {

1321 
fSŒ—mS‹s
[
ŒackNum
].
sub£ssiÚ
->
	`d–‘eSŒ—m
(
fOurSessiÚId
, fSŒ—mS‹s[ŒackNum].
¡»amTok’
);

1322 
fSŒ—mS‹s
[
ŒackNum
].
sub£ssiÚ
 = 
NULL
;

1326 
BoŞ—n
 
noSub£ssiÚsRemaš
 = 
True
;

1327 
i
 = 0; i < 
fNumSŒ—mS‹s
; ++i) {

1328 ià(
fSŒ—mS‹s
[
i
].
sub£ssiÚ
 !ğ
NULL
) {

1329 
noSub£ssiÚsRemaš
 = 
F®£
;

1333 ià(
noSub£ssiÚsRemaš
è
d–‘e
 
this
;

1334 
	}
}

1336 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ
::
	$»şaimSŒ—mS‹s
() {

1337 
i
 = 0; i < 
fNumSŒ—mS‹s
; ++i) {

1338 ià(
fSŒ—mS‹s
[
i
].
sub£ssiÚ
 !ğ
NULL
) {

1339 
fOurRTSPS”v”
.
	`uÂÙeTCPSŒ—mšgOnSock‘
(
fSŒ—mS‹s
[
i
].
tıSock‘Num
, 
this
, i);

1340 
fSŒ—mS‹s
[
i
].
sub£ssiÚ
->
	`d–‘eSŒ—m
(
fOurSessiÚId
, fSŒ—mS‹s[i].
¡»amTok’
);

1343 
d–‘e
[] 
fSŒ—mS‹s
; fSŒ—mS‹ ğ
NULL
;

1344 
fNumSŒ—mS‹s
 = 0;

1345 
	}
}

1347 
	eSŒ—mšgMode
 {

1348 
	mRTP_UDP
,

1349 
	mRTP_TCP
,

1350 
	mRAW_UDP


1351 } 
	tSŒ—mšgMode
;

1353 
	$·r£T¿n¥ÜtH—d”
(cÚ¡* 
buf
,

1354 
SŒ—mšgMode
& 
¡»amšgMode
,

1355 *& 
¡»amšgModeSŒšg
,

1356 *& 
de¡š©iÚAdd»ssSŒ
,

1357 
u_št8_t
& 
de¡š©iÚTTL
,

1358 
pÜtNumB™s
& 
ş›ÁRTPPÜtNum
,

1359 
pÜtNumB™s
& 
ş›ÁRTCPPÜtNum
,

1360 & 
¹pChªÃlId
,

1361 & 
¹ıChªÃlId


1364 
¡»amšgMode
 = 
RTP_UDP
;

1365 
¡»amšgModeSŒšg
 = 
NULL
;

1366 
de¡š©iÚAdd»ssSŒ
 = 
NULL
;

1367 
de¡š©iÚTTL
 = 255;

1368 
ş›ÁRTPPÜtNum
 = 0;

1369 
ş›ÁRTCPPÜtNum
 = 1;

1370 
¹pChªÃlId
 = 
¹ıChªÃlId
 = 0xFF;

1372 
pÜtNumB™s
 
p1
, 
p2
;

1373 
‰l
, 
¹pCid
, 
¹ıCid
;

1377 ià(*
buf
 == '\0') ;

1378 ià(*
buf
 == '\r' && *(buf+1) == '\n' && *(buf+2) == '\r') ;

1379 ià(
	`_¡ºÿ£cmp
(
buf
, "Transport:", 10) == 0) ;

1380 ++
buf
;

1384 cÚ¡* 
f›lds
 = 
buf
 + 10;

1385 *
f›lds
 == ' ') ++fields;

1386 * 
f›ld
 = 
	`¡rDupSize
(
f›lds
);

1387 
	`ssÿnf
(
f›lds
, "%[^;\r\n]", 
f›ld
) == 1) {

1388 ià(
	`¡rcmp
(
f›ld
, "RTP/AVP/TCP") == 0) {

1389 
¡»amšgMode
 = 
RTP_TCP
;

1390 } ià(
	`¡rcmp
(
f›ld
, "RAW/RAW/UDP") == 0 ||

1391 
	`¡rcmp
(
f›ld
, "MP2T/H2221/UDP") == 0) {

1392 
¡»amšgMode
 = 
RAW_UDP
;

1393 
¡»amšgModeSŒšg
 = 
	`¡rDup
(
f›ld
);

1394 } ià(
	`_¡ºÿ£cmp
(
f›ld
, "destination=", 12) == 0) {

1395 
d–‘e
[] 
de¡š©iÚAdd»ssSŒ
;

1396 
de¡š©iÚAdd»ssSŒ
 = 
	`¡rDup
(
f›ld
+12);

1397 } ià(
	`ssÿnf
(
f›ld
, "‰l%u", &
‰l
) == 1) {

1398 
de¡š©iÚTTL
 = (
u_št8_t
)
‰l
;

1399 } ià(
	`ssÿnf
(
f›ld
, "ş›Á_pÜt=%hu-%hu", &
p1
, &
p2
) == 2) {

1400 
ş›ÁRTPPÜtNum
 = 
p1
;

1401 
ş›ÁRTCPPÜtNum
 = 
¡»amšgMode
 =ğ
RAW_UDP
 ? 0 : 
p2
;

1402 } ià(
	`ssÿnf
(
f›ld
, "ş›Á_pÜt=%hu", &
p1
) == 1) {

1403 
ş›ÁRTPPÜtNum
 = 
p1
;

1404 
ş›ÁRTCPPÜtNum
 = 
¡»amšgMode
 =ğ
RAW_UDP
 ? 0 : 
p1
 + 1;

1405 } ià(
	`ssÿnf
(
f›ld
, "š‹¾—ved=%u-%u", &
¹pCid
, &
¹ıCid
) == 2) {

1406 
¹pChªÃlId
 = ()
¹pCid
;

1407 
¹ıChªÃlId
 = ()
¹ıCid
;

1410 
f›lds
 +ğ
	`¡¾’
(
f›ld
);

1411 *
f›lds
 == ';' || *fields == ' ' || *fields == '\t') ++fields;

1412 ià(*
f›lds
 == '\0' || *fields == '\r' || *fields == '\n') ;

1414 
d–‘e
[] 
f›ld
;

1415 
	}
}

1417 
BoŞ—n
 
	$·r£PÏyNowH—d”
(cÚ¡* 
buf
) {

1420 ià(*
buf
 =ğ'\0'è 
F®£
;

1421 ià(
	`_¡ºÿ£cmp
(
buf
, "x-playNow:", 10) == 0) ;

1422 ++
buf
;

1425  
True
;

1426 
	}
}

1428 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


1429 ::
hªdËCmd_SETUP
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

1430 cÚ¡* 
u¾P»Suffix
, cÚ¡* 
u¾Suffix
, cÚ¡* 
fuÎReque¡SŒ
) {

1436 cÚ¡* 
	g¡»amName
 = 
u¾P»Suffix
;

1437 cÚ¡* 
	gŒackId
 = 
u¾Suffix
;

1438 * 
	gcÚÿ‹Ç‹dSŒ—mName
 = 
NULL
;

1442 
S”v”MedŸSessiÚ
* 
	gsms


1443 ğ
fOurS”v”
.
lookupS”v”MedŸSessiÚ
(
¡»amName
, 
fOurS”v”MedŸSessiÚ
 =ğ
NULL
);

1444 ià(
	gsms
 =ğ
NULL
) {

1446 ià(
u¾P»Suffix
[0] == '\0') {

1447 
¡»amName
 = 
u¾Suffix
;

1449 
	gcÚÿ‹Ç‹dSŒ—mName
 = 
Ãw
 [
¡¾’
(
u¾P»Suffix
è+ sŒËn(
u¾Suffix
) + 2];

1450 
¥rštf
(
cÚÿ‹Ç‹dSŒ—mName
, "%s/%s", 
u¾P»Suffix
, 
u¾Suffix
);

1451 
	g¡»amName
 = 
cÚÿ‹Ç‹dSŒ—mName
;

1453 
	gŒackId
 = 
NULL
;

1456 
	gsms
 = 
fOurS”v”
.
lookupS”v”MedŸSessiÚ
(
¡»amName
, 
fOurS”v”MedŸSessiÚ
 =ğ
NULL
);

1458 ià(
	gsms
 =ğ
NULL
) {

1459 ià(
fOurS”v”MedŸSessiÚ
 =ğ
NULL
) {

1461 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_nÙFound
();

1464 
	gourCl›ÁCÚÃùiÚ
->
hªdËCmd_bad
();

1468 ià(
	gfOurS”v”MedŸSessiÚ
 =ğ
NULL
) {

1470 
fOurS”v”MedŸSessiÚ
 = 
sms
;

1471 
	gfOurS”v”MedŸSessiÚ
->
šüem’tReã»nûCouÁ
();

1472 } ià(
	gsms
 !ğ
fOurS”v”MedŸSessiÚ
) {

1474 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_bad
();

1479 ià(
	gfSŒ—mS‹s
 =ğ
NULL
) {

1481 
S”v”MedŸSub£ssiÚI‹¿tÜ
 
™”
(*
fOurS”v”MedŸSessiÚ
);

1482 
	gfNumSŒ—mS‹s
 = 0; 
	g™”
.
Ãxt
(è!ğ
NULL
; ++fNumStreamStates) {}

1484 
	gfSŒ—mS‹s
 = 
Ãw
 
¡»amS‹
[
fNumSŒ—mS‹s
];

1486 
	g™”
.
»£t
();

1487 
S”v”MedŸSub£ssiÚ
* 
	gsub£ssiÚ
;

1488 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

1489 
	gsub£ssiÚ
 = 
™”
.
Ãxt
();

1490 
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
 = 
sub£ssiÚ
;

1491 
	gfSŒ—mS‹s
[
i
].
	gtıSock‘Num
 = -1;

1492 
	gfSŒ—mS‹s
[
i
].
	g¡»amTok’
 = 
NULL
;

1497 
S”v”MedŸSub£ssiÚ
* 
	gsub£ssiÚ
 = 
NULL
;

1498 
	gŒackNum
;

1499 ià(
	gŒackId
 !ğ
NULL
 && 
ŒackId
[0] != '\0') {

1500 
ŒackNum
 = 0; 
	gŒackNum
 < 
	gfNumSŒ—mS‹s
; ++trackNum) {

1501 
	gsub£ssiÚ
 = 
fSŒ—mS‹s
[
ŒackNum
].
sub£ssiÚ
;

1502 ià(
	gsub£ssiÚ
 !ğ
NULL
 && 
¡rcmp
(
ŒackId
, 
sub£ssiÚ
->trackId()) == 0) ;

1504 ià(
	gŒackNum
 >ğ
fNumSŒ—mS‹s
) {

1506 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_nÙFound
();

1512 ià(
	gfNumSŒ—mS‹s
 !ğ1 || 
fSŒ—mS‹s
[0].
sub£ssiÚ
 =ğ
NULL
) {

1513 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_bad
();

1516 
	gŒackNum
 = 0;

1517 
	gsub£ssiÚ
 = 
fSŒ—mS‹s
[
ŒackNum
].
sub£ssiÚ
;

1521 *& 
	gtok’
 = 
fSŒ—mS‹s
[
ŒackNum
].
¡»amTok’
;

1522 ià(
	gtok’
 !ğ
NULL
) {

1525 
sub£ssiÚ
->
·u£SŒ—m
(
fOurSessiÚId
, 
tok’
);

1526 
	gfOurRTSPS”v”
.
uÂÙeTCPSŒ—mšgOnSock‘
(
fSŒ—mS‹s
[
ŒackNum
].
tıSock‘Num
, 
this
,rackNum);

1527 
	gsub£ssiÚ
->
d–‘eSŒ—m
(
fOurSessiÚId
, 
tok’
);

1531 
SŒ—mšgMode
 
	g¡»amšgMode
;

1532 * 
	g¡»amšgModeSŒšg
 = 
NULL
;

1533 * 
	gş›ÁsDe¡š©iÚAdd»ssSŒ
;

1534 
u_št8_t
 
	gş›ÁsDe¡š©iÚTTL
;

1535 
pÜtNumB™s
 
	gş›ÁRTPPÜtNum
, 
	gş›ÁRTCPPÜtNum
;

1536 
	g¹pChªÃlId
, 
	g¹ıChªÃlId
;

1537 
·r£T¿n¥ÜtH—d”
(
fuÎReque¡SŒ
, 
¡»amšgMode
, 
¡»amšgModeSŒšg
,

1538 
ş›ÁsDe¡š©iÚAdd»ssSŒ
, 
ş›ÁsDe¡š©iÚTTL
,

1539 
ş›ÁRTPPÜtNum
, 
ş›ÁRTCPPÜtNum
,

1540 
¹pChªÃlId
, 
¹ıChªÃlId
);

1541 ià((
	g¡»amšgMode
 =ğ
RTP_TCP
 && 
¹pChªÃlId
 == 0xFF) ||

1542 (
¡»amšgMode
 !ğ
RTP_TCP
 && 
ourCl›ÁCÚÃùiÚ
->
fCl›ÁOuutSock‘
 !ğourCl›ÁCÚÃùiÚ->
fCl›ÁIÅutSock‘
)) {

1547 
¡»amšgMode
 = 
RTP_TCP
;

1548 
	g¹pChªÃlId
 = 
fTCPSŒ—mIdCouÁ
; 
	g¹ıChªÃlId
 = fTCPStreamIdCount+1;

1550 ià(
	g¡»amšgMode
 =ğ
RTP_TCP
è
fTCPSŒ—mIdCouÁ
 += 2;

1552 
PÜt
 
ş›ÁRTPPÜt
(
ş›ÁRTPPÜtNum
);

1553 
PÜt
 
ş›ÁRTCPPÜt
(
ş›ÁRTCPPÜtNum
);

1557 
	g¿ngeS¹
 = 0.0, 
	g¿ngeEnd
 = 0.0;

1558 * 
	gabsS¹
 = 
NULL
; * 
	gabsEnd
 = NULL;

1559 
BoŞ—n
 
	g¡¬tTimeIsNow
;

1560 ià(
·r£RªgeH—d”
(
fuÎReque¡SŒ
, 
¿ngeS¹
, 
¿ngeEnd
, 
absS¹
, 
absEnd
, 
¡¬tTimeIsNow
)) {

1561 
	gd–‘e
[] 
	gabsS¹
; d–‘e[] 
	gabsEnd
;

1562 
	gfSŒ—mAá”SETUP
 = 
True
;

1563 } ià(
·r£PÏyNowH—d”
(
fuÎReque¡SŒ
)) {

1564 
	gfSŒ—mAá”SETUP
 = 
True
;

1566 
	gfSŒ—mAá”SETUP
 = 
F®£
;

1570 ià(
	g¡»amšgMode
 =ğ
RTP_TCP
) {

1572 
fSŒ—mS‹s
[
ŒackNum
].
tıSock‘Num
 = 
ourCl›ÁCÚÃùiÚ
->
fCl›ÁOuutSock‘
;

1573 
	gfOurRTSPS”v”
.
nÙeTCPSŒ—mšgOnSock‘
(
fSŒ—mS‹s
[
ŒackNum
].
tıSock‘Num
, 
this
,rackNum);

1575 
ÃtAdd»ssB™s
 
	gde¡š©iÚAdd»ss
 = 0;

1576 
u_št8_t
 
	gde¡š©iÚTTL
 = 255;

1577 #ifdeà
RTSP_ALLOW_CLIENT_DESTINATION_SETTING


1578 ià(
	gş›ÁsDe¡š©iÚAdd»ssSŒ
 !ğ
NULL
) {

1583 
de¡š©iÚAdd»ss
 = 
our_š‘_addr
(
ş›ÁsDe¡š©iÚAdd»ssSŒ
);

1586 
	gde¡š©iÚTTL
 = 
ş›ÁsDe¡š©iÚTTL
;

1588 
	gd–‘e
[] 
	gş›ÁsDe¡š©iÚAdd»ssSŒ
;

1589 
PÜt
 
£rv”RTPPÜt
(0);

1590 
PÜt
 
£rv”RTCPPÜt
(0);

1593 
sockaddr_š
 
	gsourûAddr
; 
SOCKLEN_T
 
	gÇm–’
 =  
sourûAddr
;

1594 
g‘sockÇme
(
ourCl›ÁCÚÃùiÚ
->
fCl›ÁIÅutSock‘
, (
sockaddr
*)&
sourûAddr
, &
Çm–’
);

1595 
ÃtAdd»ssB™s
 
	gÜigS’dšgIÁ”çûAddr
 = 
S’dšgIÁ”çûAddr
;

1596 
ÃtAdd»ssB™s
 
	gÜigReûivšgIÁ”çûAddr
 = 
ReûivšgIÁ”çûAddr
;

1598 #ifdeà
HACK_FOR_MULTIHOMED_SERVERS


1599 
	gReûivšgIÁ”çûAddr
 = 
S’dšgIÁ”çûAddr
 = 
sourûAddr
.
sš_addr
.
s_addr
;

1602 
	gsub£ssiÚ
->
g‘SŒ—mP¬am‘”s
(
fOurSessiÚId
, 
ourCl›ÁCÚÃùiÚ
->
fCl›ÁAddr
.
sš_addr
.
s_addr
,

1603 
ş›ÁRTPPÜt
, 
ş›ÁRTCPPÜt
,

1604 
fSŒ—mS‹s
[
ŒackNum
].
tıSock‘Num
, 
¹pChªÃlId
, 
¹ıChªÃlId
,

1605 
de¡š©iÚAdd»ss
, 
de¡š©iÚTTL
, 
fIsMuÉiÿ¡
,

1606 
£rv”RTPPÜt
, 
£rv”RTCPPÜt
,

1607 
fSŒ—mS‹s
[
ŒackNum
].
¡»amTok’
);

1608 
	gS’dšgIÁ”çûAddr
 = 
ÜigS’dšgIÁ”çûAddr
;

1609 
	gReûivšgIÁ”çûAddr
 = 
ÜigReûivšgIÁ”çûAddr
;

1611 
Add»ssSŒšg
 
de¡AddrSŒ
(
de¡š©iÚAdd»ss
);

1612 
Add»ssSŒšg
 
sourûAddrSŒ
(
sourûAddr
);

1613 
	gtimeoutP¬am‘”SŒšg
[100];

1614 ià(
	gfOurRTSPS”v”
.
	gfReşam©iÚSecÚds
 > 0) {

1615 
¥rštf
(
timeoutP¬am‘”SŒšg
, ";timeout=%u", 
fOurRTSPS”v”
.
fReşam©iÚSecÚds
);

1617 
	gtimeoutP¬am‘”SŒšg
[0] = '\0';

1619 ià(
	gfIsMuÉiÿ¡
) {

1620 
	g¡»amšgMode
) {

1621 
	gRTP_UDP
: {

1622 
¢´štf
((*)
ourCl›ÁCÚÃùiÚ
->
fRe¥Ú£Bufãr
,  ourClientConnection->fResponseBuffer,

1628 
ourCl›ÁCÚÃùiÚ
->
fCu¼’tCSeq
,

1629 
d©eH—d”
(),

1630 
de¡AddrSŒ
.
v®
(), 
sourûAddrSŒ
.v®(), 
Áohs
(
£rv”RTPPÜt
.
num
()),‚tohs(
£rv”RTCPPÜt
.num()), 
de¡š©iÚTTL
,

1631 
fOurSessiÚId
, 
timeoutP¬am‘”SŒšg
);

1634 
	gRTP_TCP
: {

1636 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_unsuµÜ‹dT¿n¥Üt
();

1639 
	gRAW_UDP
: {

1640 
¢´štf
((*)
ourCl›ÁCÚÃùiÚ
->
fRe¥Ú£Bufãr
,  ourClientConnection->fResponseBuffer,

1646 
ourCl›ÁCÚÃùiÚ
->
fCu¼’tCSeq
,

1647 
d©eH—d”
(),

1648 
¡»amšgModeSŒšg
, 
de¡AddrSŒ
.
v®
(), 
sourûAddrSŒ
.v®(), 
Áohs
(
£rv”RTPPÜt
.
num
()), 
de¡š©iÚTTL
,

1649 
fOurSessiÚId
, 
timeoutP¬am‘”SŒšg
);

1654 
	g¡»amšgMode
) {

1655 
	gRTP_UDP
: {

1656 
¢´štf
((*)
ourCl›ÁCÚÃùiÚ
->
fRe¥Ú£Bufãr
,  ourClientConnection->fResponseBuffer,

1662 
ourCl›ÁCÚÃùiÚ
->
fCu¼’tCSeq
,

1663 
d©eH—d”
(),

1664 
de¡AddrSŒ
.
v®
(), 
sourûAddrSŒ
.v®(), 
Áohs
(
ş›ÁRTPPÜt
.
num
()),‚tohs(
ş›ÁRTCPPÜt
.num()),‚tohs(
£rv”RTPPÜt
.num()),‚tohs(
£rv”RTCPPÜt
.num()),

1665 
fOurSessiÚId
, 
timeoutP¬am‘”SŒšg
);

1668 
	gRTP_TCP
: {

1669 ià(!
fOurRTSPS”v”
.
fAÎowSŒ—mšgRTPOv”TCP
) {

1670 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_unsuµÜ‹dT¿n¥Üt
();

1672 
¢´štf
((*)
ourCl›ÁCÚÃùiÚ
->
fRe¥Ú£Bufãr
,  ourClientConnection->fResponseBuffer,

1678 
ourCl›ÁCÚÃùiÚ
->
fCu¼’tCSeq
,

1679 
d©eH—d”
(),

1680 
de¡AddrSŒ
.
v®
(), 
sourûAddrSŒ
.v®(), 
¹pChªÃlId
, 
¹ıChªÃlId
,

1681 
fOurSessiÚId
, 
timeoutP¬am‘”SŒšg
);

1685 
	gRAW_UDP
: {

1686 
¢´štf
((*)
ourCl›ÁCÚÃùiÚ
->
fRe¥Ú£Bufãr
,  ourClientConnection->fResponseBuffer,

1692 
ourCl›ÁCÚÃùiÚ
->
fCu¼’tCSeq
,

1693 
d©eH—d”
(),

1694 
¡»amšgModeSŒšg
, 
de¡AddrSŒ
.
v®
(), 
sourûAddrSŒ
.v®(), 
Áohs
(
ş›ÁRTPPÜt
.
num
()),‚tohs(
£rv”RTPPÜt
.num()),

1695 
fOurSessiÚId
, 
timeoutP¬am‘”SŒšg
);

1700 
	gd–‘e
[] 
	g¡»amšgModeSŒšg
;

1703 
	gd–‘e
[] 
	gcÚÿ‹Ç‹dSŒ—mName
;

1706 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


1707 ::
hªdËCmd_w™hšSessiÚ
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

1708 cÚ¡* 
cmdName
,

1709 cÚ¡* 
u¾P»Suffix
, cÚ¡* 
u¾Suffix
,

1710 cÚ¡* 
fuÎReque¡SŒ
) {

1718 
S”v”MedŸSub£ssiÚ
* 
	gsub£ssiÚ
;

1720 ià(
	gfOurS”v”MedŸSessiÚ
 =ğ
NULL
) {

1721 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_nÙSuµÜ‹d
();

1723 } ià(
	gu¾Suffix
[0] !ğ'\0' && 
¡rcmp
(
fOurS”v”MedŸSessiÚ
->
¡»amName
(), 
u¾P»Suffix
) == 0) {

1726 
S”v”MedŸSub£ssiÚI‹¿tÜ
 
™”
(*
fOurS”v”MedŸSessiÚ
);

1727 (
	gsub£ssiÚ
 = 
™”
.
Ãxt
()è!ğ
NULL
) {

1728 ià(
¡rcmp
(
sub£ssiÚ
->
ŒackId
(), 
u¾Suffix
) == 0) ;

1730 ià(
	gsub£ssiÚ
 =ğ
NULL
) {

1731 
ourCl›ÁCÚÃùiÚ
->
hªdËCmd_nÙFound
();

1734 } ià(
¡rcmp
(
fOurS”v”MedŸSessiÚ
->
¡»amName
(), 
u¾Suffix
) == 0 ||

1735 (
u¾Suffix
[0] =ğ'\0' && 
¡rcmp
(
fOurS”v”MedŸSessiÚ
->
¡»amName
(), 
u¾P»Suffix
) == 0)) {

1737 
sub£ssiÚ
 = 
NULL
;

1738 } ià(
	gu¾P»Suffix
[0] !ğ'\0' && 
u¾Suffix
[0] != '\0') {

1740 cÚ¡ 
u¾P»SuffixL’
 = 
¡¾’
(
u¾P»Suffix
);

1741 ià(
¡ºcmp
(
fOurS”v”MedŸSessiÚ
->
¡»amName
(), 
u¾P»Suffix
, 
u¾P»SuffixL’
) == 0 &&

1742 
fOurS”v”MedŸSessiÚ
->
¡»amName
()[
u¾P»SuffixL’
] == '/' &&

1743 
¡rcmp
(&(
fOurS”v”MedŸSessiÚ
->
¡»amName
())[
u¾P»SuffixL’
+1], 
u¾Suffix
) == 0) {

1744 
sub£ssiÚ
 = 
NULL
;

1746 
	gourCl›ÁCÚÃùiÚ
->
hªdËCmd_nÙFound
();

1750 
	gourCl›ÁCÚÃùiÚ
->
hªdËCmd_nÙFound
();

1754 ià(
¡rcmp
(
cmdName
, "TEARDOWN") == 0) {

1755 
hªdËCmd_TEARDOWN
(
ourCl›ÁCÚÃùiÚ
, 
sub£ssiÚ
);

1756 } ià(
¡rcmp
(
cmdName
, "PLAY") == 0) {

1757 
hªdËCmd_PLAY
(
ourCl›ÁCÚÃùiÚ
, 
sub£ssiÚ
, 
fuÎReque¡SŒ
);

1758 } ià(
¡rcmp
(
cmdName
, "PAUSE") == 0) {

1759 
hªdËCmd_PAUSE
(
ourCl›ÁCÚÃùiÚ
, 
sub£ssiÚ
);

1760 } ià(
¡rcmp
(
cmdName
, "GET_PARAMETER") == 0) {

1761 
hªdËCmd_GET_PARAMETER
(
ourCl›ÁCÚÃùiÚ
, 
sub£ssiÚ
, 
fuÎReque¡SŒ
);

1762 } ià(
¡rcmp
(
cmdName
, "SET_PARAMETER") == 0) {

1763 
hªdËCmd_SET_PARAMETER
(
ourCl›ÁCÚÃùiÚ
, 
sub£ssiÚ
, 
fuÎReque¡SŒ
);

1767 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


1768 ::
hªdËCmd_TEARDOWN
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

1769 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
) {

1770 
	gi
;

1771 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

1772 ià(
	gsub£ssiÚ
 =ğ
NULL


1773 || 
sub£ssiÚ
 =ğ
fSŒ—mS‹s
[
i
].subsession) {

1774 ià(
fSŒ—mS‹s
[
i
].
sub£ssiÚ
 !ğ
NULL
) {

1775 
fOurRTSPS”v”
.
uÂÙeTCPSŒ—mšgOnSock‘
(
fSŒ—mS‹s
[
i
].
tıSock‘Num
, 
this
, i);

1776 
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
->
d–‘eSŒ—m
(
fOurSessiÚId
, 
fSŒ—mS‹s
[i].
¡»amTok’
);

1777 
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
 = 
NULL
;

1782 
£tRTSPRe¥Ú£
(
ourCl›ÁCÚÃùiÚ
, "200 OK");

1786 
BoŞ—n
 
	gnoSub£ssiÚsRemaš
 = 
True
;

1787 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

1788 ià(
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
 !ğ
NULL
) {

1789 
noSub£ssiÚsRemaš
 = 
F®£
;

1793 ià(
	gnoSub£ssiÚsRemaš
è
d–‘e
 
	gthis
;

1796 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


1797 ::
hªdËCmd_PLAY
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

1798 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
, cÚ¡* 
fuÎReque¡SŒ
) {

1799 * 
	g¹¥URL


1800 ğ
fOurRTSPS”v”
.
¹¥URL
(
fOurS”v”MedŸSessiÚ
, 
ourCl›ÁCÚÃùiÚ
->
fCl›ÁIÅutSock‘
);

1801 
	g¹¥URLSize
 = 
¡¾’
(
¹¥URL
);

1804 
	gsÿË
;

1805 
BoŞ—n
 
	g§wSÿËH—d”
 = 
·r£SÿËH—d”
(
fuÎReque¡SŒ
, 
sÿË
);

1808 ià(
	gsub£ssiÚ
 =ğ
NULL
 ) {

1809 
fOurS”v”MedŸSessiÚ
->
‹¡SÿËFaùÜ
(
sÿË
);

1811 
	gsub£ssiÚ
->
‹¡SÿËFaùÜ
(
sÿË
);

1814 
	gbuf
[100];

1815 * 
	gsÿËH—d”
;

1816 ià(!
	g§wSÿËH—d”
) {

1817 
	gbuf
[0] = '\0';

1819 
¥rštf
(
buf
, "SÿË: %f\r\n", 
sÿË
);

1821 
	gsÿËH—d”
 = 
¡rDup
(
buf
);

1824 
	gdu¿tiÚ
 = 0.0;

1825 
	g¿ngeS¹
 = 0.0, 
	g¿ngeEnd
 = 0.0;

1826 * 
	gabsS¹
 = 
NULL
; * 
	gabsEnd
 = NULL;

1827 
BoŞ—n
 
	g¡¬tTimeIsNow
;

1828 
BoŞ—n
 
	g§wRªgeH—d”


1829 ğ
·r£RªgeH—d”
(
fuÎReque¡SŒ
, 
¿ngeS¹
, 
¿ngeEnd
, 
absS¹
, 
absEnd
, 
¡¬tTimeIsNow
);

1831 ià(
	g§wRªgeH—d”
 && 
	gabsS¹
 =ğ
NULL
 ) {

1833 
du¿tiÚ
 = 
sub£ssiÚ
 =ğ
NULL


1834 ? 
fOurS”v”MedŸSessiÚ
->
du¿tiÚ
(è: 
sub£ssiÚ
->duration();

1835 ià(
	gdu¿tiÚ
 < 0.0) {

1838 
	gdu¿tiÚ
 = -
du¿tiÚ
;

1843 ià(
	g¿ngeS¹
 < 0.0)„angeStart = 0.0;

1844 ià(
	g¿ngeS¹
 > 
	gdu¿tiÚ
è¿ngeS¹ = 
du¿tiÚ
;

1845 ià(
	g¿ngeEnd
 < 0.0)„angeEnd = 0.0;

1846 ià(
	g¿ngeEnd
 > 
	gdu¿tiÚ
è¿ngeEnd = 
du¿tiÚ
;

1847 ià((
	gsÿË
 > 0.0 && 
	g¿ngeS¹
 > 
	g¿ngeEnd
 &&„angeEnd > 0.0) ||

1848 (
	gsÿË
 < 0.0 && 
	g¿ngeS¹
 < 
	g¿ngeEnd
)) {

1850 
	gtmp
 = 
¿ngeS¹
;

1851 
	g¿ngeS¹
 = 
¿ngeEnd
;

1852 
	g¿ngeEnd
 = 
tmp
;

1857 cÚ¡* 
	g¹pInfoFmt
 =

1864 
	g¹pInfoFmtSize
 = 
¡¾’
(
¹pInfoFmt
);

1865 * 
	g¹pInfo
 = 
¡rDup
("RTP-Info: ");

1866 
	gi
, 
	gnumRTPInfoI‹ms
 = 0;

1872 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

1873 ià(
	gsub£ssiÚ
 =ğ
NULL
 || 
fNumSŒ—mS‹s
 == 1) {

1874 ià(
fSŒ—mS‹s
[
i
].
sub£ssiÚ
 !ğ
NULL
) {

1875 ià(
§wSÿËH—d”
) {

1876 
fSŒ—mS‹s
[
i
].
sub£ssiÚ
->
£tSŒ—mSÿË
(
fOurSessiÚId
, fSŒ—mS‹s[i].
¡»amTok’
, 
sÿË
);

1878 ià(
	gabsS¹
 !ğ
NULL
) {

1881 
fSŒ—mS‹s
[
i
].
sub£ssiÚ
->
£ekSŒ—m
(
fOurSessiÚId
, fSŒ—mS‹s[i].
¡»amTok’
, 
absS¹
, 
absEnd
);

1885 
u_št64_t
 
	gnumBy‹s
;

1886 ià(!
	g§wRªgeH—d”
 || 
	g¡¬tTimeIsNow
) {

1889 
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
->
nuÎS“kSŒ—m
(
fOurSessiÚId
, 
fSŒ—mS‹s
[i].
¡»amTok’
,

1890 
¿ngeEnd
, 
numBy‹s
);

1893 
	g¡»amDu¿tiÚ
 = 0.0;

1894 ià(
	g¿ngeEnd
 > 0.0 && (¿ngeEnd+0.001è< 
	gdu¿tiÚ
) {

1897 
	g¡»amDu¿tiÚ
 = 
¿ngeEnd
 - 
¿ngeS¹
;

1898 ià(
	g¡»amDu¿tiÚ
 < 0.0è¡»amDu¿tiÚ = -
¡»amDu¿tiÚ
;

1901 
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
->
£ekSŒ—m
(
fOurSessiÚId
, 
fSŒ—mS‹s
[i].
¡»amTok’
,

1902 
¿ngeS¹
, 
¡»amDu¿tiÚ
, 
numBy‹s
);

1911 ià(
	gabsS¹
 !ğ
NULL
) {

1913 ià(
absEnd
 =ğ
NULL
) {

1914 
¥rštf
(
buf
, "Rªge: clock=%s-\r\n", 
absS¹
);

1916 
¥rštf
(
buf
, "Rªge: clock=%s-%s\r\n", 
absS¹
, 
absEnd
);

1918 
	gd–‘e
[] 
	gabsS¹
; d–‘e[] 
	gabsEnd
;

1921 ià(!
	g§wRªgeH—d”
 || 
	g¡¬tTimeIsNow
) {

1923 
	gcurNPT
 = 0.0;

1924 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

1925 ià(
	gsub£ssiÚ
 =ğ
NULL


1926 || 
sub£ssiÚ
 =ğ
fSŒ—mS‹s
[
i
].subsession) {

1927 ià(
fSŒ—mS‹s
[
i
].
sub£ssiÚ
 =ğ
NULL
) ;

1928 
	gÅt
 = 
fSŒ—mS‹s
[
i
].
sub£ssiÚ
->
g‘Cu¼’tNPT
(fSŒ—mS‹s[i].
¡»amTok’
);

1929 ià(
	gÅt
 > 
	gcurNPT
ècurNPT = 
Åt
;

1936 
	g¿ngeS¹
 = 
curNPT
;

1939 ià(
	g¿ngeEnd
 =ğ0.0 && 
sÿË
 >= 0.0) {

1940 
¥rštf
(
buf
, "Rªge:‚±=%.3f-\r\n", 
¿ngeS¹
);

1942 
¥rštf
(
buf
, "Rªge:‚±=%.3f-%.3f\r\n", 
¿ngeS¹
, 
¿ngeEnd
);

1945 * 
	g¿ngeH—d”
 = 
¡rDup
(
buf
);

1948 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

1949 ià(
	gsub£ssiÚ
 =ğ
NULL


1950 || 
sub£ssiÚ
 =ğ
fSŒ—mS‹s
[
i
].subsession) {

1951 
¹pSeqNum
 = 0;

1952 
	g¹pTime¡amp
 = 0;

1953 ià(
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
 =ğ
NULL
) ;

1954 
	gfSŒ—mS‹s
[
i
].
	gsub£ssiÚ
->
¡¬tSŒ—m
(
fOurSessiÚId
,

1955 
fSŒ—mS‹s
[
i
].
¡»amTok’
,

1956 (
TaskFunc
*)
nÙeCl›ÁLiv’ess
, 
this
,

1957 
¹pSeqNum
, 
¹pTime¡amp
,

1958 
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
::
hªdËAÉ”ÇtiveReque¡By‹
, 
ourCl›ÁCÚÃùiÚ
);

1959 cÚ¡ *
	gu¾Suffix
 = 
fSŒ—mS‹s
[
i
].
sub£ssiÚ
->
ŒackId
();

1960 * 
	g´evRTPInfo
 = 
¹pInfo
;

1961 
	g¹pInfoSize
 = 
¹pInfoFmtSize


1962 + 
¡¾’
(
´evRTPInfo
)

1964 + 
¹¥URLSize
 + 
¡¾’
(
u¾Suffix
)

1968 
	g¹pInfo
 = 
Ãw
 [
¹pInfoSize
];

1969 
¥rštf
(
¹pInfo
, 
¹pInfoFmt
,

1970 
´evRTPInfo
,

1971 
numRTPInfoI‹ms
++ == 0 ? "" : ",",

1972 
¹¥URL
, 
u¾Suffix
,

1973 
¹pSeqNum
,

1974 
¹pTime¡amp


1976 
	gd–‘e
[] 
	g´evRTPInfo
;

1979 ià(
	gnumRTPInfoI‹ms
 == 0) {

1980 
¹pInfo
[0] = '\0';

1982 
	g¹pInfoL’
 = 
¡¾’
(
¹pInfo
);

1983 
	g¹pInfo
[
¹pInfoL’
] = '\r';

1984 
	g¹pInfo
[
¹pInfoL’
+1] = '\n';

1985 
	g¹pInfo
[
¹pInfoL’
+2] = '\0';

1989 
¢´štf
((*)
ourCl›ÁCÚÃùiÚ
->
fRe¥Ú£Bufãr
,  ourClientConnection->fResponseBuffer,

1997 
ourCl›ÁCÚÃùiÚ
->
fCu¼’tCSeq
,

1998 
d©eH—d”
(),

1999 
sÿËH—d”
,

2000 
¿ngeH—d”
,

2001 
fOurSessiÚId
,

2002 
¹pInfo
);

2003 
	gd–‘e
[] 
	g¹pInfo
; d–‘e[] 
	g¿ngeH—d”
;

2004 
	gd–‘e
[] 
	gsÿËH—d”
; d–‘e[] 
	g¹¥URL
;

2007 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


2008 ::
hªdËCmd_PAUSE
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

2009 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
) {

2010 
	gi
 = 0; i < 
	gfNumSŒ—mS‹s
; ++i) {

2011 ià(
	gsub£ssiÚ
 =ğ
NULL


2012 || 
sub£ssiÚ
 =ğ
fSŒ—mS‹s
[
i
].subsession) {

2013 ià(
fSŒ—mS‹s
[
i
].
sub£ssiÚ
 !ğ
NULL
) {

2014 
fSŒ—mS‹s
[
i
].
sub£ssiÚ
->
·u£SŒ—m
(
fOurSessiÚId
, fSŒ—mS‹s[i].
¡»amTok’
);

2019 
£tRTSPRe¥Ú£
(
ourCl›ÁCÚÃùiÚ
, "200 OK", 
fOurSessiÚId
);

2022 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


2023 ::
hªdËCmd_GET_PARAMETER
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

2024 
S”v”MedŸSub£ssiÚ
* , const* ) {

2028 
£tRTSPRe¥Ú£
(
ourCl›ÁCÚÃùiÚ
, "200 OK", 
fOurSessiÚId
, 
LIVEMEDIA_LIBRARY_VERSION_STRING
);

2031 
	gRTSPS”v”
::
RTSPCl›ÁSessiÚ


2032 ::
hªdËCmd_SET_PARAMETER
(
RTSPS”v”
::
RTSPCl›ÁCÚÃùiÚ
* 
ourCl›ÁCÚÃùiÚ
,

2033 
S”v”MedŸSub£ssiÚ
* , const* ) {

2037 
£tRTSPRe¥Ú£
(
ourCl›ÁCÚÃùiÚ
, "200 OK", 
fOurSessiÚId
);

2040 
	gG’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
*

2041 
RTSPS”v”
::
	$ü—‹NewCl›ÁCÚÃùiÚ
(
ş›ÁSock‘
, 
sockaddr_š
 
ş›ÁAddr
) {

2042  
Ãw
 
	`RTSPCl›ÁCÚÃùiÚ
(*
this
, 
ş›ÁSock‘
, 
ş›ÁAddr
);

2043 
	}
}

2045 
	gG’”icMedŸS”v”
::
Cl›ÁSessiÚ
*

2046 
RTSPS”v”
::
	$ü—‹NewCl›ÁSessiÚ
(
u_št32_t
 
£ssiÚId
) {

2047  
Ãw
 
	`RTSPCl›ÁSessiÚ
(*
this
, 
£ssiÚId
);

2048 
	}
}

2053 
	gRTSPS”v”
::
S”v”MedŸSessiÚI‹¿tÜ


2054 ::
	$S”v”MedŸSessiÚI‹¿tÜ
(
RTSPS”v”
& 
£rv”
)

2055 : 
	`fOurI‹¿tÜ
((
£rv”
.
fS”v”MedŸSessiÚs
 =ğ
NULL
)

2056 ? 
NULL
 : 
HashTabË
::
I‹¿tÜ
::
	$ü—‹
(*
£rv”
.
fS”v”MedŸSessiÚs
)) {

2057 
	}
}

2059 
RTSPS”v”
::
S”v”MedŸSessiÚI‹¿tÜ
::~
	$S”v”MedŸSessiÚI‹¿tÜ
() {

2060 
d–‘e
 
fOurI‹¿tÜ
;

2061 
	}
}

2063 
S”v”MedŸSessiÚ
* 
	gRTSPS”v”
::
S”v”MedŸSessiÚI‹¿tÜ
::
	$Ãxt
() {

2064 ià(
fOurI‹¿tÜ
 =ğ
NULL
)  NULL;

2066 cÚ¡* 
key
;

2067  (
S”v”MedŸSessiÚ
*)(
fOurI‹¿tÜ
->
	`Ãxt
(
key
));

2068 
	}
}

2073 
	gU£rAuth’tiÿtiÚD©aba£
::
	$U£rAuth’tiÿtiÚD©aba£
(cÚ¡* 
»®m
,

2074 
BoŞ—n
 
·sswÜdsA»MD5
)

2075 : 
	`fTabË
(
HashTabË
::
	`ü—‹
(
STRING_HASH_KEYS
)),

2076 
	`fR—lm
(
	`¡rDup
(
»®m
 =ğ
NULL
 ? "LIVE555 Streaming Media" :„ealm)),

2077 
	$fPasswÜdsA»MD5
(
·sswÜdsA»MD5
) {

2078 
	}
}

2080 
	gU£rAuth’tiÿtiÚD©aba£
::~
	$U£rAuth’tiÿtiÚD©aba£
() {

2081 
d–‘e
[] 
fR—lm
;

2084 * 
·sswÜd
;

2085 (
·sswÜd
 = (*)
fTabË
->
	`RemoveNext
()è!ğ
NULL
) {

2086 
d–‘e
[] 
·sswÜd
;

2088 
d–‘e
 
fTabË
;

2089 
	}
}

2091 
	gU£rAuth’tiÿtiÚD©aba£
::
	$addU£rRecÜd
(cÚ¡* 
u£ºame
,

2092 cÚ¡* 
·sswÜd
) {

2093 
fTabË
->
	`Add
(
u£ºame
, (*)(
	`¡rDup
(
·sswÜd
)));

2094 
	}
}

2096 
	gU£rAuth’tiÿtiÚD©aba£
::
	$»moveU£rRecÜd
(cÚ¡* 
u£ºame
) {

2097 * 
·sswÜd
 = (*)(
fTabË
->
	`Lookup
(
u£ºame
));

2098 
fTabË
->
	`Remove
(
u£ºame
);

2099 
d–‘e
[] 
·sswÜd
;

2100 
	}
}

2102 cÚ¡* 
	gU£rAuth’tiÿtiÚD©aba£
::
	$lookupPasswÜd
(cÚ¡* 
u£ºame
) {

2103  (cÚ¡*)(
fTabË
->
	`Lookup
(
u£ºame
));

2104 
	}
}

2109 
RTSPS”v”W™hREGISTERProxyšg
* 
	gRTSPS”v”W™hREGISTERProxyšg


2110 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
ourPÜt
,

2111 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, U£rAuth’tiÿtiÚD©aba£* 
authD©aba£FÜREGISTER
,

2112 
»şam©iÚSecÚds
,

2113 
BoŞ—n
 
¡»amRTPOv”TCP
, 
v”bos™yLev–FÜProxyšg
) {

2114 
ourSock‘
 = 
	`£tUpOurSock‘
(
’v
, 
ourPÜt
);

2115 ià(
ourSock‘
 =ğ-1è 
NULL
;

2117  
Ãw
 
	`RTSPS”v”W™hREGISTERProxyšg
(
’v
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 
authD©aba£FÜREGISTER
, 
»şam©iÚSecÚds
,

2118 
¡»amRTPOv”TCP
, 
v”bos™yLev–FÜProxyšg
);

2119 
	}
}

2121 
	gRTSPS”v”W™hREGISTERProxyšg


2122 ::
	$RTSPS”v”W™hREGISTERProxyšg
(
U§geEnvœÚm’t
& 
’v
, 
ourSock‘
, 
PÜt
 
ourPÜt
,

2123 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, U£rAuth’tiÿtiÚD©aba£* 
authD©aba£FÜREGISTER
,

2124 
»şam©iÚSecÚds
,

2125 
BoŞ—n
 
¡»amRTPOv”TCP
, 
v”bos™yLev–FÜProxyšg
)

2126 : 
	`RTSPS”v”
(
’v
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 
»şam©iÚSecÚds
),

2127 
	`fSŒ—mRTPOv”TCP
(
¡»amRTPOv”TCP
), 
	`fV”bos™yLev–FÜProxyšg
(
v”bos™yLev–FÜProxyšg
),

2128 
	`fRegi¡”edProxyCouÁ”
(0), 
	`fAÎowedCommªdNames
(
NULL
), 
	$fAuthDBFÜREGISTER
(
authD©aba£FÜREGISTER
) {

2129 
	}
}

2131 
	gRTSPS”v”W™hREGISTERProxyšg
::~
	$RTSPS”v”W™hREGISTERProxyšg
() {

2132 
d–‘e
[] 
fAÎowedCommªdNames
;

2133 
	}
}

2135 cÚ¡* 
	gRTSPS”v”W™hREGISTERProxyšg
::
	$®lowedCommªdNames
() {

2136 ià(
fAÎowedCommªdNames
 =ğ
NULL
) {

2137 cÚ¡* 
ba£AÎowedCommªdNames
 = 
RTSPS”v”
::
	`®lowedCommªdNames
();

2138 cÚ¡* 
ÃwAÎowedCommªdName
 = ", REGISTER";

2139 
fAÎowedCommªdNames
 = 
Ãw
 [
	`¡¾’
(
ba£AÎowedCommªdNames
è+ sŒËn(
ÃwAÎowedCommªdName
) + 1 ];

2140 
	`¥rštf
(
fAÎowedCommªdNames
, "%s%s", 
ba£AÎowedCommªdNames
, 
ÃwAÎowedCommªdName
);

2142  
fAÎowedCommªdNames
;

2143 
	}
}

2145 
BoŞ—n
 
	gRTSPS”v”W™hREGISTERProxyšg
::
	$weIm¶em’tREGISTER
(cÚ¡* 
´oxyURLSuffix
, *& 
»¥Ú£SŒ
) {

2147 ià(
´oxyURLSuffix
 !ğ
NULL
 && 
	`lookupS”v”MedŸSessiÚ
(proxyURLSuffix) != NULL) {

2148 
»¥Ú£SŒ
 = 
	`¡rDup
("451 Invalid…arameter");

2149  
F®£
;

2153 
»¥Ú£SŒ
 = 
NULL
;

2154  
True
;

2155 
	}
}

2157 
	gRTSPS”v”W™hREGISTERProxyšg
::
	$im¶em’tCmd_REGISTER
(cÚ¡* 
u¾
, cÚ¡* , 
sock‘ToRemÙeS”v”
,

2158 
BoŞ—n
 
d–iv”VŸTCP
, cÚ¡* 
´oxyURLSuffix
) {

2168 cÚ¡* 
´oxySŒ—mName
;

2169 
´oxySŒ—mNameBuf
[100];

2170 ià(
´oxyURLSuffix
 =ğ
NULL
) {

2171 
	`¥rštf
(
´oxySŒ—mNameBuf
, "»gi¡”edProxySŒ—m-%u", ++
fRegi¡”edProxyCouÁ”
);

2172 
´oxySŒ—mName
 = 
´oxySŒ—mNameBuf
;

2174 
´oxySŒ—mName
 = 
´oxyURLSuffix
;

2177 ià(
fSŒ—mRTPOv”TCP
è
d–iv”VŸTCP
 = 
True
;

2178 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
 = 
d–iv”VŸTCP
 ? (portNumBits)(~0) : 0;

2181 
S”v”MedŸSessiÚ
* 
sms


2182 ğ
ProxyS”v”MedŸSessiÚ
::
	`ü—‹New
(
	`’vœ
(), 
this
, 
u¾
, 
´oxySŒ—mName
, 
NULL
, NULL,

2183 
tuÂ–Ov”HTTPPÜtNum
, 
fV”bos™yLev–FÜProxyšg
, 
sock‘ToRemÙeS”v”
);

2184 
	`addS”v”MedŸSessiÚ
(
sms
);

2187 * 
´oxySŒ—mURL
 = 
	`¹¥URL
(
sms
);

2188 
	`’vœ
(è<< "Proxyšgh»gi¡”ed back-’d sŒ—m \"" << 
u¾
 << "\".\n";

2189 
	`’vœ
(è<< "\tPÏyhi ¡»am usšghURL: " << 
´oxySŒ—mURL
 << "\n";

2190 
d–‘e
[] 
´oxySŒ—mURL
;

2191 
	}
}

2193 
U£rAuth’tiÿtiÚD©aba£
* 
	gRTSPS”v”W™hREGISTERProxyšg
::
	$g‘Auth’tiÿtiÚD©aba£FÜCommªd
(cÚ¡* 
cmdName
) {

2194 ià(
	`¡rcmp
(
cmdName
, "REGISTER"è=ğ0è 
fAuthDBFÜREGISTER
;

2196  
RTSPS”v”
::
	`g‘Auth’tiÿtiÚD©aba£FÜCommªd
(
cmdName
);

2197 
	}
}

	@liveMedia/RTSPServerSupportingHTTPStreaming.cpp

21 
	~"RTSPS”v”SuµÜtšgHTTPSŒ—mšg.hh
"

22 
	~"RTSPCommÚ.hh
"

23 #iâdeà
_WIN32_WCE


24 
	~<sys/¡©.h
>

26 
	~<time.h
>

28 
RTSPS”v”SuµÜtšgHTTPSŒ—mšg
*

29 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
¹¥PÜt
,

30 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, 
»şam©iÚTe¡SecÚds
) {

31 
ourSock‘
 = 
	`£tUpOurSock‘
(
’v
, 
¹¥PÜt
);

32 ià(
ourSock‘
 =ğ-1è 
NULL
;

34  
Ãw
 
	`RTSPS”v”SuµÜtšgHTTPSŒ—mšg
(
’v
, 
ourSock‘
, 
¹¥PÜt
, 
authD©aba£
, 
»şam©iÚTe¡SecÚds
);

35 
	}
}

37 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg


38 ::
	$RTSPS”v”SuµÜtšgHTTPSŒ—mšg
(
U§geEnvœÚm’t
& 
’v
, 
ourSock‘
, 
PÜt
 
¹¥PÜt
,

39 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, 
»şam©iÚTe¡SecÚds
)

40 : 
	$RTSPS”v”
(
’v
, 
ourSock‘
, 
¹¥PÜt
, 
authD©aba£
, 
»şam©iÚTe¡SecÚds
) {

41 
	}
}

43 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg
::~
	$RTSPS”v”SuµÜtšgHTTPSŒ—mšg
() {

44 
	}
}

46 
G’”icMedŸS”v”
::
Cl›ÁCÚÃùiÚ
*

47 
RTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
	$ü—‹NewCl›ÁCÚÃùiÚ
(
ş›ÁSock‘
, 
sockaddr_š
 
ş›ÁAddr
) {

48  
Ãw
 
	`RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
(*
this
, 
ş›ÁSock‘
, 
ş›ÁAddr
);

49 
	}
}

51 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg


52 ::
	$RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
(
RTSPS”v”
& 
ourS”v”
, 
ş›ÁSock‘
, 
sockaddr_š
 
ş›ÁAddr
)

53 : 
	`RTSPCl›ÁCÚÃùiÚ
(
ourS”v”
, 
ş›ÁSock‘
, 
ş›ÁAddr
),

54 
	`fCl›ÁSessiÚId
(0), 
	`fSŒ—mSourû
(
NULL
), 
	`fPÏyli¡Sourû
(NULL), 
	$fTCPSšk
(
NULL
) {

55 
	}
}

57 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
::~
	$RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
() {

58 
Medium
::
	`şo£
(
fPÏyli¡Sourû
);

59 
Medium
::
	`şo£
(
fSŒ—mSourû
);

60 
Medium
::
	`şo£
(
fTCPSšk
);

61 
	}
}

63 cÚ¡* 
	$Ï¡Modif›dH—d”
(cÚ¡* 
feName
) {

64 
buf
[200];

65 
buf
[0] = '\0';

67 #iâdeà
_WIN32_WCE


68 
¡©
 
sb
;

69 
¡©ResuÉ
 = 
	`¡©
(
feName
, &
sb
);

70 ià(
¡©ResuÉ
 == 0) {

71 
	`¡ráime
(
buf
,  buf, "La¡-Modif›d: %a, %b %d %Y %H:%M:%S GMT\r\n", 
	`gmtime
((cÚ¡ 
time_t
*)&
sb
.
¡_mtime
));

75  
buf
;

76 
	}
}

78 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg


79 ::
	$hªdËHTTPCmd_SŒ—mšgGET
(cÚ¡* 
u¾Suffix
, const* ) {

83 cÚ¡* 
que¡iÚM¬kPos
 = 
	`¡¼chr
(
u¾Suffix
, '?');

84 ià(
que¡iÚM¬kPos
 =ğ
NULL
) ;

85 
off£tInSecÚds
, 
du¿tiÚInSecÚds
;

86 ià(
	`ssÿnf
(
que¡iÚM¬kPos
, "?£gm’t=%u,%u", &
off£tInSecÚds
, &
du¿tiÚInSecÚds
) != 2) ;

88 * 
¡»amName
 = 
	`¡rDup
(
u¾Suffix
);

89 
¡»amName
[
que¡iÚM¬kPos
-
u¾Suffix
] = '\0';

92 
S”v”MedŸSessiÚ
* 
£ssiÚ
 = 
fOurS”v”
.
	`lookupS”v”MedŸSessiÚ
(
¡»amName
);

93 ià(
£ssiÚ
 =ğ
NULL
) {

94 
	`hªdËHTTPCmd_nÙFound
();

100 
S”v”MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

101 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
 = 
™”
.
	`Ãxt
();

102 ià(
sub£ssiÚ
 =ğ
NULL
) {

104 
	`hªdËHTTPCmd_nÙFound
();

110 ++
fCl›ÁSessiÚId
;

111 
PÜt
 
	`ş›ÁRTPPÜt
(0), 
	`ş›ÁRTCPPÜt
(0), 
	`£rv”RTPPÜt
(0), 
	`£rv”RTCPPÜt
(0);

112 
ÃtAdd»ssB™s
 
de¡š©iÚAdd»ss
 = 0;

113 
u_št8_t
 
de¡š©iÚTTL
 = 0;

114 
BoŞ—n
 
isMuÉiÿ¡
 = 
F®£
;

115 * 
¡»amTok’
;

116 
sub£ssiÚ
->
	`g‘SŒ—mP¬am‘”s
(
fCl›ÁSessiÚId
, 0, 
ş›ÁRTPPÜt
,
ş›ÁRTCPPÜt
, -1,0,0, 
de¡š©iÚAdd»ss
,
de¡š©iÚTTL
, 
isMuÉiÿ¡
, 
£rv”RTPPÜt
,
£rv”RTCPPÜt
, 
¡»amTok’
);

119 
dOff£tInSecÚds
 = ()
off£tInSecÚds
;

120 
u_št64_t
 
numBy‹s
;

121 
sub£ssiÚ
->
	`£ekSŒ—m
(
fCl›ÁSessiÚId
, 
¡»amTok’
, 
dOff£tInSecÚds
, ()
du¿tiÚInSecÚds
, 
numBy‹s
);

122 
numTSBy‹sToSŒ—m
 = ()
numBy‹s
;

124 ià(
numTSBy‹sToSŒ—m
 == 0) {

126 
	`hªdËHTTPCmd_nÙSuµÜ‹d
();

131 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

139 
	`d©eH—d”
(),

140 
LIVEMEDIA_LIBRARY_VERSION_STRING
,

141 
	`Ï¡Modif›dH—d”
(
¡»amName
),

142 
numTSBy‹sToSŒ—m
);

144 
	`£nd
(
fCl›ÁOuutSock‘
, (cÚ¡*)
fRe¥Ú£Bufãr
, 
	`¡¾’
((*)fResponseBuffer), 0);

145 
fRe¥Ú£Bufãr
[0] = '\0';

148 ià(
fSŒ—mSourû
 !ğ
NULL
) {

149 ià(
fTCPSšk
 !ğ
NULL
èfTCPSšk->
	`¡İPÏyšg
();

150 
Medium
::
	`şo£
(
fSŒ—mSourû
);

152 
fSŒ—mSourû
 = 
sub£ssiÚ
->
	`g‘SŒ—mSourû
(
¡»amTok’
);

153 ià(
fSŒ—mSourû
 !ğ
NULL
) {

154 ià(
fTCPSšk
 =ğ
NULL
èfTCPSšk = 
TCPSŒ—mSšk
::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁOuutSock‘
);

155 
fTCPSšk
->
	`¡¬tPÏyšg
(*
fSŒ—mSourû
, 
aá”SŒ—mšg
, 
this
);

159 
d–‘e
[] 
¡»amName
;

167 
S”v”MedŸSessiÚ
* 
£ssiÚ
 = 
fOurS”v”
.
	`lookupS”v”MedŸSessiÚ
(
u¾Suffix
);

168 ià(
£ssiÚ
 =ğ
NULL
) {

169 
	`hªdËHTTPCmd_nÙFound
();

174 
du¿tiÚ
 = 
£ssiÚ
->
	`du¿tiÚ
();

175 ià(
du¿tiÚ
 <= 0.0) {

177 
	`hªdËHTTPCmd_nÙSuµÜ‹d
();

182 cÚ¡ 
maxIÁL’
 = 10;

183 cÚ¡* cÚ¡ 
¶ayli¡P»fixFmt
 =

188 cÚ¡ 
¶ayli¡P»fixFmt_maxL’
 = 
	`¡¾’
(
¶ayli¡P»fixFmt
è+ 
maxIÁL’
;

190 cÚ¡* cÚ¡ 
¶ayli¡MedŸFeS³cFmt
 =

193 cÚ¡ 
¶ayli¡MedŸFeS³cFmt_maxL’
 = 
	`¡¾’
(
¶ayli¡MedŸFeS³cFmt
è+ 
maxIÁL’
 + sŒËn(
u¾Suffix
) + 2*maxIntLen;

195 cÚ¡* cÚ¡ 
¶ayli¡SuffixFmt
 =

197 cÚ¡ 
¶ayli¡SuffixFmt_maxL’
 = 
	`¡¾’
(
¶ayli¡SuffixFmt
);

200 cÚ¡ 
¶ayli¡MaxSize
 = 10000;

201 cÚ¡ 
medŸFeS³csMaxSize
 = 
¶ayli¡MaxSize
 - (
¶ayli¡P»fixFmt_maxL’
 + 
¶ayli¡SuffixFmt_maxL’
);

202 cÚ¡ 
maxNumMedŸFeS³cs
 = 
medŸFeS³csMaxSize
/
¶ayli¡MedŸFeS³cFmt_maxL’
;

204 
rg‘Du¿tiÚ
 = ()(
du¿tiÚ
/
maxNumMedŸFeS³cs
 + 1);

205 ià(
rg‘Du¿tiÚ
 < 10)argetDuration = 10;

207 * 
¶ayli¡
 = 
Ãw
 [
¶ayli¡MaxSize
];

208 * 
s
 = 
¶ayli¡
;

209 
	`¥rštf
(
s
, 
¶ayli¡P»fixFmt
, 
rg‘Du¿tiÚ
);

210 
s
 +ğ
	`¡¾’
(s);

212 
durSoF¬
 = 0;

214 
dur
 = 
rg‘Du¿tiÚ
 < 
du¿tiÚ
 ?argetDuration : ()duration;

215 
du¿tiÚ
 -ğ
dur
;

216 
	`¥rštf
(
s
, 
¶ayli¡MedŸFeS³cFmt
, 
dur
, 
u¾Suffix
, 
durSoF¬
, dur);

217 
s
 +ğ
	`¡¾’
(s);

218 ià(
du¿tiÚ
 < 1.0) ;

220 
durSoF¬
 +ğ
dur
;

223 
	`¥rštf
(
s
, 
¶ayli¡SuffixFmt
);

224 
s
 +ğ
	`¡¾’
(s);

225 
¶ayli¡L’
 = 
s
 - 
¶ayli¡
;

228 
	`¢´štf
((*)
fRe¥Ú£Bufãr
,  fResponseBuffer,

236 
	`d©eH—d”
(),

237 
LIVEMEDIA_LIBRARY_VERSION_STRING
,

238 
	`Ï¡Modif›dH—d”
(
u¾Suffix
),

239 
¶ayli¡L’
);

242 
	`£nd
(
fCl›ÁOuutSock‘
, (cÚ¡*)
fRe¥Ú£Bufãr
, 
	`¡¾’
((*)fResponseBuffer), 0);

243 
fRe¥Ú£Bufãr
[0] = '\0';

247 ià(
fPÏyli¡Sourû
 !ğ
NULL
) {

248 ià(
fTCPSšk
 !ğ
NULL
èfTCPSšk->
	`¡İPÏyšg
();

249 
Medium
::
	`şo£
(
fPÏyli¡Sourû
);

251 
fPÏyli¡Sourû
 = 
By‹SŒ—mMemÜyBufãrSourû
::
	`ü—‹New
(
	`’vœ
(), (
u_št8_t
*)
¶ayli¡
, 
¶ayli¡L’
);

252 ià(
fTCPSšk
 =ğ
NULL
èfTCPSšk = 
TCPSŒ—mSšk
::
	`ü—‹New
(
	`’vœ
(), 
fCl›ÁOuutSock‘
);

253 
fTCPSšk
->
	`¡¬tPÏyšg
(*
fPÏyli¡Sourû
, 
aá”SŒ—mšg
, 
this
);

254 
	}
}

256 
	gRTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
::
	$aá”SŒ—mšg
(* 
ş›ÁD©a
) {

257 
RTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
* 
ş›ÁCÚÃùiÚ


258 ğ(
RTSPS”v”SuµÜtšgHTTPSŒ—mšg
::
RTSPCl›ÁCÚÃùiÚSuµÜtšgHTTPSŒ—mšg
*)
ş›ÁD©a
;

260 ià(
ş›ÁCÚÃùiÚ
->
fRecursiÚCouÁ
 > 0) {

262 
ş›ÁCÚÃùiÚ
->
fIsAùive
 = 
F®£
;

265 
d–‘e
 
ş›ÁCÚÃùiÚ
;

267 
	}
}

	@liveMedia/SIPClient.cpp

21 
	~"SIPCl›Á.hh
"

22 
	~"GroupsockH–³r.hh
"

24 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_QNX4
)

25 
	#_¡ºÿ£cmp
 
_¡ºicmp


	)

27 
	#_¡ºÿ£cmp
 
¡ºÿ£cmp


	)

32 
SIPCl›Á
* 
	gSIPCl›Á


33 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

34 
desœedAudioRTPPaylßdFÜm©
,

35 cÚ¡* 
mimeSubty³
,

36 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
) {

37  
Ãw
 
	`SIPCl›Á
(
’v
, 
desœedAudioRTPPaylßdFÜm©
, 
mimeSubty³
,

38 
v”bos™yLev–
, 
­¶iÿtiÚName
);

39 
	}
}

41 
	gSIPCl›Á
::
	$£tU£rAg’tSŒšg
(cÚ¡* 
u£rAg’tName
) {

42 ià(
u£rAg’tName
 =ğ
NULL
) ;

45 cÚ¡* cÚ¡ 
fÜm©SŒ
 = "User-Agent: %s\r\n";

46 cÚ¡ 
h—d”Size
 = 
	`¡¾’
(
fÜm©SŒ
è+ sŒËn(
u£rAg’tName
);

47 
d–‘e
[] 
fU£rAg’tH—d”SŒ
;

48 
fU£rAg’tH—d”SŒ
 = 
Ãw
 [
h—d”Size
];

49 
	`¥rštf
(
fU£rAg’tH—d”SŒ
, 
fÜm©SŒ
, 
u£rAg’tName
);

50 
fU£rAg’tH—d”SŒL’
 = 
	`¡¾’
(
fU£rAg’tH—d”SŒ
);

51 
	}
}

53 
	gSIPCl›Á
::
	$SIPCl›Á
(
U§geEnvœÚm’t
& 
’v
,

54 
desœedAudioRTPPaylßdFÜm©
,

55 cÚ¡* 
mimeSubty³
,

56 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
)

57 : 
	`Medium
(
’v
),

58 
	`fT1
(500000 ),

59 
	`fDesœedAudioRTPPaylßdFÜm©
(
desœedAudioRTPPaylßdFÜm©
),

60 
	`fV”bos™yLev–
(
v”bos™yLev–
), 
	`fCSeq
(0),

61 
	`fU£rAg’tH—d”SŒ
(
NULL
), 
	`fU£rAg’tH—d”SŒL’
(0),

62 
	`fURL
(
NULL
), 
	`fURLSize
(0),

63 
	`fToTagSŒ
(
NULL
), 
	`fToTagSŒSize
(0),

64 
	`fU£rName
(
NULL
), 
	`fU£rNameSize
(0),

65 
	`fInv™eSDPDesütiÚ
(
NULL
), 
	`fInv™eSDPDesütiÚR‘uºed
(NULL),

66 
	`fInv™eCmd
(
NULL
), 
	$fInv™eCmdSize
(0) {

67 ià(
mimeSubty³
 =ğ
NULL
) mimeSubtype = "";

68 
fMIMESubty³
 = 
	`¡rDup
(
mimeSubty³
);

69 
fMIMESubty³Size
 = 
	`¡¾’
(
fMIMESubty³
);

71 ià(
­¶iÿtiÚName
 =ğ
NULL
)‡pplicationName = "";

72 
fAµliÿtiÚName
 = 
	`¡rDup
(
­¶iÿtiÚName
);

73 
fAµliÿtiÚNameSize
 = 
	`¡¾’
(
fAµliÿtiÚName
);

75 
š_addr
 
ourAdd»ss
;

76 
ourAdd»ss
.
s_addr
 = 
	`ourIPAdd»ss
(
’v
);

77 
fOurAdd»ssSŒ
 = 
	`¡rDup
(
	`Add»ssSŒšg
(
ourAdd»ss
).
	`v®
());

78 
fOurAdd»ssSŒSize
 = 
	`¡¾’
(
fOurAdd»ssSŒ
);

80 
fOurSock‘
 = 
Ãw
 
	`Groupsock
(
’v
, 
ourAdd»ss
, 0, 255);

81 ià(
fOurSock‘
 =ğ
NULL
) {

82 
’v
 << "ERROR: Failedo create socket for‡ddr "

83 << 
fOurAdd»ssSŒ
 << ": "

84 << 
’v
.
	`g‘ResuÉMsg
() << "\n";

89 
fOurSock‘
->
	`ouut
(
	`’vœ
(), (*)"", 0);

90 
PÜt
 
	`¤cPÜt
(0);

91 
	`g‘SourûPÜt
(
’v
, 
fOurSock‘
->
	`sock‘Num
(), 
¤cPÜt
);

92 ià(
¤cPÜt
.
	`num
() != 0) {

93 
fOurPÜtNum
 = 
	`Áohs
(
¤cPÜt
.
	`num
());

96 
fOurPÜtNum
 = 5060;

97 
d–‘e
 
fOurSock‘
;

98 
fOurSock‘
 = 
Ãw
 
	`Groupsock
(
’v
, 
ourAdd»ss
, 
fOurPÜtNum
, 255);

99 ià(
fOurSock‘
 =ğ
NULL
) {

100 
’v
 << "ERROR: Failedo create socket for‡ddr "

101 << 
fOurAdd»ssSŒ
 << ",…ort "

102 << 
fOurPÜtNum
 << ": "

103 << 
’v
.
	`g‘ResuÉMsg
() << "\n";

108 cÚ¡* cÚ¡ 
libName
 = "LIVE555 Streaming Media v";

109 cÚ¡* cÚ¡ 
libV”siÚSŒ
 = 
LIVEMEDIA_LIBRARY_VERSION_STRING
;

110 cÚ¡* 
libP»fix
; cÚ¡* 
libSuffix
;

111 ià(
­¶iÿtiÚName
 =ğ
NULL
 ||‡pplicationName[0] == '\0') {

112 
­¶iÿtiÚName
 = 
libP»fix
 = 
libSuffix
 = "";

114 
libP»fix
 = " (";

115 
libSuffix
 = ")";

117 
u£rAg’tNameSize


118 ğ
fAµliÿtiÚNameSize
 + 
	`¡¾’
(
libP»fix
è+ sŒËn(
libName
è+ sŒËn(
libV”siÚSŒ
è+ sŒËn(
libSuffix
) + 1;

119 * 
u£rAg’tName
 = 
Ãw
 [
u£rAg’tNameSize
];

120 
	`¥rštf
(
u£rAg’tName
, "%s%s%s%s%s",

121 
­¶iÿtiÚName
, 
libP»fix
, 
libName
, 
libV”siÚSŒ
, 
libSuffix
);

122 
	`£tU£rAg’tSŒšg
(
u£rAg’tName
);

123 
d–‘e
[] 
u£rAg’tName
;

125 
	`»£t
();

126 
	}
}

128 
	gSIPCl›Á
::~
	$SIPCl›Á
() {

129 
	`»£t
();

131 
d–‘e
[] 
fU£rAg’tH—d”SŒ
;

132 
d–‘e
 
fOurSock‘
;

133 
d–‘e
[] (*)
fOurAdd»ssSŒ
;

134 
d–‘e
[] (*)
fAµliÿtiÚName
;

135 
d–‘e
[] (*)
fMIMESubty³
;

136 
	}
}

138 
	gSIPCl›Á
::
	$»£t
() {

139 
fWÜkšgAuth’tiÿtÜ
 = 
NULL
;

140 
d–‘e
[] 
fInv™eCmd
; fInv™eCmd = 
NULL
; 
fInv™eCmdSize
 = 0;

141 
d–‘e
[] 
fInv™eSDPDesütiÚ
; fInv™eSDPDesütiÚ = 
NULL
;

143 
d–‘e
[] (*)
fU£rName
; fU£rNamğ
	`¡rDup
(
fAµliÿtiÚName
);

144 
fU£rNameSize
 = 
	`¡¾’
(
fU£rName
);

146 
fV®idAuth’tiÿtÜ
.
	`»£t
();

148 
d–‘e
[] (*)
fToTagSŒ
; fToTagSŒ = 
NULL
; 
fToTagSŒSize
 = 0;

149 
fS”v”PÜtNum
 = 0;

150 
fS”v”Add»ss
.
s_addr
 = 0;

151 
d–‘e
[] (*)
fURL
; fURL = 
NULL
; 
fURLSize
 = 0;

152 
	}
}

154 
	gSIPCl›Á
::
	$£tProxyS”v”
(
´oxyS”v”Add»ss
,

155 
pÜtNumB™s
 
´oxyS”v”PÜtNum
) {

156 
fS”v”Add»ss
.
s_addr
 = 
´oxyS”v”Add»ss
;

157 
fS”v”PÜtNum
 = 
´oxyS”v”PÜtNum
;

158 ià(
fOurSock‘
 !ğ
NULL
) {

159 
fOurSock‘
->
	`chªgeDe¡š©iÚP¬am‘”s
(
fS”v”Add»ss
,

160 
fS”v”PÜtNum
, 255);

162 
	}
}

164 * 
	$g‘Lše
(* 
¡¬tOfLše
) {

166 * 
±r
 = 
¡¬tOfLše
; *ptr != '\0'; ++ptr) {

167 ià(*
±r
 == '\r' || *ptr == '\n') {

169 *
±r
++ = '\0';

170 ià(*
±r
 == '\n') ++ptr;

171  
±r
;

175  
NULL
;

176 
	}
}

178 * 
	gSIPCl›Á
::
	$šv™e
(cÚ¡* 
u¾
, 
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

180 * 
u£ºame
; * 
·sswÜd
;

181 ià(
auth’tiÿtÜ
 =ğ
NULL


182 && 
	`·r£SIPURLU£ºamePasswÜd
(
u¾
, 
u£ºame
, 
·sswÜd
)) {

183 * 
»suÉ
 = 
	`šv™eW™hPasswÜd
(
u¾
, 
u£ºame
, 
·sswÜd
);

184 
d–‘e
[] 
u£ºame
; d–‘e[] 
·sswÜd
;

185  
»suÉ
;

188 ià(!
	`´oûssURL
(
u¾
)è 
NULL
;

190 
d–‘e
[] (*)
fURL
; fURL = 
	`¡rDup
(
u¾
);

191 
fURLSize
 = 
	`¡¾’
(
fURL
);

193 
fC®lId
 = 
	`our_¿ndom32
();

194 
fFromTag
 = 
	`our_¿ndom32
();

196  
	`šv™e1
(
auth’tiÿtÜ
);

197 
	}
}

199 * 
	gSIPCl›Á
::
	$šv™e1
(
Auth’tiÿtÜ
* 
auth’tiÿtÜ
) {

204 
fV®idAuth’tiÿtÜ
.
	`»£t
();

205 
fWÜkšgAuth’tiÿtÜ
 = 
auth’tiÿtÜ
;

206 * 
auth’tiÿtÜSŒ


207 ğ
	`ü—‹Auth’tiÿtÜSŒšg
(
fWÜkšgAuth’tiÿtÜ
, "INVITE", 
fURL
);

210 * 
¹pm­Lše
;

211 
¹pm­LšeSize
;

212 ià(
fMIMESubty³Size
 > 0) {

213 cÚ¡* cÚ¡ 
¹pm­Fmt
 =

215 
¹pm­FmtSize
 = 
	`¡¾’
(
¹pm­Fmt
)

216 + 3 + 
fMIMESubty³Size
;

217 
¹pm­Lše
 = 
Ãw
 [
¹pm­FmtSize
];

218 
	`¥rštf
(
¹pm­Lše
, 
¹pm­Fmt
,

219 
fDesœedAudioRTPPaylßdFÜm©
, 
fMIMESubty³
);

220 
¹pm­LšeSize
 = 
	`¡¾’
(
¹pm­Lše
);

223 
¹pm­Lše
 = 
	`¡rDup
("");

224 
¹pm­LšeSize
 = 0;

226 cÚ¡* cÚ¡ 
šv™eSDPFmt
 =

234 
šv™eSDPFmtSize
 = 
	`¡¾’
(
šv™eSDPFmt
)

235 + 20 + 20 + 
fOurAdd»ssSŒSize


236 + 
fAµliÿtiÚNameSize


237 + 
fOurAdd»ssSŒSize


239 + 
¹pm­LšeSize
;

240 
d–‘e
[] 
fInv™eSDPDesütiÚ
;

241 
fInv™eSDPDesütiÚ
 = 
Ãw
 [
šv™eSDPFmtSize
];

242 
	`¥rštf
(
fInv™eSDPDesütiÚ
, 
šv™eSDPFmt
,

243 
fC®lId
, 
fCSeq
, 
fOurAdd»ssSŒ
,

244 
fAµliÿtiÚName
,

245 
fOurAdd»ssSŒ
,

246 
fCl›ÁS¹PÜtNum
, 
fDesœedAudioRTPPaylßdFÜm©
,

247 
¹pm­Lše
);

248 
šv™eSDPSize
 = 
	`¡¾’
(
fInv™eSDPDesütiÚ
);

249 
d–‘e
[] 
¹pm­Lše
;

251 cÚ¡* cÚ¡ 
cmdFmt
 =

265 
šv™eCmdSize
 = 
	`¡¾’
(
cmdFmt
)

266 + 
fURLSize


267 + 2*
fU£rNameSize
 + 
fOurAdd»ssSŒSize
 + 20

268 + 
fOurAdd»ssSŒSize
 + 5

269 + 
fURLSize


270 + 
fU£rNameSize
 + 
fOurAdd»ssSŒSize
 + 5

271 + 20 + 
fOurAdd»ssSŒSize


273 + 
	`¡¾’
(
auth’tiÿtÜSŒ
)

274 + 
fU£rAg’tH—d”SŒL’


276 + 
šv™eSDPSize
;

277 
d–‘e
[] 
fInv™eCmd
; fInv™eCmd = 
Ãw
 [
šv™eCmdSize
];

278 
	`¥rštf
(
fInv™eCmd
, 
cmdFmt
,

279 
fURL
,

280 
fU£rName
, fU£rName, 
fOurAdd»ssSŒ
, 
fFromTag
,

281 
fOurAdd»ssSŒ
, 
fOurPÜtNum
,

282 
fURL
,

283 
fU£rName
, 
fOurAdd»ssSŒ
, 
fOurPÜtNum
,

284 
fC®lId
, 
fOurAdd»ssSŒ
,

285 ++
fCSeq
,

286 
auth’tiÿtÜSŒ
,

287 
fU£rAg’tH—d”SŒ
,

288 
šv™eSDPSize
,

289 
fInv™eSDPDesütiÚ
);

290 
fInv™eCmdSize
 = 
	`¡¾’
(
fInv™eCmd
);

291 
d–‘e
[] 
auth’tiÿtÜSŒ
;

295 
fInv™eCl›ÁS‹
 = 
C®lšg
;

296 
fEv’tLoİStİFÏg
 = 0;

297 
TaskScheduËr
& 
sched
 = 
	`’vœ
().
	`skScheduËr
();

298 
sched
.
	`tuºOnBackgroundR—dHªdlšg
(
fOurSock‘
->
	`sock‘Num
(),

299 &
šv™eRe¥Ú£HªdËr
, 
this
);

300 
fTim”AL’
 = 1*
fT1
;

301 
fTim”ACouÁ
 = 0;

302 
fTim”A
 = 
sched
.
	`scheduËD–ayedTask
(
fTim”AL’
, 
tim”AHªdËr
, 
this
);

303 
fTim”B
 = 
sched
.
	`scheduËD–ayedTask
(64*
fT1
, 
tim”BHªdËr
, 
this
);

304 
fTim”D
 = 
NULL
;

306 ià(!
	`£ndINVITE
()) ;

309 
	`’vœ
().
	`skScheduËr
().
	`doEv’tLoİ
(&
fEv’tLoİStİFÏg
);

313 
sched
.
	`tuºOffBackgroundR—dHªdlšg
(
fOurSock‘
->
	`sock‘Num
());

314 
sched
.
	`unscheduËD–ayedTask
(
fTim”A
);

315 
sched
.
	`unscheduËD–ayedTask
(
fTim”B
);

316 
sched
.
	`unscheduËD–ayedTask
(
fTim”D
);

321 ià(
fInv™eSDPDesütiÚ
 !ğ
NULL
) {

322  
	`¡rDup
(
fInv™eSDPDesütiÚ
);

326  
NULL
;

327 
	}
}

329 
	gSIPCl›Á
::
	$šv™eRe¥Ú£HªdËr
(* 
ş›ÁD©a
, ) {

330 
SIPCl›Á
* 
ş›Á
 = (SIPCl›Á*)
ş›ÁD©a
;

331 
»¥Ú£Code
 = 
ş›Á
->
	`g‘Re¥Ú£Code
();

332 
ş›Á
->
	`doInv™eS‹Machše
(
»¥Ú£Code
);

333 
	}
}

336 cÚ¡ 
	gtim”AFœes
 = 0xAAAAAAAA;

337 cÚ¡ 
	gtim”BFœes
 = 0xBBBBBBBB;

338 cÚ¡ 
	gtim”DFœes
 = 0xDDDDDDDD;

340 
	gSIPCl›Á
::
	$tim”AHªdËr
(* 
ş›ÁD©a
) {

341 
SIPCl›Á
* 
ş›Á
 = (SIPCl›Á*)
ş›ÁD©a
;

342 ià(
ş›Á
->
fV”bos™yLev–
 >= 1) {

343 
ş›Á
->
	`’vœ
(è<< "RETRANSMISSION " << ++ş›Á->
fTim”ACouÁ


344 << ",‡á” " << 
ş›Á
->
fTim”AL’
/1000000.0

347 
ş›Á
->
	`doInv™eS‹Machše
(
tim”AFœes
);

348 
	}
}

350 
	gSIPCl›Á
::
	$tim”BHªdËr
(* 
ş›ÁD©a
) {

351 
SIPCl›Á
* 
ş›Á
 = (SIPCl›Á*)
ş›ÁD©a
;

352 ià(
ş›Á
->
fV”bos™yLev–
 >= 1) {

353 
ş›Á
->
	`’vœ
() << "RETRANSMISSION TIMEOUT,‡fter "

354 << 64*
ş›Á
->
fT1
/1000000.0 << " seconds\n";

355 
	`fæush
(
¡d”r
);

357 
ş›Á
->
	`doInv™eS‹Machše
(
tim”BFœes
);

358 
	}
}

360 
	gSIPCl›Á
::
	$tim”DHªdËr
(* 
ş›ÁD©a
) {

361 
SIPCl›Á
* 
ş›Á
 = (SIPCl›Á*)
ş›ÁD©a
;

362 ià(
ş›Á
->
fV”bos™yLev–
 >= 1) {

363 
ş›Á
->
	`’vœ
() << "TIMER D EXPIRED\n";

365 
ş›Á
->
	`doInv™eS‹Machše
(
tim”DFœes
);

366 
	}
}

368 
	gSIPCl›Á
::
	$doInv™eS‹Machše
(
»¥Ú£Code
) {

370 
TaskScheduËr
& 
sched
 = 
	`’vœ
().
	`skScheduËr
();

371 
fInv™eCl›ÁS‹
) {

372 
C®lšg
: {

373 ià(
»¥Ú£Code
 =ğ
tim”AFœes
) {

375 
fTim”AL’
 *= 2;

376 
fTim”A


377 ğ
sched
.
	`scheduËD–ayedTask
(
fTim”AL’
, 
tim”AHªdËr
, 
this
);

379 
fInv™eCl›ÁS‹
 = 
C®lšg
;

380 ià(!
	`£ndINVITE
()è
	`doInv™eS‹T”mš©ed
(0);

383 
sched
.
	`unscheduËD–ayedTask
(
fTim”A
);

384 
sched
.
	`unscheduËD–ayedTask
(
fTim”B
);

386 ià(
»¥Ú£Code
 =ğ
tim”BFœes
) {

387 
	`’vœ
().
	`£tResuÉMsg
("No„esponse from server");

388 
	`doInv™eS‹T”mš©ed
(0);

389 } ià(
»¥Ú£Code
 >= 100 &&„esponseCode <= 199) {

390 
fInv™eCl›ÁS‹
 = 
Proûedšg
;

391 } ià(
»¥Ú£Code
 >= 200 &&„esponseCode <= 299) {

392 
	`doInv™eS‹T”mš©ed
(
»¥Ú£Code
);

393 } ià(
»¥Ú£Code
 >= 400 &&„esponseCode <= 499) {

394 
	`doInv™eS‹T”mš©ed
(
»¥Ú£Code
);

396 } ià(
»¥Ú£Code
 >= 300 &&„esponseCode <= 699) {

397 
fInv™eCl›ÁS‹
 = 
Com¶‘ed
;

398 
fTim”D


399 ğ
sched
.
	`scheduËD–ayedTask
(32000000, 
tim”DHªdËr
, 
this
);

400 ià(!
	`£ndACK
()è
	`doInv™eS‹T”mš©ed
(0);

406 
Proûedšg
: {

407 ià(
»¥Ú£Code
 >= 100 &&„esponseCode <= 199) {

408 
fInv™eCl›ÁS‹
 = 
Proûedšg
;

409 } ià(
»¥Ú£Code
 >= 200 &&„esponseCode <= 299) {

410 
	`doInv™eS‹T”mš©ed
(
»¥Ú£Code
);

411 } ià(
»¥Ú£Code
 >= 400 &&„esponseCode <= 499) {

412 
	`doInv™eS‹T”mš©ed
(
»¥Ú£Code
);

414 } ià(
»¥Ú£Code
 >= 300 &&„esponseCode <= 699) {

415 
fInv™eCl›ÁS‹
 = 
Com¶‘ed
;

416 
fTim”D
 = 
sched
.
	`scheduËD–ayedTask
(32000000, 
tim”DHªdËr
, 
this
);

417 ià(!
	`£ndACK
()è
	`doInv™eS‹T”mš©ed
(0);

422 
Com¶‘ed
: {

423 ià(
»¥Ú£Code
 =ğ
tim”DFœes
) {

424 
	`’vœ
().
	`£tResuÉMsg
("Transactionerminated");

425 
	`doInv™eS‹T”mš©ed
(0);

426 } ià(
»¥Ú£Code
 >= 300 &&„esponseCode <= 699) {

427 
fInv™eCl›ÁS‹
 = 
Com¶‘ed
;

428 ià(!
	`£ndACK
()è
	`doInv™eS‹T”mš©ed
(0);

433 
T”mš©ed
: {

434 
	`doInv™eS‹T”mš©ed
(
»¥Ú£Code
);

438 
	}
}

440 
	gSIPCl›Á
::
	$doInv™eS‹T”mš©ed
(
»¥Ú£Code
) {

441 
fInv™eCl›ÁS‹
 = 
T”mš©ed
;

442 ià(
»¥Ú£Code
 < 200 ||„esponseCode > 299) {

444 
d–‘e
[] 
fInv™eSDPDesütiÚ
; fInv™eSDPDesütiÚ = 
NULL
;

445 
d–‘e
[] 
fInv™eSDPDesütiÚR‘uºed
; fInv™eSDPDesütiÚR‘uºed = 
NULL
;

449 
fEv’tLoİStİFÏg
 = ~0;

450 
	}
}

452 
BoŞ—n
 
	gSIPCl›Á
::
	$£ndINVITE
() {

453 ià(!
	`£ndReque¡
(
fInv™eCmd
, 
fInv™eCmdSize
)) {

454 
	`’vœ
().
	`£tResuÉE¼Msg
("INVITE send() failed: ");

455  
F®£
;

457  
True
;

458 
	}
}

460 
	gSIPCl›Á
::
	$g‘Re¥Ú£Code
() {

461 
»¥Ú£Code
 = 0;

464 cÚ¡ 
»adBufSize
 = 10000;

465 
»adBufãr
[
»adBufSize
+1]; * 
»adBuf
 =„eadBuffer;

467 * 
fœ¡Lše
 = 
NULL
;

468 * 
ÃxtLšeS¹
 = 
NULL
;

469 
by‹sR—d
 = 
	`g‘Re¥Ú£
(
»adBuf
, 
»adBufSize
);

470 ià(
by‹sR—d
 == 0) ;

471 ià(
fV”bos™yLev–
 >= 1) {

472 
	`’vœ
(è<< "Reûived INVITE„e¥Ú£: " << 
»adBuf
 << "\n";

476 
fœ¡Lše
 = 
»adBuf
;

477 
ÃxtLšeS¹
 = 
	`g‘Lše
(
fœ¡Lše
);

478 ià(!
	`·r£Re¥Ú£Code
(
fœ¡Lše
, 
»¥Ú£Code
)) ;

480 ià(
»¥Ú£Code
 != 200) {

481 ià(
»¥Ú£Code
 >= 400 &&„esponseCode <= 499

482 && 
fWÜkšgAuth’tiÿtÜ
 !ğ
NULL
) {

488 * 
lšeS¹
;

490 
lšeS¹
 = 
ÃxtLšeS¹
;

491 ià(
lšeS¹
 =ğ
NULL
) ;

493 
ÃxtLšeS¹
 = 
	`g‘Lše
(
lšeS¹
);

494 ià(
lšeS¹
[0] == '\0') ;

496 * 
»®m
 = 
	`¡rDupSize
(
lšeS¹
);

497 * 
nÚû
 = 
	`¡rDupSize
(
lšeS¹
);

501 
BoŞ—n
 
foundAuth’tiÿ‹H—d”
 = 
F®£
;

504 
	`ssÿnf
(
lšeS¹
, "Proxy-Authenticate: Digest„ealm=\"%[^\"]\",‚once=\"%[^\"]\"",

505 
»®m
, 
nÚû
) == 2 ||

507 
	`ssÿnf
(
lšeS¹
, "Proxy-Authenticate: Digest‡lgorithm=MD5,domain=\"%*[^\"]\",nonce=\"%[^\"]\",„ealm=\"%[^\"]\"",

508 
nÚû
, 
»®m
) == 2) {

509 
fWÜkšgAuth’tiÿtÜ
->
	`£tR—lmAndNÚû
(
»®m
, 
nÚû
);

510 
foundAuth’tiÿ‹H—d”
 = 
True
;

512 
d–‘e
[] 
»®m
; d–‘e[] 
nÚû
;

513 ià(
foundAuth’tiÿ‹H—d”
) ;

516 
	`’vœ
().
	`£tResuÉMsg
("ÿÂÙ hªdË INVITE„e¥Ú£: ", 
fœ¡Lše
);

525 
cÚ‹ÁL’gth
 = -1;

526 * 
lšeS¹
;

528 
lšeS¹
 = 
ÃxtLšeS¹
;

529 ià(
lšeS¹
 =ğ
NULL
) ;

531 
ÃxtLšeS¹
 = 
	`g‘Lše
(
lšeS¹
);

532 ià(
lšeS¹
[0] == '\0') ;

534 * 
toTagSŒ
 = 
	`¡rDupSize
(
lšeS¹
);

535 ià(
	`ssÿnf
(
lšeS¹
, "To:%*[^;];ag=%s", 
toTagSŒ
) == 1) {

536 
d–‘e
[] (*)
fToTagSŒ
; fToTagSŒ = 
	`¡rDup
(
toTagSŒ
);

537 
fToTagSŒSize
 = 
	`¡¾’
(
fToTagSŒ
);

539 
d–‘e
[] 
toTagSŒ
;

541 ià(
	`ssÿnf
(
lšeS¹
, "CÚ‹Á-L’gth: %d", &
cÚ‹ÁL’gth
) == 1

542 || 
	`ssÿnf
(
lšeS¹
, "CÚ‹Á-Ëngth: %d", &
cÚ‹ÁL’gth
) == 1) {

543 ià(
cÚ‹ÁL’gth
 < 0) {

544 
	`’vœ
().
	`£tResuÉMsg
("Bad \"Content-Length:\" header: \"",

545 
lšeS¹
, "\"");

552 ià(
lšeS¹
 =ğ
NULL
) {

553 
	`’vœ
().
	`£tResuÉMsg
("nØcÚ‹Á fŞlowšg h—d”†šes: ", 
»adBuf
);

560 * 
bodyS¹
 = 
ÃxtLšeS¹
;

561 ià(
bodyS¹
 !ğ
NULL
 && 
cÚ‹ÁL’gth
 >= 0) {

563 
numBodyBy‹s
 = &
»adBuf
[
by‹sR—d
] - 
bodyS¹
;

564 ià(
cÚ‹ÁL’gth
 > ()
numBodyBy‹s
) {

567 
numExŒaBy‹sN“ded
 = 
cÚ‹ÁL’gth
 - 
numBodyBy‹s
;

568 #ifdeà
USING_TCP


570 
»maššgBufãrSize


571 ğ
»adBufSize
 - (
by‹sR—d
 + (
»adBuf
 - 
»adBufãr
));

572 ià(
numExŒaBy‹sN“ded
 > 
»maššgBufãrSize
) {

573 
tmpBuf
[200];

574 
	`¥rštf
(
tmpBuf
, "Read buffer size (%d) isoo small for \"Content-Length:\" %d (need‡ buffer size of >= %d bytes\n",

575 
»adBufSize
, 
cÚ‹ÁL’gth
,

576 
»adBufSize
 + 
numExŒaBy‹sN“ded
 - 
»maššgBufãrSize
);

577 
	`’vœ
().
	`£tResuÉMsg
(
tmpBuf
);

582 ià(
fV”bos™yLev–
 >= 1) {

583 
	`’vœ
(è<< "N“dØ»ad " << 
numExŒaBy‹sN“ded


586 
numExŒaBy‹sN“ded
 > 0) {

587 * 
±r
 = &
»adBuf
[
by‹sR—d
];

588 
by‹sR—d2
;

589 
sockaddr_š
 
äomAddr
;

590 
BoŞ—n
 
»adSucûss


591 ğ
fOurSock‘
->
	`hªdËR—d
((*)
±r
,

592 
numExŒaBy‹sN“ded
,

593 
by‹sR—d2
, 
äomAddr
);

594 ià(!
»adSucûss
) ;

595 
±r
[
by‹sR—d2
] = '\0';

596 ià(
fV”bos™yLev–
 >= 1) {

597 
	`’vœ
(è<< "R—d " << 
by‹sR—d2


598 << "ƒxŒ¨by‹s: " << 
±r
 << "\n";

601 
by‹sR—d
 +ğ
by‹sR—d2
;

602 
numExŒaBy‹sN“ded
 -ğ
by‹sR—d2
;

605 ià(
numExŒaBy‹sN“ded
 > 0) ;

608 
bodyS¹
[
cÚ‹ÁL’gth
] = '\0';

609 
d–‘e
[] 
fInv™eSDPDesütiÚR‘uºed
; fInv™eSDPDesütiÚR‘uºed = 
	`¡rDup
(
bodyS¹
);

613  
»¥Ú£Code
;

614 
	}
}

616 * 
	gSIPCl›Á
::
	$šv™eW™hPasswÜd
(cÚ¡* 
u¾
, cÚ¡* 
u£ºame
,

617 cÚ¡* 
·sswÜd
) {

618 
d–‘e
[] (*)
fU£rName
; fU£rNamğ
	`¡rDup
(
u£ºame
);

619 
fU£rNameSize
 = 
	`¡¾’
(
fU£rName
);

621 
Auth’tiÿtÜ
 
	`auth’tiÿtÜ
(
u£ºame
, 
·sswÜd
);

622 * 
šv™eResuÉ
 = 
	`šv™e
(
u¾
, &
auth’tiÿtÜ
);

623 ià(
šv™eResuÉ
 !ğ
NULL
) {

625  
šv™eResuÉ
;

629 ià(
auth’tiÿtÜ
.
	`»®m
(è=ğ
NULL
 ||‡uth’tiÿtÜ.
	`nÚû
() == NULL) {

631  
NULL
;

635 
šv™eResuÉ
 = 
	`šv™e1
(&
auth’tiÿtÜ
);

636 ià(
šv™eResuÉ
 !ğ
NULL
) {

638 
fV®idAuth’tiÿtÜ
 = 
auth’tiÿtÜ
;

641  
šv™eResuÉ
;

642 
	}
}

644 
BoŞ—n
 
	gSIPCl›Á
::
	$£ndACK
() {

645 * 
cmd
 = 
NULL
;

647 cÚ¡* cÚ¡ 
cmdFmt
 =

656 
cmdSize
 = 
	`¡¾’
(
cmdFmt
)

657 + 
fURLSize


658 + 2*
fU£rNameSize
 + 
fOurAdd»ssSŒSize
 + 20

659 + 
fOurAdd»ssSŒSize
 + 5

660 + 
fURLSize
 + 
fToTagSŒSize


661 + 20 + 
fOurAdd»ssSŒSize


663 
cmd
 = 
Ãw
 [
cmdSize
];

664 
	`¥rštf
(
cmd
, 
cmdFmt
,

665 
fURL
,

666 
fU£rName
, fU£rName, 
fOurAdd»ssSŒ
, 
fFromTag
,

667 
fOurAdd»ssSŒ
, 
fOurPÜtNum
,

668 
fURL
, 
fToTagSŒ
,

669 
fC®lId
, 
fOurAdd»ssSŒ
,

670 
fCSeq
 );

672 ià(!
	`£ndReque¡
(
cmd
, 
	`¡¾’
(cmd))) {

673 
	`’vœ
().
	`£tResuÉE¼Msg
("ACK send() failed: ");

677 
d–‘e
[] 
cmd
;

678  
True
;

681 
d–‘e
[] 
cmd
;

682  
F®£
;

683 
	}
}

685 
BoŞ—n
 
	gSIPCl›Á
::
	$£ndBYE
() {

687 * 
cmd
 = 
NULL
;

689 cÚ¡* cÚ¡ 
cmdFmt
 =

698 
cmdSize
 = 
	`¡¾’
(
cmdFmt
)

699 + 
fURLSize


700 + 2*
fU£rNameSize
 + 
fOurAdd»ssSŒSize
 + 20

701 + 
fOurAdd»ssSŒSize
 + 5

702 + 
fURLSize
 + 
fToTagSŒSize


703 + 20 + 
fOurAdd»ssSŒSize


705 
cmd
 = 
Ãw
 [
cmdSize
];

706 
	`¥rštf
(
cmd
, 
cmdFmt
,

707 
fURL
,

708 
fU£rName
, fU£rName, 
fOurAdd»ssSŒ
, 
fFromTag
,

709 
fOurAdd»ssSŒ
, 
fOurPÜtNum
,

710 
fURL
, 
fToTagSŒ
,

711 
fC®lId
, 
fOurAdd»ssSŒ
,

712 ++
fCSeq
);

714 ià(!
	`£ndReque¡
(
cmd
, 
	`¡¾’
(cmd))) {

715 
	`’vœ
().
	`£tResuÉE¼Msg
("BYE send() failed: ");

719 
d–‘e
[] 
cmd
;

720  
True
;

723 
d–‘e
[] 
cmd
;

724  
F®£
;

725 
	}
}

727 
BoŞ—n
 
	gSIPCl›Á
::
	$´oûssURL
(cÚ¡* 
u¾
) {

731 ià(
fS”v”Add»ss
.
s_addr
 == 0) {

732 
N‘Add»ss
 
de¡Add»ss
;

733 ià(!
	`·r£SIPURL
(
	`’vœ
(), 
u¾
, 
de¡Add»ss
, 
fS”v”PÜtNum
)) ;

734 
fS”v”Add»ss
.
s_addr
 = *(*)(
de¡Add»ss
.
	`d©a
());

736 ià(
fOurSock‘
 !ğ
NULL
) {

737 
fOurSock‘
->
	`chªgeDe¡š©iÚP¬am‘”s
(
fS”v”Add»ss
,

738 
fS”v”PÜtNum
, 255);

742  
True
;

745  
F®£
;

746 
	}
}

748 
BoŞ—n
 
	gSIPCl›Á
::
	$·r£SIPURL
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
u¾
,

749 
N‘Add»ss
& 
add»ss
,

750 
pÜtNumB™s
& 
pÜtNum
) {

755 cÚ¡* 
´efix
 = "sip:";

756 cÚ¡ 
´efixL’gth
 = 4;

757 ià(
	`_¡ºÿ£cmp
(
u¾
, 
´efix
, 
´efixL’gth
) != 0) {

758 
’v
.
	`£tResuÉMsg
("URL i nÙ oàthfÜm \"", 
´efix
, "\"");

762 cÚ¡ 
·r£BufãrSize
 = 100;

763 
·r£Bufãr
[
·r£BufãrSize
];

764 
add»ssS¹Index
 = 
´efixL’gth
;

765 
u¾
[
add»ssS¹Index
] != '\0'

766 && 
u¾
[
add»ssS¹Index
++] != '@') {}

767 cÚ¡* 
äom
 = &
u¾
[
add»ssS¹Index
];

770 cÚ¡* 
äom1
 = 
äom
;

771 *
äom1
 != '\0' && *from1 != '/') {

772 ià(*
äom1
 == '@') {

773 
äom
 = ++
äom1
;

776 ++
äom1
;

779 * 
to
 = &
·r£Bufãr
[0];

780 
i
;

781 
i
 = 0; i < 
·r£BufãrSize
; ++i) {

782 ià(*
äom
 == '\0' || *from == ':' || *from == '/') {

784 *
to
 = '\0';

787 *
to
++ = *
äom
++;

789 ià(
i
 =ğ
·r£BufãrSize
) {

790 
’v
.
	`£tResuÉMsg
("URL isoo†ong");

794 
N‘Add»ssLi¡
 
	`add»s£s
(
·r£Bufãr
);

795 ià(
add»s£s
.
	`numAdd»s£s
() == 0) {

796 
’v
.
	`£tResuÉMsg
("Failedo find‚etwork‡ddress for \"",

797 
·r£Bufãr
, "\"");

800 
add»ss
 = *(
add»s£s
.
	`fœ¡Add»ss
());

802 
pÜtNum
 = 5060;

803 
ÃxtCh¬
 = *
äom
;

804 ià(
ÃxtCh¬
 == ':') {

805 
pÜtNumIÁ
;

806 ià(
	`ssÿnf
(++
äom
, "%d", &
pÜtNumIÁ
) != 1) {

807 
’v
.
	`£tResuÉMsg
("No…ort‚umber follows ':'");

810 ià(
pÜtNumIÁ
 < 1 ||…ortNumInt > 65535) {

811 
’v
.
	`£tResuÉMsg
("Bad…ort‚umber");

814 
pÜtNum
 = (
pÜtNumB™s
)
pÜtNumIÁ
;

817  
True
;

820  
F®£
;

821 
	}
}

823 
BoŞ—n
 
	gSIPCl›Á
::
	$·r£SIPURLU£ºamePasswÜd
(cÚ¡* 
u¾
,

824 *& 
u£ºame
,

825 *& 
·sswÜd
) {

826 
u£ºame
 = 
·sswÜd
 = 
NULL
;

829 cÚ¡* 
´efix
 = "sip:";

830 cÚ¡ 
´efixL’gth
 = 4;

831 ià(
	`_¡ºÿ£cmp
(
u¾
, 
´efix
, 
´efixL’gth
) != 0) ;

834 
u£ºameIndex
 = 
´efixL’gth
;

835 
cŞÚIndex
 = 0, 
©Index
 = 0;

836 
i
 = 
u£ºameIndex
; 
u¾
[i] != '\0' && url[i] != '/'; ++i) {

837 ià(
u¾
[
i
] =ğ':' && 
cŞÚIndex
 == 0) {

838 
cŞÚIndex
 = 
i
;

839 } ià(
u¾
[
i
] == '@') {

840 
©Index
 = 
i
;

844 ià(
©Index
 == 0) ;

846 * 
u¾Cİy
 = 
	`¡rDup
(
u¾
);

847 
u¾Cİy
[
©Index
] = '\0';

848 ià(
cŞÚIndex
 > 0) {

849 
u¾Cİy
[
cŞÚIndex
] = '\0';

850 
·sswÜd
 = 
	`¡rDup
(&
u¾Cİy
[
cŞÚIndex
+1]);

852 
·sswÜd
 = 
	`¡rDup
("");

854 
u£ºame
 = 
	`¡rDup
(&
u¾Cİy
[
u£ºameIndex
]);

855 
d–‘e
[] 
u¾Cİy
;

857  
True
;

860  
F®£
;

861 
	}
}

864 
	gSIPCl›Á
::
	$ü—‹Auth’tiÿtÜSŒšg
(
Auth’tiÿtÜ
 cÚ¡* 
auth’tiÿtÜ
,

865 cÚ¡* 
cmd
, cÚ¡* 
u¾
) {

866 ià(
auth’tiÿtÜ
 !ğ
NULL
 &&‡uth’tiÿtÜ->
	`»®m
() != NULL

867 && 
auth’tiÿtÜ
->
	`nÚû
(è!ğ
NULL
 &&‡uth’tiÿtÜ->
	`u£ºame
() != NULL

868 && 
auth’tiÿtÜ
->
	`·sswÜd
(è!ğ
NULL
) {

870 cÚ¡* cÚ¡ 
authFmt


872 cÚ¡* 
»¥Ú£
 = 
auth’tiÿtÜ
->
	`compu‹Dige¡Re¥Ú£
(
cmd
, 
u¾
);

873 
authBufSize
 = 
	`¡¾’
(
authFmt
)

874 + 
	`¡¾’
(
auth’tiÿtÜ
->
	`u£ºame
()è+ sŒËn×uth’tiÿtÜ->
	`»®m
())

875 + 
	`¡¾’
(
auth’tiÿtÜ
->
	`nÚû
()è+ sŒËn(
u¾
è+ sŒËn(
»¥Ú£
);

876 * 
auth’tiÿtÜSŒ
 = 
Ãw
 [
authBufSize
];

877 
	`¥rštf
(
auth’tiÿtÜSŒ
, 
authFmt
,

878 
auth’tiÿtÜ
->
	`u£ºame
(),‡uth’tiÿtÜ->
	`»®m
(),

879 
auth’tiÿtÜ
->
	`nÚû
(), 
»¥Ú£
, 
u¾
);

880 
auth’tiÿtÜ
->
	`»şaimDige¡Re¥Ú£
(
»¥Ú£
);

882  
auth’tiÿtÜSŒ
;

885  
	`¡rDup
("");

886 
	}
}

888 
BoŞ—n
 
	gSIPCl›Á
::
	$£ndReque¡
(cÚ¡* 
»que¡SŒšg
,

889 
»que¡L’gth
) {

890 ià(
fV”bos™yLev–
 >= 1) {

891 
	`’vœ
(è<< "S’dšg„eque¡: " << 
»que¡SŒšg
 << "\n";

895  
fOurSock‘
->
	`ouut
(
	`’vœ
(), (*)
»que¡SŒšg
, 
»que¡L’gth
);

896 
	}
}

898 
	gSIPCl›Á
::
	$g‘Re¥Ú£
(*& 
»¥Ú£Bufãr
,

899 
»¥Ú£BufãrSize
) {

900 ià(
»¥Ú£BufãrSize
 == 0)  0;

901 
»¥Ú£Bufãr
[0] = '\0';

906 * 
p
 = 
»¥Ú£Bufãr
;

907 
BoŞ—n
 
haveS“nNÚCRLF
 = 
F®£
;

908 
by‹sR—d
 = 0;

909 
by‹sR—d
 < ()
»¥Ú£BufãrSize
) {

910 
by‹sR—dNow
;

911 
sockaddr_š
 
äomAddr
;

912 * 
toPo¢
 = (*)(
»¥Ú£Bufãr
+
by‹sR—d
);

913 
BoŞ—n
 
»adSucûss


914 ğ
fOurSock‘
->
	`hªdËR—d
(
toPo¢
, 
»¥Ú£BufãrSize
-
by‹sR—d
,

915 
by‹sR—dNow
, 
äomAddr
);

916 ià(!
»adSucûss
 || 
by‹sR—dNow
 == 0) {

917 
	`’vœ
().
	`£tResuÉMsg
("SIP„esponse wasruncated");

920 
by‹sR—d
 +ğ
by‹sR—dNow
;

923 * 
Ï¡ToCheck
 = 
»¥Ú£Bufãr
+
by‹sR—d
-4;

924 ià(
Ï¡ToCheck
 < 
»¥Ú£Bufãr
) ;

925 ; 
p
 <ğ
Ï¡ToCheck
; ++p) {

926 ià(
haveS“nNÚCRLF
) {

927 ià(*
p
 == '\r' && *(p+1) == '\n' &&

928 *(
p
+2) == '\r' && *(p+3) == '\n') {

929 
»¥Ú£Bufãr
[
by‹sR—d
] = '\0';

932 *
»¥Ú£Bufãr
 == '\r' || *responseBuffer == '\n') {

933 ++
»¥Ú£Bufãr
;

934 --
by‹sR—d
;

936  
by‹sR—d
;

939 ià(*
p
 != '\r' && *p != '\n') {

940 
haveS“nNÚCRLF
 = 
True
;

947 
	}
}

949 
BoŞ—n
 
	gSIPCl›Á
::
	$·r£Re¥Ú£Code
(cÚ¡* 
lše
,

950 & 
»¥Ú£Code
) {

951 ià(
	`ssÿnf
(
lše
, "%*s%u", &
»¥Ú£Code
) != 1) {

952 
	`’vœ
().
	`£tResuÉMsg
("nØ»¥Ú£ codš†še: \"", 
lše
, "\"");

953  
F®£
;

956  
True
;

957 
	}
}

	@liveMedia/ServerMediaSession.cpp

24 
	~"S”v”MedŸSessiÚ.hh
"

25 
	~<GroupsockH–³r.hh
>

26 
	~<m©h.h
>

27 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
_QNX4
)

28 
	#¢´štf
 
_¢´štf


	)

33 
S”v”MedŸSessiÚ
* 
	gS”v”MedŸSessiÚ


34 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

35 cÚ¡* 
¡»amName
, cÚ¡* 
šfo
,

36 cÚ¡* 
desütiÚ
, 
BoŞ—n
 
isSSM
, cÚ¡* 
miscSDPLšes
) {

37  
Ãw
 
	`S”v”MedŸSessiÚ
(
’v
, 
¡»amName
, 
šfo
, 
desütiÚ
,

38 
isSSM
, 
miscSDPLšes
);

39 
	}
}

41 
BoŞ—n
 
	gS”v”MedŸSessiÚ


42 ::
	$lookupByName
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
mediumName
,

43 
S”v”MedŸSessiÚ
*& 
»suÉSessiÚ
) {

44 
»suÉSessiÚ
 = 
NULL
;

46 
Medium
* 
medium
;

47 ià(!
Medium
::
	`lookupByName
(
’v
, 
mediumName
, 
medium
)è 
F®£
;

49 ià(!
medium
->
	`isS”v”MedŸSessiÚ
()) {

50 
’v
.
	`£tResuÉMsg
(
mediumName
, " is‚ot‡ 'ServerMediaSession' object");

51  
F®£
;

54 
»suÉSessiÚ
 = (
S”v”MedŸSessiÚ
*)
medium
;

55  
True
;

56 
	}
}

58 cÚ¡* cÚ¡ 
	glibNameSŒ
 = "LIVE555 Streaming Media v";

59 cÚ¡* cÚ¡ 
	glibV”siÚSŒ
 = 
LIVEMEDIA_LIBRARY_VERSION_STRING
;

61 
	gS”v”MedŸSessiÚ
::
	$S”v”MedŸSessiÚ
(
U§geEnvœÚm’t
& 
’v
,

62 cÚ¡* 
¡»amName
,

63 cÚ¡* 
šfo
,

64 cÚ¡* 
desütiÚ
,

65 
BoŞ—n
 
isSSM
, cÚ¡* 
miscSDPLšes
)

66 : 
	`Medium
(
’v
), 
	`fIsSSM
(
isSSM
), 
	`fSub£ssiÚsH—d
(
NULL
),

67 
	`fSub£ssiÚsTa
(
NULL
), 
	`fSub£ssiÚCouÁ”
(0),

68 
	`fReã»nûCouÁ
(0), 
	$fD–‘eWh’UÄeã»nûd
(
F®£
) {

69 
fSŒ—mName
 = 
	`¡rDup
(
¡»amName
 =ğ
NULL
 ? "" : streamName);

71 * 
libNamePlusV”siÚSŒ
 = 
NULL
;

72 ià(
šfo
 =ğ
NULL
 || 
desütiÚ
 == NULL) {

73 
libNamePlusV”siÚSŒ
 = 
Ãw
 [
	`¡¾’
(
libNameSŒ
è+ sŒËn(
libV”siÚSŒ
) + 1];

74 
	`¥rštf
(
libNamePlusV”siÚSŒ
, "%s%s", 
libNameSŒ
, 
libV”siÚSŒ
);

76 
fInfoSDPSŒšg
 = 
	`¡rDup
(
šfo
 =ğ
NULL
 ? 
libNamePlusV”siÚSŒ
 : info);

77 
fDesütiÚSDPSŒšg
 = 
	`¡rDup
(
desütiÚ
 =ğ
NULL
 ? 
libNamePlusV”siÚSŒ
 : description);

78 
d–‘e
[] 
libNamePlusV”siÚSŒ
;

80 
fMiscSDPLšes
 = 
	`¡rDup
(
miscSDPLšes
 =ğ
NULL
 ? "" : miscSDPLines);

82 
	`g‘timeofday
(&
fC»©iÚTime
, 
NULL
);

83 
	}
}

85 
	gS”v”MedŸSessiÚ
::~
	$S”v”MedŸSessiÚ
() {

86 
	`d–‘eAÎSub£ssiÚs
();

87 
d–‘e
[] 
fSŒ—mName
;

88 
d–‘e
[] 
fInfoSDPSŒšg
;

89 
d–‘e
[] 
fDesütiÚSDPSŒšg
;

90 
d–‘e
[] 
fMiscSDPLšes
;

91 
	}
}

93 
BoŞ—n


94 
	gS”v”MedŸSessiÚ
::
	$addSub£ssiÚ
(
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
) {

95 ià(
sub£ssiÚ
->
fP¬’tSessiÚ
 !ğ
NULL
è 
F®£
;

97 ià(
fSub£ssiÚsTa
 =ğ
NULL
) {

98 
fSub£ssiÚsH—d
 = 
sub£ssiÚ
;

100 
fSub£ssiÚsTa
->
fNext
 = 
sub£ssiÚ
;

102 
fSub£ssiÚsTa
 = 
sub£ssiÚ
;

104 
sub£ssiÚ
->
fP¬’tSessiÚ
 = 
this
;

105 
sub£ssiÚ
->
fT¿ckNumb”
 = ++
fSub£ssiÚCouÁ”
;

106  
True
;

107 
	}
}

109 
	gS”v”MedŸSessiÚ
::
	$‹¡SÿËFaùÜ
(& 
sÿË
) {

114 
mšSSSÿË
 = 1.0;

115 
maxSSSÿË
 = 1.0;

116 
be¡SSSÿË
 = 1.0;

117 
be¡Di¡ªûTo1
 = 0.0;

118 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
;

119 
sub£ssiÚ
 = 
fSub£ssiÚsH—d
; sub£ssiÚ !ğ
NULL
;

120 
sub£ssiÚ
 = sub£ssiÚ->
fNext
) {

121 
sssÿË
 = 
sÿË
;

122 
sub£ssiÚ
->
	`‹¡SÿËFaùÜ
(
sssÿË
);

123 ià(
sub£ssiÚ
 =ğ
fSub£ssiÚsH—d
) {

124 
mšSSSÿË
 = 
maxSSSÿË
 = 
be¡SSSÿË
 = 
sssÿË
;

125 
be¡Di¡ªûTo1
 = ()
	`çbs
(
sssÿË
 - 1.0f);

127 ià(
sssÿË
 < 
mšSSSÿË
) {

128 
mšSSSÿË
 = 
sssÿË
;

129 } ià(
sssÿË
 > 
maxSSSÿË
) {

130 
maxSSSÿË
 = 
sssÿË
;

133 
di¡ªûTo1
 = ()
	`çbs
(
sssÿË
 - 1.0f);

134 ià(
di¡ªûTo1
 < 
be¡Di¡ªûTo1
) {

135 
be¡SSSÿË
 = 
sssÿË
;

136 
be¡Di¡ªûTo1
 = 
di¡ªûTo1
;

140 ià(
mšSSSÿË
 =ğ
maxSSSÿË
) {

142 
sÿË
 = 
mšSSSÿË
;

148 
sub£ssiÚ
 = 
fSub£ssiÚsH—d
; sub£ssiÚ !ğ
NULL
;

149 
sub£ssiÚ
 = sub£ssiÚ->
fNext
) {

150 
sssÿË
 = 
be¡SSSÿË
;

151 
sub£ssiÚ
->
	`‹¡SÿËFaùÜ
(
sssÿË
);

152 ià(
sssÿË
 !ğ
be¡SSSÿË
) ;

154 ià(
sub£ssiÚ
 =ğ
NULL
) {

156 
sÿË
 = 
be¡SSSÿË
;

161 
sub£ssiÚ
 = 
fSub£ssiÚsH—d
; sub£ssiÚ !ğ
NULL
;

162 
sub£ssiÚ
 = sub£ssiÚ->
fNext
) {

163 
sssÿË
 = 1;

164 
sub£ssiÚ
->
	`‹¡SÿËFaùÜ
(
sssÿË
);

166 
sÿË
 = 1;

167 
	}
}

169 
	gS”v”MedŸSessiÚ
::
	$du¿tiÚ
() const {

170 
mšSub£ssiÚDu¿tiÚ
 = 0.0;

171 
maxSub£ssiÚDu¿tiÚ
 = 0.0;

172 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
 = 
fSub£ssiÚsH—d
; sub£ssiÚ !ğ
NULL
;

173 
sub£ssiÚ
 = sub£ssiÚ->
fNext
) {

176 * 
absS¹Time
 = 
NULL
; * 
absEndTime
 = NULL;

177 
sub£ssiÚ
->
	`g‘AbsŞu‹TimeRªge
(
absS¹Time
, 
absEndTime
);

178 ià(
absS¹Time
 !ğ
NULL
)  -1.0f;

180 
ssdu¿tiÚ
 = 
sub£ssiÚ
->
	`du¿tiÚ
();

181 ià(
sub£ssiÚ
 =ğ
fSub£ssiÚsH—d
) {

182 
mšSub£ssiÚDu¿tiÚ
 = 
maxSub£ssiÚDu¿tiÚ
 = 
ssdu¿tiÚ
;

183 } ià(
ssdu¿tiÚ
 < 
mšSub£ssiÚDu¿tiÚ
) {

184 
mšSub£ssiÚDu¿tiÚ
 = 
ssdu¿tiÚ
;

185 } ià(
ssdu¿tiÚ
 > 
maxSub£ssiÚDu¿tiÚ
) {

186 
maxSub£ssiÚDu¿tiÚ
 = 
ssdu¿tiÚ
;

190 ià(
maxSub£ssiÚDu¿tiÚ
 !ğ
mšSub£ssiÚDu¿tiÚ
) {

191  -
maxSub£ssiÚDu¿tiÚ
;

193  
maxSub£ssiÚDu¿tiÚ
;

195 
	}
}

197 
	gS”v”MedŸSessiÚ
::
	$d–‘eAÎSub£ssiÚs
() {

198 
Medium
::
	`şo£
(
fSub£ssiÚsH—d
);

199 
fSub£ssiÚsH—d
 = 
fSub£ssiÚsTa
 = 
NULL
;

200 
fSub£ssiÚCouÁ”
 = 0;

201 
	}
}

203 
BoŞ—n
 
	gS”v”MedŸSessiÚ
::
	$isS”v”MedŸSessiÚ
() const {

204  
True
;

205 
	}
}

207 * 
	gS”v”MedŸSessiÚ
::
	$g’”©eSDPDesütiÚ
() {

208 
Add»ssSŒšg
 
	`Add»ssSŒ
(
	`ourIPAdd»ss
(
	`’vœ
()));

209 
Add»ssSŒSize
 = 
	`¡¾’
(
Add»ssSŒ
.
	`v®
());

212 * 
sourûF‹rLše
;

213 ià(
fIsSSM
) {

214 cÚ¡* cÚ¡ 
sourûF‹rFmt
 =

217 cÚ¡ 
sourûF‹rFmtSize
 = 
	`¡¾’
(
sourûF‹rFmt
è+ 
Add»ssSŒSize
 + 1;

219 
sourûF‹rLše
 = 
Ãw
 [
sourûF‹rFmtSize
];

220 
	`¥rštf
(
sourûF‹rLše
, 
sourûF‹rFmt
, 
Add»ssSŒ
.
	`v®
());

222 
sourûF‹rLše
 = 
	`¡rDup
("");

225 * 
¿ngeLše
 = 
NULL
;

226 * 
sdp
 = 
NULL
;

232 
sdpL’gth
 = 0;

233 
S”v”MedŸSub£ssiÚ
* 
sub£ssiÚ
;

234 
sub£ssiÚ
 = 
fSub£ssiÚsH—d
; sub£ssiÚ !ğ
NULL
;

235 
sub£ssiÚ
 = sub£ssiÚ->
fNext
) {

236 cÚ¡* 
sdpLšes
 = 
sub£ssiÚ
->
	`sdpLšes
();

237 ià(
sdpLšes
 =ğ
NULL
) ;

238 
sdpL’gth
 +ğ
	`¡¾’
(
sdpLšes
);

240 ià(
sdpL’gth
 == 0) ;

243 
dur
 = 
	`du¿tiÚ
();

244 ià(
dur
 == 0.0) {

245 
¿ngeLše
 = 
	`¡rDup
("a=range:npt=0-\r\n");

246 } ià(
dur
 > 0.0) {

247 
buf
[100];

248 
	`¥rštf
(
buf
, "aôªge:Åt=0-%.3f\r\n", 
dur
);

249 
¿ngeLše
 = 
	`¡rDup
(
buf
);

251 
¿ngeLše
 = 
	`¡rDup
("");

254 cÚ¡* cÚ¡ 
sdpP»fixFmt
 =

268 
sdpL’gth
 +ğ
	`¡¾’
(
sdpP»fixFmt
)

269 + 20 + 6 + 20 + 
Add»ssSŒSize


270 + 
	`¡¾’
(
fDesütiÚSDPSŒšg
)

271 + 
	`¡¾’
(
fInfoSDPSŒšg
)

272 + 
	`¡¾’
(
libNameSŒ
è+ sŒËn(
libV”siÚSŒ
)

273 + 
	`¡¾’
(
sourûF‹rLše
)

274 + 
	`¡¾’
(
¿ngeLše
)

275 + 
	`¡¾’
(
fDesütiÚSDPSŒšg
)

276 + 
	`¡¾’
(
fInfoSDPSŒšg
)

277 + 
	`¡¾’
(
fMiscSDPLšes
);

278 
sdpL’gth
 += 1000;

279 
sdp
 = 
Ãw
 [
sdpL’gth
];

280 ià(
sdp
 =ğ
NULL
) ;

283 
	`¢´štf
(
sdp
, 
sdpL’gth
, 
sdpP»fixFmt
,

284 
fC»©iÚTime
.
tv_£c
, fC»©iÚTime.
tv_u£c
,

286 
Add»ssSŒ
.
	`v®
(),

287 
fDesütiÚSDPSŒšg
,

288 
fInfoSDPSŒšg
,

289 
libNameSŒ
, 
libV”siÚSŒ
,

290 
sourûF‹rLše
,

291 
¿ngeLše
,

292 
fDesütiÚSDPSŒšg
,

293 
fInfoSDPSŒšg
,

294 
fMiscSDPLšes
);

297 * 
medŸSDP
 = 
sdp
;

298 
sub£ssiÚ
 = 
fSub£ssiÚsH—d
; sub£ssiÚ !ğ
NULL
;

299 
sub£ssiÚ
 = sub£ssiÚ->
fNext
) {

300 
medŸSDPL’gth
 = 
	`¡¾’
(
medŸSDP
);

301 
medŸSDP
 +ğ
medŸSDPL’gth
;

302 
sdpL’gth
 -ğ
medŸSDPL’gth
;

303 ià(
sdpL’gth
 <= 1) ;

305 cÚ¡* 
sdpLšes
 = 
sub£ssiÚ
->
	`sdpLšes
();

306 ià(
sdpLšes
 !ğ
NULL
è
	`¢´štf
(
medŸSDP
, 
sdpL’gth
, "%s", sdpLines);

310 
d–‘e
[] 
¿ngeLše
; d–‘e[] 
sourûF‹rLše
;

311  
sdp
;

312 
	}
}

317 
	gS”v”MedŸSub£ssiÚI‹¿tÜ


318 ::
	$S”v”MedŸSub£ssiÚI‹¿tÜ
(
S”v”MedŸSessiÚ
& 
£ssiÚ
)

319 : 
	$fOurSessiÚ
(
£ssiÚ
) {

320 
	`»£t
();

321 
	}
}

323 
	gS”v”MedŸSub£ssiÚI‹¿tÜ
::~
	$S”v”MedŸSub£ssiÚI‹¿tÜ
() {

324 
	}
}

326 
S”v”MedŸSub£ssiÚ
* 
S”v”MedŸSub£ssiÚI‹¿tÜ
::
	$Ãxt
() {

327 
S”v”MedŸSub£ssiÚ
* 
»suÉ
 = 
fNextPŒ
;

329 ià(
fNextPŒ
 !ğ
NULL
èfNextPŒ = fNextPŒ->
fNext
;

331  
»suÉ
;

332 
	}
}

334 
	gS”v”MedŸSub£ssiÚI‹¿tÜ
::
	$»£t
() {

335 
fNextPŒ
 = 
fOurSessiÚ
.
fSub£ssiÚsH—d
;

336 
	}
}

341 
	gS”v”MedŸSub£ssiÚ
::
	$S”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
)

342 : 
	`Medium
(
’v
),

343 
	`fP¬’tSessiÚ
(
NULL
), 
	`fS”v”Add»ssFÜSDP
(0), 
	`fPÜtNumFÜSDP
(0),

344 
	`fNext
(
NULL
), 
	`fT¿ckNumb”
(0), 
	$fT¿ckId
(
NULL
) {

345 
	}
}

347 
	gS”v”MedŸSub£ssiÚ
::~
	$S”v”MedŸSub£ssiÚ
() {

348 
d–‘e
[] (*)
fT¿ckId
;

349 
Medium
::
	`şo£
(
fNext
);

350 
	}
}

352 cÚ¡* 
	gS”v”MedŸSub£ssiÚ
::
	$ŒackId
() {

353 ià(
fT¿ckNumb”
 =ğ0è 
NULL
;

355 ià(
fT¿ckId
 =ğ
NULL
) {

356 
buf
[100];

357 
	`¥rštf
(
buf
, "Œack%d", 
fT¿ckNumb”
);

358 
fT¿ckId
 = 
	`¡rDup
(
buf
);

360  
fT¿ckId
;

361 
	}
}

363 
	gS”v”MedŸSub£ssiÚ
::
	$·u£SŒ—m
(,

366 
	}
}

367 
	gS”v”MedŸSub£ssiÚ
::
	$£ekSŒ—m
(,

368 * , & , , 
u_št64_t
& 
numBy‹s
) {

370 
numBy‹s
 = 0;

371 
	}
}

372 
	gS”v”MedŸSub£ssiÚ
::
	$£ekSŒ—m
(,

373 * , *& 
absS¹
, *& 
absEnd
) {

375 
d–‘e
[] 
absS¹
;‡bsS¹ = 
NULL
;

376 
d–‘e
[] 
absEnd
;‡bsEnd = 
NULL
;

377 
	}
}

378 
	gS”v”MedŸSub£ssiÚ
::
	$nuÎS“kSŒ—m
(, * ,

379 
¡»amEndTime
, 
u_št64_t
& 
numBy‹s
) {

381 
numBy‹s
 = 0;

382 
	}
}

383 
	gS”v”MedŸSub£ssiÚ
::
	$£tSŒ—mSÿË
(,

386 
	}
}

387 
	gS”v”MedŸSub£ssiÚ
::
	$g‘Cu¼’tNPT
(* ) {

390 
	}
}

391 
F¿medSourû
* 
	gS”v”MedŸSub£ssiÚ
::
	$g‘SŒ—mSourû
(* ) {

393  
NULL
;

394 
	}
}

395 
	gS”v”MedŸSub£ssiÚ
::
	$d–‘eSŒ—m
(,

398 
	}
}

400 
	gS”v”MedŸSub£ssiÚ
::
	$‹¡SÿËFaùÜ
(& 
sÿË
) {

402 
sÿË
 = 1;

403 
	}
}

405 
	gS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
() const {

408 
	}
}

410 
	gS”v”MedŸSub£ssiÚ
::
	$g‘AbsŞu‹TimeRªge
(*& 
absS¹Time
, *& 
absEndTime
) const {

412 
absS¹Time
 = 
absEndTime
 = 
NULL
;

413 
	}
}

415 
	gS”v”MedŸSub£ssiÚ
::
	$£tS”v”Add»ssAndPÜtFÜSDP
(
ÃtAdd»ssB™s
 
add»ssB™s
,

416 
pÜtNumB™s
 
pÜtB™s
) {

417 
fS”v”Add»ssFÜSDP
 = 
add»ssB™s
;

418 
fPÜtNumFÜSDP
 = 
pÜtB™s
;

419 
	}
}

422 
	gS”v”MedŸSub£ssiÚ
::
	$¿ngeSDPLše
() const {

424 * 
absS¹
 = 
NULL
; * 
absEnd
 = NULL;

425 
	`g‘AbsŞu‹TimeRªge
(
absS¹
, 
absEnd
);

426 ià(
absS¹
 !ğ
NULL
) {

427 
buf
[100];

429 ià(
absEnd
 !ğ
NULL
) {

430 
	`¥rštf
(
buf
, "aôªge:şock=%s-%s\r\n", 
absS¹
, 
absEnd
);

432 
	`¥rštf
(
buf
, "aôªge:şock=%s-\r\n", 
absS¹
);

434  
	`¡rDup
(
buf
);

437 ià(
fP¬’tSessiÚ
 =ğ
NULL
)  NULL;

441 ià(
fP¬’tSessiÚ
->
	`du¿tiÚ
(è>ğ0.0è 
	`¡rDup
("");

444 
ourDu¿tiÚ
 = 
	`du¿tiÚ
();

445 ià(
ourDu¿tiÚ
 == 0.0) {

446  
	`¡rDup
("a=range:npt=0-\r\n");

448 
buf
[100];

449 
	`¥rštf
(
buf
, "aôªge:Åt=0-%.3f\r\n", 
ourDu¿tiÚ
);

450  
	`¡rDup
(
buf
);

452 
	}
}

	@liveMedia/SimpleRTPSink.cpp

22 
	~"Sim¶eRTPSšk.hh
"

24 
	gSim¶eRTPSšk
::
	$Sim¶eRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
¹pTime¡ampF»qu’cy
,

27 cÚ¡* 
sdpMedŸTy³SŒšg
,

28 cÚ¡* 
¹pPaylßdFÜm©Name
,

29 
numChªÃls
,

30 
BoŞ—n
 
®lowMuÉËF¿mesP”Pack‘
,

31 
BoŞ—n
 
doNÜm®MB™RuË
)

32 : 
	`MuÉiF¿medRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

33 
¹pTime¡ampF»qu’cy
, 
¹pPaylßdFÜm©Name
,

34 
numChªÃls
),

35 
	`fAÎowMuÉËF¿mesP”Pack‘
(
®lowMuÉËF¿mesP”Pack‘
), 
	$fS‘MB™OnNextPack‘
(
F®£
) {

36 
fSDPMedŸTy³SŒšg


37 ğ
	`¡rDup
(
sdpMedŸTy³SŒšg
 =ğ
NULL
 ? "unknown" : sdpMediaTypeString);

38 
fS‘MB™OnLa¡F¿mes
 = 
doNÜm®MB™RuË
 && 
	`¡rcmp
(
fSDPMedŸTy³SŒšg
, "audio") != 0;

39 
	}
}

41 
	gSim¶eRTPSšk
::~
	$Sim¶eRTPSšk
() {

42 
d–‘e
[] (*)
fSDPMedŸTy³SŒšg
;

43 
	}
}

45 
Sim¶eRTPSšk
*

46 
	gSim¶eRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

47 
¹pPaylßdFÜm©
,

48 
¹pTime¡ampF»qu’cy
,

49 cÚ¡* 
sdpMedŸTy³SŒšg
,

50 cÚ¡* 
¹pPaylßdFÜm©Name
,

51 
numChªÃls
,

52 
BoŞ—n
 
®lowMuÉËF¿mesP”Pack‘
,

53 
BoŞ—n
 
doNÜm®MB™RuË
) {

54  
Ãw
 
	`Sim¶eRTPSšk
(
’v
, 
RTPgs
,

55 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

56 
sdpMedŸTy³SŒšg
, 
¹pPaylßdFÜm©Name
,

57 
numChªÃls
,

58 
®lowMuÉËF¿mesP”Pack‘
,

59 
doNÜm®MB™RuË
);

60 
	}
}

62 
	gSim¶eRTPSšk
::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

63 * 
äameS¹
,

64 
numBy‹sInF¿me
,

65 
timev®
 
äameP»£Á©iÚTime
,

66 
numRemaššgBy‹s
) {

67 ià(
numRemaššgBy‹s
 == 0) {

70 ià(
fS‘MB™OnLa¡F¿mes
è
	`£tM¬k”B™
();

72 ià(
fS‘MB™OnNextPack‘
) {

74 
	`£tM¬k”B™
();

75 
fS‘MB™OnNextPack‘
 = 
F®£
;

80 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

81 
äameS¹
, 
numBy‹sInF¿me
,

82 
äameP»£Á©iÚTime
,

83 
numRemaššgBy‹s
);

84 
	}
}

86 
BoŞ—n
 
	gSim¶eRTPSšk
::

87 
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

89  
fAÎowMuÉËF¿mesP”Pack‘
;

90 
	}
}

92 cÚ¡* 
	gSim¶eRTPSšk
::
	$sdpMedŸTy³
() const {

93  
fSDPMedŸTy³SŒšg
;

94 
	}
}

	@liveMedia/SimpleRTPSource.cpp

23 
	~"Sim¶eRTPSourû.hh
"

24 
	~<¡ršg.h
>

26 
Sim¶eRTPSourû
*

27 
	gSim¶eRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

28 
Groupsock
* 
RTPgs
,

29 
¹pPaylßdFÜm©
,

30 
¹pTime¡ampF»qu’cy
,

31 cÚ¡* 
mimeTy³SŒšg
,

32 
off£t
, 
BoŞ—n
 
doNÜm®MB™RuË
) {

33  
Ãw
 
	`Sim¶eRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
,

35 
mimeTy³SŒšg
, 
off£t
, 
doNÜm®MB™RuË
);

36 
	}
}

38 
	gSim¶eRTPSourû


39 ::
	$Sim¶eRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

40 
¹pPaylßdFÜm©
,

41 
¹pTime¡ampF»qu’cy
,

42 cÚ¡* 
mimeTy³SŒšg
,

43 
off£t
, 
BoŞ—n
 
doNÜm®MB™RuË
)

44 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
,

45 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
),

46 
	`fMIMEty³SŒšg
(
	`¡rDup
(
mimeTy³SŒšg
)), 
	$fOff£t
(
off£t
) {

47 
fU£MB™FÜF¿meEnd
 = 
doNÜm®MB™RuË
 && 
	`¡ºcmp
(
mimeTy³SŒšg
, "audio/", 6) != 0;

48 
	}
}

50 
	gSim¶eRTPSourû
::~
	$Sim¶eRTPSourû
() {

51 
d–‘e
[] (*)
fMIMEty³SŒšg
;

52 
	}
}

54 
BoŞ—n
 
	gSim¶eRTPSourû


55 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

56 & 
»suÉS³cŸlH—d”Size
) {

57 
fCu¼’tPack‘Com¶‘esF¿me


58 ğ!
fU£MB™FÜF¿meEnd
 || 
·ck‘
->
	`¹pM¬k”B™
();

60 
»suÉS³cŸlH—d”Size
 = 
fOff£t
;

61  
True
;

62 
	}
}

64 cÚ¡* 
	gSim¶eRTPSourû
::
	$MIMEty³
() const {

65 ià(
fMIMEty³SŒšg
 =ğ
NULL
è 
MuÉiF¿medRTPSourû
::
	`MIMEty³
();

67  
fMIMEty³SŒšg
;

68 
	}
}

	@liveMedia/StreamParser.cpp

21 
	~"SŒ—mP¬£r.hh
"

23 
	~<¡ršg.h
>

24 
	~<¡dlib.h
>

26 
	#BANK_SIZE
 150000

	)

28 
	gSŒ—mP¬£r
::
	$æushIÅut
() {

29 
fCurP¬£rIndex
 = 
fSavedP¬£rIndex
 = 0;

30 
fSavedRemaššgUÅ¬£dB™s
 = 
fRemaššgUÅ¬£dB™s
 = 0;

31 
fTÙNumV®idBy‹s
 = 0;

32 
	}
}

34 
	gSŒ—mP¬£r
::
SŒ—mP¬£r
(
F¿medSourû
* 
šputSourû
,

35 
F¿medSourû
::
ÚClo£Func
* 
ÚIÅutClo£Func
,

36 * 
ÚIÅutClo£Cl›ÁD©a
,

37 
ş›ÁCÚtšueFunc
* clientContinueFunc,

38 * 
ş›ÁCÚtšueCl›ÁD©a
)

39 : 
fIÅutSourû
(
šputSourû
), 
fCl›ÁOnIÅutClo£Func
(
ÚIÅutClo£Func
),

40 
fCl›ÁOnIÅutClo£Cl›ÁD©a
(
ÚIÅutClo£Cl›ÁD©a
),

41 
fCl›ÁCÚtšueFunc
(
ş›ÁCÚtšueFunc
),

42 
fCl›ÁCÚtšueCl›ÁD©a
(
ş›ÁCÚtšueCl›ÁD©a
),

43 
fSavedP¬£rIndex
(0), 
fSavedRemaššgUÅ¬£dB™s
(0),

44 
fCurP¬£rIndex
(0), 
fRemaššgUÅ¬£dB™s
(0),

45 
fTÙNumV®idBy‹s
(0), 
	$fHaveS“nEOF
(
F®£
) {

46 
fBªk
[0] = 
Ãw
 [
BANK_SIZE
];

47 
fBªk
[1] = 
Ãw
 [
BANK_SIZE
];

48 
fCurBªkNum
 = 0;

49 
fCurBªk
 = 
fBªk
[
fCurBªkNum
];

51 
fLa¡S“nP»£Á©iÚTime
.
tv_£c
 = 0; fLa¡S“nP»£Á©iÚTime.
tv_u£c
 = 0;

52 
	}
}

54 
	gSŒ—mP¬£r
::~
	$SŒ—mP¬£r
() {

55 
d–‘e
[] 
fBªk
[0]; delete[] fBank[1];

56 
	}
}

58 
	gSŒ—mP¬£r
::
	$§veP¬£rS‹
() {

59 
fSavedP¬£rIndex
 = 
fCurP¬£rIndex
;

60 
fSavedRemaššgUÅ¬£dB™s
 = 
fRemaššgUÅ¬£dB™s
;

61 
	}
}

63 
	gSŒ—mP¬£r
::
	$»¡ÜeSavedP¬£rS‹
() {

64 
fCurP¬£rIndex
 = 
fSavedP¬£rIndex
;

65 
fRemaššgUÅ¬£dB™s
 = 
fSavedRemaššgUÅ¬£dB™s
;

66 
	}
}

68 
	gSŒ—mP¬£r
::
	$skB™s
(
numB™s
) {

69 ià(
numB™s
 <ğ
fRemaššgUÅ¬£dB™s
) {

70 
fRemaššgUÅ¬£dB™s
 -ğ
numB™s
;

72 
numB™s
 -ğ
fRemaššgUÅ¬£dB™s
;

74 
numBy‹sToExamše
 = (
numB™s
+7)/8;

75 
	`’su»V®idBy‹s
(
numBy‹sToExamše
);

76 
fCurP¬£rIndex
 +ğ
numBy‹sToExamše
;

78 
fRemaššgUÅ¬£dB™s
 = 8*
numBy‹sToExamše
 - 
numB™s
;

80 
	}
}

82 
	gSŒ—mP¬£r
::
	$g‘B™s
(
numB™s
) {

83 ià(
numB™s
 <ğ
fRemaššgUÅ¬£dB™s
) {

84 
Ï¡By‹
 = *
	`Ï¡P¬£d
();

85 
Ï¡By‹
 >>ğ(
fRemaššgUÅ¬£dB™s
 - 
numB™s
);

86 
fRemaššgUÅ¬£dB™s
 -ğ
numB™s
;

88  ()
Ï¡By‹
 &~ ((~0u)<<
numB™s
);

90 
Ï¡By‹
;

91 ià(
fRemaššgUÅ¬£dB™s
 > 0) {

92 
Ï¡By‹
 = *
	`Ï¡P¬£d
();

94 
Ï¡By‹
 = 0;

97 
»maššgB™s
 = 
numB™s
 - 
fRemaššgUÅ¬£dB™s
;

101 
»suÉ
 = 
	`‹¡4By‹s
();

103 
»suÉ
 >>ğ(32 - 
»maššgB™s
);

104 
»suÉ
 |ğ(
Ï¡By‹
 << 
»maššgB™s
);

105 ià(
numB™s
 < 32è
»suÉ
 &=~ ((~0u)<<numBits);

107 cÚ¡ 
numRemaššgBy‹s
 = (
»maššgB™s
+7)/8;

108 
fCurP¬£rIndex
 +ğ
numRemaššgBy‹s
;

109 
fRemaššgUÅ¬£dB™s
 = 8*
numRemaššgBy‹s
 - 
»maššgB™s
;

111  
»suÉ
;

113 
	}
}

115 
	gSŒ—mP¬£r
::
	$bªkSize
() const {

116  
BANK_SIZE
;

117 
	}
}

119 
	#NO_MORE_BUFFERED_INPUT
 1

	)

121 
	gSŒ—mP¬£r
::
	$’su»V®idBy‹s1
(
numBy‹sN“ded
) {

124 
maxIÅutF¿meSize
 = 
fIÅutSourû
->
	`maxF¿meSize
();

125 ià(
maxIÅutF¿meSize
 > 
numBy‹sN“ded
)‚umBytesNeeded = maxInputFrameSize;

129 ià(
fCurP¬£rIndex
 + 
numBy‹sN“ded
 > 
BANK_SIZE
) {

131 
numBy‹sToSave
 = 
fTÙNumV®idBy‹s
 - 
fSavedP¬£rIndex
;

132 cÚ¡* 
äom
 = &
	`curBªk
()[
fSavedP¬£rIndex
];

134 
fCurBªkNum
 = (fCurBankNum + 1)%2;

135 
fCurBªk
 = 
fBªk
[
fCurBªkNum
];

136 
	`memmove
(
	`curBªk
(), 
äom
, 
numBy‹sToSave
);

137 
fCurP¬£rIndex
 = fCurP¬£rIndex - 
fSavedP¬£rIndex
;

138 
fSavedP¬£rIndex
 = 0;

139 
fTÙNumV®idBy‹s
 = 
numBy‹sToSave
;

144 ià(
fCurP¬£rIndex
 + 
numBy‹sN“ded
 > 
BANK_SIZE
) {

147 
fIÅutSourû
->
	`’vœ
() << "StreamParser internalƒrror ("

148 << 
fCurP¬£rIndex
 << " + "

149 << 
numBy‹sN“ded
 << " > "

150 << 
BANK_SIZE
 << ")\n";

151 
fIÅutSourû
->
	`’vœ
().
	`š‹º®E¼Ü
();

155 
maxNumBy‹sToR—d
 = 
BANK_SIZE
 - 
fTÙNumV®idBy‹s
;

156 
fIÅutSourû
->
	`g‘NextF¿me
(&
	`curBªk
()[
fTÙNumV®idBy‹s
],

157 
maxNumBy‹sToR—d
,

158 
aá”G‘tšgBy‹s
, 
this
,

159 
ÚIÅutClosu»
, 
this
);

161 
throw
 
NO_MORE_BUFFERED_INPUT
;

162 
	}
}

164 
	gSŒ—mP¬£r
::
	$aá”G‘tšgBy‹s
(* 
ş›ÁD©a
,

165 
numBy‹sR—d
,

167 
timev®
 
´e£Á©iÚTime
,

169 
SŒ—mP¬£r
* 
·r£r
 = (SŒ—mP¬£r*)
ş›ÁD©a
;

170 ià(
·r£r
 !ğ
NULL
è·r£r->
	`aá”G‘tšgBy‹s1
(
numBy‹sR—d
, 
´e£Á©iÚTime
);

171 
	}
}

173 
	gSŒ—mP¬£r
::
	$aá”G‘tšgBy‹s1
(
numBy‹sR—d
, 
timev®
 
´e£Á©iÚTime
) {

175 ià(
fTÙNumV®idBy‹s
 + 
numBy‹sR—d
 > 
BANK_SIZE
) {

176 
fIÅutSourû
->
	`’vœ
()

178 << 
numBy‹sR—d
 << " bytes;ƒxpected‚o morehan "

179 << 
BANK_SIZE
 - 
fTÙNumV®idBy‹s
 << "\n";

182 
fLa¡S“nP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

184 * 
±r
 = &
	`curBªk
()[
fTÙNumV®idBy‹s
];

185 
fTÙNumV®idBy‹s
 +ğ
numBy‹sR—d
;

188 
	`»¡ÜeSavedP¬£rS‹
();

191 
	`fCl›ÁCÚtšueFunc
(
fCl›ÁCÚtšueCl›ÁD©a
, 
±r
, 
numBy‹sR—d
, 
´e£Á©iÚTime
);

192 
	}
}

194 
	gSŒ—mP¬£r
::
	$ÚIÅutClosu»
(* 
ş›ÁD©a
) {

195 
SŒ—mP¬£r
* 
·r£r
 = (SŒ—mP¬£r*)
ş›ÁD©a
;

196 ià(
·r£r
 !ğ
NULL
è·r£r->
	`ÚIÅutClosu»1
();

197 
	}
}

199 
	gSŒ—mP¬£r
::
	$ÚIÅutClosu»1
() {

200 ià(!
fHaveS“nEOF
) {

203 
fHaveS“nEOF
 = 
True
;

204 
	`aá”G‘tšgBy‹s1
(0, 
fLa¡S“nP»£Á©iÚTime
);

207 
fHaveS“nEOF
 = 
F®£
;

208 ià(
fCl›ÁOnIÅutClo£Func
 !ğ
NULL
è(*fCl›ÁOnIÅutClo£Func)(
fCl›ÁOnIÅutClo£Cl›ÁD©a
);

210 
	}
}

	@liveMedia/StreamReplicator.cpp

21 
	~"SŒ—mR•liÿtÜ.hh
"

25 şas 
	cSŒ—mR•liÿ
: 
public
 
F¿medSourû
 {

26 
´Ùeùed
:

27 
ä›nd
 
şass
 
SŒ—mR•liÿtÜ
;

28 
SŒ—mR•liÿ
(
SŒ—mR•liÿtÜ
& 
ourR•liÿtÜ
);

29 
	mvœtu®
 ~
SŒ—mR•liÿ
();

31 
	m´iv©e
:

32 
vœtu®
 
doG‘NextF¿me
();

33 
vœtu®
 
doStİG‘tšgF¿mes
();

35 
	m´iv©e
:

36 
cİyReûivedF¿me
(
SŒ—mR•liÿ
* 
toR•liÿ
, SŒ—mR•liÿ* 
äomR•liÿ
);

38 
	m´iv©e
:

39 
SŒ—mR•liÿtÜ
& 
fOurR•liÿtÜ
;

40 
	mfF¿meIndex
;

43 
SŒ—mR•liÿ
* 
	mfNext
;

49 
SŒ—mR•liÿtÜ
* 
	gSŒ—mR•liÿtÜ
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
d–‘eWh’La¡R•liÿD›s
) {

50  
Ãw
 
	`SŒ—mR•liÿtÜ
(
’v
, 
šputSourû
, 
d–‘eWh’La¡R•liÿD›s
);

51 
	}
}

53 
	gSŒ—mR•liÿtÜ
::
	$SŒ—mR•liÿtÜ
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
BoŞ—n
 
d–‘eWh’La¡R•liÿD›s
)

54 : 
	`Medium
(
’v
),

55 
	`fIÅutSourû
(
šputSourû
), 
	`fD–‘eWh’La¡R•liÿD›s
(
d–‘eWh’La¡R•liÿD›s
), 
	`fIÅutSourûHasClo£d
(
F®£
),

56 
	`fNumR•liÿs
(0), 
	`fNumAùiveR•liÿs
(0), 
	`fNumD–iv”›sMadeSoF¬
(0),

57 
	`fF¿meIndex
(0), 
	`fMa¡”R•liÿ
(
NULL
), 
	`fR•liÿsAwa™šgCu¼’tF¿me
(NULL), 
	$fR•liÿsAwa™šgNextF¿me
(
NULL
) {

58 
	}
}

60 
	gSŒ—mR•liÿtÜ
::~
	$SŒ—mR•liÿtÜ
() {

61 
Medium
::
	`şo£
(
fIÅutSourû
);

62 
	}
}

64 
F¿medSourû
* 
	gSŒ—mR•liÿtÜ
::
	$ü—‹SŒ—mR•liÿ
() {

65 ++
fNumR•liÿs
;

66  
Ãw
 
	`SŒ—mR•liÿ
(*
this
);

67 
	}
}

69 
	gSŒ—mR•liÿtÜ
::
	$g‘NextF¿me
(
SŒ—mR•liÿ
* 
»¶iÿ
) {

70 ià(
fIÅutSourûHasClo£d
) {

71 
»¶iÿ
->
	`hªdËClosu»
();

75 ià(
»¶iÿ
->
fF¿meIndex
 == -1) {

77 
»¶iÿ
->
fF¿meIndex
 = fFrameIndex;

78 ++
fNumAùiveR•liÿs
;

81 ià(
fMa¡”R•liÿ
 =ğ
NULL
) {

84 
fMa¡”R•liÿ
 = 
»¶iÿ
;

87 ià(
fIÅutSourû
 !ğ
NULL
èfIÅutSourû->
	`g‘NextF¿me
(
fMa¡”R•liÿ
->
fTo
, fMa¡”R•liÿ->
fMaxSize
,

88 
aá”G‘tšgF¿me
, 
this
, 
ÚSourûClosu»
,his);

89 } ià(
»¶iÿ
->
fF¿meIndex
 != fFrameIndex) {

91 
»¶iÿ
->
fNext
 = 
fR•liÿsAwa™šgNextF¿me
;

92 
fR•liÿsAwa™šgNextF¿me
 = 
»¶iÿ
;

95 
»¶iÿ
->
fNext
 = 
fR•liÿsAwa™šgCu¼’tF¿me
;

96 
fR•liÿsAwa™šgCu¼’tF¿me
 = 
»¶iÿ
;

98 ià(
fIÅutSourû
 !ğ
NULL
 && !fIÅutSourû->
	`isCu¼’yAwa™šgD©a
()) {

100 
	`d–iv”ReûivedF¿me
();

103 
	}
}

105 
	gSŒ—mR•liÿtÜ
::
	$d—ùiv©eSŒ—mR•liÿ
(
SŒ—mR•liÿ
* 
»¶iÿBešgD—ùiv©ed
) {

106 ià(
»¶iÿBešgD—ùiv©ed
->
fF¿meIndex
 == -1) ;

109 ià(
fNumAùiveR•liÿs
 =ğ0è
	`årštf
(
¡d”r
, "StreamReplicator::deactivateStreamReplica() Internal Error!\n");

110 --
fNumAùiveR•liÿs
;

111 
»¶iÿBešgD—ùiv©ed
->
fF¿meIndex
 = -1;

114 ià(
»¶iÿBešgD—ùiv©ed
->
fF¿meIndex
 !ğfF¿meIndex && 
fNumD–iv”›sMadeSoF¬
 > 0) --fNumDeliveriesMadeSoFar;

117 ià(
»¶iÿBešgD—ùiv©ed
 =ğ
fMa¡”R•liÿ
) {

119 ià(
fR•liÿsAwa™šgCu¼’tF¿me
 =ğ
NULL
) {

121 
fMa¡”R•liÿ
 = 
NULL
;

124 
fMa¡”R•liÿ
 = 
fR•liÿsAwa™šgCu¼’tF¿me
;

125 
fR•liÿsAwa™šgCu¼’tF¿me
 = fR•liÿsAwa™šgCu¼’tF¿me->
fNext
;

126 
fMa¡”R•liÿ
->
fNext
 = 
NULL
;

130 ià(
fIÅutSourû
 !ğ
NULL
) {

131 ià(
fIÅutSourû
->
	`isCu¼’yAwa™šgD©a
()) {

134 
fIÅutSourû
->
	`¡İG‘tšgF¿mes
();

136 ià(
fMa¡”R•liÿ
 !ğ
NULL
) {

137 
fIÅutSourû
->
	`g‘NextF¿me
(
fMa¡”R•liÿ
->
fTo
, fMa¡”R•liÿ->
fMaxSize
,

138 
aá”G‘tšgF¿me
, 
this
, 
ÚSourûClosu»
,his);

142 ià(
fMa¡”R•liÿ
 !ğ
NULL
) {

143 
SŒ—mR•liÿ
::
	`cİyReûivedF¿me
(
fMa¡”R•liÿ
, 
»¶iÿBešgD—ùiv©ed
);

152 ià(
fR•liÿsAwa™šgCu¼’tF¿me
 !ğ
NULL
) {

153 ià(
»¶iÿBešgD—ùiv©ed
 =ğ
fR•liÿsAwa™šgCu¼’tF¿me
) {

154 
fR•liÿsAwa™šgCu¼’tF¿me
 = 
»¶iÿBešgD—ùiv©ed
->
fNext
;

155 
»¶iÿBešgD—ùiv©ed
->
fNext
 = 
NULL
;

158 
SŒ—mR•liÿ
* 
r1
 = 
fR•liÿsAwa™šgCu¼’tF¿me
;„1->
fNext
 !ğ
NULL
;„1 =„1->fNext) {

159 ià(
r1
->
fNext
 =ğ
»¶iÿBešgD—ùiv©ed
) {

160 
r1
->
fNext
 = 
»¶iÿBešgD—ùiv©ed
->fNext;

161 
»¶iÿBešgD—ùiv©ed
->
fNext
 = 
NULL
;

167 ià(
fR•liÿsAwa™šgNextF¿me
 !ğ
NULL
) {

168 ià(
»¶iÿBešgD—ùiv©ed
 =ğ
fR•liÿsAwa™šgNextF¿me
) {

169 
fR•liÿsAwa™šgNextF¿me
 = 
»¶iÿBešgD—ùiv©ed
->
fNext
;

170 
»¶iÿBešgD—ùiv©ed
->
fNext
 = 
NULL
;

173 
SŒ—mR•liÿ
* 
r2
 = 
fR•liÿsAwa™šgNextF¿me
;„2->
fNext
 !ğ
NULL
;„2 =„2->fNext) {

174 ià(
r2
->
fNext
 =ğ
»¶iÿBešgD—ùiv©ed
) {

175 
r2
->
fNext
 = 
»¶iÿBešgD—ùiv©ed
->fNext;

176 
»¶iÿBešgD—ùiv©ed
->
fNext
 = 
NULL
;

186 ià(
fMa¡”R•liÿ
 !ğ
NULL
 && 
fIÅutSourû
 !ğNULL && !fIÅutSourû->
	`isCu¼’yAwa™šgD©a
()è
	`d–iv”ReûivedF¿me
();

189 ià(
fNumAùiveR•liÿs
 =ğ0 && 
fIÅutSourû
 !ğ
NULL
èfIÅutSourû->
	`¡İG‘tšgF¿mes
();

190 
	}
}

192 
	gSŒ—mR•liÿtÜ
::
	$»moveSŒ—mR•liÿ
(
SŒ—mR•liÿ
* 
»¶iÿBešgRemoved
) {

194 
	`d—ùiv©eSŒ—mR•liÿ
(
»¶iÿBešgRemoved
);

197 ià(
fNumR•liÿs
 =ğ0è
	`årštf
(
¡d”r
, "StreamReplicator::removeStreamReplica() Internal Error!\n");

198 --
fNumR•liÿs
;

201 ià(
fNumR•liÿs
 =ğ0 && 
fD–‘eWh’La¡R•liÿD›s
) {

202 
Medium
::
	`şo£
(
this
);

205 
	}
}

207 
	gSŒ—mR•liÿtÜ
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
, 
numTrunÿ‹dBy‹s
,

208 
timev®
 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
) {

209 ((
SŒ—mR•liÿtÜ
*)
ş›ÁD©a
)->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

210 
	}
}

212 
	gSŒ—mR•liÿtÜ
::
	$aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
,

213 
timev®
 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
) {

216 
fMa¡”R•liÿ
->
fF¿meSize
 = 
äameSize
;

217 
fMa¡”R•liÿ
->
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

218 
fMa¡”R•liÿ
->
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

219 
fMa¡”R•liÿ
->
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

221 
	`d–iv”ReûivedF¿me
();

222 
	}
}

224 
	gSŒ—mR•liÿtÜ
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

225 ((
SŒ—mR•liÿtÜ
*)
ş›ÁD©a
)->
	`ÚSourûClosu»
();

226 
	}
}

228 
	gSŒ—mR•liÿtÜ
::
	$ÚSourûClosu»
() {

229 
fIÅutSourûHasClo£d
 = 
True
;

232 
SŒ—mR•liÿ
* 
»¶iÿ
;

233 (
»¶iÿ
 = 
fR•liÿsAwa™šgCu¼’tF¿me
è!ğ
NULL
) {

234 
fR•liÿsAwa™šgCu¼’tF¿me
 = 
»¶iÿ
->
fNext
;

235 
»¶iÿ
->
fNext
 = 
NULL
;

236 
»¶iÿ
->
	`hªdËClosu»
();

238 (
»¶iÿ
 = 
fR•liÿsAwa™šgNextF¿me
è!ğ
NULL
) {

239 
fR•liÿsAwa™šgNextF¿me
 = 
»¶iÿ
->
fNext
;

240 
»¶iÿ
->
fNext
 = 
NULL
;

241 
»¶iÿ
->
	`hªdËClosu»
();

243 ià((
»¶iÿ
 = 
fMa¡”R•liÿ
è!ğ
NULL
) {

244 
fMa¡”R•liÿ
 = 
NULL
;

245 
»¶iÿ
->
	`hªdËClosu»
();

247 
	}
}

249 
	gSŒ—mR•liÿtÜ
::
	$d–iv”ReûivedF¿me
() {

253 
SŒ—mR•liÿ
* 
»¶iÿ
;

254 (
»¶iÿ
 = 
fR•liÿsAwa™šgCu¼’tF¿me
è!ğ
NULL
) {

255 
fR•liÿsAwa™šgCu¼’tF¿me
 = 
»¶iÿ
->
fNext
;

256 
»¶iÿ
->
fNext
 = 
NULL
;

259 ià(
fMa¡”R•liÿ
 =ğ
NULL
è
	`årštf
(
¡d”r
, "StreamReplicator::deliverReceivedFrame() Internal Error 1!\n");

260 
SŒ—mR•liÿ
::
	`cİyReûivedF¿me
(
»¶iÿ
, 
fMa¡”R•liÿ
);

261 
»¶iÿ
->
fF¿meIndex
 = 1 -„eplica->fFrameIndex;

262 ++
fNumD–iv”›sMadeSoF¬
;

265 ià(!(
fNumD–iv”›sMadeSoF¬
 < 
fNumAùiveR•liÿs
)è
	`årštf
(
¡d”r
, "StreamReplicator::deliverReceivedFrame() Internal Error 2(%d,%d)!\n", fNumDeliveriesMadeSoFar, fNumActiveReplicas);

268 
F¿medSourû
::
	`aá”G‘tšg
(
»¶iÿ
);

271 ià(
fNumD–iv”›sMadeSoF¬
 =ğ
fNumAùiveR•liÿs
 - 1 && 
fMa¡”R•liÿ
 !ğ
NULL
) {

273 
»¶iÿ
 = 
fMa¡”R•liÿ
;

274 
fMa¡”R•liÿ
 = 
NULL
;

275 
»¶iÿ
->
fF¿meIndex
 = 1 -„eplica->fFrameIndex;

276 
fF¿meIndex
 = 1 - fFrameIndex;

277 
fNumD–iv”›sMadeSoF¬
 = 0;

279 ià(
fR•liÿsAwa™šgNextF¿me
 !ğ
NULL
) {

281 
fMa¡”R•liÿ
 = 
fR•liÿsAwa™šgNextF¿me
;

282 
fR•liÿsAwa™šgNextF¿me
 = fR•liÿsAwa™šgNextF¿me->
fNext
;

283 
fMa¡”R•liÿ
->
fNext
 = 
NULL
;

286 ià(
fIÅutSourû
 !ğ
NULL
èfIÅutSourû->
	`g‘NextF¿me
(
fMa¡”R•liÿ
->
fTo
, fMa¡”R•liÿ->
fMaxSize
,

287 
aá”G‘tšgF¿me
, 
this
, 
ÚSourûClosu»
,his);

292 ià(!(
fR•liÿsAwa™šgCu¼’tF¿me
 =ğ
NULL
)è
	`årštf
(
¡d”r
, "StreamReplicator::deliverReceivedFrame() Internal Error 3!\n");

293 
fR•liÿsAwa™šgCu¼’tF¿me
 = 
fR•liÿsAwa™šgNextF¿me
;

294 
fR•liÿsAwa™šgNextF¿me
 = 
NULL
;

297 
F¿medSourû
::
	`aá”G‘tšg
(
»¶iÿ
);

299 
	}
}

304 
	gSŒ—mR•liÿ
::
	$SŒ—mR•liÿ
(
SŒ—mR•liÿtÜ
& 
ourR•liÿtÜ
)

305 : 
	`F¿medSourû
(
ourR•liÿtÜ
.
	`’vœ
()),

306 
	`fOurR•liÿtÜ
(
ourR•liÿtÜ
),

307 
	`fF¿meIndex
(-1 ), 
	$fNext
(
NULL
) {

308 
	}
}

310 
	gSŒ—mR•liÿ
::~
	$SŒ—mR•liÿ
() {

311 
fOurR•liÿtÜ
.
	`»moveSŒ—mR•liÿ
(
this
);

312 
	}
}

314 
	gSŒ—mR•liÿ
::
	$doG‘NextF¿me
() {

315 
fOurR•liÿtÜ
.
	`g‘NextF¿me
(
this
);

316 
	}
}

318 
	gSŒ—mR•liÿ
::
	$doStİG‘tšgF¿mes
() {

319 
fOurR•liÿtÜ
.
	`d—ùiv©eSŒ—mR•liÿ
(
this
);

320 
	}
}

322 
	gSŒ—mR•liÿ
::
	$cİyReûivedF¿me
(
SŒ—mR•liÿ
* 
toR•liÿ
, SŒ—mR•liÿ* 
äomR•liÿ
) {

324 
numNewBy‹sToTrunÿ‹


325 ğ
toR•liÿ
->
fMaxSize
 < 
äomR•liÿ
->
fF¿meSize
 ? fromReplica->fFrameSize -oReplica->fMaxSize : 0;

326 
toR•liÿ
->
fF¿meSize
 = 
äomR•liÿ
->fF¿meSiz- 
numNewBy‹sToTrunÿ‹
;

327 
toR•liÿ
->
fNumTrunÿ‹dBy‹s
 = 
äomR•liÿ
->fNumTrunÿ‹dBy‹ + 
numNewBy‹sToTrunÿ‹
;

329 
	`memmove
(
toR•liÿ
->
fTo
, 
äomR•liÿ
->fTo,oR•liÿ->
fF¿meSize
);

330 
toR•liÿ
->
fP»£Á©iÚTime
 = 
äomR•liÿ
->fPresentationTime;

331 
toR•liÿ
->
fDu¿tiÚInMiüo£cÚds
 = 
äomR•liÿ
->fDurationInMicroseconds;

332 
	}
}

	@liveMedia/T140TextRTPSink.cpp

21 
	~"T140TextRTPSšk.hh
"

22 
	~<GroupsockH–³r.hh
>

26 
	gT140TextRTPSšk
::
	$T140TextRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
)

27 : 
	`TextRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 1000 , "T140"),

28 
	`fOurIdËF‹r
(
NULL
), 
	$fA»InIdËP”iod
(
True
) {

29 
	}
}

31 
	gT140TextRTPSšk
::~
	$T140TextRTPSšk
() {

32 
fSourû
 = 
fOurIdËF‹r
;

33 
	`¡İPÏyšg
();

36 
Medium
::
	`şo£
(
fOurIdËF‹r
);

37 
fSourû
 = 
NULL
;

38 
	}
}

40 
T140TextRTPSšk
*

41 
	gT140TextRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

42 
¹pPaylßdFÜm©
) {

43  
Ãw
 
	`T140TextRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

44 
	}
}

46 
BoŞ—n
 
	gT140TextRTPSšk
::
	$cÚtšuePÏyšg
() {

48 ià(
fOurIdËF‹r
 =ğ
NULL
) {

49 
fOurIdËF‹r
 = 
Ãw
 
	`T140IdËF‹r
(
	`’vœ
(), 
fSourû
);

51 
fOurIdËF‹r
->
	`»assignIÅutSourû
(
fSourû
);

53 
fSourû
 = 
fOurIdËF‹r
;

56  
MuÉiF¿medRTPSšk
::
	`cÚtšuePÏyšg
();

57 
	}
}

59 
	gT140TextRTPSšk
::
	$doS³cŸlF¿meHªdlšg
(,

61 
numBy‹sInF¿me
,

62 
timev®
 
äameP»£Á©iÚTime
,

65 ià(
fA»InIdËP”iod
 && 
numBy‹sInF¿me
 > 0è
	`£tM¬k”B™
();

66 
fA»InIdËP”iod
 = 
numBy‹sInF¿me
 == 0;

68 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

69 
	}
}

71 
BoŞ—n
 
	gT140TextRTPSšk
::
	$äameCªAµ—rAá”Pack‘S¹
(const* , ) const {

72  
F®£
;

73 
	}
}

78 
	gT140IdËF‹r
::
	$T140IdËF‹r
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
)

79 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

80 
	`fIdËTim”Task
(
NULL
),

81 
	`fBufãrSize
(
OutPack‘Bufãr
::
maxSize
), 
	$fNumBufã»dBy‹s
(0) {

82 
fBufãr
 = 
Ãw
 [
fBufãrSize
];

83 
	}
}

85 
	gT140IdËF‹r
::~
	$T140IdËF‹r
() {

86 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fIdËTim”Task
);

88 
d–‘e
[] 
fBufãr
;

89 
	`d‘achIÅutSourû
();

90 
	}
}

92 
	#IDLE_TIMEOUT_MICROSECONDS
 300000

	)

94 
	gT140IdËF‹r
::
	$doG‘NextF¿me
() {

96 ià(
fNumBufã»dBy‹s
 > 0) {

97 
	`d–iv”FromBufãr
();

103 
fIdËTim”Task
 = 
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(
IDLE_TIMEOUT_MICROSECONDS
, 
hªdËIdËTimeout
, 
this
);

104 ià(
fIÅutSourû
 !ğ
NULL
 && !fIÅutSourû->
	`isCu¼’yAwa™šgD©a
()) {

105 
fIÅutSourû
->
	`g‘NextF¿me
((*)
fBufãr
, 
fBufãrSize
, 
aá”G‘tšgF¿me
, 
this
, 
ÚSourûClosu»
,his);

107 
	}
}

109 
	gT140IdËF‹r
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

110 
numTrunÿ‹dBy‹s
,

111 
timev®
 
´e£Á©iÚTime
,

112 
du¿tiÚInMiüo£cÚds
) {

113 ((
T140IdËF‹r
*)
ş›ÁD©a
)->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

114 
	}
}

116 
	gT140IdËF‹r
::
	$aá”G‘tšgF¿me
(
äameSize
,

117 
numTrunÿ‹dBy‹s
,

118 
timev®
 
´e£Á©iÚTime
,

119 
du¿tiÚInMiüo£cÚds
) {

121 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fIdËTim”Task
);

124 
fNumBufã»dBy‹s
 = 
äameSize
;

125 
fBufã»dNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

126 
fBufã»dD©aP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

127 
fBufã»dD©aDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

130 ià(
	`isCu¼’yAwa™šgD©a
()è()
	`d–iv”FromBufãr
();

131 
	}
}

133 
	gT140IdËF‹r
::
	$doStİG‘tšgF¿mes
() {

135 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fIdËTim”Task
);

138 
F¿medF‹r
::
	`doStİG‘tšgF¿mes
();

139 
	}
}

141 
	gT140IdËF‹r
::
	$hªdËIdËTimeout
(* 
ş›ÁD©a
) {

142 ((
T140IdËF‹r
*)
ş›ÁD©a
)->
	`hªdËIdËTimeout
();

143 
	}
}

145 
	gT140IdËF‹r
::
	$hªdËIdËTimeout
() {

148 
	`d–iv”Em±yF¿me
();

149 
	}
}

151 
	gT140IdËF‹r
::
	$d–iv”FromBufãr
() {

152 ià(
fNumBufã»dBy‹s
 <ğ
fMaxSize
) {

153 
fNumTrunÿ‹dBy‹s
 = 
fBufã»dNumTrunÿ‹dBy‹s
;

154 
fF¿meSize
 = 
fNumBufã»dBy‹s
;

156 
fNumTrunÿ‹dBy‹s
 = 
fBufã»dNumTrunÿ‹dBy‹s
 + 
fNumBufã»dBy‹s
 - 
fMaxSize
;

157 
fF¿meSize
 = 
fMaxSize
;

160 
	`memmove
(
fTo
, 
fBufãr
, 
fF¿meSize
);

161 
fP»£Á©iÚTime
 = 
fBufã»dD©aP»£Á©iÚTime
;

162 
fDu¿tiÚInMiüo£cÚds
 = 
fBufã»dD©aDu¿tiÚInMiüo£cÚds
;

164 
fNumBufã»dBy‹s
 = 0;

166 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

167 
	}
}

169 
	gT140IdËF‹r
::
	$d–iv”Em±yF¿me
() {

170 
fF¿meSize
 = 
fNumTrunÿ‹dBy‹s
 = 0;

171 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

172 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

173 
	}
}

175 
	gT140IdËF‹r
::
	$ÚSourûClosu»
(* 
ş›ÁD©a
) {

176 ((
T140IdËF‹r
*)
ş›ÁD©a
)->
	`ÚSourûClosu»
();

177 
	}
}

179 
	gT140IdËF‹r
::
	$ÚSourûClosu»
() {

180 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
fIdËTim”Task
);

181 
fIdËTim”Task
 = 
NULL
;

183 
	`hªdËClosu»
();

184 
	}
}

	@liveMedia/TCPStreamSink.cpp

21 
	~"TCPSŒ—mSšk.hh
"

22 
	~<GroupsockH–³r.hh
>

24 
TCPSŒ—mSšk
* 
	gTCPSŒ—mSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
sock‘Num
) {

25  
Ãw
 
	`TCPSŒ—mSšk
(
’v
, 
sock‘Num
);

26 
	}
}

28 
	gTCPSŒ—mSšk
::
	$TCPSŒ—mSšk
(
U§geEnvœÚm’t
& 
’v
, 
sock‘Num
)

29 : 
	`MedŸSšk
(
’v
),

30 
	`fUnwr™‹nBy‹sS¹
(0), 
	`fUnwr™‹nBy‹sEnd
(0),

31 
	`fIÅutSourûIsO³n
(
F®£
), 
	`fOuutSock‘IsWr™abË
(
True
),

32 
	$fOuutSock‘Num
(
sock‘Num
) {

33 
	`ignÜeSigPeOnSock‘
(
sock‘Num
);

34 
	}
}

36 
	gTCPSŒ—mSšk
::~
	$TCPSŒ—mSšk
() {

38 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fOuutSock‘Num
);

39 
	}
}

41 
BoŞ—n
 
	gTCPSŒ—mSšk
::
	$cÚtšuePÏyšg
() {

42 
fIÅutSourûIsO³n
 = 
fSourû
 !ğ
NULL
;

43 
	`´oûssBufãr
();

45  
True
;

46 
	}
}

48 
	#TCP_STREAM_SINK_MIN_READ_SIZE
 1000

	)

50 
	gTCPSŒ—mSšk
::
	$´oûssBufãr
() {

52 ià(
fOuutSock‘IsWr™abË
 && 
	`numUnwr™‹nBy‹s
() > 0) {

53 
numBy‹sWr™‹n


54 ğ
	`£nd
(
fOuutSock‘Num
, (cÚ¡ *)&
fBufãr
[
fUnwr™‹nBy‹sS¹
], 
	`numUnwr™‹nBy‹s
(), 0);

55 ià(
numBy‹sWr™‹n
 < ()
	`numUnwr™‹nBy‹s
()) {

57 
fOuutSock‘IsWr™abË
 = 
F®£
;

58 ià(
	`’vœ
().
	`g‘E¼no
(è!ğ
EPIPE
) {

59 
	`’vœ
().
	`skScheduËr
().
	`£tBackgroundHªdlšg
(
fOuutSock‘Num
, 
SOCKET_WRITABLE
, 
sock‘Wr™abËHªdËr
, 
this
);

62 ià(
numBy‹sWr™‹n
 > 0) {

64 
fUnwr™‹nBy‹sS¹
 +ğ
numBy‹sWr™‹n
;

65 ià(
fUnwr™‹nBy‹sS¹
 > 
fUnwr™‹nBy‹sEnd
) fUnwrittenBytesStart = fUnwrittenBytesEnd;

66 ià(
fUnwr™‹nBy‹sS¹
 =ğ
fUnwr™‹nBy‹sEnd
 && (!
fIÅutSourûIsO³n
 || !
fSourû
->
	`isCu¼’yAwa™šgD©a
())) {

67 
fUnwr™‹nBy‹sS¹
 = 
fUnwr™‹nBy‹sEnd
 = 0;

73 ià(
fIÅutSourûIsO³n
 && 
	`ä“BufãrS·û
(è>ğ
TCP_STREAM_SINK_MIN_READ_SIZE
 && !
fSourû
->
	`isCu¼’yAwa™šgD©a
()) {

74 
fSourû
->
	`g‘NextF¿me
(&
fBufãr
[
fUnwr™‹nBy‹sEnd
], 
	`ä“BufãrS·û
(), 
aá”G‘tšgF¿me
, 
this
, 
ourOnSourûClosu»
,his);

75 } ià(!
fIÅutSourûIsO³n
 && 
	`numUnwr™‹nBy‹s
() == 0) {

77 
	`ÚSourûClosu»
();

79 
	}
}

81 
	gTCPSŒ—mSšk
::
	$sock‘Wr™abËHªdËr
(* 
ş›ÁD©a
, ) {

82 
TCPSŒ—mSšk
* 
sšk
 = (TCPSŒ—mSšk*)
ş›ÁD©a
;

83 
sšk
->
	`sock‘Wr™abËHªdËr1
();

84 
	}
}

86 
	gTCPSŒ—mSšk
::
	$sock‘Wr™abËHªdËr1
() {

87 
	`’vœ
().
	`skScheduËr
().
	`di§bËBackgroundHªdlšg
(
fOuutSock‘Num
);

89 
fOuutSock‘IsWr™abË
 = 
True
;

90 
	`´oûssBufãr
();

91 
	}
}

93 
	gTCPSŒ—mSšk
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
, 
numTrunÿ‹dBy‹s
,

94 
timev®
 , ) {

95 
TCPSŒ—mSšk
* 
sšk
 = (TCPSŒ—mSšk*)
ş›ÁD©a
;

96 
sšk
->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
);

97 
	}
}

99 
	gTCPSŒ—mSšk
::
	$aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
) {

100 ià(
numTrunÿ‹dBy‹s
 > 0) {

101 
	`’vœ
() << "TCPStreamSink::afterGettingFrame(): The input frame data wasoo†arge for our buffer. "

102 << 
numTrunÿ‹dBy‹s


105 
fUnwr™‹nBy‹sEnd
 +ğ
äameSize
;

106 
	`´oûssBufãr
();

107 
	}
}

109 
	gTCPSŒ—mSšk
::
	$ourOnSourûClosu»
(* 
ş›ÁD©a
) {

110 
TCPSŒ—mSšk
* 
sšk
 = (TCPSŒ—mSšk*)
ş›ÁD©a
;

111 
sšk
->
	`ourOnSourûClosu»1
();

112 
	}
}

114 
	gTCPSŒ—mSšk
::
	$ourOnSourûClosu»1
() {

116 
fIÅutSourûIsO³n
 = 
F®£
;

117 
	`´oûssBufãr
();

118 
	}
}

	@liveMedia/TextRTPSink.cpp

21 
	~"TextRTPSšk.hh
"

23 
	gTextRTPSšk
::
	$TextRTPSšk
(
U§geEnvœÚm’t
& 
’v
,

24 
Groupsock
* 
¹pgs
, 
¹pPaylßdTy³
,

25 
¹pTime¡ampF»qu’cy
,

26 cÚ¡* 
¹pPaylßdFÜm©Name
)

27 : 
	$MuÉiF¿medRTPSšk
(
’v
, 
¹pgs
, 
¹pPaylßdTy³
, 
¹pTime¡ampF»qu’cy
,

28 
¹pPaylßdFÜm©Name
) {

29 
	}
}

31 
	gTextRTPSšk
::~
	$TextRTPSšk
() {

32 
	}
}

34 cÚ¡* 
TextRTPSšk
::
	$sdpMedŸTy³
() const {

36 
	}
}

	@liveMedia/TheoraVideoRTPSink.cpp

21 
	~"TheÜaVideoRTPSšk.hh
"

22 
	~"Ba£64.hh
"

23 
	~"VÜbisAudioRTPSourû.hh
"

24 
	~"VÜbisAudioRTPSšk.hh
"

26 
TheÜaVideoRTPSšk
* 
	gTheÜaVideoRTPSšk


27 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
u_št8_t
 
¹pPaylßdFÜm©
,

28 
u_št8_t
* 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

29 
u_št8_t
* 
comm’tH—d”
, 
comm’tH—d”Size
,

30 
u_št8_t
* 
£tupH—d”
, 
£tupH—d”Size
,

31 
u_št32_t
 
id’tF›ld
) {

32  
Ãw
 
	`TheÜaVideoRTPSšk
(
’v
, 
RTPgs
,

33 
¹pPaylßdFÜm©
,

34 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

35 
comm’tH—d”
, 
comm’tH—d”Size
,

36 
£tupH—d”
, 
£tupH—d”Size
, 
id’tF›ld
);

37 
	}
}

39 
TheÜaVideoRTPSšk
* 
	gTheÜaVideoRTPSšk


40 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
u_št8_t
 
¹pPaylßdFÜm©
,

41 cÚ¡* 
cÚfigSŒ
) {

43 
u_št8_t
* 
id’tifiÿtiÚH—d”
; 
id’tifiÿtiÚH—d”Size
;

44 
u_št8_t
* 
comm’tH—d”
; 
comm’tH—d”Size
;

45 
u_št8_t
* 
£tupH—d”
; 
£tupH—d”Size
;

46 
u_št32_t
 
id’tF›ld
;

48 
	`·r£VÜbisOrTheÜaCÚfigSŒ
(
cÚfigSŒ
,

49 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

50 
comm’tH—d”
, 
comm’tH—d”Size
,

51 
£tupH—d”
, 
£tupH—d”Size
,

52 
id’tF›ld
);

54 
TheÜaVideoRTPSšk
* 
»suÉSšk


55 ğ
Ãw
 
	`TheÜaVideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

56 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

57 
comm’tH—d”
, 
comm’tH—d”Size
,

58 
£tupH—d”
, 
£tupH—d”Size
,

59 
id’tF›ld
);

60 
d–‘e
[] 
id’tifiÿtiÚH—d”
; d–‘e[] 
comm’tH—d”
; d–‘e[] 
£tupH—d”
;

62  
»suÉSšk
;

63 
	}
}

65 
	gTheÜaVideoRTPSšk


66 ::
	$TheÜaVideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
u_št8_t
 
¹pPaylßdFÜm©
,

67 
u_št8_t
* 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

68 
u_št8_t
* 
comm’tH—d”
, 
comm’tH—d”Size
,

69 
u_št8_t
* 
£tupH—d”
, 
£tupH—d”Size
,

70 
u_št32_t
 
id’tF›ld
)

71 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 90000, "THEORA"),

72 
	`fId’t
(
id’tF›ld
), 
	$fFmSDPLše
(
NULL
) {

73 cÚ¡ *
pf_to_¡r
[] = {

80 
width
 = 1280;

81 
height
 = 720;

82 
pf
 = 0;

83 ià(
id’tifiÿtiÚH—d”Size
 >= 42) {

86 
u_št8_t
* 
p
 = 
id’tifiÿtiÚH—d”
;

87 
width
 = (
p
[14]<<16)|(p[15]<<8)|p[16];

88 
height
 = (
p
[17]<<16)|(p[18]<<8)|p[19];

89 
pf
 = (
p
[41]&0x18)>>3;

90 
nomš®B™¿‹
 = (
p
[37]<<16)|(p[38]<<8)|p[39];

91 ià(
nomš®B™¿‹
 > 0è
	`e¡im©edB™¿‹
() =‚ominalBitrate/1000;

95 * 
ba£64PackedH—d”s


96 ğ
	`g’”©eVÜbisOrTheÜaCÚfigSŒ
(
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

97 
comm’tH—d”
, 
comm’tH—d”Size
,

98 
£tupH—d”
, 
£tupH—d”Size
,

99 
id’tF›ld
);

100 ià(
ba£64PackedH—d”s
 =ğ
NULL
) ;

103 
fmSDPLšeMaxSize
 = 200 + 
	`¡¾’
(
ba£64PackedH—d”s
);

104 
fFmSDPLše
 = 
Ãw
 [
fmSDPLšeMaxSize
];

105 
	`¥rštf
(
fFmSDPLše
, "a=fm:%d sam¶šg=%s;width=%u;height=%u;d–iv”y-m‘hod=out_bªd/¹¥;cÚfigu¿tiÚ=%s\r\n", 
	`¹pPaylßdTy³
(), 
pf_to_¡r
[
pf
], 
width
, 
height
, 
ba£64PackedH—d”s
);

106 
d–‘e
[] 
ba£64PackedH—d”s
;

107 
	}
}

109 
	gTheÜaVideoRTPSšk
::~
	$TheÜaVideoRTPSšk
() {

110 
d–‘e
[] 
fFmSDPLše
;

111 
	}
}

113 cÚ¡* 
	gTheÜaVideoRTPSšk
::
	$auxSDPLše
() {

114  
fFmSDPLše
;

115 
	}
}

117 
	gTheÜaVideoRTPSšk


118 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

119 * 
äameS¹
,

120 
numBy‹sInF¿me
,

121 
timev®
 
äameP»£Á©iÚTime
,

122 
numRemaššgBy‹s
) {

124 
u_št8_t
 
h—d”
[6];

127 
h—d”
[0] = 
fId’t
>>16; header[1] = fIdent>>8; header[2] = fIdent;

130 
u_št8_t
 
F
;

131 ià(
numRemaššgBy‹s
 > 0) {

132 ià(
äagm’tiÚOff£t
 > 0) {

133 
F
 = 2<<6;

135 
F
 = 1<<6;

138 ià(
äagm’tiÚOff£t
 > 0) {

139 
F
 = 3<<6;

141 
F
 = 0<<6;

144 
u_št8_t
 cÚ¡ 
TDT
 = 0<<4;

145 
u_št8_t
 
numPkts
 = 
F
 =ğ0 ? (
	`numF¿mesU£dSoF¬
() + 1): 0;

146 
h—d”
[3] = 
F
|
TDT
|
numPkts
;

150 
h—d”
[4] = 
numBy‹sInF¿me
 >>8;

151 
h—d”
[5] = 
numBy‹sInF¿me
;

152 
	`£tS³cŸlH—d”By‹s
(
h—d”
, (header));

154 ià(
numRemaššgBy‹s
 == 0) {

157 
	`£tM¬k”B™
();

162 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

163 
äameS¹
, 
numBy‹sInF¿me
,

164 
äameP»£Á©iÚTime
,

165 
numRemaššgBy‹s
);

166 
	}
}

168 
BoŞ—n
 
	gTheÜaVideoRTPSšk
::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

171  
F®£
;

172 
	}
}

174 
	gTheÜaVideoRTPSšk
::
	$¥ecŸlH—d”Size
() const {

176 
	}
}

	@liveMedia/TheoraVideoRTPSource.cpp

21 
	~"TheÜaVideoRTPSourû.hh
"

25 şas 
	cTheÜaBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

26 
public
:

27 
TheÜaBufã»dPack‘
();

28 
	mvœtu®
 ~
TheÜaBufã»dPack‘
();

30 
	m´iv©e
:

31 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

32 
d©aSize
);

35 şas 
	cTheÜaBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

36 
´iv©e
:

37 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

43 
TheÜaVideoRTPSourû
*

44 
	gTheÜaVideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

45 
¹pPaylßdFÜm©
) {

46  
Ãw
 
	`TheÜaVideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

47 
	}
}

49 
	gTheÜaVideoRTPSourû


50 ::
	$TheÜaVideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

51 
¹pPaylßdFÜm©
)

52 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 90000,

53 
Ãw
 
TheÜaBufã»dPack‘FaùÜy
),

54 
	$fCurPack‘Id’t
(0) {

55 
	}
}

57 
	gTheÜaVideoRTPSourû
::~
	$TheÜaVideoRTPSourû
() {

58 
	}
}

60 
BoŞ—n
 
TheÜaVideoRTPSourû


61 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

62 & 
»suÉS³cŸlH—d”Size
) {

63 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

64 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

66 
»suÉS³cŸlH—d”Size
 = 4;

67 ià(
·ck‘Size
 < 
»suÉS³cŸlH—d”Size
è 
F®£
;

70 
fCurPack‘Id’t
 = (
h—d”S¹
[0]<<16) | (headerStart[1]<<8) | headerStart[2];

74 ià((
h—d”S¹
[3]&0x30è=ğ0x30è 
F®£
;

76 
u_št8_t
 
F
 = 
h—d”S¹
[3]>>6;

77 
fCu¼’tPack‘BegšsF¿me
 = 
F
 <= 1;

78 
fCu¼’tPack‘Com¶‘esF¿me
 = 
F
 == 0 || F == 3;

80  
True
;

81 
	}
}

83 cÚ¡* 
	gTheÜaVideoRTPSourû
::
	$MIMEty³
() const {

85 
	}
}

90 
	gTheÜaBufã»dPack‘
::
	$TheÜaBufã»dPack‘
() {

91 
	}
}

93 
TheÜaBufã»dPack‘
::~
	$TheÜaBufã»dPack‘
() {

94 
	}
}

96 
TheÜaBufã»dPack‘


97 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

98 ià(
d©aSize
 < 2) {

100  
d©aSize
;

103 
äameSize
 = (
äamePŒ
[0]<<8) | framePtr[1];

104 
äamePŒ
 += 2;

105 ià(
äameSize
 > 
d©aSize
 - 2)  dataSize - 2;

107  
äameSize
;

108 
	}
}

110 
Bufã»dPack‘
* 
	gTheÜaBufã»dPack‘FaùÜy


111 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* ) {

112  
Ãw
 
	`TheÜaBufã»dPack‘
();

113 
	}
}

	@liveMedia/VP8VideoRTPSink.cpp

21 
	~"VP8VideoRTPSšk.hh
"

23 
	gVP8VideoRTPSšk


24 ::
	$VP8VideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
)

25 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 90000, "VP8") {

26 
	}
}

28 
	gVP8VideoRTPSšk
::~
	$VP8VideoRTPSšk
() {

29 
	}
}

31 
VP8VideoRTPSšk
*

32 
VP8VideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
) {

33  
Ãw
 
	`VP8VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

34 
	}
}

36 
BoŞ—n
 
	gVP8VideoRTPSšk


37 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

40  
F®£
;

41 
	}
}

43 
	gVP8VideoRTPSšk


44 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

47 
timev®
 
äameP»£Á©iÚTime
,

48 
numRemaššgBy‹s
) {

50 
u_št8_t
 
vp8PaylßdDesütÜ
 = 
äagm’tiÚOff£t
 == 0 ? 0x10 : 0x00;

52 
	`£tS³cŸlH—d”By‹s
(&
vp8PaylßdDesütÜ
, 1);

54 ià(
numRemaššgBy‹s
 == 0) {

57 
	`£tM¬k”B™
();

61 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

62 
	}
}

65 
	gVP8VideoRTPSšk
::
	$¥ecŸlH—d”Size
() const {

68 
	}
}

	@liveMedia/VP8VideoRTPSource.cpp

21 
	~"VP8VideoRTPSourû.hh
"

23 
VP8VideoRTPSourû
*

24 
	gVP8VideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
¹pTime¡ampF»qu’cy
) {

27  
Ãw
 
	`VP8VideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

28 
¹pTime¡ampF»qu’cy
);

29 
	}
}

31 
	gVP8VideoRTPSourû


32 ::
	$VP8VideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

33 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
)

35 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

36 
	}
}

38 
	gVP8VideoRTPSourû
::~
	$VP8VideoRTPSourû
() {

39 
	}
}

41 
	#šüH—d”
 dØ{ ++
»suÉS³cŸlH—d”Size
; ++
h—d”S¹
; ià(--
·ck‘Size
 =ğ0è 
F®£
; } 0)

	)

43 
BoŞ—n
 
	gVP8VideoRTPSourû


44 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

45 & 
»suÉS³cŸlH—d”Size
) {

46 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

47 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

50 ià(
·ck‘Size
 =ğ0è 
F®£
;

51 
»suÉS³cŸlH—d”Size
 = 1;

53 
u_št8_t
 cÚ¡ 
by‹1
 = *
h—d”S¹
;

54 
BoŞ—n
 cÚ¡ 
X
 = (
by‹1
&0x80) != 0;

55 
BoŞ—n
 cÚ¡ 
S
 = (
by‹1
&0x10) != 0;

56 
u_št8_t
 cÚ¡ 
P¬tID
 = 
by‹1
&0x0F;

58 
fCu¼’tPack‘BegšsF¿me
 = 
S
 && 
P¬tID
 == 0;

59 
fCu¼’tPack‘Com¶‘esF¿me
 = 
·ck‘
->
	`¹pM¬k”B™
();

61 ià(
X
) {

62 
šüH—d”
;

64 
u_št8_t
 cÚ¡ 
by‹2
 = *
h—d”S¹
;

65 
BoŞ—n
 cÚ¡ 
I
 = (
by‹2
&0x80) != 0;

66 
BoŞ—n
 cÚ¡ 
L
 = (
by‹2
&0x40) != 0;

67 
BoŞ—n
 cÚ¡ 
T
 = (
by‹2
&0x20) != 0;

68 
BoŞ—n
 cÚ¡ 
K
 = (
by‹2
&0x10) != 0;

70 ià(
I
) {

71 
šüH—d”
;

72 ià((*
h—d”S¹
)&0x80) {

73 
šüH—d”
;

77 ià(
L
è
šüH—d”
;

78 ià(
T
||
K
è
šüH—d”
;

81  
True
;

82 
	}
}

84 cÚ¡* 
	gVP8VideoRTPSourû
::
	$MIMEty³
() const {

86 
	}
}

	@liveMedia/VP9VideoRTPSink.cpp

21 
	~"VP9VideoRTPSšk.hh
"

23 
	gVP9VideoRTPSšk


24 ::
	$VP9VideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
)

25 : 
	`VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 90000, "VP9") {

26 
	}
}

28 
	gVP9VideoRTPSšk
::~
	$VP9VideoRTPSšk
() {

29 
	}
}

31 
VP9VideoRTPSšk
*

32 
VP9VideoRTPSšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
¹pPaylßdFÜm©
) {

33  
Ãw
 
	`VP9VideoRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
);

34 
	}
}

36 
BoŞ—n
 
	gVP9VideoRTPSšk


37 ::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

40  
F®£
;

41 
	}
}

43 
	gVP9VideoRTPSšk


44 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

47 
timev®
 
äameP»£Á©iÚTime
,

48 
numRemaššgBy‹s
) {

50 
u_št8_t
 
vp9PaylßdDesütÜ
 = 
äagm’tiÚOff£t
 == 0 ? 0x10 : 0x00;

53 ià(
numRemaššgBy‹s
 == 0) {

56 
vp9PaylßdDesütÜ
 |= 0x08;

58 
	`£tM¬k”B™
();

61 
	`£tS³cŸlH—d”By‹s
(&
vp9PaylßdDesütÜ
, 1);

64 
	`£tTime¡amp
(
äameP»£Á©iÚTime
);

65 
	}
}

68 
	gVP9VideoRTPSšk
::
	$¥ecŸlH—d”Size
() const {

71 
	}
}

	@liveMedia/VP9VideoRTPSource.cpp

21 
	~"VP9VideoRTPSourû.hh
"

23 
VP9VideoRTPSourû
*

24 
	gVP9VideoRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

25 
¹pPaylßdFÜm©
,

26 
¹pTime¡ampF»qu’cy
) {

27  
Ãw
 
	`VP9VideoRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
,

28 
¹pTime¡ampF»qu’cy
);

29 
	}
}

31 
	gVP9VideoRTPSourû


32 ::
	$VP9VideoRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

33 
¹pPaylßdFÜm©
,

34 
¹pTime¡ampF»qu’cy
)

35 : 
	$MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
) {

36 
	}
}

38 
	gVP9VideoRTPSourû
::~
	$VP9VideoRTPSourû
() {

39 
	}
}

41 
	#šüH—d”
 dØ{ ++
»suÉS³cŸlH—d”Size
; ++
h—d”S¹
; ià(--
·ck‘Size
 =ğ0è 
F®£
; } 0)

	)

43 
BoŞ—n
 
	gVP9VideoRTPSourû


44 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

45 & 
»suÉS³cŸlH—d”Size
) {

46 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

47 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

50 ià(
·ck‘Size
 =ğ0è 
F®£
;

51 
»suÉS³cŸlH—d”Size
 = 1;

53 
u_št8_t
 cÚ¡ 
by‹1
 = *
h—d”S¹
;

54 
BoŞ—n
 cÚ¡ 
I
 = (
by‹1
&0x80) != 0;

55 
BoŞ—n
 cÚ¡ 
L
 = (
by‹1
&0x40) != 0;

56 
BoŞ—n
 cÚ¡ 
F
 = (
by‹1
&0x20) != 0;

57 
BoŞ—n
 cÚ¡ 
B
 = (
by‹1
&0x10) != 0;

58 
BoŞ—n
 cÚ¡ 
E
 = (
by‹1
&0x08) != 0;

59 
BoŞ—n
 cÚ¡ 
V
 = (
by‹1
&0x04) != 0;

60 
BoŞ—n
 cÚ¡ 
U
 = (
by‹1
&0x02) != 0;

62 
fCu¼’tPack‘BegšsF¿me
 = 
B
;

63 
fCu¼’tPack‘Com¶‘esF¿me
 = 
E
;

66 ià(
I
) {

67 
šüH—d”
;

68 
BoŞ—n
 cÚ¡ 
M
 = ((*
h—d”S¹
)&0x80) != 0;

69 ià(
M
è
šüH—d”
;

72 ià(
L
) {

73 
šüH—d”
;

74 ià(
F
) {

75 
šüH—d”
;

76 
R
 = (*
h—d”S¹
)&0x03;

77 
R
-- > 0) {

78 
šüH—d”
;

79 
BoŞ—n
 cÚ¡ 
X
 = ((*
h—d”S¹
)&0x10) != 0;

80 ià(
X
è
šüH—d”
;

85 ià(
V
) {

86 
šüH—d”
;

87 
·‰”nL’gth
 = *
h—d”S¹
;

88 
·‰”nL’gth
-- > 0) {

89 
šüH—d”
;

90 
R
 = (*
h—d”S¹
)&0x03;

91 
R
-- > 0) {

92 
šüH—d”
;

93 
BoŞ—n
 cÚ¡ 
X
 = ((*
h—d”S¹
)&0x10) != 0;

94 ià(
X
è
šüH—d”
;

99 ià(
U
) {

100  
F®£
;

103  
True
;

104 
	}
}

106 cÚ¡* 
	gVP9VideoRTPSourû
::
	$MIMEty³
() const {

108 
	}
}

	@liveMedia/VideoRTPSink.cpp

21 
	~"VideoRTPSšk.hh
"

23 
	gVideoRTPSšk
::
	$VideoRTPSšk
(
U§geEnvœÚm’t
& 
’v
,

24 
Groupsock
* 
¹pgs
, 
¹pPaylßdTy³
,

25 
¹pTime¡ampF»qu’cy
,

26 cÚ¡* 
¹pPaylßdFÜm©Name
)

27 : 
	$MuÉiF¿medRTPSšk
(
’v
, 
¹pgs
, 
¹pPaylßdTy³
, 
¹pTime¡ampF»qu’cy
,

28 
¹pPaylßdFÜm©Name
) {

29 
	}
}

31 
	gVideoRTPSšk
::~
	$VideoRTPSšk
() {

32 
	}
}

34 cÚ¡* 
VideoRTPSšk
::
	$sdpMedŸTy³
() const {

36 
	}
}

	@liveMedia/VorbisAudioRTPSink.cpp

21 
	~"VÜbisAudioRTPSšk.hh
"

22 
	~"Ba£64.hh
"

23 
	~"VÜbisAudioRTPSourû.hh
"

25 
VÜbisAudioRTPSšk
* 
	gVÜbisAudioRTPSšk


26 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

27 
u_št8_t
 
¹pPaylßdFÜm©
, 
u_št32_t
 
¹pTime¡ampF»qu’cy
, 
numChªÃls
,

28 
u_št8_t
* 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

29 
u_št8_t
* 
comm’tH—d”
, 
comm’tH—d”Size
,

30 
u_št8_t
* 
£tupH—d”
, 
£tupH—d”Size
,

31 
u_št32_t
 
id’tF›ld
) {

32  
Ãw
 
	`VÜbisAudioRTPSšk
(
’v
, 
RTPgs
,

33 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
, 
numChªÃls
,

34 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

35 
comm’tH—d”
, 
comm’tH—d”Size
,

36 
£tupH—d”
, 
£tupH—d”Size
,

37 
id’tF›ld
);

38 
	}
}

40 
VÜbisAudioRTPSšk
* 
	gVÜbisAudioRTPSšk


41 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,
u_št8_t
 
¹pPaylßdFÜm©
,

42 
u_št32_t
 
¹pTime¡ampF»qu’cy
, 
numChªÃls
,

43 cÚ¡* 
cÚfigSŒ
) {

45 
u_št8_t
* 
id’tifiÿtiÚH—d”
; 
id’tifiÿtiÚH—d”Size
;

46 
u_št8_t
* 
comm’tH—d”
; 
comm’tH—d”Size
;

47 
u_št8_t
* 
£tupH—d”
; 
£tupH—d”Size
;

48 
u_št32_t
 
id’tF›ld
;

50 
	`·r£VÜbisOrTheÜaCÚfigSŒ
(
cÚfigSŒ
,

51 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

52 
comm’tH—d”
, 
comm’tH—d”Size
,

53 
£tupH—d”
, 
£tupH—d”Size
,

54 
id’tF›ld
);

56 
VÜbisAudioRTPSšk
* 
»suÉSšk


57 ğ
Ãw
 
	`VÜbisAudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
, 
numChªÃls
,

58 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

59 
comm’tH—d”
, 
comm’tH—d”Size
,

60 
£tupH—d”
, 
£tupH—d”Size
,

61 
id’tF›ld
);

62 
d–‘e
[] 
id’tifiÿtiÚH—d”
; d–‘e[] 
comm’tH—d”
; d–‘e[] 
£tupH—d”
;

64  
»suÉSšk
;

65 
	}
}

67 
	gVÜbisAudioRTPSšk


68 ::
	$VÜbisAudioRTPSšk
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
, 
u_št8_t
 
¹pPaylßdFÜm©
,

69 
u_št32_t
 
¹pTime¡ampF»qu’cy
, 
numChªÃls
,

70 
u_št8_t
* 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

71 
u_št8_t
* 
comm’tH—d”
, 
comm’tH—d”Size
,

72 
u_št8_t
* 
£tupH—d”
, 
£tupH—d”Size
,

73 
u_št32_t
 
id’tF›ld
)

74 : 
	`AudioRTPSšk
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
, "VORBIS", 
numChªÃls
),

75 
	`fId’t
(
id’tF›ld
), 
	$fFmSDPLše
(
NULL
) {

76 ià(
id’tifiÿtiÚH—d”Size
 >= 28) {

78 
u_št32_t
 
v®
;

79 
u_št8_t
* 
p
;

81 
p
 = &
id’tifiÿtiÚH—d”
[16];

82 
v®
 = ((
p
[3]*256 +…[2])*256 +…[1])*256 +…[0];

83 
b™¿‹_maximum
 = ()
v®
;

84 ià(
b™¿‹_maximum
 < 0) bitrate_maximum = 0;

86 
p
 = &
id’tifiÿtiÚH—d”
[20];

87 
v®
 = ((
p
[3]*256 +…[2])*256 +…[1])*256 +…[0];

88 
b™¿‹_nomš®
 = ()
v®
;

89 ià(
b™¿‹_nomš®
 < 0) bitrate_nominal = 0;

91 
p
 = &
id’tifiÿtiÚH—d”
[24];

92 
v®
 = ((
p
[3]*256 +…[2])*256 +…[1])*256 +…[0];

93 
b™¿‹_mšimum
 = ()
v®
;

94 ià(
b™¿‹_mšimum
 < 0) bitrate_minimum = 0;

96 
b™¿‹


97 ğ
b™¿‹_nomš®
 > 0 ? bitrate_nominal

98 : 
b™¿‹_maximum
 > 0 ? bitrate_maximum

99 : 
b™¿‹_mšimum
 > 0 ? bitrate_minimum : 0;

100 ià(
b™¿‹
 > 0è
	`e¡im©edB™¿‹
() = (()bitrate)/1000;

104 * 
ba£64PackedH—d”s


105 ğ
	`g’”©eVÜbisOrTheÜaCÚfigSŒ
(
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

106 
comm’tH—d”
, 
comm’tH—d”Size
,

107 
£tupH—d”
, 
£tupH—d”Size
,

108 
id’tF›ld
);

109 ià(
ba£64PackedH—d”s
 =ğ
NULL
) ;

112 
fmSDPLšeMaxSize
 = 50 + 
	`¡¾’
(
ba£64PackedH—d”s
);

113 
fFmSDPLše
 = 
Ãw
 [
fmSDPLšeMaxSize
];

114 
	`¥rštf
(
fFmSDPLše
, "a=fm:%d cÚfigu¿tiÚ=%s\r\n", 
	`¹pPaylßdTy³
(), 
ba£64PackedH—d”s
);

115 
d–‘e
[] 
ba£64PackedH—d”s
;

116 
	}
}

118 
	gVÜbisAudioRTPSšk
::~
	$VÜbisAudioRTPSšk
() {

119 
d–‘e
[] 
fFmSDPLše
;

120 
	}
}

122 cÚ¡* 
	gVÜbisAudioRTPSšk
::
	$auxSDPLše
() {

123  
fFmSDPLše
;

124 
	}
}

126 
	gVÜbisAudioRTPSšk


127 ::
	$doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

128 * 
äameS¹
,

129 
numBy‹sInF¿me
,

130 
timev®
 
äameP»£Á©iÚTime
,

131 
numRemaššgBy‹s
) {

133 
u_št8_t
 
h—d”
[4];

136 
h—d”
[0] = 
fId’t
>>16; header[1] = fIdent>>8; header[2] = fIdent;

139 
u_št8_t
 
F
;

140 ià(
numRemaššgBy‹s
 > 0) {

141 ià(
äagm’tiÚOff£t
 > 0) {

142 
F
 = 2<<6;

144 
F
 = 1<<6;

147 ià(
äagm’tiÚOff£t
 > 0) {

148 
F
 = 3<<6;

150 
F
 = 0<<6;

153 
u_št8_t
 cÚ¡ 
VDT
 = 0<<4;

154 
u_št8_t
 
numPkts
 = 
F
 =ğ0 ? (
	`numF¿mesU£dSoF¬
() + 1): 0;

155 
h—d”
[3] = 
F
|
VDT
|
numPkts
;

157 
	`£tS³cŸlH—d”By‹s
(
h—d”
,  header);

160 
u_št8_t
 
äameS³cificH—d”
[2];

161 
äameS³cificH—d”
[0] = 
numBy‹sInF¿me
>>8;

162 
äameS³cificH—d”
[1] = 
numBy‹sInF¿me
;

163 
	`£tF¿meS³cificH—d”By‹s
(
äameS³cificH—d”
, 2);

167 
MuÉiF¿medRTPSšk
::
	`doS³cŸlF¿meHªdlšg
(
äagm’tiÚOff£t
,

168 
äameS¹
, 
numBy‹sInF¿me
,

169 
äameP»£Á©iÚTime
,

170 
numRemaššgBy‹s
);

171 
	}
}

173 
BoŞ—n
 
	gVÜbisAudioRTPSšk
::
	$äameCªAµ—rAá”Pack‘S¹
(const* ,

176  
	`numF¿mesU£dSoF¬
() <= 15;

177 
	}
}

179 
	gVÜbisAudioRTPSšk
::
	$¥ecŸlH—d”Size
() const {

181 
	}
}

183 
	gVÜbisAudioRTPSšk
::
	$äameS³cificH—d”Size
() const {

185 
	}
}

190 * 
	$g’”©eVÜbisOrTheÜaCÚfigSŒ
(
u_št8_t
* 
id’tifiÿtiÚH—d”
, 
id’tifiÿtiÚH—d”Size
,

191 
u_št8_t
* 
comm’tH—d”
, 
comm’tH—d”Size
,

192 
u_št8_t
* 
£tupH—d”
, 
£tupH—d”Size
,

193 
u_št32_t
 
id’tF›ld
) {

196 
numH—d”s
 = 0;

197 
sizeSize
[2];

198 
sizeSize
[0] = sizeSize[1] = 0;

199 ià(
id’tifiÿtiÚH—d”Size
 > 0) {

200 
sizeSize
[
numH—d”s
++] = 
id’tifiÿtiÚH—d”Size
 < 128 ? 1 : identificationHeaderSize < 16384 ? 2 : 3;

202 ià(
comm’tH—d”Size
 > 0) {

203 
sizeSize
[
numH—d”s
++] = 
comm’tH—d”Size
 < 128 ? 1 : commentHeaderSize < 16384 ? 2 : 3;

205 ià(
£tupH—d”Size
 > 0) {

206 ++
numH—d”s
;

208 
sizeSize
[1] = 0;

210 ià(
numH—d”s
 =ğ0è 
NULL
;

211 ià(
numH—d”s
 =ğ1è
sizeSize
[0] = 0;

214 
Ëngth
 = 
id’tifiÿtiÚH—d”Size
 + 
comm’tH—d”Size
 + 
£tupH—d”Size
;

216 ià(
Ëngth
 > ()0xFFFFè 
NULL
;

217 
·ckedH—d”sSize


222 + 
sizeSize
[0] + sizeSize[1]

223 + 
Ëngth
;

224 
u_št8_t
* 
·ckedH—d”s
 = 
Ãw
 u_št8_t[
·ckedH—d”sSize
];

225 ià(
·ckedH—d”s
 =ğ
NULL
)  NULL;

228 
u_št8_t
* 
p
 = 
·ckedH—d”s
;

229 *
p
++ = 0; *p++ = 0; *p++ = 0; *p++ = 1;

230 *
p
++ = 
id’tF›ld
>>16; *p++ = identField>>8; *p++ = identField;

231 *
p
++ = 
Ëngth
>>8; *p++ =†ength;

232 *
p
++ = 
numH—d”s
-1;

233 ià(
numH—d”s
 > 1) {

235 
Ëngth1
 = 
id’tifiÿtiÚH—d”Size
 > 0 ? id’tifiÿtiÚH—d”Siz: 
comm’tH—d”Size
;

236 ià(
Ëngth1
 >= 16384) {

237 *
p
++ = 0x80;

239 ià(
Ëngth1
 >= 128) {

240 *
p
++ = 0x80|((
Ëngth1
&0x3F80)>>7);

242 *
p
++ = 
Ëngth1
&0x7F;

244 ià(
numH—d”s
 > 2) {

246 
Ëngth2
 = 
comm’tH—d”Size
;

247 ià(
Ëngth2
 >= 16384) {

248 *
p
++ = 0x80;

250 ià(
Ëngth2
 >= 128) {

251 *
p
++ = 0x80|((
Ëngth2
&0x3F80)>>7);

253 *
p
++ = 
Ëngth2
&0x7F;

257 ià(
id’tifiÿtiÚH—d”
 !ğ
NULL
è
	`memmove
(
p
, id’tifiÿtiÚH—d”, 
id’tifiÿtiÚH—d”Size
);… += identificationHeaderSize;

258 ià(
comm’tH—d”
 !ğ
NULL
è
	`memmove
(
p
, comm’tH—d”, 
comm’tH—d”Size
);… += commentHeaderSize;

259 ià(
£tupH—d”
 !ğ
NULL
è
	`memmove
(
p
, s‘upH—d”, 
£tupH—d”Size
);

262 * 
ba£64PackedH—d”s
 = 
	`ba£64Encode
((cÚ¡*)
·ckedH—d”s
, 
·ckedH—d”sSize
);

263 
d–‘e
[] 
·ckedH—d”s
;

265  
ba£64PackedH—d”s
;

266 
	}
}

	@liveMedia/VorbisAudioRTPSource.cpp

21 
	~"VÜbisAudioRTPSourû.hh
"

22 
	~"Ba£64.hh
"

26 şas 
	cVÜbisBufã»dPack‘
: 
public
 
Bufã»dPack‘
 {

27 
public
:

28 
VÜbisBufã»dPack‘
();

29 
	mvœtu®
 ~
VÜbisBufã»dPack‘
();

31 
	m´iv©e
:

32 
vœtu®
 
ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
,

33 
d©aSize
);

36 şas 
	cVÜbisBufã»dPack‘FaùÜy
: 
public
 
Bufã»dPack‘FaùÜy
 {

37 
´iv©e
:

38 
vœtu®
 
Bufã»dPack‘
* 
ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* 
ourSourû
);

44 
VÜbisAudioRTPSourû
*

45 
	gVÜbisAudioRTPSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

46 
¹pPaylßdFÜm©
,

47 
¹pTime¡ampF»qu’cy
) {

48  
Ãw
 
	`VÜbisAudioRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
);

49 
	}
}

51 
	gVÜbisAudioRTPSourû


52 ::
	$VÜbisAudioRTPSourû
(
U§geEnvœÚm’t
& 
’v
, 
Groupsock
* 
RTPgs
,

53 
¹pPaylßdFÜm©
,

54 
¹pTime¡ampF»qu’cy
)

55 : 
	`MuÉiF¿medRTPSourû
(
’v
, 
RTPgs
, 
¹pPaylßdFÜm©
, 
¹pTime¡ampF»qu’cy
,

56 
Ãw
 
VÜbisBufã»dPack‘FaùÜy
),

57 
	$fCurPack‘Id’t
(0) {

58 
	}
}

60 
	gVÜbisAudioRTPSourû
::~
	$VÜbisAudioRTPSourû
() {

61 
	}
}

63 
BoŞ—n
 
VÜbisAudioRTPSourû


64 ::
	$´oûssS³cŸlH—d”
(
Bufã»dPack‘
* 
·ck‘
,

65 & 
»suÉS³cŸlH—d”Size
) {

66 * 
h—d”S¹
 = 
·ck‘
->
	`d©a
();

67 
·ck‘Size
 = 
·ck‘
->
	`d©aSize
();

69 
»suÉS³cŸlH—d”Size
 = 4;

70 ià(
·ck‘Size
 < 
»suÉS³cŸlH—d”Size
è 
F®£
;

73 
fCurPack‘Id’t
 = (
h—d”S¹
[0]<<16) | (headerStart[1]<<8) | headerStart[2];

77 ià((
h—d”S¹
[3]&0x30è=ğ0x30è 
F®£
;

79 
u_št8_t
 
F
 = 
h—d”S¹
[3]>>6;

80 
fCu¼’tPack‘BegšsF¿me
 = 
F
 <= 1;

81 
fCu¼’tPack‘Com¶‘esF¿me
 = 
F
 == 0 || F == 3;

83  
True
;

84 
	}
}

86 cÚ¡* 
	gVÜbisAudioRTPSourû
::
	$MIMEty³
() const {

88 
	}
}

93 
	gVÜbisBufã»dPack‘
::
	$VÜbisBufã»dPack‘
() {

94 
	}
}

96 
VÜbisBufã»dPack‘
::~
	$VÜbisBufã»dPack‘
() {

97 
	}
}

99 
VÜbisBufã»dPack‘


100 ::
	$ÃxtEnşo£dF¿meSize
(*& 
äamePŒ
, 
d©aSize
) {

101 ià(
d©aSize
 < 2) {

103  
d©aSize
;

106 
äameSize
 = (
äamePŒ
[0]<<8) | framePtr[1];

107 
äamePŒ
 += 2;

108 ià(
äameSize
 > 
d©aSize
 - 2)  dataSize - 2;

110  
äameSize
;

111 
	}
}

113 
Bufã»dPack‘
* 
	gVÜbisBufã»dPack‘FaùÜy


114 ::
	$ü—‹NewPack‘
(
MuÉiF¿medRTPSourû
* ) {

115  
Ãw
 
	`VÜbisBufã»dPack‘
();

116 
	}
}

121 
	#ADVANCE
(
n
èdØ{ 
p
 +ğÒ); 
»m
 -ğÒ); } 0)

	)

122 
	#GET_ENCODED_VAL
(
n
èdØ{ 
u_št8_t
 
by‹
;‚ = 0; dØ{ ià(
»m
 =ğ0è; by‹ = *
p
;‚ = (n*128è+ (by‹&0x7F); 
	`ADVANCE
(1); } by‹&0x80); } 0); iàÔem =ğ0è

	)

124 
	$·r£VÜbisOrTheÜaCÚfigSŒ
(cÚ¡* 
cÚfigSŒ
,

125 
u_št8_t
*& 
id’tifiÿtiÚHdr
, & 
id’tifiÿtiÚHdrSize
,

126 
u_št8_t
*& 
comm’tHdr
, & 
comm’tHdrSize
,

127 
u_št8_t
*& 
£tupHdr
, & 
£tupHdrSize
,

128 
u_št32_t
& 
id’tF›ld
) {

129 
id’tifiÿtiÚHdr
 = 
comm’tHdr
 = 
£tupHdr
 = 
NULL
;

130 
id’tifiÿtiÚHdrSize
 = 
comm’tHdrSize
 = 
£tupHdrSize
 = 0;

131 
id’tF›ld
 = 0;

134 
cÚfigD©aSize
;

135 
u_št8_t
* 
cÚfigD©a
 = 
	`ba£64Decode
(
cÚfigSŒ
, 
cÚfigD©aSize
);

136 
u_št8_t
* 
p
 = 
cÚfigD©a
;

137 
»m
 = 
cÚfigD©aSize
;

140 ià(
»m
 < 4) ;

141 
u_št32_t
 
numPackedH—d”s
 = (
p
[0]<<24)|Õ[1]<<16)|Õ[2]<<8)|p[3]; 
	`ADVANCE
(4);

142 ià(
numPackedH—d”s
 == 0) ;

145 ià(
»m
 < 3) ;

146 
id’tF›ld
 = (
p
[0]<<16)|Õ[1]<<8)|p[2]; 
	`ADVANCE
(3);

148 ià(
»m
 < 2) ;

149 
u_št16_t
 
Ëngth
 = (
p
[0]<<8)|p[1]; 
	`ADVANCE
(2);

151 
numH—d”s
;

152 
	`GET_ENCODED_VAL
(
numH—d”s
);

154 
BoŞ—n
 
sucûss
 = 
F®£
;

155 
i
 = 0; i < 
numH—d”s
+1 && i < 3; ++i) {

156 
sucûss
 = 
F®£
;

157 
h—d”Size
;

158 ià(
i
 < 
numH—d”s
) {

160 
	`GET_ENCODED_VAL
(
h—d”Size
);

161 ià(
h—d”Size
 > 
Ëngth
) ;

162 
Ëngth
 -ğ
h—d”Size
;

165 
h—d”Size
 = 
Ëngth
;

169 ià(
i
 == 0) {

170 
id’tifiÿtiÚHdrSize
 = 
h—d”Size
;

171 
id’tifiÿtiÚHdr
 = 
Ãw
 
u_št8_t
[
id’tifiÿtiÚHdrSize
];

172 } ià(
i
 == 1) {

173 
comm’tHdrSize
 = 
h—d”Size
;

174 
comm’tHdr
 = 
Ãw
 
u_št8_t
[
comm’tHdrSize
];

176 
£tupHdrSize
 = 
h—d”Size
;

177 
£tupHdr
 = 
Ãw
 
u_št8_t
[
£tupHdrSize
];

180 
sucûss
 = 
True
;

182 ià(!
sucûss
) ;

185 ià(
id’tifiÿtiÚHdr
 !ğ
NULL
) {

186 
	`memmove
(
id’tifiÿtiÚHdr
, 
p
, 
id’tifiÿtiÚHdrSize
); 
	`ADVANCE
(identificationHdrSize);

187 ià(
comm’tHdr
 !ğ
NULL
) {

188 
	`memmove
(
comm’tHdr
, 
p
, 
comm’tHdrSize
); 
	`ADVANCE
(commentHdrSize);

189 ià(
£tupHdr
 !ğ
NULL
) {

190 
	`memmove
(
£tupHdr
, 
p
, 
£tupHdrSize
); 
	`ADVANCE
(setupHdrSize);

196 
d–‘e
[] 
cÚfigD©a
;

197 
	}
}

	@liveMedia/WAVAudioFileServerMediaSubsession.cpp

22 
	~"WAVAudioFeS”v”MedŸSub£ssiÚ.hh
"

23 
	~"WAVAudioFeSourû.hh
"

24 
	~"uLawAudioF‹r.hh
"

25 
	~"Sim¶eRTPSšk.hh
"

27 
WAVAudioFeS”v”MedŸSub£ssiÚ
* 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


28 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
, 
BoŞ—n
 
»u£Fœ¡Sourû
,

29 
BoŞ—n
 
cÚv”tToULaw
) {

30  
Ãw
 
	`WAVAudioFeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
,

31 
»u£Fœ¡Sourû
, 
cÚv”tToULaw
);

32 
	}
}

34 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


35 ::
	$WAVAudioFeS”v”MedŸSub£ssiÚ
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
,

36 
BoŞ—n
 
»u£Fœ¡Sourû
, BoŞ—À
cÚv”tToULaw
)

37 : 
	`FeS”v”MedŸSub£ssiÚ
(
’v
, 
feName
, 
»u£Fœ¡Sourû
),

38 
	$fCÚv”tToULaw
(
cÚv”tToULaw
) {

39 
	}
}

41 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


42 ::~
	$WAVAudioFeS”v”MedŸSub£ssiÚ
() {

43 
	}
}

45 
WAVAudioFeS”v”MedŸSub£ssiÚ


46 ::
	$£ekSŒ—mSourû
(
F¿medSourû
* 
šputSourû
, & 
£ekNPT
, 
¡»amDu¿tiÚ
, 
u_št64_t
& 
numBy‹s
) {

47 
WAVAudioFeSourû
* 
wavSourû
;

48 ià(
fB™sP”Sam¶e
 > 8) {

50 
wavSourû
 = (
WAVAudioFeSourû
*)(((
F¿medF‹r
*)
šputSourû
)->
	`šputSourû
());

53 
wavSourû
 = (
WAVAudioFeSourû
*)
šputSourû
;

56 
£ekSam¶eNumb”
 = ()(
£ekNPT
*
fSam¶šgF»qu’cy
);

57 
£ekBy‹Numb”
 = 
£ekSam¶eNumb”
*((
fNumChªÃls
*
fB™sP”Sam¶e
)/8);

59 
wavSourû
->
	`£ekToPCMBy‹
(
£ekBy‹Numb”
);

61 
	`£tSŒ—mSourûDu¿tiÚ
(
šputSourû
, 
¡»amDu¿tiÚ
, 
numBy‹s
);

62 
	}
}

64 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


65 ::
	$£tSŒ—mSourûDu¿tiÚ
(
F¿medSourû
* 
šputSourû
, 
¡»amDu¿tiÚ
, 
u_št64_t
& 
numBy‹s
) {

66 
WAVAudioFeSourû
* 
wavSourû
;

67 ià(
fB™sP”Sam¶e
 > 8) {

69 
wavSourû
 = (
WAVAudioFeSourû
*)(((
F¿medF‹r
*)
šputSourû
)->
	`šputSourû
());

72 
wavSourû
 = (
WAVAudioFeSourû
*)
šputSourû
;

75 
numDu¿tiÚSam¶es
 = ()(
¡»amDu¿tiÚ
*
fSam¶šgF»qu’cy
);

76 
numDu¿tiÚBy‹s
 = 
numDu¿tiÚSam¶es
*((
fNumChªÃls
*
fB™sP”Sam¶e
)/8);

77 
numBy‹s
 = (
u_št64_t
)
numDu¿tiÚBy‹s
;

79 
wavSourû
->
	`lim™NumBy‹sToSŒ—m
(
numDu¿tiÚBy‹s
);

80 
	}
}

82 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


83 ::
	$£tSŒ—mSourûSÿË
(
F¿medSourû
* 
šputSourû
, 
sÿË
) {

84 
iSÿË
 = ()
sÿË
;

85 
WAVAudioFeSourû
* 
wavSourû
;

86 ià(
fB™sP”Sam¶e
 > 8) {

88 
wavSourû
 = (
WAVAudioFeSourû
*)(((
F¿medF‹r
*)
šputSourû
)->
	`šputSourû
());

91 
wavSourû
 = (
WAVAudioFeSourû
*)
šputSourû
;

94 
wavSourû
->
	`£tSÿËFaùÜ
(
iSÿË
);

95 
	}
}

97 
F¿medSourû
* 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


98 ::
	$ü—‹NewSŒ—mSourû
(, & 
e¡B™¿‹
) {

99 
F¿medSourû
* 
»suÉSourû
 = 
NULL
;

101 
WAVAudioFeSourû
* 
wavSourû
 = WAVAudioFeSourû::
	`ü—‹New
(
	`’vœ
(), 
fFeName
);

102 ià(
wavSourû
 =ğ
NULL
) ;

106 
fAudioFÜm©
 = 
wavSourû
->
	`g‘AudioFÜm©
();

107 
fB™sP”Sam¶e
 = 
wavSourû
->
	`b™sP”Sam¶e
();

109 ià(
fB™sP”Sam¶e
%4 != 0 || fBitsPerSample < 4 || fBitsPerSample > 24 || fBitsPerSample == 12) {

110 
	`’vœ
(è<< "ThšpuˆfcÚš " << 
fB™sP”Sam¶e
 << " bit-per-sample‡udio, which we don't handle\n";

113 
fSam¶šgF»qu’cy
 = 
wavSourû
->
	`§m¶šgF»qu’cy
();

114 
fNumChªÃls
 = 
wavSourû
->
	`numChªÃls
();

115 
b™sP”SecÚd
 = 
fSam¶šgF»qu’cy
*
fB™sP”Sam¶e
*
fNumChªÃls
;

117 
fFeDu¿tiÚ
 = ()((8.0*
wavSourû
->
	`numPCMBy‹s
())/(
fSam¶šgF»qu’cy
*
fNumChªÃls
*
fB™sP”Sam¶e
));

120 
»suÉSourû
 = 
wavSourû
;

121 ià(
fAudioFÜm©
 =ğ
WA_PCM
) {

122 ià(
fB™sP”Sam¶e
 == 16) {

124 ià(
fCÚv”tToULaw
) {

126 
»suÉSourû
 = 
uLawFromPCMAudioSourû
::
	`ü—‹New
(
	`’vœ
(), 
wavSourû
, 1 );

127 
b™sP”SecÚd
 /= 2;

130 
»suÉSourû
 = 
EndŸnSw­16
::
	`ü—‹New
(
	`’vœ
(), 
wavSourû
);

132 } ià(
fB™sP”Sam¶e
 == 20 || fBitsPerSample == 24) {

134 
»suÉSourû
 = 
EndŸnSw­24
::
	`ü—‹New
(
	`’vœ
(), 
wavSourû
);

138 
e¡B™¿‹
 = (
b™sP”SecÚd
+500)/1000;

139  
»suÉSourû
;

143 
Medium
::
	`şo£
(
»suÉSourû
);

144  
NULL
;

145 
	}
}

147 
RTPSšk
* 
	gWAVAudioFeS”v”MedŸSub£ssiÚ


148 ::
	$ü—‹NewRTPSšk
(
Groupsock
* 
¹pGroupsock
,

149 
¹pPaylßdTy³IfDyÇmic
,

150 
F¿medSourû
* ) {

152 cÚ¡* 
mimeTy³
;

153 
·ylßdFÜm©Code
 = 
¹pPaylßdTy³IfDyÇmic
;

154 ià(
fAudioFÜm©
 =ğ
WA_PCM
) {

155 ià(
fB™sP”Sam¶e
 == 16) {

156 ià(
fCÚv”tToULaw
) {

157 
mimeTy³
 = "PCMU";

158 ià(
fSam¶šgF»qu’cy
 =ğ8000 && 
fNumChªÃls
 == 1) {

159 
·ylßdFÜm©Code
 = 0;

162 
mimeTy³
 = "L16";

163 ià(
fSam¶šgF»qu’cy
 =ğ44100 && 
fNumChªÃls
 == 2) {

164 
·ylßdFÜm©Code
 = 10;

165 } ià(
fSam¶šgF»qu’cy
 =ğ44100 && 
fNumChªÃls
 == 1) {

166 
·ylßdFÜm©Code
 = 11;

169 } ià(
fB™sP”Sam¶e
 == 20) {

170 
mimeTy³
 = "L20";

171 } ià(
fB™sP”Sam¶e
 == 24) {

172 
mimeTy³
 = "L24";

174 
mimeTy³
 = "L8";

176 } ià(
fAudioFÜm©
 =ğ
WA_PCMU
) {

177 
mimeTy³
 = "PCMU";

178 ià(
fSam¶šgF»qu’cy
 =ğ8000 && 
fNumChªÃls
 == 1) {

179 
·ylßdFÜm©Code
 = 0;

181 } ià(
fAudioFÜm©
 =ğ
WA_PCMA
) {

182 
mimeTy³
 = "PCMA";

183 ià(
fSam¶šgF»qu’cy
 =ğ8000 && 
fNumChªÃls
 == 1) {

184 
·ylßdFÜm©Code
 = 8;

186 } ià(
fAudioFÜm©
 =ğ
WA_IMA_ADPCM
) {

187 
mimeTy³
 = "DVI4";

189 ià(
fNumChªÃls
 == 1) {

190 ià(
fSam¶šgF»qu’cy
 == 8000) {

191 
·ylßdFÜm©Code
 = 5;

192 } ià(
fSam¶šgF»qu’cy
 == 16000) {

193 
·ylßdFÜm©Code
 = 6;

194 } ià(
fSam¶šgF»qu’cy
 == 11025) {

195 
·ylßdFÜm©Code
 = 16;

196 } ià(
fSam¶šgF»qu’cy
 == 22050) {

197 
·ylßdFÜm©Code
 = 17;

204  
Sim¶eRTPSšk
::
	`ü—‹New
(
	`’vœ
(), 
¹pGroupsock
,

205 
·ylßdFÜm©Code
, 
fSam¶šgF»qu’cy
,

206 "audio", 
mimeTy³
, 
fNumChªÃls
);

210  
NULL
;

211 
	}
}

213 
	gWAVAudioFeS”v”MedŸSub£ssiÚ
::
	$‹¡SÿËFaùÜ
(& 
sÿË
) {

214 ià(
fFeDu¿tiÚ
 <= 0.0) {

217 
sÿË
 = 1;

220 
iSÿË
 = 
sÿË
 < 0.0 ? ()(scale - 0.5) : ()(scale + 0.5);

221 ià(
iSÿË
 == 0) iScale = 1;

222 
sÿË
 = ()
iSÿË
;

224 
	}
}

226 
	gWAVAudioFeS”v”MedŸSub£ssiÚ
::
	$du¿tiÚ
() const {

227  
fFeDu¿tiÚ
;

228 
	}
}

	@liveMedia/WAVAudioFileSource.cpp

21 
	~"WAVAudioFeSourû.hh
"

22 
	~"IÅutFe.hh
"

23 
	~"GroupsockH–³r.hh
"

27 
WAVAudioFeSourû
*

28 
	gWAVAudioFeSourû
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
feName
) {

30 
FILE
* 
fid
 = 
	`O³nIÅutFe
(
’v
, 
feName
);

31 ià(
fid
 =ğ
NULL
) ;

33 
WAVAudioFeSourû
* 
ÃwSourû
 = 
Ãw
 
	`WAVAudioFeSourû
(
’v
, 
fid
);

34 ià(
ÃwSourû
 !ğ
NULL
 &&‚ewSourû->
	`b™sP”Sam¶e
() == 0) {

36 
Medium
::
	`şo£
(
ÃwSourû
);

40 
ÃwSourû
->
fFeSize
 = ()
	`G‘FeSize
(
feName
, 
fid
);

42  
ÃwSourû
;

45  
NULL
;

46 
	}
}

48 
	gWAVAudioFeSourû
::
	$numPCMBy‹s
() const {

49 ià(
fFeSize
 < 
fWAVH—d”Size
)  0;

50  
fFeSize
 - 
fWAVH—d”Size
;

51 
	}
}

53 
	gWAVAudioFeSourû
::
	$£tSÿËFaùÜ
(
sÿË
) {

54 ià(!
fFidIsS“kabË
) ;

56 
fSÿËFaùÜ
 = 
sÿË
;

58 ià(
fSÿËFaùÜ
 < 0 && 
	`T–lFe64
(
fFid
) > 0) {

62 
by‹sP”Sam¶e
 = (
fNumChªÃls
*
fB™sP”Sam¶e
)/8;

63 ià(
by‹sP”Sam¶e
 == 0) bytesPerSample = 1;

64 
	`S“kFe64
(
fFid
, -
by‹sP”Sam¶e
, 
SEEK_CUR
);

66 
	}
}

68 
	gWAVAudioFeSourû
::
	$£ekToPCMBy‹
(
by‹Numb”
) {

69 
by‹Numb”
 +ğ
fWAVH—d”Size
;

70 ià(
by‹Numb”
 > 
fFeSize
) byteNumber = fFileSize;

72 
	`S“kFe64
(
fFid
, 
by‹Numb”
, 
SEEK_SET
);

73 
	}
}

75 
	gWAVAudioFeSourû
::
	$lim™NumBy‹sToSŒ—m
(
numBy‹sToSŒ—m
) {

76 
fNumBy‹sToSŒ—m
 = 
numBy‹sToSŒ—m
;

77 
fLim™NumBy‹sToSŒ—m
 = 
fNumBy‹sToSŒ—m
 > 0;

78 
	}
}

80 
	gWAVAudioFeSourû
::
	$g‘AudioFÜm©
() {

81  
fAudioFÜm©
;

82 
	}
}

85 
	#Ãxtc
 
	`fg‘c
(
fid
)

	)

87 
BoŞ—n
 
	$g‘4By‹s
(
FILE
* 
fid
, 
u_št32_t
& 
»suÉ
) {

88 
c0
, 
c1
, 
c2
, 
c3
;

89 ià((
c0
 = 
Ãxtc
è=ğ
EOF
 || (
c1
 =‚extc) == EOF ||

90 (
c2
 = 
Ãxtc
è=ğ
EOF
 || (
c3
 =‚extcè=ğEOFè 
F®£
;

91 
»suÉ
 = (
c3
<<24)|(
c2
<<16)|(
c1
<<8)|
c0
;

92  
True
;

93 
	}
}

95 
BoŞ—n
 
	$g‘2By‹s
(
FILE
* 
fid
, 
u_št16_t
& 
»suÉ
) {

96 
c0
, 
c1
;

97 ià((
c0
 = 
Ãxtc
è=ğ
EOF
 || (
c1
 =‚extcè=ğEOFè 
F®£
;

98 
»suÉ
 = (
c1
<<8)|
c0
;

99  
True
;

100 
	}
}

102 
BoŞ—n
 
	$skBy‹s
(
FILE
* 
fid
, 
num
) {

103 
num
-- > 0) {

104 ià(
Ãxtc
 =ğ
EOF
è 
F®£
;

106  
True
;

107 
	}
}

109 
	gWAVAudioFeSourû
::
	$WAVAudioFeSourû
(
U§geEnvœÚm’t
& 
’v
, 
FILE
* 
fid
)

110 : 
	`AudioIÅutDeviû
(
’v
, 0, 0, 0, 0) ,

111 
	`fFid
(
fid
), 
	`fFidIsS“kabË
(
F®£
), 
	`fLa¡PÏyTime
(0), 
	`fHaveS¹edR—dšg
(F®£), 
	`fWAVH—d”Size
(0), 
	`fFeSize
(0),

112 
	`fSÿËFaùÜ
(1), 
	`fLim™NumBy‹sToSŒ—m
(
F®£
), 
	`fNumBy‹sToSŒ—m
(0), 
	$fAudioFÜm©
(
WA_UNKNOWN
) {

119 
BoŞ—n
 
sucûss
 = 
F®£
;

122 ià(
Ãxtc
 != 'R' ||‚extc != 'I' ||‚extc != 'F' ||‚extc != 'F') ;

123 ià(!
	`skBy‹s
(
fid
, 4)) ;

124 ià(
Ãxtc
 != 'W' ||‚extc != 'A' ||‚extc != 'V' ||‚extc != 'E') ;

127 
u_št32_t
 
tmp
;

128 ià(!
	`g‘4By‹s
(
fid
, 
tmp
)) ;

129 ià(
tmp
 != 0x20746d66 ) {

131 ià(!
	`g‘4By‹s
(
fid
, 
tmp
)) ;

132 ià(!
	`skBy‹s
(
fid
, 
tmp
)) ;

136 
fÜm©L’gth
;

137 ià(!
	`g‘4By‹s
(
fid
, 
fÜm©L’gth
)) ;

138 
audioFÜm©
;

139 ià(!
	`g‘2By‹s
(
fid
, 
audioFÜm©
)) ;

141 
fAudioFÜm©
 = ()
audioFÜm©
;

142 ià(
fAudioFÜm©
 !ğ
WA_PCM
 && fAudioFÜm© !ğ
WA_PCMA
 && fAudioFÜm© !ğ
WA_PCMU
 && fAudioFÜm© !ğ
WA_IMA_ADPCM
) {

144 
’v
.
	`£tResuÉMsg
("Audio format is‚ot onehat we handle (PCM/PCMU/PCMA or IMA ADPCM)");

147 
numChªÃls
;

148 ià(!
	`g‘2By‹s
(
fid
, 
numChªÃls
)) ;

149 
fNumChªÃls
 = ()
numChªÃls
;

150 ià(
fNumChªÃls
 < 1 || fNumChannels > 2) {

151 
”rMsg
[100];

152 
	`¥rštf
(
”rMsg
, "Bad # chªÃls: %d", 
fNumChªÃls
);

153 
’v
.
	`£tResuÉMsg
(
”rMsg
);

156 ià(!
	`g‘4By‹s
(
fid
, 
fSam¶šgF»qu’cy
)) ;

157 ià(
fSam¶šgF»qu’cy
 == 0) {

158 
’v
.
	`£tResuÉMsg
("Bad sampling frequency: 0");

161 ià(!
	`skBy‹s
(
fid
, 6)) ;

162 
b™sP”Sam¶e
;

163 ià(!
	`g‘2By‹s
(
fid
, 
b™sP”Sam¶e
)) ;

164 
fB™sP”Sam¶e
 = ()
b™sP”Sam¶e
;

165 ià(
fB™sP”Sam¶e
 == 0) {

166 
’v
.
	`£tResuÉMsg
("Bad bits-per-sample: 0");

169 ià(!
	`skBy‹s
(
fid
, 
fÜm©L’gth
 - 16)) ;

172 
c
 = 
Ãxtc
;

173 ià(
c
 == 'f') {

174 ià(
Ãxtc
 != 'a' ||‚extc != 'c' ||‚extc != 't') ;

175 
çùL’gth
;

176 ià(!
	`g‘4By‹s
(
fid
, 
çùL’gth
)) ;

177 ià(!
	`skBy‹s
(
fid
, 
çùL’gth
)) ;

178 
c
 = 
Ãxtc
;

182 ià(
c
 !ğ'd' || 
Ãxtc
 != 'a' ||‚extc != 't' ||‚extc != 'a') ;

183 ià(!
	`skBy‹s
(
fid
, 4)) ;

186 
fWAVH—d”Size
 = ()
	`T–lFe64
(
fid
);

187 
sucûss
 = 
True
;

190 ià(!
sucûss
) {

191 
’v
.
	`£tResuÉMsg
("Bad WAV file format");

193 
fB™sP”Sam¶e
 = 0;

197 
fPÏyTimeP”Sam¶e
 = 1e6/()
fSam¶šgF»qu’cy
;

203 
maxSam¶esP”F¿me
 = (1400*8)/(
fNumChªÃls
*
fB™sP”Sam¶e
);

204 
desœedSam¶esP”F¿me
 = ()(0.02*
fSam¶šgF»qu’cy
);

205 
§m¶esP”F¿me
 = 
desœedSam¶esP”F¿me
 < 
maxSam¶esP”F¿me
 ? desiredSamplesPerFrame : maxSamplesPerFrame;

206 
fP»ã¼edF¿meSize
 = (
§m¶esP”F¿me
*
fNumChªÃls
*
fB™sP”Sam¶e
)/8;

208 
fFidIsS“kabË
 = 
	`FeIsS“kabË
(
fFid
);

209 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


211 
	`makeSock‘NÚBlockšg
(
	`f’o
(
fFid
));

213 
	}
}

215 
	gWAVAudioFeSourû
::~
	$WAVAudioFeSourû
() {

216 ià(
fFid
 =ğ
NULL
) ;

218 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


219 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
	`f’o
(
fFid
));

222 
	`Clo£IÅutFe
(
fFid
);

223 
	}
}

225 
	gWAVAudioFeSourû
::
	$doG‘NextF¿me
() {

226 ià(
	`ãof
(
fFid
è|| 
	`ã¼Ü
(fFidè|| (
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 == 0)) {

227 
	`hªdËClosu»
();

231 
fF¿meSize
 = 0;

232 #ifdeà
READ_FROM_FILES_SYNCHRONOUSLY


233 
	`doR—dFromFe
();

235 ià(!
fHaveS¹edR—dšg
) {

237 
	`’vœ
().
	`skScheduËr
().
	`tuºOnBackgroundR—dHªdlšg
(
	`f’o
(
fFid
),

238 (
TaskScheduËr
::
BackgroundHªdËrProc
*)&
feR—dabËHªdËr
, 
this
);

239 
fHaveS¹edR—dšg
 = 
True
;

242 
	}
}

244 
	gWAVAudioFeSourû
::
	$doStİG‘tšgF¿mes
() {

245 
	`’vœ
().
	`skScheduËr
().
	`unscheduËD–ayedTask
(
	`ÃxtTask
());

246 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


247 
	`’vœ
().
	`skScheduËr
().
	`tuºOffBackgroundR—dHªdlšg
(
	`f’o
(
fFid
));

248 
fHaveS¹edR—dšg
 = 
F®£
;

250 
	}
}

252 
	gWAVAudioFeSourû
::
	$feR—dabËHªdËr
(
WAVAudioFeSourû
* 
sourû
, ) {

253 ià(!
sourû
->
	`isCu¼’yAwa™šgD©a
()) {

254 
sourû
->
	`doStİG‘tšgF¿mes
();

257 
sourû
->
	`doR—dFromFe
();

258 
	}
}

260 
	gWAVAudioFeSourû
::
	$doR—dFromFe
() {

262 ià(
fLim™NumBy‹sToSŒ—m
 && 
fNumBy‹sToSŒ—m
 < 
fMaxSize
) {

263 
fMaxSize
 = 
fNumBy‹sToSŒ—m
;

265 ià(
fP»ã¼edF¿meSize
 < 
fMaxSize
) {

266 
fMaxSize
 = 
fP»ã¼edF¿meSize
;

268 
by‹sP”Sam¶e
 = (
fNumChªÃls
*
fB™sP”Sam¶e
)/8;

269 ià(
by‹sP”Sam¶e
 == 0) bytesPerSample = 1;

272 
by‹sToR—d
 = 
fSÿËFaùÜ
 =ğ1 ? 
fMaxSize
 - fMaxSize%
by‹sP”Sam¶e
 : bytesPerSample;

273 
numBy‹sR—d
;

275 #ifdeà
READ_FROM_FILES_SYNCHRONOUSLY


276 
numBy‹sR—d
 = 
	`ä—d
(
fTo
, 1, 
by‹sToR—d
, 
fFid
);

278 ià(
fFidIsS“kabË
) {

279 
numBy‹sR—d
 = 
	`ä—d
(
fTo
, 1, 
by‹sToR—d
, 
fFid
);

282 
numBy‹sR—d
 = 
	`»ad
(
	`f’o
(
fFid
), 
fTo
, 
by‹sToR—d
);

285 ià(
numBy‹sR—d
 == 0) {

286 
	`hªdËClosu»
();

289 
fF¿meSize
 +ğ
numBy‹sR—d
;

290 
fTo
 +ğ
numBy‹sR—d
;

291 
fMaxSize
 -ğ
numBy‹sR—d
;

292 
fNumBy‹sToSŒ—m
 -ğ
numBy‹sR—d
;

295 #iâdeà
READ_FROM_FILES_SYNCHRONOUSLY


296 ià(
fF¿meSize
%
by‹sP”Sam¶e
 > 0) ;

301 ià(
fSÿËFaùÜ
 != 1) {

302 
	`S“kFe64
(
fFid
, (
fSÿËFaùÜ
-1)*
by‹sP”Sam¶e
, 
SEEK_CUR
);

303 ià(
fMaxSize
 < 
by‹sP”Sam¶e
) ;

310 ià(
fP»£Á©iÚTime
.
tv_£c
 =ğ0 && fP»£Á©iÚTime.
tv_u£c
 == 0) {

312 
	`g‘timeofday
(&
fP»£Á©iÚTime
, 
NULL
);

315 
uSecÚds
 = 
fP»£Á©iÚTime
.
tv_u£c
 + 
fLa¡PÏyTime
;

316 
fP»£Á©iÚTime
.
tv_£c
 +ğ
uSecÚds
/1000000;

317 
fP»£Á©iÚTime
.
tv_u£c
 = 
uSecÚds
%1000000;

321 
fDu¿tiÚInMiüo£cÚds
 = 
fLa¡PÏyTime


322 ğ()((
fPÏyTimeP”Sam¶e
*
fF¿meSize
)/
by‹sP”Sam¶e
);

325 #ifdeà
READ_FROM_FILES_SYNCHRONOUSLY


327 
	`ÃxtTask
(èğ
	`’vœ
().
	`skScheduËr
().
	`scheduËD–ayedTask
(0,

328 (
TaskFunc
*)
F¿medSourû
::
aá”G‘tšg
, 
this
);

332 
F¿medSourû
::
	`aá”G‘tšg
(
this
);

334 
	}
}

336 
BoŞ—n
 
	gWAVAudioFeSourû
::
	$£tIÅutPÜt
() {

337  
True
;

338 
	}
}

340 
	gWAVAudioFeSourû
::
	$g‘Av”ageLev–
() const {

342 
	}
}

	@liveMedia/ourMD5.cpp

22 
	~"ourMD5.hh
"

23 
	~<N‘CommÚ.h
>

24 
	~<¡ršg.h
>

26 
	#DIGEST_SIZE_IN_BYTES
 16

	)

27 
	#DIGEST_SIZE_IN_HEX_DIGITS
 (2*
DIGEST_SIZE_IN_BYTES
)

	)

28 
	#DIGEST_SIZE_AS_STRING
 (
DIGEST_SIZE_IN_HEX_DIGITS
+1)

	)

32 şas 
	cMD5CÚ‹xt
 {

33 
	mpublic
:

34 
MD5CÚ‹xt
();

35 ~
MD5CÚ‹xt
();

37 
addD©a
(cÚ¡* 
šputD©a
, 
šputD©aSize
);

38 
’d
(* 
ouutDige¡
 );

39 
fš®ize
(* 
ouutDige¡InBy‹s
);

43 
	m´iv©e
:

44 
z”oize
();

45 
ŒªsfÜm64By‹s
(cÚ¡ 
block
[64]);

47 
	m´iv©e
:

48 
u_št32_t
 
fS‹
[4];

49 
u_št64_t
 
	mfB™CouÁ
;

50 
	mfWÜkšgBufãr
[64];

53 * 
	$our_MD5D©a
(cÚ¡* 
d©a
, 
d©aSize
, * 
ouutDige¡
) {

54 
MD5CÚ‹xt
 
ùx
;

56 
ùx
.
	`addD©a
(
d©a
, 
d©aSize
);

58 ià(
ouutDige¡
 =ğ
NULL
èouutDige¡ = 
Ãw
 [
DIGEST_SIZE_AS_STRING
];

59 
ùx
.
	`’d
(
ouutDige¡
);

61  
ouutDige¡
;

62 
	}
}

64 * 
	$our_MD5D©aRaw
(cÚ¡* 
d©a
, 
d©aSize
,

65 * 
ouutDige¡
) {

66 
MD5CÚ‹xt
 
ùx
;

68 
ùx
.
	`addD©a
(
d©a
, 
d©aSize
);

70 ià(
ouutDige¡
 =ğ
NULL
èouutDige¡ = 
Ãw
 [
DIGEST_SIZE_IN_BYTES
];

71 
ùx
.
	`fš®ize
(
ouutDige¡
);

73  
ouutDige¡
;

74 
	}
}

79 
	gMD5CÚ‹xt
::
	$MD5CÚ‹xt
()

80 : 
	$fB™CouÁ
(0) {

82 
fS‹
[0] = 0x67452301;

83 
fS‹
[1] = 0xefcdab89;

84 
fS‹
[2] = 0x98badcfe;

85 
fS‹
[3] = 0x10325476;

86 
	}
}

88 
	gMD5CÚ‹xt
::~
	$MD5CÚ‹xt
() {

89 
	`z”oize
();

90 
	}
}

92 
	gMD5CÚ‹xt
::
	$addD©a
(cÚ¡* 
šputD©a
, 
šputD©aSize
) {

94 
u_št64_t
 cÚ¡ 
by‹CouÁ
 = 
fB™CouÁ
>>3;

95 
bufãrBy‹sInU£
 = ()(
by‹CouÁ
&0x3F);

96 
bufãrBy‹sRemaššg
 = 64 - 
bufãrBy‹sInU£
;

99 
fB™CouÁ
 +ğ
šputD©aSize
<<3;

101 
i
 = 0;

102 ià(
šputD©aSize
 >ğ
bufãrBy‹sRemaššg
) {

107 
	`memıy
((*)&
fWÜkšgBufãr
[
bufãrBy‹sInU£
], (*)
šputD©a
, 
bufãrBy‹sRemaššg
);

108 
	`ŒªsfÜm64By‹s
(
fWÜkšgBufãr
);

109 
bufãrBy‹sInU£
 = 0;

111 
i
 = 
bufãrBy‹sRemaššg
; i + 63 < 
šputD©aSize
; i += 64) {

112 
	`ŒªsfÜm64By‹s
(&
šputD©a
[
i
]);

117 ià(
i
 < 
šputD©aSize
) {

118 
	`memıy
((*)&
fWÜkšgBufãr
[
bufãrBy‹sInU£
], (*)&
šputD©a
[
i
], 
šputD©aSize
 - i);

120 
	}
}

122 
	gMD5CÚ‹xt
::
	$’d
(* 
ouutDige¡
) {

123 
dige¡InBy‹s
[
DIGEST_SIZE_IN_BYTES
];

124 
	`fš®ize
(
dige¡InBy‹s
);

127 cÚ¡ 
hex
[]="0123456789abcdef";

128 
i
;

129 
i
 = 0; i < 
DIGEST_SIZE_IN_BYTES
; ++i) {

130 
ouutDige¡
[2*
i
] = 
hex
[
dige¡InBy‹s
[i] >> 4];

131 
ouutDige¡
[2*
i
+1] = 
hex
[
dige¡InBy‹s
[i] & 0x0F];

133 
ouutDige¡
[2*
i
] = '\0';

134 
	}
}

139 
	$uÅack32
(
out
[4], 
u_št32_t
 
š
) {

140 
i
 = 0; i < 4; ++i) {

141 
out
[
i
] = ()((
š
>>(8*i))&0xFF);

143 
	}
}

145 
	$uÅack64
(
out
[8], 
u_št64_t
 
š
) {

146 
i
 = 0; i < 8; ++i) {

147 
out
[
i
] = ()((
š
>>(8*i))&0xFF);

149 
	}
}

151 cÚ¡ 
	gPADDING
[64] = {

157 
	gMD5CÚ‹xt
::
	$fš®ize
(* 
ouutDige¡InBy‹s
) {

159 
b™CouÁInBy‹s
[8];

160 
	`uÅack64
(
b™CouÁInBy‹s
, 
fB™CouÁ
);

163 
u_št64_t
 cÚ¡ 
by‹CouÁ
 = 
fB™CouÁ
>>3;

164 
bufãrBy‹sInU£
 = ()(
by‹CouÁ
&0x3F);

165 
numPaddšgBy‹s


166 ğ(
bufãrBy‹sInU£
 < 56) ? (56 - bufferBytesInUse) : (64 + 56 - bufferBytesInUse);

167 
	`addD©a
(
PADDING
, 
numPaddšgBy‹s
);

169 
	`addD©a
(
b™CouÁInBy‹s
, 8);

172 
	`uÅack32
(&
ouutDige¡InBy‹s
[0], 
fS‹
[0]);

173 
	`uÅack32
(&
ouutDige¡InBy‹s
[4], 
fS‹
[1]);

174 
	`uÅack32
(&
ouutDige¡InBy‹s
[8], 
fS‹
[2]);

175 
	`uÅack32
(&
ouutDige¡InBy‹s
[12], 
fS‹
[3]);

177 
	`z”oize
();

178 
	}
}

180 
	gMD5CÚ‹xt
::
	$z”oize
() {

181 
fS‹
[0] = fState[1] = fState[2] = fState[3] = 0;

182 
fB™CouÁ
 = 0;

183 
i
 = 0; i < 64; ++iè
fWÜkšgBufãr
[i] = 0;

184 
	}
}

190 
	#S11
 7

	)

191 
	#S12
 12

	)

192 
	#S13
 17

	)

193 
	#S14
 22

	)

194 
	#S21
 5

	)

195 
	#S22
 9

	)

196 
	#S23
 14

	)

197 
	#S24
 20

	)

198 
	#S31
 4

	)

199 
	#S32
 11

	)

200 
	#S33
 16

	)

201 
	#S34
 23

	)

202 
	#S41
 6

	)

203 
	#S42
 10

	)

204 
	#S43
 15

	)

205 
	#S44
 21

	)

208 
	#F
(
x
, 
y
, 
z
è(((xè& (y)è| ((~xè& (z)))

	)

209 
	#G
(
x
, 
y
, 
z
è(((xè& (z)è| ((yè& (~z)))

	)

210 
	#H
(
x
, 
y
, 
z
è((xè^ (yè^ (z))

	)

211 
	#I
(
x
, 
y
, 
z
è((yè^ ((xè| (~z)))

	)

214 
	#ROTATE_LEFT
(
x
, 
n
è(((xè<< (n)è| ((xè>> (32-Ò))))

	)

217 
	#FF
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

218 (
a
è+ğ
	`F
((
b
), (
c
), (
d
)è+ (
x
è+ (
u_št32_t
)(
ac
); \

219 (
a
èğ
	`ROTATE_LEFT
(×), (
s
)); \

220 (
a
è+ğ(
b
); \

221 }

	)

222 
	#GG
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

223 (
a
è+ğ
	`G
((
b
), (
c
), (
d
)è+ (
x
è+ (
u_št32_t
)(
ac
); \

224 (
a
èğ
	`ROTATE_LEFT
(×), (
s
)); \

225 (
a
è+ğ(
b
); \

226 }

	)

227 
	#HH
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

228 (
a
è+ğ
	`H
((
b
), (
c
), (
d
)è+ (
x
è+ (
u_št32_t
)(
ac
); \

229 (
a
èğ
	`ROTATE_LEFT
(×), (
s
)); \

230 (
a
è+ğ(
b
); \

231 }

	)

232 
	#II
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

233 (
a
è+ğ
	`I
((
b
), (
c
), (
d
)è+ (
x
è+ (
u_št32_t
)(
ac
); \

234 (
a
èğ
	`ROTATE_LEFT
(×), (
s
)); \

235 (
a
è+ğ(
b
); \

236 }

	)

238 
	gMD5CÚ‹xt
::
	$ŒªsfÜm64By‹s
(cÚ¡ 
block
[64]) {

239 
u_št32_t
 
a
 = 
fS‹
[0], 
b
 = fS‹[1], 
c
 = fS‹[2], 
d
 = fState[3];

242 
u_št32_t
 
x
[16];

243 
i
 = 0, 
j
 = 0; i < 16; ++i, j += 4) {

244 
x
[
i
] = ((
u_št32_t
)
block
[
j
]) | (((u_int32_t)block[j+1]) << 8) | (((u_int32_t)block[j+2]) << 16) | (((u_int32_t)block[j+3]) << 24);

250 
	`FF
(
a
, 
b
, 
c
, 
d
, 
x
[0], 
S11
, 0xd76aa478);

251 
	`FF
(
d
, 
a
, 
b
, 
c
, 
x
[1], 
S12
, 0xe8c7b756);

252 
	`FF
(
c
, 
d
, 
a
, 
b
, 
x
[2], 
S13
, 0x242070db);

253 
	`FF
(
b
, 
c
, 
d
, 
a
, 
x
[3], 
S14
, 0xc1bdceee);

254 
	`FF
(
a
, 
b
, 
c
, 
d
, 
x
[4], 
S11
, 0xf57c0faf);

255 
	`FF
(
d
, 
a
, 
b
, 
c
, 
x
[5], 
S12
, 0x4787c62a);

256 
	`FF
(
c
, 
d
, 
a
, 
b
, 
x
[6], 
S13
, 0xa8304613);

257 
	`FF
(
b
, 
c
, 
d
, 
a
, 
x
[7], 
S14
, 0xfd469501);

258 
	`FF
(
a
, 
b
, 
c
, 
d
, 
x
[8], 
S11
, 0x698098d8);

259 
	`FF
(
d
, 
a
, 
b
, 
c
, 
x
[9], 
S12
, 0x8b44f7af);

260 
	`FF
(
c
, 
d
, 
a
, 
b
, 
x
[10], 
S13
, 0xffff5bb1);

261 
	`FF
(
b
, 
c
, 
d
, 
a
, 
x
[11], 
S14
, 0x895cd7be);

262 
	`FF
(
a
, 
b
, 
c
, 
d
, 
x
[12], 
S11
, 0x6b901122);

263 
	`FF
(
d
, 
a
, 
b
, 
c
, 
x
[13], 
S12
, 0xfd987193);

264 
	`FF
(
c
, 
d
, 
a
, 
b
, 
x
[14], 
S13
, 0xa679438e);

265 
	`FF
(
b
, 
c
, 
d
, 
a
, 
x
[15], 
S14
, 0x49b40821);

268 
	`GG
(
a
, 
b
, 
c
, 
d
, 
x
[1], 
S21
, 0xf61e2562);

269 
	`GG
(
d
, 
a
, 
b
, 
c
, 
x
[6], 
S22
, 0xc040b340);

270 
	`GG
(
c
, 
d
, 
a
, 
b
, 
x
[11], 
S23
, 0x265e5a51);

271 
	`GG
(
b
, 
c
, 
d
, 
a
, 
x
[0], 
S24
, 0xe9b6c7aa);

272 
	`GG
(
a
, 
b
, 
c
, 
d
, 
x
[5], 
S21
, 0xd62f105d);

273 
	`GG
(
d
, 
a
, 
b
, 
c
, 
x
[10], 
S22
, 0x2441453);

274 
	`GG
(
c
, 
d
, 
a
, 
b
, 
x
[15], 
S23
, 0xd8a1e681);

275 
	`GG
(
b
, 
c
, 
d
, 
a
, 
x
[4], 
S24
, 0xe7d3fbc8);

276 
	`GG
(
a
, 
b
, 
c
, 
d
, 
x
[9], 
S21
, 0x21e1cde6);

277 
	`GG
(
d
, 
a
, 
b
, 
c
, 
x
[14], 
S22
, 0xc33707d6);

278 
	`GG
(
c
, 
d
, 
a
, 
b
, 
x
[3], 
S23
, 0xf4d50d87);

279 
	`GG
(
b
, 
c
, 
d
, 
a
, 
x
[8], 
S24
, 0x455a14ed);

280 
	`GG
(
a
, 
b
, 
c
, 
d
, 
x
[13], 
S21
, 0xa9e3e905);

281 
	`GG
(
d
, 
a
, 
b
, 
c
, 
x
[2], 
S22
, 0xfcefa3f8);

282 
	`GG
(
c
, 
d
, 
a
, 
b
, 
x
[7], 
S23
, 0x676f02d9);

283 
	`GG
(
b
, 
c
, 
d
, 
a
, 
x
[12], 
S24
, 0x8d2a4c8a);

286 
	`HH
(
a
, 
b
, 
c
, 
d
, 
x
[5], 
S31
, 0xfffa3942);

287 
	`HH
(
d
, 
a
, 
b
, 
c
, 
x
[8], 
S32
, 0x8771f681);

288 
	`HH
(
c
, 
d
, 
a
, 
b
, 
x
[11], 
S33
, 0x6d9d6122);

289 
	`HH
(
b
, 
c
, 
d
, 
a
, 
x
[14], 
S34
, 0xfde5380c);

290 
	`HH
(
a
, 
b
, 
c
, 
d
, 
x
[1], 
S31
, 0xa4beea44);

291 
	`HH
(
d
, 
a
, 
b
, 
c
, 
x
[4], 
S32
, 0x4bdecfa9);

292 
	`HH
(
c
, 
d
, 
a
, 
b
, 
x
[7], 
S33
, 0xf6bb4b60);

293 
	`HH
(
b
, 
c
, 
d
, 
a
, 
x
[10], 
S34
, 0xbebfbc70);

294 
	`HH
(
a
, 
b
, 
c
, 
d
, 
x
[13], 
S31
, 0x289b7ec6);

295 
	`HH
(
d
, 
a
, 
b
, 
c
, 
x
[0], 
S32
, 0xeaa127fa);

296 
	`HH
(
c
, 
d
, 
a
, 
b
, 
x
[3], 
S33
, 0xd4ef3085);

297 
	`HH
(
b
, 
c
, 
d
, 
a
, 
x
[6], 
S34
, 0x4881d05);

298 
	`HH
(
a
, 
b
, 
c
, 
d
, 
x
[9], 
S31
, 0xd9d4d039);

299 
	`HH
(
d
, 
a
, 
b
, 
c
, 
x
[12], 
S32
, 0xe6db99e5);

300 
	`HH
(
c
, 
d
, 
a
, 
b
, 
x
[15], 
S33
, 0x1fa27cf8);

301 
	`HH
(
b
, 
c
, 
d
, 
a
, 
x
[2], 
S34
, 0xc4ac5665);

304 
	`II
(
a
, 
b
, 
c
, 
d
, 
x
[0], 
S41
, 0xf4292244);

305 
	`II
(
d
, 
a
, 
b
, 
c
, 
x
[7], 
S42
, 0x432aff97);

306 
	`II
(
c
, 
d
, 
a
, 
b
, 
x
[14], 
S43
, 0xab9423a7);

307 
	`II
(
b
, 
c
, 
d
, 
a
, 
x
[5], 
S44
, 0xfc93a039);

308 
	`II
(
a
, 
b
, 
c
, 
d
, 
x
[12], 
S41
, 0x655b59c3);

309 
	`II
(
d
, 
a
, 
b
, 
c
, 
x
[3], 
S42
, 0x8f0ccc92);

310 
	`II
(
c
, 
d
, 
a
, 
b
, 
x
[10], 
S43
, 0xffeff47d);

311 
	`II
(
b
, 
c
, 
d
, 
a
, 
x
[1], 
S44
, 0x85845dd1);

312 
	`II
(
a
, 
b
, 
c
, 
d
, 
x
[8], 
S41
, 0x6fa87e4f);

313 
	`II
(
d
, 
a
, 
b
, 
c
, 
x
[15], 
S42
, 0xfe2ce6e0);

314 
	`II
(
c
, 
d
, 
a
, 
b
, 
x
[6], 
S43
, 0xa3014314);

315 
	`II
(
b
, 
c
, 
d
, 
a
, 
x
[13], 
S44
, 0x4e0811a1);

316 
	`II
(
a
, 
b
, 
c
, 
d
, 
x
[4], 
S41
, 0xf7537e82);

317 
	`II
(
d
, 
a
, 
b
, 
c
, 
x
[11], 
S42
, 0xbd3af235);

318 
	`II
(
c
, 
d
, 
a
, 
b
, 
x
[2], 
S43
, 0x2ad7d2bb);

319 
	`II
(
b
, 
c
, 
d
, 
a
, 
x
[9], 
S44
, 0xeb86d391);

321 
fS‹
[0] +ğ
a
; fS‹[1] +ğ
b
; fS‹[2] +ğ
c
; fS‹[3] +ğ
d
;

324 
k
 = 0; k < 16; ++kè
x
[k] = 0;

325 
	}
}

	@liveMedia/rtcp_from_spec.c

6 
	~"¹ı_äom_¥ec.h
"

69 
	$¹ı_š‹rv®
(
memb”s
,

70 
£nd”s
,

71 
¹ı_bw
,

72 
we_£Á
,

73 
avg_¹ı_size
,

74 
š™Ÿl
)

84 cÚ¡ 
RTCP_MIN_TIME
 = 5.;

93 cÚ¡ 
RTCP_SENDER_BW_FRACTION
 = 0.25;

94 cÚ¡ 
RTCP_RCVR_BW_FRACTION
 = (1-
RTCP_SENDER_BW_FRACTION
);

99 cÚ¡ 
COMPENSATION
 = 2.71828 - 1.5;

101 
t
;

102 
¹ı_mš_time
 = 
RTCP_MIN_TIME
;

103 
n
;

112 ià(
š™Ÿl
) {

113 
¹ı_mš_time
 /= 2;

121 
n
 = 
memb”s
;

122 ià(
£nd”s
 > 0 && s’d” < 
memb”s
 * 
RTCP_SENDER_BW_FRACTION
) {

123 ià(
we_£Á
) {

124 
¹ı_bw
 *ğ
RTCP_SENDER_BW_FRACTION
;

125 
n
 = 
£nd”s
;

127 
¹ı_bw
 *ğ
RTCP_RCVR_BW_FRACTION
;

128 
n
 -ğ
£nd”s
;

141 
t
 = 
avg_¹ı_size
 * 
n
 / 
¹ı_bw
;

142 ià(
t
 < 
¹ı_mš_time
) =„tcp_min_time;

149 
t
 = * (
	`d¿nd48
() + 0.5);

150 
t
 = / 
COMPENSATION
;

151  
t
;

152 
	}
}

154 
	$OnExpœe
(
ev’t
 
e
,

155 
memb”s
,

156 
£nd”s
,

157 
¹ı_bw
,

158 
we_£Á
,

159 *
avg_¹ı_size
,

160 *
š™Ÿl
,

161 
time_
 
tc
,

162 
time_
 *

,

163 *
pmemb”s
)

171 
t
;

172 
Š
;

177 ià(
	`Ty³OfEv’t
(
e
è=ğ
EVENT_BYE
) {

178 
t
 = 
	`¹ı_š‹rv®
(
memb”s
,

179 
£nd”s
,

180 
¹ı_bw
,

181 
we_£Á
,

182 *
avg_¹ı_size
,

183 *
š™Ÿl
);

184 
Š
 = *

 + 
t
;

185 ià(
Š
 <ğ
tc
) {

186 
	`S’dBYEPack‘
(
e
);

187 
	`ex™
(1);

189 
	`ScheduË
(
Š
, 
e
);

192 } ià(
	`Ty³OfEv’t
(
e
è=ğ
EVENT_REPORT
) {

193 
t
 = 
	`¹ı_š‹rv®
(
memb”s
,

194 
£nd”s
,

195 
¹ı_bw
,

196 
we_£Á
,

197 *
avg_¹ı_size
,

198 *
š™Ÿl
);

199 
Š
 = *

 + 
t
;

201 ià(
Š
 <ğ
tc
) {

202 
	`S’dRTCPR•Üt
(
e
);

203 *
avg_¹ı_size
 = (1./16.)*
	`S’tPack‘Size
(
e
) +

204 (15./16.)*(*
avg_¹ı_size
);

205 *

 = 
tc
;

213 
t
 = 
	`¹ı_š‹rv®
(
memb”s
,

214 
£nd”s
,

215 
¹ı_bw
,

216 
we_£Á
,

217 *
avg_¹ı_size
,

218 *
š™Ÿl
);

220 
	`ScheduË
(
t
+
tc
,
e
);

221 *
š™Ÿl
 = 0;

223 
	`ScheduË
(
Š
, 
e
);

225 *
pmemb”s
 = 
memb”s
;

227 
	}
}

230 
	$OnReûive
(
·ck‘
 
p
,

231 
ev’t
 
e
,

232 *
memb”s
,

233 *
pmemb”s
,

234 *
£nd”s
,

235 *
avg_¹ı_size
,

236 *

,

237 
tc
,

238 
Š
)

244 ià(
	`Pack‘Ty³
(
p
è=ğ
PACKET_RTCP_REPORT
) {

245 ià(
	`NewMemb”
(
p
è&& (
	`Ty³OfEv’t
(
e
è=ğ
EVENT_REPORT
)) {

246 
	`AddMemb”
(
p
);

247 *
memb”s
 += 1;

249 *
avg_¹ı_size
 = (1./16.)*
	`ReûivedPack‘Size
(
p
) +

250 (15./16.)*(*
avg_¹ı_size
);

251 } ià(
	`Pack‘Ty³
(
p
è=ğ
PACKET_RTP
) {

252 ià(
	`NewMemb”
(
p
è&& (
	`Ty³OfEv’t
(
e
è=ğ
EVENT_REPORT
)) {

253 
	`AddMemb”
(
p
);

254 *
memb”s
 += 1;

256 ià(
	`NewS’d”
(
p
è&& (
	`Ty³OfEv’t
(
e
è=ğ
EVENT_REPORT
)) {

257 
	`AddS’d”
(
p
);

258 *
£nd”s
 += 1;

260 } ià(
	`Pack‘Ty³
(
p
è=ğ
PACKET_BYE
) {

261 *
avg_¹ı_size
 = (1./16.)*
	`ReûivedPack‘Size
(
p
) +

262 (15./16.)*(*
avg_¹ı_size
);

264 ià(
	`Ty³OfEv’t
(
e
è=ğ
EVENT_REPORT
) {

265 ià(
	`NewS’d”
(
p
è=ğ
FALSE
) {

266 
	`RemoveS’d”
(
p
);

267 *
£nd”s
 -= 1;

270 ià(
	`NewMemb”
(
p
è=ğ
FALSE
) {

271 
	`RemoveMemb”
(
p
);

272 *
memb”s
 -= 1;

275 if(*
memb”s
 < *
pmemb”s
) {

276 
Š
 = 
tc
 + (((è*
memb”s
)/(*
pmemb”s
))*(tn -c);

277 *

 = 
tc
 - (((è*
memb”s
)/(*
pmemb”s
))*(tc - *tp);

281 
	`RescheduË
(
Š
, 
e
);

282 *
pmemb”s
 = *
memb”s
;

285 } ià(
	`Ty³OfEv’t
(
e
è=ğ
EVENT_BYE
) {

286 *
memb”s
 += 1;

289 
	}
}

	@liveMedia/rtcp_from_spec.h

6 #iâdeà
_RTCP_FROM_SPEC_H


7 
	#_RTCP_FROM_SPEC_H


	)

9 
	~<¡dlib.h
>

14 #undeà
_ANSI_ARGS_


15 #ià((
defšed
(
__STDC__
è|| defšed(
SABER
)è&& !defšed(
NO_PROTOTYPE
)è|| defšed(
__ılu¥lus
è|| defšed(
USE_PROTOTYPE
)

16 
	#_ANSI_ARGS_
(
x
è
	)
x

18 
	#_ANSI_ARGS_
(
x
è()

	)

20 #ifdeà
__ılu¥lus


21 
	#EXTERN
 "C"

	)

23 
	#EXTERN
 

	)

27 * 
	tev’t
;

29 
	#EVENT_UNKNOWN
 0

	)

30 
	#EVENT_REPORT
 1

	)

31 
	#EVENT_BYE
 2

	)

34 
	ttime_
;

37 * 
	t·ck‘
;

39 
	#PACKET_UNKNOWN_TYPE
 0

	)

40 
	#PACKET_RTP
 1

	)

41 
	#PACKET_RTCP_REPORT
 2

	)

42 
	#PACKET_BYE
 3

	)

43 
	#PACKET_RTCP_APP
 4

	)

46 
	#d¿nd48
 
d¿nd30


	)

49 
	#ex™
(
n
èdØ{} 0)

	)

51 #iâdeà
FALSE


52 
	#FALSE
 0

	)

54 #iâdeà
TRUE


55 
	#TRUE
 1

	)

60 
EXTERN
 
OnExpœe
 
_ANSI_ARGS_
((
ev’t
, , , , , *, *, 
time_
,ime_tp*, *));

62 
EXTERN
 
OnReûive
 
_ANSI_ARGS_
((
·ck‘
, 
ev’t
, *, *, *, *, *, , ));

66 
EXTERN
 
ScheduË
 
_ANSI_ARGS_
((,
ev’t
));

67 
EXTERN
 
RescheduË
 
_ANSI_ARGS_
((,
ev’t
));

68 
EXTERN
 
S’dRTCPR•Üt
 
_ANSI_ARGS_
((
ev’t
));

69 
EXTERN
 
S’dBYEPack‘
 
_ANSI_ARGS_
((
ev’t
));

70 
EXTERN
 
Ty³OfEv’t
 
_ANSI_ARGS_
((
ev’t
));

71 
EXTERN
 
S’tPack‘Size
 
_ANSI_ARGS_
((
ev’t
));

72 
EXTERN
 
Pack‘Ty³
 
_ANSI_ARGS_
((
·ck‘
));

73 
EXTERN
 
ReûivedPack‘Size
 
_ANSI_ARGS_
((
·ck‘
));

74 
EXTERN
 
NewMemb”
 
_ANSI_ARGS_
((
·ck‘
));

75 
EXTERN
 
NewS’d”
 
_ANSI_ARGS_
((
·ck‘
));

76 
EXTERN
 
AddMemb”
 
_ANSI_ARGS_
((
·ck‘
));

77 
EXTERN
 
AddS’d”
 
_ANSI_ARGS_
((
·ck‘
));

78 
EXTERN
 
RemoveMemb”
 
_ANSI_ARGS_
((
·ck‘
));

79 
EXTERN
 
RemoveS’d”
 
_ANSI_ARGS_
((
·ck‘
));

80 
EXTERN
 
d¿nd30
 
_ANSI_ARGS_
(());

	@liveMedia/uLawAudioFilter.cpp

21 
	~"uLawAudioF‹r.hh
"

25 
uLawFromPCMAudioSourû
* 
	guLawFromPCMAudioSourû


26 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
, 
by‹Ord”šg
) {

28 ià(
by‹Ord”šg
 < 0 || byteOrdering > 2) {

29 
’v
.
	`£tResuÉMsg
("uLawFromPCMAudioSource::createNew(): bad \"byteOrdering\"…arameter");

30  
NULL
;

32  
Ãw
 
	`uLawFromPCMAudioSourû
(
’v
, 
šputSourû
, 
by‹Ord”šg
);

33 
	}
}

35 
	guLawFromPCMAudioSourû


36 ::
	$uLawFromPCMAudioSourû
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
,

37 
by‹Ord”šg
)

38 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

39 
	`fBy‹Ord”šg
(
by‹Ord”šg
), 
	`fIÅutBufãr
(
NULL
), 
	$fIÅutBufãrSize
(0) {

40 
	}
}

42 
	guLawFromPCMAudioSourû
::~
	$uLawFromPCMAudioSourû
() {

43 
d–‘e
[] 
fIÅutBufãr
;

44 
	}
}

46 
	guLawFromPCMAudioSourû
::
	$doG‘NextF¿me
() {

49 
by‹sToR—d
 = 
fMaxSize
*2;

50 ià(
by‹sToR—d
 > 
fIÅutBufãrSize
) {

51 
d–‘e
[] 
fIÅutBufãr
; fIÅutBufã¸ğ
Ãw
 [
by‹sToR—d
];

52 
fIÅutBufãrSize
 = 
by‹sToR—d
;

56 
fIÅutSourû
->
	`g‘NextF¿me
(
fIÅutBufãr
, 
by‹sToR—d
,

57 
aá”G‘tšgF¿me
, 
this
,

58 
F¿medSourû
::
hªdËClosu»
, 
this
);

59 
	}
}

61 
	guLawFromPCMAudioSourû


62 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

63 
numTrunÿ‹dBy‹s
,

64 
timev®
 
´e£Á©iÚTime
,

65 
du¿tiÚInMiüo£cÚds
) {

66 
uLawFromPCMAudioSourû
* 
sourû
 = (uLawFromPCMAudioSourû*)
ş›ÁD©a
;

67 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

68 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

69 
	}
}

71 
	#BIAS
 0x84

72 
	#CLIP
 32635

	)

74 
	$uLawFrom16B™Lš—r
(
u_št16_t
 
§m¶e
) {

75 cÚ¡ 
exp_lut
[256] = {0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,

91 
sign
 = (
§m¶e
 >> 8) & 0x80;

92 ià(
sign
 !ğ0è
§m¶e
 = -sample;

94 ià(
§m¶e
 > 
CLIP
) sample = CLIP;

95 
§m¶e
 +ğ
BIAS
;

97 
expÚ’t
 = 
exp_lut
[(
§m¶e
>>7) & 0xFF];

98 
mªtis§
 = (
§m¶e
 >> (
expÚ’t
+3)) & 0x0F;

99 
»suÉ
 = ~(
sign
 | (
expÚ’t
 << 4è| 
mªtis§
);

100 ià(
»suÉ
 == 0 )„esult = 0x02;

102  
»suÉ
;

103 
	}
}

105 
	guLawFromPCMAudioSourû


106 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

107 
timev®
 
´e£Á©iÚTime
,

108 
du¿tiÚInMiüo£cÚds
) {

111 
numSam¶es
 = 
äameSize
/2;

112 
fBy‹Ord”šg
) {

114 
u_št16_t
* 
šputSam¶e
 = (u_št16_t*)
fIÅutBufãr
;

115 
i
 = 0; i < 
numSam¶es
; ++i) {

116 
fTo
[
i
] = 
	`uLawFrom16B™Lš—r
(
šputSam¶e
[i]);

121 
i
 = 0; i < 
numSam¶es
; ++i) {

122 
u_št16_t
 cÚ¡ 
ÃwV®ue
 = (
fIÅutBufãr
[2*
i
+1]<<8)|fInputBuffer[2*i];

123 
fTo
[
i
] = 
	`uLawFrom16B™Lš—r
(
ÃwV®ue
);

128 
i
 = 0; i < 
numSam¶es
; ++i) {

129 
u_št16_t
 cÚ¡ 
ÃwV®ue
 = (
fIÅutBufãr
[2*
i
]<<8)|fInputBuffer[2*i+i];

130 
fTo
[
i
] = 
	`uLawFrom16B™Lš—r
(
ÃwV®ue
);

137 
fF¿meSize
 = 
numSam¶es
;

138 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

139 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

140 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

141 
	`aá”G‘tšg
(
this
);

142 
	}
}

147 
PCMFromuLawAudioSourû
* 
	gPCMFromuLawAudioSourû


148 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

149  
Ãw
 
	`PCMFromuLawAudioSourû
(
’v
, 
šputSourû
);

150 
	}
}

152 
	gPCMFromuLawAudioSourû


153 ::
	$PCMFromuLawAudioSourû
(
U§geEnvœÚm’t
& 
’v
,

154 
F¿medSourû
* 
šputSourû
)

155 : 
	`F¿medF‹r
(
’v
, 
šputSourû
),

156 
	`fIÅutBufãr
(
NULL
), 
	$fIÅutBufãrSize
(0) {

157 
	}
}

159 
	gPCMFromuLawAudioSourû
::~
	$PCMFromuLawAudioSourû
() {

160 
d–‘e
[] 
fIÅutBufãr
;

161 
	}
}

163 
	gPCMFromuLawAudioSourû
::
	$doG‘NextF¿me
() {

166 
by‹sToR—d
 = 
fMaxSize
/2;

167 ià(
by‹sToR—d
 > 
fIÅutBufãrSize
) {

168 
d–‘e
[] 
fIÅutBufãr
; fIÅutBufã¸ğ
Ãw
 [
by‹sToR—d
];

169 
fIÅutBufãrSize
 = 
by‹sToR—d
;

173 
fIÅutSourû
->
	`g‘NextF¿me
(
fIÅutBufãr
, 
by‹sToR—d
,

174 
aá”G‘tšgF¿me
, 
this
,

175 
F¿medSourû
::
hªdËClosu»
, 
this
);

176 
	}
}

178 
	gPCMFromuLawAudioSourû


179 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

180 
numTrunÿ‹dBy‹s
,

181 
timev®
 
´e£Á©iÚTime
,

182 
du¿tiÚInMiüo£cÚds
) {

183 
PCMFromuLawAudioSourû
* 
sourû
 = (PCMFromuLawAudioSourû*)
ş›ÁD©a
;

184 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

185 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

186 
	}
}

188 
u_št16_t
 
	$lš—r16FromuLaw
(
uLawBy‹
) {

189 cÚ¡ 
exp_lut
[8] = {0,132,396,924,1980,4092,8316,16764};

190 
uLawBy‹
 = ~uLawByte;

192 
BoŞ—n
 
sign
 = (
uLawBy‹
 & 0x80) != 0;

193 
expÚ’t
 = (
uLawBy‹
>>4) & 0x07;

194 
mªtis§
 = 
uLawBy‹
 & 0x0F;

196 
u_št16_t
 
»suÉ
 = 
exp_lut
[
expÚ’t
] + (
mªtis§
 << (exponent+3));

197 ià(
sign
è
»suÉ
 = -result;

198  
»suÉ
;

199 
	}
}

201 
	gPCMFromuLawAudioSourû


202 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

203 
timev®
 
´e£Á©iÚTime
,

204 
du¿tiÚInMiüo£cÚds
) {

207 
numSam¶es
 = 
äameSize
;

208 
u_št16_t
* 
ouutSam¶e
 = (u_št16_t*)
fTo
;

209 
i
 = 0; i < 
numSam¶es
; ++i) {

210 
ouutSam¶e
[
i
] = 
	`lš—r16FromuLaw
(
fIÅutBufãr
[i]);

214 
fF¿meSize
 = 
numSam¶es
*2;

215 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

216 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

217 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

218 
	`aá”G‘tšg
(
this
);

219 
	}
}

224 
N‘wÜkFromHo¡Ord”16
* 
	gN‘wÜkFromHo¡Ord”16


225 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

226  
Ãw
 
	`N‘wÜkFromHo¡Ord”16
(
’v
, 
šputSourû
);

227 
	}
}

229 
	gN‘wÜkFromHo¡Ord”16


230 ::
	$N‘wÜkFromHo¡Ord”16
(
U§geEnvœÚm’t
& 
’v
,

231 
F¿medSourû
* 
šputSourû
)

232 : 
	$F¿medF‹r
(
’v
, 
šputSourû
) {

233 
	}
}

235 
	gN‘wÜkFromHo¡Ord”16
::~
	$N‘wÜkFromHo¡Ord”16
() {

236 
	}
}

238 
N‘wÜkFromHo¡Ord”16
::
	$doG‘NextF¿me
() {

240 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

241 
aá”G‘tšgF¿me
, 
this
,

242 
F¿medSourû
::
hªdËClosu»
, 
this
);

243 
	}
}

245 
	gN‘wÜkFromHo¡Ord”16


246 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

247 
numTrunÿ‹dBy‹s
,

248 
timev®
 
´e£Á©iÚTime
,

249 
du¿tiÚInMiüo£cÚds
) {

250 
N‘wÜkFromHo¡Ord”16
* 
sourû
 = (N‘wÜkFromHo¡Ord”16*)
ş›ÁD©a
;

251 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

252 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

253 
	}
}

255 
	gN‘wÜkFromHo¡Ord”16


256 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

257 
timev®
 
´e£Á©iÚTime
,

258 
du¿tiÚInMiüo£cÚds
) {

261 
numV®ues
 = 
äameSize
/2;

262 
u_št16_t
* 
v®ue
 = (u_št16_t*)
fTo
;

263 
i
 = 0; i < 
numV®ues
; ++i) {

264 
v®ue
[
i
] = 
	`htÚs
(value[i]);

268 
fF¿meSize
 = 
numV®ues
*2;

269 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

270 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

271 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

272 
	`aá”G‘tšg
(
this
);

273 
	}
}

278 
Ho¡FromN‘wÜkOrd”16
* 
	gHo¡FromN‘wÜkOrd”16


279 ::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

280  
Ãw
 
	`Ho¡FromN‘wÜkOrd”16
(
’v
, 
šputSourû
);

281 
	}
}

283 
	gHo¡FromN‘wÜkOrd”16


284 ::
	$Ho¡FromN‘wÜkOrd”16
(
U§geEnvœÚm’t
& 
’v
,

285 
F¿medSourû
* 
šputSourû
)

286 : 
	$F¿medF‹r
(
’v
, 
šputSourû
) {

287 
	}
}

289 
	gHo¡FromN‘wÜkOrd”16
::~
	$Ho¡FromN‘wÜkOrd”16
() {

290 
	}
}

292 
Ho¡FromN‘wÜkOrd”16
::
	$doG‘NextF¿me
() {

294 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

295 
aá”G‘tšgF¿me
, 
this
,

296 
F¿medSourû
::
hªdËClosu»
, 
this
);

297 
	}
}

299 
	gHo¡FromN‘wÜkOrd”16


300 ::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

301 
numTrunÿ‹dBy‹s
,

302 
timev®
 
´e£Á©iÚTime
,

303 
du¿tiÚInMiüo£cÚds
) {

304 
Ho¡FromN‘wÜkOrd”16
* 
sourû
 = (Ho¡FromN‘wÜkOrd”16*)
ş›ÁD©a
;

305 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

306 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

307 
	}
}

309 
	gHo¡FromN‘wÜkOrd”16


310 ::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

311 
timev®
 
´e£Á©iÚTime
,

312 
du¿tiÚInMiüo£cÚds
) {

315 
numV®ues
 = 
äameSize
/2;

316 
u_št16_t
* 
v®ue
 = (u_št16_t*)
fTo
;

317 
i
 = 0; i < 
numV®ues
; ++i) {

318 
v®ue
[
i
] = 
	`Áohs
(value[i]);

322 
fF¿meSize
 = 
numV®ues
*2;

323 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
;

324 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

325 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

326 
	`aá”G‘tšg
(
this
);

327 
	}
}

332 
EndŸnSw­16
*

333 
	gEndŸnSw­16
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

334  
Ãw
 
	`EndŸnSw­16
(
’v
, 
šputSourû
);

335 
	}
}

337 
	gEndŸnSw­16
::
	$EndŸnSw­16
(
U§geEnvœÚm’t
& 
’v
,

338 
F¿medSourû
* 
šputSourû
)

339 : 
	$F¿medF‹r
(
’v
, 
šputSourû
) {

340 
	}
}

342 
	gEndŸnSw­16
::~
	$EndŸnSw­16
() {

343 
	}
}

345 
EndŸnSw­16
::
	$doG‘NextF¿me
() {

347 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

348 
aá”G‘tšgF¿me
, 
this
,

349 
F¿medSourû
::
hªdËClosu»
, 
this
);

350 
	}
}

352 
	gEndŸnSw­16
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

353 
numTrunÿ‹dBy‹s
,

354 
timev®
 
´e£Á©iÚTime
,

355 
du¿tiÚInMiüo£cÚds
) {

356 
EndŸnSw­16
* 
sourû
 = (EndŸnSw­16*)
ş›ÁD©a
;

357 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

358 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

359 
	}
}

361 
	gEndŸnSw­16
::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

362 
timev®
 
´e£Á©iÚTime
,

363 
du¿tiÚInMiüo£cÚds
) {

365 
numV®ues
 = 
äameSize
/2;

366 
u_št16_t
* 
v®ue
 = (u_št16_t*)
fTo
;

367 
i
 = 0; i < 
numV®ues
; ++i) {

368 
u_št16_t
 cÚ¡ 
Üig
 = 
v®ue
[
i
];

369 
v®ue
[
i
] = ((
Üig
&0xFF)<<8) | ((orig&0xFF00)>>8);

373 
fF¿meSize
 = 
numV®ues
*2;

374 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
 + (
äameSize
 - 
fF¿meSize
);

375 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

376 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

377 
	`aá”G‘tšg
(
this
);

378 
	}
}

383 
EndŸnSw­24
*

384 
	gEndŸnSw­24
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
F¿medSourû
* 
šputSourû
) {

385  
Ãw
 
	`EndŸnSw­24
(
’v
, 
šputSourû
);

386 
	}
}

388 
	gEndŸnSw­24
::
	$EndŸnSw­24
(
U§geEnvœÚm’t
& 
’v
,

389 
F¿medSourû
* 
šputSourû
)

390 : 
	$F¿medF‹r
(
’v
, 
šputSourû
) {

391 
	}
}

393 
	gEndŸnSw­24
::~
	$EndŸnSw­24
() {

394 
	}
}

396 
EndŸnSw­24
::
	$doG‘NextF¿me
() {

398 
fIÅutSourû
->
	`g‘NextF¿me
(
fTo
, 
fMaxSize
,

399 
aá”G‘tšgF¿me
, 
this
,

400 
F¿medSourû
::
hªdËClosu»
, 
this
);

401 
	}
}

403 
	gEndŸnSw­24
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

404 
numTrunÿ‹dBy‹s
,

405 
timev®
 
´e£Á©iÚTime
,

406 
du¿tiÚInMiüo£cÚds
) {

407 
EndŸnSw­24
* 
sourû
 = (EndŸnSw­24*)
ş›ÁD©a
;

408 
sourû
->
	`aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

409 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

410 
	}
}

412 
	gEndŸnSw­24
::
	$aá”G‘tšgF¿me1
(
äameSize
, 
numTrunÿ‹dBy‹s
,

413 
timev®
 
´e£Á©iÚTime
,

414 
du¿tiÚInMiüo£cÚds
) {

416 cÚ¡ 
numV®ues
 = 
äameSize
/3;

417 
u_št8_t
* 
p
 = 
fTo
;

418 
i
 = 0; i < 
numV®ues
; ++i) {

419 
u_št8_t
 
tmp
 = 
p
[0];

420 
p
[0] =…[2];

421 
p
[2] = 
tmp
;

422 
p
 += 3;

426 
fF¿meSize
 = 
numV®ues
*3;

427 
fNumTrunÿ‹dBy‹s
 = 
numTrunÿ‹dBy‹s
 + (
äameSize
 - 
fF¿meSize
);

428 
fP»£Á©iÚTime
 = 
´e£Á©iÚTime
;

429 
fDu¿tiÚInMiüo£cÚds
 = 
du¿tiÚInMiüo£cÚds
;

430 
	`aá”G‘tšg
(
this
);

431 
	}
}

	@mediaServer/DynamicRTSPServer.cpp

21 
	~"DyÇmicRTSPS”v”.hh
"

22 
	~<liveMedŸ.hh
>

23 
	~<¡ršg.h
>

25 
DyÇmicRTSPS”v”
*

26 
	gDyÇmicRTSPS”v”
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
PÜt
 
ourPÜt
,

27 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
,

28 
»şam©iÚTe¡SecÚds
) {

29 
ourSock‘
 = 
	`£tUpOurSock‘
(
’v
, 
ourPÜt
);

30 ià(
ourSock‘
 =ğ-1è 
NULL
;

32  
Ãw
 
	`DyÇmicRTSPS”v”
(
’v
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 
»şam©iÚTe¡SecÚds
);

33 
	}
}

35 
	gDyÇmicRTSPS”v”
::
	$DyÇmicRTSPS”v”
(
U§geEnvœÚm’t
& 
’v
, 
ourSock‘
,

36 
PÜt
 
ourPÜt
,

37 
U£rAuth’tiÿtiÚD©aba£
* 
authD©aba£
, 
»şam©iÚTe¡SecÚds
)

38 : 
	$RTSPS”v”SuµÜtšgHTTPSŒ—mšg
(
’v
, 
ourSock‘
, 
ourPÜt
, 
authD©aba£
, 
»şam©iÚTe¡SecÚds
) {

39 
	}
}

41 
	gDyÇmicRTSPS”v”
::~
	$DyÇmicRTSPS”v”
() {

42 
	}
}

44 
S”v”MedŸSessiÚ
* 
ü—‹NewSMS
(
U§geEnvœÚm’t
& 
’v
,

45 cÚ¡* 
feName
, 
FILE
* 
fid
);

47 
S”v”MedŸSessiÚ
* 
	gDyÇmicRTSPS”v”


48 ::
	$lookupS”v”MedŸSessiÚ
(cÚ¡* 
¡»amName
, 
BoŞ—n
 
isFœ¡LookupInSessiÚ
) {

50 
FILE
* 
fid
 = 
	`fİ’
(
¡»amName
, "rb");

51 
BoŞ—n
 
feExi¡s
 = 
fid
 !ğ
NULL
;

54 
S”v”MedŸSessiÚ
* 
sms
 = 
RTSPS”v”
::
	`lookupS”v”MedŸSessiÚ
(
¡»amName
);

55 
BoŞ—n
 
smsExi¡s
 = 
sms
 !ğ
NULL
;

58 ià(!
feExi¡s
) {

59 ià(
smsExi¡s
) {

61 
	`»moveS”v”MedŸSessiÚ
(
sms
);

62 
sms
 = 
NULL
;

65  
NULL
;

67 ià(
smsExi¡s
 && 
isFœ¡LookupInSessiÚ
) {

70 
	`»moveS”v”MedŸSessiÚ
(
sms
);

71 
sms
 = 
NULL
;

74 ià(
sms
 =ğ
NULL
) {

75 
sms
 = 
	`ü—‹NewSMS
(
	`’vœ
(), 
¡»amName
, 
fid
);

76 
	`addS”v”MedŸSessiÚ
(
sms
);

79 
	`fşo£
(
fid
);

80  
sms
;

82 
	}
}

85 
	sM©roskaDemuxC»©iÚS‹
 {

86 
M©roskaFeS”v”Demux
* 
	mdemux
;

87 
	mw©chV¬ŸbË
;

89 
	$ÚM©roskaDemuxC»©iÚ
(
M©roskaFeS”v”Demux
* 
ÃwDemux
, * 
ş›ÁD©a
) {

90 
M©roskaDemuxC»©iÚS‹
* 
ü—tiÚS‹
 = (M©roskaDemuxC»©iÚS‹*)
ş›ÁD©a
;

91 
ü—tiÚS‹
->
demux
 = 
ÃwDemux
;

92 
ü—tiÚS‹
->
w©chV¬ŸbË
 = 1;

93 
	}
}

97 
	sOggDemuxC»©iÚS‹
 {

98 
OggFeS”v”Demux
* 
	mdemux
;

99 
	mw©chV¬ŸbË
;

101 
	$ÚOggDemuxC»©iÚ
(
OggFeS”v”Demux
* 
ÃwDemux
, * 
ş›ÁD©a
) {

102 
OggDemuxC»©iÚS‹
* 
ü—tiÚS‹
 = (OggDemuxC»©iÚS‹*)
ş›ÁD©a
;

103 
ü—tiÚS‹
->
demux
 = 
ÃwDemux
;

104 
ü—tiÚS‹
->
w©chV¬ŸbË
 = 1;

105 
	}
}

108 
	#NEW_SMS
(
desütiÚ
) do {\

109 cÚ¡* 
descSŒ
 = 
desütiÚ
\

111 
sms
 = 
S”v”MedŸSessiÚ
::
	`ü—‹New
(
’v
, 
feName
, feName, 
descSŒ
);\

112 } 0)

	)

114 
S”v”MedŸSessiÚ
* 
	$ü—‹NewSMS
(
U§geEnvœÚm’t
& 
’v
,

115 cÚ¡* 
feName
, 
FILE
* ) {

117 cÚ¡* 
ex‹nsiÚ
 = 
	`¡¼chr
(
feName
, '.');

118 ià(
ex‹nsiÚ
 =ğ
NULL
)  NULL;

120 
S”v”MedŸSessiÚ
* 
sms
 = 
NULL
;

121 
BoŞ—n
 cÚ¡ 
»u£Sourû
 = 
F®£
;

122 ià(
	`¡rcmp
(
ex‹nsiÚ
, ".aac") == 0) {

124 
	`NEW_SMS
("AAC Audio");

125 
sms
->
	`addSub£ssiÚ
(
ADTSAudioFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

126 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".amr") == 0) {

128 
	`NEW_SMS
("AMR Audio");

129 
sms
->
	`addSub£ssiÚ
(
AMRAudioFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

130 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".ac3") == 0) {

132 
	`NEW_SMS
("AC-3 Audio");

133 
sms
->
	`addSub£ssiÚ
(
AC3AudioFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

134 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".m4e") == 0) {

136 
	`NEW_SMS
("MPEG-4 Video");

137 
sms
->
	`addSub£ssiÚ
(
MPEG4VideoFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

138 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".264") == 0) {

140 
	`NEW_SMS
("H.264 Video");

141 
OutPack‘Bufãr
::
maxSize
 = 100000;

142 
sms
->
	`addSub£ssiÚ
(
H264VideoFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

143 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".265") == 0) {

145 
	`NEW_SMS
("H.265 Video");

146 
OutPack‘Bufãr
::
maxSize
 = 100000;

147 
sms
->
	`addSub£ssiÚ
(
H265VideoFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

148 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".mp3") == 0) {

150 
	`NEW_SMS
("MPEG-1 or 2 Audio");

157 
BoŞ—n
 
u£ADUs
 = 
F®£
;

158 
IÁ”Ëavšg
* 
š‹¾—všg
 = 
NULL
;

159 #ifdeà
STREAM_USING_ADUS


160 
u£ADUs
 = 
True
;

161 #ifdeà
INTERLEAVE_ADUS


162 
š‹¾—veCyşe
[] = {0,2,1,3};

163 cÚ¡ 
š‹¾—veCyşeSize


164 ğ( 
š‹¾—veCyşe
)/( ());

165 
š‹¾—všg
 = 
Ãw
 
	`IÁ”Ëavšg
(
š‹¾—veCyşeSize
, 
š‹¾—veCyşe
);

168 
sms
->
	`addSub£ssiÚ
(
MP3AudioFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
, 
u£ADUs
, 
š‹¾—všg
));

169 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".mpg") == 0) {

171 
	`NEW_SMS
("MPEG-1 or 2 Program Stream");

172 
MPEG1Ü2FeS”v”Demux
* 
demux


173 ğ
MPEG1Ü2FeS”v”Demux
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
);

174 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwVideoS”v”MedŸSub£ssiÚ
());

175 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwAudioS”v”MedŸSub£ssiÚ
());

176 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".vob") == 0) {

178 
	`NEW_SMS
("VOB (MPEG-2 video with AC-3‡udio)");

179 
MPEG1Ü2FeS”v”Demux
* 
demux


180 ğ
MPEG1Ü2FeS”v”Demux
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
);

181 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwVideoS”v”MedŸSub£ssiÚ
());

182 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwAC3AudioS”v”MedŸSub£ssiÚ
());

183 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".ts") == 0) {

186 
šdexFeNameL’
 = 
	`¡¾’
(
feName
) + 2;

187 * 
šdexFeName
 = 
Ãw
 [
šdexFeNameL’
];

188 
	`¥rštf
(
šdexFeName
, "%sx", 
feName
);

189 
	`NEW_SMS
("MPEG Transport Stream");

190 
sms
->
	`addSub£ssiÚ
(
MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
šdexFeName
, 
»u£Sourû
));

191 
d–‘e
[] 
šdexFeName
;

192 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".wav") == 0) {

194 
	`NEW_SMS
("WAV Audio Stream");

197 
BoŞ—n
 
cÚv”tToULaw
 = 
F®£
;

198 
sms
->
	`addSub£ssiÚ
(
WAVAudioFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
, 
cÚv”tToULaw
));

199 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".dv") == 0) {

202 
OutPack‘Bufãr
::
maxSize
 = 300000;

204 
	`NEW_SMS
("DV Video");

205 
sms
->
	`addSub£ssiÚ
(
DVVideoFeS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(
’v
, 
feName
, 
»u£Sourû
));

206 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".mkv") == 0 || strcmp(extension, ".webm") == 0) {

208 
OutPack‘Bufãr
::
maxSize
 = 100000;

209 
	`NEW_SMS
("Matroska video+audio+(optional)subtitles");

213 
M©roskaDemuxC»©iÚS‹
 
ü—tiÚS‹
;

214 
ü—tiÚS‹
.
w©chV¬ŸbË
 = 0;

215 
M©roskaFeS”v”Demux
::
	`ü—‹New
(
’v
, 
feName
, 
ÚM©roskaDemuxC»©iÚ
, &
ü—tiÚS‹
);

216 
’v
.
	`skScheduËr
().
	`doEv’tLoİ
(&
ü—tiÚS‹
.
w©chV¬ŸbË
);

218 
S”v”MedŸSub£ssiÚ
* 
smss
;

219 (
smss
 = 
ü—tiÚS‹
.
demux
->
	`ÃwS”v”MedŸSub£ssiÚ
()è!ğ
NULL
) {

220 
sms
->
	`addSub£ssiÚ
(
smss
);

222 } ià(
	`¡rcmp
(
ex‹nsiÚ
, ".ogg") == 0 || strcmp(extension, ".ogv") == 0 || strcmp(extension, ".opus") == 0) {

224 
	`NEW_SMS
("Ogg video‡nd/or‡udio");

228 
OggDemuxC»©iÚS‹
 
ü—tiÚS‹
;

229 
ü—tiÚS‹
.
w©chV¬ŸbË
 = 0;

230 
OggFeS”v”Demux
::
	`ü—‹New
(
’v
, 
feName
, 
ÚOggDemuxC»©iÚ
, &
ü—tiÚS‹
);

231 
’v
.
	`skScheduËr
().
	`doEv’tLoİ
(&
ü—tiÚS‹
.
w©chV¬ŸbË
);

233 
S”v”MedŸSub£ssiÚ
* 
smss
;

234 (
smss
 = 
ü—tiÚS‹
.
demux
->
	`ÃwS”v”MedŸSub£ssiÚ
()è!ğ
NULL
) {

235 
sms
->
	`addSub£ssiÚ
(
smss
);

239  
sms
;

240 
	}
}

	@mediaServer/live555MediaServer.cpp

20 
	~<BasicU§geEnvœÚm’t.hh
>

21 
	~"DyÇmicRTSPS”v”.hh
"

22 
	~"v”siÚ.hh
"

24 
	$maš
(
¬gc
, ** 
¬gv
) {

26 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

27 
U§geEnvœÚm’t
* 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

29 
U£rAuth’tiÿtiÚD©aba£
* 
authDB
 = 
NULL
;

30 #ifdeà
ACCESS_CONTROL


32 
authDB
 = 
Ãw
 
U£rAuth’tiÿtiÚD©aba£
;

33 
authDB
->
	`addU£rRecÜd
("username1", "password1");

40 
RTSPS”v”
* 
¹¥S”v”
;

41 
pÜtNumB™s
 
¹¥S”v”PÜtNum
 = 554;

42 
¹¥S”v”
 = 
DyÇmicRTSPS”v”
::
	`ü—‹New
(*
’v
, 
¹¥S”v”PÜtNum
, 
authDB
);

43 ià(
¹¥S”v”
 =ğ
NULL
) {

44 
¹¥S”v”PÜtNum
 = 8554;

45 
¹¥S”v”
 = 
DyÇmicRTSPS”v”
::
	`ü—‹New
(*
’v
, 
¹¥S”v”PÜtNum
, 
authDB
);

47 ià(
¹¥S”v”
 =ğ
NULL
) {

48 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

49 
	`ex™
(1);

52 *
’v
 << "LIVE555 Media Server\n";

53 *
’v
 << "\tv”siÚ " << 
MEDIA_SERVER_VERSION_STRING


55 << 
LIVEMEDIA_LIBRARY_VERSION_STRING
 << ").\n";

57 * 
u¾P»fix
 = 
¹¥S”v”
->
	`¹¥URLP»fix
();

58 *
’v
 << "Play streams fromhis server usinghe URL\n\t"

59 << 
u¾P»fix
 << "<filename>\nwhere <filename> is‡ file…resent inhe current directory.\n";

60 *
’v
 << "Each file'sype is inferred from its‚ame suffix:\n";

61 *
’v
 << "\t\".264\" =>‡ H.264 Video Elementary Stream file\n";

62 *
’v
 << "\t\".265\" =>‡ H.265 Video Elementary Stream file\n";

63 *
’v
 << "\t\".aac\" =>‡n AAC Audio (ADTS format) file\n";

64 *
’v
 << "\t\".ac3\" =>‡n AC-3 Audio file\n";

65 *
’v
 << "\t\".amr\" =>‡n AMR Audio file\n";

66 *
’v
 << "\t\".dv\" =>‡ DV Video file\n";

67 *
’v
 << "\t\".m4e\" =>‡ MPEG-4 Video Elementary Stream file\n";

68 *
’v
 << "\t\".mkv\" =>‡ Matroska‡udio+video+(optional)subtitles file\n";

69 *
’v
 << "\t\".mp3\" =>‡ MPEG-1 or 2 Audio file\n";

70 *
’v
 << "\t\".mpg\" =>‡ MPEG-1 or 2 Program Stream (audio+video) file\n";

71 *
’v
 << "\t\".ogg\" or \".ogv\" or \".opus\" =>‡n Ogg‡udio‡nd/or video file\n";

72 *
’v
 << "\t\".ts\" =>‡ MPEG Transport Stream file\n";

73 *
’v
 << "\t\t(a \".tsx\" index file - if…resent -…rovides server 'trick…lay' support)\n";

74 *
’v
 << "\t\".vob\" =>‡ VOB (MPEG-2 video with AC-3‡udio) file\n";

75 *
’v
 << "\t\".wav\" =>‡ WAV Audio file\n";

76 *
’v
 << "\t\".webm\" =>‡ WebM‡udio(Vorbis)+video(VP8) file\n";

77 *
’v
 << "See http://www.live555.com/mediaServer/ for‡dditional documentation.\n";

83 ià(
¹¥S”v”
->
	`£tUpTuÂ–šgOv”HTTP
(80) ||„tspServer->setUpTunnelingOverHTTP(8000) ||„tspServer->setUpTunnelingOverHTTP(8080)) {

84 *
’v
 << "(Wu£…Üˆ" << 
¹¥S”v”
->
	`h‰pS”v”PÜtNum
() << " for optional RTSP-over-HTTPunneling, or for HTTP†ive streaming (for indexed Transport Stream files only).)\n";

86 *
’v
 << "(RTSP-over-HTTPunneling is‚ot‡vailable.)\n";

89 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

92 
	}
}

	@proxyServer/live555ProxyServer.cpp

20 
	~"liveMedŸ.hh
"

21 
	~"BasicU§geEnvœÚm’t.hh
"

23 cÚ¡* 
	g´ogName
;

24 
U§geEnvœÚm’t
* 
	g’v
;

25 
U£rAuth’tiÿtiÚD©aba£
* 
	gauthDB
 = 
NULL
;

26 
U£rAuth’tiÿtiÚD©aba£
* 
	gauthDBFÜREGISTER
 = 
NULL
;

29 
	gv”bos™yLev–
 = 0;

30 
BoŞ—n
 
	g¡»amRTPOv”TCP
 = 
F®£
;

31 
pÜtNumB™s
 
	gtuÂ–Ov”HTTPPÜtNum
 = 0;

32 * 
	gu£ºame
 = 
NULL
;

33 * 
	g·sswÜd
 = 
NULL
;

34 
BoŞ—n
 
	g´oxyREGISTERReque¡s
 = 
F®£
;

35 * 
	gu£ºameFÜREGISTER
 = 
NULL
;

36 * 
	g·sswÜdFÜREGISTER
 = 
NULL
;

38 
RTSPS”v”
* 
	$ü—‹RTSPS”v”
(
PÜt
 
pÜt
) {

39 ià(
´oxyREGISTERReque¡s
) {

40  
RTSPS”v”W™hREGISTERProxyšg
::
	`ü—‹New
(*
’v
, 
pÜt
, 
authDB
, 
authDBFÜREGISTER
, 65, 
¡»amRTPOv”TCP
, 
v”bos™yLev–
);

42  
RTSPS”v”
::
	`ü—‹New
(*
’v
, 
pÜt
, 
authDB
);

44 
	}
}

46 
	$u§ge
() {

47 *
’v
 << "U§ge: " << 
´ogName


53 
	`ex™
(1);

54 
	}
}

56 
	$maš
(
¬gc
, ** 
¬gv
) {

59 
OutPack‘Bufãr
::
maxSize
 = 100000;

62 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

63 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

65 *
’v
 << "LIVE555 Proxy Server\n"

67 << 
LIVEMEDIA_LIBRARY_VERSION_STRING
 << ")\n\n";

70 
´ogName
 = 
¬gv
[0];

71 ià(
¬gc
 < 2è
	`u§ge
();

72 
¬gc
 > 1) {

74 * cÚ¡ 
İt
 = 
¬gv
[1];

75 ià(
İt
[0] != '-') ;

77 
İt
[1]) {

79 
v”bos™yLev–
 = 1;

84 
v”bos™yLev–
 = 2;

91 
¡»amRTPOv”TCP
 = 
True
;

97 ià(
¬gc
 > 3 && 
¬gv
[2][0] != '-') {

99 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
tuÂ–Ov”HTTPPÜtNum
) == 1

100 && 
tuÂ–Ov”HTTPPÜtNum
 > 0) {

101 ++
¬gv
; --
¬gc
;

107 
	`u§ge
();

112 ià(
¬gc
 < 4è
	`u§ge
();

113 
u£ºame
 = 
¬gv
[2];

114 
·sswÜd
 = 
¬gv
[3];

115 
¬gv
 +ğ2; 
¬gc
 -= 2;

120 ià(
¬gc
 < 4è
	`u§ge
();

121 
u£ºameFÜREGISTER
 = 
¬gv
[2];

122 
·sswÜdFÜREGISTER
 = 
¬gv
[3];

124 ià(
authDBFÜREGISTER
 =ğ
NULL
èauthDBFÜREGISTER = 
Ãw
 
U£rAuth’tiÿtiÚD©aba£
;

125 
authDBFÜREGISTER
->
	`addU£rRecÜd
(
u£ºameFÜREGISTER
, 
·sswÜdFÜREGISTER
);

126 
¬gv
 +ğ2; 
¬gc
 -= 2;

131 
´oxyREGISTERReque¡s
 = 
True
;

136 
	`u§ge
();

141 ++
¬gv
; --
¬gc
;

143 ià(
¬gc
 < 2 && !
´oxyREGISTERReque¡s
è
	`u§ge
();

145 
i
;

146 
i
 = 1; i < 
¬gc
; ++i) {

147 ià(
	`¡ºcmp
(
¬gv
[
i
], "¹¥://", 7è!ğ0è
	`u§ge
();

150 ià(
authDBFÜREGISTER
 !ğ
NULL
 && !
´oxyREGISTERReque¡s
) {

151 *
’v
 << "The '-U <username> <password>' option can be used only with -R\n";

152 
	`u§ge
();

154 ià(
¡»amRTPOv”TCP
) {

155 ià(
tuÂ–Ov”HTTPPÜtNum
 > 0) {

156 *
’v
 << "The -t‡nd -T options cannot both be used!\n";

157 
	`u§ge
();

159 
tuÂ–Ov”HTTPPÜtNum
 = (
pÜtNumB™s
)(~0);

163 #ifdeà
ACCESS_CONTROL


165 
authDB
 = 
Ãw
 
U£rAuth’tiÿtiÚD©aba£
;

166 
authDB
->
	`addU£rRecÜd
("username1", "password1");

172 
RTSPS”v”
* 
¹¥S”v”
;

173 
pÜtNumB™s
 
¹¥S”v”PÜtNum
 = 554;

174 
¹¥S”v”
 = 
	`ü—‹RTSPS”v”
(
¹¥S”v”PÜtNum
);

175 ià(
¹¥S”v”
 =ğ
NULL
) {

176 
¹¥S”v”PÜtNum
 = 8554;

177 
¹¥S”v”
 = 
	`ü—‹RTSPS”v”
(
¹¥S”v”PÜtNum
);

179 ià(
¹¥S”v”
 =ğ
NULL
) {

180 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

181 
	`ex™
(1);

185 
i
 = 1; i < 
¬gc
; ++i) {

186 cÚ¡* 
´ox›dSŒ—mURL
 = 
¬gv
[
i
];

187 
¡»amName
[30];

188 ià(
¬gc
 == 2) {

189 
	`¥rštf
(
¡»amName
, "%s", "proxyStream");

191 
	`¥rštf
(
¡»amName
, "´oxySŒ—m-%d", 
i
);

193 
S”v”MedŸSessiÚ
* 
sms


194 ğ
ProxyS”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¹¥S”v”
,

195 
´ox›dSŒ—mURL
, 
¡»amName
,

196 
u£ºame
, 
·sswÜd
, 
tuÂ–Ov”HTTPPÜtNum
, 
v”bos™yLev–
);

197 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

199 * 
´oxySŒ—mURL
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

200 *
’v
 << "RTSP sŒ—m,…roxyšgh¡»am \"" << 
´ox›dSŒ—mURL
 << "\"\n";

201 *
’v
 << "\tPÏyhi ¡»am usšghURL: " << 
´oxySŒ—mURL
 << "\n";

202 
d–‘e
[] 
´oxySŒ—mURL
;

205 ià(
´oxyREGISTERReque¡s
) {

206 *
’v
 << "(WhªdË incomšg \"REGISTER\"„eque¡ Ú…Üˆ" << 
¹¥S”v”PÜtNum
 << ")\n";

213 ià(
¹¥S”v”
->
	`£tUpTuÂ–šgOv”HTTP
(80) ||„tspServer->setUpTunnelingOverHTTP(8000) ||„tspServer->setUpTunnelingOverHTTP(8080)) {

214 *
’v
 << "\n(Wu£…Üˆ" << 
¹¥S”v”
->
	`h‰pS”v”PÜtNum
() << " for optional RTSP-over-HTTPunneling.)\n";

216 *
’v
 << "\n(RTSP-over-HTTPunneling is‚ot‡vailable.)\n";

220 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

223 
	}
}

	@raspi/testRaspi.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

24 
U§geEnvœÚm’t
* 
	g’v
;

29 
BoŞ—n
 
	g»u£Fœ¡Sourû
 = 
F®£
;

34 
BoŞ—n
 
	giF¿mesOÆy
 = 
F®£
;

36 
ªnounûSŒ—m
(
RTSPS”v”
* 
¹¥S”v”
, 
S”v”MedŸSessiÚ
* 
sms
,

37 cÚ¡* 
¡»amName
, cÚ¡* 
šputFeName
);

39 
	$maš
(
¬gc
, ** 
¬gv
) {

42 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

43 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

45 
U£rAuth’tiÿtiÚD©aba£
* 
authDB
 = 
NULL
;

46 #ifdeà
ACCESS_CONTROL


48 
authDB
 = 
Ãw
 
U£rAuth’tiÿtiÚD©aba£
;

49 
authDB
->
	`addU£rRecÜd
("username1", "password1");

55 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554, 
authDB
);

56 ià(
¹¥S”v”
 =ğ
NULL
) {

57 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

58 
	`ex™
(1);

61 cÚ¡* 
desütiÚSŒšg
 = "Session streamed by \"testRTSPServer\"";

70 cÚ¡* 
¡»amName
 = "h264";

72 cÚ¡* 
šputFeName
 = "stdin";

74 
S”v”MedŸSessiÚ
* 
sms
 = S”v”MedŸSessiÚ::
	`ü—‹New
(*
’v
, 
¡»amName
, sŒ—mName, 
desütiÚSŒšg
);

76 
sms
->
	`addSub£ssiÚ
Ğ
H264VideoFeS”v”MedŸSub£ssiÚ
 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

78 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

80 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

87 ià(
¹¥S”v”
->
	`£tUpTuÂ–šgOv”HTTP
(80) ||„tspServer->setUpTunnelingOverHTTP(8000) ||„tspServer->setUpTunnelingOverHTTP(8080)) {

88 *
’v
 << "\n(Wu£…Üˆ" << 
¹¥S”v”
->
	`h‰pS”v”PÜtNum
() << " for optional RTSP-over-HTTPunneling.)\n";

90 *
’v
 << "\n(RTSP-over-HTTPunneling is‚ot‡vailable.)\n";

93 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

96 
	}
}

98 
	$ªnounûSŒ—m
(
RTSPS”v”
* 
¹¥S”v”
, 
S”v”MedŸSessiÚ
* 
sms
,

99 cÚ¡* 
¡»amName
, cÚ¡* 
šputFeName
) {

100 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

101 
U§geEnvœÚm’t
& 
’v
 = 
¹¥S”v”
->
	`’vœ
();

102 
’v
 << "\n\"" << 
¡»amName
 << "\" stream, fromhe file \""

103 << 
šputFeName
 << "\"\n";

104 
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

105 
d–‘e
[] 
u¾
;

106 
	}
}

	@testProgs/MPEG2TransportStreamIndexer.cpp

23 
	~<liveMedŸ.hh
>

24 
	~<BasicU§geEnvœÚm’t.hh
>

26 
aá”PÏyšg
(* 
ş›ÁD©a
);

28 
U§geEnvœÚm’t
* 
	g’v
;

29 cÚ¡* 
	g´og¿mName
;

31 
	$u§ge
() {

32 *
’v
 << "u§ge: " << 
´og¿mName
 << " <transport-stream-file-name>\n";

33 *
’v
 << "\twhere <transport-stream-file-name>ƒnds with \".ts\"\n";

34 
	`ex™
(1);

35 
	}
}

37 
	$maš
(
¬gc
, cÚ¡** 
¬gv
) {

39 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

40 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

43 
´og¿mName
 = 
¬gv
[0];

44 ià(
¬gc
 !ğ2è
	`u§ge
();

46 cÚ¡* 
šputFeName
 = 
¬gv
[1];

48 
Ën
 = 
	`¡¾’
(
šputFeName
);

49 ià(
Ën
 < 4 || 
	`¡rcmp
(&
šputFeName
[len-3], ".ts") != 0) {

50 *
’v
 << "ERROR: iÅuˆfÇm\"" << 
šputFeName


52 
	`u§ge
();

56 
F¿medSourû
* 
šput


57 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
TRANSPORT_PACKET_SIZE
);

58 ià(
šput
 =ğ
NULL
) {

59 *
’v
 << "FaedØİ’ iÅuˆf\"" << 
šputFeName
 << "\" (does itƒxist?)\n";

60 
	`ex™
(1);

64 
F¿medSourû
* 
šdex”


65 ğ
MPEG2IF¿meIndexFromT¿n¥ÜtSŒ—m
::
	`ü—‹New
(*
’v
, 
šput
);

68 * 
ouutFeName
 = 
Ãw
 [
Ën
+2];

69 
	`¥rštf
(
ouutFeName
, "%sx", 
šputFeName
);

72 
MedŸSšk
* 
ouut
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName
);

73 ià(
ouut
 =ğ
NULL
) {

74 *
’v
 << "FaedØİ’ ouuˆf\"" << 
ouutFeName
 << "\"\n";

75 
	`ex™
(1);

79 *
’v
 << "Wr™šg index f\"" << 
ouutFeName
 << "\"...";

80 
ouut
->
	`¡¬tPÏyšg
(*
šdex”
, 
aá”PÏyšg
, 
NULL
);

82 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

85 
	}
}

87 
	$aá”PÏyšg
(* ) {

88 *
’v
 << "...done\n";

89 
	`ex™
(0);

90 
	}
}

	@testProgs/openRTSP.cpp

24 
	~"¶ayCommÚ.hh
"

26 
RTSPCl›Á
* 
	gourRTSPCl›Á
 = 
NULL
;

27 
Medium
* 
	$ü—‹Cl›Á
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
u¾
, 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
) {

28 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
;

29  
ourRTSPCl›Á
 = 
RTSPCl›Á
::
	`ü—‹New
(
’v
, 
u¾
, 
v”bos™yLev–
, 
­¶iÿtiÚName
, 
tuÂ–Ov”HTTPPÜtNum
);

30 
	}
}

32 
	$assignCl›Á
(
Medium
* 
ş›Á
) {

33 
ourRTSPCl›Á
 = (
RTSPCl›Á
*)
ş›Á
;

34 
	}
}

36 
g‘O±iÚs
(
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

37 
ourRTSPCl›Á
->
£ndO±iÚsCommªd
(
aá”Func
, 
ourAuth’tiÿtÜ
);

40 
g‘SDPDesütiÚ
(
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

41 
ourRTSPCl›Á
->
£ndDesüibeCommªd
(
aá”Func
, 
ourAuth’tiÿtÜ
);

44 
£tupSub£ssiÚ
(
MedŸSub£ssiÚ
* 
sub£ssiÚ
, 
BoŞ—n
 
¡»amUsšgTCP
, BoŞ—À
fÜûMuÉiÿ¡OnUn¥ecif›d
, 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

46 
ourRTSPCl›Á
->
£ndS‘upCommªd
(*
sub£ssiÚ
, 
aá”Func
, 
F®£
, 
¡»amUsšgTCP
, 
fÜûMuÉiÿ¡OnUn¥ecif›d
, 
ourAuth’tiÿtÜ
);

49 
¡¬tPÏyšgSessiÚ
(
MedŸSessiÚ
* 
£ssiÚ
, 
¡¬t
, 
’d
, 
sÿË
, 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

50 
ourRTSPCl›Á
->
£ndPÏyCommªd
(*
£ssiÚ
, 
aá”Func
, 
¡¬t
, 
’d
, 
sÿË
, 
ourAuth’tiÿtÜ
);

53 
¡¬tPÏyšgSessiÚ
(
MedŸSessiÚ
* 
£ssiÚ
, cÚ¡* 
absS¹Time
, cÚ¡* 
absEndTime
, 
sÿË
, 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

54 
ourRTSPCl›Á
->
£ndPÏyCommªd
(*
£ssiÚ
, 
aá”Func
, 
absS¹Time
, 
absEndTime
, 
sÿË
, 
ourAuth’tiÿtÜ
);

57 
‹¬DownSessiÚ
(
MedŸSessiÚ
* 
£ssiÚ
, 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

58 
ourRTSPCl›Á
->
£ndT—rdownCommªd
(*
£ssiÚ
, 
aá”Func
, 
ourAuth’tiÿtÜ
);

61 
	$£tU£rAg’tSŒšg
(cÚ¡* 
u£rAg’tSŒšg
) {

62 
ourRTSPCl›Á
->
	`£tU£rAg’tSŒšg
(
u£rAg’tSŒšg
);

63 
	}
}

65 
BoŞ—n
 
	g®lowProxyS”v”s
 = 
F®£
;

66 
BoŞ—n
 
	gcÚŒŞCÚÃùiÚU£sTCP
 = 
True
;

67 
BoŞ—n
 
	gsuµÜtCodecS–eùiÚ
 = 
F®£
;

68 cÚ¡* 
	gş›ÁPrÙocŞName
 = "RTSP";

	@testProgs/playCommon.cpp

24 
	~"¶ayCommÚ.hh
"

25 
	~"BasicU§geEnvœÚm’t.hh
"

26 
	~"GroupsockH–³r.hh
"

28 #ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
)

29 
	#¢´štf
 
_¢´štf


	)

31 
	~<sigÇl.h
>

32 
	#USE_SIGNALS
 1

	)

36 
cÚtšueAá”Cl›ÁC»©iÚ0
(
RTSPCl›Á
* 
ş›Á
, 
BoŞ—n
 
»que¡SŒ—mšgOv”TCP
);

37 
cÚtšueAá”Cl›ÁC»©iÚ1
();

38 
cÚtšueAá”OPTIONS
(
RTSPCl›Á
* 
ş›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

39 
cÚtšueAá”DESCRIBE
(
RTSPCl›Á
* 
ş›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

40 
cÚtšueAá”SETUP
(
RTSPCl›Á
* 
ş›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

41 
cÚtšueAá”PLAY
(
RTSPCl›Á
* 
ş›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

42 
cÚtšueAá”TEARDOWN
(
RTSPCl›Á
* 
ş›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

44 
ü—‹OuutFes
(cÚ¡* 
³riodicF’ameSuffix
);

45 
ü—‹P”iodicOuutFes
();

46 
£tupSŒ—ms
();

47 
şo£MedŸSšks
();

48 
sub£ssiÚAá”PÏyšg
(* 
ş›ÁD©a
);

49 
sub£ssiÚByeHªdËr
(* 
ş›ÁD©a
);

50 
£ssiÚAá”PÏyšg
(* 
ş›ÁD©a
 = 
NULL
);

51 
£ssiÚTim”HªdËr
(* 
ş›ÁD©a
);

52 
³riodicFeOuutTim”HªdËr
(* 
ş›ÁD©a
);

53 
shutdown
(
ex™Code
 = 1);

54 
sigÇlHªdËrShutdown
(
sig
);

55 
checkFÜPack‘A¼iv®
(* 
ş›ÁD©a
);

56 
checkIÁ”Pack‘G­s
(* 
ş›ÁD©a
);

57 
checkSessiÚTimeoutBrok’S”v”
(* 
ş›ÁD©a
);

58 
begšQOSM—su»m’t
();

60 cÚ¡* 
	g´ogName
;

61 
U§geEnvœÚm’t
* 
	g’v
;

62 
Medium
* 
	gourCl›Á
 = 
NULL
;

63 
Auth’tiÿtÜ
* 
	gourAuth’tiÿtÜ
 = 
NULL
;

64 cÚ¡* 
	g¡»amURL
 = 
NULL
;

65 
MedŸSessiÚ
* 
	g£ssiÚ
 = 
NULL
;

66 
TaskTok’
 
	g£ssiÚTim”Task
 = 
NULL
;

67 
TaskTok’
 
	g£ssiÚTimeoutBrok’S”v”Task
 = 
NULL
;

68 
TaskTok’
 
	g¬riv®CheckTim”Task
 = 
NULL
;

69 
TaskTok’
 
	gš‹rPack‘G­CheckTim”Task
 = 
NULL
;

70 
TaskTok’
 
	gqosM—su»m’tTim”Task
 = 
NULL
;

71 
TaskTok’
 
	g³riodicFeOuutTask
 = 
NULL
;

72 
BoŞ—n
 
	gü—‹Reûiv”s
 = 
True
;

73 
BoŞ—n
 
	gouutQuickTimeFe
 = 
F®£
;

74 
BoŞ—n
 
	gg’”©eMP4FÜm©
 = 
F®£
;

75 
QuickTimeFeSšk
* 
	gqtOut
 = 
NULL
;

76 
BoŞ—n
 
	gouutAVIFe
 = 
F®£
;

77 
AVIFeSšk
* 
	gaviOut
 = 
NULL
;

78 
BoŞ—n
 
	gaudioOÆy
 = 
F®£
;

79 
BoŞ—n
 
	gvideoOÆy
 = 
F®£
;

80 cÚ¡* 
	gsšgËMedium
 = 
NULL
;

81 
	gv”bos™yLev–
 = 1;

82 
	gdu¿tiÚ
 = 0;

83 
	gdu¿tiÚSlİ
 = -1.0;

84 
	gš™ŸlS“kTime
 = 0.0f;

85 * 
	gš™ŸlAbsŞu‹S“kTime
 = 
NULL
;

86 
	gsÿË
 = 1.0f;

87 
	g’dTime
;

88 
	gš‹rPack‘G­MaxTime
 = 0;

89 
	gtÙNumPack‘sReûived
 = ~0;

90 
BoŞ—n
 
	g¶ayCÚtšuou¦y
 = 
F®£
;

91 
	gsim¶eRTPoff£tArg
 = -1;

92 
BoŞ—n
 
	g£ndO±iÚsReque¡
 = 
True
;

93 
BoŞ—n
 
	g£ndO±iÚsReque¡OÆy
 = 
F®£
;

94 
BoŞ—n
 
	gÚeFeP”F¿me
 = 
F®£
;

95 
BoŞ—n
 
	gnÙifyOnPack‘A¼iv®
 = 
F®£
;

96 
BoŞ—n
 
	g£ndK“pAlivesToBrok’S”v”s
 = 
F®£
;

97 
	g£ssiÚTimeoutP¬am‘”
 = 0;

98 
BoŞ—n
 
	g¡»amUsšgTCP
 = 
F®£
;

99 
BoŞ—n
 
	gfÜûMuÉiÿ¡OnUn¥ecif›d
 = 
F®£
;

100 
	gdesœedPÜtNum
 = 0;

101 
pÜtNumB™s
 
	gtuÂ–Ov”HTTPPÜtNum
 = 0;

102 * 
	gu£ºame
 = 
NULL
;

103 * 
	g·sswÜd
 = 
NULL
;

104 * 
	g´oxyS”v”Name
 = 
NULL
;

105 
	g´oxyS”v”PÜtNum
 = 0;

106 
	gdesœedAudioRTPPaylßdFÜm©
 = 0;

107 * 
	gmimeSubty³
 = 
NULL
;

108 
	gmov›Width
 = 240;

109 
BoŞ—n
 
	gmov›WidthO±iÚS‘
 = 
F®£
;

110 
	gmov›Height
 = 180;

111 
BoŞ—n
 
	gmov›HeightO±iÚS‘
 = 
F®£
;

112 
	gmov›FPS
 = 15;

113 
BoŞ—n
 
	gmov›FPSO±iÚS‘
 = 
F®£
;

114 cÚ¡* 
	gfeNameP»fix
 = "";

115 
	gfeSškBufãrSize
 = 100000;

116 
	gsock‘IÅutBufãrSize
 = 0;

117 
BoŞ—n
 
	g·ck‘LossCom³n§‹
 = 
F®£
;

118 
BoŞ—n
 
	gsyncSŒ—ms
 = 
F®£
;

119 
BoŞ—n
 
	gg’”©eHštT¿cks
 = 
F®£
;

120 
BoŞ—n
 
	gwa™FÜRe¥Ú£ToTEARDOWN
 = 
True
;

121 
	gqosM—su»m’tIÁ”v®MS
 = 0;

122 * 
	gu£rAg’t
 = 
NULL
;

123 
	gfeOuutIÁ”v®
 = 0;

124 
	gfeOuutSecÚdsSoF¬
 = 0;

125 
BoŞ—n
 
	gü—‹HªdËrS”v”FÜREGISTERCommªd
 = 
F®£
;

126 
pÜtNumB™s
 
	ghªdËrS”v”FÜREGISTERCommªdPÜtNum
 = 0;

127 
HªdËrS”v”FÜREGISTERCommªd
* 
	ghªdËrS”v”FÜREGISTERCommªd
;

128 * 
	gu£ºameFÜREGISTER
 = 
NULL
;

129 * 
	g·sswÜdFÜREGISTER
 = 
NULL
;

130 
U£rAuth’tiÿtiÚD©aba£
* 
	gauthDBFÜREGISTER
 = 
NULL
;

132 
timev®
 
	g¡¬tTime
;

134 
	$u§ge
() {

135 *
’v
 << "U§ge: " << 
´ogName


137 << (
cÚŒŞCÚÃùiÚU£sTCP
 ? " [-t|-T <http-port>]" : "")

139 << (
®lowProxyS”v”s
 ? " [<proxy-server> [<proxy-server-port>]]" : "")

140 << "]" << (
suµÜtCodecS–eùiÚ
 ? " [-A <audio-codec-rtp-payload-format-code>|-M <mime-subtype-name>]" : "")

144 << " [-w <width> -h <height>] [-à<äames-³r-£cÚd>] [-y] [-H] [-Q [<m—su»m’t-š‹rv®>]] [-F <f’ame-´efix>] [-b <fe-sšk-bufãr-size>] [-B <šput-sock‘-bufãr-size>] [-I <šput-š‹rçû--add»ss>] [-m] [<u¾>|-R [<pÜt-num>]] (Ü " << 
´ogName
 << " -o [-V] <url>)\n";

145 
	`shutdown
();

146 
	}
}

148 
	$maš
(
¬gc
, ** 
¬gv
) {

150 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

151 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

153 
´ogName
 = 
¬gv
[0];

155 
	`g‘timeofday
(&
¡¬tTime
, 
NULL
);

157 #ifdeà
USE_SIGNALS


159 
	`sigÇl
(
SIGHUP
, 
sigÇlHªdËrShutdown
);

160 
	`sigÇl
(
SIGUSR1
, 
sigÇlHªdËrShutdown
);

164 
¬gc
 > 1) {

165 * cÚ¡ 
İt
 = 
¬gv
[1];

166 ià(
İt
[0] != '-') {

167 ià(
¬gc
 == 2) ;

168 
	`u§ge
();

171 
İt
[1]) {

173 
pÜtArg
;

174 ià(
	`ssÿnf
(
¬gv
[2], "%d", &
pÜtArg
) != 1) {

175 
	`u§ge
();

177 ià(
pÜtArg
 <= 0 ||…ortArg >= 65536 ||…ortArg&1) {

178 *
’v
 << "bad…Üˆnumb”: " << 
pÜtArg


180 
	`u§ge
();

182 
desœedPÜtNum
 = ()
pÜtArg
;

183 ++
¬gv
; --
¬gc
;

188 
ü—‹Reûiv”s
 = 
F®£
;

193 
ouutQuickTimeFe
 = 
True
;

198 
ouutQuickTimeFe
 = 
True
;

199 
g’”©eMP4FÜm©
 = 
True
;

204 
ouutAVIFe
 = 
True
;

209 
N‘Add»ssLi¡
 
	`add»s£s
(
¬gv
[2]);

210 ià(
add»s£s
.
	`numAdd»s£s
() == 0) {

211 *
’v
 << "FaedØfšd‚‘wÜk‡dd»s fÜ \"" << 
¬gv
[2] << "\"";

214 
ReûivšgIÁ”çûAddr
 = *(*)(
add»s£s
.
	`fœ¡Add»ss
()->
	`d©a
());

215 ++
¬gv
; --
¬gc
;

220 
audioOÆy
 = 
True
;

221 
sšgËMedium
 = "audio";

226 
videoOÆy
 = 
True
;

227 
sšgËMedium
 = "video";

232 
v”bos™yLev–
 = 0;

237 
¬g
;

238 ià(
	`ssÿnf
(
¬gv
[2], "%g", &
¬g
) != 1) {

239 
	`u§ge
();

241 ià(
¬gv
[2][0] == '-') {

243 
du¿tiÚ
 = 0;

244 
du¿tiÚSlİ
 = -
¬g
;

246 
du¿tiÚ
 = 
¬g
;

247 
du¿tiÚSlİ
 = 0;

249 ++
¬gv
; --
¬gc
;

254 ià(
	`ssÿnf
(
¬gv
[2], "%u", &
š‹rPack‘G­MaxTime
) != 1) {

255 
	`u§ge
();

257 ++
¬gv
; --
¬gc
;

262 
¶ayCÚtšuou¦y
 = 
True
;

267 ià(
	`ssÿnf
(
¬gv
[2], "%d", &
sim¶eRTPoff£tArg
) != 1) {

268 
	`u§ge
();

270 ià(
sim¶eRTPoff£tArg
 < 0) {

271 *
’v
 << "offset‡rgumento \"-S\" must be >= 0\n";

272 
	`u§ge
();

274 ++
¬gv
; --
¬gc
;

279 
ÚeFeP”F¿me
 = 
True
;

284 
nÙifyOnPack‘A¼iv®
 = 
True
;

289 
£ndO±iÚsReque¡
 = 
F®£
;

294 
£ndO±iÚsReque¡OÆy
 = 
True
;

299 
feOuutIÁ”v®IÁ
;

300 ià(
	`ssÿnf
(
¬gv
[2], "%d", &
feOuutIÁ”v®IÁ
) != 1 || fileOutputIntervalInt <= 0) {

301 
	`u§ge
();

303 
feOuutIÁ”v®
 = ()
feOuutIÁ”v®IÁ
;

304 ++
¬gv
; --
¬gc
;

310 ià(
cÚŒŞCÚÃùiÚU£sTCP
) {

311 
¡»amUsšgTCP
 = 
True
;

313 
	`u§ge
();

320 ià(
cÚŒŞCÚÃùiÚU£sTCP
) {

321 ià(
¬gc
 > 3 && 
¬gv
[2][0] != '-') {

323 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
tuÂ–Ov”HTTPPÜtNum
) == 1

324 && 
tuÂ–Ov”HTTPPÜtNum
 > 0) {

325 ++
¬gv
; --
¬gc
;

332 
	`u§ge
();

337 ià(
¬gc
 < 4è
	`u§ge
();

338 
u£ºame
 = 
¬gv
[2];

339 
·sswÜd
 = 
¬gv
[3];

340 
¬gv
+=2; 
¬gc
-=2;

341 ià(
®lowProxyS”v”s
 && 
¬gc
 > 3 && 
¬gv
[2][0] != '-') {

343 
´oxyS”v”Name
 = 
¬gv
[2];

344 ++
¬gv
; --
¬gc
;

346 ià(
¬gc
 > 3 && 
¬gv
[2][0] != '-') {

348 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
´oxyS”v”PÜtNum
) != 1) {

349 
	`u§ge
();

351 ++
¬gv
; --
¬gc
;

355 
ourAuth’tiÿtÜ
 = 
Ãw
 
	`Auth’tiÿtÜ
(
u£ºame
, 
·sswÜd
);

360 ià(
¬gc
 < 4è
	`u§ge
();

361 
u£ºameFÜREGISTER
 = 
¬gv
[2];

362 
·sswÜdFÜREGISTER
 = 
¬gv
[3];

363 
¬gv
+=2; 
¬gc
-=2;

365 ià(
authDBFÜREGISTER
 =ğ
NULL
èauthDBFÜREGISTER = 
Ãw
 
U£rAuth’tiÿtiÚD©aba£
;

366 
authDBFÜREGISTER
->
	`addU£rRecÜd
(
u£ºameFÜREGISTER
, 
·sswÜdFÜREGISTER
);

371 
£ndK“pAlivesToBrok’S”v”s
 = 
True
;

376 
fÜm©Arg
;

377 ià(
	`ssÿnf
(
¬gv
[2], "%u", &
fÜm©Arg
) != 1

378 || 
fÜm©Arg
 >= 96) {

379 
	`u§ge
();

381 
desœedAudioRTPPaylßdFÜm©
 = ()
fÜm©Arg
;

382 ++
¬gv
; --
¬gc
;

387 
mimeSubty³
 = 
¬gv
[2];

388 ià(
desœedAudioRTPPaylßdFÜm©
==0) desiredAudioRTPPayloadFormat =96;

389 ++
¬gv
; --
¬gc
;

394 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
mov›Width
) != 1) {

395 
	`u§ge
();

397 
mov›WidthO±iÚS‘
 = 
True
;

398 ++
¬gv
; --
¬gc
;

403 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
mov›Height
) != 1) {

404 
	`u§ge
();

406 
mov›HeightO±iÚS‘
 = 
True
;

407 ++
¬gv
; --
¬gc
;

412 ià(
	`ssÿnf
(
¬gv
[2], "%u", &
mov›FPS
) != 1) {

413 
	`u§ge
();

415 
mov›FPSO±iÚS‘
 = 
True
;

416 ++
¬gv
; --
¬gc
;

421 
feNameP»fix
 = 
¬gv
[2];

422 ++
¬gv
; --
¬gc
;

427 
u£rAg’t
 = 
¬gv
[2];

428 ++
¬gv
; --
¬gc
;

433 ià(
	`ssÿnf
(
¬gv
[2], "%u", &
feSškBufãrSize
) != 1) {

434 
	`u§ge
();

436 ++
¬gv
; --
¬gc
;

441 ià(
	`ssÿnf
(
¬gv
[2], "%u", &
sock‘IÅutBufãrSize
) != 1) {

442 
	`u§ge
();

444 ++
¬gv
; --
¬gc
;

450 
·ck‘LossCom³n§‹
 = 
True
;

455 
syncSŒ—ms
 = 
True
;

460 
g’”©eHštT¿cks
 = 
True
;

465 
qosM—su»m’tIÁ”v®MS
 = 1000;

467 ià(
¬gc
 > 3 && 
¬gv
[2][0] != '-') {

470 ià(
	`ssÿnf
(
¬gv
[2], "%u", &
qosM—su»m’tIÁ”v®MS
) != 1) {

471 
	`u§ge
();

473 
qosM—su»m’tIÁ”v®MS
 *= 100;

474 ++
¬gv
; --
¬gc
;

480 
¬g
;

481 ià(
	`ssÿnf
(
¬gv
[2], "%lg", &
¬g
) != 1 ||‡rg < 0) {

482 
	`u§ge
();

484 
š™ŸlS“kTime
 = 
¬g
;

485 ++
¬gv
; --
¬gc
;

491 
š™ŸlAbsŞu‹S“kTime
 = 
¬gv
[2];

492 ++
¬gv
; --
¬gc
;

497 
¬g
;

498 ià(
	`ssÿnf
(
¬gv
[2], "%g", &
¬g
) != 1 ||‡rg == 0.0f) {

499 
	`u§ge
();

501 
sÿË
 = 
¬g
;

502 ++
¬gv
; --
¬gc
;

508 
ü—‹HªdËrS”v”FÜREGISTERCommªd
 = 
True
;

509 ià(
¬gc
 > 2 && 
¬gv
[2][0] != '-') {

511 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
hªdËrS”v”FÜREGISTERCommªdPÜtNum
) == 1 && handlerServerForREGISTERCommandPortNum > 0) {

512 ++
¬gv
; --
¬gc
;

520 
fÜûMuÉiÿ¡OnUn¥ecif›d
 = 
True
;

525 *
’v
 << "Inv®id o±iÚ: " << 
İt
 << "\n";

526 
	`u§ge
();

531 ++
¬gv
; --
¬gc
;

535 ià(!Ğ(
¬gc
 =ğ2 && !
ü—‹HªdËrS”v”FÜREGISTERCommªd
è|| (¬gø=ğ1 && c»©eHªdËrS”v”FÜREGISTERCommªdè)è
	`u§ge
();

536 ià(
ouutQuickTimeFe
 && 
ouutAVIFe
) {

537 *
’v
 << "The -i‡nd -q (or -4) options cannot both be used!\n";

538 
	`u§ge
();

540 
BoŞ—n
 
ouutCompos™eFe
 = 
ouutQuickTimeFe
 || 
ouutAVIFe
;

541 ià(!
ü—‹Reûiv”s
 && (
ouutCompos™eFe
 || 
ÚeFeP”F¿me
 || 
feOuutIÁ”v®
 > 0)) {

542 *
’v
 << "The -r option cannot be used with -q, -4, -i, -m, or -P!\n";

543 
	`u§ge
();

545 ià(
ÚeFeP”F¿me
 && 
feOuutIÁ”v®
 > 0) {

546 *
’v
 << "The -m‡nd -P options cannot both be used!\n";

547 
	`u§ge
();

549 ià(
ouutCompos™eFe
 && !
mov›WidthO±iÚS‘
) {

550 *
’v
 << "Warning: The -q, -4 or -i option was used, but‚ot -w. Assuming‡ video width of "

551 << 
mov›Width
 << "…ixels\n";

553 ià(
ouutCompos™eFe
 && !
mov›HeightO±iÚS‘
) {

554 *
’v
 << "Warning: The -q, -4 or -i option was used, but‚ot -h. Assuming‡ video height of "

555 << 
mov›Height
 << "…ixels\n";

557 ià(
ouutCompos™eFe
 && !
mov›FPSO±iÚS‘
) {

558 *
’v
 << "Warning: The -q, -4 or -i option was used, but‚ot -f. Assuming‡ video frame„ate of "

559 << 
mov›FPS
 << " frames-per-second\n";

561 ià(
audioOÆy
 && 
videoOÆy
) {

562 *
’v
 << "The -a‡nd -v options cannot both be used!\n";

563 
	`u§ge
();

565 ià(
£ndO±iÚsReque¡OÆy
 && !
£ndO±iÚsReque¡
) {

566 *
’v
 << "The -o‡nd -O options cannot both be used!\n";

567 
	`u§ge
();

569 ià(
š™ŸlAbsŞu‹S“kTime
 !ğ
NULL
 && 
š™ŸlS“kTime
 != 0.0f) {

570 *
’v
 << "The -s‡nd -U options cannot both be used!\n";

571 
	`u§ge
();

573 ià(
authDBFÜREGISTER
 !ğ
NULL
 && !
ü—‹HªdËrS”v”FÜREGISTERCommªd
) {

574 *
’v
 << "If \"-k <username> <password>\" is used,hen -R (or \"-R <port-num>\") must‡lso be used!\n";

575 
	`u§ge
();

577 ià(
tuÂ–Ov”HTTPPÜtNum
 > 0) {

578 ià(
¡»amUsšgTCP
) {

579 *
’v
 << "The -t‡nd -T options cannot both be used!\n";

580 
	`u§ge
();

582 
¡»amUsšgTCP
 = 
True
;

585 ià(!
ü—‹Reûiv”s
 && 
nÙifyOnPack‘A¼iv®
) {

586 *
’v
 << "Warning: Because we're‚ot„eceiving stream data,he -n flag has‚oƒffect\n";

588 ià(
du¿tiÚSlİ
 < 0) {

592 
du¿tiÚSlİ
 = 
qosM—su»m’tIÁ”v®MS
 > 0 ? 0.0 : 5.0;

595 
¡»amURL
 = 
¬gv
[1];

598 ià(
ü—‹HªdËrS”v”FÜREGISTERCommªd
) {

599 
hªdËrS”v”FÜREGISTERCommªd


600 ğ
HªdËrS”v”FÜREGISTERCommªd
::
	`ü—‹New
(*
’v
, 
cÚtšueAá”Cl›ÁC»©iÚ0
,

601 
hªdËrS”v”FÜREGISTERCommªdPÜtNum
, 
authDBFÜREGISTER
,

602 
v”bos™yLev–
, 
´ogName
);

603 ià(
hªdËrS”v”FÜREGISTERCommªd
 =ğ
NULL
) {

604 *
’v
 << "FaedØü—‹‡ s”v” fÜ hªdlšg incomšg \"REGISTER\" commªds: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

606 *
’v
 << "Awa™šg‡Àšcomšg \"REGISTER\" commªd oÀpÜˆ" << 
hªdËrS”v”FÜREGISTERCommªd
->
	`£rv”PÜtNum
() << "\n";

609 
ourCl›Á
 = 
	`ü—‹Cl›Á
(*
’v
, 
¡»amURL
, 
v”bos™yLev–
, 
´ogName
);

610 ià(
ourCl›Á
 =ğ
NULL
) {

611 *
’v
 << "FaedØü—‹ " << 
ş›ÁPrÙocŞName
 << " cl›Á: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

612 
	`shutdown
();

614 
	`cÚtšueAá”Cl›ÁC»©iÚ1
();

618 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

621 
	}
}

623 
	$cÚtšueAá”Cl›ÁC»©iÚ0
(
RTSPCl›Á
* 
ÃwRTSPCl›Á
, 
BoŞ—n
 
»que¡SŒ—mšgOv”TCP
) {

624 ià(
ÃwRTSPCl›Á
 =ğ
NULL
) ;

626 
¡»amUsšgTCP
 = 
»que¡SŒ—mšgOv”TCP
;

628 
	`assignCl›Á
(
ourCl›Á
 = 
ÃwRTSPCl›Á
);

629 
¡»amURL
 = 
ÃwRTSPCl›Á
->
	`u¾
();

632 
Medium
::
	`şo£
(
hªdËrS”v”FÜREGISTERCommªd
); hªdËrS”v”FÜREGISTERCommªd = 
NULL
;

634 
	`cÚtšueAá”Cl›ÁC»©iÚ1
();

635 
	}
}

637 
	$cÚtšueAá”Cl›ÁC»©iÚ1
() {

638 
	`£tU£rAg’tSŒšg
(
u£rAg’t
);

640 ià(
£ndO±iÚsReque¡
) {

642 
	`g‘O±iÚs
(
cÚtšueAá”OPTIONS
);

644 
	`cÚtšueAá”OPTIONS
(
NULL
, 0, NULL);

646 
	}
}

648 
	$cÚtšueAá”OPTIONS
(
RTSPCl›Á
*, 
»suÉCode
, * 
»suÉSŒšg
) {

649 ià(
£ndO±iÚsReque¡OÆy
) {

650 ià(
»suÉCode
 != 0) {

651 *
’v
 << 
ş›ÁPrÙocŞName
 << " \"OPTIONS\"„eque¡ faed: " << 
»suÉSŒšg
 << "\n";

653 *
’v
 << 
ş›ÁPrÙocŞName
 << " \"OPTIONS\"„eque¡„‘uºed: " << 
»suÉSŒšg
 << "\n";

655 
	`shutdown
();

657 
d–‘e
[] 
»suÉSŒšg
;

660 
	`g‘SDPDesütiÚ
(
cÚtšueAá”DESCRIBE
);

661 
	}
}

663 
	$cÚtšueAá”DESCRIBE
(
RTSPCl›Á
*, 
»suÉCode
, * 
»suÉSŒšg
) {

664 ià(
»suÉCode
 != 0) {

665 *
’v
 << "FaedØg‘‡ SDP desütiÚ fÜhURL \"" << 
¡»amURL
 << "\": " << 
»suÉSŒšg
 << "\n";

666 
d–‘e
[] 
»suÉSŒšg
;

667 
	`shutdown
();

670 * 
sdpDesütiÚ
 = 
»suÉSŒšg
;

671 *
’v
 << "O³Ãd URL \"" << 
¡»amURL
 << "\",„‘uºšg‡ SDP desütiÚ:\n" << 
sdpDesütiÚ
 << "\n";

674 
£ssiÚ
 = 
MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
sdpDesütiÚ
);

675 
d–‘e
[] 
sdpDesütiÚ
;

676 ià(
£ssiÚ
 =ğ
NULL
) {

677 *
’v
 << "FaedØü—‹‡ MedŸSessiÚ objeù fromhSDP desütiÚ: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

678 
	`shutdown
();

679 } ià(!
£ssiÚ
->
	`hasSub£ssiÚs
()) {

680 *
’v
 << "This session has‚o media subsessions (i.e.,‚o \"m=\"†ines)\n";

681 
	`shutdown
();

685 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

686 
MedŸSub£ssiÚ
 *
sub£ssiÚ
;

687 
BoŞ—n
 
madeProg»ss
 = 
F®£
;

688 cÚ¡* 
sšgËMediumToTe¡
 = 
sšgËMedium
;

689 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

691 ià(
sšgËMediumToTe¡
 !ğ
NULL
) {

692 ià(
	`¡rcmp
(
sub£ssiÚ
->
	`mediumName
(), 
sšgËMediumToTe¡
) != 0) {

693 *
’v
 << "IgnÜšg \"" << 
sub£ssiÚ
->
	`mediumName
()

694 << "/" << 
sub£ssiÚ
->
	`codecName
()

695 << "\" sub£ssiÚ, beÿu£ we'vaskedØ»ûiv¨sšgË " << 
sšgËMedium


700 
sšgËMediumToTe¡
 = "xxxxx";

705 ià(
desœedPÜtNum
 != 0) {

706 
sub£ssiÚ
->
	`£tCl›ÁPÜtNum
(
desœedPÜtNum
);

707 
desœedPÜtNum
 += 2;

710 ià(
ü—‹Reûiv”s
) {

711 ià(!
sub£ssiÚ
->
	`š™Ÿ‹
(
sim¶eRTPoff£tArg
)) {

712 *
’v
 << "UÇbËØü—‹„eûiv” fÜ \"" << 
sub£ssiÚ
->
	`mediumName
()

713 << "/" << 
sub£ssiÚ
->
	`codecName
()

714 << "\" sub£ssiÚ: " << 
’v
->
	`g‘ResuÉMsg
() << "\n";

716 *
’v
 << "C»©ed„eûiv” fÜ \"" << 
sub£ssiÚ
->
	`mediumName
()

717 << "/" << 
sub£ssiÚ
->
	`codecName
() << "\" subsession (";

718 ià(
sub£ssiÚ
->
	`¹ıIsMuxed
()) {

719 *
’v
 << "ş›Á…Üˆ" << 
sub£ssiÚ
->
	`ş›ÁPÜtNum
();

721 *
’v
 << "ş›Á…Üt " << 
sub£ssiÚ
->
	`ş›ÁPÜtNum
()

722 << "-" << 
sub£ssiÚ
->
	`ş›ÁPÜtNum
()+1;

724 *
’v
 << ")\n";

725 
madeProg»ss
 = 
True
;

727 ià(
sub£ssiÚ
->
	`¹pSourû
(è!ğ
NULL
) {

731 cÚ¡ 
th»sh
 = 1000000;

732 
sub£ssiÚ
->
	`¹pSourû
()->
	`£tPack‘ReÜd”šgTh»shŞdTime
(
th»sh
);

738 
sock‘Num
 = 
sub£ssiÚ
->
	`¹pSourû
()->
	`RTPgs
()->
	`sock‘Num
();

739 
curBufãrSize
 = 
	`g‘ReûiveBufãrSize
(*
’v
, 
sock‘Num
);

740 ià(
sock‘IÅutBufãrSize
 > 0 || 
feSškBufãrSize
 > 
curBufãrSize
) {

741 
ÃwBufãrSize
 = 
sock‘IÅutBufãrSize
 > 0 ? sock‘IÅutBufãrSiz: 
feSškBufãrSize
;

742 
ÃwBufãrSize
 = 
	`£tReûiveBufãrTo
(*
’v
, 
sock‘Num
,‚ewBufferSize);

743 ià(
sock‘IÅutBufãrSize
 > 0) {

744 *
’v
 << "Changed socket„eceive buffer size forhe \""

745 << 
sub£ssiÚ
->
	`mediumName
()

746 << "/" << 
sub£ssiÚ
->
	`codecName
()

748 << 
curBufãrSize
 << "o "

749 << 
ÃwBufãrSize
 << " bytes\n";

755 ià(
sub£ssiÚ
->
	`ş›ÁPÜtNum
() == 0) {

756 *
’v
 << "No client…ort was specified forhe \""

757 << 
sub£ssiÚ
->
	`mediumName
()

758 << "/" << 
sub£ssiÚ
->
	`codecName
()

761 
madeProg»ss
 = 
True
;

765 ià(!
madeProg»ss
è
	`shutdown
();

768 
	`£tupSŒ—ms
();

769 
	}
}

771 
MedŸSub£ssiÚ
 *
	gsub£ssiÚ
;

772 
BoŞ—n
 
	gmadeProg»ss
 = 
F®£
;

773 
	$cÚtšueAá”SETUP
(
RTSPCl›Á
* 
ş›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

774 ià(
»suÉCode
 == 0) {

775 *
’v
 << "S‘u°\"" << 
sub£ssiÚ
->
	`mediumName
()

776 << "/" << 
sub£ssiÚ
->
	`codecName
()

778 ià(
sub£ssiÚ
->
	`¹ıIsMuxed
()) {

779 *
’v
 << "ş›Á…Üˆ" << 
sub£ssiÚ
->
	`ş›ÁPÜtNum
();

781 *
’v
 << "ş›Á…Üt " << 
sub£ssiÚ
->
	`ş›ÁPÜtNum
()

782 << "-" << 
sub£ssiÚ
->
	`ş›ÁPÜtNum
()+1;

784 *
’v
 << ")\n";

785 
madeProg»ss
 = 
True
;

787 *
’v
 << "FaedØ£tu°\"" << 
sub£ssiÚ
->
	`mediumName
()

788 << "/" << 
sub£ssiÚ
->
	`codecName
()

789 << "\" sub£ssiÚ: " << 
»suÉSŒšg
 << "\n";

791 
d–‘e
[] 
»suÉSŒšg
;

793 
£ssiÚTimeoutP¬am‘”
 = 
ş›Á
->
	`£ssiÚTimeoutP¬am‘”
();

796 
	`£tupSŒ—ms
();

797 
	}
}

799 
	$ü—‹OuutFes
(cÚ¡* 
³riodicF’ameSuffix
) {

800 
outFeName
[1000];

802 ià(
ouutQuickTimeFe
 || 
ouutAVIFe
) {

803 ià(
³riodicF’ameSuffix
[0] == '\0') {

805 
	`¥rštf
(
outFeName
, "stdout");

808 cÚ¡* 
´efix
 = 
feNameP»fix
[0] == '\0' ? "output" : fileNamePrefix;

809 
	`¢´štf
(
outFeName
,  outFeName, "%s%s.%s", 
´efix
, 
³riodicF’ameSuffix
,

810 
ouutAVIFe
 ? "avi" : 
g’”©eMP4FÜm©
 ? "mp4" : "mov");

813 ià(
ouutQuickTimeFe
) {

814 
qtOut
 = 
QuickTimeFeSšk
::
	`ü—‹New
(*
’v
, *
£ssiÚ
, 
outFeName
,

815 
feSškBufãrSize
,

816 
mov›Width
, 
mov›Height
,

817 
mov›FPS
,

818 
·ck‘LossCom³n§‹
,

819 
syncSŒ—ms
,

820 
g’”©eHštT¿cks
,

821 
g’”©eMP4FÜm©
);

822 ià(
qtOut
 =ğ
NULL
) {

823 *
’v
 << "Failedo create‡ \"QuickTimeFileSink\" for outputtingo \""

824 << 
outFeName
 << "\": " << 
’v
->
	`g‘ResuÉMsg
() << "\n";

825 
	`shutdown
();

827 *
’v
 << "Ouu‰šgØthfe: \"" << 
outFeName
 << "\"\n";

830 
qtOut
->
	`¡¬tPÏyšg
(
£ssiÚAá”PÏyšg
, 
NULL
);

832 
aviOut
 = 
AVIFeSšk
::
	`ü—‹New
(*
’v
, *
£ssiÚ
, 
outFeName
,

833 
feSškBufãrSize
,

834 
mov›Width
, 
mov›Height
,

835 
mov›FPS
,

836 
·ck‘LossCom³n§‹
);

837 ià(
aviOut
 =ğ
NULL
) {

838 *
’v
 << "Failedo create‡n \"AVIFileSink\" for outputtingo \""

839 << 
outFeName
 << "\": " << 
’v
->
	`g‘ResuÉMsg
() << "\n";

840 
	`shutdown
();

842 *
’v
 << "Ouu‰šgØthfe: \"" << 
outFeName
 << "\"\n";

845 
aviOut
->
	`¡¬tPÏyšg
(
£ssiÚAá”PÏyšg
, 
NULL
);

849 
madeProg»ss
 = 
F®£
;

850 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

851 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

852 ià(
sub£ssiÚ
->
	`»adSourû
(è=ğ
NULL
) ;

855 ià(
sšgËMedium
 =ğ
NULL
 || 
³riodicF’ameSuffix
[0] != '\0') {

858 
¡»amCouÁ”
 = 0;

859 
	`¢´štf
(
outFeName
,  outFileName, "%s%s-%s-%d%s",

860 
feNameP»fix
, 
sub£ssiÚ
->
	`mediumName
(),

861 
sub£ssiÚ
->
	`codecName
(), ++
¡»amCouÁ”
, 
³riodicF’ameSuffix
);

865 
	`¥rštf
(
outFeName
, "stdout");

868 
FeSšk
* 
feSšk
 = 
NULL
;

869 
BoŞ—n
 
ü—‹OggFeSšk
 = 
F®£
;

870 ià(
	`¡rcmp
(
sub£ssiÚ
->
	`mediumName
(), "video") == 0) {

871 ià(
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "H264") == 0) {

874 
feSšk
 = 
H264VideoFeSšk
::
	`ü—‹New
(*
’v
, 
outFeName
,

875 
sub£ssiÚ
->
	`fm_¥rİ·¿m‘”£ts
(),

876 
feSškBufãrSize
, 
ÚeFeP”F¿me
);

877 } ià(
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "H265") == 0) {

880 
feSšk
 = 
H265VideoFeSšk
::
	`ü—‹New
(*
’v
, 
outFeName
,

881 
sub£ssiÚ
->
	`fm_¥rİvps
(),

882 
sub£ssiÚ
->
	`fm_¥rİ¥s
(),

883 
sub£ssiÚ
->
	`fm_¥rİµs
(),

884 
feSškBufãrSize
, 
ÚeFeP”F¿me
);

885 } ià(
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "THEORA") == 0) {

886 
ü—‹OggFeSšk
 = 
True
;

888 } ià(
	`¡rcmp
(
sub£ssiÚ
->
	`mediumName
(), "audio") == 0) {

889 ià(
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "AMR") == 0 ||

890 
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "AMR-WB") == 0) {

892 
feSšk
 = 
AMRAudioFeSšk
::
	`ü—‹New
(*
’v
, 
outFeName
,

893 
feSškBufãrSize
, 
ÚeFeP”F¿me
);

894 } ià(
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "VORBIS") == 0 ||

895 
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "OPUS") == 0) {

896 
ü—‹OggFeSšk
 = 
True
;

899 ià(
ü—‹OggFeSšk
) {

900 
feSšk
 = 
OggFeSšk


901 ::
	`ü—‹New
(*
’v
, 
outFeName
,

902 
sub£ssiÚ
->
	`¹pTime¡ampF»qu’cy
(), sub£ssiÚ->
	`fm_cÚfig
());

903 } ià(
feSšk
 =ğ
NULL
) {

905 
feSšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
outFeName
,

906 
feSškBufãrSize
, 
ÚeFeP”F¿me
);

908 
sub£ssiÚ
->
sšk
 = 
feSšk
;

910 ià(
sub£ssiÚ
->
sšk
 =ğ
NULL
) {

911 *
’v
 << "FaedØü—‹ FeSšk fÜ \"" << 
outFeName


912 << "\": " << 
’v
->
	`g‘ResuÉMsg
() << "\n";

914 ià(
sšgËMedium
 =ğ
NULL
) {

915 *
’v
 << "C»©ed ouuˆfe: \"" << 
outFeName
 << "\"\n";

917 *
’v
 << "Ouu‰šg d©¨äomh\"" << 
sub£ssiÚ
->
	`mediumName
()

918 << "/" << 
sub£ssiÚ
->
	`codecName
()

919 << "\" sub£ssiÚØ\"" << 
outFeName
 << "\"\n";

922 ià(
	`¡rcmp
(
sub£ssiÚ
->
	`mediumName
(), "video") == 0 &&

923 
	`¡rcmp
(
sub£ssiÚ
->
	`codecName
(), "MP4V-ES") == 0 &&

924 
sub£ssiÚ
->
	`fm_cÚfig
(è!ğ
NULL
) {

928 
cÚfigL’
;

929 * 
cÚfigD©a


930 ğ
	`·r£G’”®CÚfigSŒ
(
sub£ssiÚ
->
	`fm_cÚfig
(), 
cÚfigL’
);

931 
timev®
 
timeNow
;

932 
	`g‘timeofday
(&
timeNow
, 
NULL
);

933 
feSšk
->
	`addD©a
(
cÚfigD©a
, 
cÚfigL’
, 
timeNow
);

934 
d–‘e
[] 
cÚfigD©a
;

937 
sub£ssiÚ
->
sšk
->
	`¡¬tPÏyšg
(*(sub£ssiÚ->
	`»adSourû
()),

938 
sub£ssiÚAá”PÏyšg
,

939 
sub£ssiÚ
);

943 ià(
sub£ssiÚ
->
	`¹ıIn¡ªû
(è!ğ
NULL
) {

944 
sub£ssiÚ
->
	`¹ıIn¡ªû
()->
	`£tByeHªdËr
(
sub£ssiÚByeHªdËr
, subsession);

947 
madeProg»ss
 = 
True
;

950 ià(!
madeProg»ss
è
	`shutdown
();

952 
	}
}

954 
	$ü—‹P”iodicOuutFes
() {

956 
³riodicFeNameSuffix
[100];

957 
	`¢´štf
(
³riodicFeNameSuffix
, …eriodicFileNameSuffix, "-%05d-%05d",

958 
feOuutSecÚdsSoF¬
, feOuutSecÚdsSoF¬ + 
feOuutIÁ”v®
);

959 
	`ü—‹OuutFes
(
³riodicFeNameSuffix
);

962 
³riodicFeOuutTask


963 ğ
’v
->
	`skScheduËr
().
	`scheduËD–ayedTask
(
feOuutIÁ”v®
*1000000,

964 (
TaskFunc
*)
³riodicFeOuutTim”HªdËr
,

965 (*)
NULL
);

966 
	}
}

968 
	$£tupSŒ—ms
() {

969 
MedŸSub£ssiÚI‹¿tÜ
* 
£tupI‹r
 = 
NULL
;

970 ià(
£tupI‹r
 =ğ
NULL
è£tupI‹¸ğ
Ãw
 
	`MedŸSub£ssiÚI‹¿tÜ
(*
£ssiÚ
);

971 (
sub£ssiÚ
 = 
£tupI‹r
->
	`Ãxt
()è!ğ
NULL
) {

973 ià(
sub£ssiÚ
->
	`ş›ÁPÜtNum
() == 0) ;

975 
	`£tupSub£ssiÚ
(
sub£ssiÚ
, 
¡»amUsšgTCP
, 
fÜûMuÉiÿ¡OnUn¥ecif›d
, 
cÚtšueAá”SETUP
);

980 
d–‘e
 
£tupI‹r
;

981 ià(!
madeProg»ss
è
	`shutdown
();

984 ià(
ü—‹Reûiv”s
) {

985 ià(
feOuutIÁ”v®
 > 0) {

986 
	`ü—‹P”iodicOuutFes
();

988 
	`ü—‹OuutFes
("");

993 ià(
du¿tiÚ
 == 0) {

994 ià(
sÿË
 > 0è
du¿tiÚ
 = 
£ssiÚ
->
	`¶ayEndTime
(è- 
š™ŸlS“kTime
;

995 ià(
sÿË
 < 0è
du¿tiÚ
 = 
š™ŸlS“kTime
;

997 ià(
du¿tiÚ
 < 0) duration = 0.0;

999 
’dTime
 = 
š™ŸlS“kTime
;

1000 ià(
sÿË
 > 0) {

1001 ià(
du¿tiÚ
 <ğ0è
’dTime
 = -1.0f;

1002 
’dTime
 = 
š™ŸlS“kTime
 + 
du¿tiÚ
;

1004 
’dTime
 = 
š™ŸlS“kTime
 - 
du¿tiÚ
;

1005 ià(
’dTime
 < 0)ƒndTime = 0.0f;

1008 cÚ¡* 
absS¹Time
 = 
š™ŸlAbsŞu‹S“kTime
 !ğ
NULL
 ? in™ŸlAbsŞu‹S“kTim: 
£ssiÚ
->
	`absS¹Time
();

1009 ià(
absS¹Time
 !ğ
NULL
) {

1011 
	`¡¬tPÏyšgSessiÚ
(
£ssiÚ
, 
absS¹Time
, sessiÚ->
	`absEndTime
(), 
sÿË
, 
cÚtšueAá”PLAY
);

1014 
	`¡¬tPÏyšgSessiÚ
(
£ssiÚ
, 
š™ŸlS“kTime
, 
’dTime
, 
sÿË
, 
cÚtšueAá”PLAY
);

1016 
	}
}

1018 
	$cÚtšueAá”PLAY
(
RTSPCl›Á
*, 
»suÉCode
, * 
»suÉSŒšg
) {

1019 ià(
»suÉCode
 != 0) {

1020 *
’v
 << "FaedØ¡¬ˆ¶ayšg sessiÚ: " << 
»suÉSŒšg
 << "\n";

1021 
d–‘e
[] 
»suÉSŒšg
;

1022 
	`shutdown
();

1025 *
’v
 << "Started…laying session\n";

1027 
d–‘e
[] 
»suÉSŒšg
;

1029 ià(
qosM—su»m’tIÁ”v®MS
 > 0) {

1031 
	`begšQOSM—su»m’t
();

1036 
BoŞ—n
 
tim”IsBešgU£d
 = 
F®£
;

1037 
£cÚdsToD–ay
 = 
du¿tiÚ
;

1038 ià(
du¿tiÚ
 > 0) {

1040 
¿ngeAdju¡m’t
 = (
£ssiÚ
->
	`¶ayEndTime
(è- sessiÚ->
	`¶ayS¹Time
()è- (
’dTime
 - 
š™ŸlS“kTime
);

1041 ià(
du¿tiÚ
 + 
¿ngeAdju¡m’t
 > 0.0) duration +=„angeAdjustment;

1043 
tim”IsBešgU£d
 = 
True
;

1044 
absSÿË
 = 
sÿË
 > 0 ? scale : -scale;

1045 
£cÚdsToD–ay
 = 
du¿tiÚ
/
absSÿË
 + 
du¿tiÚSlİ
;

1047 
št64_t
 
uSecsToD–ay
 = (št64_t)(
£cÚdsToD–ay
*1000000.0);

1048 
£ssiÚTim”Task
 = 
’v
->
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecsToD–ay
, (
TaskFunc
*)
£ssiÚTim”HªdËr
, (*)
NULL
);

1051 cÚ¡* 
aùiÚSŒšg


1052 ğ
ü—‹Reûiv”s
? "Receiving streamed data":"Data is being streamed";

1053 ià(
tim”IsBešgU£d
) {

1054 *
’v
 << 
aùiÚSŒšg


1055 << " (fÜ u°tØ" << 
£cÚdsToD–ay


1058 #ifdeà
USE_SIGNALS


1059 
pid_t
 
ourPid
 = 
	`g‘pid
();

1060 *
’v
 << 
aùiÚSŒšg


1061 << " (sigÇÈw™h \"kÈ-HUP " << ()
ourPid


1062 << "\" o¸\"kÈ-USR1 " << ()
ourPid


1065 *
’v
 << 
aùiÚSŒšg
 << "...\n";

1069 
£ssiÚTimeoutBrok’S”v”Task
 = 
NULL
;

1072 
	`checkFÜPack‘A¼iv®
(
NULL
);

1073 
	`checkIÁ”Pack‘G­s
(
NULL
);

1074 
	`checkSessiÚTimeoutBrok’S”v”
(
NULL
);

1075 
	}
}

1077 
	$şo£MedŸSšks
() {

1078 
Medium
::
	`şo£
(
qtOut
); qtOuˆğ
NULL
;

1079 
Medium
::
	`şo£
(
aviOut
);‡viOuˆğ
NULL
;

1081 ià(
£ssiÚ
 =ğ
NULL
) ;

1082 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

1083 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

1084 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1085 
Medium
::
	`şo£
(
sub£ssiÚ
->
sšk
);

1086 
sub£ssiÚ
->
sšk
 = 
NULL
;

1088 
	}
}

1090 
	$sub£ssiÚAá”PÏyšg
(* 
ş›ÁD©a
) {

1092 
MedŸSub£ssiÚ
* 
sub£ssiÚ
 = (MedŸSub£ssiÚ*)
ş›ÁD©a
;

1093 
Medium
::
	`şo£
(
sub£ssiÚ
->
sšk
);

1094 
sub£ssiÚ
->
sšk
 = 
NULL
;

1097 
MedŸSessiÚ
& 
£ssiÚ
 = 
sub£ssiÚ
->
	`·»ÁSessiÚ
();

1098 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
£ssiÚ
);

1099 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1100 ià(
sub£ssiÚ
->
sšk
 !ğ
NULL
) ;

1104 
	`£ssiÚAá”PÏyšg
();

1105 
	}
}

1107 
	$sub£ssiÚByeHªdËr
(* 
ş›ÁD©a
) {

1108 
timev®
 
timeNow
;

1109 
	`g‘timeofday
(&
timeNow
, 
NULL
);

1110 
£csDiff
 = 
timeNow
.
tv_£c
 - 
¡¬tTime
.tv_sec;

1112 
MedŸSub£ssiÚ
* 
sub£ssiÚ
 = (MedŸSub£ssiÚ*)
ş›ÁD©a
;

1113 *
’v
 << "Reûived RTCP \"BYE\" oÀ\"" << 
sub£ssiÚ
->
	`mediumName
()

1114 << "/" << 
sub£ssiÚ
->
	`codecName
()

1115 << "\" sub£ssiÚ (aá” " << 
£csDiff


1119 
	`sub£ssiÚAá”PÏyšg
(
sub£ssiÚ
);

1120 
	}
}

1122 
	$£ssiÚAá”PÏyšg
(* ) {

1123 ià(!
¶ayCÚtšuou¦y
) {

1124 
	`shutdown
(0);

1128 ià(
’v
 !ğ
NULL
) {

1129 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
³riodicFeOuutTask
);

1130 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
£ssiÚTim”Task
);

1131 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
£ssiÚTimeoutBrok’S”v”Task
);

1132 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
¬riv®CheckTim”Task
);

1133 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
š‹rPack‘G­CheckTim”Task
);

1134 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
qosM—su»m’tTim”Task
);

1136 
tÙNumPack‘sReûived
 = ~0;

1138 
	`¡¬tPÏyšgSessiÚ
(
£ssiÚ
, 
š™ŸlS“kTime
, 
’dTime
, 
sÿË
, 
cÚtšueAá”PLAY
);

1140 
	}
}

1142 
	$£ssiÚTim”HªdËr
(* ) {

1143 
£ssiÚTim”Task
 = 
NULL
;

1145 
	`£ssiÚAá”PÏyšg
();

1146 
	}
}

1148 
	$³riodicFeOuutTim”HªdËr
(* ) {

1149 
feOuutSecÚdsSoF¬
 +ğ
feOuutIÁ”v®
;

1152 
	`şo£MedŸSšks
();

1155 
	`ü—‹P”iodicOuutFes
();

1156 
	}
}

1158 şas 
	cqosM—su»m’tRecÜd
 {

1159 
	mpublic
:

1160 
	$qosM—su»m’tRecÜd
(
timev®
 cÚ¡& 
¡¬tTime
, 
RTPSourû
* 
¤c
)

1161 : 
	`fSourû
(
¤c
), 
	`fNext
(
NULL
),

1162 
	`kb™s_³r_£cÚd_mš
(1e20), 
	`kb™s_³r_£cÚd_max
(0),

1163 
	`kBy‹sTÙ®
(0.0),

1164 
	`·ck‘_loss_äaùiÚ_mš
(1.0), 
	`·ck‘_loss_äaùiÚ_max
(0.0),

1165 
	`tÙNumPack‘sReûived
(0), 
	$tÙNumPack‘sEx³ùed
(0) {

1166 
m—su»m’tEndTime
 = 
m—su»m’tS¹Time
 = 
¡¬tTime
;

1168 
RTPReû±iÚStsDB
::
I‹¿tÜ
 
	`¡©sI‹r
(
¤c
->
	`»û±iÚStsDB
());

1170 
RTPReû±iÚSts
* 
¡©s
 = 
¡©sI‹r
.
	`Ãxt
(
True
);

1171 ià(
¡©s
 !ğ
NULL
) {

1172 
kBy‹sTÙ®
 = 
¡©s
->
	`tÙNumKBy‹sReûived
();

1173 
tÙNumPack‘sReûived
 = 
¡©s
->
	`tÙNumPack‘sReûived
();

1174 
tÙNumPack‘sEx³ùed
 = 
¡©s
->
	`tÙNumPack‘sEx³ùed
();

1177 
vœtu®
 ~
	$qosM—su»m’tRecÜd
(è{ 
d–‘e
 
fNext
; 
	}
}

1179 
³riodicQOSM—su»m’t
(
timev®
 cÚ¡& 
timeNow
);

1181 
	gpublic
:

1182 
RTPSourû
* 
fSourû
;

1183 
qosM—su»m’tRecÜd
* 
	gfNext
;

1185 
	gpublic
:

1186 
timev®
 
m—su»m’tS¹Time
, 
	gm—su»m’tEndTime
;

1187 
	gkb™s_³r_£cÚd_mš
, 
	gkb™s_³r_£cÚd_max
;

1188 
	gkBy‹sTÙ®
;

1189 
	g·ck‘_loss_äaùiÚ_mš
, 
	g·ck‘_loss_äaùiÚ_max
;

1190 
	gtÙNumPack‘sReûived
, 
	gtÙNumPack‘sEx³ùed
;

1193 
qosM—su»m’tRecÜd
* 
	gqosRecÜdH—d
 = 
NULL
;

1195 
³riodicQOSM—su»m’t
(* 
ş›ÁD©a
);

1197 
	gÃxtQOSM—su»m’tUSecs
;

1199 
	$scheduËNextQOSM—su»m’t
() {

1200 
ÃxtQOSM—su»m’tUSecs
 +ğ
qosM—su»m’tIÁ”v®MS
*1000;

1201 
timev®
 
timeNow
;

1202 
	`g‘timeofday
(&
timeNow
, 
NULL
);

1203 
timeNowUSecs
 = 
timeNow
.
tv_£c
*1000000 +imeNow.
tv_u£c
;

1204 
u£csToD–ay
 = 
ÃxtQOSM—su»m’tUSecs
 - 
timeNowUSecs
;

1206 
qosM—su»m’tTim”Task
 = 
’v
->
	`skScheduËr
().
	`scheduËD–ayedTask
(

1207 
u£csToD–ay
, (
TaskFunc
*)
³riodicQOSM—su»m’t
, (*)
NULL
);

1208 
	}
}

1210 
	$³riodicQOSM—su»m’t
(* ) {

1211 
timev®
 
timeNow
;

1212 
	`g‘timeofday
(&
timeNow
, 
NULL
);

1214 
qosM—su»m’tRecÜd
* 
qosRecÜd
 = 
qosRecÜdH—d
;

1215 
qosRecÜd
 !ğ
NULL
; qosRecÜd = qosRecÜd->
fNext
) {

1216 
qosRecÜd
->
	`³riodicQOSM—su»m’t
(
timeNow
);

1220 
	`scheduËNextQOSM—su»m’t
();

1221 
	}
}

1223 
	gqosM—su»m’tRecÜd


1224 ::
	$³riodicQOSM—su»m’t
(
timev®
 cÚ¡& 
timeNow
) {

1225 
£csDiff
 = 
timeNow
.
tv_£c
 - 
m—su»m’tEndTime
.tv_sec;

1226 
u£csDiff
 = 
timeNow
.
tv_u£c
 - 
m—su»m’tEndTime
.tv_usec;

1227 
timeDiff
 = 
£csDiff
 + 
u£csDiff
/1000000.0;

1228 
m—su»m’tEndTime
 = 
timeNow
;

1230 
RTPReû±iÚStsDB
::
I‹¿tÜ
 
	`¡©sI‹r
(
fSourû
->
	`»û±iÚStsDB
());

1232 
RTPReû±iÚSts
* 
¡©s
 = 
¡©sI‹r
.
	`Ãxt
(
True
);

1233 ià(
¡©s
 !ğ
NULL
) {

1234 
kBy‹sTÙ®Now
 = 
¡©s
->
	`tÙNumKBy‹sReûived
();

1235 
kBy‹sD–Now
 = 
kBy‹sTÙ®Now
 - 
kBy‹sTÙ®
;

1236 
kBy‹sTÙ®
 = 
kBy‹sTÙ®Now
;

1238 
kbpsNow
 = 
timeDiff
 =ğ0.0 ? 0.0 : 8*
kBy‹sD–Now
/timeDiff;

1239 ià(
kbpsNow
 < 0.0) kbpsNow = 0.0;

1240 ià(
kbpsNow
 < 
kb™s_³r_£cÚd_mš
) kbits_per_second_min = kbpsNow;

1241 ià(
kbpsNow
 > 
kb™s_³r_£cÚd_max
) kbits_per_second_max = kbpsNow;

1243 
tÙReûivedNow
 = 
¡©s
->
	`tÙNumPack‘sReûived
();

1244 
tÙEx³ùedNow
 = 
¡©s
->
	`tÙNumPack‘sEx³ùed
();

1245 
d–ReûivedNow
 = 
tÙReûivedNow
 - 
tÙNumPack‘sReûived
;

1246 
d–Ex³ùedNow
 = 
tÙEx³ùedNow
 - 
tÙNumPack‘sEx³ùed
;

1247 
tÙNumPack‘sReûived
 = 
tÙReûivedNow
;

1248 
tÙNumPack‘sEx³ùed
 = 
tÙEx³ùedNow
;

1250 
lossF¿ùiÚNow
 = 
d–Ex³ùedNow
 == 0 ? 0.0

1251 : 1.0 - 
d–ReûivedNow
/()
d–Ex³ùedNow
;

1253 ià(
lossF¿ùiÚNow
 < 
·ck‘_loss_äaùiÚ_mš
) {

1254 
·ck‘_loss_äaùiÚ_mš
 = 
lossF¿ùiÚNow
;

1256 ià(
lossF¿ùiÚNow
 > 
·ck‘_loss_äaùiÚ_max
) {

1257 
·ck‘_loss_äaùiÚ_max
 = 
lossF¿ùiÚNow
;

1260 
	}
}

1262 
	$begšQOSM—su»m’t
() {

1264 
timev®
 
¡¬tTime
;

1265 
	`g‘timeofday
(&
¡¬tTime
, 
NULL
);

1266 
ÃxtQOSM—su»m’tUSecs
 = 
¡¬tTime
.
tv_£c
*1000000 + s¹Time.
tv_u£c
;

1267 
qosM—su»m’tRecÜd
* 
qosRecÜdTa
 = 
NULL
;

1268 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

1269 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

1270 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1271 
RTPSourû
* 
¤c
 = 
sub£ssiÚ
->
	`¹pSourû
();

1272 ià(
¤c
 =ğ
NULL
) ;

1274 
qosM—su»m’tRecÜd
* 
qosRecÜd


1275 ğ
Ãw
 
	`qosM—su»m’tRecÜd
(
¡¬tTime
, 
¤c
);

1276 ià(
qosRecÜdH—d
 =ğ
NULL
èqosRecÜdH—d = 
qosRecÜd
;

1277 ià(
qosRecÜdTa
 !ğ
NULL
èqosRecÜdTa->
fNext
 = 
qosRecÜd
;

1278 
qosRecÜdTa
 = 
qosRecÜd
;

1282 
	`scheduËNextQOSM—su»m’t
();

1283 
	}
}

1285 
	$´štQOSD©a
(
ex™Code
) {

1286 *
’v
 << "begin_QOS_statistics\n";

1289 
qosM—su»m’tRecÜd
* 
curQOSRecÜd
 = 
qosRecÜdH—d
;

1290 ià(
£ssiÚ
 !ğ
NULL
) {

1291 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

1292 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

1293 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1294 
RTPSourû
* 
¤c
 = 
sub£ssiÚ
->
	`¹pSourû
();

1295 ià(
¤c
 =ğ
NULL
) ;

1297 *
’v
 << "sub£ssiÚ\t" << 
sub£ssiÚ
->
	`mediumName
()

1298 << "/" << 
sub£ssiÚ
->
	`codecName
() << "\n";

1300 
numPack‘sReûived
 = 0, 
numPack‘sEx³ùed
 = 0;

1302 ià(
curQOSRecÜd
 !ğ
NULL
) {

1303 
numPack‘sReûived
 = 
curQOSRecÜd
->
tÙNumPack‘sReûived
;

1304 
numPack‘sEx³ùed
 = 
curQOSRecÜd
->
tÙNumPack‘sEx³ùed
;

1306 *
’v
 << "num_·ck‘s_»ûived\t" << 
numPack‘sReûived
 << "\n";

1307 *
’v
 << "num_·ck‘s_lo¡\t" << (
numPack‘sEx³ùed
 - 
numPack‘sReûived
) << "\n";

1309 ià(
curQOSRecÜd
 !ğ
NULL
) {

1310 
£csDiff
 = 
curQOSRecÜd
->
m—su»m’tEndTime
.
tv_£c


1311 - 
curQOSRecÜd
->
m—su»m’tS¹Time
.
tv_£c
;

1312 
u£csDiff
 = 
curQOSRecÜd
->
m—su»m’tEndTime
.
tv_u£c


1313 - 
curQOSRecÜd
->
m—su»m’tS¹Time
.
tv_u£c
;

1314 
m—su»m’tTime
 = 
£csDiff
 + 
u£csDiff
/1000000.0;

1315 *
’v
 << "–­£d_m—su»m’t_time\t" << 
m—su»m’tTime
 << "\n";

1317 *
’v
 << "kBy‹s_»ûived_tÙ®\t" << 
curQOSRecÜd
->
kBy‹sTÙ®
 << "\n";

1319 *
’v
 << "m—su»m’t_§m¶šg_š‹rv®_ms\t" << 
qosM—su»m’tIÁ”v®MS
 << "\n";

1321 ià(
curQOSRecÜd
->
kb™s_³r_£cÚd_max
 == 0) {

1323 *
’v
 <<

1328 *
’v
 << "kb™s_³r_£cÚd_mš\t" << 
curQOSRecÜd
->
kb™s_³r_£cÚd_mš
 << "\n";

1329 *
’v
 << "kbits_per_second_ave\t"

1330 << (
m—su»m’tTime
 =ğ0.0 ? 0.0 : 8*
curQOSRecÜd
->
kBy‹sTÙ®
/measurementTime) << "\n";

1331 *
’v
 << "kb™s_³r_£cÚd_max\t" << 
curQOSRecÜd
->
kb™s_³r_£cÚd_max
 << "\n";

1334 *
’v
 << "·ck‘_loss_³rûÁage_mš\t" << 100*
curQOSRecÜd
->
·ck‘_loss_äaùiÚ_mš
 << "\n";

1335 
·ck‘LossF¿ùiÚ
 = 
numPack‘sEx³ùed
 == 0 ? 1.0

1336 : 1.0 - 
numPack‘sReûived
/()
numPack‘sEx³ùed
;

1337 ià(
·ck‘LossF¿ùiÚ
 < 0.0)…acketLossFraction = 0.0;

1338 *
’v
 << "·ck‘_loss_³rûÁage_ave\t" << 100*
·ck‘LossF¿ùiÚ
 << "\n";

1339 *
’v
 << "packet_loss_percentage_max\t"

1340 << (
·ck‘LossF¿ùiÚ
 =ğ1.0 ? 100.0 : 100*
curQOSRecÜd
->
·ck‘_loss_äaùiÚ_max
) << "\n";

1342 
RTPReû±iÚStsDB
::
I‹¿tÜ
 
	`¡©sI‹r
(
¤c
->
	`»û±iÚStsDB
());

1344 
RTPReû±iÚSts
* 
¡©s
 = 
¡©sI‹r
.
	`Ãxt
(
True
);

1345 ià(
¡©s
 !ğ
NULL
) {

1346 *
’v
 << "š‹r_·ck‘_g­_ms_mš\t" << 
¡©s
->
	`mšIÁ”Pack‘G­US
()/1000.0 << "\n";

1347 
timev®
 
tÙ®G­s
 = 
¡©s
->
	`tÙ®IÁ”Pack‘G­s
();

1348 
tÙ®G­sMS
 = 
tÙ®G­s
.
tv_£c
*1000.0 +Ù®G­s.
tv_u£c
/1000.0;

1349 
tÙNumPack‘sReûived
 = 
¡©s
->
	`tÙNumPack‘sReûived
();

1350 *
’v
 << "inter_packet_gap_ms_ave\t"

1351 << (
tÙNumPack‘sReûived
 =ğ0 ? 0.0 : 
tÙ®G­sMS
/totNumPacketsReceived) << "\n";

1352 *
’v
 << "š‹r_·ck‘_g­_ms_max\t" << 
¡©s
->
	`maxIÁ”Pack‘G­US
()/1000.0 << "\n";

1355 
curQOSRecÜd
 = curQOSRecÜd->
fNext
;

1360 *
’v
 << "end_QOS_statistics\n";

1361 
d–‘e
 
qosRecÜdH—d
;

1362 
	}
}

1364 
BoŞ—n
 
	g¬eAÌ—dyShu‰šgDown
 = 
F®£
;

1365 
	gshutdownEx™Code
;

1366 
	$shutdown
(
ex™Code
) {

1367 ià(
¬eAÌ—dyShu‰šgDown
) ;

1368 
¬eAÌ—dyShu‰šgDown
 = 
True
;

1370 
shutdownEx™Code
 = 
ex™Code
;

1371 ià(
’v
 !ğ
NULL
) {

1372 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
³riodicFeOuutTask
);

1373 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
£ssiÚTim”Task
);

1374 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
£ssiÚTimeoutBrok’S”v”Task
);

1375 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
¬riv®CheckTim”Task
);

1376 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
š‹rPack‘G­CheckTim”Task
);

1377 
’v
->
	`skScheduËr
().
	`unscheduËD–ayedTask
(
qosM—su»m’tTim”Task
);

1380 ià(
qosM—su»m’tIÁ”v®MS
 > 0) {

1381 
	`´štQOSD©a
(
ex™Code
);

1385 
BoŞ—n
 
shutdownImmedŸ‹ly
 = 
True
;

1386 ià(
£ssiÚ
 !ğ
NULL
) {

1387 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
»¥Ú£HªdËrFÜTEARDOWN
 = 
NULL
;

1388 ià(
wa™FÜRe¥Ú£ToTEARDOWN
) {

1389 
shutdownImmedŸ‹ly
 = 
F®£
;

1390 
»¥Ú£HªdËrFÜTEARDOWN
 = 
cÚtšueAá”TEARDOWN
;

1392 
	`‹¬DownSessiÚ
(
£ssiÚ
, 
»¥Ú£HªdËrFÜTEARDOWN
);

1395 ià(
shutdownImmedŸ‹ly
è
	`cÚtšueAá”TEARDOWN
(
NULL
, 0, NULL);

1396 
	}
}

1398 
	$cÚtšueAá”TEARDOWN
(
RTSPCl›Á
*, , * 
»suÉSŒšg
) {

1399 
d–‘e
[] 
»suÉSŒšg
;

1402 
	`şo£MedŸSšks
();

1403 
Medium
::
	`şo£
(
£ssiÚ
);

1406 
d–‘e
 
ourAuth’tiÿtÜ
;

1407 
d–‘e
 
authDBFÜREGISTER
;

1408 
Medium
::
	`şo£
(
ourCl›Á
);

1411 
	`ex™
(
shutdownEx™Code
);

1412 
	}
}

1414 
	$sigÇlHªdËrShutdown
() {

1415 *
’v
 << "Got shutdown signal\n";

1416 
wa™FÜRe¥Ú£ToTEARDOWN
 = 
F®£
;

1417 
	`shutdown
(0);

1418 
	}
}

1420 
	$checkFÜPack‘A¼iv®
(* ) {

1421 ià(!
nÙifyOnPack‘A¼iv®
) ;

1424 
numSub£ssiÚsChecked
 = 0;

1425 
numSub£ssiÚsW™hReûivedD©a
 = 0;

1426 
numSub£ssiÚsTh©HaveB“nSynûd
 = 0;

1428 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

1429 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

1430 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1431 
RTPSourû
* 
¤c
 = 
sub£ssiÚ
->
	`¹pSourû
();

1432 ià(
¤c
 =ğ
NULL
) ;

1433 ++
numSub£ssiÚsChecked
;

1435 ià(
¤c
->
	`»û±iÚStsDB
().
	`numAùiveSourûsSšûLa¡Re£t
() > 0) {

1437 ++
numSub£ssiÚsW™hReûivedD©a
;

1439 ià(
¤c
->
	`hasB“nSynchrÚizedUsšgRTCP
()) {

1440 ++
numSub£ssiÚsTh©HaveB“nSynûd
;

1444 
numSub£ssiÚsToCheck
 = 
numSub£ssiÚsChecked
;

1447 ià(
qtOut
 !ğ
NULL
) {

1448 
numSub£ssiÚsToCheck
 = 
qtOut
->
	`numAùiveSub£ssiÚs
();

1449 } ià(
aviOut
 !ğ
NULL
) {

1450 
numSub£ssiÚsToCheck
 = 
aviOut
->
	`numAùiveSub£ssiÚs
();

1453 
BoŞ—n
 
nÙifyTheU£r
;

1454 ià(!
syncSŒ—ms
) {

1455 
nÙifyTheU£r
 = 
numSub£ssiÚsW™hReûivedD©a
 > 0;

1457 
nÙifyTheU£r
 = 
numSub£ssiÚsW™hReûivedD©a
 >ğ
numSub£ssiÚsToCheck


1458 && 
numSub£ssiÚsTh©HaveB“nSynûd
 =ğ
numSub£ssiÚsChecked
;

1461 ià(
nÙifyTheU£r
) {

1462 
timev®
 
timeNow
;

1463 
	`g‘timeofday
(&
timeNow
, 
NULL
);

1464 
time¡ampSŒ
[100];

1465 
	`¥rštf
(
time¡ampSŒ
, "%ld%03ld", 
timeNow
.
tv_£c
, ()ÑimeNow.
tv_u£c
/1000));

1466 *
’v
 << (
syncSŒ—ms
 ? "Synchronized d" : "D")

1467 << "©¨·ck‘ havbeguÀ¬rivšg [" << 
time¡ampSŒ
 << "]\007\n";

1472 
uSecsToD–ay
 = 100000;

1473 
¬riv®CheckTim”Task


1474 ğ
’v
->
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecsToD–ay
,

1475 (
TaskFunc
*)
checkFÜPack‘A¼iv®
, 
NULL
);

1476 
	}
}

1478 
	$checkIÁ”Pack‘G­s
(* ) {

1479 ià(
š‹rPack‘G­MaxTime
 == 0) ;

1482 
ÃwTÙNumPack‘sReûived
 = 0;

1484 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
£ssiÚ
);

1485 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

1486 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

1487 
RTPSourû
* 
¤c
 = 
sub£ssiÚ
->
	`¹pSourû
();

1488 ià(
¤c
 =ğ
NULL
) ;

1489 
ÃwTÙNumPack‘sReûived
 +ğ
¤c
->
	`»û±iÚStsDB
().
	`tÙNumPack‘sReûived
();

1492 ià(
ÃwTÙNumPack‘sReûived
 =ğ
tÙNumPack‘sReûived
) {

1495 *
’v
 << "Closing session, because we stopped„eceiving…ackets.\n";

1496 
š‹rPack‘G­CheckTim”Task
 = 
NULL
;

1497 
	`£ssiÚAá”PÏyšg
();

1499 
tÙNumPack‘sReûived
 = 
ÃwTÙNumPack‘sReûived
;

1501 
š‹rPack‘G­CheckTim”Task


1502 ğ
’v
->
	`skScheduËr
().
	`scheduËD–ayedTask
(
š‹rPack‘G­MaxTime
*1000000,

1503 (
TaskFunc
*)
checkIÁ”Pack‘G­s
, 
NULL
);

1505 
	}
}

1507 
	$checkSessiÚTimeoutBrok’S”v”
(* ) {

1508 ià(!
£ndK“pAlivesToBrok’S”v”s
) ;

1511 ià(
£ssiÚTimeoutBrok’S”v”Task
 !ğ
NULL
) {

1512 
	`g‘O±iÚs
(
NULL
);

1515 
£ssiÚTimeout
 = 
£ssiÚTimeoutP¬am‘”
 == 0 ? 60 : sessionTimeoutParameter;

1516 
£cÚdsUÁNextK“pAlive
 = 
£ssiÚTimeout
 <= 5 ? 1 : sessionTimeout - 5;

1519 
£ssiÚTimeoutBrok’S”v”Task


1520 ğ
’v
->
	`skScheduËr
().
	`scheduËD–ayedTask
(
£cÚdsUÁNextK“pAlive
*1000000,

1521 (
TaskFunc
*)
checkSessiÚTimeoutBrok’S”v”
, 
NULL
);

1523 
	}
}

	@testProgs/playSIP.cpp

20 
	~"¶ayCommÚ.hh
"

21 
	~"SIPCl›Á.hh
"

23 * 
	$g‘Lše
(* 
¡¬tOfLše
) {

25 * 
±r
 = 
¡¬tOfLše
; *ptr != '\0'; ++ptr) {

26 ià(*
±r
 == '\r' || *ptr == '\n') {

28 *
±r
++ = '\0';

29 ià(*
±r
 == '\n') ++ptr;

30  
±r
;

34  
NULL
;

35 
	}
}

37 
SIPCl›Á
* 
	gourSIPCl›Á
 = 
NULL
;

38 
Medium
* 
	$ü—‹Cl›Á
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* , 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
) {

40 cÚ¡* 
suffix
 = &
­¶iÿtiÚName
[
	`¡¾’
(applicationName)];

41 
suffix
 !ğ
­¶iÿtiÚName
) {

42 ià(*
suffix
 == '/' || *suffix == '\\') {

43 
­¶iÿtiÚName
 = ++
suffix
;

46 --
suffix
;

49 
desœedAudioRTPPaylßdFÜm©
;

50 * 
mimeSubty³
;

51  
ourSIPCl›Á
 = 
SIPCl›Á
::
	`ü—‹New
(
’v
, 
desœedAudioRTPPaylßdFÜm©
, 
mimeSubty³
, 
v”bos™yLev–
, 
­¶iÿtiÚName
);

52 
	}
}

55 
	$assignCl›Á
(
Medium
* ) {

56 
	}
}

58 
g‘O±iÚs
(
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

59 
ourSIPCl›Á
->
’vœ
().
£tResuÉMsg
("NOT SUPPORTED IN CLIENT");

60 
aá”Func
(
NULL
, -1, 
¡rDup
(
ourSIPCl›Á
->
’vœ
().
g‘ResuÉMsg
()));

63 
g‘SDPDesütiÚ
(
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

64 * 
´oxyS”v”Name
;

65 ià(
	g´oxyS”v”Name
 !ğ
NULL
) {

67 
N‘Add»ssLi¡
 
add»s£s
(
´oxyS”v”Name
);

68 ià(
	gadd»s£s
.
numAdd»s£s
() == 0) {

69 
ourSIPCl›Á
->
’vœ
(è<< "FaedØfšd‚‘wÜk‡dd»s fÜ \"" << 
´oxyS”v”Name
 << "\"\n";

71 
N‘Add»ss
 
	gadd»ss
 = *(
add»s£s
.
fœ¡Add»ss
());

72 
	g´oxyS”v”Add»ss


73 ğ*(*)(
add»ss
.
d©a
());

74 
´oxyS”v”PÜtNum
;

75 ià(
	g´oxyS”v”PÜtNum
 =ğ0è
´oxyS”v”PÜtNum
 = 5060;

77 
	gourSIPCl›Á
->
£tProxyS”v”
(
´oxyS”v”Add»ss
, 
´oxyS”v”PÜtNum
);

81 
desœedPÜtNum
;

82 
	gş›ÁS¹PÜtNum
 = 
desœedPÜtNum
;

83 ià(
	gş›ÁS¹PÜtNum
 =ğ0è
ş›ÁS¹PÜtNum
 = 8000;

84 
	gourSIPCl›Á
->
£tCl›ÁS¹PÜtNum
(
ş›ÁS¹PÜtNum
);

86 cÚ¡* 
¡»amURL
;

87 cÚ¡* 
	gu£ºame
 = 
ourAuth’tiÿtÜ
 =ğ
NULL
 ? NULL : ourAuth’tiÿtÜ->
u£ºame
();

88 cÚ¡* 
	g·sswÜd
 = 
ourAuth’tiÿtÜ
 =ğ
NULL
 ? NULL : ourAuth’tiÿtÜ->
·sswÜd
();

89 * 
	g»suÉ
;

90 ià(
	gu£ºame
 !ğ
NULL
 && 
·sswÜd
 != NULL) {

91 
»suÉ
 = 
ourSIPCl›Á
->
šv™eW™hPasswÜd
(
¡»amURL
, 
u£ºame
, 
·sswÜd
);

93 
	g»suÉ
 = 
ourSIPCl›Á
->
šv™e
(
¡»amURL
);

96 
	g»suÉCode
 = 
»suÉ
 =ğ
NULL
 ? -1 : 0;

97 
aá”Func
(
NULL
, 
»suÉCode
, 
¡rDup
(
»suÉ
));

100 
£tupSub£ssiÚ
(
MedŸSub£ssiÚ
* 
sub£ssiÚ
, 
BoŞ—n
 , BoŞ—À ,
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

101 
sub£ssiÚ
->
£tSessiÚId
("mumble");

106 * 
	g£rv”Add»ssSŒ
;

107 
pÜtNumB™s
 
	g£rv”PÜtNum
;

108 
	g¹pChªÃlId
, 
	g¹ıChªÃlId
;

110 
	g¹pChªÃlId
 = 
¹ıChªÃlId
 = 0xff;

111 
	g£rv”PÜtNum
 = 0;

112 
	g£rv”Add»ssSŒ
 = 
NULL
;

114 * 
	gsdp
 = 
¡rDup
(
ourSIPCl›Á
->
g‘Inv™eSdpR•ly
());

116 * 
	glšeS¹
;

117 * 
	gÃxtLšeS¹
 = 
sdp
;

119 
	glšeS¹
 = 
ÃxtLšeS¹
;

120 ià(
	glšeS¹
 =ğ
NULL
) {

123 
	gÃxtLšeS¹
 = 
g‘Lše
(
lšeS¹
);

125 * 
	gtoTagSŒ
 = 
¡rDupSize
(
lšeS¹
);

127 ià(
ssÿnf
(
lšeS¹
, "m÷udiØ%[^/\r\n]", 
toTagSŒ
) == 1) {

128 
ssÿnf
(
toTagSŒ
, "%hu", &
£rv”PÜtNum
);

129 } ià(
ssÿnf
(
lšeS¹
, "c=IN IP4 %[^/\r\n]", 
toTagSŒ
) == 1) {

130 
£rv”Add»ssSŒ
 = 
¡rDup
(
toTagSŒ
);

132 
	gd–‘e
[] 
	gtoTagSŒ
;

135 if(
	gsdp
 !ğ
NULL
) {

136 
d–‘e
[] 
sdp
;

139 
	gd–‘e
[] 
	gsub£ssiÚ
->
cÚÃùiÚEndpoštName
();

140 
	gsub£ssiÚ
->
cÚÃùiÚEndpoštName
(èğ
£rv”Add»ssSŒ
;

141 
	gsub£ssiÚ
->
	g£rv”PÜtNum
 = 
£rv”PÜtNum
;

142 
	gsub£ssiÚ
->
	g¹pChªÃlId
 = 
¹pChªÃlId
;

143 
	gsub£ssiÚ
->
	g¹ıChªÃlId
 = 
¹ıChªÃlId
;

146 
ÃtAdd»ssB™s
 
	gde¡Add»ss
 = 
sub£ssiÚ
->
cÚÃùiÚEndpoštAdd»ss
();

147 ià(
	gde¡Add»ss
 != 0) {

148 
sub£ssiÚ
->
£tDe¡š©iÚs
(
de¡Add»ss
);

152 
aá”Func
(
NULL
, 0, NULL);

155 
¡¬tPÏyšgSessiÚ
(
MedŸSessiÚ
* , , , , 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

156 ià(
ourSIPCl›Á
->
£ndACK
()) {

160 
aá”Func
(
NULL
, 0, NULL);

162 
aá”Func
(
NULL
, -1, 
¡rDup
(
ourSIPCl›Á
->
’vœ
().
g‘ResuÉMsg
()));

165 
¡¬tPÏyšgSessiÚ
(
MedŸSessiÚ
* , cÚ¡ * , cÚ¡ * , , 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

166 
¡¬tPÏyšgSessiÚ
(
NULL
,()0,()0,0,
aá”Func
);

169 
‹¬DownSessiÚ
(
MedŸSessiÚ
* , 
RTSPCl›Á
::
»¥Ú£HªdËr
* 
aá”Func
) {

170 ià(
ourSIPCl›Á
 =ğ
NULL
 || ourSIPCl›Á->
£ndBYE
()) {

171 
aá”Func
(
NULL
, 0, NULL);

173 
aá”Func
(
NULL
, -1, 
¡rDup
(
ourSIPCl›Á
->
’vœ
().
g‘ResuÉMsg
()));

177 
	$£tU£rAg’tSŒšg
(cÚ¡* 
u£rAg’tSŒšg
) {

178 
ourSIPCl›Á
->
	`£tU£rAg’tSŒšg
(
u£rAg’tSŒšg
);

179 
	}
}

181 
BoŞ—n
 
	g®lowProxyS”v”s
 = 
True
;

182 
BoŞ—n
 
	gcÚŒŞCÚÃùiÚU£sTCP
 = 
F®£
;

183 
BoŞ—n
 
	gsuµÜtCodecS–eùiÚ
 = 
True
;

184 cÚ¡* 
	gş›ÁPrÙocŞName
 = "SIP";

	@testProgs/registerRTSPStream.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

24 cÚ¡* 
	g´og¿mName
;

25 
U§geEnvœÚm’t
* 
	g’v
;

27 
BoŞ—n
 
	g»que¡SŒ—mšgVŸTCP
 = 
F®£
;

28 cÚ¡* 
	gu£ºame
 = 
NULL
;

29 cÚ¡* 
	g·sswÜd
 = 
NULL
;

31 
	$»gi¡”Re¥Ú£HªdËr
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

32 
Medium
::
	`şo£
(
¹¥Cl›Á
);

35 
	`ex™
(0);

36 
	}
}

38 
	$u§ge
() {

39 *
’v
 << "u§ge: " << 
´og¿mName
 << " [-t] [-u <username> <password>] "

42 
	`ex™
(1);

43 
	}
}

45 
	$maš
(
¬gc
, cÚ¡** 
¬gv
) {

47 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

48 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

52 
´og¿mName
 = 
¬gv
[0];

53 
¬gc
 > 2) {

54 cÚ¡* cÚ¡ 
İt
 = 
¬gv
[1];

55 ià(
İt
[0] != '-') ;

56 
İt
[1]) {

58 
»que¡SŒ—mšgVŸTCP
 = 
True
;

63 ià(
¬gc
 < 4è
	`u§ge
();

64 
u£ºame
 = 
¬gv
[2];

65 
·sswÜd
 = 
¬gv
[3];

66 
¬gv
+=2; 
¬gc
-=2;

71 
	`u§ge
();

76 ++
¬gv
; --
¬gc
;

78 ià(
¬gc
 !ğ4 &&‡rgø!ğ5è
	`u§ge
();

80 cÚ¡* 
»mÙeCl›ÁNameOrAdd»ss
 = 
¬gv
[1];

82 
pÜtNumB™s
 
»mÙeCl›ÁPÜtNum
;

83 ià(
	`ssÿnf
(
¬gv
[2], "%hu", &
»mÙeCl›ÁPÜtNum
è!ğ1 ||„emÙeCl›ÁPÜtNum =ğ0 ||„emÙeCl›ÁPÜtNum =ğ0xFFFFè
	`u§ge
();

85 cÚ¡* 
¹¥URLToRegi¡”
 = 
¬gv
[3];

87 cÚ¡* 
´oxyURLSuffix
 = 
¬gc
 =ğ5 ? 
¬gv
[4] : 
NULL
;

89 
Auth’tiÿtÜ
* 
ourAuth’tiÿtÜ
 = 
u£ºame
 =ğ
NULL
 ? NULL : 
Ãw
 
	`Auth’tiÿtÜ
(u£ºame, 
·sswÜd
);

93 
RTSPRegi¡”S’d”
::
	`ü—‹New
(*
’v
, 
»mÙeCl›ÁNameOrAdd»ss
, 
»mÙeCl›ÁPÜtNum
, 
¹¥URLToRegi¡”
,

94 
»gi¡”Re¥Ú£HªdËr
, 
ourAuth’tiÿtÜ
,

95 
»que¡SŒ—mšgVŸTCP
, 
´oxyURLSuffix
, 
F®£
 ,

96 1 , 
´og¿mName
);

99 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

102 
	}
}

	@testProgs/sapWatch.cpp

20 
	~"Groupsock.hh
"

21 
	~"GroupsockH–³r.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~<¡dio.h
>

25 cÚ¡ 
	gmaxPack‘Size
 = 65536;

26 
	g·ck‘
[
maxPack‘Size
+1];

28 
	$maš
(
¬gc
, ** 
¬gv
) {

30 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

31 
U§geEnvœÚm’t
* 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

35 cÚ¡* 
£ssiÚAdd»ssSŒ
 = "224.2.127.254";

36 
š_addr
 
£ssiÚAdd»ss
;

37 
£ssiÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
£ssiÚAdd»ssSŒ
);

39 cÚ¡ 
PÜt
 
	`pÜt
(9875);

40 cÚ¡ 
‰l
 = 0;

42 
Groupsock
 
	`šputGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
pÜt
, 
‰l
);

48 
·ck‘Size
;

49 
sockaddr_š
 
äomAdd»ss
;

50 
šputGroupsock
.
	`hªdËR—d
(
·ck‘
, 
maxPack‘Size
,

51 
·ck‘Size
, 
äomAdd»ss
)) {

52 
	`´štf
("\n[·ck‘ from % (%d by‹s)]\n", 
	`Add»ssSŒšg
(
äomAdd»ss
).
	`v®
(), 
·ck‘Size
);

55 ià(
·ck‘Size
 < 8) {

56 *
’v
 << "IgnÜšg shÜˆ·ck‘ from " << 
	`Add»ssSŒšg
(
äomAdd»ss
).
	`v®
() << "%s!\n";

62 
idx
 = 8;

63 
idx
 < 
·ck‘Size
) {

64 ià(
·ck‘
[
idx
] < 0x20 &&…acket[idx] != '\n')…acket[idx] = 0x20;

65 
idx
++;

68 
·ck‘
[
·ck‘Size
] = '\0';

69 
	`´štf
("%s", (*)(
·ck‘
+8));

73 
	}
}

	@testProgs/testAMRAudioStreamer.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~"GroupsockH–³r.hh
"

25 
U§geEnvœÚm’t
* 
	g’v
;

26 cÚ¡* 
	gšputFeName
 = "test.amr";

27 
AMRAudioFeSourû
* 
	gaudioSourû
;

28 
RTPSšk
* 
	gaudioSšk
;

30 
¶ay
();

32 
	$maš
(
¬gc
, ** 
¬gv
) {

34 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

35 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

38 
š_addr
 
de¡š©iÚAdd»ss
;

39 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

44 cÚ¡ 
¹pPÜtNum
 = 16666;

45 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

46 cÚ¡ 
‰l
 = 255;

48 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

49 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

51 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

52 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

53 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

54 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

57 
audioSšk
 = 
AMRAudioRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 96);

60 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 10;

61 cÚ¡ 
maxCNAMEËn
 = 100;

62 
CNAME
[
maxCNAMEËn
+1];

63 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

64 
CNAME
[
maxCNAMEËn
] = '\0';

65 
RTCPIn¡ªû
* 
¹ı


66 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

67 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

68 
audioSšk
, 
NULL
 ,

69 
True
 );

73 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554);

74 ià(
¹¥S”v”
 =ğ
NULL
) {

75 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

76 
	`ex™
(1);

78 
S”v”MedŸSessiÚ
* 
sms


79 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

81 
True
 );

82 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
audioSšk
, 
¹ı
));

83 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

85 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

86 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

87 
d–‘e
[] 
u¾
;

90 *
’v
 << "Beginning streaming...\n";

91 
	`¶ay
();

93 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

96 
	}
}

98 
	$aá”PÏyšg
(* ) {

99 *
’v
 << "...done„eading from file\n";

101 
audioSšk
->
	`¡İPÏyšg
();

102 
Medium
::
	`şo£
(
audioSourû
);

105 
	`¶ay
();

106 
	}
}

108 
	$¶ay
() {

110 
AMRAudioFeSourû
* 
audioSourû


111 ğ
AMRAudioFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

112 ià(
audioSourû
 =ğ
NULL
) {

113 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


115 << 
’v
->
	`g‘ResuÉMsg
() << "\n";

116 
	`ex™
(1);

120 *
’v
 << "Beginningo„ead from file...\n";

121 
audioSšk
->
	`¡¬tPÏyšg
(*
audioSourû
, 
aá”PÏyšg
,‡udioSink);

122 
	}
}

	@testProgs/testDVVideoStreamer.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~"GroupsockH–³r.hh
"

25 
U§geEnvœÚm’t
* 
	g’v
;

26 cÚ¡* 
	gšputFeName
 = "test.dv";

27 
DVVideoSŒ—mF¿m”
* 
	gvideoSourû
;

28 
RTPSšk
* 
	gvideoSšk
;

30 
¶ay
();

32 
	$maš
(
¬gc
, ** 
¬gv
) {

34 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

35 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

38 
š_addr
 
de¡š©iÚAdd»ss
;

39 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

44 cÚ¡ 
¹pPÜtNum
 = 18888;

45 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

46 cÚ¡ 
‰l
 = 255;

48 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

49 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

51 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

52 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

53 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

54 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

58 
OutPack‘Bufãr
::
maxSize
 = 300000;

59 
videoSšk
 = 
DVVideoRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 96);

62 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 50000;

63 cÚ¡ 
maxCNAMEËn
 = 100;

64 
CNAME
[
maxCNAMEËn
+1];

65 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

66 
CNAME
[
maxCNAMEËn
] = '\0';

67 
RTCPIn¡ªû
* 
¹ı


68 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

69 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

70 
videoSšk
, 
NULL
 ,

71 
True
 );

74 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554);

75 ià(
¹¥S”v”
 =ğ
NULL
) {

76 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

77 
	`ex™
(1);

79 
S”v”MedŸSessiÚ
* 
sms


80 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

82 
True
 );

83 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
¹ı
));

84 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

86 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

87 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

88 
d–‘e
[] 
u¾
;

91 *
’v
 << "Beginning streaming...\n";

92 
	`¶ay
();

94 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

97 
	}
}

99 
	$aá”PÏyšg
(* ) {

100 *
’v
 << "...done„eading from file\n";

102 
videoSšk
->
	`¡İPÏyšg
();

103 
Medium
::
	`şo£
(
videoSourû
);

107 
	`¶ay
();

108 
	}
}

110 
	$¶ay
() {

112 
By‹SŒ—mFeSourû
* 
feSourû


113 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

114 ià(
feSourû
 =ğ
NULL
) {

115 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


117 
	`ex™
(1);

120 
F¿medSourû
* 
videoES
 = 
feSourû
;

123 
videoSourû
 = 
DVVideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
);

126 *
’v
 << "Beginningo„ead from file...\n";

127 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

128 
	}
}

	@testProgs/testGSMStreamer.cpp

23 
	~"liveMedŸ.hh
"

24 
	~"GroupsockH–³r.hh
"

26 
	~"BasicU§geEnvœÚm’t.hh
"

32 #ifdeà
USE_SSM


33 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
True
;

35 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
F®£
;

42 #ifdeà
IMPLEMENT_RTSP_SERVER


43 
RTSPS”v”
* 
	g¹¥S”v”
;

46 
U§geEnvœÚm’t
* 
	g’v
;

48 
aá”PÏyšg
(* 
ş›ÁD©a
);

52 
	s£ssiÚS‹_t
 {

53 
F¿medSourû
* 
	msourû
;

54 
RTPSšk
* 
	msšk
;

55 
RTCPIn¡ªû
* 
	m¹ıIn¡ªû
;

56 
Groupsock
* 
	m¹pGroupsock
;

57 
Groupsock
* 
	m¹ıGroupsock
;

58 } 
	g£ssiÚS‹
;

60 
¶ay
();

62 
	$maš
(
¬gc
, ** 
¬gv
) {

64 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

65 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

68 * 
de¡š©iÚAdd»ssSŒ


69 #ifdeà
USE_SSM


78 cÚ¡ 
¹pPÜtNum
 = 6666;

79 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

80 cÚ¡ 
‰l
 = 1;

82 
š_addr
 
de¡š©iÚAdd»ss
;

83 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
de¡š©iÚAdd»ssSŒ
);

84 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

85 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

87 
£ssiÚS‹
.
¹pGroupsock


88 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

89 
£ssiÚS‹
.
¹ıGroupsock


90 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

91 #ifdeà
USE_SSM


92 
£ssiÚS‹
.
¹pGroupsock
->
	`muÉiÿ¡S’dOÆy
();

93 
£ssiÚS‹
.
¹ıGroupsock
->
	`muÉiÿ¡S’dOÆy
();

97 
£ssiÚS‹
.
sšk


98 ğ
GSMAudioRTPSšk
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹pGroupsock
);

101 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 160;

102 cÚ¡ 
maxCNAMEËn
 = 100;

103 
CNAME
[
maxCNAMEËn
+1];

104 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

105 
CNAME
[
maxCNAMEËn
] = '\0';

106 
£ssiÚS‹
.
¹ıIn¡ªû


107 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹ıGroupsock
,

108 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

109 
£ssiÚS‹
.
sšk
, 
NULL
 ,

110 
isSSM
);

113 #ifdeà
IMPLEMENT_RTSP_SERVER


114 
¹¥S”v”
 = 
RTSPS”v”
::
	`ü—‹New
(*
’v
, 8554);

115 ià(
¹¥S”v”
 =ğ
NULL
) {

116 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "%s\n";

117 
	`ex™
(1);

119 
S”v”MedŸSessiÚ
* 
sms


120 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "testStream", "GSM input",

121 "SessiÚ sŒ—med by \"‹¡GSMSŒ—m”\"", 
isSSM
);

122 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
£ssiÚS‹
.
sšk
, sessiÚS‹.
¹ıIn¡ªû
));

123 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

125 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

126 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

127 
d–‘e
[] 
u¾
;

130 
	`¶ay
();

132 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

134 
	}
}

136 
	$¶ay
() {

138 
F¿medSourû
* 
	`ü—‹NewGSMAudioSourû
(
U§geEnvœÚm’t
&);

139 
£ssiÚS‹
.
sourû
 = 
	`ü—‹NewGSMAudioSourû
(*
’v
);

140 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

141 *
’v
 << "Failedo create GSM source\n";

142 
	`ex™
(1);

146 *
’v
 << "Beginning streaming...\n";

147 
£ssiÚS‹
.
sšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
sourû
, 
aá”PÏyšg
, 
NULL
);

148 
	}
}

151 
	$aá”PÏyšg
(* ) {

152 *
’v
 << "...done streaming\n";

154 
£ssiÚS‹
.
sšk
->
	`¡İPÏyšg
();

157 #ifdeà
IMPLEMENT_RTSP_SERVER


158 
Medium
::
	`şo£
(
¹¥S”v”
);

160 
Medium
::
	`şo£
(
£ssiÚS‹
.
¹ıIn¡ªû
);

161 
Medium
::
	`şo£
(
£ssiÚS‹
.
sšk
);

162 
d–‘e
 
£ssiÚS‹
.
¹pGroupsock
;

163 
Medium
::
	`şo£
(
£ssiÚS‹
.
sourû
);

164 
d–‘e
 
£ssiÚS‹
.
¹ıGroupsock
;

167 
	`¶ay
();

168 
	}
}

	@testProgs/testH264VideoStreamer.cpp

27 
	~<liveMedŸ.hh
>

28 
	~<BasicU§geEnvœÚm’t.hh
>

29 
	~<GroupsockH–³r.hh
>

31 
U§geEnvœÚm’t
* 
	g’v
;

32 cÚ¡* 
	gšputFeName
 = "test.264";

33 
H264VideoSŒ—mF¿m”
* 
	gvideoSourû
;

34 
RTPSšk
* 
	gvideoSšk
;

36 
¶ay
();

38 
	$maš
(
¬gc
, ** 
¬gv
) {

40 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

41 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

44 
š_addr
 
de¡š©iÚAdd»ss
;

45 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

50 cÚ¡ 
¹pPÜtNum
 = 18888;

51 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

52 cÚ¡ 
‰l
 = 255;

54 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

55 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

57 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

58 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

59 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

60 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

63 
OutPack‘Bufãr
::
maxSize
 = 100000;

64 
videoSšk
 = 
H264VideoRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 96);

67 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 500;

68 cÚ¡ 
maxCNAMEËn
 = 100;

69 
CNAME
[
maxCNAMEËn
+1];

70 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

71 
CNAME
[
maxCNAMEËn
] = '\0';

72 
RTCPIn¡ªû
* 
¹ı


73 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

74 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

75 
videoSšk
, 
NULL
 ,

76 
True
 );

79 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554);

80 ià(
¹¥S”v”
 =ğ
NULL
) {

81 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

82 
	`ex™
(1);

84 
S”v”MedŸSessiÚ
* 
sms


85 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

87 
True
 );

88 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
¹ı
));

89 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

91 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

92 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

93 
d–‘e
[] 
u¾
;

96 *
’v
 << "Beginning streaming...\n";

97 
	`¶ay
();

99 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

102 
	}
}

104 
	$aá”PÏyšg
(* ) {

105 *
’v
 << "...done„eading from file\n";

106 
videoSšk
->
	`¡İPÏyšg
();

107 
Medium
::
	`şo£
(
videoSourû
);

111 
	`¶ay
();

112 
	}
}

114 
	$¶ay
() {

116 
By‹SŒ—mFeSourû
* 
feSourû


117 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

118 ià(
feSourû
 =ğ
NULL
) {

119 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


121 
	`ex™
(1);

124 
F¿medSourû
* 
videoES
 = 
feSourû
;

127 
videoSourû
 = 
H264VideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
);

130 *
’v
 << "Beginningo„ead from file...\n";

131 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

132 
	}
}

	@testProgs/testH264VideoToTransportStream.cpp

20 
	~"liveMedŸ.hh
"

21 
	~"BasicU§geEnvœÚm’t.hh
"

23 cÚ¡* 
	gšputFeName
 = "in.264";

24 cÚ¡* 
	gouutFeName
 = "out.ts";

26 
aá”PÏyšg
(* 
ş›ÁD©a
);

28 
U§geEnvœÚm’t
* 
	g’v
;

30 
	$maš
(
¬gc
, ** 
¬gv
) {

32 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

33 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

36 
F¿medSourû
* 
šputSourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

37 ià(
šputSourû
 =ğ
NULL
) {

38 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


40 
	`ex™
(1);

44 
H264VideoSŒ—mF¿m”
* 
äam”
 = H264VideoSŒ—mF¿m”::
	`ü—‹New
(*
’v
, 
šputSourû
, 
True
 );

47 
MPEG2T¿n¥ÜtSŒ—mFromESSourû
* 
tsF¿mes
 = MPEG2T¿n¥ÜtSŒ—mFromESSourû::
	`ü—‹New
(*
’v
);

48 
tsF¿mes
->
	`addNewVideoSourû
(
äam”
, 5 );

51 
MedŸSšk
* 
ouutSšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName
);

52 ià(
ouutSšk
 =ğ
NULL
) {

53 *
’v
 << "UÇbËØİ’ f\"" << 
ouutFeName
 << "\"‡s‡ file sink\n";

54 
	`ex™
(1);

58 *
’v
 << "Beginningo„ead...\n";

59 
ouutSšk
->
	`¡¬tPÏyšg
(*
tsF¿mes
, 
aá”PÏyšg
, 
NULL
);

61 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

64 
	}
}

66 
	$aá”PÏyšg
(* ) {

67 *
’v
 << "Done„eading.\n";

68 *
’v
 << "WrÙouuˆfe: \"" << 
ouutFeName
 << "\"\n";

69 
	`ex™
(0);

70 
	}
}

	@testProgs/testH265VideoStreamer.cpp

28 
	~<liveMedŸ.hh
>

29 
	~<BasicU§geEnvœÚm’t.hh
>

30 
	~<GroupsockH–³r.hh
>

32 
U§geEnvœÚm’t
* 
	g’v
;

33 cÚ¡* 
	gšputFeName
 = "test.265";

34 
H265VideoSŒ—mF¿m”
* 
	gvideoSourû
;

35 
RTPSšk
* 
	gvideoSšk
;

37 
¶ay
();

39 
	$maš
(
¬gc
, ** 
¬gv
) {

41 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

42 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

45 
š_addr
 
de¡š©iÚAdd»ss
;

46 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

51 cÚ¡ 
¹pPÜtNum
 = 18888;

52 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

53 cÚ¡ 
‰l
 = 255;

55 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

56 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

58 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

59 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

60 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

61 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

64 
OutPack‘Bufãr
::
maxSize
 = 100000;

65 
videoSšk
 = 
H265VideoRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 96);

68 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 500;

69 cÚ¡ 
maxCNAMEËn
 = 100;

70 
CNAME
[
maxCNAMEËn
+1];

71 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

72 
CNAME
[
maxCNAMEËn
] = '\0';

73 
RTCPIn¡ªû
* 
¹ı


74 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

75 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

76 
videoSšk
, 
NULL
 ,

77 
True
 );

80 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554);

81 ià(
¹¥S”v”
 =ğ
NULL
) {

82 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

83 
	`ex™
(1);

85 
S”v”MedŸSessiÚ
* 
sms


86 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

88 
True
 );

89 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
¹ı
));

90 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

92 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

93 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

94 
d–‘e
[] 
u¾
;

97 *
’v
 << "Beginning streaming...\n";

98 
	`¶ay
();

100 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

103 
	}
}

105 
	$aá”PÏyšg
(* ) {

106 *
’v
 << "...done„eading from file\n";

107 
videoSšk
->
	`¡İPÏyšg
();

108 
Medium
::
	`şo£
(
videoSourû
);

112 
	`¶ay
();

113 
	}
}

115 
	$¶ay
() {

117 
By‹SŒ—mFeSourû
* 
feSourû


118 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

119 ià(
feSourû
 =ğ
NULL
) {

120 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


122 
	`ex™
(1);

125 
F¿medSourû
* 
videoES
 = 
feSourû
;

128 
videoSourû
 = 
H265VideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
);

131 *
’v
 << "Beginningo„ead from file...\n";

132 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

133 
	}
}

	@testProgs/testH265VideoToTransportStream.cpp

20 
	~"liveMedŸ.hh
"

21 
	~"BasicU§geEnvœÚm’t.hh
"

23 cÚ¡* 
	gšputFeName
 = "in.265";

24 cÚ¡* 
	gouutFeName
 = "out.ts";

26 
aá”PÏyšg
(* 
ş›ÁD©a
);

28 
U§geEnvœÚm’t
* 
	g’v
;

30 
	$maš
(
¬gc
, ** 
¬gv
) {

32 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

33 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

36 
F¿medSourû
* 
šputSourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

37 ià(
šputSourû
 =ğ
NULL
) {

38 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


40 
	`ex™
(1);

44 
H265VideoSŒ—mF¿m”
* 
äam”
 = H265VideoSŒ—mF¿m”::
	`ü—‹New
(*
’v
, 
šputSourû
, 
True
 );

47 
MPEG2T¿n¥ÜtSŒ—mFromESSourû
* 
tsF¿mes
 = MPEG2T¿n¥ÜtSŒ—mFromESSourû::
	`ü—‹New
(*
’v
);

48 
tsF¿mes
->
	`addNewVideoSourû
(
äam”
, 6 );

51 
MedŸSšk
* 
ouutSšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName
);

52 ià(
ouutSšk
 =ğ
NULL
) {

53 *
’v
 << "UÇbËØİ’ f\"" << 
ouutFeName
 << "\"‡s‡ file sink\n";

54 
	`ex™
(1);

58 *
’v
 << "Beginningo„ead...\n";

59 
ouutSšk
->
	`¡¬tPÏyšg
(*
tsF¿mes
, 
aá”PÏyšg
, 
NULL
);

61 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

64 
	}
}

66 
	$aá”PÏyšg
(* ) {

67 *
’v
 << "Done„eading.\n";

68 *
’v
 << "WrÙouuˆfe: \"" << 
ouutFeName
 << "\"\n";

69 
	`ex™
(0);

70 
	}
}

	@testProgs/testMKVStreamer.cpp

21 
	~<liveMedŸ.hh
>

22 
	~<BasicU§geEnvœÚm’t.hh
>

23 
	~<GroupsockH–³r.hh
>

25 
U§geEnvœÚm’t
* 
	g’v
;

26 cÚ¡* 
	gšputFeName
 = "test.mkv";

27 
š_addr
 
	gde¡š©iÚAdd»ss
;

28 
RTSPS”v”
* 
	g¹¥S”v”
;

29 
S”v”MedŸSessiÚ
* 
	gsms
;

30 
M©roskaFe
* 
	gm©roskaFe
;

31 
M©roskaDemux
* 
	gm©roskaDemux
;

35 
	mŒackNumb”
;

36 
F¿medSourû
* 
	msourû
;

37 
RTPSšk
* 
	msšk
;

38 
RTCPIn¡ªû
* 
	m¹ı
;

39 } 
	gŒackS‹
[3];

41 
ÚM©roskaFeC»©iÚ
(
M©roskaFe
* 
ÃwFe
, * 
ş›ÁD©a
);

43 
	$maš
(
¬gc
, ** 
¬gv
) {

45 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

46 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

49 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

55 
¹¥S”v”
 = 
RTSPS”v”
::
	`ü—‹New
(*
’v
, 8554);

56 ià(
¹¥S”v”
 =ğ
NULL
) {

57 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

58 
	`ex™
(1);

60 
sms
 = 
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

62 
True
 );

66 
M©roskaFe
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
ÚM©roskaFeC»©iÚ
, 
NULL
, "jpn");

68 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

71 
	}
}

73 
¶ay
();

75 
	$ÚM©roskaFeC»©iÚ
(
M©roskaFe
* 
ÃwFe
, * ) {

76 
m©roskaFe
 = 
ÃwFe
;

79 
m©roskaDemux
 = 
m©roskaFe
->
	`ÃwDemux
();

82 
¹pPÜtNum
 = 44444;

83 cÚ¡ 
‰l
 = 255;

85 cÚ¡ 
maxCNAMEËn
 = 100;

86 
CNAME
[
maxCNAMEËn
+1];

87 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

88 
CNAME
[
maxCNAMEËn
] = '\0';

90 
i
 = 0; i < 3; ++i) {

91 
ŒackNumb”
;

92 
F¿medSourû
* 
ba£Sourû
 = 
m©roskaDemux
->
	`ÃwDemuxedT¿ck
(
ŒackNumb”
);

93 
ŒackS‹
[
i
].
ŒackNumb”
 =rackNumber;

95 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
;

96 
ŒackS‹
[
i
].
sourû
 = 
m©roskaFe


97 ->
	`ü—‹SourûFÜSŒ—mšg
(
ba£Sourû
, 
ŒackNumb”
, 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
);

98 
ŒackS‹
[
i
].
sšk
 = 
NULL
;

99 
ŒackS‹
[
i
].
¹ı
 = 
NULL
;

101 ià(
ŒackS‹
[
i
].
sourû
 !ğ
NULL
) {

102 
Groupsock
* 
¹pGroupsock
 = 
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtNum
, 
‰l
);

103 
Groupsock
* 
¹ıGroupsock
 = 
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtNum
+1, 
‰l
);

104 
¹pPÜtNum
 += 2;

106 
ŒackS‹
[
i
].
sšk


107 ğ
m©roskaFe
->
	`ü—‹RTPSškFÜT¿ckNumb”
(
ŒackNumb”
, 
¹pGroupsock
, 96+
i
);

108 ià(
ŒackS‹
[
i
].
sšk
 !ğ
NULL
) {

109 ià(
ŒackS‹
[
i
].
sšk
->
	`e¡im©edB™¿‹
() > 0) {

110 
e¡B™¿‹
 = 
ŒackS‹
[
i
].
sšk
->
	`e¡im©edB™¿‹
();

112 
ŒackS‹
[
i
].
¹ı


113 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
¹ıGroupsock
, 
e¡B™¿‹
, 
CNAME
,

114 
ŒackS‹
[
i
].
sšk
, 
NULL
 ,

115 
True
 );

119 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
ŒackS‹
[
i
].
sšk
,¿ckS‹[i].
¹ı
));

124 ià(
sms
->
	`numSub£ssiÚs
() == 0) {

125 *
’v
 << "E¼Ü: ThM©rosk¨f\"" << 
šputFeName
 << "\" has‚o streamableracks\n";

126 *
’v
 << "(Perhapshe file does‚otƒxist, or is‚ot‡ 'Matroska' file.)\n";

127 
	`ex™
(1);

130 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

132 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

133 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

134 
d–‘e
[] 
u¾
;

137 
	`¶ay
();

138 
	}
}

140 
	$aá”PÏyšg
(* ) {

141 *
’v
 << "...done„eading from file\n";

145 
i
;

146 
i
 = 0; i < 3; ++i) {

147 ià(
ŒackS‹
[
i
].
sšk
 !ğ
NULL
èŒackS‹[i].sšk->
	`¡İPÏyšg
();

148 
Medium
::
	`şo£
(
ŒackS‹
[
i
].
sourû
);¿ckS‹[i].sourû = 
NULL
;

152 
m©roskaDemux
 = 
m©roskaFe
->
	`ÃwDemux
();

153 
i
 = 0; i < 3; ++i) {

154 ià(
ŒackS‹
[
i
].
ŒackNumb”
 != 0) {

155 
F¿medSourû
* 
ba£Sourû


156 ğ
m©roskaDemux
->
	`ÃwDemuxedT¿ckByT¿ckNumb”
(
ŒackS‹
[
i
].
ŒackNumb”
);

158 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
;

159 
ŒackS‹
[
i
].
sourû
 = 
m©roskaFe


160 ->
	`ü—‹SourûFÜSŒ—mšg
(
ba£Sourû
, 
ŒackS‹
[
i
].
ŒackNumb”
,

161 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
);

166 
	`¶ay
();

167 
	}
}

169 
	$¶ay
() {

170 *
’v
 << "Beginningo„ead from file...\n";

173 
i
 = 0; i < 3; ++i) {

174 ià(
ŒackS‹
[
i
].
sšk
 !ğ
NULL
 &&¿ckS‹[i].
sourû
 != NULL) {

175 
ŒackS‹
[
i
].
sšk
->
	`¡¬tPÏyšg
(*ŒackS‹[i].
sourû
, 
aá”PÏyšg
, 
NULL
);

178 
	}
}

	@testProgs/testMP3Receiver.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"GroupsockH–³r.hh
"

24 
	~"BasicU§geEnvœÚm’t.hh
"

34 
aá”PÏyšg
(* 
ş›ÁD©a
);

38 
	s£ssiÚS‹_t
 {

39 
F¿medSourû
* 
	msourû
;

40 
FeSšk
* 
	msšk
;

41 
RTCPIn¡ªû
* 
	m¹ıIn¡ªû
;

42 } 
	g£ssiÚS‹
;

44 
U§geEnvœÚm’t
* 
	g’v
;

46 
	$maš
(
¬gc
, ** 
¬gv
) {

48 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

49 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

52 
£ssiÚS‹
.
sšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, "stdout");

57 cÚ¡* 
£ssiÚAdd»ssSŒ


58 #ifdeà
USE_SSM


65 cÚ¡ 
¹pPÜtNum
 = 6666;

66 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

67 #iâdeà
USE_SSM


68 cÚ¡ 
‰l
 = 1;

71 
š_addr
 
£ssiÚAdd»ss
;

72 
£ssiÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
£ssiÚAdd»ssSŒ
);

73 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

74 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

76 #ifdeà
USE_SSM


77 * 
sourûAdd»ssSŒ
 = "aaa.bbb.ccc.ddd";

79 
š_addr
 
sourûF‹rAdd»ss
;

80 
sourûF‹rAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
sourûAdd»ssSŒ
);

82 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
sourûF‹rAdd»ss
, 
¹pPÜt
);

83 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
sourûF‹rAdd»ss
, 
¹ıPÜt
);

84 
¹ıGroupsock
.
	`chªgeDe¡š©iÚP¬am‘”s
(
sourûF‹rAdd»ss
,0,~0);

87 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
¹pPÜt
, 
‰l
);

88 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

91 
RTPSourû
* 
¹pSourû
;

92 #iâdeà
STREAM_USING_ADUS


94 
¹pSourû
 = 
MPEG1Ü2AudioRTPSourû
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
);

97 
¹pPaylßdFÜm©
 = 96;

98 
¹pSourû


99 ğ
MP3ADURTPSourû
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 
¹pPaylßdFÜm©
);

103 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 160;

104 cÚ¡ 
maxCNAMEËn
 = 100;

105 
CNAME
[
maxCNAMEËn
+1];

106 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

107 
CNAME
[
maxCNAMEËn
] = '\0';

108 
£ssiÚS‹
.
¹ıIn¡ªû


109 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

110 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

111 
NULL
 , 
¹pSourû
);

114 
£ssiÚS‹
.
sourû
 = 
¹pSourû
;

115 #ifdeà
STREAM_USING_ADUS


117 
£ssiÚS‹
.
sourû


118 ğ
MP3ADUdeš‹¾—v”
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
sourû
);

119 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

120 *
’v
 << "Unableo create‡n ADU deinterleaving filter forhe source\n";

121 
	`ex™
(1);

125 
£ssiÚS‹
.
sourû


126 ğ
MP3FromADUSourû
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
sourû
);

127 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

128 *
’v
 << "Unableo create‡n ADU->MP3 filter forhe source\n";

129 
	`ex™
(1);

134 *
’v
 << "Beginning„eceiving multicast stream...\n";

135 
£ssiÚS‹
.
sšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
sourû
, 
aá”PÏyšg
, 
NULL
);

137 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

140 
	}
}

143 
	$aá”PÏyšg
(* ) {

144 *
’v
 << "...done„eceiving\n";

147 
Medium
::
	`şo£
(
£ssiÚS‹
.
¹ıIn¡ªû
);

148 
Medium
::
	`şo£
(
£ssiÚS‹
.
sšk
);

149 
Medium
::
	`şo£
(
£ssiÚS‹
.
sourû
);

150 
	}
}

	@testProgs/testMP3Streamer.cpp

20 
	~"liveMedŸ.hh
"

21 
	~"GroupsockH–³r.hh
"

23 
	~"BasicU§geEnvœÚm’t.hh
"

34 #ifdeà
USE_SSM


35 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
True
;

37 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
F®£
;

44 #ifdeà
IMPLEMENT_RTSP_SERVER


45 
RTSPS”v”
* 
	g¹¥S”v”
;

48 
U§geEnvœÚm’t
* 
	g’v
;

52 
	s£ssiÚS‹_t
 {

53 
F¿medSourû
* 
	msourû
;

54 
RTPSšk
* 
	msšk
;

55 
RTCPIn¡ªû
* 
	m¹ıIn¡ªû
;

56 
Groupsock
* 
	m¹pGroupsock
;

57 
Groupsock
* 
	m¹ıGroupsock
;

58 } 
	g£ssiÚS‹
;

60 cÚ¡* 
	gšputFeName
 = "test.mp3";

62 
¶ay
();

64 
	$maš
(
¬gc
, ** 
¬gv
) {

66 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

67 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

70 cÚ¡* 
de¡š©iÚAdd»ssSŒ


71 #ifdeà
USE_SSM


80 cÚ¡ 
¹pPÜtNum
 = 6666;

81 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

82 cÚ¡ 
‰l
 = 1;

84 
š_addr
 
de¡š©iÚAdd»ss
;

85 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
de¡š©iÚAdd»ssSŒ
);

86 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

87 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

89 
£ssiÚS‹
.
¹pGroupsock


90 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

91 
£ssiÚS‹
.
¹ıGroupsock


92 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

93 #ifdeà
USE_SSM


94 
£ssiÚS‹
.
¹pGroupsock
->
	`muÉiÿ¡S’dOÆy
();

95 
£ssiÚS‹
.
¹ıGroupsock
->
	`muÉiÿ¡S’dOÆy
();

99 #ifdeà
STREAM_USING_ADUS


100 
¹pPaylßdFÜm©
 = 96;

101 
£ssiÚS‹
.
sšk


102 ğ
MP3ADURTPSšk
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹pGroupsock
,

103 
¹pPaylßdFÜm©
);

105 
£ssiÚS‹
.
sšk


106 ğ
MPEG1Ü2AudioRTPSšk
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹pGroupsock
);

110 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 160;

111 cÚ¡ 
maxCNAMEËn
 = 100;

112 
CNAME
[
maxCNAMEËn
+1];

113 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

114 
CNAME
[
maxCNAMEËn
] = '\0';

115 
£ssiÚS‹
.
¹ıIn¡ªû


116 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹ıGroupsock
,

117 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

118 
£ssiÚS‹
.
sšk
, 
NULL
 ,

119 
isSSM
);

122 #ifdeà
IMPLEMENT_RTSP_SERVER


123 
¹¥S”v”
 = 
RTSPS”v”
::
	`ü—‹New
(*
’v
);

127 ià(
¹¥S”v”
 =ğ
NULL
) {

128 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

129 
	`ex™
(1);

131 
S”v”MedŸSessiÚ
* 
sms


132 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

133 "SessiÚ sŒ—med by \"‹¡MP3SŒ—m”\"", 
isSSM
);

134 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
£ssiÚS‹
.
sšk
, sessiÚS‹.
¹ıIn¡ªû
));

135 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

137 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

138 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

139 
d–‘e
[] 
u¾
;

142 
	`¶ay
();

144 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

146 
	}
}

148 
aá”PÏyšg
(* 
ş›ÁD©a
);

150 
	$¶ay
() {

152 
£ssiÚS‹
.
sourû
 = 
MP3FeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

153 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

154 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


156 
	`ex™
(1);

159 #ifdeà
STREAM_USING_ADUS


161 
£ssiÚS‹
.
sourû


162 ğ
ADUFromMP3Sourû
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
sourû
);

163 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

164 *
’v
 << "Unableo create‡ MP3->ADU filter forhe source\n";

165 
	`ex™
(1);

168 #ifdeà
INTERLEAVE_ADUS


170 
š‹¾—veCyşe
[] = {0,2,1,3};

171 cÚ¡ 
š‹¾—veCyşeSize


172 ğ( 
š‹¾—veCyşe
)/( ());

173 
IÁ”Ëavšg
 
	`š‹¾—všg
(
š‹¾—veCyşeSize
, 
š‹¾—veCyşe
);

174 
£ssiÚS‹
.
sourû


175 ğ
MP3ADUš‹¾—v”
::
	`ü—‹New
(*
’v
, 
š‹¾—všg
, 
£ssiÚS‹
.
sourû
);

176 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

177 *
’v
 << "Unableo create‡n ADU interleaving filter forhe source\n";

178 
	`ex™
(1);

184 *
’v
 << "Beginning streaming...\n";

185 
£ssiÚS‹
.
sšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
sourû
, 
aá”PÏyšg
, 
NULL
);

186 
	}
}

189 
	$aá”PÏyšg
(* ) {

190 *
’v
 << "...done streaming\n";

192 
£ssiÚS‹
.
sšk
->
	`¡İPÏyšg
();

195 
Medium
::
	`şo£
(
£ssiÚS‹
.
sourû
);

198 
	`¶ay
();

199 
	}
}

	@testProgs/testMPEG1or2AudioVideoStreamer.cpp

22 
	~"liveMedŸ.hh
"

23 
	~"BasicU§geEnvœÚm’t.hh
"

24 
	~"GroupsockH–³r.hh
"

26 
U§geEnvœÚm’t
* 
	g’v
;

27 cÚ¡* 
	gšputFeName
 = "test.mpg";

28 
MPEG1Ü2Demux
* 
	gm³gDemux
;

29 
F¿medSourû
* 
	gaudioSourû
;

30 
F¿medSourû
* 
	gvideoSourû
;

31 
RTPSšk
* 
	gaudioSšk
;

32 
RTPSšk
* 
	gvideoSšk
;

34 
¶ay
();

38 #ifdeà
USE_SSM


39 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
True
;

41 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
F®£
;

50 
BoŞ—n
 
	giF¿mesOÆy
 = 
F®£
;

52 
	$maš
(
¬gc
, ** 
¬gv
) {

54 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

55 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

58 cÚ¡* 
de¡š©iÚAdd»ssSŒ


59 #ifdeà
USE_SSM


68 cÚ¡ 
¹pPÜtNumAudio
 = 6666;

69 cÚ¡ 
¹ıPÜtNumAudio
 = 
¹pPÜtNumAudio
+1;

70 cÚ¡ 
¹pPÜtNumVideo
 = 8888;

71 cÚ¡ 
¹ıPÜtNumVideo
 = 
¹pPÜtNumVideo
+1;

72 cÚ¡ 
‰l
 = 7;

74 
š_addr
 
de¡š©iÚAdd»ss
;

75 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
de¡š©iÚAdd»ssSŒ
);

76 cÚ¡ 
PÜt
 
	`¹pPÜtAudio
(
¹pPÜtNumAudio
);

77 cÚ¡ 
PÜt
 
	`¹ıPÜtAudio
(
¹ıPÜtNumAudio
);

78 cÚ¡ 
PÜt
 
	`¹pPÜtVideo
(
¹pPÜtNumVideo
);

79 cÚ¡ 
PÜt
 
	`¹ıPÜtVideo
(
¹ıPÜtNumVideo
);

81 
Groupsock
 
	`¹pGroupsockAudio
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtAudio
, 
‰l
);

82 
Groupsock
 
	`¹ıGroupsockAudio
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜtAudio
, 
‰l
);

83 
Groupsock
 
	`¹pGroupsockVideo
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtVideo
, 
‰l
);

84 
Groupsock
 
	`¹ıGroupsockVideo
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜtVideo
, 
‰l
);

85 #ifdeà
USE_SSM


86 
¹pGroupsockAudio
.
	`muÉiÿ¡S’dOÆy
();

87 
¹ıGroupsockAudio
.
	`muÉiÿ¡S’dOÆy
();

88 
¹pGroupsockVideo
.
	`muÉiÿ¡S’dOÆy
();

89 
¹ıGroupsockVideo
.
	`muÉiÿ¡S’dOÆy
();

93 
audioSšk
 = 
MPEG1Ü2AudioRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsockAudio
);

96 cÚ¡ 
e¡im©edSessiÚBªdwidthAudio
 = 160;

97 cÚ¡ 
maxCNAMEËn
 = 100;

98 
CNAME
[
maxCNAMEËn
+1];

99 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

100 
CNAME
[
maxCNAMEËn
] = '\0';

101 #ifdeà
IMPLEMENT_RTSP_SERVER


102 
RTCPIn¡ªû
* 
audioRTCP
 =

104 
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsockAudio
,

105 
e¡im©edSessiÚBªdwidthAudio
, 
CNAME
,

106 
audioSšk
, 
NULL
 , 
isSSM
);

110 
videoSšk
 = 
MPEG1Ü2VideoRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsockVideo
);

113 cÚ¡ 
e¡im©edSessiÚBªdwidthVideo
 = 4500;

114 #ifdeà
IMPLEMENT_RTSP_SERVER


115 
RTCPIn¡ªû
* 
videoRTCP
 =

117 
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsockVideo
,

118 
e¡im©edSessiÚBªdwidthVideo
, 
CNAME
,

119 
videoSšk
, 
NULL
 , 
isSSM
);

122 #ifdeà
IMPLEMENT_RTSP_SERVER


123 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
);

127 ià(
¹¥S”v”
 =ğ
NULL
) {

128 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

129 
	`ex™
(1);

131 
S”v”MedŸSessiÚ
* 
sms


132 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

134 
isSSM
);

135 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
audioSšk
, 
audioRTCP
));

136 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
videoRTCP
));

137 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

139 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

140 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

141 
d–‘e
[] 
u¾
;

145 *
’v
 << "Beginning streaming...\n";

146 
	`¶ay
();

148 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

151 
	}
}

153 
	$aá”PÏyšg
(* 
ş›ÁD©a
) {

157 ià(
audioSourû
->
	`isCu¼’yAwa™šgD©a
()

158 || 
videoSourû
->
	`isCu¼’yAwa™šgD©a
()) ;

162 *
’v
 << "...done„eading from file\n";

164 
audioSšk
->
	`¡İPÏyšg
();

165 
videoSšk
->
	`¡İPÏyšg
();

167 
Medium
::
	`şo£
(
audioSourû
);

168 
Medium
::
	`şo£
(
videoSourû
);

169 
Medium
::
	`şo£
(
m³gDemux
);

173 
	`¶ay
();

174 
	}
}

176 
	$¶ay
() {

178 
By‹SŒ—mFeSourû
* 
feSourû


179 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

180 ià(
feSourû
 =ğ
NULL
) {

181 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


183 
	`ex™
(1);

188 
m³gDemux
 = 
MPEG1Ü2Demux
::
	`ü—‹New
(*
’v
, 
feSourû
);

189 
F¿medSourû
* 
audioES
 = 
m³gDemux
->
	`ÃwAudioSŒ—m
();

190 
F¿medSourû
* 
videoES
 = 
m³gDemux
->
	`ÃwVideoSŒ—m
();

193 
audioSourû


194 ğ
MPEG1Ü2AudioSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
audioES
);

195 
videoSourû


196 ğ
MPEG1Ü2VideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
, 
iF¿mesOÆy
);

199 *
’v
 << "Beginningo„ead from file...\n";

200 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

201 
audioSšk
->
	`¡¬tPÏyšg
(*
audioSourû
, 
aá”PÏyšg
,‡udioSink);

202 
	}
}

	@testProgs/testMPEG1or2ProgramToTransportStream.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

24 cÚ¡* 
	gšputFeName
 = "in.mpg";

25 cÚ¡* 
	gouutFeName
 = "out.ts";

27 
aá”PÏyšg
(* 
ş›ÁD©a
);

29 
U§geEnvœÚm’t
* 
	g’v
;

31 
	$maš
(
¬gc
, ** 
¬gv
) {

33 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

34 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

37 
F¿medSourû
* 
šputSourû
 = 
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

38 ià(
šputSourû
 =ğ
NULL
) {

39 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


41 
	`ex™
(1);

45 
MPEG1Ü2Demux
* 
ba£DemuÉËxÜ
 = MPEG1Ü2Demux::
	`ü—‹New
(*
’v
, 
šputSourû
);

48 
MPEG1Ü2DemuxedEËm’rySŒ—m
* 
³sSourû
 = 
ba£DemuÉËxÜ
->
	`ÃwRawPESSŒ—m
();

51 
F¿medSourû
* 
tsF¿mes


52 ğ
MPEG2T¿n¥ÜtSŒ—mFromPESSourû
::
	`ü—‹New
(*
’v
, 
³sSourû
);

55 
MedŸSšk
* 
ouutSšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName
);

56 ià(
ouutSšk
 =ğ
NULL
) {

57 *
’v
 << "UÇbËØİ’ f\"" << 
ouutFeName
 << "\"‡s‡ file sink\n";

58 
	`ex™
(1);

62 *
’v
 << "Beginningo„ead...\n";

63 
ouutSšk
->
	`¡¬tPÏyšg
(*
tsF¿mes
, 
aá”PÏyšg
, 
NULL
);

65 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

68 
	}
}

70 
	$aá”PÏyšg
(* ) {

71 *
’v
 << "Done„eading.\n";

72 *
’v
 << "WrÙouuˆfe: \"" << 
ouutFeName
 << "\"\n";

73 
	`ex™
(0);

74 
	}
}

	@testProgs/testMPEG1or2Splitter.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~<¡dlib.h
>

25 cÚ¡* 
	gšputFeName
 = "in.mpg";

26 cÚ¡* 
	gouutFeName_video
 = "out_video.mpg";

27 cÚ¡* 
	gouutFeName_audio
 = "out_audio.mpg";

29 
aá”PÏyšg
(* 
ş›ÁD©a
);

33 
	s£ssiÚS‹_t
 {

34 
MPEG1Ü2Demux
* 
	mba£DemuÉËxÜ
;

35 
MedŸSourû
* 
	mvideoSourû
;

36 
MedŸSourû
* 
	maudioSourû
;

37 
FeSšk
* 
	mvideoSšk
;

38 
FeSšk
* 
	maudioSšk
;

39 } 
	g£ssiÚS‹
;

41 
U§geEnvœÚm’t
* 
	g’v
;

43 
	$maš
(
¬gc
, ** 
¬gv
) {

45 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

46 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

49 
By‹SŒ—mFeSourû
* 
šputSourû


50 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

51 ià(
šputSourû
 =ğ
NULL
) {

52 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


54 
	`ex™
(1);

58 
£ssiÚS‹
.
ba£DemuÉËxÜ
 = 
MPEG1Ü2Demux
::
	`ü—‹New
(*
’v
, 
šputSourû
);

61 
£ssiÚS‹
.
videoSourû
 = sessiÚS‹.
ba£DemuÉËxÜ
->
	`ÃwVideoSŒ—m
();

62 
£ssiÚS‹
.
audioSourû
 = sessiÚS‹.
ba£DemuÉËxÜ
->
	`ÃwAudioSŒ—m
();

65 
£ssiÚS‹
.
videoSšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName_video
);

66 
£ssiÚS‹
.
audioSšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName_audio
);

69 *
’v
 << "Beginningo„ead...\n";

70 
£ssiÚS‹
.
videoSšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
videoSourû
,

71 
aá”PÏyšg
, 
£ssiÚS‹
.
videoSšk
);

72 
£ssiÚS‹
.
audioSšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
audioSourû
,

73 
aá”PÏyšg
, 
£ssiÚS‹
.
audioSšk
);

75 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

78 
	}
}

80 
	$aá”PÏyšg
(* 
ş›ÁD©a
) {

81 
Medium
* 
fšishedSšk
 = (Medium*)
ş›ÁD©a
;

83 ià(
fšishedSšk
 =ğ
£ssiÚS‹
.
videoSšk
) {

84 *
’v
 << "No more video\n";

85 
Medium
::
	`şo£
(
£ssiÚS‹
.
videoSšk
);

86 
Medium
::
	`şo£
(
£ssiÚS‹
.
videoSourû
);

87 
£ssiÚS‹
.
videoSšk
 = 
NULL
;

88 } ià(
fšishedSšk
 =ğ
£ssiÚS‹
.
audioSšk
) {

89 *
’v
 << "No more‡udio\n";

90 
Medium
::
	`şo£
(
£ssiÚS‹
.
audioSšk
);

91 
Medium
::
	`şo£
(
£ssiÚS‹
.
audioSourû
);

92 
£ssiÚS‹
.
audioSšk
 = 
NULL
;

95 ià(
£ssiÚS‹
.
videoSšk
 =ğ
NULL
 && sessiÚS‹.
audioSšk
 == NULL) {

96 *
’v
 << "...finished„eading\n";

98 
Medium
::
	`şo£
(
£ssiÚS‹
.
ba£DemuÉËxÜ
);

100 
	`ex™
(0);

102 
	}
}

	@testProgs/testMPEG1or2VideoReceiver.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"GroupsockH–³r.hh
"

24 
	~"BasicU§geEnvœÚm’t.hh
"

29 
aá”PÏyšg
(* 
ş›ÁD©a
);

33 
	s£ssiÚS‹_t
 {

34 
RTPSourû
* 
	msourû
;

35 
MedŸSšk
* 
	msšk
;

36 
RTCPIn¡ªû
* 
	m¹ıIn¡ªû
;

37 } 
	g£ssiÚS‹
;

39 
U§geEnvœÚm’t
* 
	g’v
;

41 
	$maš
(
¬gc
, ** 
¬gv
) {

43 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

44 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

47 
£ssiÚS‹
.
sšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, "stdout");

52 cÚ¡* 
£ssiÚAdd»ssSŒ


53 #ifdeà
USE_SSM


60 cÚ¡ 
¹pPÜtNum
 = 8888;

61 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

62 #iâdeà
USE_SSM


63 cÚ¡ 
‰l
 = 1;

66 
š_addr
 
£ssiÚAdd»ss
;

67 
£ssiÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
£ssiÚAdd»ssSŒ
);

68 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

69 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

71 #ifdeà
USE_SSM


72 * 
sourûAdd»ssSŒ
 = "aaa.bbb.ccc.ddd";

74 
š_addr
 
sourûF‹rAdd»ss
;

75 
sourûF‹rAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
sourûAdd»ssSŒ
);

77 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
sourûF‹rAdd»ss
, 
¹pPÜt
);

78 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
sourûF‹rAdd»ss
, 
¹ıPÜt
);

79 
¹ıGroupsock
.
	`chªgeDe¡š©iÚP¬am‘”s
(
sourûF‹rAdd»ss
,0,~0);

82 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
¹pPÜt
, 
‰l
);

83 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

87 
£ssiÚS‹
.
sourû
 = 
MPEG1Ü2VideoRTPSourû
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
);

90 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 160;

91 cÚ¡ 
maxCNAMEËn
 = 100;

92 
CNAME
[
maxCNAMEËn
+1];

93 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

94 
CNAME
[
maxCNAMEËn
] = '\0';

95 
£ssiÚS‹
.
¹ıIn¡ªû


96 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

97 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

98 
NULL
 , 
£ssiÚS‹
.
sourû
);

102 *
’v
 << "Beginning„eceiving multicast stream...\n";

103 
£ssiÚS‹
.
sšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
sourû
, 
aá”PÏyšg
, 
NULL
);

105 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

108 
	}
}

111 
	$aá”PÏyšg
(* ) {

112 *
’v
 << "...done„eceiving\n";

115 
Medium
::
	`şo£
(
£ssiÚS‹
.
¹ıIn¡ªû
);

116 
Medium
::
	`şo£
(
£ssiÚS‹
.
sšk
);

117 
Medium
::
	`şo£
(
£ssiÚS‹
.
sourû
);

118 
	}
}

	@testProgs/testMPEG1or2VideoStreamer.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~"GroupsockH–³r.hh
"

31 #ifdeà
USE_SSM


32 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
True
;

34 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
F®£
;

43 
BoŞ—n
 
	giF¿mesOÆy
 = 
F®£
;

45 
U§geEnvœÚm’t
* 
	g’v
;

46 cÚ¡* 
	gšputFeName
 = "test.mpg";

47 #ifdeà
SOURCE_IS_PROGRAM_STREAM


48 
MPEG1Ü2Demux
* 
	gm³gDemux
;

50 
MedŸSourû
* 
	gvideoSourû
;

51 
RTPSšk
* 
	gvideoSšk
;

53 
¶ay
();

55 
	$maš
(
¬gc
, ** 
¬gv
) {

57 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

58 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

61 cÚ¡* 
de¡š©iÚAdd»ssSŒ


62 #ifdeà
USE_SSM


71 cÚ¡ 
¹pPÜtNum
 = 8888;

72 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

73 cÚ¡ 
‰l
 = 7;

75 
š_addr
 
de¡š©iÚAdd»ss
;

76 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
de¡š©iÚAdd»ssSŒ
);

77 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

78 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

80 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

81 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

82 #ifdeà
USE_SSM


83 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

84 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

88 
videoSšk
 = 
MPEG1Ü2VideoRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
);

91 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 4500;

92 cÚ¡ 
maxCNAMEËn
 = 100;

93 
CNAME
[
maxCNAMEËn
+1];

94 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

95 
CNAME
[
maxCNAMEËn
] = '\0';

96 #ifdeà
IMPLEMENT_RTSP_SERVER


97 
RTCPIn¡ªû
* 
¹ı
 =

99 
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

100 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

101 
videoSšk
, 
NULL
 , 
isSSM
);

104 #ifdeà
IMPLEMENT_RTSP_SERVER


105 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
);

109 ià(
¹¥S”v”
 =ğ
NULL
) {

110 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

111 
	`ex™
(1);

113 
S”v”MedŸSessiÚ
* 
sms


114 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

116 
isSSM
);

117 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
¹ı
));

118 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

120 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

121 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

122 
d–‘e
[] 
u¾
;

126 *
’v
 << "Beginning streaming...\n";

127 
	`¶ay
();

129 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

132 
	}
}

134 
	$aá”PÏyšg
(* ) {

135 *
’v
 << "...done„eading from file\n";

137 
videoSšk
->
	`¡İPÏyšg
();

138 
Medium
::
	`şo£
(
videoSourû
);

139 #ifdeà
SOURCE_IS_PROGRAM_STREAM


140 
Medium
::
	`şo£
(
m³gDemux
);

144 
	`¶ay
();

145 
	}
}

147 
	$¶ay
() {

149 
By‹SŒ—mFeSourû
* 
feSourû


150 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

151 ià(
feSourû
 =ğ
NULL
) {

152 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


154 
	`ex™
(1);

157 
F¿medSourû
* 
videoES
;

158 #ifdeà
SOURCE_IS_PROGRAM_STREAM


160 
m³gDemux
 = 
MPEG1Ü2Demux
::
	`ü—‹New
(*
’v
, 
feSourû
);

161 
videoES
 = 
m³gDemux
->
	`ÃwVideoSŒ—m
();

164 
videoES
 = 
feSourû
;

168 
videoSourû


169 ğ
MPEG1Ü2VideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
, 
iF¿mesOÆy
);

172 *
’v
 << "Beginningo„ead from file...\n";

173 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

174 
	}
}

	@testProgs/testMPEG2TransportReceiver.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"GroupsockH–³r.hh
"

24 
	~"BasicU§geEnvœÚm’t.hh
"

29 
aá”PÏyšg
(* 
ş›ÁD©a
);

33 
	s£ssiÚS‹_t
 {

34 
RTPSourû
* 
	msourû
;

35 
MedŸSšk
* 
	msšk
;

36 
RTCPIn¡ªû
* 
	m¹ıIn¡ªû
;

37 } 
	g£ssiÚS‹
;

39 
U§geEnvœÚm’t
* 
	g’v
;

41 
	$maš
(
¬gc
, ** 
¬gv
) {

43 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

44 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

47 
£ssiÚS‹
.
sšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, "stdout");

52 cÚ¡* 
£ssiÚAdd»ssSŒ


53 #ifdeà
USE_SSM


60 cÚ¡ 
¹pPÜtNum
 = 1234;

61 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

62 #iâdeà
USE_SSM


63 cÚ¡ 
‰l
 = 1;

66 
š_addr
 
£ssiÚAdd»ss
;

67 
£ssiÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
£ssiÚAdd»ssSŒ
);

68 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

69 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

71 #ifdeà
USE_SSM


72 * 
sourûAdd»ssSŒ
 = "aaa.bbb.ccc.ddd";

74 
š_addr
 
sourûF‹rAdd»ss
;

75 
sourûF‹rAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
sourûAdd»ssSŒ
);

77 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
sourûF‹rAdd»ss
, 
¹pPÜt
);

78 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
sourûF‹rAdd»ss
, 
¹ıPÜt
);

79 
¹ıGroupsock
.
	`chªgeDe¡š©iÚP¬am‘”s
(
sourûF‹rAdd»ss
,0,~0);

82 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
¹pPÜt
, 
‰l
);

83 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
£ssiÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

87 
£ssiÚS‹
.
sourû
 = 
Sim¶eRTPSourû
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 33, 90000, "video/MP2T", 0, 
F®£
 );

90 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 160;

91 cÚ¡ 
maxCNAMEËn
 = 100;

92 
CNAME
[
maxCNAMEËn
+1];

93 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

94 
CNAME
[
maxCNAMEËn
] = '\0';

95 
£ssiÚS‹
.
¹ıIn¡ªû


96 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

97 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

98 
NULL
 , 
£ssiÚS‹
.
sourû
);

102 *
’v
 << "Beginning„eceiving multicast stream...\n";

103 
£ssiÚS‹
.
sšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
sourû
, 
aá”PÏyšg
, 
NULL
);

105 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

108 
	}
}

111 
	$aá”PÏyšg
(* ) {

112 *
’v
 << "...done„eceiving\n";

115 
Medium
::
	`şo£
(
£ssiÚS‹
.
¹ıIn¡ªû
);

116 
Medium
::
	`şo£
(
£ssiÚS‹
.
sšk
);

117 
Medium
::
	`şo£
(
£ssiÚS‹
.
sourû
);

118 
	}
}

	@testProgs/testMPEG2TransportStreamTrickPlay.cpp

25 
	~<liveMedŸ.hh
>

26 
	~<BasicU§geEnvœÚm’t.hh
>

28 
aá”PÏyšg
(* 
ş›ÁD©a
);

30 
U§geEnvœÚm’t
* 
	g’v
;

31 cÚ¡* 
	g´og¿mName
;

33 
	$u§ge
() {

34 *
’v
 << "u§ge: " << 
´og¿mName
 << " <input-transport-stream-file-name> <start-time> <scale> <output-transport-stream-file-name>\n";

35 *
’v
 << "\twhere\t<transport-stream-file-name>ƒnds with \".ts\"\n";

36 *
’v
 << "\t\t<start-time> ishe starting…layime in seconds (0 forhe start)\n";

37 *
’v
 << "\t\t<scale> is‡‚on-zero integer,„epresentinghe…laying speed (use 1 for‚ormal…lay; use‡‚egative‚umber for„everse…lay)\n";

38 
	`ex™
(1);

39 
	}
}

41 
	$maš
(
¬gc
, cÚ¡** 
¬gv
) {

43 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

44 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

47 
´og¿mName
 = 
¬gv
[0];

48 ià(
¬gc
 !ğ5è
	`u§ge
();

50 cÚ¡* 
šputFeName
 = 
¬gv
[1];

52 
Ën
 = 
	`¡¾’
(
šputFeName
);

53 ià(
Ën
 < 4 || 
	`¡rcmp
(&
šputFeName
[len-3], ".ts") != 0) {

54 *
’v
 << "ERROR: iÅuˆfÇm\"" << 
šputFeName


56 
	`u§ge
();

60 
¡¬tTime
;

61 ià(
	`ssÿnf
(
¬gv
[2], "%f", &
¡¬tTime
è!ğ1 || s¹Tim< 0.0fè
	`u§ge
();

63 
sÿË
;

64 ià(
	`ssÿnf
(
¬gv
[3], "%d", &
sÿË
è!ğ1 || sÿË =ğ0è
	`u§ge
();

67 
F¿medSourû
* 
šput


68 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
TRANSPORT_PACKET_SIZE
);

69 ià(
šput
 =ğ
NULL
) {

70 *
’v
 << "FaedØİ’ iÅuˆf\"" << 
šputFeName
 << "\" (does itƒxist?)\n";

71 
	`ex™
(1);

76 * 
šdexFeName
 = 
Ãw
 [
Ën
+2];

77 
	`¥rštf
(
šdexFeName
, "%sx", 
šputFeName
);

78 
MPEG2T¿n¥ÜtSŒ—mIndexFe
* 
šdexFe


79 ğ
MPEG2T¿n¥ÜtSŒ—mIndexFe
::
	`ü—‹New
(*
’v
, 
šdexFeName
);

80 ià(
šdexFe
 =ğ
NULL
) {

81 *
’v
 << "FaedØİ’ index f\"" << 
šdexFeName
 << "\" (does itƒxist?)\n";

82 
	`ex™
(1);

86 
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
* 
ŒickModeF‹r


87 ğ
MPEG2T¿n¥ÜtSŒ—mTrickModeF‹r
::
	`ü—‹New
(*
’v
, 
šput
, 
šdexFe
, 
sÿË
);

89 ià(
¡¬tTime
 > 0.0f) {

91 
tsRecÜdNumb”
, 
šdexRecÜdNumb”
;

92 
šdexFe
->
	`lookupTSPack‘NumFromNPT
(
¡¬tTime
, 
tsRecÜdNumb”
, 
šdexRecÜdNumb”
);

93 ià(!
ŒickModeF‹r
->
	`£ekTo
(
tsRecÜdNumb”
, 
šdexRecÜdNumb”
)) {

94 *
’v
 << "FaedØ£ekrick modf‹¸tØt #" << ()
tsRecÜdNumb”


95 << ", ix #" << ()
šdexRecÜdNumb”


96 << "(fÜim" << 
¡¬tTime
 << ")\n";

97 
	`ex™
(1);

102 
MPEG2T¿n¥ÜtSŒ—mFromESSourû
* 
ÃwT¿n¥ÜtSŒ—m


103 ğ
MPEG2T¿n¥ÜtSŒ—mFromESSourû
::
	`ü—‹New
(*
’v
);

104 
ÃwT¿n¥ÜtSŒ—m
->
	`addNewVideoSourû
(
ŒickModeF‹r
, 
šdexFe
->
	`m³gV”siÚ
());

107 cÚ¡* 
ouutFeName
 = 
¬gv
[4];

108 
MedŸSšk
* 
ouut
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName
);

109 ià(
ouut
 =ğ
NULL
) {

110 *
’v
 << "FaedØİ’ ouuˆf\"" << 
ouutFeName
 << "\"\n";

111 
	`ex™
(1);

115 *
’v
 << "Wr™šg ouuˆf\"" << 
ouutFeName


116 << "\" (¡¬ˆtim" << 
¡¬tTime


117 << ", sÿË " << 
sÿË


119 
ouut
->
	`¡¬tPÏyšg
(*
ÃwT¿n¥ÜtSŒ—m
, 
aá”PÏyšg
, 
NULL
);

121 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

124 
	}
}

126 
	$aá”PÏyšg
(* ) {

127 *
’v
 << "...done\n";

128 
	`ex™
(0);

129 
	}
}

	@testProgs/testMPEG2TransportStreamer.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~"GroupsockH–³r.hh
"

27 #ifdeà
USE_SSM


28 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
True
;

30 
BoŞ—n
 cÚ¡ 
	gisSSM
 = 
F®£
;

37 
	#TRANSPORT_PACKET_SIZE
 188

	)

38 
	#TRANSPORT_PACKETS_PER_NETWORK_PACKET
 7

	)

41 
U§geEnvœÚm’t
* 
	g’v
;

42 cÚ¡* 
	gšputFeName
 = "test.ts";

43 
F¿medSourû
* 
	gvideoSourû
;

44 
RTPSšk
* 
	gvideoSšk
;

46 
¶ay
();

48 
	$maš
(
¬gc
, ** 
¬gv
) {

50 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

51 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

54 cÚ¡* 
de¡š©iÚAdd»ssSŒ


55 #ifdeà
USE_SSM


64 cÚ¡ 
¹pPÜtNum
 = 1234;

65 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

66 cÚ¡ 
‰l
 = 7;

68 
š_addr
 
de¡š©iÚAdd»ss
;

69 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
de¡š©iÚAdd»ssSŒ
);

70 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

71 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

73 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

74 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

75 #ifdeà
USE_SSM


76 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

77 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

81 
videoSšk
 =

82 
Sim¶eRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 33, 90000, "video", "MP2T",

83 1, 
True
, 
F®£
 );

86 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 5000;

87 cÚ¡ 
maxCNAMEËn
 = 100;

88 
CNAME
[
maxCNAMEËn
+1];

89 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

90 
CNAME
[
maxCNAMEËn
] = '\0';

91 #ifdeà
IMPLEMENT_RTSP_SERVER


92 
RTCPIn¡ªû
* 
¹ı
 =

94 
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

95 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

96 
videoSšk
, 
NULL
 , 
isSSM
);

99 #ifdeà
IMPLEMENT_RTSP_SERVER


100 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
);

104 ià(
¹¥S”v”
 =ğ
NULL
) {

105 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

106 
	`ex™
(1);

108 
S”v”MedŸSessiÚ
* 
sms


109 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

111 
isSSM
);

112 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
¹ı
));

113 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

115 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

116 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

117 
d–‘e
[] 
u¾
;

121 *
’v
 << "Beginning streaming...\n";

122 
	`¶ay
();

124 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

127 
	}
}

129 
	$aá”PÏyšg
(* ) {

130 *
’v
 << "...done„eading from file\n";

132 
videoSšk
->
	`¡İPÏyšg
();

133 
Medium
::
	`şo£
(
videoSourû
);

136 
	`¶ay
();

137 
	}
}

139 
	$¶ay
() {

140 cÚ¡ 
šputD©aChunkSize


141 ğ
TRANSPORT_PACKETS_PER_NETWORK_PACKET
*
TRANSPORT_PACKET_SIZE
;

144 
By‹SŒ—mFeSourû
* 
feSourû


145 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
šputD©aChunkSize
);

146 ià(
feSourû
 =ğ
NULL
) {

147 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


149 
	`ex™
(1);

153 
videoSourû
 = 
MPEG2T¿n¥ÜtSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
feSourû
);

156 *
’v
 << "Beginningo„ead from file...\n";

157 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

158 
	}
}

	@testProgs/testMPEG4VideoStreamer.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~"GroupsockH–³r.hh
"

25 
U§geEnvœÚm’t
* 
	g’v
;

26 cÚ¡* 
	gšputFeName
 = "test.m4e";

27 
MPEG4VideoSŒ—mF¿m”
* 
	gvideoSourû
;

28 
RTPSšk
* 
	gvideoSšk
;

30 
¶ay
();

32 
	$maš
(
¬gc
, ** 
¬gv
) {

34 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

35 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

38 
š_addr
 
de¡š©iÚAdd»ss
;

39 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

44 cÚ¡ 
¹pPÜtNum
 = 18888;

45 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

46 cÚ¡ 
‰l
 = 255;

48 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

49 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

51 
Groupsock
 
	`¹pGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

52 
¹pGroupsock
.
	`muÉiÿ¡S’dOÆy
();

53 
Groupsock
 
	`¹ıGroupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

54 
¹ıGroupsock
.
	`muÉiÿ¡S’dOÆy
();

57 
videoSšk
 = 
MPEG4ESVideoRTPSšk
::
	`ü—‹New
(*
’v
, &
¹pGroupsock
, 96);

60 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = 500;

61 cÚ¡ 
maxCNAMEËn
 = 100;

62 
CNAME
[
maxCNAMEËn
+1];

63 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

64 
CNAME
[
maxCNAMEËn
] = '\0';

65 
RTCPIn¡ªû
* 
¹ı


66 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, &
¹ıGroupsock
,

67 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

68 
videoSšk
, 
NULL
 ,

69 
True
 );

72 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554);

73 ià(
¹¥S”v”
 =ğ
NULL
) {

74 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

75 
	`ex™
(1);

77 
S”v”MedŸSessiÚ
* 
sms


78 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

80 
True
 );

81 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
videoSšk
, 
¹ı
));

82 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

84 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

85 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

86 
d–‘e
[] 
u¾
;

89 *
’v
 << "Beginning streaming...\n";

90 
	`¶ay
();

92 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

95 
	}
}

97 
	$aá”PÏyšg
(* ) {

98 *
’v
 << "...done„eading from file\n";

100 
videoSšk
->
	`¡İPÏyšg
();

101 
Medium
::
	`şo£
(
videoSourû
);

105 
	`¶ay
();

106 
	}
}

108 
	$¶ay
() {

110 
By‹SŒ—mFeSourû
* 
feSourû


111 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, 
šputFeName
);

112 ià(
feSourû
 =ğ
NULL
) {

113 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


115 
	`ex™
(1);

118 
F¿medSourû
* 
videoES
 = 
feSourû
;

121 
videoSourû
 = 
MPEG4VideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
);

124 *
’v
 << "Beginningo„ead from file...\n";

125 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

126 
	}
}

	@testProgs/testOggStreamer.cpp

21 
	~<liveMedŸ.hh
>

22 
	~<BasicU§geEnvœÚm’t.hh
>

23 
	~<GroupsockH–³r.hh
>

25 
U§geEnvœÚm’t
* 
	g’v
;

26 cÚ¡* 
	gšputFeName
 = "test.ogg";

27 
š_addr
 
	gde¡š©iÚAdd»ss
;

28 
RTSPS”v”
* 
	g¹¥S”v”
;

29 
S”v”MedŸSessiÚ
* 
	gsms
;

30 
OggFe
* 
	goggFe
;

31 
OggDemux
* 
	goggDemux
;

32 
	gnumT¿cks
;

35 
	sT¿ckS‹
 {

36 
u_št32_t
 
	mŒackNumb”
;

37 
F¿medSourû
* 
	msourû
;

38 
RTPSšk
* 
	msšk
;

39 
RTCPIn¡ªû
* 
	m¹ı
;

41 
T¿ckS‹
* 
	gŒackS‹
;

43 
ÚOggFeC»©iÚ
(
OggFe
* 
ÃwFe
, * 
ş›ÁD©a
);

45 
	$maš
(
¬gc
, ** 
¬gv
) {

47 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

48 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

51 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

57 
¹¥S”v”
 = 
RTSPS”v”
::
	`ü—‹New
(*
’v
, 8554);

58 ià(
¹¥S”v”
 =ğ
NULL
) {

59 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

60 
	`ex™
(1);

62 
sms
 = 
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

64 
True
 );

68 
OggFe
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
ÚOggFeC»©iÚ
, 
NULL
);

70 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

73 
	}
}

75 
¶ay
();

77 
	$ÚOggFeC»©iÚ
(
OggFe
* 
ÃwFe
, * 
ş›ÁD©a
) {

78 
oggFe
 = 
ÃwFe
;

81 
oggDemux
 = 
oggFe
->
	`ÃwDemux
();

84 
¹pPÜtNum
 = 22222;

85 cÚ¡ 
‰l
 = 255;

87 cÚ¡ 
maxCNAMEËn
 = 100;

88 
CNAME
[
maxCNAMEËn
+1];

89 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

90 
CNAME
[
maxCNAMEËn
] = '\0';

92 
numT¿cks
 = 
oggFe
->
	`numT¿cks
();

93 
ŒackS‹
 = 
Ãw
 
T¿ckS‹
[
numT¿cks
];

94 
i
 = 0; i < 
numT¿cks
; ++i) {

95 
u_št32_t
 
ŒackNumb”
;

96 
F¿medSourû
* 
ba£Sourû
 = 
oggDemux
->
	`ÃwDemuxedT¿ck
(
ŒackNumb”
);

97 
ŒackS‹
[
i
].
ŒackNumb”
 =rackNumber;

99 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
;

100 
ŒackS‹
[
i
].
sourû
 = 
oggFe


101 ->
	`ü—‹SourûFÜSŒ—mšg
(
ba£Sourû
, 
ŒackNumb”
, 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
);

102 
ŒackS‹
[
i
].
sšk
 = 
NULL
;

103 
ŒackS‹
[
i
].
¹ı
 = 
NULL
;

105 ià(
ŒackS‹
[
i
].
sourû
 !ğ
NULL
) {

106 
Groupsock
* 
¹pGroupsock
 = 
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtNum
, 
‰l
);

107 
Groupsock
* 
¹ıGroupsock
 = 
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtNum
+1, 
‰l
);

108 
¹pPÜtNum
 += 2;

110 
ŒackS‹
[
i
].
sšk


111 ğ
oggFe
->
	`ü—‹RTPSškFÜT¿ckNumb”
(
ŒackNumb”
, 
¹pGroupsock
, 96+
i
);

112 ià(
ŒackS‹
[
i
].
sšk
 !ğ
NULL
) {

113 ià(
ŒackS‹
[
i
].
sšk
->
	`e¡im©edB™¿‹
() > 0) {

114 
e¡B™¿‹
 = 
ŒackS‹
[
i
].
sšk
->
	`e¡im©edB™¿‹
();

116 
ŒackS‹
[
i
].
¹ı


117 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
¹ıGroupsock
, 
e¡B™¿‹
, 
CNAME
,

118 
ŒackS‹
[
i
].
sšk
, 
NULL
 ,

119 
True
 );

123 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
ŒackS‹
[
i
].
sšk
,¿ckS‹[i].
¹ı
));

128 ià(
sms
->
	`numSub£ssiÚs
() == 0) {

129 *
’v
 << "E¼Ü: ThOgg f\"" << 
šputFeName
 << "\" has‚o streamableracks\n";

130 *
’v
 << "(Perhapshe file does‚otƒxist, is‚ot‡n 'Ogg' file, or has‚orackshat we know howo stream.)\n";

131 
	`ex™
(1);

134 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

136 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

137 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

138 
d–‘e
[] 
u¾
;

141 
	`¶ay
();

142 
	}
}

144 
	$aá”PÏyšg
(* ) {

145 *
’v
 << "...done„eading from file\n";

149 
i
;

150 
i
 = 0; i < 
numT¿cks
; ++i) {

151 ià(
ŒackS‹
[
i
].
sšk
 !ğ
NULL
èŒackS‹[i].sšk->
	`¡İPÏyšg
();

152 
Medium
::
	`şo£
(
ŒackS‹
[
i
].
sourû
);¿ckS‹[i].sourû = 
NULL
;

156 
oggDemux
 = 
oggFe
->
	`ÃwDemux
();

157 
i
 = 0; i < 
numT¿cks
; ++i) {

158 ià(
ŒackS‹
[
i
].
ŒackNumb”
 != 0) {

159 
F¿medSourû
* 
ba£Sourû


160 ğ
oggDemux
->
	`ÃwDemuxedT¿ck
(
ŒackS‹
[
i
].
ŒackNumb”
);

162 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
;

163 
ŒackS‹
[
i
].
sourû


164 ğ
oggFe
->
	`ü—‹SourûFÜSŒ—mšg
(
ba£Sourû
, 
ŒackS‹
[
i
].
ŒackNumb”
,

165 
e¡B™¿‹
, 
numF‹rsInFrÚtOfT¿ck
);

170 
	`¶ay
();

171 
	}
}

173 
	$¶ay
() {

174 *
’v
 << "Beginningo„ead from file...\n";

177 
i
 = 0; i < 
numT¿cks
; ++i) {

178 ià(
ŒackS‹
[
i
].
sšk
 !ğ
NULL
 &&¿ckS‹[i].
sourû
 != NULL) {

179 
ŒackS‹
[
i
].
sšk
->
	`¡¬tPÏyšg
(*ŒackS‹[i].
sourû
, 
aá”PÏyšg
, 
NULL
);

182 
	}
}

	@testProgs/testOnDemandRTSPServer.cpp

21 
	~"liveMedŸ.hh
"

22 
	~"BasicU§geEnvœÚm’t.hh
"

24 
U§geEnvœÚm’t
* 
	g’v
;

29 
BoŞ—n
 
	g»u£Fœ¡Sourû
 = 
True
;

34 
BoŞ—n
 
	giF¿mesOÆy
 = 
F®£
;

36 
ªnounûSŒ—m
(
RTSPS”v”
* 
¹¥S”v”
, 
S”v”MedŸSessiÚ
* 
sms
,

37 cÚ¡* 
¡»amName
, cÚ¡* 
šputFeName
);

39 
	gÃwDemuxW©chV¬ŸbË
;

41 
M©roskaFeS”v”Demux
* 
	gm©roskaDemux
;

42 
	$ÚM©roskaDemuxC»©iÚ
(
M©roskaFeS”v”Demux
* 
ÃwDemux
, * ) {

43 
m©roskaDemux
 = 
ÃwDemux
;

44 
ÃwDemuxW©chV¬ŸbË
 = 1;

45 
	}
}

47 
OggFeS”v”Demux
* 
	goggDemux
;

48 
	$ÚOggDemuxC»©iÚ
(
OggFeS”v”Demux
* 
ÃwDemux
, * ) {

49 
oggDemux
 = 
ÃwDemux
;

50 
ÃwDemuxW©chV¬ŸbË
 = 1;

51 
	}
}

53 
	$maš
(
¬gc
, ** 
¬gv
) {

55 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

56 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

58 
U£rAuth’tiÿtiÚD©aba£
* 
authDB
 = 
NULL
;

61 
authDB
 = 
Ãw
 
U£rAuth’tiÿtiÚD©aba£
;

62 
authDB
->
	`addU£rRecÜd
("fibon", "2382030");

68 
RTSPS”v”
* 
¹¥S”v”
 = RTSPS”v”::
	`ü—‹New
(*
’v
, 8554, 
authDB
);

69 ià(
¹¥S”v”
 =ğ
NULL
) {

70 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

71 
	`ex™
(1);

74 cÚ¡* 
desütiÚSŒšg


84 cÚ¡* 
¡»amName
 = "mpeg4ESVideoTest";

85 cÚ¡* 
šputFeName
 = "test.m4e";

86 
S”v”MedŸSessiÚ
* 
sms


87 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

88 
desütiÚSŒšg
);

89 
sms
->
	`addSub£ssiÚ
(
MPEG4VideoFeS”v”MedŸSub£ssiÚ


90 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

91 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

93 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

98 cÚ¡* 
¡»amName
 = "h264ESVideoTest";

99 cÚ¡* 
šputFeName
 = "test.264";

100 
S”v”MedŸSessiÚ
* 
sms


101 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

102 
desütiÚSŒšg
);

103 
sms
->
	`addSub£ssiÚ
(
H264VideoFeS”v”MedŸSub£ssiÚ


104 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

105 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

107 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

112 cÚ¡* 
¡»amName
 = "h265ESVideoTest";

113 cÚ¡* 
šputFeName
 = "test.265";

114 
S”v”MedŸSessiÚ
* 
sms


115 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

116 
desütiÚSŒšg
);

117 
sms
->
	`addSub£ssiÚ
(
H265VideoFeS”v”MedŸSub£ssiÚ


118 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

119 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

121 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

126 cÚ¡* 
¡»amName
 = "mpeg1or2AudioVideoTest";

127 cÚ¡* 
šputFeName
 = "test.mpg";

129 
S”v”MedŸSessiÚ
* 
sms


130 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

131 
desütiÚSŒšg
);

132 
MPEG1Ü2FeS”v”Demux
* 
demux


133 ğ
MPEG1Ü2FeS”v”Demux
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
);

134 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwVideoS”v”MedŸSub£ssiÚ
(
iF¿mesOÆy
));

135 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwAudioS”v”MedŸSub£ssiÚ
());

136 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

138 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

143 cÚ¡* 
¡»amName
 = "mpeg1or2ESVideoTest";

144 cÚ¡* 
šputFeName
 = "testv.mpg";

146 
S”v”MedŸSessiÚ
* 
sms


147 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

148 
desütiÚSŒšg
);

149 
sms
->
	`addSub£ssiÚ
(
MPEG1Ü2VideoFeS”v”MedŸSub£ssiÚ


150 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
, 
iF¿mesOÆy
));

151 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

153 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

164 cÚ¡* 
¡»amName
 = "mp3AudioTest";

165 cÚ¡* 
šputFeName
 = "test.mp3";

166 
S”v”MedŸSessiÚ
* 
sms


167 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

168 
desütiÚSŒšg
);

169 
BoŞ—n
 
u£ADUs
 = 
F®£
;

170 
IÁ”Ëavšg
* 
š‹¾—všg
 = 
NULL
;

171 #ifdeà
STREAM_USING_ADUS


172 
u£ADUs
 = 
True
;

173 #ifdeà
INTERLEAVE_ADUS


174 
š‹¾—veCyşe
[] = {0,2,1,3};

175 cÚ¡ 
š‹¾—veCyşeSize


176 ğ( 
š‹¾—veCyşe
)/( ());

177 
š‹¾—všg
 = 
Ãw
 
	`IÁ”Ëavšg
(
š‹¾—veCyşeSize
, 
š‹¾—veCyşe
);

180 
sms
->
	`addSub£ssiÚ
(
MP3AudioFeS”v”MedŸSub£ssiÚ


181 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
,

182 
u£ADUs
, 
š‹¾—všg
));

183 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

185 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

190 cÚ¡* 
¡»amName
 = "wavAudioTest";

191 cÚ¡* 
šputFeName
 = "test.wav";

192 
S”v”MedŸSessiÚ
* 
sms


193 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

194 
desütiÚSŒšg
);

197 
BoŞ—n
 
cÚv”tToULaw
 = 
F®£
;

198 
sms
->
	`addSub£ssiÚ
(
WAVAudioFeS”v”MedŸSub£ssiÚ


199 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
, 
cÚv”tToULaw
));

200 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

202 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

207 cÚ¡* 
¡»amName
 = "amrAudioTest";

208 cÚ¡* 
šputFeName
 = "test.amr";

209 
S”v”MedŸSessiÚ
* 
sms


210 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

211 
desütiÚSŒšg
);

212 
sms
->
	`addSub£ssiÚ
(
AMRAudioFeS”v”MedŸSub£ssiÚ


213 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

214 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

216 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

221 cÚ¡* 
¡»amName
 = "vobTest";

222 cÚ¡* 
šputFeName
 = "test.vob";

223 
S”v”MedŸSessiÚ
* 
sms


224 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

225 
desütiÚSŒšg
);

227 
MPEG1Ü2FeS”v”Demux
* 
demux


228 ğ
MPEG1Ü2FeS”v”Demux
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
);

229 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwVideoS”v”MedŸSub£ssiÚ
(
iF¿mesOÆy
));

230 
sms
->
	`addSub£ssiÚ
(
demux
->
	`ÃwAC3AudioS”v”MedŸSub£ssiÚ
());

231 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

233 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

238 cÚ¡* 
¡»amName
 = "play";

239 cÚ¡* 
šputFeName
 = "test.ts";

240 cÚ¡* 
šdexFeName
 = "test.tsx";

241 
S”v”MedŸSessiÚ
* 
sms


242 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

243 
desütiÚSŒšg
);

244 
sms
->
	`addSub£ssiÚ
(
MPEG2T¿n¥ÜtFeS”v”MedŸSub£ssiÚ


245 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
šdexFeName
, 
»u£Fœ¡Sourû
));

246 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

248 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

253 cÚ¡* 
¡»amName
 = "aacAudioTest";

254 cÚ¡* 
šputFeName
 = "test.aac";

255 
S”v”MedŸSessiÚ
* 
sms


256 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

257 
desütiÚSŒšg
);

258 
sms
->
	`addSub£ssiÚ
(
ADTSAudioFeS”v”MedŸSub£ssiÚ


259 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

260 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

262 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

268 
OutPack‘Bufãr
::
maxSize
 = 300000;

270 cÚ¡* 
¡»amName
 = "dvVideoTest";

271 cÚ¡* 
šputFeName
 = "test.dv";

272 
S”v”MedŸSessiÚ
* 
sms


273 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

274 
desütiÚSŒšg
);

275 
sms
->
	`addSub£ssiÚ
(
DVVideoFeS”v”MedŸSub£ssiÚ


276 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

277 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

279 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

284 cÚ¡* 
¡»amName
 = "ac3AudioTest";

285 cÚ¡* 
šputFeName
 = "test.ac3";

286 
S”v”MedŸSessiÚ
* 
sms


287 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

288 
desütiÚSŒšg
);

290 
sms
->
	`addSub£ssiÚ
(
AC3AudioFeS”v”MedŸSub£ssiÚ


291 ::
	`ü—‹New
(*
’v
, 
šputFeName
, 
»u£Fœ¡Sourû
));

293 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

295 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

300 cÚ¡* 
¡»amName
 = "matroskaFileTest";

301 cÚ¡* 
šputFeName
 = "test.mkv";

302 
S”v”MedŸSessiÚ
* 
sms


303 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

304 
desütiÚSŒšg
);

306 
ÃwDemuxW©chV¬ŸbË
 = 0;

307 
M©roskaFeS”v”Demux
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
ÚM©roskaDemuxC»©iÚ
, 
NULL
);

308 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
(&
ÃwDemuxW©chV¬ŸbË
);

310 
BoŞ—n
 
£ssiÚHasT¿cks
 = 
F®£
;

311 
S”v”MedŸSub£ssiÚ
* 
smss
;

312 (
smss
 = 
m©roskaDemux
->
	`ÃwS”v”MedŸSub£ssiÚ
()è!ğ
NULL
) {

313 
sms
->
	`addSub£ssiÚ
(
smss
);

314 
£ssiÚHasT¿cks
 = 
True
;

316 ià(
£ssiÚHasT¿cks
) {

317 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

321 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

327 cÚ¡* 
¡»amName
 = "webmFileTest";

328 cÚ¡* 
šputFeName
 = "test.webm";

329 
S”v”MedŸSessiÚ
* 
sms


330 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

331 
desütiÚSŒšg
);

333 
ÃwDemuxW©chV¬ŸbË
 = 0;

334 
M©roskaFeS”v”Demux
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
ÚM©roskaDemuxC»©iÚ
, 
NULL
);

335 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
(&
ÃwDemuxW©chV¬ŸbË
);

337 
BoŞ—n
 
£ssiÚHasT¿cks
 = 
F®£
;

338 
S”v”MedŸSub£ssiÚ
* 
smss
;

339 (
smss
 = 
m©roskaDemux
->
	`ÃwS”v”MedŸSub£ssiÚ
()è!ğ
NULL
) {

340 
sms
->
	`addSub£ssiÚ
(
smss
);

341 
£ssiÚHasT¿cks
 = 
True
;

343 ià(
£ssiÚHasT¿cks
) {

344 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

348 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

353 cÚ¡* 
¡»amName
 = "oggFileTest";

354 cÚ¡* 
šputFeName
 = "test.ogg";

355 
S”v”MedŸSessiÚ
* 
sms


356 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

357 
desütiÚSŒšg
);

359 
ÃwDemuxW©chV¬ŸbË
 = 0;

360 
OggFeS”v”Demux
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
ÚOggDemuxC»©iÚ
, 
NULL
);

361 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
(&
ÃwDemuxW©chV¬ŸbË
);

363 
BoŞ—n
 
£ssiÚHasT¿cks
 = 
F®£
;

364 
S”v”MedŸSub£ssiÚ
* 
smss
;

365 (
smss
 = 
oggDemux
->
	`ÃwS”v”MedŸSub£ssiÚ
()è!ğ
NULL
) {

366 
sms
->
	`addSub£ssiÚ
(
smss
);

367 
£ssiÚHasT¿cks
 = 
True
;

369 ià(
£ssiÚHasT¿cks
) {

370 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

374 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

380 cÚ¡* 
¡»amName
 = "opusFileTest";

381 cÚ¡* 
šputFeName
 = "test.opus";

382 
S”v”MedŸSessiÚ
* 
sms


383 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

384 
desütiÚSŒšg
);

386 
ÃwDemuxW©chV¬ŸbË
 = 0;

387 
OggFeS”v”Demux
::
	`ü—‹New
(*
’v
, 
šputFeName
, 
ÚOggDemuxC»©iÚ
, 
NULL
);

388 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
(&
ÃwDemuxW©chV¬ŸbË
);

390 
BoŞ—n
 
£ssiÚHasT¿cks
 = 
F®£
;

391 
S”v”MedŸSub£ssiÚ
* 
smss
;

392 (
smss
 = 
oggDemux
->
	`ÃwS”v”MedŸSub£ssiÚ
()è!ğ
NULL
) {

393 
sms
->
	`addSub£ssiÚ
(
smss
);

394 
£ssiÚHasT¿cks
 = 
True
;

396 ià(
£ssiÚHasT¿cks
) {

397 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

401 
	`ªnounûSŒ—m
(
¹¥S”v”
, 
sms
, 
¡»amName
, 
šputFeName
);

406 cÚ¡* 
¡»amName
 = "lplay";

407 cÚ¡* 
šputAdd»ssSŒ
 = "127.0.0.1";

410 
pÜtNumB™s
 cÚ¡ 
šputPÜtNum
 = 1234;

412 
BoŞ—n
 cÚ¡ 
šputSŒ—mIsRawUDP
 = 
True
;

413 
S”v”MedŸSessiÚ
* 
sms


414 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, 
¡»amName
, streamName,

415 
desütiÚSŒšg
);

416 
sms
->
	`addSub£ssiÚ
(
MPEG2T¿n¥ÜtUDPS”v”MedŸSub£ssiÚ


417 ::
	`ü—‹New
(*
’v
, 
šputAdd»ssSŒ
, 
šputPÜtNum
, 
šputSŒ—mIsRawUDP
));

418 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

420 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

421 *
’v
 << "\n\"" << 
¡»amName
 << "\" stream, from‡ UDP Transport Stream input source \n\t(";

422 ià(
šputAdd»ssSŒ
 !ğ
NULL
) {

423 *
’v
 << "IP muÉiÿ¡‡dd»s " << 
šputAdd»ssSŒ
 << ",";

425 *
’v
 << "unicast;";

427 *
’v
 << "…Üˆ" << 
šputPÜtNum
 << ")\n";

428 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

429 
d–‘e
[] 
u¾
;

436 ià(
¹¥S”v”
->
	`£tUpTuÂ–šgOv”HTTP
(80) ||„tspServer->setUpTunnelingOverHTTP(8000) ||„tspServer->setUpTunnelingOverHTTP(8080)) {

437 *
’v
 << "\n(Wu£…Üˆ" << 
¹¥S”v”
->
	`h‰pS”v”PÜtNum
() << " for optional RTSP-over-HTTPunneling.)\n";

439 *
’v
 << "\n(RTSP-over-HTTPunneling is‚ot‡vailable.)\n";

442 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

445 
	}
}

447 
	$ªnounûSŒ—m
(
RTSPS”v”
* 
¹¥S”v”
, 
S”v”MedŸSessiÚ
* 
sms
,

448 cÚ¡* 
¡»amName
, cÚ¡* 
šputFeName
) {

449 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

450 
U§geEnvœÚm’t
& 
’v
 = 
¹¥S”v”
->
	`’vœ
();

451 
’v
 << "\n\"" << 
¡»amName
 << "\" stream, fromhe file \""

452 << 
šputFeName
 << "\"\n";

453 
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

454 
d–‘e
[] 
u¾
;

455 
	}
}

	@testProgs/testRTSPClient.cpp

23 
	~"liveMedŸ.hh
"

24 
	~"BasicU§geEnvœÚm’t.hh
"

29 
cÚtšueAá”DESCRIBE
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

30 
cÚtšueAá”SETUP
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

31 
cÚtšueAá”PLAY
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
);

34 
sub£ssiÚAá”PÏyšg
(* 
ş›ÁD©a
);

35 
sub£ssiÚByeHªdËr
(* 
ş›ÁD©a
);

36 
¡»amTim”HªdËr
(* 
ş›ÁD©a
);

40 
İ’URL
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
´ogName
, cÚ¡* 
¹¥URL
);

43 
£tupNextSub£ssiÚ
(
RTSPCl›Á
* 
¹¥Cl›Á
);

46 
shutdownSŒ—m
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
ex™Code
 = 1);

49 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, cÚ¡ 
	gRTSPCl›Á
& 
	g¹¥Cl›Á
) {

50  
	g’v
 << "[URL:\"" << 
	g¹¥Cl›Á
.
u¾
() << "\"]: ";

54 
	gU§geEnvœÚm’t
& 
	gİ”©Ü
<<(U§geEnvœÚm’t& 
	g’v
, cÚ¡ 
	gMedŸSub£ssiÚ
& 
	gsub£ssiÚ
) {

55  
	g’v
 << 
	gsub£ssiÚ
.
mediumName
(è<< "/" << sub£ssiÚ.
codecName
();

58 
	$u§ge
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
´ogName
) {

59 
’v
 << "U§ge: " << 
´ogName
 << " <rtsp-url-1> ... <rtsp-url-N>\n";

60 
’v
 << "\t(whereƒach <rtsp-url-i> is‡ \"rtsp://\" URL)\n";

61 
	}
}

63 
	gev’tLoİW©chV¬ŸbË
 = 0;

65 
	$maš
(
¬gc
, ** 
¬gv
) {

67 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

68 
U§geEnvœÚm’t
* 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

71 ià(
¬gc
 < 2) {

72 
	`u§ge
(*
’v
, 
¬gv
[0]);

77 
i
 = 1; i <ğ
¬gc
-1; ++i) {

78 
	`İ’URL
(*
’v
, 
¬gv
[0],‡rgv[
i
]);

82 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
(&
ev’tLoİW©chV¬ŸbË
);

94 
	}
}

98 şas 
	cSŒ—mCl›ÁS‹
 {

99 
	mpublic
:

100 
SŒ—mCl›ÁS‹
();

101 
	mvœtu®
 ~
SŒ—mCl›ÁS‹
();

103 
	mpublic
:

104 
MedŸSub£ssiÚI‹¿tÜ
* 
™”
;

105 
MedŸSessiÚ
* 
	m£ssiÚ
;

106 
MedŸSub£ssiÚ
* 
	msub£ssiÚ
;

107 
TaskTok’
 
	m¡»amTim”Task
;

108 
	mdu¿tiÚ
;

116 şas 
	courRTSPCl›Á
: 
public
 
RTSPCl›Á
 {

117 
public
:

118 
ourRTSPCl›Á
* 
ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
¹¥URL
,

119 
v”bos™yLev–
 = 0,

120 cÚ¡* 
­¶iÿtiÚName
 = 
NULL
,

121 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
 = 0);

123 
	m´Ùeùed
:

124 
ourRTSPCl›Á
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
¹¥URL
,

125 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
, 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
);

127 
	mvœtu®
 ~
ourRTSPCl›Á
();

129 
	mpublic
:

130 
SŒ—mCl›ÁS‹
 
scs
;

138 şas 
	cDummySšk
: 
public
 
MedŸSšk
 {

139 
public
:

140 
DummySšk
* 
ü—‹New
(
U§geEnvœÚm’t
& 
’v
,

141 
MedŸSub£ssiÚ
& 
sub£ssiÚ
,

142 cÚ¡* 
¡»amId
 = 
NULL
);

144 
	m´iv©e
:

145 
DummySšk
(
U§geEnvœÚm’t
& 
’v
, 
MedŸSub£ssiÚ
& 
sub£ssiÚ
, cÚ¡* 
¡»amId
);

147 
	mvœtu®
 ~
DummySšk
();

149 
aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
,

150 
numTrunÿ‹dBy‹s
,

151 
timev®
 
´e£Á©iÚTime
,

152 
du¿tiÚInMiüo£cÚds
);

153 
aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
,

154 
timev®
 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

156 
	m´iv©e
:

158 
vœtu®
 
BoŞ—n
 
cÚtšuePÏyšg
();

160 
	m´iv©e
:

161 
u_št8_t
* 
fReûiveBufãr
;

162 
	mMedŸSub£ssiÚ
& 
	mfSub£ssiÚ
;

163 * 
	mfSŒ—mId
;

166 
	#RTSP_CLIENT_VERBOSITY_LEVEL
 1

167 

	)

168 
	g¹¥Cl›ÁCouÁ
 = 0;

170 
	$İ’URL
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
´ogName
, cÚ¡* 
¹¥URL
) {

173 
RTSPCl›Á
* 
¹¥Cl›Á
 = 
ourRTSPCl›Á
::
	`ü—‹New
(
’v
, 
¹¥URL
, 
RTSP_CLIENT_VERBOSITY_LEVEL
, 
´ogName
);

174 ià(
¹¥Cl›Á
 =ğ
NULL
) {

175 
’v
 << "FaedØü—‹‡ RTSP cl›Á fÜ URL \"" << 
¹¥URL
 << "\": " <<ƒnv.
	`g‘ResuÉMsg
() << "\n";

179 ++
¹¥Cl›ÁCouÁ
;

184 
¹¥Cl›Á
->
	`£ndDesüibeCommªd
(
cÚtšueAá”DESCRIBE
);

185 
	}
}

190 
	$cÚtšueAá”DESCRIBE
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

192 
U§geEnvœÚm’t
& 
’v
 = 
¹¥Cl›Á
->
	`’vœ
();

193 
SŒ—mCl›ÁS‹
& 
scs
 = ((
ourRTSPCl›Á
*)
¹¥Cl›Á
)->scs;

195 ià(
»suÉCode
 != 0) {

196 
’v
 << *
¹¥Cl›Á
 << "FaedØg‘‡ SDP desütiÚ: " << 
»suÉSŒšg
 << "\n";

197 
d–‘e
[] 
»suÉSŒšg
;

201 * cÚ¡ 
sdpDesütiÚ
 = 
»suÉSŒšg
;

202 
’v
 << *
¹¥Cl›Á
 << "GÙ‡ SDP desütiÚ:\n" << 
sdpDesütiÚ
 << "\n";

205 
scs
.
£ssiÚ
 = 
MedŸSessiÚ
::
	`ü—‹New
(
’v
, 
sdpDesütiÚ
);

206 
d–‘e
[] 
sdpDesütiÚ
;

207 ià(
scs
.
£ssiÚ
 =ğ
NULL
) {

208 
’v
 << *
¹¥Cl›Á
 << "FaedØü—‹‡ MedŸSessiÚ objeù fromhSDP desütiÚ: " <<ƒnv.
	`g‘ResuÉMsg
() << "\n";

210 } ià(!
scs
.
£ssiÚ
->
	`hasSub£ssiÚs
()) {

211 
’v
 << *
¹¥Cl›Á
 << "This session has‚o media subsessions (i.e.,‚o \"m=\"†ines)\n";

218 
scs
.
™”
 = 
Ãw
 
	`MedŸSub£ssiÚI‹¿tÜ
(*scs.
£ssiÚ
);

219 
	`£tupNextSub£ssiÚ
(
¹¥Cl›Á
);

224 
	`shutdownSŒ—m
(
¹¥Cl›Á
);

225 
	}
}

229 
	#REQUEST_STREAMING_OVER_TCP
 
F®£


	)

231 
	$£tupNextSub£ssiÚ
(
RTSPCl›Á
* 
¹¥Cl›Á
) {

232 
U§geEnvœÚm’t
& 
’v
 = 
¹¥Cl›Á
->
	`’vœ
();

233 
SŒ—mCl›ÁS‹
& 
scs
 = ((
ourRTSPCl›Á
*)
¹¥Cl›Á
)->scs;

235 
scs
.
sub£ssiÚ
 = scs.
™”
->
	`Ãxt
();

236 ià(
scs
.
sub£ssiÚ
 !ğ
NULL
) {

237 ià(!
scs
.
sub£ssiÚ
->
	`š™Ÿ‹
()) {

238 
’v
 << *
¹¥Cl›Á
 << "FaedØš™Ÿ‹h\"" << *
scs
.
sub£ssiÚ
 << "\" sub£ssiÚ: " <<ƒnv.
	`g‘ResuÉMsg
() << "\n";

239 
	`£tupNextSub£ssiÚ
(
¹¥Cl›Á
);

241 
’v
 << *
¹¥Cl›Á
 << "In™Ÿ‹dh\"" << *
scs
.
sub£ssiÚ
 << "\" subsession (";

242 ià(
scs
.
sub£ssiÚ
->
	`¹ıIsMuxed
()) {

243 
’v
 << "ş›Á…Üˆ" << 
scs
.
sub£ssiÚ
->
	`ş›ÁPÜtNum
();

245 
’v
 << "ş›Á…Üt " << 
scs
.
sub£ssiÚ
->
	`ş›ÁPÜtNum
() << "-" << scs.subsession->clientPortNum()+1;

247 
’v
 << ")\n";

250 
¹¥Cl›Á
->
	`£ndS‘upCommªd
(*
scs
.
sub£ssiÚ
, 
cÚtšueAá”SETUP
, 
F®£
, 
REQUEST_STREAMING_OVER_TCP
);

256 ià(
scs
.
£ssiÚ
->
	`absS¹Time
(è!ğ
NULL
) {

258 
¹¥Cl›Á
->
	`£ndPÏyCommªd
(*
scs
.
£ssiÚ
, 
cÚtšueAá”PLAY
, scs.£ssiÚ->
	`absS¹Time
(), scs.£ssiÚ->
	`absEndTime
());

260 
scs
.
du¿tiÚ
 = scs.
£ssiÚ
->
	`¶ayEndTime
(è- scs.£ssiÚ->
	`¶ayS¹Time
();

261 
¹¥Cl›Á
->
	`£ndPÏyCommªd
(*
scs
.
£ssiÚ
, 
cÚtšueAá”PLAY
);

263 
	}
}

265 
	$cÚtšueAá”SETUP
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

267 
U§geEnvœÚm’t
& 
’v
 = 
¹¥Cl›Á
->
	`’vœ
();

268 
SŒ—mCl›ÁS‹
& 
scs
 = ((
ourRTSPCl›Á
*)
¹¥Cl›Á
)->scs;

270 ià(
»suÉCode
 != 0) {

271 
’v
 << *
¹¥Cl›Á
 << "FaedØ£ˆu°th\"" << *
scs
.
sub£ssiÚ
 << "\" sub£ssiÚ: " << 
»suÉSŒšg
 << "\n";

275 
’v
 << *
¹¥Cl›Á
 << "S‘ u°th\"" << *
scs
.
sub£ssiÚ
 << "\" subsession (";

276 ià(
scs
.
sub£ssiÚ
->
	`¹ıIsMuxed
()) {

277 
’v
 << "ş›Á…Üˆ" << 
scs
.
sub£ssiÚ
->
	`ş›ÁPÜtNum
();

279 
’v
 << "ş›Á…Üt " << 
scs
.
sub£ssiÚ
->
	`ş›ÁPÜtNum
() << "-" << scs.subsession->clientPortNum()+1;

281 
’v
 << ")\n";

287 
scs
.
sub£ssiÚ
->
sšk
 = 
DummySšk
::
	`ü—‹New
(
’v
, *scs.sub£ssiÚ, 
¹¥Cl›Á
->
	`u¾
());

289 ià(
scs
.
sub£ssiÚ
->
sšk
 =ğ
NULL
) {

290 
’v
 << *
¹¥Cl›Á
 << "FaedØü—‹‡ d©¨sšk fÜh\"" << *
scs
.
sub£ssiÚ


291 << "\" sub£ssiÚ: " << 
’v
.
	`g‘ResuÉMsg
() << "\n";

295 
’v
 << *
¹¥Cl›Á
 << "C»©ed‡ d©¨sšk fÜh\"" << *
scs
.
sub£ssiÚ
 << "\" subsession\n";

296 
scs
.
sub£ssiÚ
->
miscPŒ
 = 
¹¥Cl›Á
;

297 
scs
.
sub£ssiÚ
->
sšk
->
	`¡¬tPÏyšg
(*(scs.sub£ssiÚ->
	`»adSourû
()),

298 
sub£ssiÚAá”PÏyšg
, 
scs
.
sub£ssiÚ
);

300 ià(
scs
.
sub£ssiÚ
->
	`¹ıIn¡ªû
(è!ğ
NULL
) {

301 
scs
.
sub£ssiÚ
->
	`¹ıIn¡ªû
()->
	`£tByeHªdËr
(
sub£ssiÚByeHªdËr
, scs.subsession);

304 
d–‘e
[] 
»suÉSŒšg
;

307 
	`£tupNextSub£ssiÚ
(
¹¥Cl›Á
);

308 
	}
}

310 
	$cÚtšueAá”PLAY
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
»suÉCode
, * 
»suÉSŒšg
) {

311 
BoŞ—n
 
sucûss
 = 
F®£
;

314 
U§geEnvœÚm’t
& 
’v
 = 
¹¥Cl›Á
->
	`’vœ
();

315 
SŒ—mCl›ÁS‹
& 
scs
 = ((
ourRTSPCl›Á
*)
¹¥Cl›Á
)->scs;

317 ià(
»suÉCode
 != 0) {

318 
’v
 << *
¹¥Cl›Á
 << "FaedØ¡¬ˆ¶ayšg sessiÚ: " << 
»suÉSŒšg
 << "\n";

326 ià(
scs
.
du¿tiÚ
 > 0) {

327 cÚ¡ 
d–aySlİ
 = 2;

328 
scs
.
du¿tiÚ
 +ğ
d–aySlİ
;

329 
uSecsToD–ay
 = ()(
scs
.
du¿tiÚ
*1000000);

330 
scs
.
¡»amTim”Task
 = 
’v
.
	`skScheduËr
().
	`scheduËD–ayedTask
(
uSecsToD–ay
, (
TaskFunc
*)
¡»amTim”HªdËr
, 
¹¥Cl›Á
);

333 
’v
 << *
¹¥Cl›Á
 << "Started…laying session";

334 ià(
scs
.
du¿tiÚ
 > 0) {

335 
’v
 << " (fÜ u°tØ" << 
scs
.
du¿tiÚ
 << " seconds)";

337 
’v
 << "...\n";

339 
sucûss
 = 
True
;

341 
d–‘e
[] 
»suÉSŒšg
;

343 ià(!
sucûss
) {

345 
	`shutdownSŒ—m
(
¹¥Cl›Á
);

347 
	}
}

352 
	$sub£ssiÚAá”PÏyšg
(* 
ş›ÁD©a
) {

353 
MedŸSub£ssiÚ
* 
sub£ssiÚ
 = (MedŸSub£ssiÚ*)
ş›ÁD©a
;

354 
RTSPCl›Á
* 
¹¥Cl›Á
 = (RTSPCl›Á*)(
sub£ssiÚ
->
miscPŒ
);

357 
Medium
::
	`şo£
(
sub£ssiÚ
->
sšk
);

358 
sub£ssiÚ
->
sšk
 = 
NULL
;

361 
MedŸSessiÚ
& 
£ssiÚ
 = 
sub£ssiÚ
->
	`·»ÁSessiÚ
();

362 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(
£ssiÚ
);

363 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

364 ià(
sub£ssiÚ
->
sšk
 !ğ
NULL
) ;

368 
	`shutdownSŒ—m
(
¹¥Cl›Á
);

369 
	}
}

371 
	$sub£ssiÚByeHªdËr
(* 
ş›ÁD©a
) {

372 
MedŸSub£ssiÚ
* 
sub£ssiÚ
 = (MedŸSub£ssiÚ*)
ş›ÁD©a
;

373 
RTSPCl›Á
* 
¹¥Cl›Á
 = (RTSPCl›Á*)
sub£ssiÚ
->
miscPŒ
;

374 
U§geEnvœÚm’t
& 
’v
 = 
¹¥Cl›Á
->
	`’vœ
();

376 
’v
 << *
¹¥Cl›Á
 << "Reûived RTCP \"BYE\" oÀ\"" << *
sub£ssiÚ
 << "\" subsession\n";

379 
	`sub£ssiÚAá”PÏyšg
(
sub£ssiÚ
);

380 
	}
}

382 
	$¡»amTim”HªdËr
(* 
ş›ÁD©a
) {

383 
ourRTSPCl›Á
* 
¹¥Cl›Á
 = (ourRTSPCl›Á*)
ş›ÁD©a
;

384 
SŒ—mCl›ÁS‹
& 
scs
 = 
¹¥Cl›Á
->scs;

386 
scs
.
¡»amTim”Task
 = 
NULL
;

389 
	`shutdownSŒ—m
(
¹¥Cl›Á
);

390 
	}
}

392 
	$shutdownSŒ—m
(
RTSPCl›Á
* 
¹¥Cl›Á
, 
ex™Code
) {

393 
U§geEnvœÚm’t
& 
’v
 = 
¹¥Cl›Á
->
	`’vœ
();

394 
SŒ—mCl›ÁS‹
& 
scs
 = ((
ourRTSPCl›Á
*)
¹¥Cl›Á
)->scs;

397 ià(
scs
.
£ssiÚ
 !ğ
NULL
) {

398 
BoŞ—n
 
someSub£ssiÚsW”eAùive
 = 
F®£
;

399 
MedŸSub£ssiÚI‹¿tÜ
 
	`™”
(*
scs
.
£ssiÚ
);

400 
MedŸSub£ssiÚ
* 
sub£ssiÚ
;

402 (
sub£ssiÚ
 = 
™”
.
	`Ãxt
()è!ğ
NULL
) {

403 ià(
sub£ssiÚ
->
sšk
 !ğ
NULL
) {

404 
Medium
::
	`şo£
(
sub£ssiÚ
->
sšk
);

405 
sub£ssiÚ
->
sšk
 = 
NULL
;

407 ià(
sub£ssiÚ
->
	`¹ıIn¡ªû
(è!ğ
NULL
) {

408 
sub£ssiÚ
->
	`¹ıIn¡ªû
()->
	`£tByeHªdËr
(
NULL
, NULL);

411 
someSub£ssiÚsW”eAùive
 = 
True
;

415 ià(
someSub£ssiÚsW”eAùive
) {

418 
¹¥Cl›Á
->
	`£ndT—rdownCommªd
(*
scs
.
£ssiÚ
, 
NULL
);

422 
’v
 << *
¹¥Cl›Á
 << "Closinghe stream.\n";

423 
Medium
::
	`şo£
(
¹¥Cl›Á
);

426 ià(--
¹¥Cl›ÁCouÁ
 == 0) {

430 
	`ex™
(
ex™Code
);

432 
	}
}

437 
ourRTSPCl›Á
* 
	gourRTSPCl›Á
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
¹¥URL
,

438 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
, 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
) {

439  
Ãw
 
	`ourRTSPCl›Á
(
’v
, 
¹¥URL
, 
v”bos™yLev–
, 
­¶iÿtiÚName
, 
tuÂ–Ov”HTTPPÜtNum
);

440 
	}
}

442 
	gourRTSPCl›Á
::
	$ourRTSPCl›Á
(
U§geEnvœÚm’t
& 
’v
, cÚ¡* 
¹¥URL
,

443 
v”bos™yLev–
, cÚ¡* 
­¶iÿtiÚName
, 
pÜtNumB™s
 
tuÂ–Ov”HTTPPÜtNum
)

444 : 
	`RTSPCl›Á
(
’v
,
¹¥URL
, 
v”bos™yLev–
, 
­¶iÿtiÚName
, 
tuÂ–Ov”HTTPPÜtNum
, -1) {

445 
	}
}

447 
	gourRTSPCl›Á
::~
	$ourRTSPCl›Á
() {

448 
	}
}

453 
SŒ—mCl›ÁS‹
::
	$SŒ—mCl›ÁS‹
()

454 : 
	`™”
(
NULL
), 
	`£ssiÚ
(NULL), 
	`sub£ssiÚ
(NULL), 
	`¡»amTim”Task
(NULL), 
	$du¿tiÚ
(0.0) {

455 
	}
}

457 
	gSŒ—mCl›ÁS‹
::~
	$SŒ—mCl›ÁS‹
() {

458 
d–‘e
 
™”
;

459 ià(
£ssiÚ
 !ğ
NULL
) {

461 
U§geEnvœÚm’t
& 
’v
 = 
£ssiÚ
->
	`’vœ
();

463 
’v
.
	`skScheduËr
().
	`unscheduËD–ayedTask
(
¡»amTim”Task
);

464 
Medium
::
	`şo£
(
£ssiÚ
);

466 
	}
}

473 
	#DUMMY_SINK_RECEIVE_BUFFER_SIZE
 100000

	)

475 
DummySšk
* 
	gDummySšk
::
	$ü—‹New
(
U§geEnvœÚm’t
& 
’v
, 
MedŸSub£ssiÚ
& 
sub£ssiÚ
, cÚ¡* 
¡»amId
) {

476  
Ãw
 
	`DummySšk
(
’v
, 
sub£ssiÚ
, 
¡»amId
);

477 
	}
}

479 
	gDummySšk
::
	$DummySšk
(
U§geEnvœÚm’t
& 
’v
, 
MedŸSub£ssiÚ
& 
sub£ssiÚ
, cÚ¡* 
¡»amId
)

480 : 
	`MedŸSšk
(
’v
),

481 
	$fSub£ssiÚ
(
sub£ssiÚ
) {

482 
fSŒ—mId
 = 
	`¡rDup
(
¡»amId
);

483 
fReûiveBufãr
 = 
Ãw
 
u_št8_t
[
DUMMY_SINK_RECEIVE_BUFFER_SIZE
];

484 
	}
}

486 
	gDummySšk
::~
	$DummySšk
() {

487 
d–‘e
[] 
fReûiveBufãr
;

488 
d–‘e
[] 
fSŒ—mId
;

489 
	}
}

491 
	gDummySšk
::
	$aá”G‘tšgF¿me
(* 
ş›ÁD©a
, 
äameSize
, 
numTrunÿ‹dBy‹s
,

492 
timev®
 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
) {

493 
DummySšk
* 
sšk
 = (DummySšk*)
ş›ÁD©a
;

494 
sšk
->
	`aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
, 
´e£Á©iÚTime
, 
du¿tiÚInMiüo£cÚds
);

495 
	}
}

498 
	#DEBUG_PRINT_EACH_RECEIVED_FRAME
 1

	)

500 
	gDummySšk
::
	$aá”G‘tšgF¿me
(
äameSize
, 
numTrunÿ‹dBy‹s
,

501 
timev®
 
´e£Á©iÚTime
, ) {

503 #ifdeà
DEBUG_PRINT_EACH_RECEIVED_FRAME


504 ià(
fSŒ—mId
 !ğ
NULL
è
	`’vœ
() << "Stream \"" << fStreamId << "\"; ";

505 
	`’vœ
(è<< 
fSub£ssiÚ
.
	`mediumName
(è<< "/" << fSub£ssiÚ.
	`codecName
(è<< ":\tReûived " << 
äameSize
 << " bytes";

506 ià(
numTrunÿ‹dBy‹s
 > 0è
	`’vœ
() << " (with " <<‚umTruncatedBytes << " bytesruncated)";

507 
uSecsSŒ
[6+1];

508 
	`¥rštf
(
uSecsSŒ
, "%06u", ()
´e£Á©iÚTime
.
tv_u£c
);

509 
	`’vœ
(è<< ".\tP»£Á©iÚime: " << ()
´e£Á©iÚTime
.
tv_£c
 << "." << 
uSecsSŒ
;

510 ià(
fSub£ssiÚ
.
	`¹pSourû
(è!ğ
NULL
 && !fSub£ssiÚ.¹pSourû()->
	`hasB“nSynchrÚizedUsšgRTCP
()) {

511 
	`’vœ
() << "!";

513 #ifdeà
DEBUG_PRINT_NPT


514 
	`’vœ
(è<< "\tNPT: " << 
fSub£ssiÚ
.
	`g‘NÜm®PÏyTime
(
´e£Á©iÚTime
);

516 
	`’vœ
() << "\n";

520 
	`cÚtšuePÏyšg
();

521 
	}
}

523 
BoŞ—n
 
	gDummySšk
::
	$cÚtšuePÏyšg
() {

524 ià(
fSourû
 =ğ
NULL
è 
F®£
;

527 
fSourû
->
	`g‘NextF¿me
(
fReûiveBufãr
, 
DUMMY_SINK_RECEIVE_BUFFER_SIZE
,

528 
aá”G‘tšgF¿me
, 
this
,

529 
ÚSourûClosu»
, 
this
);

530  
True
;

531 
	}
}

	@testProgs/testRelay.cpp

21 
	~<liveMedŸ.hh
>

22 
	~"BasicU§geEnvœÚm’t.hh
"

23 
	~"GroupsockH–³r.hh
"

25 
U§geEnvœÚm’t
* 
	g’v
;

30 
	$maš
(
¬gc
, ** 
¬gv
) {

32 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

33 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

36 cÚ¡* 
šputAdd»ssSŒ


37 #ifdeà
USE_SSM


42 
š_addr
 
šputAdd»ss
;

43 
šputAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
šputAdd»ssSŒ
);

45 
PÜt
 cÚ¡ 
	`šputPÜt
(8888);

46 cÚ¡ 
šputTTL
 = 0;

48 #ifdeà
USE_SSM


49 * 
sourûAdd»ssSŒ
 = "aaa.bbb.ccc.ddd";

51 
š_addr
 
sourûF‹rAdd»ss
;

52 
sourûF‹rAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
sourûAdd»ssSŒ
);

54 
Groupsock
 
	`šputGroupsock
(*
’v
, 
šputAdd»ss
, 
sourûF‹rAdd»ss
, 
šputPÜt
);

56 
Groupsock
 
	`šputGroupsock
(*
’v
, 
šputAdd»ss
, 
šputPÜt
, 
šputTTL
);

60 
F¿medSourû
* 
sourû
 = 
BasicUDPSourû
::
	`ü—‹New
(*
’v
, &
šputGroupsock
);

64 cÚ¡* 
ouutAdd»ssSŒ
 = "239.255.43.43";

68 
š_addr
 
ouutAdd»ss
;

69 
ouutAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
ouutAdd»ssSŒ
);

71 
PÜt
 cÚ¡ 
	`ouutPÜt
(4444);

72 cÚ¡ 
ouutTTL
 = 255;

74 
Groupsock
 
	`ouutGroupsock
(*
’v
, 
ouutAdd»ss
, 
ouutPÜt
, 
ouutTTL
);

77 cÚ¡ 
maxPack‘Size
 = 65536;

78 
MedŸSšk
* 
sšk
 = 
BasicUDPSšk
::
	`ü—‹New
(*
’v
, &
ouutGroupsock
, 
maxPack‘Size
);

82 
sšk
->
	`¡¬tPÏyšg
(*
sourû
, 
NULL
, NULL);

84 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

87 
	}
}

	@testProgs/testReplicator.cpp

23 
	~<liveMedŸ.hh
>

24 
	~"BasicU§geEnvœÚm’t.hh
"

25 
	~"GroupsockH–³r.hh
"

27 
U§geEnvœÚm’t
* 
	g’v
;

32 
¡¬tR•liÿUDPSšk
(
SŒ—mR•liÿtÜ
* 
»¶iÿtÜ
, cÚ¡* 
ouutAdd»ssSŒ
, 
pÜtNumB™s
 
ouutPÜtNum
);

33 
¡¬tR•liÿFeSšk
(
SŒ—mR•liÿtÜ
* 
»¶iÿtÜ
, cÚ¡* 
ouutFeName
);

35 
	$maš
(
¬gc
, ** 
¬gv
) {

37 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

38 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

41 cÚ¡* 
šputAdd»ssSŒ


42 #ifdeà
USE_SSM


47 
š_addr
 
šputAdd»ss
;

48 
šputAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
šputAdd»ssSŒ
);

50 
PÜt
 cÚ¡ 
	`šputPÜt
(8888);

51 cÚ¡ 
šputTTL
 = 0;

53 #ifdeà
USE_SSM


54 * 
sourûAdd»ssSŒ
 = "aaa.bbb.ccc.ddd";

56 
š_addr
 
sourûF‹rAdd»ss
;

57 
sourûF‹rAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
sourûAdd»ssSŒ
);

59 
Groupsock
 
	`šputGroupsock
(*
’v
, 
šputAdd»ss
, 
sourûF‹rAdd»ss
, 
šputPÜt
);

61 
Groupsock
 
	`šputGroupsock
(*
’v
, 
šputAdd»ss
, 
šputPÜt
, 
šputTTL
);

65 
F¿medSourû
* 
sourû
 = 
BasicUDPSourû
::
	`ü—‹New
(*
’v
, &
šputGroupsock
);

68 
SŒ—mR•liÿtÜ
* 
»¶iÿtÜ
 = SŒ—mR•liÿtÜ::
	`ü—‹New
(*
’v
, 
sourû
);

72 
	`¡¬tR•liÿUDPSšk
(
»¶iÿtÜ
, "239.255.43.43", 4444);

76 
	`¡¬tR•liÿFeSšk
(
»¶iÿtÜ
, "test.out");

79 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

82 
	}
}

84 
	$¡¬tR•liÿUDPSšk
(
SŒ—mR•liÿtÜ
* 
»¶iÿtÜ
, cÚ¡* 
ouutAdd»ssSŒ
, 
pÜtNumB™s
 
ouutPÜtNum
) {

86 
F¿medSourû
* 
sourû
 = 
»¶iÿtÜ
->
	`ü—‹SŒ—mR•liÿ
();

89 
š_addr
 
ouutAdd»ss
;

90 
ouutAdd»ss
.
s_addr
 = 
	`our_š‘_addr
(
ouutAdd»ssSŒ
);

92 
PÜt
 cÚ¡ 
	`ouutPÜt
(
ouutPÜtNum
);

93 cÚ¡ 
ouutTTL
 = 255;

95 
Groupsock
* 
ouutGroupsock
 = 
Ãw
 
	`Groupsock
(*
’v
, 
ouutAdd»ss
, 
ouutPÜt
, 
ouutTTL
);

98 cÚ¡ 
maxPack‘Size
 = 65536;

99 
MedŸSšk
* 
sšk
 = 
BasicUDPSšk
::
	`ü—‹New
(*
’v
, 
ouutGroupsock
, 
maxPack‘Size
);

102 
sšk
->
	`¡¬tPÏyšg
(*
sourû
, 
NULL
, NULL);

103 
	}
}

105 
	$¡¬tR•liÿFeSšk
(
SŒ—mR•liÿtÜ
* 
»¶iÿtÜ
, cÚ¡* 
ouutFeName
) {

107 
F¿medSourû
* 
sourû
 = 
»¶iÿtÜ
->
	`ü—‹SŒ—mR•liÿ
();

110 
MedŸSšk
* 
sšk
 = 
FeSšk
::
	`ü—‹New
(*
’v
, 
ouutFeName
);

113 
sšk
->
	`¡¬tPÏyšg
(*
sourû
, 
NULL
, NULL);

114 
	}
}

	@testProgs/testWAVAudioStreamer.cpp

20 
	~"liveMedŸ.hh
"

21 
	~"GroupsockH–³r.hh
"

23 
	~"BasicU§geEnvœÚm’t.hh
"

29 
U§geEnvœÚm’t
* 
	g’v
;

31 
¶ay
();

33 
	$maš
(
¬gc
, ** 
¬gv
) {

35 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

36 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

38 
	`¶ay
();

40 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

42 
	}
}

44 cÚ¡* 
	gšputFeName
 = "test.wav";

46 
aá”PÏyšg
(* 
ş›ÁD©a
);

50 
	s£ssiÚS‹_t
 {

51 
F¿medSourû
* 
	msourû
;

52 
RTPSšk
* 
	msšk
;

53 
RTCPIn¡ªû
* 
	m¹ıIn¡ªû
;

54 
Groupsock
* 
	m¹pGroupsock
;

55 
Groupsock
* 
	m¹ıGroupsock
;

56 
RTSPS”v”
* 
	m¹¥S”v”
;

57 } 
	g£ssiÚS‹
;

59 
	$¶ay
() {

61 
WAVAudioFeSourû
* 
wavSourû
 = WAVAudioFeSourû::
	`ü—‹New
(*
’v
, 
šputFeName
);

62 ià(
wavSourû
 =ğ
NULL
) {

63 *
’v
 << "UÇbËØİ’ f\"" << 
šputFeName


65 << 
’v
->
	`g‘ResuÉMsg
() << "\n";

66 
	`ex™
(1);

70 
audioFÜm©
 = 
wavSourû
->
	`g‘AudioFÜm©
();

71 cÚ¡ 
b™sP”Sam¶e
 = 
wavSourû
->
	`b™sP”Sam¶e
();

73 ià(
b™sP”Sam¶e
%4 != 0 || bitsPerSample < 4 || bitsPerSample > 24 || bitsPerSample == 12) {

74 *
’v
 << "ThšpuˆfcÚš " << 
b™sP”Sam¶e
 << " bit-per-sample‡udio, which we don't handle\n";

75 
	`ex™
(1);

77 cÚ¡ 
§m¶šgF»qu’cy
 = 
wavSourû
->
	`§m¶šgF»qu’cy
();

78 cÚ¡ 
numChªÃls
 = 
wavSourû
->
	`numChªÃls
();

79 
b™sP”SecÚd
 = 
§m¶šgF»qu’cy
*
b™sP”Sam¶e
*
numChªÃls
;

80 *
’v
 << "AudiØsourû…¬am‘”s:\n\t" << 
§m¶šgF»qu’cy
 << " Hz, ";

81 *
’v
 << 
b™sP”Sam¶e
 << " bits-per-sample, ";

82 *
’v
 << 
numChªÃls
 << " channels => ";

83 *
’v
 << 
b™sP”SecÚd
 << " bits-per-second\n";

85 cÚ¡* 
mimeTy³
;

86 
·ylßdFÜm©Code
 = 96;

90 
£ssiÚS‹
.
sourû
 = 
wavSourû
;

91 ià(
audioFÜm©
 =ğ
WA_PCM
) {

92 ià(
b™sP”Sam¶e
 == 16) {

94 #ifdeà
CONVERT_TO_ULAW


96 
£ssiÚS‹
.
sourû
 = 
uLawFromPCMAudioSourû
::
	`ü—‹New
(*
’v
, 
wavSourû
, 1 );

97 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

98 *
’v
 << "UÇbËØü—‹‡ u-Ïw f‹¸äomhPCM‡udiØsourû: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

99 
	`ex™
(1);

101 
b™sP”SecÚd
 /= 2;

102 *
’v
 << "CÚv”tšgØ8-b™ u-Ïw‡udiØfÜ sŒ—mšg => " << 
b™sP”SecÚd
 << " bits-per-second\n";

103 
mimeTy³
 = "PCMU";

104 ià(
§m¶šgF»qu’cy
 =ğ8000 && 
numChªÃls
 == 1) {

105 
·ylßdFÜm©Code
 = 0;

109 
£ssiÚS‹
.
sourû
 = 
EndŸnSw­16
::
	`ü—‹New
(*
’v
, 
wavSourû
);

110 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

111 *
’v
 << "UÇbËØü—‹‡†™e->b™-’dŸÀÜd” f‹¸äomhPCM‡udiØsourû: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

112 
	`ex™
(1);

114 *
’v
 << "Convertingo‚etwork byte order for streaming\n";

115 
mimeTy³
 = "L16";

116 ià(
§m¶šgF»qu’cy
 =ğ44100 && 
numChªÃls
 == 2) {

117 
·ylßdFÜm©Code
 = 10;

118 } ià(
§m¶šgF»qu’cy
 =ğ44100 && 
numChªÃls
 == 1) {

119 
·ylßdFÜm©Code
 = 11;

122 } ià(
b™sP”Sam¶e
 == 20 || bitsPerSample == 24) {

124 
£ssiÚS‹
.
sourû
 = 
EndŸnSw­24
::
	`ü—‹New
(*
’v
, 
wavSourû
);

125 ià(
£ssiÚS‹
.
sourû
 =ğ
NULL
) {

126 *
’v
 << "UÇbËØü—‹‡†™e->b™-’dŸÀÜd” f‹¸äomhPCM‡udiØsourû: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

127 
	`ex™
(1);

129 *
’v
 << "Convertingo‚etwork byte order for streaming\n";

130 
mimeTy³
 = 
b™sP”Sam¶e
 == 20 ? "L20" : "L24";

133 
mimeTy³
 = "L8";

135 } ià(
audioFÜm©
 =ğ
WA_PCMU
) {

136 
mimeTy³
 = "PCMU";

137 ià(
§m¶šgF»qu’cy
 =ğ8000 && 
numChªÃls
 == 1) {

138 
·ylßdFÜm©Code
 = 0;

140 } ià(
audioFÜm©
 =ğ
WA_PCMA
) {

141 
mimeTy³
 = "PCMA";

142 ià(
§m¶šgF»qu’cy
 =ğ8000 && 
numChªÃls
 == 1) {

143 
·ylßdFÜm©Code
 = 8;

145 } ià(
audioFÜm©
 =ğ
WA_IMA_ADPCM
) {

146 
mimeTy³
 = "DVI4";

148 ià(
numChªÃls
 == 1) {

149 ià(
§m¶šgF»qu’cy
 == 8000) {

150 
·ylßdFÜm©Code
 = 5;

151 } ià(
§m¶šgF»qu’cy
 == 16000) {

152 
·ylßdFÜm©Code
 = 6;

153 } ià(
§m¶šgF»qu’cy
 == 11025) {

154 
·ylßdFÜm©Code
 = 16;

155 } ià(
§m¶šgF»qu’cy
 == 22050) {

156 
·ylßdFÜm©Code
 = 17;

160 *
’v
 << "UnknowÀaudiØfÜm© cod\"" << 
audioFÜm©
 << "\" in WAV file header\n";

161 
	`ex™
(1);

165 
š_addr
 
de¡š©iÚAdd»ss
;

166 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

171 cÚ¡ 
¹pPÜtNum
 = 2222;

172 cÚ¡ 
¹ıPÜtNum
 = 
¹pPÜtNum
+1;

173 cÚ¡ 
‰l
 = 255;

175 cÚ¡ 
PÜt
 
	`¹pPÜt
(
¹pPÜtNum
);

176 cÚ¡ 
PÜt
 
	`¹ıPÜt
(
¹ıPÜtNum
);

178 
£ssiÚS‹
.
¹pGroupsock


179 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜt
, 
‰l
);

180 
£ssiÚS‹
.
¹pGroupsock
->
	`muÉiÿ¡S’dOÆy
();

181 
£ssiÚS‹
.
¹ıGroupsock


182 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜt
, 
‰l
);

183 
£ssiÚS‹
.
¹ıGroupsock
->
	`muÉiÿ¡S’dOÆy
();

186 
£ssiÚS‹
.
sšk


187 ğ
Sim¶eRTPSšk
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹pGroupsock
,

188 
·ylßdFÜm©Code
, 
§m¶šgF»qu’cy
,

189 "audio", 
mimeTy³
, 
numChªÃls
);

192 cÚ¡ 
e¡im©edSessiÚBªdwidth
 = (
b™sP”SecÚd
 + 500)/1000;

193 cÚ¡ 
maxCNAMEËn
 = 100;

194 
CNAME
[
maxCNAMEËn
+1];

195 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

196 
CNAME
[
maxCNAMEËn
] = '\0';

197 
£ssiÚS‹
.
¹ıIn¡ªû


198 ğ
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
£ssiÚS‹
.
¹ıGroupsock
,

199 
e¡im©edSessiÚBªdwidth
, 
CNAME
,

200 
£ssiÚS‹
.
sšk
, 
NULL
 ,

201 
True
 );

205 
£ssiÚS‹
.
¹¥S”v”
 = 
RTSPS”v”
::
	`ü—‹New
(*
’v
, 8554);

206 ià(
£ssiÚS‹
.
¹¥S”v”
 =ğ
NULL
) {

207 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

208 
	`ex™
(1);

210 
S”v”MedŸSessiÚ
* 
sms


211 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "‹¡SŒ—m", 
šputFeName
,

212 "SessiÚ sŒ—med by \"‹¡WAVAudiÙ»am”\"", 
True
 );

213 
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*
£ssiÚS‹
.
sšk
, sessiÚS‹.
¹ıIn¡ªû
));

214 
£ssiÚS‹
.
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

216 * 
u¾
 = 
£ssiÚS‹
.
¹¥S”v”
->
	`¹¥URL
(
sms
);

217 *
’v
 << "PÏyhi ¡»am usšghURL \"" << 
u¾
 << "\"\n";

218 
d–‘e
[] 
u¾
;

221 *
’v
 << "Beginning streaming...\n";

222 
£ssiÚS‹
.
sšk
->
	`¡¬tPÏyšg
(*£ssiÚS‹.
sourû
, 
aá”PÏyšg
, 
NULL
);

223 
	}
}

226 
	$aá”PÏyšg
(* ) {

227 *
’v
 << "...done streaming\n";

230 
Medium
::
	`şo£
(
£ssiÚS‹
.
¹¥S”v”
);

231 
Medium
::
	`şo£
(
£ssiÚS‹
.
¹ıIn¡ªû
);

232 
Medium
::
	`şo£
(
£ssiÚS‹
.
sšk
);

233 
d–‘e
 
£ssiÚS‹
.
¹pGroupsock
;

234 
Medium
::
	`şo£
(
£ssiÚS‹
.
sourû
);

235 
d–‘e
 
£ssiÚS‹
.
¹ıGroupsock
;

238 
	`ex™
(0);

239 
	}
}

	@testProgs/vobStreamer.cpp

22 
	~"liveMedŸ.hh
"

23 
	~"AC3AudioSŒ—mF¿m”.hh
"

24 
	~"BasicU§geEnvœÚm’t.hh
"

25 
	~"GroupsockH–³r.hh
"

27 cÚ¡* 
	g´og¿mName
;

30 
BoŞ—n
 
	giF¿mesOÆy
 = 
F®£
;

32 cÚ¡ 
	gVOB_AUDIO
 = 1<<0;

33 cÚ¡ 
	gVOB_VIDEO
 = 1<<1;

34 
	gmedŸToSŒ—m
 = 
VOB_AUDIO
|
VOB_VIDEO
;

36 cÚ¡** 
	gšputFeNames
;

37 cÚ¡** 
	gcurIÅutFeName
;

38 
BoŞ—n
 
	ghaveR—dOÃFe
 = 
F®£
;

40 
U§geEnvœÚm’t
* 
	g’v
;

41 
MPEG1Ü2Demux
* 
	gm³gDemux
;

42 
AC3AudioSŒ—mF¿m”
* 
	gaudioSourû
 = 
NULL
;

43 
F¿medSourû
* 
	gvideoSourû
 = 
NULL
;

44 
RTPSšk
* 
	gaudioSšk
 = 
NULL
;

45 
RTCPIn¡ªû
* 
	gaudioRTCP
 = 
NULL
;

46 
RTPSšk
* 
	gvideoSšk
 = 
NULL
;

47 
RTCPIn¡ªû
* 
	gvideoRTCP
 = 
NULL
;

48 
RTSPS”v”
* 
	g¹¥S”v”
 = 
NULL
;

49 cÚ¡ 
	gdeçuÉRTSPS”v”PÜtNum
 = 554;

50 
	g¹¥S”v”PÜtNum
 = 
deçuÉRTSPS”v”PÜtNum
;

52 
Groupsock
* 
	g¹pGroupsockAudio
;

53 
Groupsock
* 
	g¹ıGroupsockAudio
;

54 
Groupsock
* 
	g¹pGroupsockVideo
;

55 
Groupsock
* 
	g¹ıGroupsockVideo
;

57 
	$u§ge
() {

58 *
’v
 << "u§ge: " << 
´og¿mName
 << " [-i] [-a|-v] "

61 
	`ex™
(1);

62 
	}
}

64 
¶ay
();

66 
	$maš
(
¬gc
, cÚ¡** 
¬gv
) {

68 
TaskScheduËr
* 
scheduËr
 = 
BasicTaskScheduËr
::
	`ü—‹New
();

69 
’v
 = 
BasicU§geEnvœÚm’t
::
	`ü—‹New
(*
scheduËr
);

73 
´og¿mName
 = 
¬gv
[0];

74 
¬gc
 > 2) {

75 cÚ¡* cÚ¡ 
İt
 = 
¬gv
[1];

76 ià(
İt
[0] != '-') ;

77 
İt
[1]) {

80 
iF¿mesOÆy
 = 
True
;

85 
medŸToSŒ—m
 &=~ 
VOB_VIDEO
;

90 
medŸToSŒ—m
 &=~ 
VOB_AUDIO
;

95 
pÜtArg
;

96 ià(
	`ssÿnf
(
¬gv
[2], "%d", &
pÜtArg
) != 1) {

97 
	`u§ge
();

99 ià(
pÜtArg
 <= 0 ||…ortArg >= 65536) {

100 *
’v
 << "bad…Üˆnumb”: " << 
pÜtArg


102 
	`u§ge
();

104 
¹¥S”v”PÜtNum
 = ()
pÜtArg
;

105 ++
¬gv
; --
¬gc
;

110 
	`u§ge
();

115 ++
¬gv
; --
¬gc
;

117 ià(
¬gc
 < 2è
	`u§ge
();

118 ià(
medŸToSŒ—m
 == 0) {

119 *
’v
 << "The -a‡nd -v flags cannot both be used!\n";

120 
	`u§ge
();

122 ià(
iF¿mesOÆy
 && (
medŸToSŒ—m
&
VOB_VIDEO
) == 0) {

123 *
’v
 << "Warning: Because we're‚ot streaming video,he -i flag has‚oƒffect.\n";

126 
šputFeNames
 = &
¬gv
[1];

127 
curIÅutFeName
 = 
šputFeNames
;

130 
š_addr
 
de¡š©iÚAdd»ss
;

131 
de¡š©iÚAdd»ss
.
s_addr
 = 
	`choo£RªdomIPv4SSMAdd»ss
(*
’v
);

133 cÚ¡ 
¹pPÜtNumAudio
 = 4444;

134 cÚ¡ 
¹ıPÜtNumAudio
 = 
¹pPÜtNumAudio
+1;

135 cÚ¡ 
¹pPÜtNumVideo
 = 8888;

136 cÚ¡ 
¹ıPÜtNumVideo
 = 
¹pPÜtNumVideo
+1;

137 cÚ¡ 
‰l
 = 255;

139 cÚ¡ 
PÜt
 
	`¹pPÜtAudio
(
¹pPÜtNumAudio
);

140 cÚ¡ 
PÜt
 
	`¹ıPÜtAudio
(
¹ıPÜtNumAudio
);

141 cÚ¡ 
PÜt
 
	`¹pPÜtVideo
(
¹pPÜtNumVideo
);

142 cÚ¡ 
PÜt
 
	`¹ıPÜtVideo
(
¹ıPÜtNumVideo
);

144 cÚ¡ 
maxCNAMEËn
 = 100;

145 
CNAME
[
maxCNAMEËn
+1];

146 
	`g‘ho¡Çme
((*)
CNAME
, 
maxCNAMEËn
);

147 
CNAME
[
maxCNAMEËn
] = '\0';

149 ià(
medŸToSŒ—m
&
VOB_AUDIO
) {

150 
¹pGroupsockAudio


151 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtAudio
, 
‰l
);

152 
¹pGroupsockAudio
->
	`muÉiÿ¡S’dOÆy
();

155 
audioSšk


156 ğ
AC3AudioRTPSšk
::
	`ü—‹New
(*
’v
, 
¹pGroupsockAudio
, 96, 0);

160 
¹ıGroupsockAudio


161 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜtAudio
, 
‰l
);

162 
¹ıGroupsockAudio
->
	`muÉiÿ¡S’dOÆy
();

163 cÚ¡ 
e¡im©edSessiÚBªdwidthAudio


165 
audioRTCP
 = 
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
¹ıGroupsockAudio
,

166 
e¡im©edSessiÚBªdwidthAudio
, 
CNAME
,

167 
audioSšk
, 
NULL
 ,

168 
True
 );

172 ià(
medŸToSŒ—m
&
VOB_VIDEO
) {

173 
¹pGroupsockVideo


174 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹pPÜtVideo
, 
‰l
);

175 
¹pGroupsockVideo
->
	`muÉiÿ¡S’dOÆy
();

178 
videoSšk
 = 
MPEG1Ü2VideoRTPSšk
::
	`ü—‹New
(*
’v
, 
¹pGroupsockVideo
);

181 
¹ıGroupsockVideo


182 ğ
Ãw
 
	`Groupsock
(*
’v
, 
de¡š©iÚAdd»ss
, 
¹ıPÜtVideo
, 
‰l
);

183 
¹ıGroupsockVideo
->
	`muÉiÿ¡S’dOÆy
();

184 cÚ¡ 
e¡im©edSessiÚBªdwidthVideo


186 
videoRTCP
 = 
RTCPIn¡ªû
::
	`ü—‹New
(*
’v
, 
¹ıGroupsockVideo
,

187 
e¡im©edSessiÚBªdwidthVideo
, 
CNAME
,

188 
videoSšk
, 
NULL
 ,

189 
True
 );

193 ià(
¹¥S”v”
 =ğ
NULL
) {

194 
¹¥S”v”
 = 
RTSPS”v”
::
	`ü—‹New
(*
’v
, 
¹¥S”v”PÜtNum
);

195 ià(
¹¥S”v”
 =ğ
NULL
) {

196 *
’v
 << "FaedØü—‹ RTSP s”v”: " <<ƒnv->
	`g‘ResuÉMsg
() << "\n";

197 *
’v
 << "To changehe RTSP server's…ort‚umber, usehe \"-p <port‚umber>\" option.\n";

198 
	`ex™
(1);

200 
S”v”MedŸSessiÚ
* 
sms


201 ğ
S”v”MedŸSessiÚ
::
	`ü—‹New
(*
’v
, "vobSŒ—m", *
curIÅutFeName
,

202 "SessiÚ sŒ—med by \"vobSŒ—m”\"", 
True
 );

203 ià(
audioSšk
 !ğ
NULL
è
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*audioSšk, 
audioRTCP
));

204 ià(
videoSšk
 !ğ
NULL
è
sms
->
	`addSub£ssiÚ
(
PassiveS”v”MedŸSub£ssiÚ
::
	`ü—‹New
(*videoSšk, 
videoRTCP
));

205 
¹¥S”v”
->
	`addS”v”MedŸSessiÚ
(
sms
);

207 *
’v
 << "Created RTSP server.\n";

210 * 
u¾
 = 
¹¥S”v”
->
	`¹¥URL
(
sms
);

211 *
’v
 << "Acûs thi ¡»am usšghURL:\n\t" << 
u¾
 << "\n";

212 
d–‘e
[] 
u¾
;

216 *
’v
 << "Beginning streaming...\n";

217 
	`¶ay
();

219 
’v
->
	`skScheduËr
().
	`doEv’tLoİ
();

222 
	}
}

224 
	$aá”PÏyšg
(* 
ş›ÁD©a
) {

228 ià((
audioSourû
 !ğ
NULL
 &&‡udioSourû->
	`isCu¼’yAwa™šgD©a
()) ||

229 (
videoSourû
 !ğ
NULL
 && videoSourû->
	`isCu¼’yAwa™šgD©a
())) {

235 *
’v
 << "...done„eading from file\n";

237 ià(
audioSšk
 !ğ
NULL
èaudioSšk->
	`¡İPÏyšg
();

238 ià(
videoSšk
 !ğ
NULL
èvideoSšk->
	`¡İPÏyšg
();

240 
Medium
::
	`şo£
(
audioSourû
);

241 
Medium
::
	`şo£
(
videoSourû
);

242 
Medium
::
	`şo£
(
m³gDemux
);

246 ++
curIÅutFeName
;

249 
	`¶ay
();

250 
	}
}

252 
	$¶ay
() {

253 ià(*
curIÅutFeName
 =ğ
NULL
) {

256 ià(!
haveR—dOÃFe
è
	`ex™
(1);

257 
haveR—dOÃFe
 = 
F®£
;

258 
curIÅutFeName
 = 
šputFeNames
;

262 
By‹SŒ—mFeSourû
* 
feSourû


263 ğ
By‹SŒ—mFeSourû
::
	`ü—‹New
(*
’v
, *
curIÅutFeName
);

264 ià(
feSourû
 =ğ
NULL
) {

265 *
’v
 << "UÇbËØİ’ f\"" << *
curIÅutFeName


268 ++
curIÅutFeName
;

269 
	`¶ay
();

272 
haveR—dOÃFe
 = 
True
;

276 
m³gDemux
 = 
MPEG1Ü2Demux
::
	`ü—‹New
(*
’v
, 
feSourû
);

277 ià(
medŸToSŒ—m
&
VOB_AUDIO
) {

278 
F¿medSourû
* 
audioES
 = 
m³gDemux
->
	`ÃwEËm’rySŒ—m
(0xBD);

280 
audioSourû


281 ğ
AC3AudioSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
audioES
, 0x80);

283 ià(
medŸToSŒ—m
&
VOB_VIDEO
) {

284 
F¿medSourû
* 
videoES
 = 
m³gDemux
->
	`ÃwVideoSŒ—m
();

286 
videoSourû


287 ğ
MPEG1Ü2VideoSŒ—mF¿m”
::
	`ü—‹New
(*
’v
, 
videoES
, 
iF¿mesOÆy
);

291 *
’v
 << "BegšnšgØ»ad from \"" << *
curIÅutFeName
 << "\"...\n";

292 ià(
videoSšk
 !ğ
NULL
) {

293 
videoSšk
->
	`¡¬tPÏyšg
(*
videoSourû
, 
aá”PÏyšg
, videoSink);

295 ià(
audioSšk
 !ğ
NULL
) {

296 
audioSšk
->
	`£tRTPTime¡ampF»qu’cy
(
audioSourû
->
	`§m¶šgR©e
());

297 
audioSšk
->
	`¡¬tPÏyšg
(*
audioSourû
, 
aá”PÏyšg
,‡udioSink);

299 
	}
}

	@/usr/include/arpa/inet.h

19 #iâdeà
_ARPA_INET_H


20 
	#_ARPA_INET_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<Ãtš‘/š.h
>

26 #iâdeà
__sockËn_t_defšed


27 
__sockËn_t
 
	tsockËn_t
;

28 
	#__sockËn_t_defšed


	)

31 
__BEGIN_DECLS


35 
š_addr_t
 
	$š‘_addr
 (
__cÚ¡
 *
__ı
è
__THROW
;

38 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

42 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

43 
__THROW
;

46 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

50 
š_addr_t
 
	$š‘_ÃtwÜk
 (
__cÚ¡
 *
__ı
è
__THROW
;

54 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

59 
	$š‘_±Ú
 (
__af
, 
__cÚ¡
 *
__»¡riù
 
__ı
,

60 *
__»¡riù
 
__buf
è
__THROW
;

65 
__cÚ¡
 *
	$š‘_Áİ
 (
__af
, 
__cÚ¡
 *
__»¡riù
 
__ı
,

66 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

67 
__THROW
;

71 #ifdeà
__USE_MISC


74 
	$š‘_©Ú
 (
__cÚ¡
 *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

78 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

83 *
	$š‘_Ãt_Áİ
 (
__af
, 
__cÚ¡
 *
__ı
, 
__b™s
,

84 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

89 
	$š‘_Ãt_±Ú
 (
__af
, 
__cÚ¡
 *
__ı
,

90 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

95 
	$š‘_n§p_addr
 (
__cÚ¡
 *
__ı
,

96 *
__buf
, 
__Ën
è
__THROW
;

100 *
	$š‘_n§p_Áß
 (
__Ën
, 
__cÚ¡
 *
__ı
,

101 *
__buf
è
__THROW
;

104 
__END_DECLS


	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

91 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

92 
	#__tßscii
(
c
è((cè& 0x7fè

	)

94 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__exùy³
 (
i§Êum
);

103 
	`__exùy³
 (
i§Íha
);

104 
	`__exùy³
 (
isúŒl
);

105 
	`__exùy³
 (
isdig™
);

106 
	`__exùy³
 (
i¦ow”
);

107 
	`__exùy³
 (
isg¿ph
);

108 
	`__exùy³
 (
i¥ršt
);

109 
	`__exùy³
 (
i¥unù
);

110 
	`__exùy³
 (
is¥aû
);

111 
	`__exùy³
 (
isuµ”
);

112 
	`__exùy³
 (
isxdig™
);

116 
	$tŞow”
 (
__c
è
__THROW
;

119 
	$touµ”
 (
__c
è
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__exùy³
 (
isbÏnk
);

130 
__END_NAMESPACE_C99


133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE
 && !defšed 
__ılu¥lus


173 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

174 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

175 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

176 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

177 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

178 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

179 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

180 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

181 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

182 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

183 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

185 #ifdeà
__USE_ISOC99


186 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

189 #ifdeà
__USE_EXTERN_INLINES


190 
__ex‹º_šlše
 

191 
__NTH
 (
	$tŞow”
 (
__c
))

193  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

194 
	}
}

196 
__ex‹º_šlše
 

197 
__NTH
 (
	$touµ”
 (
__c
))

199  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

200 
	}
}

203 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


204 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

205 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

208 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


209 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

210 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

212 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

213 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

219 #ifdeà
__USE_XOPEN2K8


233 
	~<xloÿË.h
>

237 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

238 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

240 
	#__exùy³_l
(
Çme
) \

241 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

247 
__exùy³_l
 (
i§Êum_l
);

248 
__exùy³_l
 (
i§Íha_l
);

249 
__exùy³_l
 (
isúŒl_l
);

250 
__exùy³_l
 (
isdig™_l
);

251 
__exùy³_l
 (
i¦ow”_l
);

252 
__exùy³_l
 (
isg¿ph_l
);

253 
__exùy³_l
 (
i¥ršt_l
);

254 
__exùy³_l
 (
i¥unù_l
);

255 
__exùy³_l
 (
is¥aû_l
);

256 
__exùy³_l
 (
isuµ”_l
);

257 
__exùy³_l
 (
isxdig™_l
);

259 
__exùy³_l
 (
isbÏnk_l
);

263 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

264 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

267 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

268 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

270 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


271 
	#__tŞow”_l
(
c
, 
loÿË
) \

272 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

273 
	#__touµ”_l
(
c
, 
loÿË
) \

274 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

275 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

276 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

280 #iâdeà
__NO_CTYPE


281 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

282 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

283 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

284 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

285 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

286 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

287 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

288 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

289 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

290 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

291 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

293 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

295 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


296 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

297 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

300 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

301 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

302 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

303 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

304 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

305 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

306 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

307 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

308 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

309 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

310 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

312 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

314 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


315 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

316 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/errno.h

23 #iâdef 
_ERRNO_H


27 #iâdef 
__Ãed_Em©h


28 
	#_ERRNO_H
 1

	)

29 
	~<ã©u»s.h
>

32 
	g__BEGIN_DECLS


36 
	~<b™s/”ºo.h
>

37 #undeà
__Ãed_Em©h


39 #ifdef 
_ERRNO_H


46 #iâdef 
”ºo


47 
”ºo
;

50 #ifdeà
__USE_GNU


55 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

59 
	g__END_DECLS


67 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


68 #iâdeà
__”rÜ_t_defšed


69 
	t”rÜ_t
;

70 
	#__”rÜ_t_defšed
 1

	)

72 #undeà
__Ãed_”rÜ_t


	@/usr/include/fcntl.h

24 #iâdef 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/fú.h
>

37 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


38 
	~<b™s/ty³s.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

41 
	~<b™s/¡©.h
>

43 
	#S_IFMT
 
__S_IFMT


	)

44 
	#S_IFDIR
 
__S_IFDIR


	)

45 
	#S_IFCHR
 
__S_IFCHR


	)

46 
	#S_IFBLK
 
__S_IFBLK


	)

47 
	#S_IFREG
 
__S_IFREG


	)

48 #ifdeà
__S_IFIFO


49 
	#S_IFIFO
 
__S_IFIFO


	)

51 #ifdeà
__S_IFLNK


52 
	#S_IFLNK
 
__S_IFLNK


	)

54 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


55 
	#S_IFSOCK
 
__S_IFSOCK


	)

60 
	#S_ISUID
 
__S_ISUID


	)

61 
	#S_ISGID
 
__S_ISGID


	)

63 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


65 
	#S_ISVTX
 
__S_ISVTX


	)

68 
	#S_IRUSR
 
__S_IREAD


	)

69 
	#S_IWUSR
 
__S_IWRITE


	)

70 
	#S_IXUSR
 
__S_IEXEC


	)

72 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

74 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

75 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

76 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

78 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

80 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

81 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

82 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

84 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

87 #ifdef 
__USE_MISC


88 #iâdeà
R_OK


91 
	#R_OK
 4

	)

92 
	#W_OK
 2

	)

93 
	#X_OK
 1

	)

94 
	#F_OK
 0

	)

99 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


100 
	#SEEK_SET
 0

	)

101 
	#SEEK_CUR
 1

	)

102 
	#SEEK_END
 2

	)

110 
fú
 (
__fd
, 
__cmd
, ...);

118 #iâdeà
__USE_FILE_OFFSET64


119 
	$İ’
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

121 #ifdeà
__REDIRECT


122 
	`__REDIRECT
 (
İ’
, (
__cÚ¡
 *
__fe
, 
__oæag
, ...), 
İ’64
)

123 
	`__nÚnuÎ
 ((1));

125 
	#İ’
 
İ’64


	)

128 #ifdeà
__USE_LARGEFILE64


129 
	$İ’64
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

132 #ifdeà
__USE_ATFILE


142 #iâdeà
__USE_FILE_OFFSET64


143 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

144 
	`__nÚnuÎ
 ((2));

146 #ifdeà
__REDIRECT


147 
	`__REDIRECT
 (
İ’©
, (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
,

148 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

150 
	#İ’©
 
İ’©64


	)

153 #ifdeà
__USE_LARGEFILE64


154 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

155 
	`__nÚnuÎ
 ((2));

164 #iâdeà
__USE_FILE_OFFSET64


165 
	$ü—t
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

167 #ifdeà
__REDIRECT


168 
	`__REDIRECT
 (
ü—t
, (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
),

169 
ü—t64
è
	`__nÚnuÎ
 ((1));

171 
	#ü—t
 
ü—t64


	)

174 #ifdeà
__USE_LARGEFILE64


175 
	$ü—t64
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

178 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

179 && !
defšed
 
__USE_POSIX
))

188 
	#F_ULOCK
 0

	)

189 
	#F_LOCK
 1

	)

190 
	#F_TLOCK
 2

	)

191 
	#F_TEST
 3

	)

193 #iâdeà
__USE_FILE_OFFSET64


194 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
);

196 #ifdeà
__REDIRECT


197 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

199 
	#lockf
 
lockf64


	)

202 #ifdeà
__USE_LARGEFILE64


203 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
);

207 #ifdeà
__USE_XOPEN2K


210 #iâdeà
__USE_FILE_OFFSET64


211 
	$posix_çdvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
,

212 
__advi£
è
__THROW
;

214 #ifdeà
__REDIRECT_NTH


215 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

216 
__off64_t
 
__Ën
, 
__advi£
),

217 
posix_çdvi£64
);

219 
	#posix_çdvi£
 
posix_çdvi£64


	)

222 #ifdeà
__USE_LARGEFILE64


223 
	$posix_çdvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
,

224 
__advi£
è
__THROW
;

232 #iâdeà
__USE_FILE_OFFSET64


233 
	`posix_çÎoÿ‹
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

235 #ifdeà
__REDIRECT


236 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

237 
__off64_t
 
__Ën
),

238 
posix_çÎoÿ‹64
);

240 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

243 #ifdeà
__USE_LARGEFILE64


244 
	`posix_çÎoÿ‹64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
);

250 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
 \

251 && 
defšed
 
__va_¬g_·ck_Ën


252 
	~<b™s/fú2.h
>

255 
__END_DECLS


	@/usr/include/math.h

25 #iâdef 
_MATH_H


26 
	#_MATH_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/huge_v®.h
>

35 #ifdeà
__USE_ISOC99


36 
	~<b™s/huge_v®f.h
>

37 
	~<b™s/huge_v®l.h
>

40 
	~<b™s/šf.h
>

43 
	~<b™s/Çn.h
>

47 
	~<b™s/m©hdef.h
>

54 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

55 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

56 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

57 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

58 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

59 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

60 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

61 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

62 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

63 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

64 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

65 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

67 
	#_MdoubË_
 

	)

68 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

69 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

70 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

71 
	~<b™s/m©hÿÎs.h
>

72 #undeà
_MdoubË_


73 #undeà
_MdoubË_BEGIN_NAMESPACE


74 #undeà
_MdoubË_END_NAMESPACE


75 #undeà
__MATH_PRECNAME


77 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


83 #iâdeà
_Mæßt_


84 
	#_Mæßt_
 

	)

86 
	#_MdoubË_
 
_Mæßt_


	)

87 #ifdeà
__STDC__


88 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

90 
	#__MATH_PRECNAME
(
Çme
,
r
èÇm
f
 
	)
r

92 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

93 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

94 
	~<b™s/m©hÿÎs.h
>

95 #undeà
_MdoubË_


96 #undeà
_MdoubË_BEGIN_NAMESPACE


97 #undeà
_MdoubË_END_NAMESPACE


98 #undeà
__MATH_PRECNAME


100 #ià(
__STDC__
 - 0 || 
__GNUC__
 - 0) \

101 && (!
defšed
 
__NO_LONG_DOUBLE_MATH
 \

102 || 
defšed
 
__LDBL_COMPAT
 \

103 || !
defšed
 
_LIBC
)

104 #ifdeà
__LDBL_COMPAT


106 #ifdeà
__USE_ISOC99


107 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

108 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

109 #ifdeà
__REDIRECT_NTH


110 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

111 
__Ædbl_Ãx‰ow¬df
)

112 
	`__©Œibu‹__
 ((
__cÚ¡__
));

113 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

114 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

115 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

116 (
__x
, 
__y
),

117 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

122 #ià
defšed
 
__LDBL_COMPAT
 || defšed 
__NO_LONG_DOUBLE_MATH


124 #undeà
__MATHDECL_1


125 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

126 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

127 
¬gs
, 
®Ÿs
)

	)

128 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

129 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

134 #iâdeà
_MlÚg_doubË_


135 
	#_MlÚg_doubË_
 

	)

137 
	#_MdoubË_
 
_MlÚg_doubË_


	)

138 #ifdeà
__STDC__


139 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

141 
	#__MATH_PRECNAME
(
Çme
,
r
èÇm
l
 
	)
r

143 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

144 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

145 
	~<b™s/m©hÿÎs.h
>

146 #undeà
_MdoubË_


147 #undeà
_MdoubË_BEGIN_NAMESPACE


148 #undeà
_MdoubË_END_NAMESPACE


149 #undeà
__MATH_PRECNAME


154 #undeà
__MATHDECL_1


155 #undeà
__MATHDECL


156 #undeà
__MATHCALL


159 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


161 
signgam
;

166 #ifdeà
__USE_ISOC99


204 
FP_NAN
,

205 
	#FP_NAN
 
FP_NAN


	)

206 
FP_INFINITE
,

207 
	#FP_INFINITE
 
FP_INFINITE


	)

208 
FP_ZERO
,

209 
	#FP_ZERO
 
FP_ZERO


	)

210 
FP_SUBNORMAL
,

211 
	#FP_SUBNORMAL
 
FP_SUBNORMAL


	)

212 
FP_NORMAL


213 
	#FP_NORMAL
 
FP_NORMAL


	)

217 #ifdeà
__NO_LONG_DOUBLE_MATH


218 
	#åşassify
(
x
) \

219 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

221 
	#åşassify
(
x
) \

222 ( (
x
) ==  () \

223 ? 
	`__åşassifyf
 (
x
) \

224 :  (
x
) ==  () \

225 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

229 #ifdeà
__NO_LONG_DOUBLE_MATH


230 
	#signb™
(
x
) \

231 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

233 
	#signb™
(
x
) \

234 ( (
x
) ==  () \

235 ? 
	`__signb™f
 (
x
) \

236 :  (
x
) ==  () \

237 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

241 #ifdeà
__NO_LONG_DOUBLE_MATH


242 
	#isfš™e
(
x
) \

243 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

245 
	#isfš™e
(
x
) \

246 ( (
x
) ==  () \

247 ? 
	`__fš™ef
 (
x
) \

248 :  (
x
) ==  () \

249 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

253 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

257 #ifdeà
__NO_LONG_DOUBLE_MATH


258 
	#i¢ª
(
x
) \

259 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

261 
	#i¢ª
(
x
) \

262 ( (
x
) ==  () \

263 ? 
	`__i¢ªf
 (
x
) \

264 :  (
x
) ==  () \

265 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

269 #ifdeà
__NO_LONG_DOUBLE_MATH


270 
	#isšf
(
x
) \

271 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

273 
	#isšf
(
x
) \

274 ( (
x
) ==  () \

275 ? 
	`__isšff
 (
x
) \

276 :  (
x
) ==  () \

277 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

281 
	#MATH_ERRNO
 1

	)

282 
	#MATH_ERREXCEPT
 2

	)

287 #iâdeà
__FAST_MATH__


288 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

293 #ifdef 
__USE_MISC


297 
_IEEE_
 = -1,

298 
_SVID_
,

299 
_XOPEN_
,

300 
_POSIX_
,

301 
_ISOC_


302 } 
	t_LIB_VERSION_TYPE
;

307 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

311 #ifdeà
__USE_SVID


317 #ifdeà
__ılu¥lus


318 
__exû±iÚ


320 
exû±iÚ


323 
ty³
;

324 *
Çme
;

325 
¬g1
;

326 
¬g2
;

327 
»tv®
;

328 
	}
};

330 #ifdeà
__ılu¥lus


331 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

333 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

336 
	#X_TLOSS
 1.41484755040568800000e+16

	)

339 
	#DOMAIN
 1

	)

340 
	#SING
 2

	)

341 
	#OVERFLOW
 3

	)

342 
	#UNDERFLOW
 4

	)

343 
	#TLOSS
 5

	)

344 
	#PLOSS
 6

	)

347 
	#HUGE
 3.40282347e+38F

	)

351 #ifdeà
__USE_XOPEN


353 
	#MAXFLOAT
 3.40282347e+38F

	)

360 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


361 
	#M_E
 2.7182818284590452354

	)

362 
	#M_LOG2E
 1.4426950408889634074

	)

363 
	#M_LOG10E
 0.43429448190325182765

	)

364 
	#M_LN2
 0.69314718055994530942

	)

365 
	#M_LN10
 2.30258509299404568402

	)

366 
	#M_PI
 3.14159265358979323846

	)

367 
	#M_PI_2
 1.57079632679489661923

	)

368 
	#M_PI_4
 0.78539816339744830962

	)

369 
	#M_1_PI
 0.31830988618379067154

	)

370 
	#M_2_PI
 0.63661977236758134308

	)

371 
	#M_2_SQRTPI
 1.12837916709551257390

	)

372 
	#M_SQRT2
 1.41421356237309504880

	)

373 
	#M_SQRT1_2
 0.70710678118654752440

	)

379 #ifdeà
__USE_GNU


380 
	#M_El
 2.7182818284590452353602874713526625L

	)

381 
	#M_LOG2El
 1.4426950408889634073599246810018921L

	)

382 
	#M_LOG10El
 0.4342944819032518276511289189166051L

	)

383 
	#M_LN2l
 0.6931471805599453094172321214581766L

	)

384 
	#M_LN10l
 2.3025850929940456840179914546843642L

	)

385 
	#M_PIl
 3.1415926535897932384626433832795029L

	)

386 
	#M_PI_2l
 1.5707963267948966192313216916397514L

	)

387 
	#M_PI_4l
 0.7853981633974483096156608458198757L

	)

388 
	#M_1_PIl
 0.3183098861837906715377675267450287L

	)

389 
	#M_2_PIl
 0.6366197723675813430755350534900574L

	)

390 
	#M_2_SQRTPIl
 1.1283791670955125738961589031215452L

	)

391 
	#M_SQRT2l
 1.4142135623730950488016887242096981L

	)

392 
	#M_SQRT1_2l
 0.7071067811865475244008443621048490L

	)

399 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


400 
	#__NO_MATH_INLINES
 1

	)

403 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

410 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

411 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

412 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

413 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

414 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

415 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

419 #ifdeà
__USE_EXTERN_INLINES


420 
	~<b™s/m©hšlše.h
>

423 #ifdeà
__USE_ISOC99


427 #iâdeà
isg»©”


428 
	#isg»©”
(
x
, 
y
) \

429 (
__ex‹nsiÚ__
 \

430 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

431 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

435 #iâdeà
isg»©”equ®


436 
	#isg»©”equ®
(
x
, 
y
) \

437 (
__ex‹nsiÚ__
 \

438 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

439 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

443 #iâdeà
i¦ess


444 
	#i¦ess
(
x
, 
y
) \

445 (
__ex‹nsiÚ__
 \

446 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

447 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

451 #iâdeà
i¦es£qu®


452 
	#i¦es£qu®
(
x
, 
y
) \

453 (
__ex‹nsiÚ__
 \

454 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

455 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

459 #iâdeà
i¦essg»©”


460 
	#i¦essg»©”
(
x
, 
y
) \

461 (
__ex‹nsiÚ__
 \

462 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

463 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

467 #iâdeà
isunÜd”ed


468 
	#isunÜd”ed
(
u
, 
v
) \

469 (
__ex‹nsiÚ__
 \

470 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

471 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

476 
	g__END_DECLS


	@/usr/include/netdb.h

23 #iâdef 
_NETDB_H


24 
	#_NETDB_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<¡dšt.h
>

30 #ifdeà
__USE_MISC


33 
	~<½c/Ãtdb.h
>

36 #ifdeà
__USE_GNU


37 
	#__Ãed_sigev’t_t


	)

38 
	~<b™s/sigšfo.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

43 
	~<b™s/Ãtdb.h
>

46 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

47 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

48 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

49 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

50 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

51 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

54 
	g__BEGIN_DECLS


56 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


59 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

62 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

66 
	#HOST_NOT_FOUND
 1

	)

67 
	#TRY_AGAIN
 2

	)

69 
	#NO_RECOVERY
 3

	)

71 
	#NO_DATA
 4

	)

74 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


75 
	#NETDB_INTERNAL
 -1

	)

76 
	#NETDB_SUCCESS
 0

	)

77 
	#NO_ADDRESS
 
NO_DATA


	)

80 #ifdeà
__USE_XOPEN2K


82 
	#IPPORT_RESERVED
 1024

	)

85 #ifdeà
__USE_GNU


87 
	#SCOPE_DELIMITER
 '%'

	)

90 #ifdeà
__USE_MISC


93 
	$h”rÜ
 (
__cÚ¡
 *
__¡r
è
__THROW
;

96 
__cÚ¡
 *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

101 
	sho¡’t


103 *
h_Çme
;

104 **
h_®Ÿ£s
;

105 
h_add¹y³
;

106 
h_Ëngth
;

107 **
h_addr_li¡
;

108 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


109 
	#h_addr
 
h_addr_li¡
[0]

	)

118 
	`£tho¡’t
 (
__¡ay_İ’
);

124 
	`’dho¡’t
 ();

131 
ho¡’t
 *
	`g‘ho¡’t
 ();

138 
ho¡’t
 *
	`g‘ho¡byaddr
 (
__cÚ¡
 *
__addr
, 
__sockËn_t
 
__Ën
,

139 
__ty³
);

145 
ho¡’t
 *
	`g‘ho¡byÇme
 (
__cÚ¡
 *
__Çme
);

147 #ifdeà
__USE_MISC


156 
ho¡’t
 *
	`g‘ho¡byÇme2
 (
__cÚ¡
 *
__Çme
, 
__af
);

168 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

169 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

170 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

171 *
__»¡riù
 
__h_”ºİ
);

173 
	`g‘ho¡byaddr_r
 (
__cÚ¡
 *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

174 
__ty³
,

175 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

176 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

177 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

178 *
__»¡riù
 
__h_”ºİ
);

180 
	`g‘ho¡byÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

181 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

182 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

183 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

184 *
__»¡riù
 
__h_”ºİ
);

186 
	`g‘ho¡byÇme2_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
, 
__af
,

187 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

188 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

189 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

190 *
__»¡riù
 
__h_”ºİ
);

199 
	`£Š‘’t
 (
__¡ay_İ’
);

205 
	`’dÃ‹Á
 ();

212 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

219 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

225 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (
__cÚ¡
 *
__Çme
);

227 #ifdef 
__USE_MISC


238 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

239 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

240 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

241 *
__»¡riù
 
__h_”ºİ
);

243 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

244 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

245 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

246 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

247 *
__»¡riù
 
__h_”ºİ
);

249 
	`g‘ÃtbyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

250 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

251 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

252 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

253 *
__»¡riù
 
__h_”ºİ
);

258 
	s£rv’t


260 *
s_Çme
;

261 **
s_®Ÿ£s
;

262 
s_pÜt
;

263 *
s_´Ùo
;

271 
	`£t£rv’t
 (
__¡ay_İ’
);

277 
	`’d£rv’t
 ();

284 
£rv’t
 *
	`g‘£rv’t
 ();

291 
£rv’t
 *
	`g‘£rvbyÇme
 (
__cÚ¡
 *
__Çme
,

292 
__cÚ¡
 *
__´Ùo
);

299 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, 
__cÚ¡
 *
__´Ùo
);

302 #ifdef 
__USE_MISC


310 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

311 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

312 
£rv’t
 **
__»¡riù
 
__»suÉ
);

314 
	`g‘£rvbyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

315 
__cÚ¡
 *
__»¡riù
 
__´Ùo
,

316 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

317 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

318 
£rv’t
 **
__»¡riù
 
__»suÉ
);

320 
	`g‘£rvbypÜt_r
 (
__pÜt
, 
__cÚ¡
 *
__»¡riù
 
__´Ùo
,

321 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

322 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

323 
£rv’t
 **
__»¡riù
 
__»suÉ
);

328 
	s´ÙÛÁ


330 *
p_Çme
;

331 **
p_®Ÿ£s
;

332 
p_´Ùo
;

340 
	`£rÙÛÁ
 (
__¡ay_İ’
);

346 
	`’d´ÙÛÁ
 ();

353 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

359 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (
__cÚ¡
 *
__Çme
);

365 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

368 #ifdef 
__USE_MISC


376 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

377 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

378 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

380 
	`g‘´ÙobyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

381 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

382 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

383 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

385 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

386 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

387 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

388 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

397 
	`£Š‘g»Á
 (
__cÚ¡
 *
__Ãtgroup
);

405 
	`’dÃtg»Á
 ();

414 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

415 **
__»¡riù
 
__u£½
,

416 **
__»¡riù
 
__domašp
);

425 
	`šÃtgr
 (
__cÚ¡
 *
__Ãtgroup
, __cÚ¡ *
__ho¡
,

426 
__cÚ¡
 *
__u£r
, __cÚ¡ *
__domaš
);

434 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

435 **
__»¡riù
 
__u£½
,

436 **
__»¡riù
 
__domašp
,

437 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

441 #ifdeà
__USE_BSD


453 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

454 
__cÚ¡
 *
__»¡riù
 
__locu£r
,

455 
__cÚ¡
 *
__»¡riù
 
__»mu£r
,

456 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

465 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

466 
__cÚ¡
 *
__»¡riù
 
__locu£r
,

467 
__cÚ¡
 *
__»¡riù
 
__»mu£r
,

468 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

469 
§_çmy_t
 
__af
);

481 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

482 
__cÚ¡
 *
__»¡riù
 
__Çme
,

483 
__cÚ¡
 *
__»¡riù
 
__·ss
,

484 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

493 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

494 
__cÚ¡
 *
__»¡riù
 
__Çme
,

495 
__cÚ¡
 *
__»¡riù
 
__·ss
,

496 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

497 
§_çmy_t
 
__af
);

507 
	`ru£rok
 (
__cÚ¡
 *
__rho¡
, 
__su£r
,

508 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
);

517 
	`ru£rok_af
 (
__cÚ¡
 *
__rho¡
, 
__su£r
,

518 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
,

519 
§_çmy_t
 
__af
);

530 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

531 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
);

541 
	`œu£rok_af
 (
__cÚ¡
 *
__¿ddr
, 
__su£r
,

542 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
,

543 
§_çmy_t
 
__af
);

553 
	`¼esvpÜt
 (*
__®pÜt
);

562 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

567 #ifdef 
__USE_POSIX


569 
	saddršfo


571 
ai_æags
;

572 
ai_çmy
;

573 
ai_sockty³
;

574 
ai_´ÙocŞ
;

575 
sockËn_t
 
ai_add¾’
;

576 
sockaddr
 *
ai_addr
;

577 *
ai_ÿnÚÇme
;

578 
addršfo
 *
ai_Ãxt
;

581 #ifdeà
__USE_GNU


583 
	sgaicb


585 cÚ¡ *
¬_Çme
;

586 cÚ¡ *
¬_£rviû
;

587 cÚ¡ 
addršfo
 *
¬_»que¡
;

588 
addršfo
 *
¬_»suÉ
;

590 
__»tuº
;

591 
__unu£d
[5];

595 
	#GAI_WAIT
 0

	)

596 
	#GAI_NOWAIT
 1

	)

600 
	#AI_PASSIVE
 0x0001

	)

601 
	#AI_CANONNAME
 0x0002

	)

602 
	#AI_NUMERICHOST
 0x0004

	)

603 
	#AI_V4MAPPED
 0x0008

	)

604 
	#AI_ALL
 0x0010

	)

605 
	#AI_ADDRCONFIG
 0x0020

	)

607 #ifdeà
__USE_GNU


608 
	#AI_IDN
 0x0040

	)

611 
	#AI_CANONIDN
 0x0080

	)

612 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

614 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

617 
	#AI_NUMERICSERV
 0x0400

	)

620 
	#EAI_BADFLAGS
 -1

	)

621 
	#EAI_NONAME
 -2

	)

622 
	#EAI_AGAIN
 -3

	)

623 
	#EAI_FAIL
 -4

	)

624 
	#EAI_FAMILY
 -6

	)

625 
	#EAI_SOCKTYPE
 -7

	)

626 
	#EAI_SERVICE
 -8

	)

627 
	#EAI_MEMORY
 -10

	)

628 
	#EAI_SYSTEM
 -11

	)

629 
	#EAI_OVERFLOW
 -12

	)

630 #ifdeà
__USE_GNU


631 
	#EAI_NODATA
 -5

	)

632 
	#EAI_ADDRFAMILY
 -9

	)

633 
	#EAI_INPROGRESS
 -100

	)

634 
	#EAI_CANCELED
 -101

	)

635 
	#EAI_NOTCANCELED
 -102

	)

636 
	#EAI_ALLDONE
 -103

	)

637 
	#EAI_INTR
 -104

	)

638 
	#EAI_IDN_ENCODE
 -105

	)

641 #ifdeà
__USE_MISC


642 
	#NI_MAXHOST
 1025

	)

643 
	#NI_MAXSERV
 32

	)

646 
	#NI_NUMERICHOST
 1

	)

647 
	#NI_NUMERICSERV
 2

	)

648 
	#NI_NOFQDN
 4

	)

649 
	#NI_NAMEREQD
 8

	)

650 
	#NI_DGRAM
 16

	)

651 #ifdeà
__USE_GNU


652 
	#NI_IDN
 32

	)

653 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

655 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

664 
	`g‘addršfo
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

665 
__cÚ¡
 *
__»¡riù
 
__£rviû
,

666 
__cÚ¡
 
addršfo
 *
__»¡riù
 
__»q
,

667 
addršfo
 **
__»¡riù
 
__·i
);

670 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

673 
__cÚ¡
 *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

679 
	`g‘Çmešfo
 (
__cÚ¡
 
sockaddr
 *
__»¡riù
 
__§
,

680 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

681 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

682 
sockËn_t
 
__£rvËn
, 
__æags
);

685 #ifdeà
__USE_GNU


694 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

695 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

705 
	`gai_su¥’d
 (
__cÚ¡
 
gaicb
 *__cÚ¡ 
__li¡
[], 
__’t
,

706 
__cÚ¡
 
time¥ec
 *
__timeout
);

709 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

712 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

715 
__END_DECLS


	@/usr/include/netinet/in.h

20 #iâdef 
_NETINET_IN_H


21 
	#_NETINET_IN_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<¡dšt.h
>

25 
	~<sys/sock‘.h
>

26 
	~<b™s/ty³s.h
>

29 
__BEGIN_DECLS


34 
	mIPPROTO_IP
 = 0,

35 
	#IPPROTO_IP
 
IPPROTO_IP


	)

36 
	mIPPROTO_HOPOPTS
 = 0,

37 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

38 
	mIPPROTO_ICMP
 = 1,

39 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

40 
	mIPPROTO_IGMP
 = 2,

41 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

42 
	mIPPROTO_IPIP
 = 4,

43 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

44 
	mIPPROTO_TCP
 = 6,

45 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

46 
	mIPPROTO_EGP
 = 8,

47 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

48 
	mIPPROTO_PUP
 = 12,

49 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

50 
	mIPPROTO_UDP
 = 17,

51 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

52 
	mIPPROTO_IDP
 = 22,

53 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

54 
	mIPPROTO_TP
 = 29,

55 
	#IPPROTO_TP
 
IPPROTO_TP


	)

56 
	mIPPROTO_DCCP
 = 33,

57 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

58 
	mIPPROTO_IPV6
 = 41,

59 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

60 
	mIPPROTO_ROUTING
 = 43,

61 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

62 
	mIPPROTO_FRAGMENT
 = 44,

63 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

64 
	mIPPROTO_RSVP
 = 46,

65 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

66 
	mIPPROTO_GRE
 = 47,

67 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

68 
	mIPPROTO_ESP
 = 50,

69 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

70 
	mIPPROTO_AH
 = 51,

71 
	#IPPROTO_AH
 
IPPROTO_AH


	)

72 
	mIPPROTO_ICMPV6
 = 58,

73 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

74 
	mIPPROTO_NONE
 = 59,

75 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

76 
	mIPPROTO_DSTOPTS
 = 60,

77 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

78 
	mIPPROTO_MTP
 = 92,

79 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

80 
	mIPPROTO_ENCAP
 = 98,

81 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

82 
	mIPPROTO_PIM
 = 103,

83 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

84 
	mIPPROTO_COMP
 = 108,

85 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

86 
	mIPPROTO_SCTP
 = 132,

87 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

88 
	mIPPROTO_UDPLITE
 = 136,

89 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


97 
ušt16_t
 
	tš_pÜt_t
;

102 
	mIPPORT_ECHO
 = 7,

103 
	mIPPORT_DISCARD
 = 9,

104 
	mIPPORT_SYSTAT
 = 11,

105 
	mIPPORT_DAYTIME
 = 13,

106 
	mIPPORT_NETSTAT
 = 15,

107 
	mIPPORT_FTP
 = 21,

108 
	mIPPORT_TELNET
 = 23,

109 
	mIPPORT_SMTP
 = 25,

110 
	mIPPORT_TIMESERVER
 = 37,

111 
	mIPPORT_NAMESERVER
 = 42,

112 
	mIPPORT_WHOIS
 = 43,

113 
	mIPPORT_MTP
 = 57,

115 
	mIPPORT_TFTP
 = 69,

116 
	mIPPORT_RJE
 = 77,

117 
	mIPPORT_FINGER
 = 79,

118 
	mIPPORT_TTYLINK
 = 87,

119 
	mIPPORT_SUPDUP
 = 95,

122 
	mIPPORT_EXECSERVER
 = 512,

123 
	mIPPORT_LOGINSERVER
 = 513,

124 
	mIPPORT_CMDSERVER
 = 514,

125 
	mIPPORT_EFSSERVER
 = 520,

128 
	mIPPORT_BIFFUDP
 = 512,

129 
	mIPPORT_WHOSERVER
 = 513,

130 
	mIPPORT_ROUTESERVER
 = 520,

133 
	mIPPORT_RESERVED
 = 1024,

136 
	mIPPORT_USERRESERVED
 = 5000

141 
ušt32_t
 
	tš_addr_t
;

142 
	sš_addr


144 
š_addr_t
 
	ms_addr
;

153 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

154 
	#IN_CLASSA_NET
 0xff000000

	)

155 
	#IN_CLASSA_NSHIFT
 24

	)

156 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

157 
	#IN_CLASSA_MAX
 128

	)

159 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

160 
	#IN_CLASSB_NET
 0xffff0000

	)

161 
	#IN_CLASSB_NSHIFT
 16

	)

162 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

163 
	#IN_CLASSB_MAX
 65536

	)

165 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

166 
	#IN_CLASSC_NET
 0xffffff00

	)

167 
	#IN_CLASSC_NSHIFT
 8

	)

168 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

170 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

171 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

173 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

174 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

177 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

179 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

181 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

184 
	#IN_LOOPBACKNET
 127

	)

186 #iâdeà
INADDR_LOOPBACK


187 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

191 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

192 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

193 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

194 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

198 
	sš6_addr


202 
ušt8_t
 
	m__u6_addr8
[16];

203 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


204 
ušt16_t
 
	m__u6_addr16
[8];

205 
ušt32_t
 
	m__u6_addr32
[4];

207 } 
	m__š6_u
;

208 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

209 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


210 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

211 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

215 cÚ¡ 
š6_addr
 
š6addr_ªy
;

216 cÚ¡ 
š6_addr
 
š6addr_loİback
;

217 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

218 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

220 
	#INET_ADDRSTRLEN
 16

	)

221 
	#INET6_ADDRSTRLEN
 46

	)

225 
	ssockaddr_š


227 
__SOCKADDR_COMMON
 (
sš_
);

228 
š_pÜt_t
 
	msš_pÜt
;

229 
š_addr
 
	msš_addr
;

232 
	msš_z”o
[ (
sockaddr
) -

233 
__SOCKADDR_COMMON_SIZE
 -

234  (
š_pÜt_t
) -

235  (
š_addr
)];

239 
	ssockaddr_š6


241 
__SOCKADDR_COMMON
 (
sš6_
);

242 
š_pÜt_t
 
	msš6_pÜt
;

243 
ušt32_t
 
	msš6_æowšfo
;

244 
š6_addr
 
	msš6_addr
;

245 
ušt32_t
 
	msš6_scİe_id
;

249 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


251 
	s_m»q


254 
š_addr
 
	mimr_muÉŸddr
;

257 
š_addr
 
	mimr_š‹rçû
;

260 
	s_m»q_sourû


263 
š_addr
 
	mimr_muÉŸddr
;

266 
š_addr
 
	mimr_š‹rçû
;

269 
š_addr
 
	mimr_sourûaddr
;

275 
	sv6_m»q


278 
š6_addr
 
	mv6mr_muÉŸddr
;

281 
	mv6mr_š‹rçû
;

285 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


287 
	sgroup_»q


290 
ušt32_t
 
	mgr_š‹rçû
;

293 
sockaddr_¡Üage
 
	mgr_group
;

296 
	sgroup_sourû_»q


299 
ušt32_t
 
	mg¤_š‹rçû
;

302 
sockaddr_¡Üage
 
	mg¤_group
;

305 
sockaddr_¡Üage
 
	mg¤_sourû
;

310 
	s_msf‹r


313 
š_addr
 
	mimsf_muÉŸddr
;

316 
š_addr
 
	mimsf_š‹rçû
;

319 
ušt32_t
 
	mimsf_fmode
;

322 
ušt32_t
 
	mimsf_num¤c
;

324 
š_addr
 
	mimsf_¦i¡
[1];

327 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

328 -  (
š_addr
) \

329 + (
num¤c
è*  (
š_addr
))

	)

331 
	sgroup_f‹r


334 
ušt32_t
 
	mgf_š‹rçû
;

337 
sockaddr_¡Üage
 
	mgf_group
;

340 
ušt32_t
 
	mgf_fmode
;

343 
ušt32_t
 
	mgf_num¤c
;

345 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

348 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

349 -  (
sockaddr_¡Üage
) \

350 + ((
num¤c
) \

351 *  (
sockaddr_¡Üage
)))

	)

356 
	~<b™s/š.h
>

365 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

366 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

367 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

368 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

369 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

370 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

371 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

373 
	~<’dŸn.h
>

376 
	~<b™s/by‹sw­.h
>

378 #ifdeà
__OPTIMIZE__


382 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


385 
	#Áohl
(
x
è(x)

	)

386 
	#Áohs
(
x
è(x)

	)

387 
	#htÚl
(
x
è(x)

	)

388 
	#htÚs
(
x
è(x)

	)

390 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


391 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

392 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

393 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

394 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

399 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

400 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0 \

401 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0 \

402 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0 \

403 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

405 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

406 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0 \

407 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0 \

408 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0 \

409 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

411 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((
__cÚ¡
 
ušt8_t
 *è×))[0] =ğ0xff)

	)

413 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

414 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

415 =ğ
	`htÚl
 (0xã800000))

	)

417 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

418 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

419 =ğ
	`htÚl
 (0xãc00000))

	)

421 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

422 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0) \

423 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0) \

424 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

426 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

427 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0) \

428 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0) \

429 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0) \

430 && (
	`Áohl
 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[3]è> 1))

	)

432 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

433 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[0]) \

434 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[1]) \

435 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[2]) \

436 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

438 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


440 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

443 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

444 
__THROW
;

448 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

449 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

450 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

452 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

453 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

454 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

456 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

457 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

458 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

460 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

461 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

462 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

464 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

465 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

466 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

469 #ifdeà
__USE_GNU


471 
	sš6_pktšfo


473 
š6_addr
 
i6_addr
;

474 
i6_ifšdex
;

478 
	s6_mtušfo


480 
sockaddr_š6
 
6m_addr
;

481 
ušt32_t
 
6m_mtu
;

486 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

487 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

488 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

489 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

490 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

491 
__cÚ¡
 
ušt8_t
 *
__ty³p
, 
__muÉx
,

492 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

493 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

494 
__muÉx
, 
__¶usy
)

495 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

496 
	$š‘6_İtiÚ_Ãxt
 (
__cÚ¡
 
cmsghdr
 *
__cmsg
,

497 
ušt8_t
 **
__Œp
)

498 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

499 
	$š‘6_İtiÚ_fšd
 (
__cÚ¡
 
cmsghdr
 *
__cmsg
,

500 
ušt8_t
 **
__Œp
, 
__ty³
)

501 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

505 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

506 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

507 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

508 **
__d©abuå
è
__THROW
;

509 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

510 
__THROW
;

511 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

512 
sockËn_t
 
__v®Ën
è
__THROW
;

513 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

514 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

515 **
__d©abuå
è
__THROW
;

516 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

517 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

518 **
__d©abuå
è
__THROW
;

519 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

520 
sockËn_t
 
__v®Ën
è
__THROW
;

524 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

525 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

526 
__£gm’ts
è
__THROW
;

527 
	$š‘6_¹h_add
 (*
__bp
, 
__cÚ¡
 
š6_addr
 *
__addr
è
__THROW
;

528 
	$š‘6_¹h_»v”£
 (
__cÚ¡
 *
__š
, *
__out
è
__THROW
;

529 
	$š‘6_¹h_£gm’ts
 (
__cÚ¡
 *
__bp
è
__THROW
;

530 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (
__cÚ¡
 *
__bp
, 
__šdex
)

531 
__THROW
;

537 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

538 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

539 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

540 
__THROW
;

543 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

544 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

545 
ušt32_t
 
__num¤c
,

546 
__cÚ¡
 
š_addr
 *
__¦i¡
)

547 
__THROW
;

551 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

552 
__cÚ¡
 
sockaddr
 *
__group
,

553 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

554 
ušt32_t
 *
__num¤c
,

555 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

558 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

559 
__cÚ¡
 
sockaddr
 *
__group
,

560 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

561 
ušt32_t
 
__num¤c
,

562 
__cÚ¡
 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

565 
__END_DECLS


	@/usr/include/signal.h

23 #iâdef 
_SIGNAL_H


25 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


26 
	#_SIGNAL_H


	)

29 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


33 
	~<b™s/sig£t.h
>

37 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


38 #iâdeà
__sig_©omic_t_defšed


39 
	#__sig_©omic_t_defšed


	)

40 
__BEGIN_NAMESPACE_STD


41 
__sig_©omic_t
 
	tsig_©omic_t
;

42 
	g__END_NAMESPACE_STD


44 #undeà
__Ãed_sig_©omic_t


47 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

48 #iâdeà
__sig£t_t_defšed


49 
	#__sig£t_t_defšed


	)

50 
__sig£t_t
 
	tsig£t_t
;

52 #undeà
__Ãed_sig£t_t


55 #ifdeà
_SIGNAL_H


57 
	~<b™s/ty³s.h
>

58 
	~<b™s/signum.h
>

60 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


61 #iâdeà
__pid_t_defšed


62 
__pid_t
 
	tpid_t
;

63 
	#__pid_t_defšed


	)

65 #ifdeà
__USE_XOPEN


67 #iâdeà
__uid_t_defšed


68 
__uid_t
 
	tuid_t
;

69 
	#__uid_t_defšed


	)

73 #ifdeà
__USE_POSIX199309


75 
	#__Ãed_time¥ec


	)

76 
	~<time.h
>

79 
	~<b™s/sigšfo.h
>

84 (*
	t__sighªdËr_t
) ();

89 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

90 
__THROW
;

91 #ifdeà
__USE_GNU


92 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

93 
__THROW
;

99 
__BEGIN_NAMESPACE_STD


100 #ifdeà
__USE_BSD


101 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

102 
__THROW
;

105 #ifdeà
__REDIRECT_NTH


106 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

107 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

108 
__sysv_sigÇl
);

110 
	#sigÇl
 
__sysv_sigÇl


	)

113 
__END_NAMESPACE_STD


115 #ifdeà
__USE_XOPEN


118 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

119 
__THROW
;

125 #ifdeà
__USE_POSIX


126 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

129 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


133 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

136 
__BEGIN_NAMESPACE_STD


138 
	$¿i£
 (
__sig
è
__THROW
;

139 
__END_NAMESPACE_STD


141 #ifdeà
__USE_SVID


143 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

144 
__THROW
;

145 
	$gsigÇl
 (
__sig
è
__THROW
;

148 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K


150 
	`psigÇl
 (
__sig
, 
__cÚ¡
 *
__s
);

153 #ifdeà
__USE_XOPEN2K


155 
	`psigšfo
 (
__cÚ¡
 
sigšfo_t
 *
__pšfo
, __cÚ¡ *
__s
);

168 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

170 #ifdeà
__FAVOR_BSD


173 
	$sig·u£
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

175 #ifdeà
__USE_XOPEN


176 #ifdeà
__GNUC__


177 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

180 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

186 #ifdeà
__USE_BSD


193 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

196 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

199 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

202 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

206 #ifdeà
__USE_MISC


207 
	#NSIG
 
_NSIG


	)

210 #ifdeà
__USE_GNU


211 
__sighªdËr_t
 
	tsighªdËr_t
;

215 #ifdeà
__USE_BSD


216 
__sighªdËr_t
 
	tsig_t
;

219 #ifdeà
__USE_POSIX


222 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

225 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

228 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

231 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

234 
	$sigismemb”
 (
__cÚ¡
 
sig£t_t
 *
__£t
, 
__signo
)

235 
__THROW
 
	`__nÚnuÎ
 ((1));

237 #ifdeà
__USE_GNU


239 
	$sigi£m±y£t
 (
__cÚ¡
 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

242 
	$sigªd£t
 (
sig£t_t
 *
__£t
, 
__cÚ¡
 sig£t_ˆ*
__Ëá
,

243 
__cÚ¡
 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

246 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, 
__cÚ¡
 sig£t_ˆ*
__Ëá
,

247 
__cÚ¡
 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

252 
	~<b™s/sigaùiÚ.h
>

255 
	$sig´ocmask
 (
__how
, 
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

256 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

263 
	$sigsu¥’d
 (
__cÚ¡
 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

266 
	$sigaùiÚ
 (
__sig
, 
__cÚ¡
 
sigaùiÚ
 *
__»¡riù
 
__aù
,

267 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

270 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

277 
	$sigwa™
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

278 
	`__nÚnuÎ
 ((1, 2));

280 #ifdeà
__USE_POSIX199309


285 
	$sigwa™šfo
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

286 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

293 
	$sigtimedwa™
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

294 
sigšfo_t
 *
__»¡riù
 
__šfo
,

295 
__cÚ¡
 
time¥ec
 *
__»¡riù
 
__timeout
)

296 
	`__nÚnuÎ
 ((1));

300 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, 
__cÚ¡
 
sigv®
 
__v®
)

301 
__THROW
;

306 #ifdeà
__USE_BSD


310 
__cÚ¡
 *__cÚ¡ 
_sys_sigli¡
[
_NSIG
];

311 
__cÚ¡
 *__cÚ¡ 
sys_sigli¡
[
_NSIG
];

314 
	ssigvec


316 
__sighªdËr_t
 
sv_hªdËr
;

317 
sv_mask
;

319 
sv_æags
;

320 
	#sv_Ú¡ack
 
sv_æags


	)

324 
	#SV_ONSTACK
 (1 << 0)

	)

325 
	#SV_INTERRUPT
 (1 << 1)

	)

326 
	#SV_RESETHAND
 (1 << 2)

	)

334 
	$sigvec
 (
__sig
, 
__cÚ¡
 
sigvec
 *
__vec
,

335 
sigvec
 *
__ovec
è
__THROW
;

339 
	~<b™s/sigcÚ‹xt.h
>

342 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

347 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


348 
	#__Ãed_size_t


	)

349 
	~<¡ddef.h
>

354 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

356 
	~<b™s/sig¡ack.h
>

357 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


359 
	~<sys/ucÚ‹xt.h
>

365 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

366 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

370 
	$sig®t¡ack
 (
__cÚ¡
 
sig®t¡ack
 *
__»¡riù
 
__ss
,

371 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

375 #ifdeà
__USE_XOPEN_EXTENDED


379 
	$sighŞd
 (
__sig
è
__THROW
;

382 
	$sig»l£
 (
__sig
è
__THROW
;

385 
	$sigignÜe
 (
__sig
è
__THROW
;

388 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

391 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


394 
	~<b™s/±h»adty³s.h
>

395 
	~<b™s/sigth»ad.h
>

402 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

404 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

408 
__END_DECLS


	@/usr/include/stdint.h

23 #iâdeà
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wch¬.h
>

28 
	~<b™s/wÜdsize.h
>

35 #iâdeà
__št8_t_defšed


36 
	#__št8_t_defšed


	)

37 sigÃd 
	tšt8_t
;

38 
	tšt16_t
;

39 
	tšt32_t
;

40 #ià
__WORDSIZE
 == 64

41 
	tšt64_t
;

43 
__ex‹nsiÚ__


44 
	tšt64_t
;

49 
	tušt8_t
;

50 
	tušt16_t
;

51 #iâdeà
__ušt32_t_defšed


52 
	tušt32_t
;

53 
	#__ušt32_t_defšed


	)

55 #ià
__WORDSIZE
 == 64

56 
	tušt64_t
;

58 
__ex‹nsiÚ__


59 
	tušt64_t
;

66 sigÃd 
	tšt_Ëa¡8_t
;

67 
	tšt_Ëa¡16_t
;

68 
	tšt_Ëa¡32_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_Ëa¡64_t
;

72 
__ex‹nsiÚ__


73 
	tšt_Ëa¡64_t
;

77 
	tušt_Ëa¡8_t
;

78 
	tušt_Ëa¡16_t
;

79 
	tušt_Ëa¡32_t
;

80 #ià
__WORDSIZE
 == 64

81 
	tušt_Ëa¡64_t
;

83 
__ex‹nsiÚ__


84 
	tušt_Ëa¡64_t
;

91 sigÃd 
	tšt_ç¡8_t
;

92 #ià
__WORDSIZE
 == 64

93 
	tšt_ç¡16_t
;

94 
	tšt_ç¡32_t
;

95 
	tšt_ç¡64_t
;

97 
	tšt_ç¡16_t
;

98 
	tšt_ç¡32_t
;

99 
__ex‹nsiÚ__


100 
	tšt_ç¡64_t
;

104 
	tušt_ç¡8_t
;

105 #ià
__WORDSIZE
 == 64

106 
	tušt_ç¡16_t
;

107 
	tušt_ç¡32_t
;

108 
	tušt_ç¡64_t
;

110 
	tušt_ç¡16_t
;

111 
	tušt_ç¡32_t
;

112 
__ex‹nsiÚ__


113 
	tušt_ç¡64_t
;

118 #ià
__WORDSIZE
 == 64

119 #iâdeà
__šŒ_t_defšed


120 
	tšŒ_t
;

121 
	#__šŒ_t_defšed


	)

123 
	tušŒ_t
;

125 #iâdeà
__šŒ_t_defšed


126 
	tšŒ_t
;

127 
	#__šŒ_t_defšed


	)

129 
	tušŒ_t
;

134 #ià
__WORDSIZE
 == 64

135 
	tštmax_t
;

136 
	tuštmax_t
;

138 
__ex‹nsiÚ__


139 
	tštmax_t
;

140 
__ex‹nsiÚ__


141 
	tuštmax_t
;

147 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_LIMIT_MACROS


149 #ià
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
èø## 
L


	)

151 
	#__UINT64_C
(
c
èø## 
UL


	)

153 
	#__INT64_C
(
c
èø## 
LL


	)

154 
	#__UINT64_C
(
c
èø## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #ià
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #ià
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #ià
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #ià
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #ià
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #ià
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #iâdeà
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
è
	)
c

291 
	#INT16_C
(
c
è
	)
c

292 
	#INT32_C
(
c
è
	)
c

293 #ià
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
èø## 
L


	)

296 
	#INT64_C
(
c
èø## 
LL


	)

300 
	#UINT8_C
(
c
è
	)
c

301 
	#UINT16_C
(
c
è
	)
c

302 
	#UINT32_C
(
c
èø## 
U


	)

303 #ià
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
èø## 
UL


	)

306 
	#UINT64_C
(
c
èø## 
ULL


	)

310 #ià
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
èø## 
L


	)

312 
	#UINTMAX_C
(
c
èø## 
UL


	)

314 
	#INTMAX_C
(
c
èø## 
LL


	)

315 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

24 #iâdeà
_STDIO_H


26 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

36 
	~<b™s/ty³s.h
>

37 
	#__Ãed_FILE


	)

38 
	#__Ãed___FILE


	)

42 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

52 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

53 || 
defšed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_defšed
 1

	)

59 #undeà
__Ãed_FILE


62 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_defšed
 1

	)

69 #undeà
__Ãed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


78 #ifdeà
__GNUC__


79 #iâdeà
_VA_LIST_DEFINED


80 
_G_va_li¡
 
	tva_li¡
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<¡d¬g.h
>

88 #ifdeà
__USE_XOPEN2K8


89 #iâdeà
__off_t_defšed


90 #iâdeà
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_defšed


	)

97 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_defšed


	)

102 #iâdeà
__ssize_t_defšed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_defšed


	)

109 
__BEGIN_NAMESPACE_STD


110 #iâdeà
__USE_FILE_OFFSET64


111 
_G_åos_t
 
	tåos_t
;

113 
_G_åos64_t
 
	tåos_t
;

115 
__END_NAMESPACE_STD


116 #ifdeà
__USE_LARGEFILE64


117 
_G_åos64_t
 
	tåos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #iâdeà
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #iâdeà
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


148 
	#P_tmpdœ
 "/tmp"

	)

161 
	~<b™s/¡dio_lim.h
>

165 
_IO_FILE
 *
¡dš
;

166 
_IO_FILE
 *
¡dout
;

167 
_IO_FILE
 *
¡d”r
;

169 
	#¡dš
 
¡dš


	)

170 
	#¡dout
 
¡dout


	)

171 
	#¡d”r
 
¡d”r


	)

173 
__BEGIN_NAMESPACE_STD


175 
	$»move
 (
__cÚ¡
 *
__f’ame
è
__THROW
;

177 
	$»Çme
 (
__cÚ¡
 *
__Şd
, __cÚ¡ *
__Ãw
è
__THROW
;

178 
__END_NAMESPACE_STD


180 #ifdeà
__USE_ATFILE


182 
	$»Çm—t
 (
__Şdfd
, 
__cÚ¡
 *
__Şd
, 
__Ãwfd
,

183 
__cÚ¡
 *
__Ãw
è
__THROW
;

186 
__BEGIN_NAMESPACE_STD


191 #iâdeà
__USE_FILE_OFFSET64


192 
FILE
 *
	$tmpfe
 (è
__wur
;

194 #ifdeà
__REDIRECT


195 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

197 
	#tmpfe
 
tmpfe64


	)

201 #ifdeà
__USE_LARGEFILE64


202 
FILE
 *
	$tmpfe64
 (è
__wur
;

206 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

207 
__END_NAMESPACE_STD


209 #ifdeà
__USE_MISC


212 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

216 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


224 *
	$‹m²am
 (
__cÚ¡
 *
__dœ
, __cÚ¡ *
__pfx
)

225 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

229 
__BEGIN_NAMESPACE_STD


234 
	`fşo£
 (
FILE
 *
__¡»am
);

239 
	`fæush
 (
FILE
 *
__¡»am
);

240 
__END_NAMESPACE_STD


242 #ifdeà
__USE_MISC


249 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

252 #ifdeà
__USE_GNU


259 
	`fşo£®l
 ();

263 
__BEGIN_NAMESPACE_STD


264 #iâdeà
__USE_FILE_OFFSET64


269 
FILE
 *
	$fİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

270 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

275 
FILE
 *
	$äeİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

276 
__cÚ¡
 *
__»¡riù
 
__modes
,

277 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

279 #ifdeà
__REDIRECT


280 
FILE
 *
	`__REDIRECT
 (
fİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

281 
__cÚ¡
 *
__»¡riù
 
__modes
), 
fİ’64
)

282 
__wur
;

283 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

284 
__cÚ¡
 *
__»¡riù
 
__modes
,

285 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

286 
__wur
;

288 
	#fİ’
 
fİ’64


	)

289 
	#äeİ’
 
äeİ’64


	)

292 
__END_NAMESPACE_STD


293 #ifdeà
__USE_LARGEFILE64


294 
FILE
 *
	$fİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

295 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

296 
FILE
 *
	$äeİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

297 
__cÚ¡
 *
__»¡riù
 
__modes
,

298 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

301 #ifdef 
__USE_POSIX


303 
FILE
 *
	$fdİ’
 (
__fd
, 
__cÚ¡
 *
__modes
è
__THROW
 
__wur
;

306 #ifdef 
__USE_GNU


309 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

310 
__cÚ¡
 *
__»¡riù
 
__modes
,

311 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

314 #ifdeà
__USE_XOPEN2K8


316 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, 
__cÚ¡
 *
__modes
)

317 
__THROW
 
__wur
;

322 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

326 
__BEGIN_NAMESPACE_STD


329 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

333 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

334 
__modes
, 
size_t
 
__n
è
__THROW
;

335 
__END_NAMESPACE_STD


337 #ifdef 
__USE_BSD


340 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

341 
size_t
 
__size
è
__THROW
;

344 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

348 
__BEGIN_NAMESPACE_STD


353 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

354 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

359 
	`´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

361 
	$¥rštf
 (*
__»¡riù
 
__s
,

362 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

368 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

369 
_G_va_li¡
 
__¬g
);

374 
	`v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

376 
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

377 
_G_va_li¡
 
__¬g
è
__THROW
;

378 
__END_NAMESPACE_STD


380 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


381 
__BEGIN_NAMESPACE_C99


383 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

384 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

385 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

387 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

388 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

389 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

390 
__END_NAMESPACE_C99


393 #ifdeà
__USE_GNU


396 
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__f
,

397 
_G_va_li¡
 
__¬g
)

398 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

399 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

400 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

401 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

402 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

403 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

404 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

407 #ifdeà
__USE_XOPEN2K8


414 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

415 
_G_va_li¡
 
__¬g
)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

417 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

418 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

422 
__BEGIN_NAMESPACE_STD


427 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

428 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

435 
	$ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

436 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

438 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

439 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

440 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

441 #ifdeà
__REDIRECT


445 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

446 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_fsÿnf
è
__wur
;

448 
	`__REDIRECT
 (
sÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

449 
__isoc99_sÿnf
è
__wur
;

450 
	`__REDIRECT_NTH
 (
ssÿnf
, (
__cÚ¡
 *
__»¡riù
 
__s
,

451 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

452 
__isoc99_ssÿnf
);

454 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

455 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

456 
	$__isoc99_sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

457 
	$__isoc99_ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

458 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

459 
	#fsÿnf
 
__isoc99_fsÿnf


	)

460 
	#sÿnf
 
__isoc99_sÿnf


	)

461 
	#ssÿnf
 
__isoc99_ssÿnf


	)

465 
__END_NAMESPACE_STD


467 #ifdef 
__USE_ISOC99


468 
__BEGIN_NAMESPACE_C99


473 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

474 
_G_va_li¡
 
__¬g
)

475 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

481 
	$vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

482 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

485 
	$vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

486 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

487 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

489 #ià!
defšed
 
__USE_GNU
 \

490 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

491 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

492 #ifdeà
__REDIRECT


496 
	`__REDIRECT
 (
vfsÿnf
,

497 (
FILE
 *
__»¡riù
 
__s
,

498 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

499 
__isoc99_vfsÿnf
)

500 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

501 
	`__REDIRECT
 (
vsÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

502 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

503 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

504 
	`__REDIRECT_NTH
 (
vssÿnf
,

505 (
__cÚ¡
 *
__»¡riù
 
__s
,

506 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

507 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

508 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

510 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

511 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

514 
_G_va_li¡
 
__¬g
è
__wur
;

515 
	$__isoc99_vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

516 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

517 
_G_va_li¡
 
__¬g
è
__THROW
;

518 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

519 
	#vsÿnf
 
__isoc99_vsÿnf


	)

520 
	#vssÿnf
 
__isoc99_vssÿnf


	)

524 
__END_NAMESPACE_C99


528 
__BEGIN_NAMESPACE_STD


533 
	`fg‘c
 (
FILE
 *
__¡»am
);

534 
	`g‘c
 (
FILE
 *
__¡»am
);

540 
	`g‘ch¬
 ();

541 
__END_NAMESPACE_STD


545 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

547 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


552 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

553 
	`g‘ch¬_uÆocked
 ();

556 #ifdeà
__USE_MISC


563 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

567 
__BEGIN_NAMESPACE_STD


575 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

576 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

582 
	`putch¬
 (
__c
);

583 
__END_NAMESPACE_STD


587 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

589 #ifdeà
__USE_MISC


596 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

599 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


604 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

605 
	`putch¬_uÆocked
 (
__c
);

609 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

610 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

612 
	`g‘w
 (
FILE
 *
__¡»am
);

615 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

619 
__BEGIN_NAMESPACE_STD


624 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

625 
__wur
;

632 *
	$g‘s
 (*
__s
è
__wur
;

633 
__END_NAMESPACE_STD


635 #ifdeà
__USE_GNU


642 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

643 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

647 #ifdef 
__USE_XOPEN2K8


658 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

659 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

660 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

661 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

662 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

663 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

671 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

672 
size_t
 *
__»¡riù
 
__n
,

673 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

677 
__BEGIN_NAMESPACE_STD


682 
	`åuts
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

688 
	`puts
 (
__cÚ¡
 *
__s
);

695 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

702 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

703 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

708 
size_t
 
	`fwr™e
 (
__cÚ¡
 *
__»¡riù
 
__±r
, size_ˆ
__size
,

709 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

710 
__END_NAMESPACE_STD


712 #ifdeà
__USE_GNU


719 
	`åuts_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__s
,

720 
FILE
 *
__»¡riù
 
__¡»am
);

723 #ifdeà
__USE_MISC


730 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

731 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

732 
size_t
 
	`fwr™e_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__±r
, size_ˆ
__size
,

733 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

737 
__BEGIN_NAMESPACE_STD


742 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

747 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

752 
	`»wšd
 (
FILE
 *
__¡»am
);

753 
__END_NAMESPACE_STD


760 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


761 #iâdeà
__USE_FILE_OFFSET64


766 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

771 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

773 #ifdeà
__REDIRECT


774 
	`__REDIRECT
 (
f£eko
,

775 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

776 
f£eko64
);

777 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

779 
	#f£eko
 
f£eko64


	)

780 
	#á–lo
 
á–lo64


	)

785 
__BEGIN_NAMESPACE_STD


786 #iâdeà
__USE_FILE_OFFSET64


791 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

796 
	`f£os
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
);

798 #ifdeà
__REDIRECT


799 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

800 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

801 
	`__REDIRECT
 (
f£os
,

802 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
), 
f£os64
);

804 
	#fg‘pos
 
fg‘pos64


	)

805 
	#f£os
 
f£os64


	)

808 
__END_NAMESPACE_STD


810 #ifdeà
__USE_LARGEFILE64


811 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

812 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

813 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

814 
	`f£os64
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos64_t
 *
__pos
);

817 
__BEGIN_NAMESPACE_STD


819 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

821 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

823 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

824 
__END_NAMESPACE_STD


826 #ifdeà
__USE_MISC


828 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

829 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

830 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

834 
__BEGIN_NAMESPACE_STD


839 
	`³¼Ü
 (
__cÚ¡
 *
__s
);

840 
__END_NAMESPACE_STD


846 
	~<b™s/sys_”¾i¡.h
>

849 #ifdef 
__USE_POSIX


851 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

854 #ifdeà
__USE_MISC


856 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

860 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

861 
defšed
 
__USE_MISC
)

866 
FILE
 *
	$pİ’
 (
__cÚ¡
 *
__commªd
, __cÚ¡ *
__modes
è
__wur
;

872 
	`pşo£
 (
FILE
 *
__¡»am
);

876 #ifdef 
__USE_POSIX


878 *
	$ù”mid
 (*
__s
è
__THROW
;

882 #ifdeà
__USE_XOPEN


884 *
	`cu£rid
 (*
__s
);

888 #ifdef 
__USE_GNU


889 
ob¡ack
;

892 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

893 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

894 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

895 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

896 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

897 
_G_va_li¡
 
__¬gs
)

898 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

902 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


906 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

910 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

913 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

916 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


920 
	#__Ãed_g‘İt


	)

921 
	~<g‘İt.h
>

926 #ifdeà
__USE_EXTERN_INLINES


927 
	~<b™s/¡dio.h
>

929 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


930 
	~<b™s/¡dio2.h
>

932 #ifdeà
__LDBL_COMPAT


933 
	~<b™s/¡dio-ldbl.h
>

936 
__END_DECLS


	@/usr/include/stdlib.h

23 #iâdef 
_STDLIB_H


25 
	~<ã©u»s.h
>

28 
	#__Ãed_size_t


	)

29 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


30 
	#__Ãed_wch¬_t


	)

31 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	g__BEGIN_DECLS


37 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


38 
	#_STDLIB_H
 1

	)

40 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


42 
	~<b™s/wa™æags.h
>

43 
	~<b™s/wa™¡©us.h
>

45 #ifdeà
__USE_BSD


50 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


51 
	#__WAIT_INT
(
¡©us
) \

52 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

53 { .
__š
 = (
¡©us
è}).
__i
))

	)

55 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

63 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
wa™
 *
	m__u±r
;

71 *
	m__Œ
;

72 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

90 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

91 #ifdeà
__WIFCONTINUED


92 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquÙ
;

101 
	m»m
;

102 } 
	tdiv_t
;

105 #iâdeà
__ldiv_t_defšed


108 
	mquÙ
;

109 
	m»m
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_defšed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 struct

120 
	mquÙ
;

121 
	m»m
;

122 } 
	tÎdiv_t
;

123 
	#__Îdiv_t_defšed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

140 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__cÚ¡
 *
__ÅŒ
)

146 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

148 
	$©oi
 (
__cÚ¡
 *
__ÅŒ
)

149 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

151 
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

153 
__END_NAMESPACE_STD


155 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__ex‹nsiÚ__
 
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
)

159 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$¡¹od
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

166 **
__»¡riù
 
__’d±r
)

167 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$¡¹of
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

174 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

176 
	$¡¹Şd
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
)

178 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$¡¹Ş
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

185 **
__»¡riù
 
__’d±r
, 
__ba£
)

186 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

188 
	$¡¹oul
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

189 **
__»¡riù
 
__’d±r
, 
__ba£
)

190 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

191 
__END_NAMESPACE_STD


193 #ià
defšed
 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_BSD


195 
__ex‹nsiÚ__


196 
	$¡¹oq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

197 **
__»¡riù
 
__’d±r
, 
__ba£
)

198 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

200 
__ex‹nsiÚ__


201 
	$¡¹ouq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

202 **
__»¡riù
 
__’d±r
, 
__ba£
)

203 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

206 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__ex‹nsiÚ__


210 
	$¡¹Şl
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
)

212 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

214 
__ex‹nsiÚ__


215 
	$¡¹ouÎ
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

216 **
__»¡riù
 
__’d±r
, 
__ba£
)

217 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

218 
__END_NAMESPACE_C99


222 #ifdeà
__USE_GNU


236 
	~<xloÿË.h
>

240 
	$¡¹Ş_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

241 **
__»¡riù
 
__’d±r
, 
__ba£
,

242 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

244 
	$¡¹oul_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

245 **
__»¡riù
 
__’d±r
,

246 
__ba£
, 
__loÿË_t
 
__loc
)

247 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

249 
__ex‹nsiÚ__


250 
	$¡¹Şl_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

251 **
__»¡riù
 
__’d±r
, 
__ba£
,

252 
__loÿË_t
 
__loc
)

253 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

255 
__ex‹nsiÚ__


256 
	$¡¹ouÎ_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

257 **
__»¡riù
 
__’d±r
,

258 
__ba£
, 
__loÿË_t
 
__loc
)

259 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

261 
	$¡¹od_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

262 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

263 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

265 
	$¡¹of_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

266 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

267 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

269 
	$¡¹Şd_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

270 **
__»¡riù
 
__’d±r
,

271 
__loÿË_t
 
__loc
)

272 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

276 #ifdeà
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__ex‹º_šlše
 

279 
	`__NTH
 (
	$©of
 (
__cÚ¡
 *
__ÅŒ
))

281  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

282 
	}
}

283 
__ex‹º_šlše
 

284 
__NTH
 (
	$©oi
 (
__cÚ¡
 *
__ÅŒ
))

286  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

287 
	}
}

288 
__ex‹º_šlše
 

289 
__NTH
 (
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
))

291  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

298 
__NTH
 (
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
))

300  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

314 
	$a64l
 (
__cÚ¡
 *
__s
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


320 
	~<sys/ty³s.h
>

327 
	$¿ndom
 (è
__THROW
;

330 
	$¤ªdom
 (
__£ed
è
__THROW
;

336 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

337 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

341 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

344 #ifdeà
__USE_MISC


349 
	s¿ndom_d©a


351 
št32_t
 *
åŒ
;

352 
št32_t
 *
½Œ
;

353 
št32_t
 *
¡©e
;

354 
¿nd_ty³
;

355 
¿nd_deg
;

356 
¿nd_£p
;

357 
št32_t
 *
’d_±r
;

360 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

361 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

363 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

364 
__THROW
 
	`__nÚnuÎ
 ((2));

366 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

367 
size_t
 
__¡©–’
,

368 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

369 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

371 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

372 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

373 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$¿nd
 (è
__THROW
;

382 
	$¤ªd
 (
__£ed
è
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifdeà
__USE_POSIX


387 
	$¿nd_r
 (*
__£ed
è
__THROW
;

391 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


395 
	$d¿nd48
 (è
__THROW
;

396 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

399 
	$Ìªd48
 (è
__THROW
;

400 
	$Äªd48
 (
__xsubi
[3])

401 
__THROW
 
	`__nÚnuÎ
 ((1));

404 
	$m¿nd48
 (è
__THROW
;

405 
	$j¿nd48
 (
__xsubi
[3])

406 
__THROW
 
	`__nÚnuÎ
 ((1));

409 
	$¤ªd48
 (
__£edv®
è
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__nÚnuÎ
 ((1));

412 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

414 #ifdeà
__USE_MISC


418 
	sd¿nd48_d©a


420 
__x
[3];

421 
__Şd_x
[3];

422 
__c
;

423 
__š™
;

424 
__a
;

428 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

429 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$”ªd48_r
 (
__xsubi
[3],

431 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

432 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

435 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

436 *
__»¡riù
 
__»suÉ
)

437 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

438 
	$Äªd48_r
 (
__xsubi
[3],

439 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

445 *
__»¡riù
 
__»suÉ
)

446 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

447 
	$j¿nd48_r
 (
__xsubi
[3],

448 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

449 *
__»¡riù
 
__»suÉ
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

454 
__THROW
 
	`__nÚnuÎ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$lcÚg48_r
 (
__·¿m
[7],

460 
d¿nd48_d©a
 *
__bufãr
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

467 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


468 
	#__m®loc_ªd_ÿÎoc_defšed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

473 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

474 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

488 
	$ä“
 (*
__±r
è
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$cä“
 (*
__±r
è
__THROW
;

496 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


497 
	~<®loÿ.h
>

500 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

501 || 
defšed
 
__USE_BSD


503 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

506 #ifdeà
__USE_XOPEN2K


508 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

509 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

518 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

520 #ifdeà
__USE_GNU


524 #ifdeà
__ılu¥lus


525 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

528 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

537 
__THROW
 
	`__nÚnuÎ
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

546 #ifdeà
__USE_GNU


552 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

554 
__END_NAMESPACE_STD


556 #ifdeà
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$g‘’v
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__£cu»_g‘’v
 (
__cÚ¡
 *
__Çme
)

573 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

575 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


579 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

582 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


585 
	$£‹nv
 (
__cÚ¡
 *
__Çme
, __cÚ¡ *
__v®ue
, 
__»¶aû
)

586 
__THROW
 
	`__nÚnuÎ
 ((2));

589 
	$un£‹nv
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

592 #ifdef 
__USE_MISC


596 
	$ş—»nv
 (è
__THROW
;

600 #ià
defšed
 
__USE_MISC
 \

601 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (
__cÚ¡
 *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (
__cÚ¡
 *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
è(
	t__cÚ¡
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
è(
	t__cÚ¡
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

761 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

762 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

763 #ifdeà
__USE_GNU


764 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

765 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

766 
	`__nÚnuÎ
 ((1, 4));

771 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

772 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

773 
__END_NAMESPACE_STD


775 #ifdeà
__USE_ISOC99


776 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

777 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__num”
, 
__d’om
)

786 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

788 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

789 
__END_NAMESPACE_STD


791 #ifdeà
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

794 
__d’om
)

795 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

796 
__END_NAMESPACE_C99


800 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

801 || 
defšed
 
__USE_SVID


808 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

809 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

814 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

815 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

820 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

821 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

824 #ifdeà
__USE_MISC


826 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

827 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

828 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

829 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

830 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

831 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

832 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

833 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

838 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

839 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

840 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

841 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

842 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

843 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

846 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

847 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

848 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbËn
 (
__cÚ¡
 *
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

863 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

864 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

867 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
 
__wur
;

871 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

872 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

874 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

875 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifdeà
__USE_SVID


885 
	$½m©ch
 (
__cÚ¡
 *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

889 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


896 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

897 *
__cÚ¡
 *
__»¡riù
 
__tok’s
,

898 **
__»¡riù
 
__v®u•
)

899 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

903 #ifdeà
__USE_XOPEN


905 
	$£tkey
 (
__cÚ¡
 *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

911 #ifdeà
__USE_XOPEN2KXSI


913 
	$posix_İ’±
 (
__oæag
è
__wur
;

916 #ifdeà
__USE_XOPEN


921 
	$g¿Á±
 (
__fd
è
__THROW
;

925 
	$uÆock±
 (
__fd
è
__THROW
;

930 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

933 #ifdeà
__USE_GNU


937 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

938 
__THROW
 
	`__nÚnuÎ
 ((2));

941 
	`g‘±
 ();

944 #ifdeà
__USE_BSD


948 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

949 
__THROW
 
	`__nÚnuÎ
 ((1));

954 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


955 
	~<b™s/¡dlib.h
>

957 #ifdeà
__LDBL_COMPAT


958 
	~<b™s/¡dlib-ldbl.h
>

962 #undeà
__Ãed_m®loc_ªd_ÿÎoc


964 
__END_DECLS


	@/usr/include/string.h

24 #iâdef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memıy
 (*
__»¡riù
 
__de¡
,

45 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

49 *
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


57 *
	$memcıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

68 
	$memcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

72 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 
__cÚ¡
 *
	`memchr
 (__cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

80 #ifdeà
__OPTIMIZE__


81 
__ex‹º_®ways_šlše
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


84  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

88 
	`memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


90  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifdeà
__USE_GNU


103 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 "C++" 
__cÚ¡
 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

109 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

110 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" 
__cÚ¡
 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

129 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

131 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

132 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

137 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

139 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

140 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
	$¡ºcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
	$¡rcŞl
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

153 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

154 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nÚnuÎ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifdeà
__USE_XOPEN2K8


162 
	~<xloÿË.h
>

165 
	$¡rcŞl_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

166 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

168 
size_t
 
	$¡rxäm_l
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

169 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

172 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

173 || 
defšed
 
__USE_XOPEN2K8


175 *
	$¡rdup
 (
__cÚ¡
 *
__s
)

176 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

182 #ià
defšed
 
__USE_XOPEN2K8


183 *
	$¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

184 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

187 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


189 
	#¡rdu·
(
s
) \

190 (
__ex‹nsiÚ__
 \

192 
__cÚ¡
 *
__Şd
 = (
s
); \

193 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

194 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

195 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

196 
	}
}))

	)

199 
	#¡ºdu·
(
s
, 
n
) \

200 (
__ex‹nsiÚ__
 \

202 
__cÚ¡
 *
__Şd
 = (
s
); \

203 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

204 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

205 
__Ãw
[
__Ën
] = '\0'; \

206 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
¡rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 
__cÚ¡
 *
¡rchr
 (__cÚ¡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

220 #ifdeà
__OPTIMIZE__


221 
__ex‹º_®ways_šlše
 *

222 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


224  
__butš_¡rchr
 (
__s
, 
__c
);

227 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

228 
¡rchr
 (
__cÚ¡
 *
__s
, 
__c
è
	g__THROW


230  
__butš_¡rchr
 (
__s
, 
__c
);

235 *
	$¡rchr
 (
__cÚ¡
 *
__s
, 
__c
)

236 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

239 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`¡¼chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 
__cÚ¡
 *
	`¡¼chr
 (__cÚ¡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__OPTIMIZE__


248 
__ex‹º_®ways_šlše
 *

249 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


251  
	`__butš_¡¼chr
 (
__s
, 
__c
);

254 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

255 
	`¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


257  
	`__butš_¡¼chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
)

263 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_GNU


270 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 "C++" 
__cÚ¡
 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

276 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$¡rc¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__»jeù
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 
size_t
 
	$¡r¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

289 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

291 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
)

295 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 
__cÚ¡
 *
	`¡½brk
 (__cÚ¡ *
__s
, __cÚ¡ *
__acû±
)

297 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

299 #ifdeà
__OPTIMIZE__


300 
__ex‹º_®ways_šlše
 *

301 
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
è
__THROW


303  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

306 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

307 
	`¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
è
__THROW


309  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

312 
	}
}

314 *
	$¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

318 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

322 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 
__cÚ¡
 *
	`¡r¡r
 (__cÚ¡ *
__hay¡ack
,

324 
__cÚ¡
 *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

335 
	`¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 
__cÚ¡
 *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" 
__cÚ¡
 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
,

370 
__cÚ¡
 *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (
__cÚ¡
 *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 
__cÚ¡
 *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (
__cÚ¡
 *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2));

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

482 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

510 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 #ifdeà
__GNUC__


530 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

531 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

536 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

548 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

551 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

552 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

553 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

560 
__cÚ¡
 *
__»¡riù
 
__d–im
)

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

569 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

577 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

580 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$¡rv”scmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

587 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

590 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

595 #iâdeà
ba£Çme


600 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£Çme
 (*
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

603 "C++" 
__cÚ¡
 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
)

604 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

606 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

612 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

613 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

614 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


634 
	~<b™s/¡ršg.h
>

637 
	~<b™s/¡ršg2.h
>

640 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


642 
	~<b™s/¡ršg3.h
>

646 
__END_DECLS


	@/usr/include/strings.h

20 #iâdef 
_STRINGS_H


21 
	#_STRINGS_H
 1

	)

26 #ià!
defšed
 
_STRING_H
 || !defšed 
__USE_BSD


28 
	~<ã©u»s.h
>

29 
	#__Ãed_size_t


	)

30 
	~<¡ddef.h
>

33 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

34 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

37 
	g__BEGIN_DECLS


39 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


41 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

42 
__THROW
 
__©Œibu‹_pu»__
;

45 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
è
__THROW
;

48 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
;

51 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


54 *
	`šdex
 (*
__s
, 
__c
)

55 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

56 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

57 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

59 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRING_H_PROTO


60 
__ex‹º_®ways_šlše
 *

61 
	`šdex
 (*
__s
, 
__c
è
__THROW


63  
	`__butš_šdex
 (
__s
, 
__c
);

66 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

67 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


69  
	`__butš_šdex
 (
__s
, 
__c
);

72 
	}
}

74 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

75 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

79 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


82 *
	`ršdex
 (*
__s
, 
__c
)

83 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

84 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

85 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

87 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRING_H_PROTO


88 
__ex‹º_®ways_šlše
 *

89 
	`ršdex
 (*
__s
, 
__c
è
__THROW


91  
	`__butš_ršdex
 (
__s
, 
__c
);

94 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

95 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


97  
	`__butš_ršdex
 (
__s
, 
__c
);

100 
	}
}

102 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

103 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

107 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8
 || defšed 
__USE_XOPEN2K8XSI


110 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((const));

114 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

115 
__THROW
 
__©Œibu‹_pu»__
;

118 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

119 
__THROW
 
__©Œibu‹_pu»__
;

121 #ifdef 
__USE_XOPEN2K8


125 
	~<xloÿË.h
>

129 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

130 
__loÿË_t
 
__loc
)

131 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

133 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

134 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

135 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

138 
__END_DECLS


	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/unistd.h

23 #iâdef 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


33 #ifdeà
__USE_XOPEN2K8


35 
	#_POSIX_VERSION
 200809L

	)

36 #–ià
defšed
 
__USE_XOPEN2K


38 
	#_POSIX_VERSION
 200112L

	)

39 #–ià
defšed
 
__USE_POSIX199506


41 
	#_POSIX_VERSION
 199506L

	)

42 #–ià
defšed
 
__USE_POSIX199309


44 
	#_POSIX_VERSION
 199309L

	)

47 
	#_POSIX_VERSION
 199009L

	)

53 #ifdeà
__USE_XOPEN2K8


54 
	#__POSIX2_THIS_VERSION
 200809L

	)

56 #–ià
defšed
 
__USE_XOPEN2K


58 
	#__POSIX2_THIS_VERSION
 200112L

	)

59 #–ià
defšed
 
__USE_POSIX199506


61 
	#__POSIX2_THIS_VERSION
 199506L

	)

64 
	#__POSIX2_THIS_VERSION
 199209L

	)

68 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

72 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

76 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

80 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

84 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

87 #ifdeà
__USE_XOPEN2K8


88 
	#_XOPEN_VERSION
 700

	)

89 #–ià
defšed
 
__USE_XOPEN2K


90 
	#_XOPEN_VERSION
 600

	)

91 #–ià
defšed
 
__USE_UNIX98


92 
	#_XOPEN_VERSION
 500

	)

94 
	#_XOPEN_VERSION
 4

	)

98 
	#_XOPEN_XCU_VERSION
 4

	)

101 
	#_XOPEN_XPG2
 1

	)

102 
	#_XOPEN_XPG3
 1

	)

103 
	#_XOPEN_XPG4
 1

	)

106 
	#_XOPEN_UNIX
 1

	)

109 
	#_XOPEN_CRYPT
 1

	)

113 
	#_XOPEN_ENH_I18N
 1

	)

116 
	#_XOPEN_LEGACY
 1

	)

203 
	~<b™s/posix_İt.h
>

206 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


207 
	~<b™s/’vœÚm’ts.h
>

211 
	#STDIN_FILENO
 0

	)

212 
	#STDOUT_FILENO
 1

	)

213 
	#STDERR_FILENO
 2

	)

218 
	~<b™s/ty³s.h
>

220 #iâdef 
__ssize_t_defšed


221 
__ssize_t
 
	tssize_t
;

222 
	#__ssize_t_defšed


	)

225 
	#__Ãed_size_t


	)

226 
	#__Ãed_NULL


	)

227 
	~<¡ddef.h
>

229 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


232 #iâdeà
__gid_t_defšed


233 
__gid_t
 
	tgid_t
;

234 
	#__gid_t_defšed


	)

237 #iâdeà
__uid_t_defšed


238 
__uid_t
 
	tuid_t
;

239 
	#__uid_t_defšed


	)

242 #iâdeà
__off_t_defšed


243 #iâdeà
__USE_FILE_OFFSET64


244 
__off_t
 
	toff_t
;

246 
__off64_t
 
	toff_t
;

248 
	#__off_t_defšed


	)

250 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


251 
__off64_t
 
	toff64_t
;

252 
	#__off64_t_defšed


	)

255 #iâdeà
__u£cÚds_t_defšed


256 
__u£cÚds_t
 
	tu£cÚds_t
;

257 
	#__u£cÚds_t_defšed


	)

260 #iâdeà
__pid_t_defšed


261 
__pid_t
 
	tpid_t
;

262 
	#__pid_t_defšed


	)

266 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


267 #iâdeà
__šŒ_t_defšed


268 
__šŒ_t
 
	tšŒ_t
;

269 
	#__šŒ_t_defšed


	)

273 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


274 #iâdeà
__sockËn_t_defšed


275 
__sockËn_t
 
	tsockËn_t
;

276 
	#__sockËn_t_defšed


	)

282 
	#R_OK
 4

	)

283 
	#W_OK
 2

	)

284 
	#X_OK
 1

	)

285 
	#F_OK
 0

	)

288 
	$acûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 #ifdeà
__USE_GNU


293 
	$euidacûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

294 
__THROW
 
	`__nÚnuÎ
 ((1));

297 
	$—cûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

298 
__THROW
 
	`__nÚnuÎ
 ((1));

301 #ifdeà
__USE_ATFILE


305 
	$çcûs§t
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__ty³
, 
__æag
)

306 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 #iâdef 
_STDIO_H


312 
	#SEEK_SET
 0

	)

313 
	#SEEK_CUR
 1

	)

314 
	#SEEK_END
 2

	)

317 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


319 
	#L_SET
 
SEEK_SET


	)

320 
	#L_INCR
 
SEEK_CUR


	)

321 
	#L_XTND
 
SEEK_END


	)

330 #iâdeà
__USE_FILE_OFFSET64


331 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

333 #ifdeà
__REDIRECT_NTH


334 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

335 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

336 
l£ek64
);

338 
	#l£ek
 
l£ek64


	)

341 #ifdeà
__USE_LARGEFILE64


342 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

343 
__THROW
;

350 
	`şo£
 (
__fd
);

357 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

363 
ssize_t
 
	$wr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
è
__wur
;

365 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


366 #iâdeà
__USE_FILE_OFFSET64


373 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

374 
__off_t
 
__off£t
è
__wur
;

381 
ssize_t
 
	$pwr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

382 
__off_t
 
__off£t
è
__wur
;

384 #ifdeà
__REDIRECT


385 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

386 
__off64_t
 
__off£t
),

387 
´—d64
è
__wur
;

388 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, 
__cÚ¡
 *
__buf
,

389 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

390 
pwr™e64
è
__wur
;

392 
	#´—d
 
´—d64


	)

393 
	#pwr™e
 
pwr™e64


	)

397 #ifdeà
__USE_LARGEFILE64


401 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

402 
__off64_t
 
__off£t
è
__wur
;

405 
ssize_t
 
	$pwr™e64
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

406 
__off64_t
 
__off£t
è
__wur
;

414 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

416 #ifdeà
__USE_GNU


419 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

429 
	$®¬m
 (
__£cÚds
è
__THROW
;

441 
	`¦“p
 (
__£cÚds
);

443 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

444 || 
defšed
 
__USE_BSD


449 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

450 
__THROW
;

457 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

466 
	`·u£
 ();

470 
	$chown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

471 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

473 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


475 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

480 
	$lchown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

481 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

485 #ifdeà
__USE_ATFILE


488 
	$fchowÇt
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
,

489 
__gid_t
 
__group
, 
__æag
)

490 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

494 
	$chdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

496 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


498 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

508 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

510 #ifdef 
__USE_GNU


514 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

517 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

518 || 
defšed
 
__USE_BSD


522 *
	$g‘wd
 (*
__buf
)

523 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

528 
	$dup
 (
__fd
è
__THROW
 
__wur
;

531 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

533 #ifdeà
__USE_GNU


536 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

540 **
__’vœÚ
;

541 #ifdeà
__USE_GNU


542 **
’vœÚ
;

548 
	$execve
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[],

549 *
__cÚ¡
 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

551 #ifdeà
__USE_XOPEN2K8


554 
	$ãxecve
 (
__fd
, *
__cÚ¡
 
__¬gv
[], *__cÚ¡ 
__’vp
[])

555 
__THROW
 
	`__nÚnuÎ
 ((2));

560 
	$execv
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[])

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

565 
	$exeşe
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

566 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

570 
	$exeş
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

571 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

575 
	$execvp
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[])

576 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

581 
	$exeşp
 (
__cÚ¡
 *
__fe
, __cÚ¡ *
__¬g
, ...)

582 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdeà
__USE_GNU


587 
	$execv³
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[],

588 *
__cÚ¡
 
__’vp
[])

589 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

593 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


595 
	$niû
 (
__šc
è
__THROW
 
__wur
;

600 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

606 
	~<b™s/cÚâame.h
>

609 
	$·thcÚf
 (
__cÚ¡
 *
__·th
, 
__Çme
)

610 
__THROW
 
	`__nÚnuÎ
 ((1));

613 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

616 
	$syscÚf
 (
__Çme
è
__THROW
;

618 #ifdef 
__USE_POSIX2


620 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

625 
__pid_t
 
	$g‘pid
 (è
__THROW
;

628 
__pid_t
 
	$g‘µid
 (è
__THROW
;

632 #iâdeà
__FAVOR_BSD


633 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

635 #ifdeà
__REDIRECT_NTH


636 
__pid_t
 
	`__REDIRECT_NTH
 (
g‘pg½
, (__pid_ˆ
__pid
), 
__g‘pgid
);

638 
	#g‘pg½
 
__g‘pgid


	)

643 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

644 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


645 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

652 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

654 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


665 #iâdeà
__FAVOR_BSD


669 
	$£g½
 (è
__THROW
;

674 #ifdeà
__REDIRECT_NTH


675 
	`__REDIRECT_NTH
 (
£g½
, (
__pid_t
 
__pid
, __pid_ˆ
__pg½
), 
£gid
);

677 
	#£g½
 
£gid


	)

686 
__pid_t
 
	$£tsid
 (è
__THROW
;

688 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


690 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

694 
__uid_t
 
	$g‘uid
 (è
__THROW
;

697 
__uid_t
 
	$g‘euid
 (è
__THROW
;

700 
__gid_t
 
	$g‘gid
 (è
__THROW
;

703 
__gid_t
 
	$g‘egid
 (è
__THROW
;

708 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

710 #ifdef 
__USE_GNU


712 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

719 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
;

721 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


724 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
;

727 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


729 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
;

736 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
;

738 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


741 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
;

744 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


746 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
;

749 #ifdeà
__USE_GNU


752 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

753 
__THROW
;

757 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

758 
__THROW
;

762 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

763 
__THROW
;

767 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

768 
__THROW
;

775 
__pid_t
 
	$fÜk
 (è
__THROW
;

777 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

778 || 
defšed
 
__USE_BSD


783 
__pid_t
 
	$vfÜk
 (è
__THROW
;

789 *
	$‰yÇme
 (
__fd
è
__THROW
;

793 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

794 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

798 
	$i§‰y
 (
__fd
è
__THROW
;

800 #ià
defšed
 
__USE_BSD
 \

801 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

804 
	$‰y¦Ù
 (è
__THROW
;

809 
	$lšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

810 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

812 #ifdeà
__USE_ATFILE


815 
	$lšk©
 (
__äomfd
, 
__cÚ¡
 *
__äom
, 
__tofd
,

816 
__cÚ¡
 *
__to
, 
__æags
)

817 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

820 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


822 
	$symlšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

823 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

828 
ssize_t
 
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

829 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

830 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

833 #ifdeà
__USE_ATFILE


835 
	$symlšk©
 (
__cÚ¡
 *
__äom
, 
__tofd
,

836 
__cÚ¡
 *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

839 
ssize_t
 
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

840 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

841 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

845 
	$uÆšk
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

847 #ifdeà
__USE_ATFILE


849 
	$uÆšk©
 (
__fd
, 
__cÚ¡
 *
__Çme
, 
__æag
)

850 
__THROW
 
	`__nÚnuÎ
 ((2));

854 
	$rmdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

858 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

861 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

868 *
	`g‘logš
 ();

869 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


876 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

879 #ifdef 
__USE_BSD


881 
	$£ogš
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

885 #ifdef 
__USE_POSIX2


889 
	#__Ãed_g‘İt


	)

890 
	~<g‘İt.h
>

894 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


898 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

902 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

905 
	$£tho¡Çme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

906 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

910 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

916 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

917 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

918 
	$£tdomašÇme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

919 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

925 
	$vhªgup
 (è
__THROW
;

928 
	$»voke
 (
__cÚ¡
 *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

936 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

937 
size_t
 
__off£t
, 
__sÿË
)

938 
__THROW
 
	`__nÚnuÎ
 ((1));

944 
	$acù
 (
__cÚ¡
 *
__Çme
è
__THROW
;

948 *
	$g‘u£rsh–l
 (è
__THROW
;

949 
	$’du£rsh–l
 (è
__THROW
;

950 
	$£tu£rsh–l
 (è
__THROW
;

956 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

960 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

963 
	$chroÙ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

967 *
	$g‘·ss
 (
__cÚ¡
 *
__´om±
è
	`__nÚnuÎ
 ((1));

971 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


976 
	`fsync
 (
__fd
);

980 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


983 
	`g‘ho¡id
 ();

986 
	$sync
 (è
__THROW
;

989 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


992 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

997 
	$g‘dbËsize
 (è
__THROW
;

1003 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


1006 #iâdeà
__USE_FILE_OFFSET64


1007 
	$Œunÿ‹
 (
__cÚ¡
 *
__fe
, 
__off_t
 
__Ëngth
)

1008 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1010 #ifdeà
__REDIRECT_NTH


1011 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1012 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
),

1013 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1015 
	#Œunÿ‹
 
Œunÿ‹64


	)

1018 #ifdeà
__USE_LARGEFILE64


1019 
	$Œunÿ‹64
 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
)

1020 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1025 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1028 #iâdeà
__USE_FILE_OFFSET64


1029 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1031 #ifdeà
__REDIRECT_NTH


1032 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1033 
árunÿ‹64
è
__wur
;

1035 
	#árunÿ‹
 
árunÿ‹64


	)

1038 #ifdeà
__USE_LARGEFILE64


1039 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1045 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1046 || 
defšed
 
__USE_MISC


1050 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1056 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1060 #ifdeà
__USE_MISC


1071 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1076 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1088 
	#F_ULOCK
 0

	)

1089 
	#F_LOCK
 1

	)

1090 
	#F_TLOCK
 2

	)

1091 
	#F_TEST
 3

	)

1093 #iâdeà
__USE_FILE_OFFSET64


1094 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1096 #ifdeà
__REDIRECT


1097 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1098 
lockf64
è
__wur
;

1100 
	#lockf
 
lockf64


	)

1103 #ifdeà
__USE_LARGEFILE64


1104 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1109 #ifdeà
__USE_GNU


1114 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1115 (
__ex‹nsiÚ__
 \

1116 ({ 
__»suÉ
; \

1117 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1118 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1119 
__»suÉ
; 
	}
}))

	)

1122 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1125 
fd©async
 (
__fdes
);

1131 #ifdef 
__USE_XOPEN


1133 *
	$üy±
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__§É
)

1134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1138 
	$’üy±
 (*
__libc_block
, 
__edæag
è
__THROW
 
	`__nÚnuÎ
 ((1));

1145 
	$swab
 (
__cÚ¡
 *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1146 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1152 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


1154 *
	$ù”mid
 (*
__s
è
__THROW
;

1159 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


1160 
	~<b™s/uni¡d.h
>

1163 
__END_DECLS


	@/usr/include/alloca.h

19 #iâdef 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

27 
	g__BEGIN_DECLS


30 #undeà
®loÿ


33 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

35 #ifdef 
__GNUC__


36 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

39 
__END_DECLS


	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

20 #iâdef 
_FEATURES_H


21 
	#_FEATURES_H
 1

	)

97 #undeà
__USE_ISOC99


98 #undeà
__USE_ISOC95


99 #undeà
__USE_POSIX


100 #undeà
__USE_POSIX2


101 #undeà
__USE_POSIX199309


102 #undeà
__USE_POSIX199506


103 #undeà
__USE_XOPEN


104 #undeà
__USE_XOPEN_EXTENDED


105 #undeà
__USE_UNIX98


106 #undeà
__USE_XOPEN2K


107 #undeà
__USE_XOPEN2KXSI


108 #undeà
__USE_XOPEN2K8


109 #undeà
__USE_XOPEN2K8XSI


110 #undeà
__USE_LARGEFILE


111 #undeà
__USE_LARGEFILE64


112 #undeà
__USE_FILE_OFFSET64


113 #undeà
__USE_BSD


114 #undeà
__USE_SVID


115 #undeà
__USE_MISC


116 #undeà
__USE_ATFILE


117 #undeà
__USE_GNU


118 #undeà
__USE_REENTRANT


119 #undeà
__USE_FORTIFY_LEVEL


120 #undeà
__FAVOR_BSD


121 #undeà
__KERNEL_STRICT_NAMES


125 #iâdeà
_LOOSE_KERNEL_NAMES


126 
	#__KERNEL_STRICT_NAMES


	)

130 
	#__USE_ANSI
 1

	)

139 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


140 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

141 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

143 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

148 #ià
defšed
 
_BSD_SOURCE
 && \

149 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

150 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

151 
	#__FAVOR_BSD
 1

	)

155 #ifdeà
_GNU_SOURCE


156 #undeà
_ISOC95_SOURCE


157 
	#_ISOC95_SOURCE
 1

	)

158 #undeà
_ISOC99_SOURCE


159 
	#_ISOC99_SOURCE
 1

	)

160 #undeà
_POSIX_SOURCE


161 
	#_POSIX_SOURCE
 1

	)

162 #undeà
_POSIX_C_SOURCE


163 
	#_POSIX_C_SOURCE
 200809L

	)

164 #undeà
_XOPEN_SOURCE


165 
	#_XOPEN_SOURCE
 700

	)

166 #undeà
_XOPEN_SOURCE_EXTENDED


167 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

168 #undeà
_LARGEFILE64_SOURCE


169 
	#_LARGEFILE64_SOURCE
 1

	)

170 #undeà
_BSD_SOURCE


171 
	#_BSD_SOURCE
 1

	)

172 #undeà
_SVID_SOURCE


173 
	#_SVID_SOURCE
 1

	)

174 #undeà
_ATFILE_SOURCE


175 
	#_ATFILE_SOURCE
 1

	)

180 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

181 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

182 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

183 
	#_BSD_SOURCE
 1

	)

184 
	#_SVID_SOURCE
 1

	)

191 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

192 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

193 
	#__USE_ISOC99
 1

	)

197 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

198 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

199 
	#__USE_ISOC95
 1

	)

204 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

205 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

206 
	#_POSIX_SOURCE
 1

	)

207 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

208 
	#_POSIX_C_SOURCE
 2

	)

209 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

210 
	#_POSIX_C_SOURCE
 199506L

	)

211 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

212 
	#_POSIX_C_SOURCE
 200112L

	)

214 
	#_POSIX_C_SOURCE
 200809L

	)

216 
	#__USE_POSIX_IMPLICITLY
 1

	)

219 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


220 
	#__USE_POSIX
 1

	)

223 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


224 
	#__USE_POSIX2
 1

	)

227 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

228 
	#__USE_POSIX199309
 1

	)

231 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

232 
	#__USE_POSIX199506
 1

	)

235 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

236 
	#__USE_XOPEN2K
 1

	)

237 #undeà
__USE_ISOC95


238 
	#__USE_ISOC95
 1

	)

239 #undeà
__USE_ISOC99


240 
	#__USE_ISOC99
 1

	)

243 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

244 
	#__USE_XOPEN2K8
 1

	)

245 #undeà
_ATFILE_SOURCE


246 
	#_ATFILE_SOURCE
 1

	)

249 #ifdef 
_XOPEN_SOURCE


250 
	#__USE_XOPEN
 1

	)

251 #ià(
_XOPEN_SOURCE
 - 0) >= 500

252 
	#__USE_XOPEN_EXTENDED
 1

	)

253 
	#__USE_UNIX98
 1

	)

254 #undeà
_LARGEFILE_SOURCE


255 
	#_LARGEFILE_SOURCE
 1

	)

256 #ià(
_XOPEN_SOURCE
 - 0) >= 600

257 #ià(
_XOPEN_SOURCE
 - 0) >= 700

258 
	#__USE_XOPEN2K8
 1

	)

259 
	#__USE_XOPEN2K8XSI
 1

	)

261 
	#__USE_XOPEN2K
 1

	)

262 
	#__USE_XOPEN2KXSI
 1

	)

263 #undeà
__USE_ISOC95


264 
	#__USE_ISOC95
 1

	)

265 #undeà
__USE_ISOC99


266 
	#__USE_ISOC99
 1

	)

269 #ifdeà
_XOPEN_SOURCE_EXTENDED


270 
	#__USE_XOPEN_EXTENDED
 1

	)

275 #ifdeà
_LARGEFILE_SOURCE


276 
	#__USE_LARGEFILE
 1

	)

279 #ifdeà
_LARGEFILE64_SOURCE


280 
	#__USE_LARGEFILE64
 1

	)

283 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

284 
	#__USE_FILE_OFFSET64
 1

	)

287 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


288 
	#__USE_MISC
 1

	)

291 #ifdef 
_BSD_SOURCE


292 
	#__USE_BSD
 1

	)

295 #ifdef 
_SVID_SOURCE


296 
	#__USE_SVID
 1

	)

299 #ifdef 
_ATFILE_SOURCE


300 
	#__USE_ATFILE
 1

	)

303 #ifdef 
_GNU_SOURCE


304 
	#__USE_GNU
 1

	)

307 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


308 
	#__USE_REENTRANT
 1

	)

311 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

312 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

313 #ià
_FORTIFY_SOURCE
 > 1

314 
	#__USE_FORTIFY_LEVEL
 2

	)

316 
	#__USE_FORTIFY_LEVEL
 1

	)

319 
	#__USE_FORTIFY_LEVEL
 0

	)

323 
	~<b™s/´edefs.h
>

326 
	#__STDC_ISO_10646__
 200009L

	)

334 #undeà
__GNU_LIBRARY__


335 
	#__GNU_LIBRARY__
 6

	)

339 
	#__GLIBC__
 2

	)

340 
	#__GLIBC_MINOR__
 13

	)

342 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

343 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

346 #ià
defšed
 
__GNUC__
 \

347 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

348 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

349 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

350 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

354 #iâdeà
__ASSEMBLER__


355 #iâdeà
_SYS_CDEFS_H


356 
	~<sys/cdefs.h
>

361 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


362 
	#__USE_LARGEFILE
 1

	)

363 
	#__USE_LARGEFILE64
 1

	)

369 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

370 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

371 && 
defšed
 
	g__ex‹º_šlše


372 
	#__USE_EXTERN_INLINES
 1

	)

377 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

378 && (
defšed
 
	g_LIBC
 || !defšed 
	g__OPTIMIZE_SIZE__
è&& !defšed 
	g__NO_INLINE__
 \

379 && 
defšed
 
	g__ex‹º_šlše


380 
	#__USE_EXTERN_INLINES_IN_LIBC
 1

	)

388 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

21 #iâdeà
_GETOPT_H


23 #iâdeà
__Ãed_g‘İt


24 
	#_GETOPT_H
 1

	)

34 #ià!
defšed
 
__GNU_LIBRARY__


35 
	~<ùy³.h
>

38 #iâdeà
__THROW


39 #iâdeà
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

42 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__ılu¥lus


59 *
İrg
;

73 
İtšd
;

78 
İ‹¼
;

82 
İtİt
;

84 #iâdeà
__Ãed_g‘İt


106 
	sİtiÚ


108 cÚ¡ *
	gÇme
;

111 
	ghas_¬g
;

112 *
	gæag
;

113 
	gv®
;

118 
	#no_¬gum’t
 0

	)

119 
	#»quœed_¬gum’t
 1

	)

120 
	#İtiÚ®_¬gum’t
 2

	)

148 #ifdeà
__GNU_LIBRARY__


152 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

153 
__THROW
;

155 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

156 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


160 #ifdeà
__REDIRECT


161 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

162 cÚ¡ *
__shÜtİts
),

163 
__posix_g‘İt
);

165 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

166 cÚ¡ *
__shÜtİts
è
__THROW
;

167 
	#g‘İt
 
__posix_g‘İt


	)

171 
g‘İt
 ();

174 #iâdeà
__Ãed_g‘İt


175 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

176 cÚ¡ *
__shÜtİts
,

177 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

178 
__THROW
;

179 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

180 cÚ¡ *
__shÜtİts
,

181 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

182 
__THROW
;

186 #ifdef 
__ılu¥lus


191 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

29 #iâdeà
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cÚfig.h
>

34 
	#_IO_pos_t
 
_G_åos_t


	)

35 
	#_IO_åos_t
 
_G_åos_t


	)

36 
	#_IO_åos64_t
 
_G_åos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li¡
 
_G_va_li¡


	)

48 
	#_IO_wšt_t
 
_G_wšt_t


	)

50 #ifdeà
_G_NEED_STDARG_H


52 
	#__Ãed___va_li¡


	)

53 
	~<¡d¬g.h
>

54 #ifdeà
__GNUC_VA_LIST


55 #undeà
_IO_va_li¡


56 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

60 #iâdeà
__P


61 #ià
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifdeà
__STDC__


65 
	#__P
(
p
è
	)
p

66 
	#__PMT
(
p
è
	)
p

68 
	#__P
(
p
è()

	)

69 
	#__PMT
(
p
è()

	)

75 #iâdeà
_PARAMS


76 
	#_PARAMS
(
´Ùos
è
	`__P
ÕrÙos)

	)

79 #iâdeà
__STDC__


81 cÚ¡

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #iâdeà
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #iâdeà
EOF


90 
	#EOF
 (-1)

	)

92 #iâdeà
NULL


93 #ià
defšed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuÎ
)

	)

97 #ià!
defšed
(
__ılu¥lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifdeà
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifdeà
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

151 
	#_IO_SKIPWS
 01

	)

152 
	#_IO_LEFT
 02

	)

153 
	#_IO_RIGHT
 04

	)

154 
	#_IO_INTERNAL
 010

	)

155 
	#_IO_DEC
 020

	)

156 
	#_IO_OCT
 040

	)

157 
	#_IO_HEX
 0100

	)

158 
	#_IO_SHOWBASE
 0200

	)

159 
	#_IO_SHOWPOINT
 0400

	)

160 
	#_IO_UPPERCASE
 01000

	)

161 
	#_IO_SHOWPOS
 02000

	)

162 
	#_IO_SCIENTIFIC
 04000

	)

163 
	#_IO_FIXED
 010000

	)

164 
	#_IO_UNITBUF
 020000

	)

165 
	#_IO_STDIO
 040000

	)

166 
	#_IO_DONT_CLOSE
 0100000

	)

167 
	#_IO_BOOLALPHA
 0200000

	)

170 
_IO_jump_t
; 
	g_IO_FILE
;

173 #ifdeà
_IO_MTSAFE_IO


174 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

175 
	~<b™s/¡dio-lock.h
>

180 
	t_IO_lock_t
;

186 
	s_IO_m¬k”
 {

187 
_IO_m¬k”
 *
	m_Ãxt
;

188 
_IO_FILE
 *
	m_sbuf
;

192 
	m_pos
;

194 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

195 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

196 
	mpublic
:

197 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

198 ~
¡»amm¬k”
();

199 
§všg
(è{  
	m_¥os
 == -2; }

200 
d–
(
¡»amm¬k”
&);

201 
d–
();

206 
	e__codecvt_»suÉ


208 
	m__codecvt_ok
,

209 
	m__codecvt_·¹Ÿl
,

210 
	m__codecvt_”rÜ
,

211 
	m__codecvt_nocÚv


214 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


217 
	s_IO_codecvt


219 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

220 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

221 
	m__mb¡©e_t
 *,

222 cÚ¡ 
	mwch¬_t
 *,

223 cÚ¡ 
	mwch¬_t
 *,

224 cÚ¡ 
	mwch¬_t
 **, *,

226 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

227 
	m__mb¡©e_t
 *, *,

229 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

230 
	m__mb¡©e_t
 *,

232 cÚ¡ **, 
	mwch¬_t
 *,

233 
	mwch¬_t
 *, wchar_t **);

234 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

235 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

236 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

237 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

238 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

240 
_IO_icÚv_t
 
	m__cd_š
;

241 
_IO_icÚv_t
 
	m__cd_out
;

245 
	s_IO_wide_d©a


247 
wch¬_t
 *
	m_IO_»ad_±r
;

248 
wch¬_t
 *
	m_IO_»ad_’d
;

249 
wch¬_t
 *
	m_IO_»ad_ba£
;

250 
wch¬_t
 *
	m_IO_wr™e_ba£
;

251 
wch¬_t
 *
	m_IO_wr™e_±r
;

252 
wch¬_t
 *
	m_IO_wr™e_’d
;

253 
wch¬_t
 *
	m_IO_buf_ba£
;

254 
wch¬_t
 *
	m_IO_buf_’d
;

256 
wch¬_t
 *
	m_IO_§ve_ba£
;

257 
wch¬_t
 *
	m_IO_backup_ba£
;

259 
wch¬_t
 *
	m_IO_§ve_’d
;

261 
__mb¡©e_t
 
	m_IO_¡©e
;

262 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

263 
_IO_codecvt
 
	m_codecvt
;

265 
wch¬_t
 
	m_shÜtbuf
[1];

267 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

271 
	s_IO_FILE
 {

272 
	m_æags
;

273 
	#_IO_fe_æags
 
_æags


	)

277 * 
	m_IO_»ad_±r
;

278 * 
	m_IO_»ad_’d
;

279 * 
	m_IO_»ad_ba£
;

280 * 
	m_IO_wr™e_ba£
;

281 * 
	m_IO_wr™e_±r
;

282 * 
	m_IO_wr™e_’d
;

283 * 
	m_IO_buf_ba£
;

284 * 
	m_IO_buf_’d
;

286 *
	m_IO_§ve_ba£
;

287 *
	m_IO_backup_ba£
;

288 *
	m_IO_§ve_’d
;

290 
_IO_m¬k”
 *
	m_m¬k”s
;

292 
_IO_FILE
 *
	m_chaš
;

294 
	m_f’o
;

296 
	m_blksize
;

298 
	m_æags2
;

300 
_IO_off_t
 
	m_Şd_off£t
;

302 
	#__HAVE_COLUMN


	)

304 
	m_cur_cŞumn
;

305 sigÃd 
	m_vbË_off£t
;

306 
	m_shÜtbuf
[1];

310 
_IO_lock_t
 *
	m_lock
;

311 #ifdeà
_IO_USE_OLD_IO_FILE


314 
	s_IO_FILE_com¶‘e


316 
_IO_FILE
 
	m_fe
;

318 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

319 
_IO_off64_t
 
	m_off£t
;

320 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


322 
_IO_codecvt
 *
	m_codecvt
;

323 
_IO_wide_d©a
 *
	m_wide_d©a
;

324 
_IO_FILE
 *
	m_ä“»s_li¡
;

325 *
	m_ä“»s_buf
;

326 
size_t
 
	m_ä“»s_size
;

328 *
	m__·d1
;

329 *
	m__·d2
;

330 *
	m__·d3
;

331 *
	m__·d4
;

332 
size_t
 
	m__·d5
;

334 
	m_mode
;

336 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

340 #iâdeà
__ılu¥lus


341 
_IO_FILE
 
	t_IO_FILE
;

344 
	g_IO_FILE_¶us
;

346 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

347 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

348 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

349 #iâdeà
_LIBC


350 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

351 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

352 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

354 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

355 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

356 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

364 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

372 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, 
	t__cÚ¡
 *
	t__buf
,

373 
	tsize_t
 
	t__n
);

381 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

384 
	t__io_şo£_â
 (*
	t__cook›
);

387 #ifdeà
_GNU_SOURCE


389 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

390 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

391 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

392 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

397 
__io_»ad_â
 *
	m»ad
;

398 
__io_wr™e_â
 *
	mwr™e
;

399 
__io_£ek_â
 *
	m£ek
;

400 
__io_şo£_â
 *
	mşo£
;

401 } 
	t_IO_cook›_io_funùiÚs_t
;

402 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

404 
	g_IO_cook›_fe
;

407 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

408 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

412 #ifdeà
__ılu¥lus


416 
__und”æow
 (
_IO_FILE
 *);

417 
__uæow
 (
_IO_FILE
 *);

418 
__ov”æow
 (
_IO_FILE
 *, );

419 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


420 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

421 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

422 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

425 #ià 
__GNUC__
 >= 3

426 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

428 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

431 
	#_IO_g‘c_uÆocked
(
_å
) \

432 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

433 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

434 
	#_IO_³ekc_uÆocked
(
_å
) \

435 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

436 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

437 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

438 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

439 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

440 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

441 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

443 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


444 
	#_IO_g‘wc_uÆocked
(
_å
) \

445 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

446 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

447 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

448 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

449 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

450 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

451 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

452 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

453 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

454 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

457 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

458 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

460 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

461 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

462 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

463 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

465 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

468 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

469 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

471 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

472 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

473 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

475 #ifdeà
_IO_MTSAFE_IO


476 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

477 
	#_IO_æockfe
(
_å
) \

478 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

479 
	#_IO_fuÆockfe
(
_å
) \

480 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

482 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

483 
	#_IO_æockfe
(
_å
è

	)

484 
	#_IO_fuÆockfe
(
_å
è

	)

485 
	#_IO_árylockfe
(
_å
è

	)

486 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

487 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

490 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

491 
_IO_va_li¡
, *
__»¡riù
);

492 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

493 
_IO_va_li¡
);

494 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

495 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

497 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

498 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

500 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

502 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


503 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

504 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

505 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

506 #ià
__GNUC__
 >= 2

509 #ià
defšed
 
_LIBC
 && defšed 
SHARED


510 
	~<shlib-com·t.h
>

511 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

512 
	#_IO_fwide_maybe_šcom·tibË
 \

513 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

514 cÚ¡ 
_IO_¡dš_u£d
;

515 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

518 #iâdeà
_IO_fwide_maybe_šcom·tibË


519 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

523 
	#_IO_fwide
(
__å
, 
__mode
) \

524 ({ 
__»suÉ
 = (
__mode
); \

525 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

527 ià((
__å
)->
_mode
 == 0) \

529 (
__å
)->
_mode
 = -1; \

530 
__»suÉ
 = (
__å
)->
_mode
; \

532 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

533 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

535 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

536 
__»suÉ
; })

	)

539 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

540 
_IO_va_li¡
, *
__»¡riù
);

541 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

542 
_IO_va_li¡
);

543 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

544 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

547 #ifdeà
__LDBL_COMPAT


548 
	~<b™s/libio-ldbl.h
>

551 #ifdeà
__ılu¥lus


	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (
__cÚ¡
 *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (
__cÚ¡
 *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
__loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb¡©e_t
 
	m__¡©e
;

26 } 
	t_G_åos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb¡©e_t
 
	m__¡©e
;

31 } 
	t_G_åos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¬_t
 
wch¬_t


	)

38 
	#_G_wšt_t
 
wšt_t


	)

39 
	#_G_¡©64
 
¡©64


	)

40 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gcÚv.h
>

44 
__gcÚv_šfo
 
	m__cd
;

47 
__gcÚv_šfo
 
	m__cd
;

48 
__gcÚv_¡•_d©a
 
	m__d©a
;

49 } 
	m__combšed
;

50 } 
	t_G_icÚv_t
;

53 
	t_G_št16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_št32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_ušt16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_ušt32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__İ’64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm­64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
è
	`__fx¡©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #ià
defšed
 
__ılu¥lus
 || defšed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
è
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
è()

	)

	@/usr/include/gconv.h

23 #iâdeà
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	#__Ãed_mb¡©e_t


	)

28 
	#__Ãed_wšt_t


	)

29 
	~<wch¬.h
>

30 
	#__Ãed_size_t


	)

31 
	#__Ãed_wch¬_t


	)

32 
	~<¡ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

72 
	t__cÚ¡
 **, __const *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

86 
	t__cÚ¡
 *,

87 
	t__cÚ¡
 **,

88 
	t__cÚ¡
 *, **,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
è(*, 
	t__cÚ¡
 *,

93 
	t__cÚ¡
 *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
è(
	t__cÚ¡
 *, __const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 
__cÚ¡
 *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

24 #iâdeà
_WCHAR_H


26 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<ã©u»s.h
>

31 #ifdeà
_WCHAR_H


33 
	#__Ãed___FILE


	)

34 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


35 
	#__Ãed_FILE


	)

37 
	~<¡dio.h
>

39 
	#__Ãed___va_li¡


	)

40 
	~<¡d¬g.h
>

42 
	~<b™s/wch¬.h
>

45 
	#__Ãed_size_t


	)

46 
	#__Ãed_wch¬_t


	)

47 
	#__Ãed_NULL


	)

49 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


50 #undeà
__Ãed_wšt_t


51 
	#__Ãed_wšt_t


	)

52 
	~<¡ddef.h
>

56 #iâdeà
_WINT_T


61 
	#_WINT_T


	)

62 
	twšt_t
;

66 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
defšed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twšt_t
;

70 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
__mb¡©e_t_defšed


81 
	#__mb¡©e_t_defšed
 1

	)

85 
	m__couÁ
;

88 #ifdeà
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wšt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__v®ue
;

95 } 
	t__mb¡©e_t
;

97 #undeà
__Ãed_mb¡©e_t


102 #ifdeà
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 #ifdeà
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

112 #iâdeà
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #iâdeà
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


125 
	~<wùy³.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

147 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

155 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
)

161 
__THROW
 
__©Œibu‹_pu»__
;

163 
	$wc¢cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__©Œibu‹_pu»__
;

165 
__END_NAMESPACE_STD


167 #ifdeà
__USE_XOPEN2K8


169 
	$wcsÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

172 
	$wc¢ÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

173 
size_t
 
__n
è
__THROW
;

177 
	~<xloÿË.h
>

179 
	$wcsÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

180 
__loÿË_t
 
__loc
è
__THROW
;

182 
	$wc¢ÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

183 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscŞl
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

193 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

194 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

195 
__END_NAMESPACE_STD


197 #ifdeà
__USE_XOPEN2K8


203 
	$wcscŞl_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

204 
__loÿË_t
 
__loc
è
__THROW
;

209 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

210 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

213 
wch¬_t
 *
	$wcsdup
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

221 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
__©Œibu‹_pu»__
;

228 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

230 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

231 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

232 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
__©Œibu‹_pu»__
;

237 
__END_NAMESPACE_STD


239 #ifdeà
__USE_GNU


242 
wch¬_t
 *
	$wcschºul
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

243 
__THROW
 
__©Œibu‹_pu»__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcsc¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__»jeù
)

250 
__THROW
 
__©Œibu‹_pu»__
;

253 
size_t
 
	$wcs¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

254 
__THROW
 
__©Œibu‹_pu»__
;

256 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, 
__cÚ¡
 wch¬_ˆ*
__acû±
)

258 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

259 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
,

260 
__cÚ¡
 
wch¬_t
 *
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

263 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
__©Œibu‹_pu»__
;

267 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

269 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

270 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

271 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

274 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
__©Œibu‹_pu»__
;

279 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

280 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__d–im
,

281 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

284 
size_t
 
	$wc¦’
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

285 
__END_NAMESPACE_STD


287 #ifdeà
__USE_XOPEN


289 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

291 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

292 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

293 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

296 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
__©Œibu‹_pu»__
;

301 #ifdeà
__USE_XOPEN2K8


303 
size_t
 
	$wc¢Ën
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

304 
__THROW
 
__©Œibu‹_pu»__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

313 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

317 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
__©Œibu‹_pu»__
;

322 
	$wmemcmp
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s1
,

323 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

324 
__THROW
 
__©Œibu‹_pu»__
;

327 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

328 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

332 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
)

333 
__THROW
;

336 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

337 
__END_NAMESPACE_STD


339 #ifdeà
__USE_GNU


342 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

343 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

344 
__THROW
;

348 
__BEGIN_NAMESPACE_STD


351 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

355 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

359 
	$mbsš™
 (
__cÚ¡
 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

363 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

364 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

365 
mb¡©e_t
 *
__p
è
__THROW
;

368 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

369 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

372 
size_t
 
	$__mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

373 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
__END_NAMESPACE_STD


378 #ifdeà
__USE_EXTERN_INLINES


384 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

385 
__ex‹º_šlše
 
wšt_t


386 
	`__NTH
 (
	$btowc
 (
__c
))

387 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

388 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

390 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

391 
__ex‹º_šlše
 

392 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

393 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

394 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

396 
__ex‹º_šlše
 
size_t


397 
__NTH
 (
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

398 
mb¡©e_t
 *
__»¡riù
 
__ps
))

399 {  (
__ps
 !ğ
NULL


400 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

403 
__BEGIN_NAMESPACE_STD


406 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

407 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

408 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

412 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

413 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

414 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

415 
__END_NAMESPACE_STD


418 #ifdef 
__USE_XOPEN2K8


421 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

422 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

423 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

427 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

428 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

429 
size_t
 
__nwc
, size_ˆ
__Ën
,

430 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

435 #ifdeà
__USE_XOPEN


437 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

441 
	$wcswidth
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

445 
__BEGIN_NAMESPACE_STD


448 
	$wc¡od
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

449 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

450 
__END_NAMESPACE_STD


452 #ifdeà
__USE_ISOC99


453 
__BEGIN_NAMESPACE_C99


455 
	$wc¡of
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

456 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

457 
	$wc¡Şd
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
__END_NAMESPACE_C99


463 
__BEGIN_NAMESPACE_STD


466 
	$wc¡Ş
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

467 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

471 
	$wc¡oul
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

472 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

473 
__THROW
;

474 
__END_NAMESPACE_STD


476 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GNUC__
 && defšed 
__USE_GNU
)

477 
__BEGIN_NAMESPACE_C99


480 
__ex‹nsiÚ__


481 
	$wc¡Şl
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

482 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

483 
__THROW
;

487 
__ex‹nsiÚ__


488 
	$wc¡ouÎ
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

489 
wch¬_t
 **
__»¡riù
 
__’d±r
,

490 
__ba£
è
__THROW
;

491 
__END_NAMESPACE_C99


494 #ià
defšed
 
__GNUC__
 && defšed 
__USE_GNU


497 
__ex‹nsiÚ__


498 
	$wc¡oq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

499 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

500 
__THROW
;

504 
__ex‹nsiÚ__


505 
	$wc¡ouq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

506 
wch¬_t
 **
__»¡riù
 
__’d±r
,

507 
__ba£
è
__THROW
;

510 #ifdeà
__USE_GNU


524 
	~<xloÿË.h
>

528 
	$wc¡Ş_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

529 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

530 
__loÿË_t
 
__loc
è
__THROW
;

532 
	$wc¡oul_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

533 
wch¬_t
 **
__»¡riù
 
__’d±r
,

534 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

536 
__ex‹nsiÚ__


537 
	$wc¡Şl_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

538 
wch¬_t
 **
__»¡riù
 
__’d±r
,

539 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

541 
__ex‹nsiÚ__


542 
	$wc¡ouÎ_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

543 
wch¬_t
 **
__»¡riù
 
__’d±r
,

544 
__ba£
, 
__loÿË_t
 
__loc
)

545 
__THROW
;

547 
	$wc¡od_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

548 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

549 
__THROW
;

551 
	$wc¡of_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

552 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

553 
__THROW
;

555 
	$wc¡Şd_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

556 
wch¬_t
 **
__»¡riù
 
__’d±r
,

557 
__loÿË_t
 
__loc
è
__THROW
;

562 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

563 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

567 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

568 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

569 
__THROW
;

575 #ifdef 
__USE_XOPEN2K8


578 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

581 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


582 
__BEGIN_NAMESPACE_STD


585 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

592 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

593 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

599 
	`w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

602 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

603 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
__THROW
 ;

610 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

611 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

612 
__gnuc_va_li¡
 
__¬g
)

618 
	`vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

619 
__gnuc_va_li¡
 
__¬g
)

623 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

624 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

625 
__gnuc_va_li¡
 
__¬g
)

626 
__THROW
 ;

633 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

634 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

640 
	`wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

643 
	$swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

644 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
__THROW
 ;

647 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

648 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

649 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

650 #ifdeà
__REDIRECT


654 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

655 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

656 
__isoc99_fwsÿnf
)

658 
	`__REDIRECT
 (
wsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

659 
__isoc99_wsÿnf
)

661 
	`__REDIRECT_NTH
 (
swsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

662 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

663 ...), 
__isoc99_swsÿnf
)

666 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

667 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

668 
	`__isoc99_wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

669 
	$__isoc99_swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

670 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

671 
__THROW
;

672 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

673 
	#wsÿnf
 
__isoc99_wsÿnf


	)

674 
	#swsÿnf
 
__isoc99_swsÿnf


	)

678 
__END_NAMESPACE_STD


681 #ifdeà
__USE_ISOC99


682 
__BEGIN_NAMESPACE_C99


687 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

688 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

689 
__gnuc_va_li¡
 
__¬g
)

695 
	`vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

696 
__gnuc_va_li¡
 
__¬g
)

699 
	$vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

700 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

701 
__gnuc_va_li¡
 
__¬g
)

702 
__THROW
 ;

704 #ià!
defšed
 
__USE_GNU
 \

705 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

706 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

707 #ifdeà
__REDIRECT


708 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

709 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

710 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

712 
	`__REDIRECT
 (
vwsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

713 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

715 
	`__REDIRECT_NTH
 (
vswsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

716 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

717 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

720 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

721 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

722 
__gnuc_va_li¡
 
__¬g
);

723 
	`__isoc99_vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	$__isoc99_vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

726 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

727 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

728 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

729 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

730 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

734 
__END_NAMESPACE_C99


738 
__BEGIN_NAMESPACE_STD


743 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

744 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

750 
wšt_t
 
	`g‘wch¬
 ();

757 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

758 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

764 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

772 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

773 
__FILE
 *
__»¡riù
 
__¡»am
);

779 
	`åutws
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

780 
__FILE
 *
__»¡riù
 
__¡»am
);

787 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

788 
__END_NAMESPACE_STD


791 #ifdeà
__USE_GNU


799 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

800 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

808 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

816 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

825 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

826 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

835 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

836 
__FILE
 *
__»¡riù
 
__¡»am
);

844 
	`åutws_uÆocked
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

845 
__FILE
 *
__»¡riù
 
__¡»am
);

849 
__BEGIN_NAMESPACE_C99


853 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

854 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

855 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

856 
__END_NAMESPACE_C99


858 #ifdeà
__USE_GNU


859 
	~<xloÿË.h
>

863 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

864 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

865 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

866 
__loÿË_t
 
__loc
è
__THROW
;

875 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


876 
	#__Ãed_iswxxx


	)

877 
	~<wùy³.h
>

881 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


882 
	~<b™s/wch¬2.h
>

885 #ifdeà
__LDBL_COMPAT


886 
	~<b™s/wch¬-ldbl.h
>

889 
__END_DECLS


897 #undeà
__Ãed_mb¡©e_t


898 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

24 #iâdeà
_WCTYPE_H


26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #iâdeà
__Ãed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__Ãed_wšt_t


	)

34 
	~<wch¬.h
>

38 #iâdeà
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #undeà
__Ãed_iswxxx


47 #iâdeà
__iswxxx_defšed


48 
	#__iswxxx_defšed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	twùy³_t
;

54 
	g__END_NAMESPACE_C99


56 #iâdeà
_ISwb™


61 
	~<’dŸn.h
>

62 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


63 
	#_ISwb™
(
b™
è(1 << (b™))

	)

65 
	#_ISwb™
(
b™
) \

66 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (è((1UL << (
b™
)è>> 24))))

	)

74 
	m__ISwuµ”
 = 0,

75 
	m__ISwlow”
 = 1,

76 
	m__ISw®pha
 = 2,

77 
	m__ISwdig™
 = 3,

78 
	m__ISwxdig™
 = 4,

79 
	m__ISw¥aû
 = 5,

80 
	m__ISw´št
 = 6,

81 
	m__ISwg¿ph
 = 7,

82 
	m__ISwbÏnk
 = 8,

83 
	m__ISwúŒl
 = 9,

84 
	m__ISwpunù
 = 10,

85 
	m__ISw®num
 = 11,

87 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

88 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

89 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

90 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

91 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

92 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

93 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

94 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

95 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

96 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

97 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

98 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

118 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

121 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

125 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

129 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

134 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

137 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

142 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

147 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

152 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

157 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

162 #ifdeà
__USE_ISOC99


163 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

172 
wùy³_t
 
	$wùy³
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

176 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__cÚ¡
 
	t__št32_t
 *
	twù¿ns_t
;

188 
__END_NAMESPACE_C99


189 #ifdeà
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

198 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifdeà
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
wù¿ns_t
 
	$wù¿ns
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

222 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifdeà
__USE_XOPEN2K8


227 
	~<xloÿË.h
>

231 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

237 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

240 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

244 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

248 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

253 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

256 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

261 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

266 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

271 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

276 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

281 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

285 
wùy³_t
 
	$wùy³_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

286 
__THROW
;

290 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

291 
__THROW
;

299 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

302 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

306 
wù¿ns_t
 
	$wù¿ns_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

307 
__THROW
;

310 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

311 
__loÿË_t
 
__loÿË
è
__THROW
;

315 
__END_DECLS


	@
1
.
1
/usr/include
249
8310
BasicUsageEnvironment/BasicHashTable.cpp
BasicUsageEnvironment/BasicTaskScheduler.cpp
BasicUsageEnvironment/BasicTaskScheduler0.cpp
BasicUsageEnvironment/BasicUsageEnvironment.cpp
BasicUsageEnvironment/BasicUsageEnvironment0.cpp
BasicUsageEnvironment/DelayQueue.cpp
UsageEnvironment/HashTable.cpp
UsageEnvironment/UsageEnvironment.cpp
UsageEnvironment/strDup.cpp
WindowsAudioInputDevice/WindowsAudioInputDevice_common.cpp
WindowsAudioInputDevice/WindowsAudioInputDevice_mixer.cpp
WindowsAudioInputDevice/WindowsAudioInputDevice_noMixer.cpp
WindowsAudioInputDevice/showAudioInputPorts.cpp
groupsock/GroupEId.cpp
groupsock/Groupsock.cpp
groupsock/GroupsockHelper.cpp
groupsock/IOHandlers.cpp
groupsock/NetAddress.cpp
groupsock/NetInterface.cpp
groupsock/include/NetCommon.h
groupsock/inet.c
liveMedia/AC3AudioFileServerMediaSubsession.cpp
liveMedia/AC3AudioRTPSink.cpp
liveMedia/AC3AudioRTPSource.cpp
liveMedia/AC3AudioStreamFramer.cpp
liveMedia/ADTSAudioFileServerMediaSubsession.cpp
liveMedia/ADTSAudioFileSource.cpp
liveMedia/AMRAudioFileServerMediaSubsession.cpp
liveMedia/AMRAudioFileSink.cpp
liveMedia/AMRAudioFileSource.cpp
liveMedia/AMRAudioRTPSink.cpp
liveMedia/AMRAudioRTPSource.cpp
liveMedia/AMRAudioSource.cpp
liveMedia/AVIFileSink.cpp
liveMedia/AudioInputDevice.cpp
liveMedia/AudioRTPSink.cpp
liveMedia/Base64.cpp
liveMedia/BasicUDPSink.cpp
liveMedia/BasicUDPSource.cpp
liveMedia/BitVector.cpp
liveMedia/ByteStreamFileSource.cpp
liveMedia/ByteStreamMemoryBufferSource.cpp
liveMedia/ByteStreamMultiFileSource.cpp
liveMedia/DVVideoFileServerMediaSubsession.cpp
liveMedia/DVVideoRTPSink.cpp
liveMedia/DVVideoRTPSource.cpp
liveMedia/DVVideoStreamFramer.cpp
liveMedia/DeviceSource.cpp
liveMedia/DigestAuthentication.cpp
liveMedia/EBMLNumber.cpp
liveMedia/FileServerMediaSubsession.cpp
liveMedia/FileSink.cpp
liveMedia/FramedFileSource.cpp
liveMedia/FramedFilter.cpp
liveMedia/FramedSource.cpp
liveMedia/GSMAudioRTPSink.cpp
liveMedia/GenericMediaServer.cpp
liveMedia/H261VideoRTPSource.cpp
liveMedia/H263plusVideoFileServerMediaSubsession.cpp
liveMedia/H263plusVideoRTPSink.cpp
liveMedia/H263plusVideoRTPSource.cpp
liveMedia/H263plusVideoStreamFramer.cpp
liveMedia/H263plusVideoStreamParser.cpp
liveMedia/H264VideoFileServerMediaSubsession.cpp
liveMedia/H264VideoFileSink.cpp
liveMedia/H264VideoRTPSink.cpp
liveMedia/H264VideoRTPSource.cpp
liveMedia/H264VideoStreamDiscreteFramer.cpp
liveMedia/H264VideoStreamFramer.cpp
liveMedia/H264or5VideoFileSink.cpp
liveMedia/H264or5VideoRTPSink.cpp
liveMedia/H264or5VideoStreamDiscreteFramer.cpp
liveMedia/H264or5VideoStreamFramer.cpp
liveMedia/H265VideoFileServerMediaSubsession.cpp
liveMedia/H265VideoFileSink.cpp
liveMedia/H265VideoRTPSink.cpp
liveMedia/H265VideoRTPSource.cpp
liveMedia/H265VideoStreamDiscreteFramer.cpp
liveMedia/H265VideoStreamFramer.cpp
liveMedia/InputFile.cpp
liveMedia/JPEGVideoRTPSink.cpp
liveMedia/JPEGVideoRTPSource.cpp
liveMedia/JPEGVideoSource.cpp
liveMedia/Locale.cpp
liveMedia/MP3ADU.cpp
liveMedia/MP3ADURTPSink.cpp
liveMedia/MP3ADURTPSource.cpp
liveMedia/MP3ADUTranscoder.cpp
liveMedia/MP3ADUdescriptor.cpp
liveMedia/MP3ADUinterleaving.cpp
liveMedia/MP3AudioFileServerMediaSubsession.cpp
liveMedia/MP3AudioMatroskaFileServerMediaSubsession.cpp
liveMedia/MP3FileSource.cpp
liveMedia/MP3Internals.cpp
liveMedia/MP3InternalsHuffman.cpp
liveMedia/MP3InternalsHuffmanTable.cpp
liveMedia/MP3StreamState.cpp
liveMedia/MP3Transcoder.cpp
liveMedia/MPEG1or2AudioRTPSink.cpp
liveMedia/MPEG1or2AudioRTPSource.cpp
liveMedia/MPEG1or2AudioStreamFramer.cpp
liveMedia/MPEG1or2Demux.cpp
liveMedia/MPEG1or2DemuxedElementaryStream.cpp
liveMedia/MPEG1or2DemuxedServerMediaSubsession.cpp
liveMedia/MPEG1or2FileServerDemux.cpp
liveMedia/MPEG1or2VideoFileServerMediaSubsession.cpp
liveMedia/MPEG1or2VideoRTPSink.cpp
liveMedia/MPEG1or2VideoRTPSource.cpp
liveMedia/MPEG1or2VideoStreamDiscreteFramer.cpp
liveMedia/MPEG1or2VideoStreamFramer.cpp
liveMedia/MPEG2IndexFromTransportStream.cpp
liveMedia/MPEG2TransportFileServerMediaSubsession.cpp
liveMedia/MPEG2TransportStreamFramer.cpp
liveMedia/MPEG2TransportStreamFromESSource.cpp
liveMedia/MPEG2TransportStreamFromPESSource.cpp
liveMedia/MPEG2TransportStreamIndexFile.cpp
liveMedia/MPEG2TransportStreamMultiplexor.cpp
liveMedia/MPEG2TransportStreamTrickModeFilter.cpp
liveMedia/MPEG2TransportUDPServerMediaSubsession.cpp
liveMedia/MPEG4ESVideoRTPSink.cpp
liveMedia/MPEG4ESVideoRTPSource.cpp
liveMedia/MPEG4GenericRTPSink.cpp
liveMedia/MPEG4GenericRTPSource.cpp
liveMedia/MPEG4LATMAudioRTPSink.cpp
liveMedia/MPEG4LATMAudioRTPSource.cpp
liveMedia/MPEG4VideoFileServerMediaSubsession.cpp
liveMedia/MPEG4VideoStreamDiscreteFramer.cpp
liveMedia/MPEG4VideoStreamFramer.cpp
liveMedia/MPEGVideoStreamFramer.cpp
liveMedia/MPEGVideoStreamParser.cpp
liveMedia/MatroskaDemuxedTrack.cpp
liveMedia/MatroskaFile.cpp
liveMedia/MatroskaFileParser.cpp
liveMedia/MatroskaFileServerDemux.cpp
liveMedia/MatroskaFileServerMediaSubsession.cpp
liveMedia/Media.cpp
liveMedia/MediaSession.cpp
liveMedia/MediaSink.cpp
liveMedia/MediaSource.cpp
liveMedia/MultiFramedRTPSink.cpp
liveMedia/MultiFramedRTPSource.cpp
liveMedia/OggDemuxedTrack.cpp
liveMedia/OggFile.cpp
liveMedia/OggFileParser.cpp
liveMedia/OggFileServerDemux.cpp
liveMedia/OggFileServerMediaSubsession.cpp
liveMedia/OggFileSink.cpp
liveMedia/OnDemandServerMediaSubsession.cpp
liveMedia/OutputFile.cpp
liveMedia/PassiveServerMediaSubsession.cpp
liveMedia/ProxyServerMediaSession.cpp
liveMedia/QCELPAudioRTPSource.cpp
liveMedia/QuickTimeFileSink.cpp
liveMedia/QuickTimeGenericRTPSource.cpp
liveMedia/RTCP.cpp
liveMedia/RTPInterface.cpp
liveMedia/RTPSink.cpp
liveMedia/RTPSource.cpp
liveMedia/RTSPClient.cpp
liveMedia/RTSPCommon.cpp
liveMedia/RTSPRegisterSender.cpp
liveMedia/RTSPServer.cpp
liveMedia/RTSPServerSupportingHTTPStreaming.cpp
liveMedia/SIPClient.cpp
liveMedia/ServerMediaSession.cpp
liveMedia/SimpleRTPSink.cpp
liveMedia/SimpleRTPSource.cpp
liveMedia/StreamParser.cpp
liveMedia/StreamReplicator.cpp
liveMedia/T140TextRTPSink.cpp
liveMedia/TCPStreamSink.cpp
liveMedia/TextRTPSink.cpp
liveMedia/TheoraVideoRTPSink.cpp
liveMedia/TheoraVideoRTPSource.cpp
liveMedia/VP8VideoRTPSink.cpp
liveMedia/VP8VideoRTPSource.cpp
liveMedia/VP9VideoRTPSink.cpp
liveMedia/VP9VideoRTPSource.cpp
liveMedia/VideoRTPSink.cpp
liveMedia/VorbisAudioRTPSink.cpp
liveMedia/VorbisAudioRTPSource.cpp
liveMedia/WAVAudioFileServerMediaSubsession.cpp
liveMedia/WAVAudioFileSource.cpp
liveMedia/ourMD5.cpp
liveMedia/rtcp_from_spec.c
liveMedia/rtcp_from_spec.h
liveMedia/uLawAudioFilter.cpp
mediaServer/DynamicRTSPServer.cpp
mediaServer/live555MediaServer.cpp
proxyServer/live555ProxyServer.cpp
raspi/testRaspi.cpp
testProgs/MPEG2TransportStreamIndexer.cpp
testProgs/openRTSP.cpp
testProgs/playCommon.cpp
testProgs/playSIP.cpp
testProgs/registerRTSPStream.cpp
testProgs/sapWatch.cpp
testProgs/testAMRAudioStreamer.cpp
testProgs/testDVVideoStreamer.cpp
testProgs/testGSMStreamer.cpp
testProgs/testH264VideoStreamer.cpp
testProgs/testH264VideoToTransportStream.cpp
testProgs/testH265VideoStreamer.cpp
testProgs/testH265VideoToTransportStream.cpp
testProgs/testMKVStreamer.cpp
testProgs/testMP3Receiver.cpp
testProgs/testMP3Streamer.cpp
testProgs/testMPEG1or2AudioVideoStreamer.cpp
testProgs/testMPEG1or2ProgramToTransportStream.cpp
testProgs/testMPEG1or2Splitter.cpp
testProgs/testMPEG1or2VideoReceiver.cpp
testProgs/testMPEG1or2VideoStreamer.cpp
testProgs/testMPEG2TransportReceiver.cpp
testProgs/testMPEG2TransportStreamTrickPlay.cpp
testProgs/testMPEG2TransportStreamer.cpp
testProgs/testMPEG4VideoStreamer.cpp
testProgs/testOggStreamer.cpp
testProgs/testOnDemandRTSPServer.cpp
testProgs/testRTSPClient.cpp
testProgs/testRelay.cpp
testProgs/testReplicator.cpp
testProgs/testWAVAudioStreamer.cpp
testProgs/vobStreamer.cpp
/usr/include/arpa/inet.h
/usr/include/ctype.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/math.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/rpc/netdb.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
